var GI=Object.defineProperty;var qI=(e,t,n)=>t in e?GI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var $r=(e,t,n)=>(qI(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const f of c.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&r(f)}).observe(document,{childList:!0,subtree:!0});function n(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(a){if(a.ep)return;a.ep=!0;const c=n(a);fetch(a.href,c)}})();function Xr(){}function jI(e,t){for(const n in t)e[n]=t[n];return e}function Lb(e){return e()}function Jv(){return Object.create(null)}function ls(e){e.forEach(Lb)}function C_(e){return typeof e=="function"}function Wn(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function WI(e){return Object.keys(e).length===0}function Pb(e,...t){if(e==null){for(const r of t)r(void 0);return Xr}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function Ab(e){let t;return Pb(e,n=>t=n)(),t}function qn(e,t,n){e.$$.on_destroy.push(Pb(t,n))}function vo(e,t,n,r){if(e){const a=Mb(e,t,n,r);return e[0](a)}}function Mb(e,t,n,r){return e[1]&&r?jI(n.ctx.slice(),e[1](r(t))):n.ctx}function xo(e,t,n,r){if(e[2]&&r){const a=e[2](r(n));if(t.dirty===void 0)return a;if(typeof a=="object"){const c=[],f=Math.max(t.dirty.length,a.length);for(let u=0;u<f;u+=1)c[u]=t.dirty[u]|a[u];return c}return t.dirty|a}return t.dirty}function bo(e,t,n,r,a,c){if(a){const f=Mb(t,n,r,c);e.p(f,a)}}function wo(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let r=0;r<n;r++)t[r]=-1;return t}return-1}function ZI(e){const t={};for(const n in e)t[n]=!0;return t}function Qv(e){return e??""}function Cs(e,t,n){return e.set(n),t}function HI(e){return e&&C_(e.destroy)?e.destroy:Xr}const XI=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function he(e,t){e.appendChild(t)}function Ve(e,t,n){e.insertBefore(t,n||null)}function Re(e){e.parentNode&&e.parentNode.removeChild(e)}function YI(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function Pe(e){return document.createElement(e)}function Ir(e){return document.createTextNode(e)}function pn(){return Ir(" ")}function ma(){return Ir("")}function ei(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function cr(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function Db(e){return e===""?null:+e}function KI(e){return Array.from(e.childNodes)}function xm(e,t){t=""+t,e.data!==t&&(e.data=t)}function bm(e,t){e.value=t??""}function ff(e,t,n,r){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function $v(e,t,n){for(let r=0;r<e.options.length;r+=1){const a=e.options[r];if(a.__value===t){a.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function JI(e){const t=e.querySelector(":checked");return t&&t.__value}function t1(e,t,n){e.classList.toggle(t,!!n)}function QI(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}let xf;function df(e){xf=e}function Ff(){if(!xf)throw new Error("Function called outside component initialization");return xf}function $I(e){Ff().$$.on_mount.push(e)}function oa(e){Ff().$$.on_destroy.push(e)}function Xm(){const e=Ff();return(t,n,{cancelable:r=!1}={})=>{const a=e.$$.callbacks[t];if(a){const c=QI(t,n,{cancelable:r});return a.slice().forEach(f=>{f.call(e,c)}),!c.defaultPrevented}return!0}}function T_(e,t){return Ff().$$.context.set(e,t),t}function L_(e){return Ff().$$.context.get(e)}function Rn(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(r=>r.call(this,t))}const _h=[],Fi=[];let wh=[];const Zy=[],kb=Promise.resolve();let Hy=!1;function Rb(){Hy||(Hy=!0,kb.then(Ob))}function Nb(){return Rb(),kb}function wm(e){wh.push(e)}function $s(e){Zy.push(e)}const xy=new Set;let ph=0;function Ob(){if(ph!==0)return;const e=xf;do{try{for(;ph<_h.length;){const t=_h[ph];ph++,df(t),tE(t.$$)}}catch(t){throw _h.length=0,ph=0,t}for(df(null),_h.length=0,ph=0;Fi.length;)Fi.pop()();for(let t=0;t<wh.length;t+=1){const n=wh[t];xy.has(n)||(xy.add(n),n())}wh.length=0}while(_h.length);for(;Zy.length;)Zy.pop()();Hy=!1,xy.clear(),df(e)}function tE(e){if(e.fragment!==null){e.update(),ls(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(wm)}}function eE(e){const t=[],n=[];wh.forEach(r=>e.indexOf(r)===-1?t.push(r):n.push(r)),n.forEach(r=>r()),wh=t}const lm=new Set;let qu;function xi(){qu={r:0,c:[],p:qu}}function bi(){qu.r||ls(qu.c),qu=qu.p}function Zt(e,t){e&&e.i&&(lm.delete(e),e.i(t))}function se(e,t,n,r){if(e&&e.o){if(lm.has(e))return;lm.add(e),qu.c.push(()=>{lm.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function e1(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function ta(e,t,n){const r=e.$$.props[t];r!==void 0&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function En(e){e&&e.c()}function wn(e,t,n){const{fragment:r,after_update:a}=e.$$;r&&r.m(t,n),wm(()=>{const c=e.$$.on_mount.map(Lb).filter(C_);e.$$.on_destroy?e.$$.on_destroy.push(...c):ls(c),e.$$.on_mount=[]}),a.forEach(wm)}function Sn(e,t){const n=e.$$;n.fragment!==null&&(eE(n.after_update),ls(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function nE(e,t){e.$$.dirty[0]===-1&&(_h.push(e),Rb(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function Tr(e,t,n,r,a,c,f=null,u=[-1]){const b=xf;df(e);const C=e.$$={fragment:null,ctx:[],props:c,update:Xr,not_equal:a,bound:Jv(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(b?b.$$.context:[])),callbacks:Jv(),dirty:u,skip_bound:!1,root:t.target||b.$$.root};f&&f(C.root);let A=!1;if(C.ctx=n?n(e,t.props||{},(P,k,...Y)=>{const X=Y.length?Y[0]:k;return C.ctx&&a(C.ctx[P],C.ctx[P]=X)&&(!C.skip_bound&&C.bound[P]&&C.bound[P](X),A&&nE(e,P)),k}):[],C.update(),A=!0,ls(C.before_update),C.fragment=r?r(C.ctx):!1,t.target){if(t.hydrate){const P=KI(t.target);C.fragment&&C.fragment.l(P),P.forEach(Re)}else C.fragment&&C.fragment.c();t.intro&&Zt(e.$$.fragment),wn(e,t.target,t.anchor),Ob()}df(b)}class Lr{constructor(){$r(this,"$$");$r(this,"$$set")}$destroy(){Sn(this,1),this.$destroy=Xr}$on(t,n){if(!C_(n))return Xr;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const a=r.indexOf(n);a!==-1&&r.splice(a,1)}}$set(t){this.$$set&&!WI(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const rE="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(rE);let Hr;const pl=new Array(128).fill(void 0);pl.push(void 0,null,!0,!1);function Kn(e){return pl[e]}let mf=pl.length;function iE(e){e<132||(pl[e]=mf,mf=e)}function zb(e){const t=Kn(e);return iE(e),t}function by(e){return e==null}let lf=null;function oE(){return(lf===null||lf.byteLength===0)&&(lf=new Float64Array(Hr.memory.buffer)),lf}let uf=null;function Js(){return(uf===null||uf.byteLength===0)&&(uf=new Int32Array(Hr.memory.buffer)),uf}const Fb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Fb.decode();let cf=null;function um(){return(cf===null||cf.byteLength===0)&&(cf=new Uint8Array(Hr.memory.buffer)),cf}function hf(e,t){return e=e>>>0,Fb.decode(um().subarray(e,e+t))}function cl(e){mf===pl.length&&pl.push(pl.length+1);const t=mf;return mf=pl[t],pl[t]=e,t}let Sh=0;const cm=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},sE=typeof cm.encodeInto=="function"?function(e,t){return cm.encodeInto(e,t)}:function(e,t){const n=cm.encode(e);return t.set(n),{read:e.length,written:n.length}};function hm(e,t,n){if(n===void 0){const u=cm.encode(e),b=t(u.length,1)>>>0;return um().subarray(b,b+u.length).set(u),Sh=u.length,b}let r=e.length,a=t(r,1)>>>0;const c=um();let f=0;for(;f<r;f++){const u=e.charCodeAt(f);if(u>127)break;c[a+f]=u}if(f!==r){f!==0&&(e=e.slice(f)),a=n(a,r,r=f+e.length*3,1)>>>0;const u=um().subarray(a+f,a+r),b=sE(e,u);f+=b.written}return Sh=f,a}function Xy(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const a=e.description;return a==null?"Symbol":`Symbol(${a})`}if(t=="function"){const a=e.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(e)){const a=e.length;let c="[";a>0&&(c+=Xy(e[0]));for(let f=1;f<a;f++)c+=", "+Xy(e[f]);return c+="]",c}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(n.length>1)r=n[1];else return toString.call(e);if(r=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:r}function aE(e,t){let n,r;try{const A=Hr.__wbindgen_add_to_stack_pointer(-16),P=hm(e,Hr.__wbindgen_malloc,Hr.__wbindgen_realloc),k=Sh;Hr.findWidths(A,P,k,cl(t));var a=Js()[A/4+0],c=Js()[A/4+1],f=Js()[A/4+2],u=Js()[A/4+3],b=a,C=c;if(u)throw b=0,C=0,zb(f);return n=b,r=C,hf(b,C)}finally{Hr.__wbindgen_add_to_stack_pointer(16),Hr.__wbindgen_free(n,r,1)}}async function lE(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function uE(){const e={};return e.wbg={},e.wbg.__wbindgen_boolean_get=function(t){const n=Kn(t);return typeof n=="boolean"?n?1:0:2},e.wbg.__wbindgen_object_drop_ref=function(t){zb(t)},e.wbg.__wbindgen_number_get=function(t,n){const r=Kn(n),a=typeof r=="number"?r:void 0;oE()[t/8+1]=by(a)?0:a,Js()[t/4+0]=!by(a)},e.wbg.__wbindgen_is_object=function(t){const n=Kn(t);return typeof n=="object"&&n!==null},e.wbg.__wbindgen_is_undefined=function(t){return Kn(t)===void 0},e.wbg.__wbindgen_in=function(t,n){return Kn(t)in Kn(n)},e.wbg.__wbindgen_error_new=function(t,n){const r=new Error(hf(t,n));return cl(r)},e.wbg.__wbindgen_string_new=function(t,n){const r=hf(t,n);return cl(r)},e.wbg.__wbindgen_jsval_loose_eq=function(t,n){return Kn(t)==Kn(n)},e.wbg.__wbindgen_string_get=function(t,n){const r=Kn(n),a=typeof r=="string"?r:void 0;var c=by(a)?0:hm(a,Hr.__wbindgen_malloc,Hr.__wbindgen_realloc),f=Sh;Js()[t/4+1]=f,Js()[t/4+0]=c},e.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(t,n){const r=Kn(t)[Kn(n)];return cl(r)},e.wbg.__wbindgen_object_clone_ref=function(t){const n=Kn(t);return cl(n)},e.wbg.__wbg_debug_34c9290896ec9856=function(t){console.debug(Kn(t))},e.wbg.__wbg_error_e60eff06f24ab7a4=function(t){console.error(Kn(t))},e.wbg.__wbg_info_d7d58472d0bab115=function(t){console.info(Kn(t))},e.wbg.__wbg_log_a4530b4fe289336f=function(t){console.log(Kn(t))},e.wbg.__wbg_warn_f260f49434e45e62=function(t){console.warn(Kn(t))},e.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(t){let n;try{n=Kn(t)instanceof ArrayBuffer}catch{n=!1}return n},e.wbg.__wbg_buffer_a448f833075b71ba=function(t){const n=Kn(t).buffer;return cl(n)},e.wbg.__wbg_new_8f67e318f15d7254=function(t){const n=new Uint8Array(Kn(t));return cl(n)},e.wbg.__wbg_set_2357bf09366ee480=function(t,n,r){Kn(t).set(Kn(n),r>>>0)},e.wbg.__wbg_length_1d25fa9e4ac21ce7=function(t){return Kn(t).length},e.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(t){let n;try{n=Kn(t)instanceof Uint8Array}catch{n=!1}return n},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return cl(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const r=Kn(n).stack,a=hm(r,Hr.__wbindgen_malloc,Hr.__wbindgen_realloc),c=Sh;Js()[t/4+1]=c,Js()[t/4+0]=a},e.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let r,a;try{r=t,a=n,console.error(hf(t,n))}finally{Hr.__wbindgen_free(r,a,1)}},e.wbg.__wbindgen_debug_string=function(t,n){const r=Xy(Kn(n)),a=hm(r,Hr.__wbindgen_malloc,Hr.__wbindgen_realloc),c=Sh;Js()[t/4+1]=c,Js()[t/4+0]=a},e.wbg.__wbindgen_throw=function(t,n){throw new Error(hf(t,n))},e.wbg.__wbindgen_memory=function(){const t=Hr.memory;return cl(t)},e}function cE(e,t){return Hr=e.exports,Bb.__wbindgen_wasm_module=t,lf=null,uf=null,cf=null,Hr}async function Bb(e){if(Hr!==void 0)return Hr;typeof e>"u"&&(e="/polygon-width/assets/backend_bg.wasm");const t=uE();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:r}=await lE(await e,t);return cE(n,r)}const fh=[];function wy(e,t){return{subscribe:go(e,t).subscribe}}function go(e,t=Xr){let n;const r=new Set;function a(u){if(Wn(e,u)&&(e=u,n)){const b=!fh.length;for(const C of r)C[1](),fh.push(C,e);if(b){for(let C=0;C<fh.length;C+=2)fh[C][0](fh[C+1]);fh.length=0}}}function c(u){a(u(e))}function f(u,b=Xr){const C=[u,b];return r.add(C),r.size===1&&(n=t(a,c)||Xr),u(e),()=>{r.delete(C),r.size===0&&n&&(n(),n=null)}}return{set:a,update:c,subscribe:f}}const hE=e=>({}),n1=e=>({}),pE=e=>({}),r1=e=>({});function fE(e){let t,n,r,a;const c=e[1].left,f=vo(c,e,e[0],r1),u=e[1].main,b=vo(u,e,e[0],n1);return{c(){t=Pe("div"),f&&f.c(),n=pn(),r=Pe("div"),b&&b.c(),cr(t,"class","left svelte-k43lgc"),cr(r,"class","main svelte-k43lgc")},m(C,A){Ve(C,t,A),f&&f.m(t,null),Ve(C,n,A),Ve(C,r,A),b&&b.m(r,null),a=!0},p(C,[A]){f&&f.p&&(!a||A&1)&&bo(f,c,C,C[0],a?xo(c,C[0],A,pE):wo(C[0]),r1),b&&b.p&&(!a||A&1)&&bo(b,u,C,C[0],a?xo(u,C[0],A,hE):wo(C[0]),n1)},i(C){a||(Zt(f,C),Zt(b,C),a=!0)},o(C){se(f,C),se(b,C),a=!1},d(C){C&&(Re(t),Re(n),Re(r)),f&&f.d(C),b&&b.d(C)}}}function dE(e,t,n){let{$$slots:r={},$$scope:a}=t;return e.$$set=c=>{"$$scope"in c&&n(0,a=c.$$scope)},[a,r]}class mE extends Lr{constructor(t){super(),Tr(this,t,dE,fE,Wn,{})}}const gE=e=>({dialog:e&1}),i1=e=>({dialog:e[0]});function yE(e){let t,n,r,a,c;const f=e[4].default,u=vo(f,e,e[3],i1);return{c(){t=Pe("dialog"),n=Pe("article"),u&&u.c(),t.open=!0},m(b,C){Ve(b,t,C),he(t,n),u&&u.m(n,null),e[6](t),r=!0,a||(c=[ei(window,"click",e[1]),ei(window,"keydown",e[2]),ei(t,"close",e[5])],a=!0)},p(b,[C]){u&&u.p&&(!r||C&9)&&bo(u,f,b,b[3],r?xo(f,b[3],C,gE):wo(b[3]),i1)},i(b){r||(Zt(u,b),r=!0)},o(b){se(u,b),r=!1},d(b){b&&Re(t),u&&u.d(b),e[6](null),a=!1,ls(c)}}}function _E(e,t,n){let{$$slots:r={},$$scope:a}=t,c;function f(A){c.open&&A.target==c&&c.close()}function u(A){(A.key=="Escape"||A.key=="Enter")&&(A.stopPropagation(),c.close())}function b(A){Rn.call(this,e,A)}function C(A){Fi[A?"unshift":"push"](()=>{c=A,n(0,c)})}return e.$$set=A=>{"$$scope"in A&&n(3,a=A.$$scope)},[c,f,u,a,r,b,C]}class vE extends Lr{constructor(t){super(),Tr(this,t,_E,yE,Wn,{})}}var Bf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function P_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Ym(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var a=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return e[r]}})}),n}var o1=Object.prototype.toString,Vb=function(t){var n=o1.call(t),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&o1.call(t.callee)==="[object Function]"),r},Sy,s1;function xE(){if(s1)return Sy;s1=1;var e;if(!Object.keys){var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=Vb,a=Object.prototype.propertyIsEnumerable,c=!a.call({toString:null},"toString"),f=a.call(function(){},"prototype"),u=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],b=function(k){var Y=k.constructor;return Y&&Y.prototype===k},C={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},A=function(){if(typeof window>"u")return!1;for(var k in window)try{if(!C["$"+k]&&t.call(window,k)&&window[k]!==null&&typeof window[k]=="object")try{b(window[k])}catch{return!0}}catch{return!0}return!1}(),P=function(k){if(typeof window>"u"||!A)return b(k);try{return b(k)}catch{return!1}};e=function(Y){var X=Y!==null&&typeof Y=="object",lt=n.call(Y)==="[object Function]",ht=r(Y),_t=X&&n.call(Y)==="[object String]",j=[];if(!X&&!lt&&!ht)throw new TypeError("Object.keys called on a non-object");var W=f&&lt;if(_t&&Y.length>0&&!t.call(Y,0))for(var st=0;st<Y.length;++st)j.push(String(st));if(ht&&Y.length>0)for(var gt=0;gt<Y.length;++gt)j.push(String(gt));else for(var Lt in Y)!(W&&Lt==="prototype")&&t.call(Y,Lt)&&j.push(String(Lt));if(c)for(var At=P(Y),Tt=0;Tt<u.length;++Tt)!(At&&u[Tt]==="constructor")&&t.call(Y,u[Tt])&&j.push(u[Tt]);return j}}return Sy=e,Sy}var bE=Array.prototype.slice,wE=Vb,a1=Object.keys,pm=a1?function(t){return a1(t)}:xE(),l1=Object.keys;pm.shim=function(){if(Object.keys){var t=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);t||(Object.keys=function(r){return wE(r)?l1(bE.call(r)):l1(r)})}else Object.keys=pm;return Object.keys||pm};var A_=pm,SE=Error,IE=EvalError,EE=RangeError,CE=ReferenceError,Ub=SyntaxError,pu=TypeError,TE=URIError,Km=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var a=42;t[n]=a;for(n in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var c=Object.getOwnPropertySymbols(t);if(c.length!==1||c[0]!==n||!Object.prototype.propertyIsEnumerable.call(t,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var f=Object.getOwnPropertyDescriptor(t,n);if(f.value!==a||f.enumerable!==!0)return!1}return!0},u1=typeof Symbol<"u"&&Symbol,LE=Km,M_=function(){return typeof u1!="function"||typeof Symbol!="function"||typeof u1("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:LE()},Iy={__proto__:null,foo:{}},PE=Object,AE=function(){return{__proto__:Iy}.foo===Iy.foo&&!(Iy instanceof PE)},ME="Function.prototype.bind called on incompatible ",DE=Object.prototype.toString,kE=Math.max,RE="[object Function]",c1=function(t,n){for(var r=[],a=0;a<t.length;a+=1)r[a]=t[a];for(var c=0;c<n.length;c+=1)r[c+t.length]=n[c];return r},NE=function(t,n){for(var r=[],a=n||0,c=0;a<t.length;a+=1,c+=1)r[c]=t[a];return r},OE=function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=t);return n},zE=function(t){var n=this;if(typeof n!="function"||DE.apply(n)!==RE)throw new TypeError(ME+n);for(var r=NE(arguments,1),a,c=function(){if(this instanceof a){var A=n.apply(this,c1(r,arguments));return Object(A)===A?A:this}return n.apply(t,c1(r,arguments))},f=kE(0,n.length-r.length),u=[],b=0;b<f;b++)u[b]="$"+b;if(a=Function("binder","return function ("+OE(u,",")+"){ return binder.apply(this,arguments); }")(c),n.prototype){var C=function(){};C.prototype=n.prototype,a.prototype=new C,C.prototype=null}return a},FE=zE,D_=Function.prototype.bind||FE,BE=Function.prototype.call,VE=Object.prototype.hasOwnProperty,UE=D_,Gb=UE.call(BE,VE),yn,GE=SE,qE=IE,jE=EE,WE=CE,Eh=Ub,Ih=pu,ZE=TE,qb=Function,Ey=function(e){try{return qb('"use strict"; return ('+e+").constructor;")()}catch{}},Wu=Object.getOwnPropertyDescriptor;if(Wu)try{Wu({},"")}catch{Wu=null}var Cy=function(){throw new Ih},HE=Wu?function(){try{return arguments.callee,Cy}catch{try{return Wu(arguments,"callee").get}catch{return Cy}}}():Cy,dh=M_(),XE=AE(),_i=Object.getPrototypeOf||(XE?function(e){return e.__proto__}:null),vh={},YE=typeof Uint8Array>"u"||!_i?yn:_i(Uint8Array),Zu={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?yn:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?yn:ArrayBuffer,"%ArrayIteratorPrototype%":dh&&_i?_i([][Symbol.iterator]()):yn,"%AsyncFromSyncIteratorPrototype%":yn,"%AsyncFunction%":vh,"%AsyncGenerator%":vh,"%AsyncGeneratorFunction%":vh,"%AsyncIteratorPrototype%":vh,"%Atomics%":typeof Atomics>"u"?yn:Atomics,"%BigInt%":typeof BigInt>"u"?yn:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?yn:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?yn:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?yn:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":GE,"%eval%":eval,"%EvalError%":qE,"%Float32Array%":typeof Float32Array>"u"?yn:Float32Array,"%Float64Array%":typeof Float64Array>"u"?yn:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?yn:FinalizationRegistry,"%Function%":qb,"%GeneratorFunction%":vh,"%Int8Array%":typeof Int8Array>"u"?yn:Int8Array,"%Int16Array%":typeof Int16Array>"u"?yn:Int16Array,"%Int32Array%":typeof Int32Array>"u"?yn:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":dh&&_i?_i(_i([][Symbol.iterator]())):yn,"%JSON%":typeof JSON=="object"?JSON:yn,"%Map%":typeof Map>"u"?yn:Map,"%MapIteratorPrototype%":typeof Map>"u"||!dh||!_i?yn:_i(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?yn:Promise,"%Proxy%":typeof Proxy>"u"?yn:Proxy,"%RangeError%":jE,"%ReferenceError%":WE,"%Reflect%":typeof Reflect>"u"?yn:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?yn:Set,"%SetIteratorPrototype%":typeof Set>"u"||!dh||!_i?yn:_i(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?yn:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":dh&&_i?_i(""[Symbol.iterator]()):yn,"%Symbol%":dh?Symbol:yn,"%SyntaxError%":Eh,"%ThrowTypeError%":HE,"%TypedArray%":YE,"%TypeError%":Ih,"%Uint8Array%":typeof Uint8Array>"u"?yn:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?yn:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?yn:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?yn:Uint32Array,"%URIError%":ZE,"%WeakMap%":typeof WeakMap>"u"?yn:WeakMap,"%WeakRef%":typeof WeakRef>"u"?yn:WeakRef,"%WeakSet%":typeof WeakSet>"u"?yn:WeakSet};if(_i)try{null.error}catch(e){var KE=_i(_i(e));Zu["%Error.prototype%"]=KE}var JE=function e(t){var n;if(t==="%AsyncFunction%")n=Ey("async function () {}");else if(t==="%GeneratorFunction%")n=Ey("function* () {}");else if(t==="%AsyncGeneratorFunction%")n=Ey("async function* () {}");else if(t==="%AsyncGenerator%"){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(t==="%AsyncIteratorPrototype%"){var a=e("%AsyncGenerator%");a&&_i&&(n=_i(a.prototype))}return Zu[t]=n,n},h1={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Vf=D_,Sm=Gb,QE=Vf.call(Function.call,Array.prototype.concat),$E=Vf.call(Function.apply,Array.prototype.splice),p1=Vf.call(Function.call,String.prototype.replace),Im=Vf.call(Function.call,String.prototype.slice),tC=Vf.call(Function.call,RegExp.prototype.exec),eC=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,nC=/\\(\\)?/g,rC=function(t){var n=Im(t,0,1),r=Im(t,-1);if(n==="%"&&r!=="%")throw new Eh("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new Eh("invalid intrinsic syntax, expected opening `%`");var a=[];return p1(t,eC,function(c,f,u,b){a[a.length]=u?p1(b,nC,"$1"):f||c}),a},iC=function(t,n){var r=t,a;if(Sm(h1,r)&&(a=h1[r],r="%"+a[0]+"%"),Sm(Zu,r)){var c=Zu[r];if(c===vh&&(c=JE(r)),typeof c>"u"&&!n)throw new Ih("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:a,name:r,value:c}}throw new Eh("intrinsic "+t+" does not exist!")},Ga=function(t,n){if(typeof t!="string"||t.length===0)throw new Ih("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new Ih('"allowMissing" argument must be a boolean');if(tC(/^%?[^%]*%?$/,t)===null)throw new Eh("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=rC(t),a=r.length>0?r[0]:"",c=iC("%"+a+"%",n),f=c.name,u=c.value,b=!1,C=c.alias;C&&(a=C[0],$E(r,QE([0,1],C)));for(var A=1,P=!0;A<r.length;A+=1){var k=r[A],Y=Im(k,0,1),X=Im(k,-1);if((Y==='"'||Y==="'"||Y==="`"||X==='"'||X==="'"||X==="`")&&Y!==X)throw new Eh("property names with quotes must have matching quotes");if((k==="constructor"||!P)&&(b=!0),a+="."+k,f="%"+a+"%",Sm(Zu,f))u=Zu[f];else if(u!=null){if(!(k in u)){if(!n)throw new Ih("base intrinsic for "+t+" exists, but the property is not available.");return}if(Wu&&A+1>=r.length){var lt=Wu(u,k);P=!!lt,P&&"get"in lt&&!("originalValue"in lt.get)?u=lt.get:u=u[k]}else P=Sm(u,k),u=u[k];P&&!b&&(Zu[f]=u)}}return u},Ty,f1;function k_(){if(f1)return Ty;f1=1;var e=Ga,t=e("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return Ty=t,Ty}var oC=Ga,fm=oC("%Object.getOwnPropertyDescriptor%",!0);if(fm)try{fm([],"length")}catch{fm=null}var R_=fm,d1=k_(),sC=Ub,mh=pu,m1=R_,N_=function(t,n,r){if(!t||typeof t!="object"&&typeof t!="function")throw new mh("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new mh("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new mh("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new mh("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new mh("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new mh("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,c=arguments.length>4?arguments[4]:null,f=arguments.length>5?arguments[5]:null,u=arguments.length>6?arguments[6]:!1,b=!!m1&&m1(t,n);if(d1)d1(t,n,{configurable:f===null&&b?b.configurable:!f,enumerable:a===null&&b?b.enumerable:!a,value:r,writable:c===null&&b?b.writable:!c});else if(u||!a&&!c&&!f)t[n]=r;else throw new sC("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},Yy=k_(),jb=function(){return!!Yy};jb.hasArrayLengthDefineBug=function(){if(!Yy)return null;try{return Yy([],"length",{value:1}).length!==1}catch{return!0}};var O_=jb,aC=A_,lC=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",uC=Object.prototype.toString,cC=Array.prototype.concat,g1=N_,hC=function(e){return typeof e=="function"&&uC.call(e)==="[object Function]"},Wb=O_(),pC=function(e,t,n,r){if(t in e){if(r===!0){if(e[t]===n)return}else if(!hC(r)||!r())return}Wb?g1(e,t,n,!0):g1(e,t,n)},Zb=function(e,t){var n=arguments.length>2?arguments[2]:{},r=aC(t);lC&&(r=cC.call(r,Object.getOwnPropertySymbols(t)));for(var a=0;a<r.length;a+=1)pC(e,r[a],t[r[a]],n[r[a]])};Zb.supportsDescriptors=!!Wb;var ac=Zb,Hb={exports:{}},fC=Ga,y1=N_,dC=O_(),_1=R_,v1=pu,mC=fC("%Math.floor%"),gC=function(t,n){if(typeof t!="function")throw new v1("`fn` is not a function");if(typeof n!="number"||n<0||n>4294967295||mC(n)!==n)throw new v1("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],a=!0,c=!0;if("length"in t&&_1){var f=_1(t,"length");f&&!f.configurable&&(a=!1),f&&!f.writable&&(c=!1)}return(a||c||!r)&&(dC?y1(t,"length",n,!0,!0):y1(t,"length",n)),t};(function(e){var t=D_,n=Ga,r=gC,a=pu,c=n("%Function.prototype.apply%"),f=n("%Function.prototype.call%"),u=n("%Reflect.apply%",!0)||t.call(f,c),b=k_(),C=n("%Math.max%");e.exports=function(k){if(typeof k!="function")throw new a("a function is required");var Y=u(t,f,arguments);return r(Y,1+C(0,k.length-(arguments.length-1)),!0)};var A=function(){return u(t,c,arguments)};b?b(e.exports,"apply",{value:A}):e.exports.apply=A})(Hb);var Hh=Hb.exports,Xb=Ga,Yb=Hh,yC=Yb(Xb("String.prototype.indexOf")),Vs=function(t,n){var r=Xb(t,!!n);return typeof r=="function"&&yC(t,".prototype.")>-1?Yb(r):r},_C=A_,Kb=Km(),Jb=Vs,x1=Object,vC=Jb("Array.prototype.push"),b1=Jb("Object.prototype.propertyIsEnumerable"),xC=Kb?Object.getOwnPropertySymbols:null,Qb=function(t,n){if(t==null)throw new TypeError("target must be an object");var r=x1(t);if(arguments.length===1)return r;for(var a=1;a<arguments.length;++a){var c=x1(arguments[a]),f=_C(c),u=Kb&&(Object.getOwnPropertySymbols||xC);if(u)for(var b=u(c),C=0;C<b.length;++C){var A=b[C];b1(c,A)&&vC(f,A)}for(var P=0;P<f.length;++P){var k=f[P];if(b1(c,k)){var Y=c[k];r[k]=Y}}}return r},Ly=Qb,bC=function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),n={},r=0;r<t.length;++r)n[t[r]]=t[r];var a=Object.assign({},n),c="";for(var f in a)c+=f;return e!==c},wC=function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch{return e[1]==="y"}return!1},$b=function(){return!Object.assign||bC()||wC()?Ly:Object.assign},SC=ac,IC=$b,EC=function(){var t=IC();return SC(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t},CC=ac,TC=Hh,LC=Qb,tw=$b,PC=EC,AC=TC.apply(tw()),ew=function(t,n){return AC(Object,arguments)};CC(ew,{getPolyfill:tw,implementation:LC,shim:PC});var MC=ew,bf=function(){return typeof(function(){}).name=="string"},gf=Object.getOwnPropertyDescriptor;if(gf)try{gf([],"length")}catch{gf=null}bf.functionsHaveConfigurableNames=function(){if(!bf()||!gf)return!1;var t=gf(function(){},"name");return!!t&&!!t.configurable};var DC=Function.prototype.bind;bf.boundFunctionsHaveNames=function(){return bf()&&typeof DC=="function"&&(function(){}).bind().name!==""};var kC=bf,w1=N_,RC=O_(),NC=kC.functionsHaveConfigurableNames(),OC=pu,zC=function(t,n){if(typeof t!="function")throw new OC("`fn` is not a function");var r=arguments.length>2&&!!arguments[2];return(!r||NC)&&(RC?w1(t,"name",n,!0,!0):w1(t,"name",n)),t},FC=zC,BC=pu,VC=Object,nw=FC(function(){if(this==null||this!==VC(this))throw new BC("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t},"get flags",!0),UC=nw,GC=ac.supportsDescriptors,qC=Object.getOwnPropertyDescriptor,rw=function(){if(GC&&/a/mig.flags==="gim"){var t=qC(RegExp.prototype,"flags");if(t&&typeof t.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var n="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){n+="d"}}),Object.defineProperty(r,"sticky",{get:function(){n+="y"}}),n==="dy")return t.get}}return UC},jC=ac.supportsDescriptors,WC=rw,ZC=Object.getOwnPropertyDescriptor,HC=Object.defineProperty,XC=TypeError,S1=Object.getPrototypeOf,YC=/a/,KC=function(){if(!jC||!S1)throw new XC("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=WC(),n=S1(YC),r=ZC(n,"flags");return(!r||r.get!==t)&&HC(n,"flags",{configurable:!0,enumerable:!1,get:t}),t},JC=ac,QC=Hh,$C=nw,iw=rw,tT=KC,ow=QC(iw());JC(ow,{getPolyfill:iw,implementation:$C,shim:tT});var eT=ow,dm={exports:{}},nT=Km,lc=function(){return nT()&&!!Symbol.toStringTag},rT=lc(),iT=Vs,Ky=iT("Object.prototype.toString"),Jm=function(t){return rT&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:Ky(t)==="[object Arguments]"},sw=function(t){return Jm(t)?!0:t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&Ky(t)!=="[object Array]"&&Ky(t.callee)==="[object Function]"},oT=function(){return Jm(arguments)}();Jm.isLegacyArguments=sw;var aw=oT?Jm:sw;const sT={},aT=Object.freeze(Object.defineProperty({__proto__:null,default:sT},Symbol.toStringTag,{value:"Module"})),lT=Ym(aT);var z_=typeof Map=="function"&&Map.prototype,Py=Object.getOwnPropertyDescriptor&&z_?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Em=z_&&Py&&typeof Py.get=="function"?Py.get:null,I1=z_&&Map.prototype.forEach,F_=typeof Set=="function"&&Set.prototype,Ay=Object.getOwnPropertyDescriptor&&F_?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Cm=F_&&Ay&&typeof Ay.get=="function"?Ay.get:null,E1=F_&&Set.prototype.forEach,uT=typeof WeakMap=="function"&&WeakMap.prototype,yf=uT?WeakMap.prototype.has:null,cT=typeof WeakSet=="function"&&WeakSet.prototype,_f=cT?WeakSet.prototype.has:null,hT=typeof WeakRef=="function"&&WeakRef.prototype,C1=hT?WeakRef.prototype.deref:null,pT=Boolean.prototype.valueOf,fT=Object.prototype.toString,dT=Function.prototype.toString,mT=String.prototype.match,B_=String.prototype.slice,Ql=String.prototype.replace,gT=String.prototype.toUpperCase,T1=String.prototype.toLowerCase,lw=RegExp.prototype.test,L1=Array.prototype.concat,Ra=Array.prototype.join,yT=Array.prototype.slice,P1=Math.floor,Jy=typeof BigInt=="function"?BigInt.prototype.valueOf:null,My=Object.getOwnPropertySymbols,Qy=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ch=typeof Symbol=="function"&&typeof Symbol.iterator=="object",to=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ch||"symbol")?Symbol.toStringTag:null,uw=Object.prototype.propertyIsEnumerable,A1=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function M1(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||lw.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var r=e<0?-P1(-e):P1(e);if(r!==e){var a=String(r),c=B_.call(t,a.length+1);return Ql.call(a,n,"$&_")+"."+Ql.call(Ql.call(c,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ql.call(t,n,"$&_")}var $y=lT,D1=$y.custom,k1=hw(D1)?D1:null,_T=function e(t,n,r,a){var c=n||{};if(Kl(c,"quoteStyle")&&c.quoteStyle!=="single"&&c.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Kl(c,"maxStringLength")&&(typeof c.maxStringLength=="number"?c.maxStringLength<0&&c.maxStringLength!==1/0:c.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var f=Kl(c,"customInspect")?c.customInspect:!0;if(typeof f!="boolean"&&f!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Kl(c,"indent")&&c.indent!==null&&c.indent!=="	"&&!(parseInt(c.indent,10)===c.indent&&c.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Kl(c,"numericSeparator")&&typeof c.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var u=c.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return fw(t,c);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var b=String(t);return u?M1(t,b):b}if(typeof t=="bigint"){var C=String(t)+"n";return u?M1(t,C):C}var A=typeof c.depth>"u"?5:c.depth;if(typeof r>"u"&&(r=0),r>=A&&A>0&&typeof t=="object")return t_(t)?"[Array]":"[Object]";var P=OT(c,r);if(typeof a>"u")a=[];else if(pw(a,t)>=0)return"[Circular]";function k(te,le,Xe){if(le&&(a=yT.call(a),a.push(le)),Xe){var De={depth:c.depth};return Kl(c,"quoteStyle")&&(De.quoteStyle=c.quoteStyle),e(te,De,r+1,a)}return e(te,c,r+1,a)}if(typeof t=="function"&&!R1(t)){var Y=TT(t),X=rm(t,k);return"[Function"+(Y?": "+Y:" (anonymous)")+"]"+(X.length>0?" { "+Ra.call(X,", ")+" }":"")}if(hw(t)){var lt=Ch?Ql.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):Qy.call(t);return typeof t=="object"&&!Ch?ef(lt):lt}if(kT(t)){for(var ht="<"+T1.call(String(t.nodeName)),_t=t.attributes||[],j=0;j<_t.length;j++)ht+=" "+_t[j].name+"="+cw(vT(_t[j].value),"double",c);return ht+=">",t.childNodes&&t.childNodes.length&&(ht+="..."),ht+="</"+T1.call(String(t.nodeName))+">",ht}if(t_(t)){if(t.length===0)return"[]";var W=rm(t,k);return P&&!NT(W)?"["+e_(W,P)+"]":"[ "+Ra.call(W,", ")+" ]"}if(bT(t)){var st=rm(t,k);return!("cause"in Error.prototype)&&"cause"in t&&!uw.call(t,"cause")?"{ ["+String(t)+"] "+Ra.call(L1.call("[cause]: "+k(t.cause),st),", ")+" }":st.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+Ra.call(st,", ")+" }"}if(typeof t=="object"&&f){if(k1&&typeof t[k1]=="function"&&$y)return $y(t,{depth:A-r});if(f!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(LT(t)){var gt=[];return I1&&I1.call(t,function(te,le){gt.push(k(le,t,!0)+" => "+k(te,t))}),N1("Map",Em.call(t),gt,P)}if(MT(t)){var Lt=[];return E1&&E1.call(t,function(te){Lt.push(k(te,t))}),N1("Set",Cm.call(t),Lt,P)}if(PT(t))return Dy("WeakMap");if(DT(t))return Dy("WeakSet");if(AT(t))return Dy("WeakRef");if(ST(t))return ef(k(Number(t)));if(ET(t))return ef(k(Jy.call(t)));if(IT(t))return ef(pT.call(t));if(wT(t))return ef(k(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===Bf)return"{ [object globalThis] }";if(!xT(t)&&!R1(t)){var At=rm(t,k),Tt=A1?A1(t)===Object.prototype:t instanceof Object||t.constructor===Object,Vt=t instanceof Object?"":"null prototype",Yt=!Tt&&to&&Object(t)===t&&to in t?B_.call(fu(t),8,-1):Vt?"Object":"",J=Tt||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",Ut=J+(Yt||Vt?"["+Ra.call(L1.call([],Yt||[],Vt||[]),": ")+"] ":"");return At.length===0?Ut+"{}":P?Ut+"{"+e_(At,P)+"}":Ut+"{ "+Ra.call(At,", ")+" }"}return String(t)};function cw(e,t,n){var r=(n.quoteStyle||t)==="double"?'"':"'";return r+e+r}function vT(e){return Ql.call(String(e),/"/g,"&quot;")}function t_(e){return fu(e)==="[object Array]"&&(!to||!(typeof e=="object"&&to in e))}function xT(e){return fu(e)==="[object Date]"&&(!to||!(typeof e=="object"&&to in e))}function R1(e){return fu(e)==="[object RegExp]"&&(!to||!(typeof e=="object"&&to in e))}function bT(e){return fu(e)==="[object Error]"&&(!to||!(typeof e=="object"&&to in e))}function wT(e){return fu(e)==="[object String]"&&(!to||!(typeof e=="object"&&to in e))}function ST(e){return fu(e)==="[object Number]"&&(!to||!(typeof e=="object"&&to in e))}function IT(e){return fu(e)==="[object Boolean]"&&(!to||!(typeof e=="object"&&to in e))}function hw(e){if(Ch)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!Qy)return!1;try{return Qy.call(e),!0}catch{}return!1}function ET(e){if(!e||typeof e!="object"||!Jy)return!1;try{return Jy.call(e),!0}catch{}return!1}var CT=Object.prototype.hasOwnProperty||function(e){return e in this};function Kl(e,t){return CT.call(e,t)}function fu(e){return fT.call(e)}function TT(e){if(e.name)return e.name;var t=mT.call(dT.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function pw(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function LT(e){if(!Em||!e||typeof e!="object")return!1;try{Em.call(e);try{Cm.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function PT(e){if(!yf||!e||typeof e!="object")return!1;try{yf.call(e,yf);try{_f.call(e,_f)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function AT(e){if(!C1||!e||typeof e!="object")return!1;try{return C1.call(e),!0}catch{}return!1}function MT(e){if(!Cm||!e||typeof e!="object")return!1;try{Cm.call(e);try{Em.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function DT(e){if(!_f||!e||typeof e!="object")return!1;try{_f.call(e,_f);try{yf.call(e,yf)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function kT(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function fw(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return fw(B_.call(e,0,t.maxStringLength),t)+r}var a=Ql.call(Ql.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,RT);return cw(a,"single",t)}function RT(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+gT.call(t.toString(16))}function ef(e){return"Object("+e+")"}function Dy(e){return e+" { ? }"}function N1(e,t,n,r){var a=r?e_(n,r):Ra.call(n,", ");return e+" ("+t+") {"+a+"}"}function NT(e){for(var t=0;t<e.length;t++)if(pw(e[t],`
`)>=0)return!1;return!0}function OT(e,t){var n;if(e.indent==="	")n="	";else if(typeof e.indent=="number"&&e.indent>0)n=Ra.call(Array(e.indent+1)," ");else return null;return{base:n,prev:Ra.call(Array(t+1),n)}}function e_(e,t){if(e.length===0)return"";var n=`
`+t.prev+t.base;return n+Ra.call(e,","+n)+`
`+t.prev}function rm(e,t){var n=t_(e),r=[];if(n){r.length=e.length;for(var a=0;a<e.length;a++)r[a]=Kl(e,a)?t(e[a],e):""}var c=typeof My=="function"?My(e):[],f;if(Ch){f={};for(var u=0;u<c.length;u++)f["$"+c[u]]=c[u]}for(var b in e)Kl(e,b)&&(n&&String(Number(b))===b&&b<e.length||Ch&&f["$"+b]instanceof Symbol||(lw.call(/[^\w$]/,b)?r.push(t(b,e)+": "+t(e[b],e)):r.push(b+": "+t(e[b],e))));if(typeof My=="function")for(var C=0;C<c.length;C++)uw.call(e,c[C])&&r.push("["+t(c[C])+"]: "+t(e[c[C]],e));return r}var dw=Ga,Xh=Vs,zT=_T,FT=pu,im=dw("%WeakMap%",!0),om=dw("%Map%",!0),BT=Xh("WeakMap.prototype.get",!0),VT=Xh("WeakMap.prototype.set",!0),UT=Xh("WeakMap.prototype.has",!0),GT=Xh("Map.prototype.get",!0),qT=Xh("Map.prototype.set",!0),jT=Xh("Map.prototype.has",!0),V_=function(e,t){for(var n=e,r;(r=n.next)!==null;n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r},WT=function(e,t){var n=V_(e,t);return n&&n.value},ZT=function(e,t,n){var r=V_(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}},HT=function(e,t){return!!V_(e,t)},mw=function(){var t,n,r,a={assert:function(c){if(!a.has(c))throw new FT("Side channel does not contain "+zT(c))},get:function(c){if(im&&c&&(typeof c=="object"||typeof c=="function")){if(t)return BT(t,c)}else if(om){if(n)return GT(n,c)}else if(r)return WT(r,c)},has:function(c){if(im&&c&&(typeof c=="object"||typeof c=="function")){if(t)return UT(t,c)}else if(om){if(n)return jT(n,c)}else if(r)return HT(r,c);return!1},set:function(c,f){im&&c&&(typeof c=="object"||typeof c=="function")?(t||(t=new im),VT(t,c,f)):om?(n||(n=new om),qT(n,c,f)):(r||(r={key:{},next:null}),ZT(r,c,f))}};return a},XT=Gb,nf=mw(),ll=pu,U_={assert:function(e,t){if(!e||typeof e!="object"&&typeof e!="function")throw new ll("`O` is not an object");if(typeof t!="string")throw new ll("`slot` must be a string");if(nf.assert(e),!U_.has(e,t))throw new ll("`"+t+"` is not present on `O`")},get:function(e,t){if(!e||typeof e!="object"&&typeof e!="function")throw new ll("`O` is not an object");if(typeof t!="string")throw new ll("`slot` must be a string");var n=nf.get(e);return n&&n["$"+t]},has:function(e,t){if(!e||typeof e!="object"&&typeof e!="function")throw new ll("`O` is not an object");if(typeof t!="string")throw new ll("`slot` must be a string");var n=nf.get(e);return!!n&&XT(n,"$"+t)},set:function(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new ll("`O` is not an object");if(typeof t!="string")throw new ll("`slot` must be a string");var r=nf.get(e);r||(r={},nf.set(e,r)),r["$"+t]=n}};Object.freeze&&Object.freeze(U_);var YT=U_,rf=YT,KT=SyntaxError,O1=typeof StopIteration=="object"?StopIteration:null,JT=function(t){if(!O1)throw new KT("this environment lacks StopIteration");rf.set(t,"[[Done]]",!1);var n={next:function(){var a=rf.get(this,"[[Iterator]]"),c=rf.get(a,"[[Done]]");try{return{done:c,value:c?void 0:a.next()}}catch(f){if(rf.set(a,"[[Done]]",!0),f!==O1)throw f;return{done:!0,value:void 0}}}};return rf.set(n,"[[Iterator]]",t),n},QT={}.toString,gw=Array.isArray||function(e){return QT.call(e)=="[object Array]"},$T=String.prototype.valueOf,tL=function(t){try{return $T.call(t),!0}catch{return!1}},eL=Object.prototype.toString,nL="[object String]",rL=lc(),yw=function(t){return typeof t=="string"?!0:typeof t!="object"?!1:rL?tL(t):eL.call(t)===nL},G_=typeof Map=="function"&&Map.prototype?Map:null,iL=typeof Set=="function"&&Set.prototype?Set:null,Tm;G_||(Tm=function(t){return!1});var _w=G_?Map.prototype.has:null,z1=iL?Set.prototype.has:null;!Tm&&!_w&&(Tm=function(t){return!1});var vw=Tm||function(t){if(!t||typeof t!="object")return!1;try{if(_w.call(t),z1)try{z1.call(t)}catch{return!0}return t instanceof G_}catch{}return!1},oL=typeof Map=="function"&&Map.prototype?Map:null,q_=typeof Set=="function"&&Set.prototype?Set:null,Lm;q_||(Lm=function(t){return!1});var F1=oL?Map.prototype.has:null,xw=q_?Set.prototype.has:null;!Lm&&!xw&&(Lm=function(t){return!1});var bw=Lm||function(t){if(!t||typeof t!="object")return!1;try{if(xw.call(t),F1)try{F1.call(t)}catch{return!0}return t instanceof q_}catch{}return!1},B1=aw,V1=JT;if(M_()||Km()){var ky=Symbol.iterator;dm.exports=function(t){if(t!=null&&typeof t[ky]<"u")return t[ky]();if(B1(t))return Array.prototype[ky].call(t)}}else{var sL=gw,aL=yw,U1=Ga,lL=U1("%Map%",!0),uL=U1("%Set%",!0),Ks=Vs,G1=Ks("Array.prototype.push"),q1=Ks("String.prototype.charCodeAt"),cL=Ks("String.prototype.slice"),hL=function(t,n){var r=t.length;if(n+1>=r)return n+1;var a=q1(t,n);if(a<55296||a>56319)return n+1;var c=q1(t,n+1);return c<56320||c>57343?n+1:n+2},Ry=function(t){var n=0;return{next:function(){var a=n>=t.length,c;return a||(c=t[n],n+=1),{done:a,value:c}}}},j1=function(t,n){if(sL(t)||B1(t))return Ry(t);if(aL(t)){var r=0;return{next:function(){var c=hL(t,r),f=cL(t,r,c);return r=c,{done:c>t.length,value:f}}}}if(n&&typeof t["_es6-shim iterator_"]<"u")return t["_es6-shim iterator_"]()};if(!lL&&!uL)dm.exports=function(t){if(t!=null)return j1(t,!0)};else{var pL=vw,fL=bw,W1=Ks("Map.prototype.forEach",!0),Z1=Ks("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var H1=Ks("Map.prototype.iterator",!0),X1=Ks("Set.prototype.iterator",!0);var Y1=Ks("Map.prototype.@@iterator",!0)||Ks("Map.prototype._es6-shim iterator_",!0),K1=Ks("Set.prototype.@@iterator",!0)||Ks("Set.prototype._es6-shim iterator_",!0),dL=function(t){if(pL(t)){if(H1)return V1(H1(t));if(Y1)return Y1(t);if(W1){var n=[];return W1(t,function(a,c){G1(n,[c,a])}),Ry(n)}}if(fL(t)){if(X1)return V1(X1(t));if(K1)return K1(t);if(Z1){var r=[];return Z1(t,function(a){G1(r,a)}),Ry(r)}}};dm.exports=function(t){return dL(t)||j1(t)}}}var mL=dm.exports,J1=function(e){return e!==e},ww=function(t,n){return t===0&&n===0?1/t===1/n:!!(t===n||J1(t)&&J1(n))},gL=ww,Sw=function(){return typeof Object.is=="function"?Object.is:gL},yL=Sw,_L=ac,vL=function(){var t=yL();return _L(Object,{is:t},{is:function(){return Object.is!==t}}),t},xL=ac,bL=Hh,wL=ww,Iw=Sw,SL=vL,Ew=bL(Iw(),Object);xL(Ew,{getPolyfill:Iw,implementation:wL,shim:SL});var IL=Ew,EL=Hh,Cw=Vs,CL=Ga,n_=CL("%ArrayBuffer%",!0),mm=Cw("ArrayBuffer.prototype.byteLength",!0),TL=Cw("Object.prototype.toString"),Q1=!!n_&&!mm&&new n_(0).slice,$1=!!Q1&&EL(Q1),Tw=mm||$1?function(t){if(!t||typeof t!="object")return!1;try{return mm?mm(t):$1(t,0),!0}catch{return!1}}:n_?function(t){return TL(t)==="[object ArrayBuffer]"}:function(t){return!1},LL=Date.prototype.getDay,PL=function(t){try{return LL.call(t),!0}catch{return!1}},AL=Object.prototype.toString,ML="[object Date]",DL=lc(),kL=function(t){return typeof t!="object"||t===null?!1:DL?PL(t):AL.call(t)===ML},r_=Vs,Lw=lc(),Pw,Aw,i_,o_;if(Lw){Pw=r_("Object.prototype.hasOwnProperty"),Aw=r_("RegExp.prototype.exec"),i_={};var Ny=function(){throw i_};o_={toString:Ny,valueOf:Ny},typeof Symbol.toPrimitive=="symbol"&&(o_[Symbol.toPrimitive]=Ny)}var RL=r_("Object.prototype.toString"),NL=Object.getOwnPropertyDescriptor,OL="[object RegExp]",zL=Lw?function(t){if(!t||typeof t!="object")return!1;var n=NL(t,"lastIndex"),r=n&&Pw(n,"value");if(!r)return!1;try{Aw(t,o_)}catch(a){return a===i_}}:function(t){return!t||typeof t!="object"&&typeof t!="function"?!1:RL(t)===OL},FL=Vs,tx=FL("SharedArrayBuffer.prototype.byteLength",!0),BL=tx?function(t){if(!t||typeof t!="object")return!1;try{return tx(t),!0}catch{return!1}}:function(t){return!1},VL=Number.prototype.toString,UL=function(t){try{return VL.call(t),!0}catch{return!1}},GL=Object.prototype.toString,qL="[object Number]",jL=lc(),WL=function(t){return typeof t=="number"?!0:typeof t!="object"?!1:jL?UL(t):GL.call(t)===qL},Mw=Vs,ZL=Mw("Boolean.prototype.toString"),HL=Mw("Object.prototype.toString"),XL=function(t){try{return ZL(t),!0}catch{return!1}},YL="[object Boolean]",KL=lc(),JL=function(t){return typeof t=="boolean"?!0:t===null||typeof t!="object"?!1:KL&&Symbol.toStringTag in t?XL(t):HL(t)===YL},s_={exports:{}},QL=Object.prototype.toString,$L=M_();if($L){var tP=Symbol.prototype.toString,eP=/^Symbol\(.*\)$/,nP=function(t){return typeof t.valueOf()!="symbol"?!1:eP.test(tP.call(t))};s_.exports=function(t){if(typeof t=="symbol")return!0;if(QL.call(t)!=="[object Symbol]")return!1;try{return nP(t)}catch{return!1}}}else s_.exports=function(t){return!1};var rP=s_.exports,a_={exports:{}},ex=typeof BigInt<"u"&&BigInt,iP=function(){return typeof ex=="function"&&typeof BigInt=="function"&&typeof ex(42)=="bigint"&&typeof BigInt(42)=="bigint"},oP=iP();if(oP){var sP=BigInt.prototype.valueOf,aP=function(t){try{return sP.call(t),!0}catch{}return!1};a_.exports=function(t){return t===null||typeof t>"u"||typeof t=="boolean"||typeof t=="string"||typeof t=="number"||typeof t=="symbol"||typeof t=="function"?!1:typeof t=="bigint"?!0:aP(t)}}else a_.exports=function(t){return!1};var lP=a_.exports,uP=yw,cP=WL,hP=JL,pP=rP,fP=lP,dP=function(t){if(t==null||typeof t!="object"&&typeof t!="function")return null;if(uP(t))return"String";if(cP(t))return"Number";if(hP(t))return"Boolean";if(pP(t))return"Symbol";if(fP(t))return"BigInt"},Pm=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,nx=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,Am;Pm||(Am=function(t){return!1});var l_=Pm?Pm.prototype.has:null,Oy=nx?nx.prototype.has:null;!Am&&!l_&&(Am=function(t){return!1});var mP=Am||function(t){if(!t||typeof t!="object")return!1;try{if(l_.call(t,l_),Oy)try{Oy.call(t,Oy)}catch{return!0}return t instanceof Pm}catch{}return!1},u_={exports:{}},gP=Ga,Dw=Vs,yP=gP("%WeakSet%",!0),zy=Dw("WeakSet.prototype.has",!0);if(zy){var Fy=Dw("WeakMap.prototype.has",!0);u_.exports=function(t){if(!t||typeof t!="object")return!1;try{if(zy(t,zy),Fy)try{Fy(t,Fy)}catch{return!0}return t instanceof yP}catch{}return!1}}else u_.exports=function(t){return!1};var _P=u_.exports,vP=vw,xP=bw,bP=mP,wP=_P,SP=function(t){if(t&&typeof t=="object"){if(vP(t))return"Map";if(xP(t))return"Set";if(bP(t))return"WeakMap";if(wP(t))return"WeakSet"}return!1},kw=Function.prototype.toString,xh=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,c_,gm;if(typeof xh=="function"&&typeof Object.defineProperty=="function")try{c_=Object.defineProperty({},"length",{get:function(){throw gm}}),gm={},xh(function(){throw 42},null,c_)}catch(e){e!==gm&&(xh=null)}else xh=null;var IP=/^\s*class\b/,h_=function(t){try{var n=kw.call(t);return IP.test(n)}catch{return!1}},By=function(t){try{return h_(t)?!1:(kw.call(t),!0)}catch{return!1}},ym=Object.prototype.toString,EP="[object Object]",CP="[object Function]",TP="[object GeneratorFunction]",LP="[object HTMLAllCollection]",PP="[object HTML document.all class]",AP="[object HTMLCollection]",MP=typeof Symbol=="function"&&!!Symbol.toStringTag,DP=!(0 in[,]),p_=function(){return!1};if(typeof document=="object"){var kP=document.all;ym.call(kP)===ym.call(document.all)&&(p_=function(t){if((DP||!t)&&(typeof t>"u"||typeof t=="object"))try{var n=ym.call(t);return(n===LP||n===PP||n===AP||n===EP)&&t("")==null}catch{}return!1})}var RP=xh?function(t){if(p_(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{xh(t,null,c_)}catch(n){if(n!==gm)return!1}return!h_(t)&&By(t)}:function(t){if(p_(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(MP)return By(t);if(h_(t))return!1;var n=ym.call(t);return n!==CP&&n!==TP&&!/^\[object HTML/.test(n)?!1:By(t)},NP=RP,OP=Object.prototype.toString,Rw=Object.prototype.hasOwnProperty,zP=function(t,n,r){for(var a=0,c=t.length;a<c;a++)Rw.call(t,a)&&(r==null?n(t[a],a,t):n.call(r,t[a],a,t))},FP=function(t,n,r){for(var a=0,c=t.length;a<c;a++)r==null?n(t.charAt(a),a,t):n.call(r,t.charAt(a),a,t)},BP=function(t,n,r){for(var a in t)Rw.call(t,a)&&(r==null?n(t[a],a,t):n.call(r,t[a],a,t))},VP=function(t,n,r){if(!NP(n))throw new TypeError("iterator must be a function");var a;arguments.length>=3&&(a=r),OP.call(t)==="[object Array]"?zP(t,n,a):typeof t=="string"?FP(t,n,a):BP(t,n,a)},UP=VP,GP=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],Vy=GP,qP=typeof globalThis>"u"?Bf:globalThis,jP=function(){for(var t=[],n=0;n<Vy.length;n++)typeof qP[Vy[n]]=="function"&&(t[t.length]=Vy[n]);return t},Mm=UP,WP=jP,rx=Hh,j_=Vs,_m=R_,ZP=j_("Object.prototype.toString"),Nw=lc(),ix=typeof globalThis>"u"?Bf:globalThis,f_=WP(),W_=j_("String.prototype.slice"),Uy=Object.getPrototypeOf,HP=j_("Array.prototype.indexOf",!0)||function(t,n){for(var r=0;r<t.length;r+=1)if(t[r]===n)return r;return-1},Dm={__proto__:null};Nw&&_m&&Uy?Mm(f_,function(e){var t=new ix[e];if(Symbol.toStringTag in t){var n=Uy(t),r=_m(n,Symbol.toStringTag);if(!r){var a=Uy(n);r=_m(a,Symbol.toStringTag)}Dm["$"+e]=rx(r.get)}}):Mm(f_,function(e){var t=new ix[e],n=t.slice||t.set;n&&(Dm["$"+e]=rx(n))});var XP=function(t){var n=!1;return Mm(Dm,function(r,a){if(!n)try{"$"+r(t)===a&&(n=W_(a,1))}catch{}}),n},YP=function(t){var n=!1;return Mm(Dm,function(r,a){if(!n)try{r(t),n=W_(a,1)}catch{}}),n},KP=function(t){if(!t||typeof t!="object")return!1;if(!Nw){var n=W_(ZP(t),8,-1);return HP(f_,n)>-1?n:n!=="Object"?!1:YP(t)}return _m?XP(t):null},JP=Vs,ox=JP("ArrayBuffer.prototype.byteLength",!0),QP=Tw,$P=function(t){return QP(t)?ox?ox(t):t.byteLength:NaN},Ow=MC,qa=Vs,sx=eT,tA=Ga,Th=mL,eA=mw,ax=IL,lx=aw,ux=gw,cx=Tw,hx=kL,px=zL,fx=BL,dx=A_,mx=dP,gx=SP,yx=KP,_x=$P,vx=qa("SharedArrayBuffer.prototype.byteLength",!0),xx=qa("Date.prototype.getTime"),Gy=Object.getPrototypeOf,bx=qa("Object.prototype.toString"),km=tA("%Set%",!0),d_=qa("Map.prototype.has",!0),Rm=qa("Map.prototype.get",!0),wx=qa("Map.prototype.size",!0),Nm=qa("Set.prototype.add",!0),zw=qa("Set.prototype.delete",!0),Om=qa("Set.prototype.has",!0),vm=qa("Set.prototype.size",!0);function Sx(e,t,n,r){for(var a=Th(e),c;(c=a.next())&&!c.done;)if(na(t,c.value,n,r))return zw(e,c.value),!0;return!1}function Fw(e){if(typeof e>"u")return null;if(typeof e!="object")return typeof e=="symbol"?!1:typeof e=="string"||typeof e=="number"?+e==+e:!0}function nA(e,t,n,r,a,c){var f=Fw(n);if(f!=null)return f;var u=Rm(t,f),b=Ow({},a,{strict:!1});return typeof u>"u"&&!d_(t,f)||!na(r,u,b,c)?!1:!d_(e,f)&&na(r,u,b,c)}function rA(e,t,n){var r=Fw(n);return r??(Om(t,r)&&!Om(e,r))}function Ix(e,t,n,r,a,c){for(var f=Th(e),u,b;(u=f.next())&&!u.done;)if(b=u.value,na(n,b,a,c)&&na(r,Rm(t,b),a,c))return zw(e,b),!0;return!1}function na(e,t,n,r){var a=n||{};if(a.strict?ax(e,t):e===t)return!0;var c=mx(e),f=mx(t);if(c!==f)return!1;if(!e||!t||typeof e!="object"&&typeof t!="object")return a.strict?ax(e,t):e==t;var u=r.has(e),b=r.has(t),C;if(u&&b){if(r.get(e)===r.get(t))return!0}else C={};return u||r.set(e,C),b||r.set(t,C),sA(e,t,a,r)}function Ex(e){return!e||typeof e!="object"||typeof e.length!="number"||typeof e.copy!="function"||typeof e.slice!="function"||e.length>0&&typeof e[0]!="number"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function iA(e,t,n,r){if(vm(e)!==vm(t))return!1;for(var a=Th(e),c=Th(t),f,u,b;(f=a.next())&&!f.done;)if(f.value&&typeof f.value=="object")b||(b=new km),Nm(b,f.value);else if(!Om(t,f.value)){if(n.strict||!rA(e,t,f.value))return!1;b||(b=new km),Nm(b,f.value)}if(b){for(;(u=c.next())&&!u.done;)if(u.value&&typeof u.value=="object"){if(!Sx(b,u.value,n.strict,r))return!1}else if(!n.strict&&!Om(e,u.value)&&!Sx(b,u.value,n.strict,r))return!1;return vm(b)===0}return!0}function oA(e,t,n,r){if(wx(e)!==wx(t))return!1;for(var a=Th(e),c=Th(t),f,u,b,C,A,P;(f=a.next())&&!f.done;)if(C=f.value[0],A=f.value[1],C&&typeof C=="object")b||(b=new km),Nm(b,C);else if(P=Rm(t,C),typeof P>"u"&&!d_(t,C)||!na(A,P,n,r)){if(n.strict||!nA(e,t,C,A,n,r))return!1;b||(b=new km),Nm(b,C)}if(b){for(;(u=c.next())&&!u.done;)if(C=u.value[0],P=u.value[1],C&&typeof C=="object"){if(!Ix(b,e,C,P,n,r))return!1}else if(!n.strict&&(!e.has(C)||!na(Rm(e,C),P,n,r))&&!Ix(b,e,C,P,Ow({},n,{strict:!1}),r))return!1;return vm(b)===0}return!0}function sA(e,t,n,r){var a,c;if(typeof e!=typeof t||e==null||t==null||bx(e)!==bx(t)||lx(e)!==lx(t))return!1;var f=ux(e),u=ux(t);if(f!==u)return!1;var b=e instanceof Error,C=t instanceof Error;if(b!==C||(b||C)&&(e.name!==t.name||e.message!==t.message))return!1;var A=px(e),P=px(t);if(A!==P||(A||P)&&(e.source!==t.source||sx(e)!==sx(t)))return!1;var k=hx(e),Y=hx(t);if(k!==Y||(k||Y)&&xx(e)!==xx(t)||n.strict&&Gy&&Gy(e)!==Gy(t))return!1;var X=yx(e),lt=yx(t);if(X!==lt)return!1;if(X||lt){if(e.length!==t.length)return!1;for(a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}var ht=Ex(e),_t=Ex(t);if(ht!==_t)return!1;if(ht||_t){if(e.length!==t.length)return!1;for(a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}var j=cx(e),W=cx(t);if(j!==W)return!1;if(j||W)return _x(e)!==_x(t)?!1:typeof Uint8Array=="function"&&na(new Uint8Array(e),new Uint8Array(t),n,r);var st=fx(e),gt=fx(t);if(st!==gt)return!1;if(st||gt)return vx(e)!==vx(t)?!1:typeof Uint8Array=="function"&&na(new Uint8Array(e),new Uint8Array(t),n,r);if(typeof e!=typeof t)return!1;var Lt=dx(e),At=dx(t);if(Lt.length!==At.length)return!1;for(Lt.sort(),At.sort(),a=Lt.length-1;a>=0;a--)if(Lt[a]!=At[a])return!1;for(a=Lt.length-1;a>=0;a--)if(c=Lt[a],!na(e[c],t[c],n,r))return!1;var Tt=gx(e),Vt=gx(t);return Tt!==Vt?!1:Tt==="Set"||Vt==="Set"?iA(e,t,n,r):Tt==="Map"?oA(e,t,n,r):!0}var aA=function(t,n,r){return na(t,n,r,eA())};const lA=P_(aA);var uA=Object.defineProperty,Vn=(e,t)=>uA(e,"name",{value:t,configurable:!0}),cA=class{constructor(t){this.direction=!1,this.compareProperties=!0;var n,r,a;this.precision=10**-((n=t==null?void 0:t.precision)!=null?n:17),this.direction=(r=t==null?void 0:t.direction)!=null?r:!1,this.compareProperties=(a=t==null?void 0:t.compareProperties)!=null?a:!0}compare(t,n){if(t.type!==n.type||!pf(t,n))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,n.coordinates);case"LineString":return this.compareLine(t.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(t,n);case"GeometryCollection":return this.compareGeometryCollection(t,n);case"Feature":return this.compareFeature(t,n);case"FeatureCollection":return this.compareFeatureCollection(t,n);default:if(t.type.startsWith("Multi")){const r=m_(t),a=m_(n);return r.every(c=>a.some(f=>this.compare(c,f)))}}return!1}compareCoord(t,n){return t.length===n.length&&t.every((r,a)=>Math.abs(r-n[a])<this.precision)}compareLine(t,n,r=0,a=!1){if(!pf(t,n))return!1;const c=t;let f=n;if(a&&!this.compareCoord(c[0],f[0])){const b=this.fixStartIndex(f,c);if(b)f=b;else return!1}const u=this.compareCoord(c[r],f[r]);return this.direction||u?this.comparePath(c,f):this.compareCoord(c[r],f[f.length-(1+r)])?this.comparePath(c.slice().reverse(),f):!1}fixStartIndex(t,n){let r,a=-1;for(let c=0;c<t.length;c++)if(this.compareCoord(t[c],n[0])){a=c;break}return a>=0&&(r=[].concat(t.slice(a,t.length),t.slice(1,a+1))),r}comparePath(t,n){return t.every((r,a)=>this.compareCoord(r,n[a]))}comparePolygon(t,n){if(this.compareLine(t.coordinates[0],n.coordinates[0],1,!0)){const r=t.coordinates.slice(1,t.coordinates.length),a=n.coordinates.slice(1,n.coordinates.length);return r.every(c=>a.some(f=>this.compareLine(c,f,1,!0)))}return!1}compareGeometryCollection(t,n){return pf(t.geometries,n.geometries)&&this.compareBBox(t,n)&&t.geometries.every((r,a)=>this.compare(r,n.geometries[a]))}compareFeature(t,n){return t.id===n.id&&(this.compareProperties?lA(t.properties,n.properties):!0)&&this.compareBBox(t,n)&&this.compare(t.geometry,n.geometry)}compareFeatureCollection(t,n){return pf(t.features,n.features)&&this.compareBBox(t,n)&&t.features.every((r,a)=>this.compare(r,n.features[a]))}compareBBox(t,n){return!t.bbox&&!n.bbox||(t.bbox&&n.bbox?this.compareCoord(t.bbox,n.bbox):!1)}};Vn(cA,"GeojsonEquality");function pf(e,t){return e.coordinates?e.coordinates.length===t.coordinates.length:e.length===t.length}Vn(pf,"sameLength");function m_(e){return e.coordinates.map(t=>({type:e.type.replace("Multi",""),coordinates:t}))}Vn(m_,"explode");var Qo=63710088e-1,Bw={centimeters:Qo*100,centimetres:Qo*100,degrees:360/(2*Math.PI),feet:Qo*3.28084,inches:Qo*39.37,kilometers:Qo/1e3,kilometres:Qo/1e3,meters:Qo,metres:Qo,miles:Qo/1609.344,millimeters:Qo*1e3,millimetres:Qo*1e3,nauticalmiles:Qo/1852,radians:1,yards:Qo*1.0936},Cx={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Oa(e,t,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}Vn(Oa,"feature");function hA(e,t,n={}){switch(e){case"Point":return hl(t).geometry;case"LineString":return fl(t).geometry;case"Polygon":return Z_(t).geometry;case"MultiPoint":return Uw(t).geometry;case"MultiLineString":return Vw(t).geometry;case"MultiPolygon":return Gw(t).geometry;default:throw new Error(e+" is invalid")}}Vn(hA,"geometry");function hl(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!zm(e[0])||!zm(e[1]))throw new Error("coordinates must contain numbers");return Oa({type:"Point",coordinates:e},t,n)}Vn(hl,"point");function pA(e,t,n={}){return Qm(e.map(r=>hl(r,t)),n)}Vn(pA,"points");function Z_(e,t,n={}){for(const a of e){if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(a[a.length-1].length!==a[0].length)throw new Error("First and last Position are not equivalent.");for(let c=0;c<a[a.length-1].length;c++)if(a[a.length-1][c]!==a[0][c])throw new Error("First and last Position are not equivalent.")}return Oa({type:"Polygon",coordinates:e},t,n)}Vn(Z_,"polygon");function fA(e,t,n={}){return Qm(e.map(r=>Z_(r,t)),n)}Vn(fA,"polygons");function fl(e,t,n={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return Oa({type:"LineString",coordinates:e},t,n)}Vn(fl,"lineString");function dA(e,t,n={}){return Qm(e.map(r=>fl(r,t)),n)}Vn(dA,"lineStrings");function Qm(e,t={}){const n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}Vn(Qm,"featureCollection");function Vw(e,t,n={}){return Oa({type:"MultiLineString",coordinates:e},t,n)}Vn(Vw,"multiLineString");function Uw(e,t,n={}){return Oa({type:"MultiPoint",coordinates:e},t,n)}Vn(Uw,"multiPoint");function Gw(e,t,n={}){return Oa({type:"MultiPolygon",coordinates:e},t,n)}Vn(Gw,"multiPolygon");function mA(e,t,n={}){return Oa({type:"GeometryCollection",geometries:e},t,n)}Vn(mA,"geometryCollection");function gA(e,t=0){if(t&&!(t>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,t||0);return Math.round(e*n)/n}Vn(gA,"round");function qw(e,t="kilometers"){const n=Bw[t];if(!n)throw new Error(t+" units is invalid");return e*n}Vn(qw,"radiansToLength");function H_(e,t="kilometers"){const n=Bw[t];if(!n)throw new Error(t+" units is invalid");return e/n}Vn(H_,"lengthToRadians");function yA(e,t){return jw(H_(e,t))}Vn(yA,"lengthToDegrees");function _A(e){let t=e%360;return t<0&&(t+=360),t}Vn(_A,"bearingToAzimuth");function jw(e){return e%(2*Math.PI)*180/Math.PI}Vn(jw,"radiansToDegrees");function vA(e){return e%360*Math.PI/180}Vn(vA,"degreesToRadians");function xA(e,t="kilometers",n="kilometers"){if(!(e>=0))throw new Error("length must be a positive number");return qw(H_(e,t),n)}Vn(xA,"convertLength");function bA(e,t="meters",n="kilometers"){if(!(e>=0))throw new Error("area must be a positive number");const r=Cx[t];if(!r)throw new Error("invalid original units");const a=Cx[n];if(!a)throw new Error("invalid final units");return e/r*a}Vn(bA,"convertArea");function zm(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}Vn(zm,"isNumber");function X_(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}Vn(X_,"isObject");function wA(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(t=>{if(!zm(t))throw new Error("bbox must only contain numbers")})}Vn(wA,"validateBBox");function SA(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}Vn(SA,"validateId");var IA=Object.defineProperty,Gi=(e,t)=>IA(e,"name",{value:t,configurable:!0});function Yh(e,t,n){if(e!==null)for(var r,a,c,f,u,b,C,A=0,P=0,k,Y=e.type,X=Y==="FeatureCollection",lt=Y==="Feature",ht=X?e.features.length:1,_t=0;_t<ht;_t++){C=X?e.features[_t].geometry:lt?e.geometry:e,k=C?C.type==="GeometryCollection":!1,u=k?C.geometries.length:1;for(var j=0;j<u;j++){var W=0,st=0;if(f=k?C.geometries[j]:C,f!==null){b=f.coordinates;var gt=f.type;switch(A=n&&(gt==="Polygon"||gt==="MultiPolygon")?1:0,gt){case null:break;case"Point":if(t(b,P,_t,W,st)===!1)return!1;P++,W++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],P,_t,W,st)===!1)return!1;P++,gt==="MultiPoint"&&W++}gt==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],P,_t,W,st)===!1)return!1;P++}gt==="MultiLineString"&&W++,gt==="Polygon"&&st++}gt==="Polygon"&&W++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(st=0,a=0;a<b[r].length;a++){for(c=0;c<b[r][a].length-A;c++){if(t(b[r][a][c],P,_t,W,st)===!1)return!1;P++}st++}W++}break;case"GeometryCollection":for(r=0;r<f.geometries.length;r++)if(Yh(f.geometries[r],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}Gi(Yh,"coordEach");function EA(e,t,n,r){var a=n;return Yh(e,function(c,f,u,b,C){f===0&&n===void 0?a=c:a=t(a,c,f,u,b,C)},r),a}Gi(EA,"coordReduce");function Ww(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&t(e.features[n].properties,n)!==!1;n++);break;case"Feature":t(e.properties,0);break}}Gi(Ww,"propEach");function CA(e,t,n){var r=n;return Ww(e,function(a,c){c===0&&n===void 0?r=a:r=t(r,a,c)}),r}Gi(CA,"propReduce");function Zw(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}Gi(Zw,"featureEach");function TA(e,t,n){var r=n;return Zw(e,function(a,c){c===0&&n===void 0?r=a:r=t(r,a,c)}),r}Gi(TA,"featureReduce");function LA(e){var t=[];return Yh(e,function(n){t.push(n)}),t}Gi(LA,"coordAll");function Y_(e,t){var n,r,a,c,f,u,b,C,A,P,k=0,Y=e.type==="FeatureCollection",X=e.type==="Feature",lt=Y?e.features.length:1;for(n=0;n<lt;n++){for(u=Y?e.features[n].geometry:X?e.geometry:e,C=Y?e.features[n].properties:X?e.properties:{},A=Y?e.features[n].bbox:X?e.bbox:void 0,P=Y?e.features[n].id:X?e.id:void 0,b=u?u.type==="GeometryCollection":!1,f=b?u.geometries.length:1,a=0;a<f;a++){if(c=b?u.geometries[a]:u,c===null){if(t(null,k,C,A,P)===!1)return!1;continue}switch(c.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(c,k,C,A,P)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<c.geometries.length;r++)if(t(c.geometries[r],k,C,A,P)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}Gi(Y_,"geomEach");function PA(e,t,n){var r=n;return Y_(e,function(a,c,f,u,b){c===0&&n===void 0?r=a:r=t(r,a,c,f,u,b)}),r}Gi(PA,"geomReduce");function $m(e,t){Y_(e,function(n,r,a,c,f){var u=n===null?null:n.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return t(Oa(n,a,{bbox:c,id:f}),r,0)===!1?!1:void 0}var b;switch(u){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var C=0;C<n.coordinates.length;C++){var A=n.coordinates[C],P={type:b,coordinates:A};if(t(Oa(P,a),r,C)===!1)return!1}})}Gi($m,"flattenEach");function AA(e,t,n){var r=n;return $m(e,function(a,c,f){c===0&&f===0&&n===void 0?r=a:r=t(r,a,c,f)}),r}Gi(AA,"flattenReduce");function Hw(e,t){$m(e,function(n,r,a){var c=0;if(n.geometry){var f=n.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var u,b=0,C=0,A=0;if(Yh(n,function(P,k,Y,X,lt){if(u===void 0||r>b||X>C||lt>A){u=P,b=r,C=X,A=lt,c=0;return}var ht=fl([u,P],n.properties);if(t(ht,r,a,lt,c)===!1)return!1;c++,u=P})===!1)return!1}}})}Gi(Hw,"segmentEach");function MA(e,t,n){var r=n,a=!1;return Hw(e,function(c,f,u,b,C){a===!1&&n===void 0?r=c:r=t(r,c,f,u,b,C),a=!0}),r}Gi(MA,"segmentReduce");function Xw(e,t){if(!e)throw new Error("geojson is required");$m(e,function(n,r,a){if(n.geometry!==null){var c=n.geometry.type,f=n.geometry.coordinates;switch(c){case"LineString":if(t(n,r,a,0,0)===!1)return!1;break;case"Polygon":for(var u=0;u<f.length;u++)if(t(fl(f[u],n.properties),r,a,u)===!1)return!1;break}}})}Gi(Xw,"lineEach");function DA(e,t,n){var r=n;return Xw(e,function(a,c,f,u){c===0&&n===void 0?r=a:r=t(r,a,c,f,u)}),r}Gi(DA,"lineReduce");function kA(e,t){if(t=t||{},!X_(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,a=t.geometryIndex||0,c=t.segmentIndex||0,f=t.properties,u;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),f=f||e.features[n].properties,u=e.features[n].geometry;break;case"Feature":f=f||e.properties,u=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=e;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var b=u.coordinates;switch(u.type){case"Point":case"MultiPoint":return null;case"LineString":return c<0&&(c=b.length+c-1),fl([b[c],b[c+1]],f,t);case"Polygon":return a<0&&(a=b.length+a),c<0&&(c=b[a].length+c-1),fl([b[a][c],b[a][c+1]],f,t);case"MultiLineString":return r<0&&(r=b.length+r),c<0&&(c=b[r].length+c-1),fl([b[r][c],b[r][c+1]],f,t);case"MultiPolygon":return r<0&&(r=b.length+r),a<0&&(a=b[r].length+a),c<0&&(c=b[r][a].length-c-1),fl([b[r][a][c],b[r][a][c+1]],f,t)}throw new Error("geojson is invalid")}Gi(kA,"findSegment");function RA(e,t){if(t=t||{},!X_(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,a=t.geometryIndex||0,c=t.coordIndex||0,f=t.properties,u;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),f=f||e.features[n].properties,u=e.features[n].geometry;break;case"Feature":f=f||e.properties,u=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=e;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var b=u.coordinates;switch(u.type){case"Point":return hl(b,f,t);case"MultiPoint":return r<0&&(r=b.length+r),hl(b[r],f,t);case"LineString":return c<0&&(c=b.length+c),hl(b[c],f,t);case"Polygon":return a<0&&(a=b.length+a),c<0&&(c=b[a].length+c),hl(b[a][c],f,t);case"MultiLineString":return r<0&&(r=b.length+r),c<0&&(c=b[r].length+c),hl(b[r][c],f,t);case"MultiPolygon":return r<0&&(r=b.length+r),a<0&&(a=b[r].length+a),c<0&&(c=b[r][a].length-c),hl(b[r][a][c],f,t)}throw new Error("geojson is invalid")}Gi(RA,"findPoint");var NA=Object.defineProperty,OA=(e,t)=>NA(e,"name",{value:t,configurable:!0});function K_(e,t={}){if(e.bbox!=null&&t.recompute!==!0)return e.bbox;const n=[1/0,1/0,-1/0,-1/0];return Yh(e,r=>{n[0]>r[0]&&(n[0]=r[0]),n[1]>r[1]&&(n[1]=r[1]),n[2]<r[0]&&(n[2]=r[0]),n[3]<r[1]&&(n[3]=r[1])}),n}OA(K_,"bbox");var Yw=K_;const zA=Object.freeze(Object.defineProperty({__proto__:null,bbox:K_,default:Yw},Symbol.toStringTag,{value:"Module"}));var Kw={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(e,t){(function(n,r){e.exports=r()})(Bf,function(){var n={},r={};function a(f,u,b){if(r[f]=b,f==="index"){var C="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",A={};return r.shared(A),r.index(n,A),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([C],{type:"text/javascript"}))),n}}a("shared",["exports"],function(f){function u(s,i,l,p){return new(l||(l=Promise))(function(g,v){function x(L){try{E(p.next(L))}catch(D){v(D)}}function w(L){try{E(p.throw(L))}catch(D){v(D)}}function E(L){var D;L.done?g(L.value):(D=L.value,D instanceof l?D:new l(function(R){R(D)})).then(x,w)}E((p=p.apply(s,i||[])).next())})}function b(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var C=A;function A(s,i){this.x=s,this.y=i}A.prototype={clone:function(){return new A(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,l=s.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),l=Math.sin(s),p=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=p,this},_rotateAround:function(s,i){var l=Math.cos(s),p=Math.sin(s),g=i.y+p*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-p*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},A.convert=function(s){return s instanceof A?s:Array.isArray(s)?new A(s[0],s[1]):s};var P=b(C),k=Y;function Y(s,i,l,p){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(p-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=p}Y.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,p=0;p<8;p++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<i)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=g/v}var x=0,w=1;for(l=s,p=0;p<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<i));p++)s>g?x=l:w=l,l=.5*(w-x)+x;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var X=b(k);let lt,ht;function _t(){return lt==null&&(lt=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),lt}function j(){if(ht==null&&(ht=!1,_t())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let p=0;p<5*5;p++){const g=4*p;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(p%5,Math.floor(p/5),1,1)}const l=i.getImageData(0,0,5,5).data;for(let p=0;p<5*5*4;p++)if(p%4!=3&&l[p]!==p){ht=!0;break}}}return ht||!1}function W(s,i,l,p){const g=new X(s,i,l,p);return function(v){return g.solve(v)}}const st=W(.25,.1,.25,1);function gt(s,i,l){return Math.min(l,Math.max(i,s))}function Lt(s,i,l){const p=l-i,g=((s-i)%p+p)%p+i;return g===i?l:g}function At(s,...i){for(const l of i)for(const p in l)s[p]=l[p];return s}let Tt=1;function Vt(s,i,l){const p={};for(const g in s)p[g]=i.call(l||this,s[g],g,s);return p}function Yt(s,i,l){const p={};for(const g in s)i.call(l||this,s[g],g,s)&&(p[g]=s[g]);return p}function J(s){return Array.isArray(s)?s.map(J):typeof s=="object"&&s?Vt(s,J):s}const Ut={};function te(s){Ut[s]||(typeof console<"u"&&console.warn(s),Ut[s]=!0)}function le(s,i,l){return(l.y-s.y)*(i.x-s.x)>(i.y-s.y)*(l.x-s.x)}function Xe(s){let i=0;for(let l,p,g=0,v=s.length,x=v-1;g<v;x=g++)l=s[g],p=s[x],i+=(p.x-l.x)*(l.y+p.y);return i}function De(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let ue=null;function tn(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const Ce="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function pe(s,i,l,p,g){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(s,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const w=x.startsWith("BGR"),E=new Uint8ClampedArray(p*g*4);if(yield v.copyTo(E,function(L,D,R,F,V){const G=4*Math.max(-D,0),H=(Math.max(0,R)-R)*F*4+G,tt=4*F,ot=Math.max(0,D),vt=Math.max(0,R);return{rect:{x:ot,y:vt,width:Math.min(L.width,D+F)-ot,height:Math.min(L.height,R+V)-vt},layout:[{offset:H,stride:tt}]}}(s,i,l,p,g)),w)for(let L=0;L<E.length;L+=4){const D=E[L];E[L]=E[L+2],E[L+2]=D}return E}finally{v.close()}})}let Ie,we;const on="AbortError";function Cn(){return new Error(on)}const Ze={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Je(s){return Ze.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const vn="global-dispatcher";class zn extends Error{constructor(i,l,p,g){super(`AJAXError: ${l} (${i}): ${p}`),this.status=i,this.statusText=l,this.url=p,this.body=g}}const en=()=>De(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,xn=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const p=Je(s.url);if(p)return p(s,i);if(De(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:vn},i)}if(!(/^file:/.test(l=s.url)||/^file:/.test(en())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(p,g){return u(this,void 0,void 0,function*(){const v=new Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,cache:p.cache,referrer:en(),signal:g.signal});p.type==="json"&&v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const L=yield x.blob();throw new zn(x.status,x.statusText,p.url,L)}let w;w=p.type==="arrayBuffer"||p.type==="image"?x.arrayBuffer():p.type==="json"?x.json():x.text();const E=yield w;if(g.signal.aborted)throw Cn();return{data:E,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,i);if(De(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:vn},i)}var l;return function(p,g){return new Promise((v,x)=>{const w=new XMLHttpRequest;w.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(w.responseType="arraybuffer");for(const E in p.headers)w.setRequestHeader(E,p.headers[E]);p.type==="json"&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials=p.credentials==="include",w.onerror=()=>{x(new Error(w.statusText))},w.onload=()=>{if(!g.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let E=w.response;if(p.type==="json")try{E=JSON.parse(w.response)}catch(L){return void x(L)}v({data:E,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const E=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});x(new zn(w.status,w.statusText,p.url,E))}},g.signal.addEventListener("abort",()=>{w.abort(),x(Cn())}),w.send(p.body)})}(s,i)};function Fn(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const i=new URL(s),l=window.location;return i.protocol===l.protocol&&i.host===l.host}function mr(s,i,l){l[s]&&l[s].indexOf(i)!==-1||(l[s]=l[s]||[],l[s].push(i))}function rt(s,i,l){if(l&&l[s]){const p=l[s].indexOf(i);p!==-1&&l[s].splice(p,1)}}class xt{constructor(i,l={}){At(this,l),this.type=i}}class ke extends xt{constructor(i,l={}){super("error",At({error:i},l))}}class cn{on(i,l){return this._listeners=this._listeners||{},mr(i,l,this._listeners),this}off(i,l){return rt(i,l,this._listeners),rt(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},mr(i,l,this._oneTimeListeners),this):new Promise(p=>this.once(i,p))}fire(i,l){typeof i=="string"&&(i=new xt(i,l||{}));const p=i.type;if(this.listens(p)){i.target=this;const g=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const w of g)w.call(this,i);const v=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const w of v)rt(p,w,this._oneTimeListeners),w.call(this,i);const x=this._eventedParent;x&&(At(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(i))}else i instanceof ke&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var Ct={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const $n=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qo(s,i){const l={};for(const p in s)p!=="ref"&&(l[p]=s[p]);return $n.forEach(p=>{p in i&&(l[p]=i[p])}),l}function Qe(s,i){if(Array.isArray(s)){if(!Array.isArray(i)||s.length!==i.length)return!1;for(let l=0;l<s.length;l++)if(!Qe(s[l],i[l]))return!1;return!0}if(typeof s=="object"&&s!==null&&i!==null){if(typeof i!="object"||Object.keys(s).length!==Object.keys(i).length)return!1;for(const l in s)if(!Qe(s[l],i[l]))return!1;return!0}return s===i}function Or(s,i){s.push(i)}function Cl(s,i,l){Or(l,{command:"addSource",args:[s,i[s]]})}function Tl(s,i,l){Or(i,{command:"removeSource",args:[s]}),l[s]=!0}function Ll(s,i,l,p){Tl(s,l,p),Cl(s,i,l)}function Pl(s,i,l){let p;for(p in s[l])if(Object.prototype.hasOwnProperty.call(s[l],p)&&p!=="data"&&!Qe(s[l][p],i[l][p]))return!1;for(p in i[l])if(Object.prototype.hasOwnProperty.call(i[l],p)&&p!=="data"&&!Qe(s[l][p],i[l][p]))return!1;return!0}function ya(s,i,l,p,g,v){s=s||{},i=i||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(Qe(s[x],i[x])||l.push({command:v,args:[p,x,i[x],g]}));for(const x in i)Object.prototype.hasOwnProperty.call(i,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(Qe(s[x],i[x])||l.push({command:v,args:[p,x,i[x],g]}))}function dc(s){return s.id}function Za(s,i){return s[i.id]=i,s}class Wt{constructor(i,l,p,g){this.message=(i?`${i}: `:"")+p,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function hs(s,...i){for(const l of i)for(const p in l)s[p]=l[p];return s}class oo extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class gu{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[p,g]of l)this.bindings[p]=g}concat(i){return new gu(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const fi={kind:"null"},$t={kind:"number"},We={kind:"string"},Ge={kind:"boolean"},Pr={kind:"color"},ps={kind:"object"},Oe={kind:"value"},Ha={kind:"collator"},zr={kind:"formatted"},et={kind:"padding"},z={kind:"resolvedImage"},B={kind:"variableAnchorOffsetCollection"};function q(s,i){return{kind:"array",itemType:s,N:i}}function K(s){if(s.kind==="array"){const i=K(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}return s.kind}const pt=[fi,$t,We,Ge,Pr,zr,ps,q(Oe),et,z,B];function ft(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!ft(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(const l of pt)if(!ft(l,i))return null}}return`Expected ${K(s)} but found ${K(i)} instead.`}function yt(s,i){return i.some(l=>l.kind===s.kind)}function ut(s,i){return i.some(l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s)}function wt(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}const zt=.96422,Rt=.82521,Nt=4/29,ge=6/29,xe=3*ge*ge,ze=ge*ge*ge,Ae=Math.PI/180,sn=180/Math.PI;function An(s){return(s%=360)<0&&(s+=360),s}function Zn([s,i,l,p]){let g,v;const x=qe((.2225045*(s=Ar(s))+.7168786*(i=Ar(i))+.0606169*(l=Ar(l)))/1);s===i&&i===l?g=v=x:(g=qe((.4360747*s+.3850649*i+.1430804*l)/zt),v=qe((.0139322*s+.0971045*i+.7141733*l)/Rt));const w=116*x-16;return[w<0?0:w,500*(g-x),200*(x-v),p]}function Ar(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function qe(s){return s>ze?Math.pow(s,1/3):s/xe+Nt}function sr([s,i,l,p]){let g=(s+16)/116,v=isNaN(i)?g:g+i/500,x=isNaN(l)?g:g-l/200;return g=1*Pi(g),v=zt*Pi(v),x=Rt*Pi(x),[Fr(3.1338561*v-1.6168667*g-.4906146*x),Fr(-.9787684*v+1.9161415*g+.033454*x),Fr(.0719453*v-.2289914*g+1.4052427*x),p]}function Fr(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function Pi(s){return s>ge?s*s*s:xe*(s-Nt)}function qi(s){return parseInt(s.padEnd(2,s),16)/255}function Qr(s,i){return fs(i?s/100:s,0,1)}function fs(s,i,l){return Math.min(Math.max(i,s),l)}function Qf(s){return!s.some(Number.isNaN)}const mg={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Tn{constructor(i,l,p,g=1,v=!0){this.r=i,this.g=l,this.b=p,this.a=g,v||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,l,p,g]))}static parse(i){if(i instanceof Tn)return i;if(typeof i!="string")return;const l=function(p){if((p=p.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=mg[p];if(g){const[x,w,E]=g;return[x/255,w/255,E/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const x=p.length<6?1:2;let w=1;return[qi(p.slice(w,w+=x)),qi(p.slice(w,w+=x)),qi(p.slice(w,w+=x)),qi(p.slice(w,w+x)||"ff")]}if(p.startsWith("rgb")){const x=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[w,E,L,D,R,F,V,G,H,tt,ot,vt]=x,at=[D||" ",V||" ",tt].join("");if(at==="  "||at==="  /"||at===",,"||at===",,,"){const dt=[L,F,H].join(""),kt=dt==="%%%"?100:dt===""?255:0;if(kt){const Ot=[fs(+E/kt,0,1),fs(+R/kt,0,1),fs(+G/kt,0,1),ot?Qr(+ot,vt):1];if(Qf(Ot))return Ot}}return}}const v=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,w,E,L,D,R,F,V,G]=v,H=[E||" ",D||" ",F].join("");if(H==="  "||H==="  /"||H===",,"||H===",,,"){const tt=[+w,fs(+L,0,100),fs(+R,0,100),V?Qr(+V,G):1];if(Qf(tt))return function([ot,vt,at,dt]){function kt(Ot){const ie=(Ot+ot/30)%12,fe=vt*Math.min(at,1-at);return at-fe*Math.max(-1,Math.min(ie-3,9-ie,1))}return ot=An(ot),vt/=100,at/=100,[kt(0),kt(8),kt(4),dt]}(tt)}}}(i);return l?new Tn(...l,!1):void 0}get rgb(){const{r:i,g:l,b:p,a:g}=this,v=g||1/0;return this.overwriteGetter("rgb",[i/v,l/v,p/v,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[l,p,g,v]=Zn(i),x=Math.sqrt(p*p+g*g);return[Math.round(1e4*x)?An(Math.atan2(g,p)*sn):NaN,x,l,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Zn(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){const[i,l,p,g]=this.rgb;return`rgba(${[i,l,p].map(v=>Math.round(255*v)).join(",")},${g})`}}Tn.black=new Tn(0,0,0,1),Tn.white=new Tn(1,1,1,1),Tn.transparent=new Tn(0,0,0,0),Tn.red=new Tn(1,0,0,1);class ep{constructor(i,l,p){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class np{constructor(i,l,p,g,v){this.text=i,this.image=l,this.scale=p,this.fontStack=g,this.textColor=v}}class so{constructor(i){this.sections=i}static fromString(i){return new so([new np(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof so?i:so.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class ji{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof ji)return i;if(typeof i=="number")return new ji([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const l of i)if(typeof l!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new ji(i)}}toString(){return JSON.stringify(this.values)}}const yu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Po{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Po)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let l=0;l<i.length;l+=2){const p=i[l],g=i[l+1];if(typeof p!="string"||!yu.has(p)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new Po(i)}}toString(){return JSON.stringify(this.values)}}class Ao{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Ao({name:i,available:!1}):null}}function Al(s,i,l,p){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[s,i,l,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[s,i,l,p]:[s,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function mc(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Tn||s instanceof ep||s instanceof so||s instanceof ji||s instanceof Po||s instanceof Ao)return!0;if(Array.isArray(s)){for(const i of s)if(!mc(i))return!1;return!0}if(typeof s=="object"){for(const i in s)if(!mc(s[i]))return!1;return!0}return!1}function Mr(s){if(s===null)return fi;if(typeof s=="string")return We;if(typeof s=="boolean")return Ge;if(typeof s=="number")return $t;if(s instanceof Tn)return Pr;if(s instanceof ep)return Ha;if(s instanceof so)return zr;if(s instanceof ji)return et;if(s instanceof Po)return B;if(s instanceof Ao)return z;if(Array.isArray(s)){const i=s.length;let l;for(const p of s){const g=Mr(p);if(l){if(l===g)continue;l=Oe;break}l=g}return q(l||Oe,i)}return ps}function _u(s){const i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof Tn||s instanceof so||s instanceof ji||s instanceof Po||s instanceof Ao?s.toString():JSON.stringify(s)}class _a{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!mc(i[1]))return l.error("invalid value");const p=i[1];let g=Mr(p);const v=l.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new _a(g,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class tr{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const gc={string:We,number:$t,boolean:Ge,object:ps};class ao{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let p,g=1;const v=i[0];if(v==="array"){let w,E;if(i.length>2){const L=i[1];if(typeof L!="string"||!(L in gc)||L==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=gc[L],g++}else w=Oe;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);E=i[2],g++}p=q(w,E)}else{if(!gc[v])throw new Error(`Types doesn't contain name = ${v}`);p=gc[v]}const x=[];for(;g<i.length;g++){const w=l.parse(i[g],g,Oe);if(!w)return null;x.push(w)}return new ao(p,x)}evaluate(i){for(let l=0;l<this.args.length;l++){const p=this.args[l].evaluate(i);if(!ft(this.type,Mr(p)))return p;if(l===this.args.length-1)throw new tr(`Expected value to be of type ${K(this.type)}, but found ${K(Mr(p))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const yc={"to-boolean":Ge,"to-color":Pr,"to-number":$t,"to-string":We};class ds{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const p=i[0];if(!yc[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&i.length!==2)return l.error("Expected one argument.");const g=yc[p],v=[];for(let x=1;x<i.length;x++){const w=l.parse(i[x],x,Oe);if(!w)return null;v.push(w)}return new ds(g,v)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,p;for(const g of this.args){if(l=g.evaluate(i),p=null,l instanceof Tn)return l;if(typeof l=="string"){const v=i.parseColor(l);if(v)return v}else if(Array.isArray(l)&&(p=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Al(l[0],l[1],l[2],l[3]),!p))return new Tn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new tr(p||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const p of this.args){l=p.evaluate(i);const g=ji.parse(l);if(g)return g}throw new tr(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const p of this.args){l=p.evaluate(i);const g=Po.parse(l);if(g)return g}throw new tr(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const p of this.args){if(l=p.evaluate(i),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new tr(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return so.fromString(_u(this.args[0].evaluate(i)));case"resolvedImage":return Ao.fromString(_u(this.args[0].evaluate(i)));default:return _u(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const vu=["Unknown","Point","LineString","Polygon"];class Ln{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?vu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=Tn.parse(i)),l}}class _c{constructor(i,l,p=[],g,v=new gu,x=[]){this.registry=i,this.path=p,this.key=p.map(w=>`[${w}]`).join(""),this.scope=v,this.errors=x,this.expectedType=g,this._isConstant=l}parse(i,l,p,g,v={}){return l?this.concat(l,p,g)._parse(i,v):this._parse(i,v)}_parse(i,l){function p(g,v,x){return x==="assert"?new ao(v,[g]):x==="coerce"?new ds(v,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let x=v.parse(i,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,E=x.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||E.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string")if(w.kind!=="padding"||E.kind!=="value"&&E.kind!=="number"&&E.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||E.kind!=="value"&&E.kind!=="array"){if(this.checkSubtype(w,E))return null}else x=p(x,w,l.typeAnnotation||"coerce");else x=p(x,w,l.typeAnnotation||"coerce");else x=p(x,w,l.typeAnnotation||"coerce");else x=p(x,w,l.typeAnnotation||"assert")}if(!(x instanceof _a)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const w=new Ln;try{x=new _a(x.type,x.evaluate(w))}catch(E){return this.error(E.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,p){const g=typeof i=="number"?this.path.concat(i):this.path,v=p?this.scope.concat(p):this.scope;return new _c(this.registry,this._isConstant,g,l||null,v,this.errors)}error(i,...l){const p=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new oo(p,i))}checkSubtype(i,l){const p=ft(i,l);return p&&this.error(p),p}}class Ml{constructor(i,l,p){this.type=Ha,this.locale=p,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const p=i[1];if(typeof p!="object"||Array.isArray(p))return l.error("Collator options argument must be an object.");const g=l.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Ge);if(!g)return null;const v=l.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Ge);if(!v)return null;let x=null;return p.locale&&(x=l.parse(p.locale,1,We),!x)?null:new Ml(g,v,x)}evaluate(i){return new ep(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const va=8192;function vc(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function xu(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function gg(s,i){const l=(180+s[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(l*g*va),Math.round(p*g*va)]}function $f(s,i,l){const p=s[0]-i[0],g=s[1]-i[1],v=s[0]-l[0],x=s[1]-l[1];return p*x-v*g==0&&p*v<=0&&g*x<=0}function xc(s,i){let l=!1;for(let x=0,w=i.length;x<w;x++){const E=i[x];for(let L=0,D=E.length;L<D-1;L++){if($f(s,E[L],E[L+1]))return!1;(g=E[L])[1]>(p=s)[1]!=(v=E[L+1])[1]>p[1]&&p[0]<(v[0]-g[0])*(p[1]-g[1])/(v[1]-g[1])+g[0]&&(l=!l)}}var p,g,v;return l}function yg(s,i){for(let l=0;l<i.length;l++)if(xc(s,i[l]))return!0;return!1}function td(s,i,l,p){const g=p[0]-l[0],v=p[1]-l[1],x=(s[0]-l[0])*v-g*(s[1]-l[1]),w=(i[0]-l[0])*v-g*(i[1]-l[1]);return x>0&&w<0||x<0&&w>0}function _g(s,i,l){for(const L of l)for(let D=0;D<L.length-1;++D)if((w=[(x=L[D+1])[0]-(v=L[D])[0],x[1]-v[1]])[0]*(E=[(g=i)[0]-(p=s)[0],g[1]-p[1]])[1]-w[1]*E[0]!=0&&td(p,g,v,x)&&td(v,x,p,g))return!0;var p,g,v,x,w,E;return!1}function ed(s,i){for(let l=0;l<s.length;++l)if(!xc(s[l],i))return!1;for(let l=0;l<s.length-1;++l)if(_g(s[l],s[l+1],i))return!1;return!0}function nd(s,i){for(let l=0;l<i.length;l++)if(ed(s,i[l]))return!0;return!1}function bc(s,i,l){const p=[];for(let g=0;g<s.length;g++){const v=[];for(let x=0;x<s[g].length;x++){const w=gg(s[g][x],l);vc(i,w),v.push(w)}p.push(v)}return p}function rd(s,i,l){const p=[];for(let g=0;g<s.length;g++){const v=bc(s[g],i,l);p.push(v)}return p}function id(s,i,l,p){if(s[0]<l[0]||s[0]>l[2]){const g=.5*p;let v=s[0]-l[0]>g?-p:l[0]-s[0]>g?p:0;v===0&&(v=s[0]-l[2]>g?-p:l[2]-s[0]>g?p:0),s[0]+=v}vc(i,s)}function wc(s,i,l,p){const g=Math.pow(2,p.z)*va,v=[p.x*va,p.y*va],x=[];for(const w of s)for(const E of w){const L=[E.x+v[0],E.y+v[1]];id(L,i,l,g),x.push(L)}return x}function od(s,i,l,p){const g=Math.pow(2,p.z)*va,v=[p.x*va,p.y*va],x=[];for(const E of s){const L=[];for(const D of E){const R=[D.x+v[0],D.y+v[1]];vc(i,R),L.push(R)}x.push(L)}if(i[2]-i[0]<=g/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of x)for(const L of E)id(L,i,l,g)}var w;return x}class Xa{constructor(i,l){this.type=Ge,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(mc(i[1])){const p=i[1];if(p.type==="FeatureCollection"){const g=[];for(const v of p.features){const{type:x,coordinates:w}=v.geometry;x==="Polygon"&&g.push(w),x==="MultiPolygon"&&g.push(...w)}if(g.length)return new Xa(p,{type:"MultiPolygon",coordinates:g})}else if(p.type==="Feature"){const g=p.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Xa(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Xa(p,p)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,p){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(p.type==="Polygon"){const w=bc(p.coordinates,v,x),E=wc(l.geometry(),g,v,x);if(!xu(g,v))return!1;for(const L of E)if(!xc(L,w))return!1}if(p.type==="MultiPolygon"){const w=rd(p.coordinates,v,x),E=wc(l.geometry(),g,v,x);if(!xu(g,v))return!1;for(const L of E)if(!yg(L,w))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,p){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(p.type==="Polygon"){const w=bc(p.coordinates,v,x),E=od(l.geometry(),g,v,x);if(!xu(g,v))return!1;for(const L of E)if(!ed(L,w))return!1}if(p.type==="MultiPolygon"){const w=rd(p.coordinates,v,x),E=od(l.geometry(),g,v,x);if(!xu(g,v))return!1;for(const L of E)if(!nd(L,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Sc{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const p=i[1];return l.scope.has(p)?new Sc(p,l.scope.get(p)):l.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class lo{constructor(i,l,p,g){this.name=i,this.type=l,this._evaluate=p,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){const p=i[0],g=lo.definitions[p];if(!g)return l.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,w=x.filter(([L])=>!Array.isArray(L)||L.length===i.length-1);let E=null;for(const[L,D]of w){E=new _c(l.registry,bu,l.path,null,l.scope);const R=[];let F=!1;for(let V=1;V<i.length;V++){const G=i[V],H=Array.isArray(L)?L[V-1]:L.type,tt=E.parse(G,1+R.length,H);if(!tt){F=!0;break}R.push(tt)}if(!F)if(Array.isArray(L)&&L.length!==R.length)E.error(`Expected ${L.length} arguments, but found ${R.length} instead.`);else{for(let V=0;V<R.length;V++){const G=Array.isArray(L)?L[V]:L.type,H=R[V];E.concat(V+1).checkSubtype(G,H.type)}if(E.errors.length===0)return new lo(p,v,D,R)}}if(w.length===1)l.errors.push(...E.errors);else{const L=(w.length?w:x).map(([R])=>{return F=R,Array.isArray(F)?`(${F.map(K).join(", ")})`:`(${K(F.type)}...)`;var F}).join(" | "),D=[];for(let R=1;R<i.length;R++){const F=l.parse(i[R],1+D.length);if(!F)return null;D.push(K(F.type))}l.error(`Expected arguments of type ${L}, but found (${D.join(", ")}) instead.`)}return null}static register(i,l){lo.definitions=l;for(const p in l)i[p]=lo}}function bu(s){if(s instanceof Sc)return bu(s.boundExpression);if(s instanceof lo&&s.name==="error"||s instanceof Ml||s instanceof Xa)return!1;const i=s instanceof ds||s instanceof ao;let l=!0;return s.eachChild(p=>{l=i?l&&bu(p):l&&p instanceof _a}),!!l&&Ic(s)&&Su(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ic(s){if(s instanceof lo&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Xa)return!1;let i=!0;return s.eachChild(l=>{i&&!Ic(l)&&(i=!1)}),i}function wu(s){if(s instanceof lo&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(l=>{i&&!wu(l)&&(i=!1)}),i}function Su(s,i){if(s instanceof lo&&i.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(p=>{l&&!Su(p,i)&&(l=!1)}),l}function Iu(s,i){const l=s.length-1;let p,g,v=0,x=l,w=0;for(;v<=x;)if(w=Math.floor((v+x)/2),p=s[w],g=s[w+1],p<=i){if(w===l||i<g)return w;v=w+1}else{if(!(p>i))throw new tr("Input is not a number.");x=w-1}return 0}class Eu{constructor(i,l,p){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[g,v]of p)this.labels.push(g),this.outputs.push(v)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const p=l.parse(i[1],1,$t);if(!p)return null;const g=[];let v=null;l.expectedType&&l.expectedType.kind!=="value"&&(v=l.expectedType);for(let x=1;x<i.length;x+=2){const w=x===1?-1/0:i[x],E=i[x+1],L=x,D=x+1;if(typeof w!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(g.length&&g[g.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const R=l.parse(E,D,v);if(!R)return null;v=v||R.type,g.push([w,R])}return new Eu(v,p,g)}evaluate(i){const l=this.labels,p=this.outputs;if(l.length===1)return p[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return p[0].evaluate(i);const v=l.length;return g>=l[v-1]?p[v-1].evaluate(i):p[Iu(l,g)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function vg(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var xg=sd;function sd(s,i,l,p){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(p-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=p}sd.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,p=0;p<8;p++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<i)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=g/v}var x=0,w=1;for(l=s,p=0;p<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<i));p++)s>g?x=l:w=l,l=.5*(w-x)+x;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var bg=vg(xg);function Ya(s,i,l){return s+l*(i-s)}function Ec(s,i,l){return s.map((p,g)=>Ya(p,i[g],l))}const Ai={number:Ya,color:function(s,i,l,p="rgb"){switch(p){case"rgb":{const[g,v,x,w]=Ec(s.rgb,i.rgb,l);return new Tn(g,v,x,w,!1)}case"hcl":{const[g,v,x,w]=s.hcl,[E,L,D,R]=i.hcl;let F,V;if(isNaN(g)||isNaN(E))isNaN(g)?isNaN(E)?F=NaN:(F=E,x!==1&&x!==0||(V=L)):(F=g,D!==1&&D!==0||(V=v));else{let vt=E-g;E>g&&vt>180?vt-=360:E<g&&g-E>180&&(vt+=360),F=g+l*vt}const[G,H,tt,ot]=function([vt,at,dt,kt]){return vt=isNaN(vt)?0:vt*Ae,sr([dt,Math.cos(vt)*at,Math.sin(vt)*at,kt])}([F,V??Ya(v,L,l),Ya(x,D,l),Ya(w,R,l)]);return new Tn(G,H,tt,ot,!1)}case"lab":{const[g,v,x,w]=sr(Ec(s.lab,i.lab,l));return new Tn(g,v,x,w,!1)}}},array:Ec,padding:function(s,i,l){return new ji(Ec(s.values,i.values,l))},variableAnchorOffsetCollection:function(s,i,l){const p=s.values,g=i.values;if(p.length!==g.length)throw new tr(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);const v=[];for(let x=0;x<p.length;x+=2){if(p[x]!==g[x])throw new tr(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${p[x]}, to[${x}]: ${g[x]}`);v.push(p[x]);const[w,E]=p[x+1],[L,D]=g[x+1];v.push([Ya(w,L,l),Ya(E,D,l)])}return new Po(v)}};class di{constructor(i,l,p,g,v){this.type=i,this.operator=l,this.interpolation=p,this.input=g,this.labels=[],this.outputs=[];for(const[x,w]of v)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(i,l,p,g){let v=0;if(i.name==="exponential")v=gn(l,i.base,p,g);else if(i.name==="linear")v=gn(l,1,p,g);else if(i.name==="cubic-bezier"){const x=i.controlPoints;v=new bg(x[0],x[1],x[2],x[3]).solve(gn(l,1,p,g))}return v}static parse(i,l){let[p,g,v,...x]=i;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const L=g[1];if(typeof L!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:L}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const L=g.slice(1);if(L.length!==4||L.some(D=>typeof D!="number"||D<0||D>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(v=l.parse(v,2,$t),!v)return null;const w=[];let E=null;p==="interpolate-hcl"||p==="interpolate-lab"?E=Pr:l.expectedType&&l.expectedType.kind!=="value"&&(E=l.expectedType);for(let L=0;L<x.length;L+=2){const D=x[L],R=x[L+1],F=L+3,V=L+4;if(typeof D!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=D)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const G=l.parse(R,V,E);if(!G)return null;E=E||G.type,w.push([D,G])}return wt(E,$t)||wt(E,Pr)||wt(E,et)||wt(E,B)||wt(E,q($t))?new di(E,p,g,v,w):l.error(`Type ${K(E)} is not interpolatable.`)}evaluate(i){const l=this.labels,p=this.outputs;if(l.length===1)return p[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return p[0].evaluate(i);const v=l.length;if(g>=l[v-1])return p[v-1].evaluate(i);const x=Iu(l,g),w=di.interpolationFactor(this.interpolation,g,l[x],l[x+1]),E=p[x].evaluate(i),L=p[x+1].evaluate(i);switch(this.operator){case"interpolate":return Ai[this.type.kind](E,L,w);case"interpolate-hcl":return Ai.color(E,L,w,"hcl");case"interpolate-lab":return Ai.color(E,L,w,"lab")}}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function gn(s,i,l,p){const g=p-l,v=s-l;return g===0?0:i===1?v/g:(Math.pow(i,v)-1)/(Math.pow(i,g)-1)}class Cc{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let p=null;const g=l.expectedType;g&&g.kind!=="value"&&(p=g);const v=[];for(const w of i.slice(1)){const E=l.parse(w,1+v.length,p,void 0,{typeAnnotation:"omit"});if(!E)return null;p=p||E.type,v.push(E)}if(!p)throw new Error("No output type");const x=g&&v.some(w=>ft(g,w.type));return new Cc(x?Oe:p,v)}evaluate(i){let l,p=null,g=0;for(const v of this.args)if(g++,p=v.evaluate(i),p&&p instanceof Ao&&!p.available&&(l||(l=p.name),p=null,g===this.args.length&&(p=l)),p!==null)break;return p}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class Tc{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const p=[];for(let v=1;v<i.length-1;v+=2){const x=i[v];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",v);const w=l.parse(i[v+1],v+1);if(!w)return null;p.push([x,w])}const g=l.parse(i[i.length-1],i.length-1,l.expectedType,p);return g?new Tc(p,g):null}outputDefined(){return this.result.outputDefined()}}class rp{constructor(i,l,p){this.type=i,this.index=l,this.input=p}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const p=l.parse(i[1],1,$t),g=l.parse(i[2],2,q(l.expectedType||Oe));return p&&g?new rp(g.type.itemType,p,g):null}evaluate(i){const l=this.index.evaluate(i),p=this.input.evaluate(i);if(l<0)throw new tr(`Array index out of bounds: ${l} < 0.`);if(l>=p.length)throw new tr(`Array index out of bounds: ${l} > ${p.length-1}.`);if(l!==Math.floor(l))throw new tr(`Array index must be an integer, but found ${l} instead.`);return p[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class ip{constructor(i,l){this.type=Ge,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const p=l.parse(i[1],1,Oe),g=l.parse(i[2],2,Oe);return p&&g?yt(p.type,[Ge,We,$t,fi,Oe])?new ip(p,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(p.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),p=this.haystack.evaluate(i);if(!p)return!1;if(!ut(l,["boolean","string","number","null"]))throw new tr(`Expected first argument to be of type boolean, string, number or null, but found ${K(Mr(l))} instead.`);if(!ut(p,["string","array"]))throw new tr(`Expected second argument to be of type array or string, but found ${K(Mr(p))} instead.`);return p.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Lc{constructor(i,l,p){this.type=$t,this.needle=i,this.haystack=l,this.fromIndex=p}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const p=l.parse(i[1],1,Oe),g=l.parse(i[2],2,Oe);if(!p||!g)return null;if(!yt(p.type,[Ge,We,$t,fi,Oe]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${K(p.type)} instead`);if(i.length===4){const v=l.parse(i[3],3,$t);return v?new Lc(p,g,v):null}return new Lc(p,g)}evaluate(i){const l=this.needle.evaluate(i),p=this.haystack.evaluate(i);if(!ut(l,["boolean","string","number","null"]))throw new tr(`Expected first argument to be of type boolean, string, number or null, but found ${K(Mr(l))} instead.`);if(!ut(p,["string","array"]))throw new tr(`Expected second argument to be of type array or string, but found ${K(Mr(p))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(i);return p.indexOf(l,g)}return p.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class op{constructor(i,l,p,g,v,x){this.inputType=i,this.type=l,this.input=p,this.cases=g,this.outputs=v,this.otherwise=x}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let p,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const v={},x=[];for(let L=2;L<i.length-1;L+=2){let D=i[L];const R=i[L+1];Array.isArray(D)||(D=[D]);const F=l.concat(L);if(D.length===0)return F.error("Expected at least one branch label.");for(const G of D){if(typeof G!="number"&&typeof G!="string")return F.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return F.error("Numeric branch labels must be integer values.");if(p){if(F.checkSubtype(p,Mr(G)))return null}else p=Mr(G);if(v[String(G)]!==void 0)return F.error("Branch labels must be unique.");v[String(G)]=x.length}const V=l.parse(R,L,g);if(!V)return null;g=g||V.type,x.push(V)}const w=l.parse(i[1],1,Oe);if(!w)return null;const E=l.parse(i[i.length-1],i.length-1,g);return E?w.type.kind!=="value"&&l.concat(1).checkSubtype(p,w.type)?null:new op(p,g,w,v,x,E):null}evaluate(i){const l=this.input.evaluate(i);return(Mr(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class sp{constructor(i,l,p){this.type=i,this.branches=l,this.otherwise=p}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let p;l.expectedType&&l.expectedType.kind!=="value"&&(p=l.expectedType);const g=[];for(let x=1;x<i.length-1;x+=2){const w=l.parse(i[x],x,Ge);if(!w)return null;const E=l.parse(i[x+1],x+1,p);if(!E)return null;g.push([w,E]),p=p||E.type}const v=l.parse(i[i.length-1],i.length-1,p);if(!v)return null;if(!p)throw new Error("Can't infer output type");return new sp(p,g,v)}evaluate(i){for(const[l,p]of this.branches)if(l.evaluate(i))return p.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,p]of this.branches)i(l),i(p);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Pc{constructor(i,l,p,g){this.type=i,this.input=l,this.beginIndex=p,this.endIndex=g}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const p=l.parse(i[1],1,Oe),g=l.parse(i[2],2,$t);if(!p||!g)return null;if(!yt(p.type,[q(Oe),We,Oe]))return l.error(`Expected first argument to be of type array or string, but found ${K(p.type)} instead`);if(i.length===4){const v=l.parse(i[3],3,$t);return v?new Pc(p.type,p,g,v):null}return new Pc(p.type,p,g)}evaluate(i){const l=this.input.evaluate(i),p=this.beginIndex.evaluate(i);if(!ut(l,["string","array"]))throw new tr(`Expected first argument to be of type array or string, but found ${K(Mr(l))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(i);return l.slice(p,g)}return l.slice(p)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function ad(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function ld(s,i,l,p){return p.compare(i,l)===0}function Dl(s,i,l){const p=s!=="=="&&s!=="!=";return class Jw{constructor(v,x,w){this.type=Ge,this.lhs=v,this.rhs=x,this.collator=w,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const w=v[0];let E=x.parse(v[1],1,Oe);if(!E)return null;if(!ad(w,E.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${K(E.type)}'.`);let L=x.parse(v[2],2,Oe);if(!L)return null;if(!ad(w,L.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${K(L.type)}'.`);if(E.type.kind!==L.type.kind&&E.type.kind!=="value"&&L.type.kind!=="value")return x.error(`Cannot compare types '${K(E.type)}' and '${K(L.type)}'.`);p&&(E.type.kind==="value"&&L.type.kind!=="value"?E=new ao(L.type,[E]):E.type.kind!=="value"&&L.type.kind==="value"&&(L=new ao(E.type,[L])));let D=null;if(v.length===4){if(E.type.kind!=="string"&&L.type.kind!=="string"&&E.type.kind!=="value"&&L.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(D=x.parse(v[3],3,Ha),!D)return null}return new Jw(E,L,D)}evaluate(v){const x=this.lhs.evaluate(v),w=this.rhs.evaluate(v);if(p&&this.hasUntypedArgument){const E=Mr(x),L=Mr(w);if(E.kind!==L.kind||E.kind!=="string"&&E.kind!=="number")throw new tr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${E.kind}, ${L.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const E=Mr(x),L=Mr(w);if(E.kind!=="string"||L.kind!=="string")return i(v,x,w)}return this.collator?l(v,x,w,this.collator.evaluate(v)):i(v,x,w)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const wg=Dl("==",function(s,i,l){return i===l},ld),Sg=Dl("!=",function(s,i,l){return i!==l},function(s,i,l,p){return!ld(0,i,l,p)}),Ig=Dl("<",function(s,i,l){return i<l},function(s,i,l,p){return p.compare(i,l)<0}),Eg=Dl(">",function(s,i,l){return i>l},function(s,i,l,p){return p.compare(i,l)>0}),Cg=Dl("<=",function(s,i,l){return i<=l},function(s,i,l,p){return p.compare(i,l)<=0}),Tg=Dl(">=",function(s,i,l){return i>=l},function(s,i,l,p){return p.compare(i,l)>=0});class ap{constructor(i,l,p,g,v){this.type=We,this.number=i,this.locale=l,this.currency=p,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const p=l.parse(i[1],1,$t);if(!p)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=l.parse(g.locale,1,We),!v))return null;let x=null;if(g.currency&&(x=l.parse(g.currency,1,We),!x))return null;let w=null;if(g["min-fraction-digits"]&&(w=l.parse(g["min-fraction-digits"],1,$t),!w))return null;let E=null;return g["max-fraction-digits"]&&(E=l.parse(g["max-fraction-digits"],1,$t),!E)?null:new ap(p,v,x,w,E)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Ac{constructor(i){this.type=zr,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const p=i[1];if(!Array.isArray(p)&&typeof p=="object")return l.error("First argument must be an image or text section.");const g=[];let v=!1;for(let x=1;x<=i.length-1;++x){const w=i[x];if(v&&typeof w=="object"&&!Array.isArray(w)){v=!1;let E=null;if(w["font-scale"]&&(E=l.parse(w["font-scale"],1,$t),!E))return null;let L=null;if(w["text-font"]&&(L=l.parse(w["text-font"],1,q(We)),!L))return null;let D=null;if(w["text-color"]&&(D=l.parse(w["text-color"],1,Pr),!D))return null;const R=g[g.length-1];R.scale=E,R.font=L,R.textColor=D}else{const E=l.parse(i[x],1,Oe);if(!E)return null;const L=E.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:E,scale:null,font:null,textColor:null})}}return new Ac(g)}evaluate(i){return new so(this.sections.map(l=>{const p=l.content.evaluate(i);return Mr(p)===z?new np("",p,null,null,null):new np(_u(p),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}}class lp{constructor(i){this.type=z,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");const p=l.parse(i[1],1,We);return p?new lp(p):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),p=Ao.fromString(l);return p&&i.availableImages&&(p.available=i.availableImages.indexOf(l)>-1),p}eachChild(i){i(this.input)}outputDefined(){return!1}}class up{constructor(i){this.type=$t,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const p=l.parse(i[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${K(p.type)} instead.`):new up(p):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string"||Array.isArray(l))return l.length;throw new tr(`Expected value to be of type string or array, but found ${K(Mr(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const kl={"==":wg,"!=":Sg,">":Eg,"<":Ig,">=":Tg,"<=":Cg,array:ao,at:rp,boolean:ao,case:sp,coalesce:Cc,collator:Ml,format:Ac,image:lp,in:ip,"index-of":Lc,interpolate:di,"interpolate-hcl":di,"interpolate-lab":di,length:up,let:Tc,literal:_a,match:op,number:ao,"number-format":ap,object:ao,slice:Pc,step:Eu,string:ao,"to-boolean":ds,"to-color":ds,"to-number":ds,"to-string":ds,var:Sc,within:Xa};function ud(s,[i,l,p,g]){i=i.evaluate(s),l=l.evaluate(s),p=p.evaluate(s);const v=g?g.evaluate(s):1,x=Al(i,l,p,v);if(x)throw new tr(x);return new Tn(i/255,l/255,p/255,v,!1)}function cd(s,i){return s in i}function cp(s,i){const l=i[s];return l===void 0?null:l}function Ka(s){return{type:s}}function hd(s){return{result:"success",value:s}}function Rl(s){return{result:"error",value:s}}function Nl(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function pd(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function hp(s){return!!s.expression&&s.expression.interpolated}function hn(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Mc(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Lg(s){return s}function fd(s,i){const l=i.type==="color",p=s.stops&&typeof s.stops[0][0]=="object",g=p||!(p||s.property!==void 0),v=s.type||(hp(i)?"exponential":"interval");if(l||i.type==="padding"){const D=l?Tn.parse:ji.parse;(s=hs({},s)).stops&&(s.stops=s.stops.map(R=>[R[0],D(R[1])])),s.default=D(s.default?s.default:i.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let w,E,L;if(v==="exponential")w=an;else if(v==="interval")w=Pg;else if(v==="categorical"){w=xr,E=Object.create(null);for(const D of s.stops)E[D[0]]=D[1];L=typeof s.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);w=pp}if(p){const D={},R=[];for(let G=0;G<s.stops.length;G++){const H=s.stops[G],tt=H[0].zoom;D[tt]===void 0&&(D[tt]={zoom:tt,type:s.type,property:s.property,default:s.default,stops:[]},R.push(tt)),D[tt].stops.push([H[0].value,H[1]])}const F=[];for(const G of R)F.push([D[G].zoom,fd(D[G],i)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:di.interpolationFactor.bind(void 0,V),zoomStops:F.map(G=>G[0]),evaluate:({zoom:G},H)=>an({stops:F,base:s.base},i,G).evaluate(G,H)}}if(g){const D=v==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:di.interpolationFactor.bind(void 0,D),zoomStops:s.stops.map(R=>R[0]),evaluate:({zoom:R})=>w(s,i,R,E,L)}}return{kind:"source",evaluate(D,R){const F=R&&R.properties?R.properties[s.property]:void 0;return F===void 0?Cu(s.default,i.default):w(s,i,F,E,L)}}}function Cu(s,i,l){return s!==void 0?s:i!==void 0?i:l!==void 0?l:void 0}function xr(s,i,l,p,g){return Cu(typeof l===g?p[l]:void 0,s.default,i.default)}function Pg(s,i,l){if(hn(l)!=="number")return Cu(s.default,i.default);const p=s.stops.length;if(p===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[p-1][0])return s.stops[p-1][1];const g=Iu(s.stops.map(v=>v[0]),l);return s.stops[g][1]}function an(s,i,l){const p=s.base!==void 0?s.base:1;if(hn(l)!=="number")return Cu(s.default,i.default);const g=s.stops.length;if(g===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[g-1][0])return s.stops[g-1][1];const v=Iu(s.stops.map(D=>D[0]),l),x=function(D,R,F,V){const G=V-F,H=D-F;return G===0?0:R===1?H/G:(Math.pow(R,H)-1)/(Math.pow(R,G)-1)}(l,p,s.stops[v][0],s.stops[v+1][0]),w=s.stops[v][1],E=s.stops[v+1][1],L=Ai[i.type]||Lg;return typeof w.evaluate=="function"?{evaluate(...D){const R=w.evaluate.apply(void 0,D),F=E.evaluate.apply(void 0,D);if(R!==void 0&&F!==void 0)return L(R,F,x,s.colorSpace)}}:L(w,E,x,s.colorSpace)}function pp(s,i,l){switch(i.type){case"color":l=Tn.parse(l);break;case"formatted":l=so.fromString(l.toString());break;case"resolvedImage":l=Ao.fromString(l.toString());break;case"padding":l=ji.parse(l);break;default:hn(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0)}return Cu(l,s.default,i.default)}lo.register(kl,{error:[{kind:"error"},[We],(s,[i])=>{throw new tr(i.evaluate(s))}],typeof:[We,[Oe],(s,[i])=>K(Mr(i.evaluate(s)))],"to-rgba":[q($t,4),[Pr],(s,[i])=>{const[l,p,g,v]=i.evaluate(s).rgb;return[255*l,255*p,255*g,v]}],rgb:[Pr,[$t,$t,$t],ud],rgba:[Pr,[$t,$t,$t,$t],ud],has:{type:Ge,overloads:[[[We],(s,[i])=>cd(i.evaluate(s),s.properties())],[[We,ps],(s,[i,l])=>cd(i.evaluate(s),l.evaluate(s))]]},get:{type:Oe,overloads:[[[We],(s,[i])=>cp(i.evaluate(s),s.properties())],[[We,ps],(s,[i,l])=>cp(i.evaluate(s),l.evaluate(s))]]},"feature-state":[Oe,[We],(s,[i])=>cp(i.evaluate(s),s.featureState||{})],properties:[ps,[],s=>s.properties()],"geometry-type":[We,[],s=>s.geometryType()],id:[Oe,[],s=>s.id()],zoom:[$t,[],s=>s.globals.zoom],"heatmap-density":[$t,[],s=>s.globals.heatmapDensity||0],"line-progress":[$t,[],s=>s.globals.lineProgress||0],accumulated:[Oe,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[$t,Ka($t),(s,i)=>{let l=0;for(const p of i)l+=p.evaluate(s);return l}],"*":[$t,Ka($t),(s,i)=>{let l=1;for(const p of i)l*=p.evaluate(s);return l}],"-":{type:$t,overloads:[[[$t,$t],(s,[i,l])=>i.evaluate(s)-l.evaluate(s)],[[$t],(s,[i])=>-i.evaluate(s)]]},"/":[$t,[$t,$t],(s,[i,l])=>i.evaluate(s)/l.evaluate(s)],"%":[$t,[$t,$t],(s,[i,l])=>i.evaluate(s)%l.evaluate(s)],ln2:[$t,[],()=>Math.LN2],pi:[$t,[],()=>Math.PI],e:[$t,[],()=>Math.E],"^":[$t,[$t,$t],(s,[i,l])=>Math.pow(i.evaluate(s),l.evaluate(s))],sqrt:[$t,[$t],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[$t,[$t],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[$t,[$t],(s,[i])=>Math.log(i.evaluate(s))],log2:[$t,[$t],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[$t,[$t],(s,[i])=>Math.sin(i.evaluate(s))],cos:[$t,[$t],(s,[i])=>Math.cos(i.evaluate(s))],tan:[$t,[$t],(s,[i])=>Math.tan(i.evaluate(s))],asin:[$t,[$t],(s,[i])=>Math.asin(i.evaluate(s))],acos:[$t,[$t],(s,[i])=>Math.acos(i.evaluate(s))],atan:[$t,[$t],(s,[i])=>Math.atan(i.evaluate(s))],min:[$t,Ka($t),(s,i)=>Math.min(...i.map(l=>l.evaluate(s)))],max:[$t,Ka($t),(s,i)=>Math.max(...i.map(l=>l.evaluate(s)))],abs:[$t,[$t],(s,[i])=>Math.abs(i.evaluate(s))],round:[$t,[$t],(s,[i])=>{const l=i.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[$t,[$t],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[$t,[$t],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[Ge,[We,Oe],(s,[i,l])=>s.properties()[i.value]===l.value],"filter-id-==":[Ge,[Oe],(s,[i])=>s.id()===i.value],"filter-type-==":[Ge,[We],(s,[i])=>s.geometryType()===i.value],"filter-<":[Ge,[We,Oe],(s,[i,l])=>{const p=s.properties()[i.value],g=l.value;return typeof p==typeof g&&p<g}],"filter-id-<":[Ge,[Oe],(s,[i])=>{const l=s.id(),p=i.value;return typeof l==typeof p&&l<p}],"filter->":[Ge,[We,Oe],(s,[i,l])=>{const p=s.properties()[i.value],g=l.value;return typeof p==typeof g&&p>g}],"filter-id->":[Ge,[Oe],(s,[i])=>{const l=s.id(),p=i.value;return typeof l==typeof p&&l>p}],"filter-<=":[Ge,[We,Oe],(s,[i,l])=>{const p=s.properties()[i.value],g=l.value;return typeof p==typeof g&&p<=g}],"filter-id-<=":[Ge,[Oe],(s,[i])=>{const l=s.id(),p=i.value;return typeof l==typeof p&&l<=p}],"filter->=":[Ge,[We,Oe],(s,[i,l])=>{const p=s.properties()[i.value],g=l.value;return typeof p==typeof g&&p>=g}],"filter-id->=":[Ge,[Oe],(s,[i])=>{const l=s.id(),p=i.value;return typeof l==typeof p&&l>=p}],"filter-has":[Ge,[Oe],(s,[i])=>i.value in s.properties()],"filter-has-id":[Ge,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Ge,[q(We)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[Ge,[q(Oe)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[Ge,[We,q(Oe)],(s,[i,l])=>l.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[Ge,[We,q(Oe)],(s,[i,l])=>function(p,g,v,x){for(;v<=x;){const w=v+x>>1;if(g[w]===p)return!0;g[w]>p?x=w-1:v=w+1}return!1}(s.properties()[i.value],l.value,0,l.value.length-1)],all:{type:Ge,overloads:[[[Ge,Ge],(s,[i,l])=>i.evaluate(s)&&l.evaluate(s)],[Ka(Ge),(s,i)=>{for(const l of i)if(!l.evaluate(s))return!1;return!0}]]},any:{type:Ge,overloads:[[[Ge,Ge],(s,[i,l])=>i.evaluate(s)||l.evaluate(s)],[Ka(Ge),(s,i)=>{for(const l of i)if(l.evaluate(s))return!0;return!1}]]},"!":[Ge,[Ge],(s,[i])=>!i.evaluate(s)],"is-supported-script":[Ge,[We],(s,[i])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(i.evaluate(s))}],upcase:[We,[We],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[We,[We],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[We,Ka(Oe),(s,i)=>i.map(l=>_u(l.evaluate(s))).join("")],"resolved-locale":[We,[Ha],(s,[i])=>i.evaluate(s).resolvedLocale()]});class Un{constructor(i,l){var p;this.expression=i,this._warningHistory={},this._evaluator=new Ln,this._defaultValue=l?(p=l).type==="color"&&Mc(p.default)?new Tn(0,0,0,0):p.type==="color"?Tn.parse(p.default)||null:p.type==="padding"?ji.parse(p.default)||null:p.type==="variableAnchorOffsetCollection"?Po.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,p,g,v,x){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=p,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(i,l,p,g,v,x){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=p||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new tr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function On(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in kl}function Ja(s,i){const l=new _c(kl,bu,[],i?function(g){const v={color:Pr,string:We,number:$t,enum:We,boolean:Ge,formatted:zr,padding:et,resolvedImage:z,variableAnchorOffsetCollection:B};return g.type==="array"?q(v[g.value]||Oe,g.length):v[g.type]}(i):void 0),p=l.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?hd(new Un(p,i)):Rl(l.errors)}class Dc{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!wu(l.expression)}evaluateWithoutErrorHandling(i,l,p,g,v,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,p,g,v,x)}evaluate(i,l,p,g,v,x){return this._styleExpression.evaluate(i,l,p,g,v,x)}}class fp{constructor(i,l,p,g){this.kind=i,this.zoomStops=p,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!wu(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,l,p,g,v,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,p,g,v,x)}evaluate(i,l,p,g,v,x){return this._styleExpression.evaluate(i,l,p,g,v,x)}interpolationFactor(i,l,p){return this.interpolationType?di.interpolationFactor(this.interpolationType,i,l,p):0}}function dd(s,i){const l=Ja(s,i);if(l.result==="error")return l;const p=l.value.expression,g=Ic(p);if(!g&&!Nl(i))return Rl([new oo("","data expressions not supported")]);const v=Su(p,["zoom"]);if(!v&&!pd(i))return Rl([new oo("","zoom expressions not supported")]);const x=Rc(p);return x||v?x instanceof oo?Rl([x]):x instanceof di&&!hp(i)?Rl([new oo("",'"interpolate" expressions cannot be used with this property')]):hd(x?new fp(g?"camera":"composite",l.value,x.labels,x instanceof di?x.interpolation:void 0):new Dc(g?"constant":"source",l.value)):Rl([new oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class kc{constructor(i,l){this._parameters=i,this._specification=l,hs(this,fd(this._parameters,this._specification))}static deserialize(i){return new kc(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Rc(s){let i=null;if(s instanceof Tc)i=Rc(s.result);else if(s instanceof Cc){for(const l of s.args)if(i=Rc(l),i)break}else(s instanceof Eu||s instanceof di)&&s.input instanceof lo&&s.input.name==="zoom"&&(i=s);return i instanceof oo||s.eachChild(l=>{const p=Rc(l);p instanceof oo?i=p:!i&&p?i=new oo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&p&&i!==p&&(i=new oo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Nc(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!Nc(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const md={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Oc(s){if(s==null)return{filter:()=>!0,needGeometry:!1};Nc(s)||(s=Fc(s));const i=Ja(s,md);if(i.result==="error")throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,p,g)=>i.value.evaluate(l,p,{},g),needGeometry:zc(s)}}function gd(s,i){return s<i?-1:s>i?1:0}function zc(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let i=1;i<s.length;i++)if(zc(s[i]))return!0;return!1}function Fc(s){if(!s)return!0;const i=s[0];return s.length<=1?i!=="any":i==="=="?dp(s[1],s[2],"=="):i==="!="?Bc(dp(s[1],s[2],"==")):i==="<"||i===">"||i==="<="||i===">="?dp(s[1],s[2],i):i==="any"?(l=s.slice(1),["any"].concat(l.map(Fc))):i==="all"?["all"].concat(s.slice(1).map(Fc)):i==="none"?["all"].concat(s.slice(1).map(Fc).map(Bc)):i==="in"?yd(s[1],s.slice(2)):i==="!in"?Bc(yd(s[1],s.slice(2))):i==="has"?_d(s[1]):i==="!has"?Bc(_d(s[1])):i!=="within"||s;var l}function dp(s,i,l){switch(s){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,s,i]}}function yd(s,i){if(i.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",s,["literal",i.sort(gd)]]:["filter-in-small",s,["literal",i]]}}function _d(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Bc(s){return["!",s]}function mp(s){const i=typeof s;if(i==="number"||i==="boolean"||i==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const v of s)g+=`${mp(v)},`;return`${g}]`}const l=Object.keys(s).sort();let p="{";for(let g=0;g<l.length;g++)p+=`${JSON.stringify(l[g])}:${mp(s[l[g]])},`;return`${p}}`}function Ag(s){let i="";for(const l of $n)i+=`/${mp(s[l])}`;return i}function vd(s){const i=s.value;return i?[new Wt(s.key,i,"constants have been deprecated as of v8")]:[]}function ar(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function xa(s){if(Array.isArray(s))return s.map(xa);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const l in s)i[l]=xa(s[l]);return i}return ar(s)}function Mi(s){const i=s.key,l=s.value,p=s.valueSpec||{},g=s.objectElementValidators||{},v=s.style,x=s.styleSpec,w=s.validateSpec;let E=[];const L=hn(l);if(L!=="object")return[new Wt(i,l,`object expected, ${L} found`)];for(const D in l){const R=D.split(".")[0],F=p[R]||p["*"];let V;if(g[R])V=g[R];else if(p[R])V=w;else if(g["*"])V=g["*"];else{if(!p["*"]){E.push(new Wt(i,l[D],`unknown property "${D}"`));continue}V=w}E=E.concat(V({key:(i&&`${i}.`)+D,value:l[D],valueSpec:F,style:v,styleSpec:x,object:l,objectKey:D,validateSpec:w},l))}for(const D in p)g[D]||p[D].required&&p[D].default===void 0&&l[D]===void 0&&E.push(new Wt(i,l,`missing required property "${D}"`));return E}function gp(s){const i=s.value,l=s.valueSpec,p=s.style,g=s.styleSpec,v=s.key,x=s.arrayElementValidator||s.validateSpec;if(hn(i)!=="array")return[new Wt(v,i,`array expected, ${hn(i)} found`)];if(l.length&&i.length!==l.length)return[new Wt(v,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new Wt(v,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let w={type:l.value,values:l.values};g.$version<7&&(w.function=l.function),hn(l.value)==="object"&&(w=l.value);let E=[];for(let L=0;L<i.length;L++)E=E.concat(x({array:i,arrayIndex:L,value:i[L],valueSpec:w,validateSpec:s.validateSpec,style:p,styleSpec:g,key:`${v}[${L}]`}));return E}function Vc(s){const i=s.key,l=s.value,p=s.valueSpec;let g=hn(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new Wt(i,l,`number expected, ${g} found`)]:"minimum"in p&&l<p.minimum?[new Wt(i,l,`${l} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&l>p.maximum?[new Wt(i,l,`${l} is greater than the maximum value ${p.maximum}`)]:[]}function xd(s){const i=s.valueSpec,l=ar(s.value.type);let p,g,v,x={};const w=l!=="categorical"&&s.value.property===void 0,E=!w,L=hn(s.value.stops)==="array"&&hn(s.value.stops[0])==="array"&&hn(s.value.stops[0][0])==="object",D=Mi({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(V){if(l==="identity")return[new Wt(V.key,V.value,'identity function may not have a "stops" property')];let G=[];const H=V.value;return G=G.concat(gp({key:V.key,value:H,valueSpec:V.valueSpec,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:R})),hn(H)==="array"&&H.length===0&&G.push(new Wt(V.key,H,"array must have at least one stop")),G},default:function(V){return V.validateSpec({key:V.key,value:V.value,valueSpec:i,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec})}}});return l==="identity"&&w&&D.push(new Wt(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||D.push(new Wt(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!hp(s.valueSpec)&&D.push(new Wt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(E&&!Nl(s.valueSpec)?D.push(new Wt(s.key,s.value,"property functions not supported")):w&&!pd(s.valueSpec)&&D.push(new Wt(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!L||s.value.property!==void 0||D.push(new Wt(s.key,s.value,'"property" property is required')),D;function R(V){let G=[];const H=V.value,tt=V.key;if(hn(H)!=="array")return[new Wt(tt,H,`array expected, ${hn(H)} found`)];if(H.length!==2)return[new Wt(tt,H,`array length 2 expected, length ${H.length} found`)];if(L){if(hn(H[0])!=="object")return[new Wt(tt,H,`object expected, ${hn(H[0])} found`)];if(H[0].zoom===void 0)return[new Wt(tt,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new Wt(tt,H,"object stop key must have value")];if(v&&v>ar(H[0].zoom))return[new Wt(tt,H[0].zoom,"stop zoom values must appear in ascending order")];ar(H[0].zoom)!==v&&(v=ar(H[0].zoom),g=void 0,x={}),G=G.concat(Mi({key:`${tt}[0]`,value:H[0],valueSpec:{zoom:{}},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Vc,value:F}}))}else G=G.concat(F({key:`${tt}[0]`,value:H[0],valueSpec:{},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec},H));return On(xa(H[1]))?G.concat([new Wt(`${tt}[1]`,H[1],"expressions are not allowed in function stops.")]):G.concat(V.validateSpec({key:`${tt}[1]`,value:H[1],valueSpec:i,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec}))}function F(V,G){const H=hn(V.value),tt=ar(V.value),ot=V.value!==null?V.value:G;if(p){if(H!==p)return[new Wt(V.key,ot,`${H} stop domain type must match previous stop domain type ${p}`)]}else p=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new Wt(V.key,ot,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&l!=="categorical"){let vt=`number expected, ${H} found`;return Nl(i)&&l===void 0&&(vt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Wt(V.key,ot,vt)]}return l!=="categorical"||H!=="number"||isFinite(tt)&&Math.floor(tt)===tt?l!=="categorical"&&H==="number"&&g!==void 0&&tt<g?[new Wt(V.key,ot,"stop domain values must appear in ascending order")]:(g=tt,l==="categorical"&&tt in x?[new Wt(V.key,ot,"stop domain values must be unique")]:(x[tt]=!0,[])):[new Wt(V.key,ot,`integer expected, found ${tt}`)]}}function ba(s){const i=(s.expressionContext==="property"?dd:Ja)(xa(s.value),s.valueSpec);if(i.result==="error")return i.value.map(p=>new Wt(`${s.key}${p.key}`,s.value,p.message));const l=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new Wt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!wu(l))return[new Wt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!wu(l))return[new Wt(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Su(l,["zoom","feature-state"]))return[new Wt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Ic(l))return[new Wt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wa(s){const i=s.key,l=s.value,p=s.valueSpec,g=[];return Array.isArray(p.values)?p.values.indexOf(ar(l))===-1&&g.push(new Wt(i,l,`expected one of [${p.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(p.values).indexOf(ar(l))===-1&&g.push(new Wt(i,l,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function Ol(s){return Nc(xa(s.value))?ba(hs({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):yp(s)}function yp(s){const i=s.value,l=s.key;if(hn(i)!=="array")return[new Wt(l,i,`array expected, ${hn(i)} found`)];const p=s.styleSpec;let g,v=[];if(i.length<1)return[new Wt(l,i,"filter array must have at least 1 element")];switch(v=v.concat(wa({key:`${l}[0]`,value:i[0],valueSpec:p.filter_operator,style:s.style,styleSpec:s.styleSpec})),ar(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&ar(i[1])==="$type"&&v.push(new Wt(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&v.push(new Wt(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=hn(i[1]),g!=="string"&&v.push(new Wt(`${l}[1]`,i[1],`string expected, ${g} found`)));for(let x=2;x<i.length;x++)g=hn(i[x]),ar(i[1])==="$type"?v=v.concat(wa({key:`${l}[${x}]`,value:i[x],valueSpec:p.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new Wt(`${l}[${x}]`,i[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<i.length;x++)v=v.concat(yp({key:`${l}[${x}]`,value:i[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=hn(i[1]),i.length!==2?v.push(new Wt(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new Wt(`${l}[1]`,i[1],`string expected, ${g} found`));break;case"within":g=hn(i[1]),i.length!==2?v.push(new Wt(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="object"&&v.push(new Wt(`${l}[1]`,i[1],`object expected, ${g} found`))}return v}function Uc(s,i){const l=s.key,p=s.validateSpec,g=s.style,v=s.styleSpec,x=s.value,w=s.objectKey,E=v[`${i}_${s.layerType}`];if(!E)return[];const L=w.match(/^(.*)-transition$/);if(i==="paint"&&L&&E[L[1]]&&E[L[1]].transition)return p({key:l,value:x,valueSpec:v.transition,style:g,styleSpec:v});const D=s.valueSpec||E[w];if(!D)return[new Wt(l,x,`unknown property "${w}"`)];let R;if(hn(x)==="string"&&Nl(D)&&!D.tokens&&(R=/^{([^}]+)}$/.exec(x)))return[new Wt(l,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const F=[];return s.layerType==="symbol"&&(w==="text-field"&&g&&!g.glyphs&&F.push(new Wt(l,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Mc(xa(x))&&ar(x.type)==="identity"&&F.push(new Wt(l,x,'"text-font" does not support identity functions'))),F.concat(p({key:s.key,value:x,valueSpec:D,style:g,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:w}))}function _p(s){return Uc(s,"paint")}function vp(s){return Uc(s,"layout")}function Tu(s){let i=[];const l=s.value,p=s.key,g=s.style,v=s.styleSpec;l.type||l.ref||i.push(new Wt(p,l,'either "type" or "ref" is required'));let x=ar(l.type);const w=ar(l.ref);if(l.id){const E=ar(l.id);for(let L=0;L<s.arrayIndex;L++){const D=g.layers[L];ar(D.id)===E&&i.push(new Wt(p,l.id,`duplicate layer id "${l.id}", previously used at line ${D.id.__line__}`))}}if("ref"in l){let E;["type","source","source-layer","filter","layout"].forEach(L=>{L in l&&i.push(new Wt(p,l[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{ar(L.id)===w&&(E=L)}),E?E.ref?i.push(new Wt(p,l.ref,"ref cannot reference another ref layer")):x=ar(E.type):i.push(new Wt(p,l.ref,`ref layer "${w}" not found`))}else if(x!=="background")if(l.source){const E=g.sources&&g.sources[l.source],L=E&&ar(E.type);E?L==="vector"&&x==="raster"?i.push(new Wt(p,l.source,`layer "${l.id}" requires a raster source`)):L!=="raster-dem"&&x==="hillshade"?i.push(new Wt(p,l.source,`layer "${l.id}" requires a raster-dem source`)):L==="raster"&&x!=="raster"?i.push(new Wt(p,l.source,`layer "${l.id}" requires a vector source`)):L!=="vector"||l["source-layer"]?L==="raster-dem"&&x!=="hillshade"?i.push(new Wt(p,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!l.paint||!l.paint["line-gradient"]||L==="geojson"&&E.lineMetrics||i.push(new Wt(p,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Wt(p,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new Wt(p,l.source,`source "${l.source}" not found`))}else i.push(new Wt(p,l,'missing required property "source"'));return i=i.concat(Mi({key:p,value:l,valueSpec:v.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${p}.type`,value:l.type,valueSpec:v.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:l,objectKey:"type"}),filter:Ol,layout:E=>Mi({layer:l,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":L=>vp(hs({layerType:x},L))}}),paint:E=>Mi({layer:l,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":L=>_p(hs({layerType:x},L))}})}})),i}function Qa(s){const i=s.value,l=s.key,p=hn(i);return p!=="string"?[new Wt(l,i,`string expected, ${p} found`)]:[]}const bd={promoteId:function({key:s,value:i}){if(hn(i)==="string")return Qa({key:s,value:i});{const l=[];for(const p in i)l.push(...Qa({key:`${s}.${p}`,value:i[p]}));return l}}};function wd(s){const i=s.value,l=s.key,p=s.styleSpec,g=s.style,v=s.validateSpec;if(!i.type)return[new Wt(l,i,'"type" is required')];const x=ar(i.type);let w;switch(x){case"vector":case"raster":return w=Mi({key:l,value:i,valueSpec:p[`source_${x.replace("-","_")}`],style:s.style,styleSpec:p,objectElementValidators:bd,validateSpec:v}),w;case"raster-dem":return w=function(E){var L;const D=(L=E.sourceName)!==null&&L!==void 0?L:"",R=E.value,F=E.styleSpec,V=F.source_raster_dem,G=E.style;let H=[];const tt=hn(R);if(R===void 0)return H;if(tt!=="object")return H.push(new Wt("source_raster_dem",R,`object expected, ${tt} found`)),H;const ot=ar(R.encoding)==="custom",vt=["redFactor","greenFactor","blueFactor","baseShift"],at=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const dt in R)!ot&&vt.includes(dt)?H.push(new Wt(dt,R[dt],`In "${D}": "${dt}" is only valid when "encoding" is set to "custom". ${at} encoding found`)):V[dt]?H=H.concat(E.validateSpec({key:dt,value:R[dt],valueSpec:V[dt],validateSpec:E.validateSpec,style:G,styleSpec:F})):H.push(new Wt(dt,R[dt],`unknown property "${dt}"`));return H}({sourceName:l,value:i,style:s.style,styleSpec:p,validateSpec:v}),w;case"geojson":if(w=Mi({key:l,value:i,valueSpec:p.source_geojson,style:g,styleSpec:p,validateSpec:v,objectElementValidators:bd}),i.cluster)for(const E in i.clusterProperties){const[L,D]=i.clusterProperties[E],R=typeof L=="string"?[L,["accumulated"],["get",E]]:L;w.push(...ba({key:`${l}.${E}.map`,value:D,validateSpec:v,expressionContext:"cluster-map"})),w.push(...ba({key:`${l}.${E}.reduce`,value:R,validateSpec:v,expressionContext:"cluster-reduce"}))}return w;case"video":return Mi({key:l,value:i,valueSpec:p.source_video,style:g,validateSpec:v,styleSpec:p});case"image":return Mi({key:l,value:i,valueSpec:p.source_image,style:g,validateSpec:v,styleSpec:p});case"canvas":return[new Wt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return wa({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:v,styleSpec:p})}}function Sd(s){const i=s.value,l=s.styleSpec,p=l.light,g=s.style;let v=[];const x=hn(i);if(i===void 0)return v;if(x!=="object")return v=v.concat([new Wt("light",i,`object expected, ${x} found`)]),v;for(const w in i){const E=w.match(/^(.*)-transition$/);v=v.concat(E&&p[E[1]]&&p[E[1]].transition?s.validateSpec({key:w,value:i[w],valueSpec:l.transition,validateSpec:s.validateSpec,style:g,styleSpec:l}):p[w]?s.validateSpec({key:w,value:i[w],valueSpec:p[w],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new Wt(w,i[w],`unknown property "${w}"`)])}return v}function Id(s){const i=s.value,l=s.styleSpec,p=l.sky,g=s.style,v=hn(i);if(i===void 0)return[];if(v!=="object")return[new Wt("sky",i,`object expected, ${v} found`)];let x=[];for(const w in i)x=x.concat(p[w]?ms({key:w,value:i[w],valueSpec:p[w],style:g,styleSpec:l}):[new Wt(w,i[w],`unknown property "${w}"`)]);return x}function Lu(s){const i=s.value,l=s.styleSpec,p=l.terrain,g=s.style;let v=[];const x=hn(i);if(i===void 0)return v;if(x!=="object")return v=v.concat([new Wt("terrain",i,`object expected, ${x} found`)]),v;for(const w in i)v=v.concat(p[w]?s.validateSpec({key:w,value:i[w],valueSpec:p[w],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new Wt(w,i[w],`unknown property "${w}"`)]);return v}function Pu(s){let i=[];const l=s.value,p=s.key;if(Array.isArray(l)){const g=[],v=[];for(const x in l)l[x].id&&g.includes(l[x].id)&&i.push(new Wt(p,l,`all the sprites' ids must be unique, but ${l[x].id} is duplicated`)),g.push(l[x].id),l[x].url&&v.includes(l[x].url)&&i.push(new Wt(p,l,`all the sprites' URLs must be unique, but ${l[x].url} is duplicated`)),v.push(l[x].url),i=i.concat(Mi({key:`${p}[${x}]`,value:l[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return i}return Qa({key:p,value:l})}const Wi={"*":()=>[],array:gp,boolean:function(s){const i=s.value,l=s.key,p=hn(i);return p!=="boolean"?[new Wt(l,i,`boolean expected, ${p} found`)]:[]},number:Vc,color:function(s){const i=s.key,l=s.value,p=hn(l);return p!=="string"?[new Wt(i,l,`color expected, ${p} found`)]:Tn.parse(String(l))?[]:[new Wt(i,l,`color expected, "${l}" found`)]},constants:vd,enum:wa,filter:Ol,function:xd,layer:Tu,object:Mi,source:wd,light:Sd,sky:Id,terrain:Lu,string:Qa,formatted:function(s){return Qa(s).length===0?[]:ba(s)},resolvedImage:function(s){return Qa(s).length===0?[]:ba(s)},padding:function(s){const i=s.key,l=s.value;if(hn(l)==="array"){if(l.length<1||l.length>4)return[new Wt(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];const p={type:"number"};let g=[];for(let v=0;v<l.length;v++)g=g.concat(s.validateSpec({key:`${i}[${v}]`,value:l[v],validateSpec:s.validateSpec,valueSpec:p}));return g}return Vc({key:i,value:l,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const i=s.key,l=s.value,p=hn(l),g=s.styleSpec;if(p!=="array"||l.length<1||l.length%2!=0)return[new Wt(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<l.length;x+=2)v=v.concat(wa({key:`${i}[${x}]`,value:l[x],valueSpec:g.layout_symbol["text-anchor"]})),v=v.concat(gp({key:`${i}[${x+1}]`,value:l[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return v},sprite:Pu};function ms(s){const i=s.value,l=s.valueSpec,p=s.styleSpec;return s.validateSpec=ms,l.expression&&Mc(ar(i))?xd(s):l.expression&&On(xa(i))?ba(s):l.type&&Wi[l.type]?Wi[l.type](s):Mi(hs({},s,{valueSpec:l.type?p[l.type]:l}))}function xp(s){const i=s.value,l=s.key,p=Qa(s);return p.length||(i.indexOf("{fontstack}")===-1&&p.push(new Wt(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&p.push(new Wt(l,i,'"glyphs" url must include a "{range}" token'))),p}function jo(s,i=Ct){let l=[];return l=l.concat(ms({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:ms,objectElementValidators:{glyphs:xp,"*":()=>[]}})),s.constants&&(l=l.concat(vd({key:"constants",value:s.constants,style:s,styleSpec:i,validateSpec:ms}))),zl(l)}function gs(s){return function(i){return s({...i,validateSpec:ms})}}function zl(s){return[].concat(s).sort((i,l)=>i.line-l.line)}function Wo(s){return function(...i){return zl(s.apply(this,i))}}jo.source=Wo(gs(wd)),jo.sprite=Wo(gs(Pu)),jo.glyphs=Wo(gs(xp)),jo.light=Wo(gs(Sd)),jo.sky=Wo(gs(Id)),jo.terrain=Wo(gs(Lu)),jo.layer=Wo(gs(Tu)),jo.filter=Wo(gs(Ol)),jo.paintProperty=Wo(gs(_p)),jo.layoutProperty=Wo(gs(vp));const $a=jo,Mg=$a.light,bp=$a.paintProperty,Dg=$a.layoutProperty;function Fl(s,i){let l=!1;if(i&&i.length)for(const p of i)s.fire(new ke(new Error(p.message))),l=!0;return l}class Au{constructor(i,l,p){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(l=x[1])+2*(p=x[2]);for(let E=0;E<this.d*this.d;E++){const L=x[3+E],D=x[3+E+1];g.push(L===D?null:x.subarray(L,D))}const w=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],w),this.bboxes=x.subarray(w),this.insert=this._insertReadonly}else{this.d=l+2*p;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=p,this.scale=l/i,this.uid=0;const v=p/l*i;this.min=-v,this.max=i+v}insert(i,l,p,g,v){this._forEachCell(l,p,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,p,g,v,x){this.cells[v].push(x)}query(i,l,p,g,v){const x=this.min,w=this.max;if(i<=x&&l<=x&&w<=p&&w<=g&&!v)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(i,l,p,g,this._queryCell,E,{},v),E}}_queryCell(i,l,p,g,v,x,w,E){const L=this.cells[v];if(L!==null){const D=this.keys,R=this.bboxes;for(let F=0;F<L.length;F++){const V=L[F];if(w[V]===void 0){const G=4*V;(E?E(R[G+0],R[G+1],R[G+2],R[G+3]):i<=R[G+2]&&l<=R[G+3]&&p>=R[G+0]&&g>=R[G+1])?(w[V]=!0,x.push(D[V])):w[V]=!1}}}}_forEachCell(i,l,p,g,v,x,w,E){const L=this._convertToCellCoord(i),D=this._convertToCellCoord(l),R=this._convertToCellCoord(p),F=this._convertToCellCoord(g);for(let V=L;V<=R;V++)for(let G=D;G<=F;G++){const H=this.d*G+V;if((!E||E(this._convertFromCellCoord(V),this._convertFromCellCoord(G),this._convertFromCellCoord(V+1),this._convertFromCellCoord(G+1)))&&v.call(this,i,l,p,g,H,x,w,E))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let p=0;for(let x=0;x<this.cells.length;x++)p+=this.cells[x].length;const g=new Int32Array(l+p+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=l;for(let x=0;x<i.length;x++){const w=i[x];g[3+x]=v,g.set(w,v),v+=w.length}return g[3+i.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+i.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(i,l){const p=i.toArrayBuffer();return l&&l.push(p),{buffer:p}}static deserialize(i){return new Au(i.buffer)}}const ys={};function ae(s,i,l={}){if(ys[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),ys[s]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}ae("Object",Object),ae("TransferableGridIndex",Au),ae("Color",Tn),ae("Error",Error),ae("AJAXError",zn),ae("ResolvedImage",Ao),ae("StylePropertyFunction",kc),ae("StyleExpression",Un,{omit:["_evaluator"]}),ae("ZoomDependentExpression",fp),ae("ZoomConstantExpression",Dc),ae("CompoundExpression",lo,{omit:["_evaluate"]});for(const s in kl)kl[s]._classRegistryKey||ae(`Expression_${s}`,kl[s]);function Gc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Bl(s,i){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(Gc(s)||tn(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return i&&i.push(l.buffer),l}if(s instanceof ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const p of s)l.push(Bl(p,i));return l}if(typeof s=="object"){const l=s.constructor,p=l._classRegistryKey;if(!p)throw new Error(`can't serialize object of unregistered class ${l.name}`);if(!ys[p])throw new Error(`${p} is not registered.`);const g=l.serialize?l.serialize(s,i):{};if(l.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in s){if(!s.hasOwnProperty(v)||ys[p].omit.indexOf(v)>=0)continue;const x=s[v];g[v]=ys[p].shallow.indexOf(v)>=0?x:Bl(x,i)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(g.$name=p),g}throw new Error("can't serialize object of type "+typeof s)}function Vl(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||Gc(s)||tn(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Vl);if(typeof s=="object"){const i=s.$name||"Object";if(!ys[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=ys[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(s);const p=Object.create(l.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const v=s[g];p[g]=ys[i].shallow.indexOf(g)>=0?v:Vl(v)}return p}throw new Error("can't deserialize object of type "+typeof s)}class Ed{constructor(){this.first=!0}update(i,l){const p=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=p,!0))}}const ne={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Ul(s){for(const i of s)if(qc(i.charCodeAt(0)))return!0;return!1}function Cd(s){for(const i of s)if(!Td(i.charCodeAt(0)))return!1;return!0}function Td(s){return!(ne.Arabic(s)||ne["Arabic Supplement"](s)||ne["Arabic Extended-A"](s)||ne["Arabic Presentation Forms-A"](s)||ne["Arabic Presentation Forms-B"](s))}function qc(s){return!(s!==746&&s!==747&&(s<4352||!(ne["Bopomofo Extended"](s)||ne.Bopomofo(s)||ne["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||ne["CJK Compatibility Ideographs"](s)||ne["CJK Compatibility"](s)||ne["CJK Radicals Supplement"](s)||ne["CJK Strokes"](s)||!(!ne["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||ne["CJK Unified Ideographs Extension A"](s)||ne["CJK Unified Ideographs"](s)||ne["Enclosed CJK Letters and Months"](s)||ne["Hangul Compatibility Jamo"](s)||ne["Hangul Jamo Extended-A"](s)||ne["Hangul Jamo Extended-B"](s)||ne["Hangul Jamo"](s)||ne["Hangul Syllables"](s)||ne.Hiragana(s)||ne["Ideographic Description Characters"](s)||ne.Kanbun(s)||ne["Kangxi Radicals"](s)||ne["Katakana Phonetic Extensions"](s)||ne.Katakana(s)&&s!==12540||!(!ne["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!ne["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||ne["Unified Canadian Aboriginal Syllabics"](s)||ne["Unified Canadian Aboriginal Syllabics Extended"](s)||ne["Vertical Forms"](s)||ne["Yijing Hexagram Symbols"](s)||ne["Yi Syllables"](s)||ne["Yi Radicals"](s))))}function wp(s){return!(qc(s)||function(i){return!!(ne["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||ne["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||ne["Letterlike Symbols"](i)||ne["Number Forms"](i)||ne["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||ne["Control Pictures"](i)&&i!==9251||ne["Optical Character Recognition"](i)||ne["Enclosed Alphanumerics"](i)||ne["Geometric Shapes"](i)||ne["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||ne["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||ne["CJK Symbols and Punctuation"](i)||ne.Katakana(i)||ne["Private Use Area"](i)||ne["CJK Compatibility Forms"](i)||ne["Small Form Variants"](i)||ne["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(s))}function jc(s){return s>=1424&&s<=2303||ne["Arabic Presentation Forms-A"](s)||ne["Arabic Presentation Forms-B"](s)}function Ld(s,i){return!(!i&&jc(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||ne.Khmer(s))}function kg(s){for(const i of s)if(jc(i.charCodeAt(0)))return!0;return!1}const Sa=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Hn{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ed,this.transition={})}isSupportedScript(i){return function(l,p){for(const g of l)if(!Ld(g.charCodeAt(0),p))return!1;return!0}(i,Sa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),p=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*l}}}class Mu{constructor(i,l){this.property=i,this.value=l,this.expression=function(p,g){if(Mc(p))return new kc(p,g);if(On(p)){const v=dd(p,g);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=p;return g.type==="color"&&typeof p=="string"?v=Tn.parse(p):g.type!=="padding"||typeof p!="number"&&!Array.isArray(p)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(p)&&(v=Po.parse(p)):v=ji.parse(p),{kind:"constant",evaluate:()=>v}}}(l===void 0?i.specification.default:l,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,l,p){return this.property.possiblyEvaluate(this,i,l,p)}}class Wc{constructor(i){this.property=i,this.value=new Mu(i,void 0)}transitioned(i,l){return new Pd(this.property,this.value,l,At({},i.transition,this.transition),i.now)}untransitioned(){return new Pd(this.property,this.value,null,{},0)}}class Sp{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return J(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Wc(this._values[i].property)),this._values[i].value=new Mu(this._values[i].property,l===null?void 0:J(l))}getTransition(i){return J(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Wc(this._values[i].property)),this._values[i].transition=J(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const p=this.getValue(l);p!==void 0&&(i[l]=p);const g=this.getTransition(l);g!==void 0&&(i[`${l}-transition`]=g)}return i}transitioned(i,l){const p=new Ad(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].transitioned(i,l._values[g]);return p}untransitioned(){const i=new Ad(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class Pd{constructor(i,l,p,g,v){this.property=i,this.value=l,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=p)}possiblyEvaluate(i,l,p){const g=i.now||0,v=this.value.possiblyEvaluate(i,l,p),x=this.prior;if(x){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return x.possiblyEvaluate(i,l,p);{const w=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(i,l,p),v,function(E){if(E<=0)return 0;if(E>=1)return 1;const L=E*E,D=L*E;return 4*(E<.5?D:3*(E-L)+D-.75)}(w))}}return v}}class Ad{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,p){const g=new Du(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(i,l,p);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Md{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return J(this._values[i].value)}setValue(i,l){this._values[i]=new Mu(this._values[i].property,l===null?void 0:J(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const p=this.getValue(l);p!==void 0&&(i[l]=p)}return i}possiblyEvaluate(i,l,p){const g=new Du(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(i,l,p);return g}}class Zo{constructor(i,l,p){this.property=i,this.value=l,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,p,g){return this.property.evaluate(this.value,this.parameters,i,l,p,g)}}class Du{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class me{constructor(i){this.specification=i}possiblyEvaluate(i,l){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(l)}interpolate(i,l,p){const g=Ai[this.specification.type];return g?g(i,l,p):i}}class be{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,p,g){return new Zo(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(l,null,{},p,g)}:i.expression,l)}interpolate(i,l,p){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new Zo(this,{kind:"constant",value:void 0},i.parameters);const g=Ai[this.specification.type];if(g){const v=g(i.value.value,l.value.value,p);return new Zo(this,{kind:"constant",value:v},i.parameters)}return i}evaluate(i,l,p,g,v,x){return i.kind==="constant"?i.value:i.evaluate(l,p,g,v,x)}}class Zc extends be{possiblyEvaluate(i,l,p,g){if(i.value===void 0)return new Zo(this,{kind:"constant",value:void 0},l);if(i.expression.kind==="constant"){const v=i.expression.evaluate(l,null,{},p,g),x=i.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,w=this._calculate(x,x,x,l);return new Zo(this,{kind:"constant",value:w},l)}if(i.expression.kind==="camera"){const v=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new Zo(this,{kind:"constant",value:v},l)}return new Zo(this,i.expression,l)}evaluate(i,l,p,g,v,x){if(i.kind==="source"){const w=i.evaluate(l,p,g,v,x);return this._calculate(w,w,w,l)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},p,g),i.evaluate({zoom:Math.floor(l.zoom)},p,g),i.evaluate({zoom:Math.floor(l.zoom)+1},p,g),l):i.value}_calculate(i,l,p,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:p,to:l}}interpolate(i){return i}}class ku{constructor(i){this.specification=i}possiblyEvaluate(i,l,p,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const v=i.expression.evaluate(l,null,{},p,g);return this._calculate(v,v,v,l)}return this._calculate(i.expression.evaluate(new Hn(Math.floor(l.zoom-1),l)),i.expression.evaluate(new Hn(Math.floor(l.zoom),l)),i.expression.evaluate(new Hn(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,p,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:p,to:l}}interpolate(i){return i}}class Ip{constructor(i){this.specification=i}possiblyEvaluate(i,l,p,g){return!!i.expression.evaluate(l,null,{},p,g)}interpolate(){return!1}}class Zi{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const p=i[l];p.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new Mu(p,void 0),v=this.defaultTransitionablePropertyValues[l]=new Wc(p);this.defaultTransitioningPropertyValues[l]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}ae("DataDrivenProperty",be),ae("DataConstantProperty",me),ae("CrossFadedDataDrivenProperty",Zc),ae("CrossFadedProperty",ku),ae("ColorRampProperty",Ip);const Ep="-transition";class Ho extends cn{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new Md(l.layout)),l.paint)){this._transitionablePaint=new Sp(l.paint);for(const p in i.paint)this.setPaintProperty(p,i.paint[p],{validate:!1});for(const p in i.layout)this.setLayoutProperty(p,i.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Du(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,p={}){l!=null&&this._validate(Dg,`layers.${this.id}.layout.${i}`,i,l,p)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(Ep)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,p={}){if(l!=null&&this._validate(bp,`layers.${this.id}.paint.${i}`,i,l,p))return!1;if(i.endsWith(Ep))return this._transitionablePaint.setTransition(i.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[i],v=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),w=g.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const E=this._transitionablePaint._values[i].value;return E.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(i,w,E)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,p){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),Yt(i,(l,p)=>!(l===void 0||p==="layout"&&!Object.keys(l).length||p==="paint"&&!Object.keys(l).length))}_validate(i,l,p,g,v={}){return(!v||v.validate!==!1)&&Fl(this,i.call($a,{key:l,layerType:this.type,objectKey:p,value:g,styleSpec:Ct,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof Zo&&Nl(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const Dd={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ru{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class lr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function br(s,i=1){let l=0,p=0;return{members:s.map(g=>{const v=Dd[g.type].BYTES_PER_ELEMENT,x=l=kd(l,Math.max(i,v)),w=g.components||1;return p=Math.max(p,v),l+=v*w,{name:g.name,type:g.type,components:w,offset:x}}),size:kd(l,Math.max(p,i)),alignment:i}}function kd(s,i){return Math.ceil(s/i)*i}class Nu extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const p=this.length;return this.resize(p+1),this.emplace(p,i,l)}emplace(i,l,p){const g=2*i;return this.int16[g+0]=l,this.int16[g+1]=p,i}}Nu.prototype.bytesPerElement=4,ae("StructArrayLayout2i4",Nu);class js extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,p)}emplace(i,l,p,g){const v=3*i;return this.int16[v+0]=l,this.int16[v+1]=p,this.int16[v+2]=g,i}}js.prototype.bytesPerElement=6,ae("StructArrayLayout3i6",js);class Cp extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,p,g)}emplace(i,l,p,g,v){const x=4*i;return this.int16[x+0]=l,this.int16[x+1]=p,this.int16[x+2]=g,this.int16[x+3]=v,i}}Cp.prototype.bytesPerElement=8,ae("StructArrayLayout4i8",Cp);class Tp extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,p,g,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,p,g,v,x)}emplace(i,l,p,g,v,x,w){const E=6*i;return this.int16[E+0]=l,this.int16[E+1]=p,this.int16[E+2]=g,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=w,i}}Tp.prototype.bytesPerElement=12,ae("StructArrayLayout2i4i12",Tp);class Lp extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,p,g,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,p,g,v,x)}emplace(i,l,p,g,v,x,w){const E=4*i,L=8*i;return this.int16[E+0]=l,this.int16[E+1]=p,this.uint8[L+4]=g,this.uint8[L+5]=v,this.uint8[L+6]=x,this.uint8[L+7]=w,i}}Lp.prototype.bytesPerElement=8,ae("StructArrayLayout2i4ub8",Lp);class Ou extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const p=this.length;return this.resize(p+1),this.emplace(p,i,l)}emplace(i,l,p){const g=2*i;return this.float32[g+0]=l,this.float32[g+1]=p,i}}Ou.prototype.bytesPerElement=8,ae("StructArrayLayout2f8",Ou);class Hc extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,p,g,v,x,w,E,L,D){const R=this.length;return this.resize(R+1),this.emplace(R,i,l,p,g,v,x,w,E,L,D)}emplace(i,l,p,g,v,x,w,E,L,D,R){const F=10*i;return this.uint16[F+0]=l,this.uint16[F+1]=p,this.uint16[F+2]=g,this.uint16[F+3]=v,this.uint16[F+4]=x,this.uint16[F+5]=w,this.uint16[F+6]=E,this.uint16[F+7]=L,this.uint16[F+8]=D,this.uint16[F+9]=R,i}}Hc.prototype.bytesPerElement=20,ae("StructArrayLayout10ui20",Hc);class Pp extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,p,g,v,x,w,E,L,D,R,F){const V=this.length;return this.resize(V+1),this.emplace(V,i,l,p,g,v,x,w,E,L,D,R,F)}emplace(i,l,p,g,v,x,w,E,L,D,R,F,V){const G=12*i;return this.int16[G+0]=l,this.int16[G+1]=p,this.int16[G+2]=g,this.int16[G+3]=v,this.uint16[G+4]=x,this.uint16[G+5]=w,this.uint16[G+6]=E,this.uint16[G+7]=L,this.int16[G+8]=D,this.int16[G+9]=R,this.int16[G+10]=F,this.int16[G+11]=V,i}}Pp.prototype.bytesPerElement=24,ae("StructArrayLayout4i4ui4i24",Pp);class Ap extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,p)}emplace(i,l,p,g){const v=3*i;return this.float32[v+0]=l,this.float32[v+1]=p,this.float32[v+2]=g,i}}Ap.prototype.bytesPerElement=12,ae("StructArrayLayout3f12",Ap);class Ws extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Ws.prototype.bytesPerElement=4,ae("StructArrayLayout1ul4",Ws);class Xc extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,p,g,v,x,w,E,L){const D=this.length;return this.resize(D+1),this.emplace(D,i,l,p,g,v,x,w,E,L)}emplace(i,l,p,g,v,x,w,E,L,D){const R=10*i,F=5*i;return this.int16[R+0]=l,this.int16[R+1]=p,this.int16[R+2]=g,this.int16[R+3]=v,this.int16[R+4]=x,this.int16[R+5]=w,this.uint32[F+3]=E,this.uint16[R+8]=L,this.uint16[R+9]=D,i}}Xc.prototype.bytesPerElement=20,ae("StructArrayLayout6i1ul2ui20",Xc);class zu extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,p,g,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,p,g,v,x)}emplace(i,l,p,g,v,x,w){const E=6*i;return this.int16[E+0]=l,this.int16[E+1]=p,this.int16[E+2]=g,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=w,i}}zu.prototype.bytesPerElement=12,ae("StructArrayLayout2i2i2i12",zu);class Yc extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,p,g,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,p,g,v)}emplace(i,l,p,g,v,x){const w=4*i,E=8*i;return this.float32[w+0]=l,this.float32[w+1]=p,this.float32[w+2]=g,this.int16[E+6]=v,this.int16[E+7]=x,i}}Yc.prototype.bytesPerElement=16,ae("StructArrayLayout2f1f2i16",Yc);class Fu extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,p,g)}emplace(i,l,p,g,v){const x=12*i,w=3*i;return this.uint8[x+0]=l,this.uint8[x+1]=p,this.float32[w+1]=g,this.float32[w+2]=v,i}}Fu.prototype.bytesPerElement=12,ae("StructArrayLayout2ub2f12",Fu);class Kc extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,p)}emplace(i,l,p,g){const v=3*i;return this.uint16[v+0]=l,this.uint16[v+1]=p,this.uint16[v+2]=g,i}}Kc.prototype.bytesPerElement=6,ae("StructArrayLayout3ui6",Kc);class Gl extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,p,g,v,x,w,E,L,D,R,F,V,G,H,tt,ot){const vt=this.length;return this.resize(vt+1),this.emplace(vt,i,l,p,g,v,x,w,E,L,D,R,F,V,G,H,tt,ot)}emplace(i,l,p,g,v,x,w,E,L,D,R,F,V,G,H,tt,ot,vt){const at=24*i,dt=12*i,kt=48*i;return this.int16[at+0]=l,this.int16[at+1]=p,this.uint16[at+2]=g,this.uint16[at+3]=v,this.uint32[dt+2]=x,this.uint32[dt+3]=w,this.uint32[dt+4]=E,this.uint16[at+10]=L,this.uint16[at+11]=D,this.uint16[at+12]=R,this.float32[dt+7]=F,this.float32[dt+8]=V,this.uint8[kt+36]=G,this.uint8[kt+37]=H,this.uint8[kt+38]=tt,this.uint32[dt+10]=ot,this.int16[at+22]=vt,i}}Gl.prototype.bytesPerElement=48,ae("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Gl);class tl extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,p,g,v,x,w,E,L,D,R,F,V,G,H,tt,ot,vt,at,dt,kt,Ot,ie,fe,re,ee,Ht,ce){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,i,l,p,g,v,x,w,E,L,D,R,F,V,G,H,tt,ot,vt,at,dt,kt,Ot,ie,fe,re,ee,Ht,ce)}emplace(i,l,p,g,v,x,w,E,L,D,R,F,V,G,H,tt,ot,vt,at,dt,kt,Ot,ie,fe,re,ee,Ht,ce,Jt){const Gt=32*i,ve=16*i;return this.int16[Gt+0]=l,this.int16[Gt+1]=p,this.int16[Gt+2]=g,this.int16[Gt+3]=v,this.int16[Gt+4]=x,this.int16[Gt+5]=w,this.int16[Gt+6]=E,this.int16[Gt+7]=L,this.uint16[Gt+8]=D,this.uint16[Gt+9]=R,this.uint16[Gt+10]=F,this.uint16[Gt+11]=V,this.uint16[Gt+12]=G,this.uint16[Gt+13]=H,this.uint16[Gt+14]=tt,this.uint16[Gt+15]=ot,this.uint16[Gt+16]=vt,this.uint16[Gt+17]=at,this.uint16[Gt+18]=dt,this.uint16[Gt+19]=kt,this.uint16[Gt+20]=Ot,this.uint16[Gt+21]=ie,this.uint16[Gt+22]=fe,this.uint32[ve+12]=re,this.float32[ve+13]=ee,this.float32[ve+14]=Ht,this.uint16[Gt+30]=ce,this.uint16[Gt+31]=Jt,i}}tl.prototype.bytesPerElement=64,ae("StructArrayLayout8i15ui1ul2f2ui64",tl);class Jc extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}Jc.prototype.bytesPerElement=4,ae("StructArrayLayout1f4",Jc);class Qc extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,p)}emplace(i,l,p,g){const v=3*i;return this.uint16[6*i+0]=l,this.float32[v+1]=p,this.float32[v+2]=g,i}}Qc.prototype.bytesPerElement=12,ae("StructArrayLayout1ui2f12",Qc);class el extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,p){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,p)}emplace(i,l,p,g){const v=4*i;return this.uint32[2*i+0]=l,this.uint16[v+2]=p,this.uint16[v+3]=g,i}}el.prototype.bytesPerElement=8,ae("StructArrayLayout1ul2ui8",el);class Mp extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const p=this.length;return this.resize(p+1),this.emplace(p,i,l)}emplace(i,l,p){const g=2*i;return this.uint16[g+0]=l,this.uint16[g+1]=p,i}}Mp.prototype.bytesPerElement=4,ae("StructArrayLayout2ui4",Mp);class Dp extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}Dp.prototype.bytesPerElement=2,ae("StructArrayLayout1ui2",Dp);class $c extends lr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,p,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,p,g)}emplace(i,l,p,g,v){const x=4*i;return this.float32[x+0]=l,this.float32[x+1]=p,this.float32[x+2]=g,this.float32[x+3]=v,i}}$c.prototype.bytesPerElement=16,ae("StructArrayLayout4f16",$c);class Rd extends Ru{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new P(this.anchorPointX,this.anchorPointY)}}Rd.prototype.size=20;class y extends Xc{get(i){return new Rd(this,i)}}ae("CollisionBoxArray",y);class o extends Ru{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}o.prototype.size=48;class h extends Gl{get(i){return new o(this,i)}}ae("PlacedSymbolArray",h);class d extends Ru{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}d.prototype.size=64;class m extends tl{get(i){return new d(this,i)}}ae("SymbolInstanceArray",m);class _ extends Jc{getoffsetX(i){return this.float32[1*i+0]}}ae("GlyphOffsetArray",_);class S extends js{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}ae("SymbolLineVertexArray",S);class I extends Ru{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}I.prototype.size=12;class T extends Qc{get(i){return new I(this,i)}}ae("TextAnchorOffsetArray",T);class M extends Ru{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}M.prototype.size=8;class N extends el{get(i){return new M(this,i)}}ae("FeatureIndexArray",N);class O extends Nu{}class U extends Nu{}class $ extends Nu{}class Q extends Tp{}class nt extends Lp{}class Z extends Ou{}class ct extends Hc{}class It extends Pp{}class it extends Ap{}class mt extends Ws{}class Et extends zu{}class Pt extends Fu{}class Dt extends Kc{}class Bt extends Mp{}const Ft=br([{name:"a_pos",components:2,type:"Int16"}],4),{members:jt}=Ft;class Xt{constructor(i=[]){this.segments=i}prepareSegment(i,l,p,g){let v=this.segments[this.segments.length-1];return i>Xt.MAX_VERTEX_ARRAY_LENGTH&&te(`Max vertices per segment is ${Xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!v||v.vertexLength+i>Xt.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g)&&(v={vertexOffset:l.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},g!==void 0&&(v.sortKey=g),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,p,g){return new Xt([{vertexOffset:i,primitiveOffset:l,vertexLength:p,primitiveLength:g,vaos:{},sortKey:0}])}}function Fe(s,i){return 256*(s=gt(Math.floor(s),0,255))+gt(Math.floor(i),0,255)}Xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ae("SegmentVector",Xt);const Kt=br([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Se={exports:{}},Be={exports:{}};Be.exports=function(s,i){var l,p,g,v,x,w,E,L;for(p=s.length-(l=3&s.length),g=i,x=3432918353,w=461845907,L=0;L<p;)E=255&s.charCodeAt(L)|(255&s.charCodeAt(++L))<<8|(255&s.charCodeAt(++L))<<16|(255&s.charCodeAt(++L))<<24,++L,g=27492+(65535&(v=5*(65535&(g=(g^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(E=0,l){case 3:E^=(255&s.charCodeAt(L+2))<<16;case 2:E^=(255&s.charCodeAt(L+1))<<8;case 1:g^=E=(65535&(E=(E=(65535&(E^=255&s.charCodeAt(L)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var ln=Be.exports,Le={exports:{}};Le.exports=function(s,i){for(var l,p=s.length,g=i^p,v=0;p>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24))+((1540483477*(l>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),p-=4,++v;switch(p){case 3:g^=(255&s.charCodeAt(v+2))<<16;case 2:g^=(255&s.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var je=ln,He=Le.exports;Se.exports=je,Se.exports.murmur3=je,Se.exports.murmur2=He;var ur=b(Se.exports);class Pn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,p,g){this.ids.push(uo(i)),this.positions.push(l,p,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=uo(i);let p=0,g=this.ids.length-1;for(;p<g;){const x=p+g>>1;this.ids[x]>=l?g=x:p=x+1}const v=[];for(;this.ids[p]===l;)v.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return v}static serialize(i,l){const p=new Float64Array(i.ids),g=new Uint32Array(i.positions);return Br(p,g,0,p.length-1),l&&l.push(p.buffer,g.buffer),{ids:p,positions:g}}static deserialize(i){const l=new Pn;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function uo(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:ur(String(s))}function Br(s,i,l,p){for(;l<p;){const g=s[l+p>>1];let v=l-1,x=p+1;for(;;){do v++;while(s[v]<g);do x--;while(s[x]>g);if(v>=x)break;er(s,v,x),er(i,3*v,3*x),er(i,3*v+1,3*x+1),er(i,3*v+2,3*x+2)}x-l<p-x?(Br(s,i,l,x),l=x+1):(Br(s,i,x+1,p),p=x)}}function er(s,i,l){const p=s[i];s[i]=s[l],s[l]=p}ae("FeaturePositionMap",Pn);class Vr{constructor(i,l){this.gl=i.gl,this.location=l}}class co extends Vr{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class _s extends Vr{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Ia extends Vr{constructor(i,l){super(i,l),this.current=Tn.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Bu=new Float32Array(16);function Ea(s){return[Fe(255*s.r,255*s.g),Fe(255*s.b,255*s.a)]}class vs{constructor(i,l,p){this.value=i,this.uniformNames=l.map(g=>`u_${g}`),this.type=p}setUniform(i,l,p){i.set(p.constantOr(this.value))}getBinding(i,l,p){return this.type==="color"?new Ia(i,l):new co(i,l)}}class Dr{constructor(i,l){this.uniformNames=l.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,p,g){const v=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&i.set(v)}getBinding(i,l,p){return p.substr(0,9)==="u_pattern"?new _s(i,l):new co(i,l)}}class nr{constructor(i,l,p,g){this.expression=i,this.type=p,this.maxValue=0,this.paintVertexAttributes=l.map(v=>({name:`a_${v}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,l,p,g,v){const x=this.paintVertexArray.length,w=this.expression.evaluate(new Hn(0),l,{},g,[],v);this.paintVertexArray.resize(i),this._setPaintValue(x,i,w)}updatePaintArray(i,l,p,g){const v=this.expression.evaluate({zoom:0},p,g);this._setPaintValue(i,l,v)}_setPaintValue(i,l,p){if(this.type==="color"){const g=Ea(p);for(let v=i;v<l;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Xn{constructor(i,l,p,g,v,x){this.expression=i,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=p,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(i,l,p,g,v){const x=this.expression.evaluate(new Hn(this.zoom),l,{},g,[],v),w=this.expression.evaluate(new Hn(this.zoom+1),l,{},g,[],v),E=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(E,i,x,w)}updatePaintArray(i,l,p,g){const v=this.expression.evaluate({zoom:this.zoom},p,g),x=this.expression.evaluate({zoom:this.zoom+1},p,g);this._setPaintValue(i,l,v,x)}_setPaintValue(i,l,p,g){if(this.type==="color"){const v=Ea(p),x=Ea(g);for(let w=i;w<l;w++)this.paintVertexArray.emplace(w,v[0],v[1],x[0],x[1])}else{for(let v=i;v<l;v++)this.paintVertexArray.emplace(v,p,g);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const p=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=gt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,l,p){return new co(i,l)}}class Mo{constructor(i,l,p,g,v,x){this.expression=i,this.type=l,this.useIntegerZoom=p,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(i,l,p){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,l.patterns&&l.patterns[this.layerId],p)}updatePaintArray(i,l,p,g,v){this._setPaintValues(i,l,p.patterns&&p.patterns[this.layerId],v)}_setPaintValues(i,l,p,g){if(!g||!p)return;const{min:v,mid:x,max:w}=p,E=g[v],L=g[x],D=g[w];if(E&&L&&D)for(let R=i;R<l;R++)this.zoomInPaintVertexArray.emplace(R,L.tl[0],L.tl[1],L.br[0],L.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],L.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,L.tl[0],L.tl[1],L.br[0],L.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],L.pixelRatio,D.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,Kt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,Kt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class kr{constructor(i,l,p){this.binders={},this._buffers=[];const g=[];for(const v in i.paint._values){if(!p(v))continue;const x=i.paint.get(v);if(!(x instanceof Zo&&Nl(x.property.specification)))continue;const w=Do(v,i.type),E=x.value,L=x.property.specification.type,D=x.property.useIntegerZoom,R=x.property.specification["property-type"],F=R==="cross-faded"||R==="cross-faded-data-driven";if(E.kind==="constant")this.binders[v]=F?new Dr(E.value,w):new vs(E.value,w,L),g.push(`/u_${v}`);else if(E.kind==="source"||F){const V=Rr(v,L,"source");this.binders[v]=F?new Mo(E,L,D,l,V,i.id):new nr(E,w,L,V),g.push(`/a_${v}`)}else{const V=Rr(v,L,"composite");this.binders[v]=new Xn(E,w,L,D,l,V),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof nr||l instanceof Xn?l.maxValue:0}populatePaintArrays(i,l,p,g,v){for(const x in this.binders){const w=this.binders[x];(w instanceof nr||w instanceof Xn||w instanceof Mo)&&w.populatePaintArray(i,l,p,g,v)}}setConstantPatternPositions(i,l){for(const p in this.binders){const g=this.binders[p];g instanceof Dr&&g.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,p,g,v){let x=!1;for(const w in i){const E=l.getPositions(w);for(const L of E){const D=p.feature(L.index);for(const R in this.binders){const F=this.binders[R];if((F instanceof nr||F instanceof Xn||F instanceof Mo)&&F.expression.isStateDependent===!0){const V=g.paint.get(R);F.expression=V.value,F.updatePaintArray(L.start,L.end,D,i[w],v),x=!0}}}}return x}defines(){const i=[];for(const l in this.binders){const p=this.binders[l];(p instanceof vs||p instanceof Dr)&&i.push(...p.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof nr||p instanceof Xn)for(let g=0;g<p.paintVertexAttributes.length;g++)i.push(p.paintVertexAttributes[g].name);else if(p instanceof Mo)for(let g=0;g<Kt.members.length;g++)i.push(Kt.members[g].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const p=this.binders[l];if(p instanceof vs||p instanceof Dr||p instanceof Xn)for(const g of p.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const p=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof vs||v instanceof Dr||v instanceof Xn){for(const x of v.uniformNames)if(l[x]){const w=v.getBinding(i,l[x],x);p.push({name:x,property:g,binding:w})}}}return p}setUniforms(i,l,p,g){for(const{name:v,property:x,binding:w}of l)this.binders[x].setUniform(w,g,p.get(x),v)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const p=this.binders[l];if(i&&p instanceof Mo){const g=i.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(p instanceof nr||p instanceof Xn)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(i){for(const l in this.binders){const p=this.binders[l];(p instanceof nr||p instanceof Xn||p instanceof Mo)&&p.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof nr||l instanceof Xn||l instanceof Mo)&&l.destroy()}}}class rr{constructor(i,l,p=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new kr(g,l,p);this.needsUpload=!1,this._featureMap=new Pn,this._bufferOffset=0}populatePaintArrays(i,l,p,g,v,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(i,l,g,v,x);l.id!==void 0&&this._featureMap.add(l.id,p,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,p,g){for(const v of p)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(i,this._featureMap,l,v,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Do(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Rr(s,i,l){const p={color:{source:Ou,composite:$c},number:{source:Jc,composite:Ou}},g=function(v){return{"line-pattern":{source:ct,composite:ct},"fill-pattern":{source:ct,composite:ct},"fill-extrusion-pattern":{source:ct,composite:ct}}[v]}(s);return g&&g[l]||p[i][l]}ae("ConstantBinder",vs),ae("CrossFadedConstantBinder",Dr),ae("SourceExpressionBinder",nr),ae("CrossFadedCompositeBinder",Mo),ae("CompositeExpressionBinder",Xn),ae("ProgramConfiguration",kr,{omit:["_buffers"]}),ae("ProgramConfigurationSet",rr);const gr=8192,kp=Math.pow(2,14)-1,Nd=-kp-1;function nl(s){const i=gr/s.extent,l=s.loadGeometry();for(let p=0;p<l.length;p++){const g=l[p];for(let v=0;v<g.length;v++){const x=g[v],w=Math.round(x.x*i),E=Math.round(x.y*i);x.x=gt(w,Nd,kp),x.y=gt(E,Nd,kp),(w<x.x||w>x.x+1||E<x.y||E>x.y+1)&&te("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function rl(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?nl(s):[]}}function th(s,i,l,p,g){s.emplaceBack(2*i+(p+1)/2,2*l+(g+1)/2)}class Ca{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new U,this.indexArray=new Dt,this.segments=new Xt,this.programConfigurations=new rr(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,p){const g=this.layers[0],v=[];let x=null,w=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),w=!x.isConstant());for(const{feature:E,id:L,index:D,sourceLayerIndex:R}of i){const F=this.layers[0]._featureFilter.needGeometry,V=rl(E,F);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),V,p))continue;const G=w?x.evaluate(V,{},p):void 0,H={id:L,properties:E.properties,type:E.type,sourceLayerIndex:R,index:D,geometry:F?V.geometry:nl(E),patterns:{},sortKey:G};v.push(H)}w&&v.sort((E,L)=>E.sortKey-L.sortKey);for(const E of v){const{geometry:L,index:D,sourceLayerIndex:R}=E,F=i[D].feature;this.addFeature(E,L,D,p),l.featureIndex.insert(F,L,D,R,this.index)}}update(i,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,jt),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,p,g){for(const v of l)for(const x of v){const w=x.x,E=x.y;if(w<0||w>=gr||E<0||E>=gr)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),D=L.vertexLength;th(this.layoutVertexArray,w,E,-1,-1),th(this.layoutVertexArray,w,E,1,-1),th(this.layoutVertexArray,w,E,1,1),th(this.layoutVertexArray,w,E,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,p,{},g)}}function Rp(s,i){for(let l=0;l<s.length;l++)if(nh(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(nh(s,i[l]))return!0;return!!eh(s,i)}function Od(s,i,l){return!!nh(s,i)||!!Rg(i,s,l)}function Np(s,i){if(s.length===1)return S0(i,s[0]);for(let l=0;l<i.length;l++){const p=i[l];for(let g=0;g<p.length;g++)if(nh(s,p[g]))return!0}for(let l=0;l<s.length;l++)if(S0(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(eh(s,i[l]))return!0;return!1}function Op(s,i,l){if(s.length>1){if(eh(s,i))return!0;for(let p=0;p<i.length;p++)if(Rg(i[p],s,l))return!0}for(let p=0;p<s.length;p++)if(Rg(s[p],i,l))return!0;return!1}function eh(s,i){if(s.length===0||i.length===0)return!1;for(let l=0;l<s.length-1;l++){const p=s[l],g=s[l+1];for(let v=0;v<i.length-1;v++)if(zp(p,g,i[v],i[v+1]))return!0}return!1}function zp(s,i,l,p){return le(s,l,p)!==le(i,l,p)&&le(s,i,l)!==le(s,i,p)}function Rg(s,i,l){const p=l*l;if(i.length===1)return s.distSqr(i[0])<p;for(let g=1;g<i.length;g++)if(w0(s,i[g-1],i[g])<p)return!0;return!1}function w0(s,i,l){const p=i.distSqr(l);if(p===0)return s.distSqr(i);const g=((s.x-i.x)*(l.x-i.x)+(s.y-i.y)*(l.y-i.y))/p;return s.distSqr(g<0?i:g>1?l:l.sub(i)._mult(g)._add(i))}function S0(s,i){let l,p,g,v=!1;for(let x=0;x<s.length;x++){l=s[x];for(let w=0,E=l.length-1;w<l.length;E=w++)p=l[w],g=l[E],p.y>i.y!=g.y>i.y&&i.x<(g.x-p.x)*(i.y-p.y)/(g.y-p.y)+p.x&&(v=!v)}return v}function nh(s,i){let l=!1;for(let p=0,g=s.length-1;p<s.length;g=p++){const v=s[p],x=s[g];v.y>i.y!=x.y>i.y&&i.x<(x.x-v.x)*(i.y-v.y)/(x.y-v.y)+v.x&&(l=!l)}return l}function Q2(s,i,l){const p=l[0],g=l[2];if(s.x<p.x&&i.x<p.x||s.x>g.x&&i.x>g.x||s.y<p.y&&i.y<p.y||s.y>g.y&&i.y>g.y)return!1;const v=le(s,i,l[0]);return v!==le(s,i,l[1])||v!==le(s,i,l[2])||v!==le(s,i,l[3])}function Fp(s,i,l){const p=i.paint.get(s).value;return p.kind==="constant"?p.value:l.programConfigurations.get(i.id).getMaxValue(s)}function zd(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Fd(s,i,l,p,g){if(!i[0]&&!i[1])return s;const v=P.convert(i)._mult(g);l==="viewport"&&v._rotate(-p);const x=[];for(let w=0;w<s.length;w++)x.push(s[w].sub(v));return x}let I0,E0;ae("CircleBucket",Ca,{omit:["layers"]});var $2={get paint(){return E0=E0||new Zi({"circle-radius":new be(Ct.paint_circle["circle-radius"]),"circle-color":new be(Ct.paint_circle["circle-color"]),"circle-blur":new be(Ct.paint_circle["circle-blur"]),"circle-opacity":new be(Ct.paint_circle["circle-opacity"]),"circle-translate":new me(Ct.paint_circle["circle-translate"]),"circle-translate-anchor":new me(Ct.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new me(Ct.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new me(Ct.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new be(Ct.paint_circle["circle-stroke-width"]),"circle-stroke-color":new be(Ct.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new be(Ct.paint_circle["circle-stroke-opacity"])})},get layout(){return I0=I0||new Zi({"circle-sort-key":new be(Ct.layout_circle["circle-sort-key"])})}},Hi=1e-6,rh=typeof Float32Array<"u"?Float32Array:Array;function Ng(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function C0(s,i,l){var p=i[0],g=i[1],v=i[2],x=i[3],w=i[4],E=i[5],L=i[6],D=i[7],R=i[8],F=i[9],V=i[10],G=i[11],H=i[12],tt=i[13],ot=i[14],vt=i[15],at=l[0],dt=l[1],kt=l[2],Ot=l[3];return s[0]=at*p+dt*w+kt*R+Ot*H,s[1]=at*g+dt*E+kt*F+Ot*tt,s[2]=at*v+dt*L+kt*V+Ot*ot,s[3]=at*x+dt*D+kt*G+Ot*vt,s[4]=(at=l[4])*p+(dt=l[5])*w+(kt=l[6])*R+(Ot=l[7])*H,s[5]=at*g+dt*E+kt*F+Ot*tt,s[6]=at*v+dt*L+kt*V+Ot*ot,s[7]=at*x+dt*D+kt*G+Ot*vt,s[8]=(at=l[8])*p+(dt=l[9])*w+(kt=l[10])*R+(Ot=l[11])*H,s[9]=at*g+dt*E+kt*F+Ot*tt,s[10]=at*v+dt*L+kt*V+Ot*ot,s[11]=at*x+dt*D+kt*G+Ot*vt,s[12]=(at=l[12])*p+(dt=l[13])*w+(kt=l[14])*R+(Ot=l[15])*H,s[13]=at*g+dt*E+kt*F+Ot*tt,s[14]=at*v+dt*L+kt*V+Ot*ot,s[15]=at*x+dt*D+kt*G+Ot*vt,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var Bp,tS=C0;function Bd(s,i,l){var p=i[0],g=i[1],v=i[2],x=i[3];return s[0]=l[0]*p+l[4]*g+l[8]*v+l[12]*x,s[1]=l[1]*p+l[5]*g+l[9]*v+l[13]*x,s[2]=l[2]*p+l[6]*g+l[10]*v+l[14]*x,s[3]=l[3]*p+l[7]*g+l[11]*v+l[15]*x,s}Bp=new rh(4),rh!=Float32Array&&(Bp[0]=0,Bp[1]=0,Bp[2]=0,Bp[3]=0);class eS extends Ho{constructor(i){super(i,$2)}createBucket(i){return new Ca(i)}queryRadius(i){const l=i;return Fp("circle-radius",this,l)+Fp("circle-stroke-width",this,l)+zd(this.paint.get("circle-translate"))}queryIntersectsFeature(i,l,p,g,v,x,w,E){const L=Fd(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,w),D=this.paint.get("circle-radius").evaluate(l,p)+this.paint.get("circle-stroke-width").evaluate(l,p),R=this.paint.get("circle-pitch-alignment")==="map",F=R?L:function(G,H){return G.map(tt=>T0(tt,H))}(L,E),V=R?D*w:D;for(const G of g)for(const H of G){const tt=R?H:T0(H,E);let ot=V;const vt=Bd([],[H.x,H.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?ot*=vt[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(ot*=x.cameraToCenterDistance/vt[3]),Od(F,tt,ot))return!0}return!1}}function T0(s,i){const l=Bd([],[s.x,s.y,0,1],i);return new P(l[0]/l[3],l[1]/l[3])}class L0 extends Ca{}let P0;ae("HeatmapBucket",L0,{omit:["layers"]});var nS={get paint(){return P0=P0||new Zi({"heatmap-radius":new be(Ct.paint_heatmap["heatmap-radius"]),"heatmap-weight":new be(Ct.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new me(Ct.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ip(Ct.paint_heatmap["heatmap-color"]),"heatmap-opacity":new me(Ct.paint_heatmap["heatmap-opacity"])})}};function Og(s,{width:i,height:l},p,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*l*p)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*l*p}`)}else g=new Uint8Array(i*l*p);return s.width=i,s.height=l,s.data=g,s}function A0(s,{width:i,height:l},p){if(i===s.width&&l===s.height)return;const g=Og({},{width:i,height:l},p);zg(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,l)},p),s.width=i,s.height=l,s.data=g.data}function zg(s,i,l,p,g,v){if(g.width===0||g.height===0)return i;if(g.width>s.width||g.height>s.height||l.x>s.width-g.width||l.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||p.x>i.width-g.width||p.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,w=i.data;if(x===w)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<g.height;E++){const L=((l.y+E)*s.width+l.x)*v,D=((p.y+E)*i.width+p.x)*v;for(let R=0;R<g.width*v;R++)w[D+R]=x[L+R]}return i}class Vp{constructor(i,l){Og(this,i,1,l)}resize(i){A0(this,i,1)}clone(){return new Vp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,p,g,v){zg(i,l,p,g,v,1)}}class Xo{constructor(i,l){Og(this,i,4,l)}resize(i){A0(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Xo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,p,g,v){zg(i,l,p,g,v,4)}}function M0(s){const i={},l=s.resolution||256,p=s.clips?s.clips.length:1,g=s.image||new Xo({width:l,height:p});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const v=(x,w,E)=>{i[s.evaluationKey]=E;const L=s.expression.evaluate(i);g.data[x+w+0]=Math.floor(255*L.r/L.a),g.data[x+w+1]=Math.floor(255*L.g/L.a),g.data[x+w+2]=Math.floor(255*L.b/L.a),g.data[x+w+3]=Math.floor(255*L.a)};if(s.clips)for(let x=0,w=0;x<p;++x,w+=4*l)for(let E=0,L=0;E<l;E++,L+=4){const D=E/(l-1),{start:R,end:F}=s.clips[x];v(w,L,R*(1-D)+F*D)}else for(let x=0,w=0;x<l;x++,w+=4)v(0,w,x/(l-1));return g}ae("AlphaImage",Vp),ae("RGBAImage",Xo);class rS extends Ho{createBucket(i){return new L0(i)}constructor(i){super(i,nS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=M0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let D0;var iS={get paint(){return D0=D0||new Zi({"hillshade-illumination-direction":new me(Ct.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new me(Ct.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new me(Ct.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new me(Ct.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new me(Ct.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new me(Ct.paint_hillshade["hillshade-accent-color"])})}};class oS extends Ho{constructor(i){super(i,iS)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const sS=br([{name:"a_pos",components:2,type:"Int16"}],4),{members:aS}=sS;var Fg={exports:{}};function Vd(s,i,l){l=l||2;var p,g,v,x,w,E,L,D=i&&i.length,R=D?i[0]*l:s.length,F=k0(s,0,R,l,!0),V=[];if(!F||F.next===F.prev)return V;if(D&&(F=function(H,tt,ot,vt){var at,dt,kt,Ot=[];for(at=0,dt=tt.length;at<dt;at++)(kt=k0(H,tt[at]*vt,at<dt-1?tt[at+1]*vt:H.length,vt,!1))===kt.next&&(kt.steiner=!0),Ot.push(mS(kt));for(Ot.sort(pS),at=0;at<Ot.length;at++)ot=fS(Ot[at],ot);return ot}(s,i,F,l)),s.length>80*l){p=v=s[0],g=x=s[1];for(var G=l;G<R;G+=l)(w=s[G])<p&&(p=w),(E=s[G+1])<g&&(g=E),w>v&&(v=w),E>x&&(x=E);L=(L=Math.max(v-p,x-g))!==0?32767/L:0}return Up(F,V,l,p,g,L,0),V}function k0(s,i,l,p,g){var v,x;if(g===Ug(s,i,l,p)>0)for(v=i;v<l;v+=p)x=O0(v,s[v],s[v+1],x);else for(v=l-p;v>=i;v-=p)x=O0(v,s[v],s[v+1],x);return x&&Ud(x,x.next)&&(qp(x),x=x.next),x}function Vu(s,i){if(!s)return s;i||(i=s);var l,p=s;do if(l=!1,p.steiner||!Ud(p,p.next)&&wr(p.prev,p,p.next)!==0)p=p.next;else{if(qp(p),(p=i=p.prev)===p.next)break;l=!0}while(l||p!==i);return i}function Up(s,i,l,p,g,v,x){if(s){!x&&v&&function(D,R,F,V){var G=D;do G.z===0&&(G.z=Bg(G.x,G.y,R,F,V)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==D);G.prevZ.nextZ=null,G.prevZ=null,function(H){var tt,ot,vt,at,dt,kt,Ot,ie,fe=1;do{for(ot=H,H=null,dt=null,kt=0;ot;){for(kt++,vt=ot,Ot=0,tt=0;tt<fe&&(Ot++,vt=vt.nextZ);tt++);for(ie=fe;Ot>0||ie>0&&vt;)Ot!==0&&(ie===0||!vt||ot.z<=vt.z)?(at=ot,ot=ot.nextZ,Ot--):(at=vt,vt=vt.nextZ,ie--),dt?dt.nextZ=at:H=at,at.prevZ=dt,dt=at;ot=vt}dt.nextZ=null,fe*=2}while(kt>1)}(G)}(s,p,g,v);for(var w,E,L=s;s.prev!==s.next;)if(w=s.prev,E=s.next,v?uS(s,p,g,v):lS(s))i.push(w.i/l|0),i.push(s.i/l|0),i.push(E.i/l|0),qp(s),s=E.next,L=E.next;else if((s=E)===L){x?x===1?Up(s=cS(Vu(s),i,l),i,l,p,g,v,2):x===2&&hS(s,i,l,p,g,v):Up(Vu(s),i,l,p,g,v,1);break}}}function lS(s){var i=s.prev,l=s,p=s.next;if(wr(i,l,p)>=0)return!1;for(var g=i.x,v=l.x,x=p.x,w=i.y,E=l.y,L=p.y,D=g<v?g<x?g:x:v<x?v:x,R=w<E?w<L?w:L:E<L?E:L,F=g>v?g>x?g:x:v>x?v:x,V=w>E?w>L?w:L:E>L?E:L,G=p.next;G!==i;){if(G.x>=D&&G.x<=F&&G.y>=R&&G.y<=V&&ih(g,w,v,E,x,L,G.x,G.y)&&wr(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function uS(s,i,l,p){var g=s.prev,v=s,x=s.next;if(wr(g,v,x)>=0)return!1;for(var w=g.x,E=v.x,L=x.x,D=g.y,R=v.y,F=x.y,V=w<E?w<L?w:L:E<L?E:L,G=D<R?D<F?D:F:R<F?R:F,H=w>E?w>L?w:L:E>L?E:L,tt=D>R?D>F?D:F:R>F?R:F,ot=Bg(V,G,i,l,p),vt=Bg(H,tt,i,l,p),at=s.prevZ,dt=s.nextZ;at&&at.z>=ot&&dt&&dt.z<=vt;){if(at.x>=V&&at.x<=H&&at.y>=G&&at.y<=tt&&at!==g&&at!==x&&ih(w,D,E,R,L,F,at.x,at.y)&&wr(at.prev,at,at.next)>=0||(at=at.prevZ,dt.x>=V&&dt.x<=H&&dt.y>=G&&dt.y<=tt&&dt!==g&&dt!==x&&ih(w,D,E,R,L,F,dt.x,dt.y)&&wr(dt.prev,dt,dt.next)>=0))return!1;dt=dt.nextZ}for(;at&&at.z>=ot;){if(at.x>=V&&at.x<=H&&at.y>=G&&at.y<=tt&&at!==g&&at!==x&&ih(w,D,E,R,L,F,at.x,at.y)&&wr(at.prev,at,at.next)>=0)return!1;at=at.prevZ}for(;dt&&dt.z<=vt;){if(dt.x>=V&&dt.x<=H&&dt.y>=G&&dt.y<=tt&&dt!==g&&dt!==x&&ih(w,D,E,R,L,F,dt.x,dt.y)&&wr(dt.prev,dt,dt.next)>=0)return!1;dt=dt.nextZ}return!0}function cS(s,i,l){var p=s;do{var g=p.prev,v=p.next.next;!Ud(g,v)&&R0(g,p,p.next,v)&&Gp(g,v)&&Gp(v,g)&&(i.push(g.i/l|0),i.push(p.i/l|0),i.push(v.i/l|0),qp(p),qp(p.next),p=s=v),p=p.next}while(p!==s);return Vu(p)}function hS(s,i,l,p,g,v){var x=s;do{for(var w=x.next.next;w!==x.prev;){if(x.i!==w.i&&gS(x,w)){var E=N0(x,w);return x=Vu(x,x.next),E=Vu(E,E.next),Up(x,i,l,p,g,v,0),void Up(E,i,l,p,g,v,0)}w=w.next}x=x.next}while(x!==s)}function pS(s,i){return s.x-i.x}function fS(s,i){var l=function(g,v){var x,w=v,E=g.x,L=g.y,D=-1/0;do{if(L<=w.y&&L>=w.next.y&&w.next.y!==w.y){var R=w.x+(L-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(R<=E&&R>D&&(D=R,x=w.x<w.next.x?w:w.next,R===E))return x}w=w.next}while(w!==v);if(!x)return null;var F,V=x,G=x.x,H=x.y,tt=1/0;w=x;do E>=w.x&&w.x>=G&&E!==w.x&&ih(L<H?E:D,L,G,H,L<H?D:E,L,w.x,w.y)&&(F=Math.abs(L-w.y)/(E-w.x),Gp(w,g)&&(F<tt||F===tt&&(w.x>x.x||w.x===x.x&&dS(x,w)))&&(x=w,tt=F)),w=w.next;while(w!==V);return x}(s,i);if(!l)return i;var p=N0(l,s);return Vu(p,p.next),Vu(l,l.next)}function dS(s,i){return wr(s.prev,s,i.prev)<0&&wr(i.next,s,s.next)<0}function Bg(s,i,l,p,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-p)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function mS(s){var i=s,l=s;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==s);return l}function ih(s,i,l,p,g,v,x,w){return(g-x)*(i-w)>=(s-x)*(v-w)&&(s-x)*(p-w)>=(l-x)*(i-w)&&(l-x)*(v-w)>=(g-x)*(p-w)}function gS(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(l,p){var g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==p.i&&g.next.i!==p.i&&R0(g,g.next,l,p))return!0;g=g.next}while(g!==l);return!1}(s,i)&&(Gp(s,i)&&Gp(i,s)&&function(l,p){var g=l,v=!1,x=(l.x+p.x)/2,w=(l.y+p.y)/2;do g.y>w!=g.next.y>w&&g.next.y!==g.y&&x<(g.next.x-g.x)*(w-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==l);return v}(s,i)&&(wr(s.prev,s,i.prev)||wr(s,i.prev,i))||Ud(s,i)&&wr(s.prev,s,s.next)>0&&wr(i.prev,i,i.next)>0)}function wr(s,i,l){return(i.y-s.y)*(l.x-i.x)-(i.x-s.x)*(l.y-i.y)}function Ud(s,i){return s.x===i.x&&s.y===i.y}function R0(s,i,l,p){var g=qd(wr(s,i,l)),v=qd(wr(s,i,p)),x=qd(wr(l,p,s)),w=qd(wr(l,p,i));return g!==v&&x!==w||!(g!==0||!Gd(s,l,i))||!(v!==0||!Gd(s,p,i))||!(x!==0||!Gd(l,s,p))||!(w!==0||!Gd(l,i,p))}function Gd(s,i,l){return i.x<=Math.max(s.x,l.x)&&i.x>=Math.min(s.x,l.x)&&i.y<=Math.max(s.y,l.y)&&i.y>=Math.min(s.y,l.y)}function qd(s){return s>0?1:s<0?-1:0}function Gp(s,i){return wr(s.prev,s,s.next)<0?wr(s,i,s.next)>=0&&wr(s,s.prev,i)>=0:wr(s,i,s.prev)<0||wr(s,s.next,i)<0}function N0(s,i){var l=new Vg(s.i,s.x,s.y),p=new Vg(i.i,i.x,i.y),g=s.next,v=i.prev;return s.next=i,i.prev=s,l.next=g,g.prev=l,p.next=l,l.prev=p,v.next=p,p.prev=v,p}function O0(s,i,l,p){var g=new Vg(s,i,l);return p?(g.next=p.next,g.prev=p,p.next.prev=g,p.next=g):(g.prev=g,g.next=g),g}function qp(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Vg(s,i,l){this.i=s,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ug(s,i,l,p){for(var g=0,v=i,x=l-p;v<l;v+=p)g+=(s[x]-s[v])*(s[v+1]+s[x+1]),x=v;return g}Fg.exports=Vd,Fg.exports.default=Vd,Vd.deviation=function(s,i,l,p){var g=i&&i.length,v=Math.abs(Ug(s,0,g?i[0]*l:s.length,l));if(g)for(var x=0,w=i.length;x<w;x++)v-=Math.abs(Ug(s,i[x]*l,x<w-1?i[x+1]*l:s.length,l));var E=0;for(x=0;x<p.length;x+=3){var L=p[x]*l,D=p[x+1]*l,R=p[x+2]*l;E+=Math.abs((s[L]-s[R])*(s[D+1]-s[L+1])-(s[L]-s[D])*(s[R+1]-s[L+1]))}return v===0&&E===0?0:Math.abs((E-v)/v)},Vd.flatten=function(s){for(var i=s[0][0].length,l={vertices:[],holes:[],dimensions:i},p=0,g=0;g<s.length;g++){for(var v=0;v<s[g].length;v++)for(var x=0;x<i;x++)l.vertices.push(s[g][v][x]);g>0&&l.holes.push(p+=s[g-1].length)}return l};var z0=b(Fg.exports);function yS(s,i,l,p,g){F0(s,i,l||0,p||s.length-1,g||_S)}function F0(s,i,l,p,g){for(;p>l;){if(p-l>600){var v=p-l+1,x=i-l+1,w=Math.log(v),E=.5*Math.exp(2*w/3),L=.5*Math.sqrt(w*E*(v-E)/v)*(x-v/2<0?-1:1);F0(s,i,Math.max(l,Math.floor(i-x*E/v+L)),Math.min(p,Math.floor(i+(v-x)*E/v+L)),g)}var D=s[i],R=l,F=p;for(jp(s,l,i),g(s[p],D)>0&&jp(s,l,p);R<F;){for(jp(s,R,F),R++,F--;g(s[R],D)<0;)R++;for(;g(s[F],D)>0;)F--}g(s[l],D)===0?jp(s,l,F):jp(s,++F,p),F<=i&&(l=F+1),i<=F&&(p=F-1)}}function jp(s,i,l){var p=s[i];s[i]=s[l],s[l]=p}function _S(s,i){return s<i?-1:s>i?1:0}function Gg(s,i){const l=s.length;if(l<=1)return[s];const p=[];let g,v;for(let x=0;x<l;x++){const w=Xe(s[x]);w!==0&&(s[x].area=Math.abs(w),v===void 0&&(v=w<0),v===w<0?(g&&p.push(g),g=[s[x]]):g.push(s[x]))}if(g&&p.push(g),i>1)for(let x=0;x<p.length;x++)p[x].length<=i||(yS(p[x],i,1,p[x].length-1,vS),p[x]=p[x].slice(0,i));return p}function vS(s,i){return i.area-s.area}function qg(s,i,l){const p=l.patternDependencies;let g=!1;for(const v of i){const x=v.paint.get(`${s}-pattern`);x.isConstant()||(g=!0);const w=x.constantOr(null);w&&(g=!0,p[w.to]=!0,p[w.from]=!0)}return g}function jg(s,i,l,p,g){const v=g.patternDependencies;for(const x of i){const w=x.paint.get(`${s}-pattern`).value;if(w.kind!=="constant"){let E=w.evaluate({zoom:p-1},l,{},g.availableImages),L=w.evaluate({zoom:p},l,{},g.availableImages),D=w.evaluate({zoom:p+1},l,{},g.availableImages);E=E&&E.name?E.name:E,L=L&&L.name?L.name:L,D=D&&D.name?D.name:D,v[E]=!0,v[L]=!0,v[D]=!0,l.patterns[x.id]={min:E,mid:L,max:D}}}return l}class Wg{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $,this.indexArray=new Dt,this.indexArray2=new Bt,this.programConfigurations=new rr(i.layers,i.zoom),this.segments=new Xt,this.segments2=new Xt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,p){this.hasPattern=qg("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),x=[];for(const{feature:w,id:E,index:L,sourceLayerIndex:D}of i){const R=this.layers[0]._featureFilter.needGeometry,F=rl(w,R);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),F,p))continue;const V=v?g.evaluate(F,{},p,l.availableImages):void 0,G={id:E,properties:w.properties,type:w.type,sourceLayerIndex:D,index:L,geometry:R?F.geometry:nl(w),patterns:{},sortKey:V};x.push(G)}v&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:L,sourceLayerIndex:D}=w;if(this.hasPattern){const R=jg("fill",this.layers,w,this.zoom,l);this.patternFeatures.push(R)}else this.addFeature(w,E,L,p,{});l.featureIndex.insert(i[L].feature,E,L,D,this.index)}}update(i,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,p)}addFeatures(i,l,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,aS),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,p,g,v){for(const x of Gg(l,500)){let w=0;for(const V of x)w+=V.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),L=E.vertexLength,D=[],R=[];for(const V of x){if(V.length===0)continue;V!==x[0]&&R.push(D.length/2);const G=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),H=G.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(H+V.length-1,H),D.push(V[0].x),D.push(V[0].y);for(let tt=1;tt<V.length;tt++)this.layoutVertexArray.emplaceBack(V[tt].x,V[tt].y),this.indexArray2.emplaceBack(H+tt-1,H+tt),D.push(V[tt].x),D.push(V[tt].y);G.vertexLength+=V.length,G.primitiveLength+=V.length}const F=z0(D,R);for(let V=0;V<F.length;V+=3)this.indexArray.emplaceBack(L+F[V],L+F[V+1],L+F[V+2]);E.vertexLength+=w,E.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,p,v,g)}}let B0,V0;ae("FillBucket",Wg,{omit:["layers","patternFeatures"]});var xS={get paint(){return V0=V0||new Zi({"fill-antialias":new me(Ct.paint_fill["fill-antialias"]),"fill-opacity":new be(Ct.paint_fill["fill-opacity"]),"fill-color":new be(Ct.paint_fill["fill-color"]),"fill-outline-color":new be(Ct.paint_fill["fill-outline-color"]),"fill-translate":new me(Ct.paint_fill["fill-translate"]),"fill-translate-anchor":new me(Ct.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zc(Ct.paint_fill["fill-pattern"])})},get layout(){return B0=B0||new Zi({"fill-sort-key":new be(Ct.layout_fill["fill-sort-key"])})}};class bS extends Ho{constructor(i){super(i,xS)}recalculate(i,l){super.recalculate(i,l);const p=this.paint._values["fill-outline-color"];p.value.kind==="constant"&&p.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Wg(i)}queryRadius(){return zd(this.paint.get("fill-translate"))}queryIntersectsFeature(i,l,p,g,v,x,w){return Np(Fd(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,w),g)}isTileClipped(){return!0}}const wS=br([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),SS=br([{name:"a_centroid",components:2,type:"Int16"}],4),{members:IS}=wS;var ql={},ES=C,U0=oh;function oh(s,i,l,p,g){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=p,this._values=g,s.readFields(CS,this,i)}function CS(s,i,l){s==1?i.id=l.readVarint():s==2?function(p,g){for(var v=p.readVarint()+p.pos;p.pos<v;){var x=g._keys[p.readVarint()],w=g._values[p.readVarint()];g.properties[x]=w}}(l,i):s==3?i.type=l.readVarint():s==4&&(i._geometry=l.pos)}function TS(s){for(var i,l,p=0,g=0,v=s.length,x=v-1;g<v;x=g++)p+=((l=s[x]).x-(i=s[g]).x)*(i.y+l.y);return p}oh.types=["Unknown","Point","LineString","Polygon"],oh.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,l=s.readVarint()+s.pos,p=1,g=0,v=0,x=0,w=[];s.pos<l;){if(g<=0){var E=s.readVarint();p=7&E,g=E>>3}if(g--,p===1||p===2)v+=s.readSVarint(),x+=s.readSVarint(),p===1&&(i&&w.push(i),i=[]),i.push(new ES(v,x));else{if(p!==7)throw new Error("unknown command "+p);i&&i.push(i[0].clone())}}return i&&w.push(i),w},oh.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,l=1,p=0,g=0,v=0,x=1/0,w=-1/0,E=1/0,L=-1/0;s.pos<i;){if(p<=0){var D=s.readVarint();l=7&D,p=D>>3}if(p--,l===1||l===2)(g+=s.readSVarint())<x&&(x=g),g>w&&(w=g),(v+=s.readSVarint())<E&&(E=v),v>L&&(L=v);else if(l!==7)throw new Error("unknown command "+l)}return[x,E,w,L]},oh.prototype.toGeoJSON=function(s,i,l){var p,g,v=this.extent*Math.pow(2,l),x=this.extent*s,w=this.extent*i,E=this.loadGeometry(),L=oh.types[this.type];function D(V){for(var G=0;G<V.length;G++){var H=V[G];V[G]=[360*(H.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+w)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var R=[];for(p=0;p<E.length;p++)R[p]=E[p][0];D(E=R);break;case 2:for(p=0;p<E.length;p++)D(E[p]);break;case 3:for(E=function(V){var G=V.length;if(G<=1)return[V];for(var H,tt,ot=[],vt=0;vt<G;vt++){var at=TS(V[vt]);at!==0&&(tt===void 0&&(tt=at<0),tt===at<0?(H&&ot.push(H),H=[V[vt]]):H.push(V[vt]))}return H&&ot.push(H),ot}(E),p=0;p<E.length;p++)for(g=0;g<E[p].length;g++)D(E[p][g])}E.length===1?E=E[0]:L="Multi"+L;var F={type:"Feature",geometry:{type:L,coordinates:E},properties:this.properties};return"id"in this&&(F.id=this.id),F};var LS=U0,G0=q0;function q0(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(PS,this,i),this.length=this._features.length}function PS(s,i,l){s===15?i.version=l.readVarint():s===1?i.name=l.readString():s===5?i.extent=l.readVarint():s===2?i._features.push(l.pos):s===3?i._keys.push(l.readString()):s===4&&i._values.push(function(p){for(var g=null,v=p.readVarint()+p.pos;p.pos<v;){var x=p.readVarint()>>3;g=x===1?p.readString():x===2?p.readFloat():x===3?p.readDouble():x===4?p.readVarint64():x===5?p.readVarint():x===6?p.readSVarint():x===7?p.readBoolean():null}return g}(l))}q0.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new LS(this._pbf,i,this.extent,this._keys,this._values)};var AS=G0;function MS(s,i,l){if(s===3){var p=new AS(l,l.readVarint()+l.pos);p.length&&(i[p.name]=p)}}ql.VectorTile=function(s,i){this.layers=s.readFields(MS,{},i)},ql.VectorTileFeature=U0,ql.VectorTileLayer=G0;const DS=ql.VectorTileFeature.types,Zg=Math.pow(2,13);function Wp(s,i,l,p,g,v,x,w){s.emplaceBack(i,l,2*Math.floor(p*Zg)+x,g*Zg*2,v*Zg*2,Math.round(w))}class Hg{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new Q,this.centroidVertexArray=new O,this.indexArray=new Dt,this.programConfigurations=new rr(i.layers,i.zoom),this.segments=new Xt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,p){this.features=[],this.hasPattern=qg("fill-extrusion",this.layers,l);for(const{feature:g,id:v,index:x,sourceLayerIndex:w}of i){const E=this.layers[0]._featureFilter.needGeometry,L=rl(g,E);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),L,p))continue;const D={id:v,sourceLayerIndex:w,index:x,geometry:E?L.geometry:nl(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(jg("fill-extrusion",this.layers,D,this.zoom,l)):this.addFeature(D,D.geometry,x,p,{}),l.featureIndex.insert(g,D.geometry,x,w,this.index,!0)}}addFeatures(i,l,p){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,l,p)}}update(i,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,IS),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,SS.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,l,p,g,v){const x={x:0,y:0,vertexCount:0};for(const w of Gg(l,500)){let E=0;for(const G of w)E+=G.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of w){if(G.length===0||RS(G))continue;let H=0;for(let tt=0;tt<G.length;tt++){const ot=G[tt];if(tt>=1){const vt=G[tt-1];if(!kS(ot,vt)){L.vertexLength+4>Xt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const at=ot.sub(vt)._perp()._unit(),dt=vt.dist(ot);H+dt>32768&&(H=0),Wp(this.layoutVertexArray,ot.x,ot.y,at.x,at.y,0,0,H),Wp(this.layoutVertexArray,ot.x,ot.y,at.x,at.y,0,1,H),x.x+=2*ot.x,x.y+=2*ot.y,x.vertexCount+=2,H+=dt,Wp(this.layoutVertexArray,vt.x,vt.y,at.x,at.y,0,0,H),Wp(this.layoutVertexArray,vt.x,vt.y,at.x,at.y,0,1,H),x.x+=2*vt.x,x.y+=2*vt.y,x.vertexCount+=2;const kt=L.vertexLength;this.indexArray.emplaceBack(kt,kt+2,kt+1),this.indexArray.emplaceBack(kt+1,kt+2,kt+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+E>Xt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray)),DS[i.type]!=="Polygon")continue;const D=[],R=[],F=L.vertexLength;for(const G of w)if(G.length!==0){G!==w[0]&&R.push(D.length/2);for(let H=0;H<G.length;H++){const tt=G[H];Wp(this.layoutVertexArray,tt.x,tt.y,0,0,1,1,0),x.x+=tt.x,x.y+=tt.y,x.vertexCount+=1,D.push(tt.x),D.push(tt.y)}}const V=z0(D,R);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(F+V[G],F+V[G+2],F+V[G+1]);L.primitiveLength+=V.length/3,L.vertexLength+=E}for(let w=0;w<x.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,p,v,g)}}function kS(s,i){return s.x===i.x&&(s.x<0||s.x>gr)||s.y===i.y&&(s.y<0||s.y>gr)}function RS(s){return s.every(i=>i.x<0)||s.every(i=>i.x>gr)||s.every(i=>i.y<0)||s.every(i=>i.y>gr)}let j0;ae("FillExtrusionBucket",Hg,{omit:["layers","features"]});var NS={get paint(){return j0=j0||new Zi({"fill-extrusion-opacity":new me(Ct["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new be(Ct["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new me(Ct["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new me(Ct["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zc(Ct["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new be(Ct["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new be(Ct["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new me(Ct["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class OS extends Ho{constructor(i){super(i,NS)}createBucket(i){return new Hg(i)}queryRadius(){return zd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,l,p,g,v,x,w,E){const L=Fd(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,w),D=this.paint.get("fill-extrusion-height").evaluate(l,p),R=this.paint.get("fill-extrusion-base").evaluate(l,p),F=function(G,H,tt,ot){const vt=[];for(const at of G){const dt=[at.x,at.y,0,1];Bd(dt,dt,H),vt.push(new P(dt[0]/dt[3],dt[1]/dt[3]))}return vt}(L,E),V=function(G,H,tt,ot){const vt=[],at=[],dt=ot[8]*H,kt=ot[9]*H,Ot=ot[10]*H,ie=ot[11]*H,fe=ot[8]*tt,re=ot[9]*tt,ee=ot[10]*tt,Ht=ot[11]*tt;for(const ce of G){const Jt=[],Gt=[];for(const ve of ce){const de=ve.x,Ye=ve.y,Gn=ot[0]*de+ot[4]*Ye+ot[12],Yn=ot[1]*de+ot[5]*Ye+ot[13],Gr=ot[2]*de+ot[6]*Ye+ot[14],ko=ot[3]*de+ot[7]*Ye+ot[15],Xi=Gr+Ot,Nr=ko+ie,ai=Gn+fe,gi=Yn+re,Yi=Gr+ee,Ki=ko+Ht,qr=new P((Gn+dt)/Nr,(Yn+kt)/Nr);qr.z=Xi/Nr,Jt.push(qr);const jr=new P(ai/Ki,gi/Ki);jr.z=Yi/Ki,Gt.push(jr)}vt.push(Jt),at.push(Gt)}return[vt,at]}(g,R,D,E);return function(G,H,tt){let ot=1/0;Np(tt,H)&&(ot=W0(tt,H[0]));for(let vt=0;vt<H.length;vt++){const at=H[vt],dt=G[vt];for(let kt=0;kt<at.length-1;kt++){const Ot=at[kt],ie=[Ot,at[kt+1],dt[kt+1],dt[kt],Ot];Rp(tt,ie)&&(ot=Math.min(ot,W0(tt,ie)))}}return ot!==1/0&&ot}(V[0],V[1],F)}}function Zp(s,i){return s.x*i.x+s.y*i.y}function W0(s,i){if(s.length===1){let l=0;const p=i[l++];let g;for(;!g||p.equals(g);)if(g=i[l++],!g)return 1/0;for(;l<i.length;l++){const v=i[l],x=s[0],w=g.sub(p),E=v.sub(p),L=x.sub(p),D=Zp(w,w),R=Zp(w,E),F=Zp(E,E),V=Zp(L,w),G=Zp(L,E),H=D*F-R*R,tt=(F*V-R*G)/H,ot=(D*G-R*V)/H,vt=p.z*(1-tt-ot)+g.z*tt+v.z*ot;if(isFinite(vt))return vt}return 1/0}{let l=1/0;for(const p of i)l=Math.min(l,p.z);return l}}const zS=br([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:FS}=zS,BS=br([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:VS}=BS,US=ql.VectorTileFeature.types,GS=Math.cos(Math.PI/180*37.5),Z0=Math.pow(2,14)/.5;class Xg{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new nt,this.layoutVertexArray2=new Z,this.indexArray=new Dt,this.programConfigurations=new rr(i.layers,i.zoom),this.segments=new Xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,p){this.hasPattern=qg("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),x=[];for(const{feature:w,id:E,index:L,sourceLayerIndex:D}of i){const R=this.layers[0]._featureFilter.needGeometry,F=rl(w,R);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),F,p))continue;const V=v?g.evaluate(F,{},p):void 0,G={id:E,properties:w.properties,type:w.type,sourceLayerIndex:D,index:L,geometry:R?F.geometry:nl(w),patterns:{},sortKey:V};x.push(G)}v&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:L,sourceLayerIndex:D}=w;if(this.hasPattern){const R=jg("line",this.layers,w,this.zoom,l);this.patternFeatures.push(R)}else this.addFeature(w,E,L,p,{});l.featureIndex.insert(i[L].feature,E,L,D,this.index)}}update(i,l,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,p)}addFeatures(i,l,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,VS)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,FS),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,p,g,v){const x=this.layers[0].layout,w=x.get("line-join").evaluate(i,{}),E=x.get("line-cap"),L=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const R of l)this.addLine(R,i,w,E,L,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,p,v,g)}addLine(i,l,p,g,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ot=0;ot<i.length-1;ot++)this.totalDistance+=i[ot].dist(i[ot+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=US[l.type]==="Polygon";let E=i.length;for(;E>=2&&i[E-1].equals(i[E-2]);)E--;let L=0;for(;L<E-1&&i[L].equals(i[L+1]);)L++;if(E<(w?3:2))return;p==="bevel"&&(v=1.05);const D=this.overscaling<=16?15*gr/(512*this.overscaling):0,R=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let F,V,G,H,tt;this.e1=this.e2=-1,w&&(F=i[E-2],tt=i[L].sub(F)._unit()._perp());for(let ot=L;ot<E;ot++){if(G=ot===E-1?w?i[L+1]:void 0:i[ot+1],G&&i[ot].equals(G))continue;tt&&(H=tt),F&&(V=F),F=i[ot],tt=G?G.sub(F)._unit()._perp():H,H=H||tt;let vt=H.add(tt);vt.x===0&&vt.y===0||vt._unit();const at=H.x*tt.x+H.y*tt.y,dt=vt.x*tt.x+vt.y*tt.y,kt=dt!==0?1/dt:1/0,Ot=2*Math.sqrt(2-2*dt),ie=dt<GS&&V&&G,fe=H.x*tt.y-H.y*tt.x>0;if(ie&&ot>L){const Ht=F.dist(V);if(Ht>2*D){const ce=F.sub(F.sub(V)._mult(D/Ht)._round());this.updateDistance(V,ce),this.addCurrentVertex(ce,H,0,0,R),V=ce}}const re=V&&G;let ee=re?p:w?"butt":g;if(re&&ee==="round"&&(kt<x?ee="miter":kt<=2&&(ee="fakeround")),ee==="miter"&&kt>v&&(ee="bevel"),ee==="bevel"&&(kt>2&&(ee="flipbevel"),kt<v&&(ee="miter")),V&&this.updateDistance(V,F),ee==="miter")vt._mult(kt),this.addCurrentVertex(F,vt,0,0,R);else if(ee==="flipbevel"){if(kt>100)vt=tt.mult(-1);else{const Ht=kt*H.add(tt).mag()/H.sub(tt).mag();vt._perp()._mult(Ht*(fe?-1:1))}this.addCurrentVertex(F,vt,0,0,R),this.addCurrentVertex(F,vt.mult(-1),0,0,R)}else if(ee==="bevel"||ee==="fakeround"){const Ht=-Math.sqrt(kt*kt-1),ce=fe?Ht:0,Jt=fe?0:Ht;if(V&&this.addCurrentVertex(F,H,ce,Jt,R),ee==="fakeround"){const Gt=Math.round(180*Ot/Math.PI/20);for(let ve=1;ve<Gt;ve++){let de=ve/Gt;if(de!==.5){const Gn=de-.5;de+=de*Gn*(de-1)*((1.0904+at*(at*(3.55645-1.43519*at)-3.2452))*Gn*Gn+(.848013+at*(.215638*at-1.06021)))}const Ye=tt.sub(H)._mult(de)._add(H)._unit()._mult(fe?-1:1);this.addHalfVertex(F,Ye.x,Ye.y,!1,fe,0,R)}}G&&this.addCurrentVertex(F,tt,-ce,-Jt,R)}else if(ee==="butt")this.addCurrentVertex(F,vt,0,0,R);else if(ee==="square"){const Ht=V?1:-1;this.addCurrentVertex(F,vt,Ht,Ht,R)}else ee==="round"&&(V&&(this.addCurrentVertex(F,H,0,0,R),this.addCurrentVertex(F,H,1,1,R,!0)),G&&(this.addCurrentVertex(F,tt,-1,-1,R,!0),this.addCurrentVertex(F,tt,0,0,R)));if(ie&&ot<E-1){const Ht=F.dist(G);if(Ht>2*D){const ce=F.add(G.sub(F)._mult(D/Ht)._round());this.updateDistance(F,ce),this.addCurrentVertex(ce,tt,0,0,R),F=ce}}}}addCurrentVertex(i,l,p,g,v,x=!1){const w=l.y*g-l.x,E=-l.y-l.x*g;this.addHalfVertex(i,l.x+l.y*p,l.y-l.x*p,x,!1,p,v),this.addHalfVertex(i,w,E,x,!0,-g,v),this.distance>Z0/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,l,p,g,v,x))}addHalfVertex({x:i,y:l},p,g,v,x,w,E){const L=.5*(this.lineClips?this.scaledDistance*(Z0-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(v?1:0),(l<<1)+(x?1:0),Math.round(63*p)+128,Math.round(63*g)+128,1+(w===0?0:w<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),E.primitiveLength++),x?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}let H0,X0;ae("LineBucket",Xg,{omit:["layers","patternFeatures"]});var Y0={get paint(){return X0=X0||new Zi({"line-opacity":new be(Ct.paint_line["line-opacity"]),"line-color":new be(Ct.paint_line["line-color"]),"line-translate":new me(Ct.paint_line["line-translate"]),"line-translate-anchor":new me(Ct.paint_line["line-translate-anchor"]),"line-width":new be(Ct.paint_line["line-width"]),"line-gap-width":new be(Ct.paint_line["line-gap-width"]),"line-offset":new be(Ct.paint_line["line-offset"]),"line-blur":new be(Ct.paint_line["line-blur"]),"line-dasharray":new ku(Ct.paint_line["line-dasharray"]),"line-pattern":new Zc(Ct.paint_line["line-pattern"]),"line-gradient":new Ip(Ct.paint_line["line-gradient"])})},get layout(){return H0=H0||new Zi({"line-cap":new me(Ct.layout_line["line-cap"]),"line-join":new be(Ct.layout_line["line-join"]),"line-miter-limit":new me(Ct.layout_line["line-miter-limit"]),"line-round-limit":new me(Ct.layout_line["line-round-limit"]),"line-sort-key":new be(Ct.layout_line["line-sort-key"])})}};class qS extends be{possiblyEvaluate(i,l){return l=new Hn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(i,l)}evaluate(i,l,p,g){return l=At({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,p,g)}}let jd;class jS extends Ho{constructor(i){super(i,Y0),this.gradientVersion=0,jd||(jd=new qS(Y0.paint.properties["line-width"].specification),jd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(p){return p._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof Eu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,l){super.recalculate(i,l),this.paint._values["line-floorwidth"]=jd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new Xg(i)}queryRadius(i){const l=i,p=K0(Fp("line-width",this,l),Fp("line-gap-width",this,l)),g=Fp("line-offset",this,l);return p/2+Math.abs(g)+zd(this.paint.get("line-translate"))}queryIntersectsFeature(i,l,p,g,v,x,w){const E=Fd(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,w),L=w/2*K0(this.paint.get("line-width").evaluate(l,p),this.paint.get("line-gap-width").evaluate(l,p)),D=this.paint.get("line-offset").evaluate(l,p);return D&&(g=function(R,F){const V=[];for(let G=0;G<R.length;G++){const H=R[G],tt=[];for(let ot=0;ot<H.length;ot++){const vt=H[ot-1],at=H[ot],dt=H[ot+1],kt=ot===0?new P(0,0):at.sub(vt)._unit()._perp(),Ot=ot===H.length-1?new P(0,0):dt.sub(at)._unit()._perp(),ie=kt._add(Ot)._unit(),fe=ie.x*Ot.x+ie.y*Ot.y;fe!==0&&ie._mult(1/fe),tt.push(ie._mult(F)._add(at))}V.push(tt)}return V}(g,D*w)),function(R,F,V){for(let G=0;G<F.length;G++){const H=F[G];if(R.length>=3){for(let tt=0;tt<H.length;tt++)if(nh(R,H[tt]))return!0}if(Op(R,H,V))return!0}return!1}(E,g,L)}isTileClipped(){return!0}}function K0(s,i){return i>0?i+2*s:s}const WS=br([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ZS=br([{name:"a_projected_pos",components:3,type:"Float32"}],4);br([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const HS=br([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);br([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const J0=br([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),XS=br([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function YS(s,i,l){return s.sections.forEach(p=>{p.text=function(g,v,x){const w=v.layout.get("text-transform").evaluate(x,{});return w==="uppercase"?g=g.toLocaleUpperCase():w==="lowercase"&&(g=g.toLocaleLowerCase()),Sa.applyArabicShaping&&(g=Sa.applyArabicShaping(g)),g}(p.text,i,l)}),s}br([{name:"triangle",components:3,type:"Uint16"}]),br([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),br([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),br([{type:"Float32",name:"offsetX"}]),br([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),br([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Hp={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Ur=24,Q0=Mn,$0=function(s,i,l,p,g){var v,x,w=8*g-p-1,E=(1<<w)-1,L=E>>1,D=-7,R=l?g-1:0,F=l?-1:1,V=s[i+R];for(R+=F,v=V&(1<<-D)-1,V>>=-D,D+=w;D>0;v=256*v+s[i+R],R+=F,D-=8);for(x=v&(1<<-D)-1,v>>=-D,D+=p;D>0;x=256*x+s[i+R],R+=F,D-=8);if(v===0)v=1-L;else{if(v===E)return x?NaN:1/0*(V?-1:1);x+=Math.pow(2,p),v-=L}return(V?-1:1)*x*Math.pow(2,v-p)},tv=function(s,i,l,p,g,v){var x,w,E,L=8*v-g-1,D=(1<<L)-1,R=D>>1,F=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=p?0:v-1,G=p?1:-1,H=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(w=isNaN(i)?1:0,x=D):(x=Math.floor(Math.log(i)/Math.LN2),i*(E=Math.pow(2,-x))<1&&(x--,E*=2),(i+=x+R>=1?F/E:F*Math.pow(2,1-R))*E>=2&&(x++,E/=2),x+R>=D?(w=0,x=D):x+R>=1?(w=(i*E-1)*Math.pow(2,g),x+=R):(w=i*Math.pow(2,R-1)*Math.pow(2,g),x=0));g>=8;s[l+V]=255&w,V+=G,w/=256,g-=8);for(x=x<<g|w,L+=g;L>0;s[l+V]=255&x,V+=G,x/=256,L-=8);s[l+V-G]|=128*H};function Mn(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Mn.Varint=0,Mn.Fixed64=1,Mn.Bytes=2,Mn.Fixed32=5;var Yg=4294967296,ev=1/Yg,nv=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function il(s){return s.type===Mn.Bytes?s.readVarint()+s.pos:s.pos+1}function sh(s,i,l){return l?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}function rv(s,i,l){var p=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(p);for(var g=l.pos-1;g>=s;g--)l.buf[g+p]=l.buf[g]}function KS(s,i){for(var l=0;l<s.length;l++)i.writeVarint(s[l])}function JS(s,i){for(var l=0;l<s.length;l++)i.writeSVarint(s[l])}function QS(s,i){for(var l=0;l<s.length;l++)i.writeFloat(s[l])}function $S(s,i){for(var l=0;l<s.length;l++)i.writeDouble(s[l])}function tI(s,i){for(var l=0;l<s.length;l++)i.writeBoolean(s[l])}function eI(s,i){for(var l=0;l<s.length;l++)i.writeFixed32(s[l])}function nI(s,i){for(var l=0;l<s.length;l++)i.writeSFixed32(s[l])}function rI(s,i){for(var l=0;l<s.length;l++)i.writeFixed64(s[l])}function iI(s,i){for(var l=0;l<s.length;l++)i.writeSFixed64(s[l])}function Wd(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function ah(s,i,l){s[l]=i,s[l+1]=i>>>8,s[l+2]=i>>>16,s[l+3]=i>>>24}function iv(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}Mn.prototype={destroy:function(){this.buf=null},readFields:function(s,i,l){for(l=l||this.length;this.pos<l;){var p=this.readVarint(),g=p>>3,v=this.pos;this.type=7&p,s(g,i,this),this.pos===v&&this.skip(p)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=Wd(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=iv(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=Wd(this.buf,this.pos)+Wd(this.buf,this.pos+4)*Yg;return this.pos+=8,s},readSFixed64:function(){var s=Wd(this.buf,this.pos)+iv(this.buf,this.pos+4)*Yg;return this.pos+=8,s},readFloat:function(){var s=$0(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=$0(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,l,p=this.buf;return i=127&(l=p[this.pos++]),l<128?i:(i|=(127&(l=p[this.pos++]))<<7,l<128?i:(i|=(127&(l=p[this.pos++]))<<14,l<128?i:(i|=(127&(l=p[this.pos++]))<<21,l<128?i:function(g,v,x){var w,E,L=x.buf;if(w=(112&(E=L[x.pos++]))>>4,E<128||(w|=(127&(E=L[x.pos++]))<<3,E<128)||(w|=(127&(E=L[x.pos++]))<<10,E<128)||(w|=(127&(E=L[x.pos++]))<<17,E<128)||(w|=(127&(E=L[x.pos++]))<<24,E<128)||(w|=(1&(E=L[x.pos++]))<<31,E<128))return sh(g,w,v);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=p[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&nv?function(l,p,g){return nv.decode(l.subarray(p,g))}(this.buf,i,s):function(l,p,g){for(var v="",x=p;x<g;){var w,E,L,D=l[x],R=null,F=D>239?4:D>223?3:D>191?2:1;if(x+F>g)break;F===1?D<128&&(R=D):F===2?(192&(w=l[x+1]))==128&&(R=(31&D)<<6|63&w)<=127&&(R=null):F===3?(E=l[x+2],(192&(w=l[x+1]))==128&&(192&E)==128&&((R=(15&D)<<12|(63&w)<<6|63&E)<=2047||R>=55296&&R<=57343)&&(R=null)):F===4&&(E=l[x+2],L=l[x+3],(192&(w=l[x+1]))==128&&(192&E)==128&&(192&L)==128&&((R=(15&D)<<18|(63&w)<<12|(63&E)<<6|63&L)<=65535||R>=1114112)&&(R=null)),R===null?(R=65533,F=1):R>65535&&(R-=65536,v+=String.fromCharCode(R>>>10&1023|55296),R=56320|1023&R),v+=String.fromCharCode(R),x+=F}return v}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==Mn.Bytes)return s.push(this.readVarint(i));var l=il(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==Mn.Bytes)return s.push(this.readSVarint());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Mn.Bytes)return s.push(this.readBoolean());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Mn.Bytes)return s.push(this.readFloat());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Mn.Bytes)return s.push(this.readDouble());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Mn.Bytes)return s.push(this.readFixed32());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Mn.Bytes)return s.push(this.readSFixed32());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Mn.Bytes)return s.push(this.readFixed64());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Mn.Bytes)return s.push(this.readSFixed64());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===Mn.Varint)for(;this.buf[this.pos++]>127;);else if(i===Mn.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Mn.Fixed32)this.pos+=4;else{if(i!==Mn.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),ah(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),ah(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),ah(this.buf,-1&s,this.pos),ah(this.buf,Math.floor(s*ev),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),ah(this.buf,-1&s,this.pos),ah(this.buf,Math.floor(s*ev),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,l){var p,g;if(i>=0?(p=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(p=~(-i%4294967296))?p=p+1|0:(p=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(v,x,w){w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,w.buf[w.pos]=127&(v>>>=7)}(p,0,l),function(v,x){var w=(7&v)<<4;x.buf[x.pos++]|=w|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(g,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(p,g,v){for(var x,w,E=0;E<g.length;E++){if((x=g.charCodeAt(E))>55295&&x<57344){if(!w){x>56319||E+1===g.length?(p[v++]=239,p[v++]=191,p[v++]=189):w=x;continue}if(x<56320){p[v++]=239,p[v++]=191,p[v++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(p[v++]=239,p[v++]=191,p[v++]=189,w=null);x<128?p[v++]=x:(x<2048?p[v++]=x>>6|192:(x<65536?p[v++]=x>>12|224:(p[v++]=x>>18|240,p[v++]=x>>12&63|128),p[v++]=x>>6&63|128),p[v++]=63&x|128)}return v}(this.buf,s,this.pos);var l=this.pos-i;l>=128&&rv(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),tv(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),tv(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,i){this.pos++;var l=this.pos;s(i,this);var p=this.pos-l;p>=128&&rv(l,p,this),this.pos=l-1,this.writeVarint(p),this.pos+=p},writeMessage:function(s,i,l){this.writeTag(s,Mn.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,KS,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,JS,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,tI,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,QS,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,$S,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,eI,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,nI,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,rI,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,iI,i)},writeBytesField:function(s,i){this.writeTag(s,Mn.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,Mn.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,Mn.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,Mn.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,Mn.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,Mn.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,Mn.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,Mn.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,Mn.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,Mn.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var Kg=b(Q0);const Jg=3;function oI(s,i,l){s===1&&l.readMessage(sI,i)}function sI(s,i,l){if(s===3){const{id:p,bitmap:g,width:v,height:x,left:w,top:E,advance:L}=l.readMessage(aI,{});i.push({id:p,bitmap:new Vp({width:v+2*Jg,height:x+2*Jg},g),metrics:{width:v,height:x,left:w,top:E,advance:L}})}}function aI(s,i,l){s===1?i.id=l.readVarint():s===2?i.bitmap=l.readBytes():s===3?i.width=l.readVarint():s===4?i.height=l.readVarint():s===5?i.left=l.readSVarint():s===6?i.top=l.readSVarint():s===7&&(i.advance=l.readVarint())}const ov=Jg;function sv(s){let i=0,l=0;for(const x of s)i+=x.w*x.h,l=Math.max(l,x.w);s.sort((x,w)=>w.h-x.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let g=0,v=0;for(const x of s)for(let w=p.length-1;w>=0;w--){const E=p[w];if(!(x.w>E.w||x.h>E.h)){if(x.x=E.x,x.y=E.y,v=Math.max(v,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===E.w&&x.h===E.h){const L=p.pop();w<p.length&&(p[w]=L)}else x.h===E.h?(E.x+=x.w,E.w-=x.w):x.w===E.w?(E.y+=x.h,E.h-=x.h):(p.push({x:E.x+x.w,y:E.y,w:E.w-x.w,h:x.h}),E.y+=x.h,E.h-=x.h);break}}return{w:g,h:v,fill:i/(g*v)||0}}const ho=1;class Qg{constructor(i,{pixelRatio:l,version:p,stretchX:g,stretchY:v,content:x}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=g,this.stretchY=v,this.content=x,this.version=p}get tl(){return[this.paddedRect.x+ho,this.paddedRect.y+ho]}get br(){return[this.paddedRect.x+this.paddedRect.w-ho,this.paddedRect.y+this.paddedRect.h-ho]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ho)/this.pixelRatio,(this.paddedRect.h-2*ho)/this.pixelRatio]}}class av{constructor(i,l){const p={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(i,p,v),this.addImages(l,g,v);const{w:x,h:w}=sv(v),E=new Xo({width:x||1,height:w||1});for(const L in i){const D=i[L],R=p[L].paddedRect;Xo.copy(D.data,E,{x:0,y:0},{x:R.x+ho,y:R.y+ho},D.data)}for(const L in l){const D=l[L],R=g[L].paddedRect,F=R.x+ho,V=R.y+ho,G=D.data.width,H=D.data.height;Xo.copy(D.data,E,{x:0,y:0},{x:F,y:V},D.data),Xo.copy(D.data,E,{x:0,y:H-1},{x:F,y:V-1},{width:G,height:1}),Xo.copy(D.data,E,{x:0,y:0},{x:F,y:V+H},{width:G,height:1}),Xo.copy(D.data,E,{x:G-1,y:0},{x:F-1,y:V},{width:1,height:H}),Xo.copy(D.data,E,{x:0,y:0},{x:F+G,y:V},{width:1,height:H})}this.image=E,this.iconPositions=p,this.patternPositions=g}addImages(i,l,p){for(const g in i){const v=i[g],x={x:0,y:0,w:v.data.width+2*ho,h:v.data.height+2*ho};p.push(x),l[g]=new Qg(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in i.updatedImages)this.patchUpdatedImage(this.iconPositions[p],i.getImage(p),l),this.patchUpdatedImage(this.patternPositions[p],i.getImage(p),l)}patchUpdatedImage(i,l,p){if(!i||!l||i.version===l.version)return;i.version=l.version;const[g,v]=i.tl;p.update(l.data,void 0,{x:g,y:v})}}var jl;ae("ImagePosition",Qg),ae("ImageAtlas",av),f.ah=void 0,(jl=f.ah||(f.ah={}))[jl.none=0]="none",jl[jl.horizontal=1]="horizontal",jl[jl.vertical=2]="vertical",jl[jl.horizontalOnly=3]="horizontalOnly";const Xp=-17;class Yp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const p=new Yp;return p.scale=i||1,p.fontStack=l,p}static forImage(i){const l=new Yp;return l.imageName=i,l}}class lh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const p=new lh;for(let g=0;g<i.sections.length;g++){const v=i.sections[g];v.image?p.addImageSection(v):p.addTextSection(v,l)}return p}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let p=0;p<i.length;p++){const g=i.charCodeAt(p+1)||null,v=i.charCodeAt(p-1)||null;l+=g&&wp(g)&&!Hp[i[p+1]]||v&&wp(v)&&!Hp[i[p-1]]||!Hp[i[p]]?i[p]:Hp[i[p]]}return l}(this.text)}trim(){let i=0;for(let p=0;p<this.text.length&&Hd[this.text.charCodeAt(p)];p++)i++;let l=this.text.length;for(let p=this.text.length-1;p>=0&&p>=i&&Hd[this.text.charCodeAt(p)];p--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const p=new lh;return p.text=this.text.substring(i,l),p.sectionIndex=this.sectionIndex.slice(i,l),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(Yp.forText(i.scale,i.fontStack||l));const p=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(p)}addImageSection(i){const l=i.image?i.image.name:"";if(l.length===0)return void te("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(Yp.forImage(l)),this.sectionIndex.push(this.sections.length-1)):te("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Zd(s,i,l,p,g,v,x,w,E,L,D,R,F,V,G,H){const tt=lh.fromFeature(s,g);let ot;R===f.ah.vertical&&tt.verticalizePunctuation();const{processBidirectionalText:vt,processStyledBidirectionalText:at}=Sa;if(vt&&tt.sections.length===1){ot=[];const Ot=vt(tt.toString(),$g(tt,L,v,i,p,V,G));for(const ie of Ot){const fe=new lh;fe.text=ie,fe.sections=tt.sections;for(let re=0;re<ie.length;re++)fe.sectionIndex.push(0);ot.push(fe)}}else if(at){ot=[];const Ot=at(tt.text,tt.sectionIndex,$g(tt,L,v,i,p,V,G));for(const ie of Ot){const fe=new lh;fe.text=ie[0],fe.sectionIndex=ie[1],fe.sections=tt.sections,ot.push(fe)}}else ot=function(Ot,ie){const fe=[],re=Ot.text;let ee=0;for(const Ht of ie)fe.push(Ot.substring(ee,Ht)),ee=Ht;return ee<re.length&&fe.push(Ot.substring(ee,re.length)),fe}(tt,$g(tt,L,v,i,p,V,G));const dt=[],kt={positionedLines:dt,text:tt.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:R,iconsInText:!1,verticalizable:!1};return function(Ot,ie,fe,re,ee,Ht,ce,Jt,Gt,ve,de,Ye){let Gn=0,Yn=Xp,Gr=0,ko=0;const Xi=Jt==="right"?1:Jt==="left"?0:.5;let Nr=0;for(const qr of ee){qr.trim();const jr=qr.getMaxScale(),Di=(jr-1)*Ur,Ji={positionedGlyphs:[],lineOffset:0};Ot.positionedLines[Nr]=Ji;const ki=Ji.positionedGlyphs;let po=0;if(!qr.length()){Yn+=Ht,++Nr;continue}for(let Wr=0;Wr<qr.length();Wr++){const nn=qr.getSection(Wr),Ri=qr.getSectionIndex(Wr),yi=qr.getCharCode(Wr);let Zr=0,xs=null,Zs=null,Hs=null,ol=Ur;const bs=!(Gt===f.ah.horizontal||!de&&!qc(yi)||de&&(Hd[yi]||(ai=yi,ne.Arabic(ai)||ne["Arabic Supplement"](ai)||ne["Arabic Extended-A"](ai)||ne["Arabic Presentation Forms-A"](ai)||ne["Arabic Presentation Forms-B"](ai))));if(nn.imageName){const Ko=re[nn.imageName];if(!Ko)continue;Hs=nn.imageName,Ot.iconsInText=Ot.iconsInText||!0,Zs=Ko.paddedRect;const mo=Ko.displaySize;nn.scale=nn.scale*Ur/Ye,xs={width:mo[0],height:mo[1],left:ho,top:-ov,advance:bs?mo[1]:mo[0]},Zr=Di+(Ur-mo[1]*nn.scale),ol=xs.advance;const sl=bs?mo[0]*nn.scale-Ur*jr:mo[1]*nn.scale-Ur*jr;sl>0&&sl>po&&(po=sl)}else{const Ko=fe[nn.fontStack],mo=Ko&&Ko[yi];if(mo&&mo.rect)Zs=mo.rect,xs=mo.metrics;else{const sl=ie[nn.fontStack],tf=sl&&sl[yi];if(!tf)continue;xs=tf.metrics}Zr=(jr-nn.scale)*Ur}bs?(Ot.verticalizable=!0,ki.push({glyph:yi,imageName:Hs,x:Gn,y:Yn+Zr,vertical:bs,scale:nn.scale,fontStack:nn.fontStack,sectionIndex:Ri,metrics:xs,rect:Zs}),Gn+=ol*nn.scale+ve):(ki.push({glyph:yi,imageName:Hs,x:Gn,y:Yn+Zr,vertical:bs,scale:nn.scale,fontStack:nn.fontStack,sectionIndex:Ri,metrics:xs,rect:Zs}),Gn+=xs.advance*nn.scale+ve)}ki.length!==0&&(Gr=Math.max(Gn-ve,Gr),cI(ki,0,ki.length-1,Xi,po)),Gn=0;const fo=Ht*jr+po;Ji.lineOffset=Math.max(po,Di),Yn+=fo,ko=Math.max(fo,ko),++Nr}var ai;const gi=Yn-Xp,{horizontalAlign:Yi,verticalAlign:Ki}=ty(ce);(function(qr,jr,Di,Ji,ki,po,fo,Wr,nn){const Ri=(jr-Di)*ki;let yi=0;yi=po!==fo?-Wr*Ji-Xp:(-Ji*nn+.5)*fo;for(const Zr of qr)for(const xs of Zr.positionedGlyphs)xs.x+=Ri,xs.y+=yi})(Ot.positionedLines,Xi,Yi,Ki,Gr,ko,Ht,gi,ee.length),Ot.top+=-Ki*gi,Ot.bottom=Ot.top+gi,Ot.left+=-Yi*Gr,Ot.right=Ot.left+Gr}(kt,i,l,p,ot,x,w,E,R,L,F,H),!function(Ot){for(const ie of Ot)if(ie.positionedGlyphs.length!==0)return!1;return!0}(dt)&&kt}const Hd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},lI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function lv(s,i,l,p,g,v){if(i.imageName){const x=p[i.imageName];return x?x.displaySize[0]*i.scale*Ur/v+g:0}{const x=l[i.fontStack],w=x&&x[s];return w?w.metrics.advance*i.scale+g:0}}function uv(s,i,l,p){const g=Math.pow(s-i,2);return p?s<i?g/2:2*g:g+Math.abs(l)*l}function uI(s,i,l){let p=0;return s===10&&(p-=1e4),l&&(p+=150),s!==40&&s!==65288||(p+=50),i!==41&&i!==65289||(p+=50),p}function cv(s,i,l,p,g,v){let x=null,w=uv(i,l,g,v);for(const E of p){const L=uv(i-E.x,l,g,v)+E.badness;L<=w&&(x=E,w=L)}return{index:s,x:i,priorBreak:x,badness:w}}function hv(s){return s?hv(s.priorBreak).concat(s.index):[]}function $g(s,i,l,p,g,v,x){if(v!=="point")return[];if(!s)return[];const w=[],E=function(F,V,G,H,tt,ot){let vt=0;for(let at=0;at<F.length();at++){const dt=F.getSection(at);vt+=lv(F.getCharCode(at),dt,H,tt,V,ot)}return vt/Math.max(1,Math.ceil(vt/G))}(s,i,l,p,g,x),L=s.text.indexOf("​")>=0;let D=0;for(let F=0;F<s.length();F++){const V=s.getSection(F),G=s.getCharCode(F);if(Hd[G]||(D+=lv(G,V,p,g,i,x)),F<s.length()-1){const H=!((R=G)<11904||!(ne["Bopomofo Extended"](R)||ne.Bopomofo(R)||ne["CJK Compatibility Forms"](R)||ne["CJK Compatibility Ideographs"](R)||ne["CJK Compatibility"](R)||ne["CJK Radicals Supplement"](R)||ne["CJK Strokes"](R)||ne["CJK Symbols and Punctuation"](R)||ne["CJK Unified Ideographs Extension A"](R)||ne["CJK Unified Ideographs"](R)||ne["Enclosed CJK Letters and Months"](R)||ne["Halfwidth and Fullwidth Forms"](R)||ne.Hiragana(R)||ne["Ideographic Description Characters"](R)||ne["Kangxi Radicals"](R)||ne["Katakana Phonetic Extensions"](R)||ne.Katakana(R)||ne["Vertical Forms"](R)||ne["Yi Radicals"](R)||ne["Yi Syllables"](R)));(lI[G]||H||V.imageName)&&w.push(cv(F+1,D,E,w,uI(G,s.getCharCode(F+1),H&&L),!1))}}var R;return hv(cv(s.length(),D,E,w,0,!0))}function ty(s){let i=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function cI(s,i,l,p,g){if(!p&&!g)return;const v=s[l],x=(s[l].x+v.metrics.advance*v.scale)*p;for(let w=i;w<=l;w++)s[w].x-=x,s[w].y+=g}function hI(s,i,l){const{horizontalAlign:p,verticalAlign:g}=ty(l),v=i[0]-s.displaySize[0]*p,x=i[1]-s.displaySize[1]*g;return{image:s,top:x,bottom:x+s.displaySize[1],left:v,right:v+s.displaySize[0]}}function pv(s,i,l,p,g,v){const x=s.image;let w;if(x.content){const tt=x.content,ot=x.pixelRatio||1;w=[tt[0]/ot,tt[1]/ot,x.displaySize[0]-tt[2]/ot,x.displaySize[1]-tt[3]/ot]}const E=i.left*v,L=i.right*v;let D,R,F,V;l==="width"||l==="both"?(V=g[0]+E-p[3],R=g[0]+L+p[1]):(V=g[0]+(E+L-x.displaySize[0])/2,R=V+x.displaySize[0]);const G=i.top*v,H=i.bottom*v;return l==="height"||l==="both"?(D=g[1]+G-p[0],F=g[1]+H+p[2]):(D=g[1]+(G+H-x.displaySize[1])/2,F=D+x.displaySize[1]),{image:x,top:D,right:R,bottom:F,left:V,collisionPadding:w}}const Kp=255,Ta=128,Wl=Kp*Ta;function fv(s,i){const{expression:l}=i;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Hn(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:g}=l;let v=0;for(;v<p.length&&p[v]<=s;)v++;v=Math.max(0,v-1);let x=v;for(;x<p.length&&p[x]<s+1;)x++;x=Math.min(p.length-1,x);const w=p[v],E=p[x];return l.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:g}:{kind:"camera",minZoom:w,maxZoom:E,minSize:l.evaluate(new Hn(w)),maxSize:l.evaluate(new Hn(E)),interpolationType:g}}}function ey(s,i,l){let p="never";const g=s.get(i);return g?p=g:s.get(l)&&(p="always"),p}const pI=ql.VectorTileFeature.types,fI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Xd(s,i,l,p,g,v,x,w,E,L,D,R,F){const V=w?Math.min(Wl,Math.round(w[0])):0,G=w?Math.min(Wl,Math.round(w[1])):0;s.emplaceBack(i,l,Math.round(32*p),Math.round(32*g),v,x,(V<<1)+(E?1:0),G,16*L,16*D,256*R,256*F)}function ny(s,i,l){s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l)}function dI(s){for(const i of s.sections)if(kg(i.text))return!0;return!1}class ry{constructor(i){this.layoutVertexArray=new It,this.indexArray=new Dt,this.programConfigurations=i,this.segments=new Xt,this.dynamicLayoutVertexArray=new it,this.opacityVertexArray=new mt,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,l,p,g){this.isEmpty()||(p&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,WS.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,ZS.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,fI,!0),this.opacityVertexBuffer.itemSize=1),(p||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ae("SymbolBuffers",ry);class iy{constructor(i,l,p){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new p,this.segments=new Xt,this.collisionVertexArray=new Pt}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,HS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ae("CollisionBuffers",iy);class uh{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(x=>x.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ng([]),this.placementViewportMatrix=Ng([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=fv(this.zoom,l["text-size"]),this.iconSizeData=fv(this.zoom,l["icon-size"]);const p=this.layers[0].layout,g=p.get("symbol-sort-key"),v=p.get("symbol-z-order");this.canOverlap=ey(p,"text-overlap","text-allow-overlap")!=="never"||ey(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(x=>f.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=i.sourceID}createArrays(){this.text=new ry(new rr(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new ry(new rr(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new _,this.lineVertexArray=new S,this.symbolInstances=new m,this.textAnchorOffsets=new T}calculateGlyphDependencies(i,l,p,g,v){for(let x=0;x<i.length;x++)if(l[i.charCodeAt(x)]=!0,(p||g)&&v){const w=Hp[i.charAt(x)];w&&(l[w.charCodeAt(0)]=!0)}}populate(i,l,p){const g=this.layers[0],v=g.layout,x=v.get("text-font"),w=v.get("text-field"),E=v.get("icon-image"),L=(w.value.kind!=="constant"||w.value.value instanceof so&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),D=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,R=v.get("symbol-sort-key");if(this.features=[],!L&&!D)return;const F=l.iconDependencies,V=l.glyphDependencies,G=l.availableImages,H=new Hn(this.zoom);for(const{feature:tt,id:ot,index:vt,sourceLayerIndex:at}of i){const dt=g._featureFilter.needGeometry,kt=rl(tt,dt);if(!g._featureFilter.filter(H,kt,p))continue;let Ot,ie;if(dt||(kt.geometry=nl(tt)),L){const re=g.getValueAndResolveTokens("text-field",kt,p,G),ee=so.factory(re),Ht=this.hasRTLText=this.hasRTLText||dI(ee);(!Ht||Sa.getRTLTextPluginStatus()==="unavailable"||Ht&&Sa.isParsed())&&(Ot=YS(ee,g,kt))}if(D){const re=g.getValueAndResolveTokens("icon-image",kt,p,G);ie=re instanceof Ao?re:Ao.fromString(re)}if(!Ot&&!ie)continue;const fe=this.sortFeaturesByKey?R.evaluate(kt,{},p):void 0;if(this.features.push({id:ot,text:Ot,icon:ie,index:vt,sourceLayerIndex:at,geometry:kt.geometry,properties:tt.properties,type:pI[tt.type],sortKey:fe}),ie&&(F[ie.name]=!0),Ot){const re=x.evaluate(kt,{},p).join(","),ee=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ah.vertical)>=0;for(const Ht of Ot.sections)if(Ht.image)F[Ht.image.name]=!0;else{const ce=Ul(Ot.toString()),Jt=Ht.fontStack||re,Gt=V[Jt]=V[Jt]||{};this.calculateGlyphDependencies(Ht.text,Gt,ee,this.allowVerticalPlacement,ce)}}}v.get("symbol-placement")==="line"&&(this.features=function(tt){const ot={},vt={},at=[];let dt=0;function kt(re){at.push(tt[re]),dt++}function Ot(re,ee,Ht){const ce=vt[re];return delete vt[re],vt[ee]=ce,at[ce].geometry[0].pop(),at[ce].geometry[0]=at[ce].geometry[0].concat(Ht[0]),ce}function ie(re,ee,Ht){const ce=ot[ee];return delete ot[ee],ot[re]=ce,at[ce].geometry[0].shift(),at[ce].geometry[0]=Ht[0].concat(at[ce].geometry[0]),ce}function fe(re,ee,Ht){const ce=Ht?ee[0][ee[0].length-1]:ee[0][0];return`${re}:${ce.x}:${ce.y}`}for(let re=0;re<tt.length;re++){const ee=tt[re],Ht=ee.geometry,ce=ee.text?ee.text.toString():null;if(!ce){kt(re);continue}const Jt=fe(ce,Ht),Gt=fe(ce,Ht,!0);if(Jt in vt&&Gt in ot&&vt[Jt]!==ot[Gt]){const ve=ie(Jt,Gt,Ht),de=Ot(Jt,Gt,at[ve].geometry);delete ot[Jt],delete vt[Gt],vt[fe(ce,at[de].geometry,!0)]=de,at[ve].geometry=null}else Jt in vt?Ot(Jt,Gt,Ht):Gt in ot?ie(Jt,Gt,Ht):(kt(re),ot[Jt]=dt-1,vt[Gt]=dt-1)}return at.filter(re=>re.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((tt,ot)=>tt.sortKey-ot.sortKey)}update(i,l,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,p),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const p=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(l[i.segment+1]),v=i.dist(l[i.segment]);const x={};for(let w=i.segment+1;w<l.length;w++)x[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:g},w<l.length-1&&(g+=l[w+1].dist(l[w]));for(let w=i.segment||0;w>=0;w--)x[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:v},w>0&&(v+=l[w-1].dist(l[w]));for(let w=0;w<l.length;w++){const E=x[w];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(i,l,p,g,v,x,w,E,L,D,R,F){const V=i.indexArray,G=i.layoutVertexArray,H=i.segments.prepareSegment(4*l.length,G,V,this.canOverlap?x.sortKey:void 0),tt=this.glyphOffsetArray.length,ot=H.vertexLength,vt=this.allowVerticalPlacement&&w===f.ah.vertical?Math.PI/2:0,at=x.text&&x.text.sections;for(let dt=0;dt<l.length;dt++){const{tl:kt,tr:Ot,bl:ie,br:fe,tex:re,pixelOffsetTL:ee,pixelOffsetBR:Ht,minFontScaleX:ce,minFontScaleY:Jt,glyphOffset:Gt,isSDF:ve,sectionIndex:de}=l[dt],Ye=H.vertexLength,Gn=Gt[1];Xd(G,E.x,E.y,kt.x,Gn+kt.y,re.x,re.y,p,ve,ee.x,ee.y,ce,Jt),Xd(G,E.x,E.y,Ot.x,Gn+Ot.y,re.x+re.w,re.y,p,ve,Ht.x,ee.y,ce,Jt),Xd(G,E.x,E.y,ie.x,Gn+ie.y,re.x,re.y+re.h,p,ve,ee.x,Ht.y,ce,Jt),Xd(G,E.x,E.y,fe.x,Gn+fe.y,re.x+re.w,re.y+re.h,p,ve,Ht.x,Ht.y,ce,Jt),ny(i.dynamicLayoutVertexArray,E,vt),V.emplaceBack(Ye,Ye+1,Ye+2),V.emplaceBack(Ye+1,Ye+2,Ye+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Gt[0]),dt!==l.length-1&&de===l[dt+1].sectionIndex||i.programConfigurations.populatePaintArrays(G.length,x,x.index,{},F,at&&at[de])}i.placedSymbolArray.emplaceBack(E.x,E.y,tt,this.glyphOffsetArray.length-tt,ot,L,D,E.segment,p?p[0]:0,p?p[1]:0,g[0],g[1],w,0,!1,0,R)}_addCollisionDebugVertex(i,l,p,g,v,x){return l.emplaceBack(0,0),i.emplaceBack(p.x,p.y,g,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(i,l,p,g,v,x,w){const E=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),L=E.vertexLength,D=v.layoutVertexArray,R=v.collisionVertexArray,F=w.anchorX,V=w.anchorY;this._addCollisionDebugVertex(D,R,x,F,V,new P(i,l)),this._addCollisionDebugVertex(D,R,x,F,V,new P(p,l)),this._addCollisionDebugVertex(D,R,x,F,V,new P(p,g)),this._addCollisionDebugVertex(D,R,x,F,V,new P(i,g)),E.vertexLength+=4;const G=v.indexArray;G.emplaceBack(L,L+1),G.emplaceBack(L+1,L+2),G.emplaceBack(L+2,L+3),G.emplaceBack(L+3,L),E.primitiveLength+=4}addDebugCollisionBoxes(i,l,p,g){for(let v=i;v<l;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new iy(Et,J0.members,Bt),this.iconCollisionBox=new iy(Et,J0.members,Bt);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,p,g,v,x,w,E,L){const D={};for(let R=l;R<p;R++){const F=i.get(R);D.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},D.textFeatureIndex=F.featureIndex;break}for(let R=g;R<v;R++){const F=i.get(R);D.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},D.verticalTextFeatureIndex=F.featureIndex;break}for(let R=x;R<w;R++){const F=i.get(R);D.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},D.iconFeatureIndex=F.featureIndex;break}for(let R=E;R<L;R++){const F=i.get(R);D.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},D.verticalIconFeatureIndex=F.featureIndex;break}return D}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const p=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const p=i.placedSymbolArray.get(l),g=p.vertexStartIndex+4*p.numGlyphs;for(let v=p.vertexStartIndex;v<g;v+=4)i.indexArray.emplaceBack(v,v+1,v+2),i.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),p=Math.cos(i),g=[],v=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);const E=this.symbolInstances.get(w);g.push(0|Math.round(l*E.anchorX+p*E.anchorY)),v.push(E.featureIndex)}return x.sort((w,E)=>g[w]-g[E]||v[E]-v[w]),x}addToSortKeyRanges(i,l){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===l?p.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const p=this.symbolInstances.get(l);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((g,v,x)=>{g>=0&&x.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let dv,mv;ae("SymbolBucket",uh,{omit:["layers","collisionBoxArray","features","compareText"]}),uh.MAX_GLYPHS=65535,uh.addDynamicAttributes=ny;var oy={get paint(){return mv=mv||new Zi({"icon-opacity":new be(Ct.paint_symbol["icon-opacity"]),"icon-color":new be(Ct.paint_symbol["icon-color"]),"icon-halo-color":new be(Ct.paint_symbol["icon-halo-color"]),"icon-halo-width":new be(Ct.paint_symbol["icon-halo-width"]),"icon-halo-blur":new be(Ct.paint_symbol["icon-halo-blur"]),"icon-translate":new me(Ct.paint_symbol["icon-translate"]),"icon-translate-anchor":new me(Ct.paint_symbol["icon-translate-anchor"]),"text-opacity":new be(Ct.paint_symbol["text-opacity"]),"text-color":new be(Ct.paint_symbol["text-color"],{runtimeType:Pr,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new be(Ct.paint_symbol["text-halo-color"]),"text-halo-width":new be(Ct.paint_symbol["text-halo-width"]),"text-halo-blur":new be(Ct.paint_symbol["text-halo-blur"]),"text-translate":new me(Ct.paint_symbol["text-translate"]),"text-translate-anchor":new me(Ct.paint_symbol["text-translate-anchor"])})},get layout(){return dv=dv||new Zi({"symbol-placement":new me(Ct.layout_symbol["symbol-placement"]),"symbol-spacing":new me(Ct.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new me(Ct.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new be(Ct.layout_symbol["symbol-sort-key"]),"symbol-z-order":new me(Ct.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new me(Ct.layout_symbol["icon-allow-overlap"]),"icon-overlap":new me(Ct.layout_symbol["icon-overlap"]),"icon-ignore-placement":new me(Ct.layout_symbol["icon-ignore-placement"]),"icon-optional":new me(Ct.layout_symbol["icon-optional"]),"icon-rotation-alignment":new me(Ct.layout_symbol["icon-rotation-alignment"]),"icon-size":new be(Ct.layout_symbol["icon-size"]),"icon-text-fit":new me(Ct.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new me(Ct.layout_symbol["icon-text-fit-padding"]),"icon-image":new be(Ct.layout_symbol["icon-image"]),"icon-rotate":new be(Ct.layout_symbol["icon-rotate"]),"icon-padding":new be(Ct.layout_symbol["icon-padding"]),"icon-keep-upright":new me(Ct.layout_symbol["icon-keep-upright"]),"icon-offset":new be(Ct.layout_symbol["icon-offset"]),"icon-anchor":new be(Ct.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new me(Ct.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new me(Ct.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new me(Ct.layout_symbol["text-rotation-alignment"]),"text-field":new be(Ct.layout_symbol["text-field"]),"text-font":new be(Ct.layout_symbol["text-font"]),"text-size":new be(Ct.layout_symbol["text-size"]),"text-max-width":new be(Ct.layout_symbol["text-max-width"]),"text-line-height":new me(Ct.layout_symbol["text-line-height"]),"text-letter-spacing":new be(Ct.layout_symbol["text-letter-spacing"]),"text-justify":new be(Ct.layout_symbol["text-justify"]),"text-radial-offset":new be(Ct.layout_symbol["text-radial-offset"]),"text-variable-anchor":new me(Ct.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new be(Ct.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new be(Ct.layout_symbol["text-anchor"]),"text-max-angle":new me(Ct.layout_symbol["text-max-angle"]),"text-writing-mode":new me(Ct.layout_symbol["text-writing-mode"]),"text-rotate":new be(Ct.layout_symbol["text-rotate"]),"text-padding":new me(Ct.layout_symbol["text-padding"]),"text-keep-upright":new me(Ct.layout_symbol["text-keep-upright"]),"text-transform":new be(Ct.layout_symbol["text-transform"]),"text-offset":new be(Ct.layout_symbol["text-offset"]),"text-allow-overlap":new me(Ct.layout_symbol["text-allow-overlap"]),"text-overlap":new me(Ct.layout_symbol["text-overlap"]),"text-ignore-placement":new me(Ct.layout_symbol["text-ignore-placement"]),"text-optional":new me(Ct.layout_symbol["text-optional"])})}};class gv{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:fi,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ae("FormatSectionOverride",gv,{omit:["defaultValue"]});class Yd extends Ho{constructor(i){super(i,oy)}recalculate(i,l){if(super.recalculate(i,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const g=[];for(const v of p)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,p,g){const v=this.layout.get(i).evaluate(l,{},p,g),x=this._unevaluatedLayout._values[i];return x.isDataDriven()||On(x.value)||!v?v:function(w,E){return E.replace(/{([^{}]+)}/g,(L,D)=>w&&D in w?String(w[D]):"")}(l.properties,v)}createBucket(i){return new uh(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of oy.paint.overridableProperties){if(!Yd.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),p=new gv(l),g=new Un(p,l.property.specification);let v=null;v=l.value.kind==="constant"||l.value.kind==="source"?new Dc("source",g):new fp("composite",g,l.value.zoomStops),this.paint._values[i]=new Zo(l.property,v,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,p){return!(!this.layout||l.isDataDriven()||p.isDataDriven())&&Yd.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const p=i.get("text-field"),g=oy.paint.properties[l];let v=!1;const x=w=>{for(const E of w)if(g.overrides&&g.overrides.hasOverride(E))return void(v=!0)};if(p.value.kind==="constant"&&p.value.value instanceof so)x(p.value.value.sections);else if(p.value.kind==="source"){const w=L=>{v||(L instanceof _a&&Mr(L.value)===zr?x(L.value.sections):L instanceof Ac?x(L.sections):L.eachChild(w))},E=p.value;E._styleExpression&&w(E._styleExpression.expression)}return v}}let yv;var mI={get paint(){return yv=yv||new Zi({"background-color":new me(Ct.paint_background["background-color"]),"background-pattern":new ku(Ct.paint_background["background-pattern"]),"background-opacity":new me(Ct.paint_background["background-opacity"])})}};class gI extends Ho{constructor(i){super(i,mI)}}let _v;var yI={get paint(){return _v=_v||new Zi({"raster-opacity":new me(Ct.paint_raster["raster-opacity"]),"raster-hue-rotate":new me(Ct.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new me(Ct.paint_raster["raster-brightness-min"]),"raster-brightness-max":new me(Ct.paint_raster["raster-brightness-max"]),"raster-saturation":new me(Ct.paint_raster["raster-saturation"]),"raster-contrast":new me(Ct.paint_raster["raster-contrast"]),"raster-resampling":new me(Ct.paint_raster["raster-resampling"]),"raster-fade-duration":new me(Ct.paint_raster["raster-fade-duration"])})}};class _I extends Ho{constructor(i){super(i,yI)}}class vI extends Ho{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class xI{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const sy=63710088e-1;class Zl{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zl(Lt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,p=this.lat*l,g=i.lat*l,v=Math.sin(p)*Math.sin(g)+Math.cos(p)*Math.cos(g)*Math.cos((i.lng-this.lng)*l);return sy*Math.acos(Math.min(v,1))}static convert(i){if(i instanceof Zl)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Zl(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Zl(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const vv=2*Math.PI*sy;function xv(s){return vv*Math.cos(s*Math.PI/180)}function bv(s){return(180+s)/360}function wv(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Sv(s,i){return s/xv(i)}function ay(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class Kd{constructor(i,l,p=0){this.x=+i,this.y=+l,this.z=+p}static fromLngLat(i,l=0){const p=Zl.convert(i);return new Kd(bv(p.lng),wv(p.lat),Sv(l,p.lat))}toLngLat(){return new Zl(360*this.x-180,ay(this.y))}toAltitude(){return this.z*xv(ay(this.y))}meterInMercatorCoordinateUnits(){return 1/vv*(i=ay(this.y),1/Math.cos(i*Math.PI/180));var i}}function Iv(s,i,l){var p=2*Math.PI*6378137/256/Math.pow(2,l);return[s*p-2*Math.PI*6378137/2,i*p-2*Math.PI*6378137/2]}class ly{constructor(i,l,p){if(i<0||i>25||p<0||p>=Math.pow(2,i)||l<0||l>=Math.pow(2,i))throw new Error(`x=${l}, y=${p}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=l,this.y=p,this.key=Jp(0,i,i,l,p)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,p){const g=(x=this.y,w=this.z,E=Iv(256*(v=this.x),256*(x=Math.pow(2,w)-x-1),w),L=Iv(256*(v+1),256*(x+1),w),E[0]+","+E[1]+","+L[0]+","+L[1]);var v,x,w,E,L;const D=function(R,F,V){let G,H="";for(let tt=R;tt>0;tt--)G=1<<tt-1,H+=(F&G?1:0)+(V&G?2:0);return H}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const l=this.z-i.z;return l>0&&i.x===this.x>>l&&i.y===this.y>>l}getTilePoint(i){const l=Math.pow(2,this.z);return new P((i.x*l-this.x)*gr,(i.y*l-this.y)*gr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ev{constructor(i,l){this.wrap=i,this.canonical=l,this.key=Jp(i,l.z,l.z,l.x,l.y)}}class Yo{constructor(i,l,p,g,v){if(i<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${p}`);this.overscaledZ=i,this.wrap=l,this.canonical=new ly(p,+g,+v),this.key=Jp(l,i,p,g,v)}clone(){return new Yo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-i;return i>this.canonical.z?new Yo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yo(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-i;return i>this.canonical.z?Jp(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):Jp(this.wrap*+l,i,i,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new Yo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,p=2*this.canonical.x,g=2*this.canonical.y;return[new Yo(l,this.wrap,l,p,g),new Yo(l,this.wrap,l,p+1,g),new Yo(l,this.wrap,l,p,g+1),new Yo(l,this.wrap,l,p+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Yo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Yo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ev(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Kd(i.x-this.wrap,i.y))}}function Jp(s,i,l,p,g){(s*=2)<0&&(s=-1*s-1);const v=1<<l;return(v*v*s+v*g+p).toString(36)+l.toString(36)+i.toString(36)}ae("CanonicalTileID",ly),ae("OverscaledTileID",Yo,{omit:["posMatrix"]});class Cv{constructor(i,l,p,g=1,v=1,x=1,w=0){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(p&&!["mapbox","terrarium","custom"].includes(p))return void te(`"${p}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const E=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),p){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=v,this.blueFactor=x,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let L=0;L<E;L++)this.data[this._idx(-1,L)]=this.data[this._idx(0,L)],this.data[this._idx(E,L)]=this.data[this._idx(E-1,L)],this.data[this._idx(L,-1)]=this.data[this._idx(L,0)],this.data[this._idx(L,E)]=this.data[this._idx(L,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let L=0;L<E;L++)for(let D=0;D<E;D++){const R=this.get(L,D);R>this.max&&(this.max=R),R<this.min&&(this.min=R)}}get(i,l){const p=new Uint8Array(this.data.buffer),g=4*this._idx(i,l);return this.unpack(p[g],p[g+1],p[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}unpack(i,l,p){return i*this.redFactor+l*this.greenFactor+p*this.blueFactor-this.baseShift}getPixels(){return new Xo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,p){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,v=l*this.dim+this.dim,x=p*this.dim,w=p*this.dim+this.dim;switch(l){case-1:g=v-1;break;case 1:v=g+1}switch(p){case-1:x=w-1;break;case 1:w=x+1}const E=-l*this.dim,L=-p*this.dim;for(let D=x;D<w;D++)for(let R=g;R<v;R++)this.data[this._idx(R,D)]=i.data[this._idx(R+E,D+L)]}}ae("DEMData",Cv);class Tv{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const p=i[l];this._stringToNumber[p]=l,this._numberToString[l]=p}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class Lv{constructor(i,l,p,g,v){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=p,i._y=g,this.properties=i.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(i[l]=this[l]);return i}}class Pv{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Au(gr,16,0),this.grid3D=new Au(gr,16,0),this.featureIndexArray=new N,this.promoteId=l}insert(i,l,p,g,v,x){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,g,v);const E=x?this.grid3D:this.grid;for(let L=0;L<l.length;L++){const D=l[L],R=[1/0,1/0,-1/0,-1/0];for(let F=0;F<D.length;F++){const V=D[F];R[0]=Math.min(R[0],V.x),R[1]=Math.min(R[1],V.y),R[2]=Math.max(R[2],V.x),R[3]=Math.max(R[3],V.y)}R[0]<gr&&R[1]<gr&&R[2]>=0&&R[3]>=0&&E.insert(w,R[0],R[1],R[2],R[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ql.VectorTile(new Kg(this.rawTileData)).layers,this.sourceLayerCoder=new Tv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,p,g){this.loadVTLayers();const v=i.params||{},x=gr/i.tileSize/i.scale,w=Oc(v.filter),E=i.queryGeometry,L=i.queryPadding*x,D=Mv(E),R=this.grid.query(D.minX-L,D.minY-L,D.maxX+L,D.maxY+L),F=Mv(i.cameraQueryGeometry),V=this.grid3D.query(F.minX-L,F.minY-L,F.maxX+L,F.maxY+L,(tt,ot,vt,at)=>function(dt,kt,Ot,ie,fe){for(const ee of dt)if(kt<=ee.x&&Ot<=ee.y&&ie>=ee.x&&fe>=ee.y)return!0;const re=[new P(kt,Ot),new P(kt,fe),new P(ie,fe),new P(ie,Ot)];if(dt.length>2){for(const ee of re)if(nh(dt,ee))return!0}for(let ee=0;ee<dt.length-1;ee++)if(Q2(dt[ee],dt[ee+1],re))return!0;return!1}(i.cameraQueryGeometry,tt-L,ot-L,vt+L,at+L));for(const tt of V)R.push(tt);R.sort(bI);const G={};let H;for(let tt=0;tt<R.length;tt++){const ot=R[tt];if(ot===H)continue;H=ot;const vt=this.featureIndexArray.get(ot);let at=null;this.loadMatchingFeature(G,vt.bucketIndex,vt.sourceLayerIndex,vt.featureIndex,w,v.layers,v.availableImages,l,p,g,(dt,kt,Ot)=>(at||(at=nl(dt)),kt.queryIntersectsFeature(E,dt,Ot,at,this.z,i.transform,x,i.pixelPosMatrix)))}return G}loadMatchingFeature(i,l,p,g,v,x,w,E,L,D,R){const F=this.bucketLayerIDs[l];if(x&&!function(tt,ot){for(let vt=0;vt<tt.length;vt++)if(ot.indexOf(tt[vt])>=0)return!0;return!1}(x,F))return;const V=this.sourceLayerCoder.decode(p),G=this.vtLayers[V].feature(g);if(v.needGeometry){const tt=rl(G,!0);if(!v.filter(new Hn(this.tileID.overscaledZ),tt,this.tileID.canonical))return}else if(!v.filter(new Hn(this.tileID.overscaledZ),G))return;const H=this.getId(G,V);for(let tt=0;tt<F.length;tt++){const ot=F[tt];if(x&&x.indexOf(ot)<0)continue;const vt=E[ot];if(!vt)continue;let at={};H&&D&&(at=D.getState(vt.sourceLayer||"_geojsonTileLayer",H));const dt=At({},L[ot]);dt.paint=Av(dt.paint,vt.paint,G,at,w),dt.layout=Av(dt.layout,vt.layout,G,at,w);const kt=!R||R(G,vt,at);if(!kt)continue;const Ot=new Lv(G,this.z,this.x,this.y,H);Ot.layer=dt;let ie=i[ot];ie===void 0&&(ie=i[ot]=[]),ie.push({featureIndex:g,feature:Ot,intersectionZ:kt})}}lookupSymbolFeatures(i,l,p,g,v,x,w,E){const L={};this.loadVTLayers();const D=Oc(v);for(const R of i)this.loadMatchingFeature(L,p,g,R,D,x,w,E,l);return L}hasLayer(i){for(const l of this.bucketLayerIDs)for(const p of l)if(i===p)return!0;return!1}getId(i,l){let p=i.id;return this.promoteId&&(p=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof p=="boolean"&&(p=Number(p))),p}}function Av(s,i,l,p,g){return Vt(s,(v,x)=>{const w=i instanceof Du?i.get(x):null;return w&&w.evaluate?w.evaluate(l,p,g):w})}function Mv(s){let i=1/0,l=1/0,p=-1/0,g=-1/0;for(const v of s)i=Math.min(i,v.x),l=Math.min(l,v.y),p=Math.max(p,v.x),g=Math.max(g,v.y);return{minX:i,minY:l,maxX:p,maxY:g}}function bI(s,i){return i-s}function Dv(s,i,l,p,g){const v=[];for(let x=0;x<s.length;x++){const w=s[x];let E;for(let L=0;L<w.length-1;L++){let D=w[L],R=w[L+1];D.x<i&&R.x<i||(D.x<i?D=new P(i,D.y+(i-D.x)/(R.x-D.x)*(R.y-D.y))._round():R.x<i&&(R=new P(i,D.y+(i-D.x)/(R.x-D.x)*(R.y-D.y))._round()),D.y<l&&R.y<l||(D.y<l?D=new P(D.x+(l-D.y)/(R.y-D.y)*(R.x-D.x),l)._round():R.y<l&&(R=new P(D.x+(l-D.y)/(R.y-D.y)*(R.x-D.x),l)._round()),D.x>=p&&R.x>=p||(D.x>=p?D=new P(p,D.y+(p-D.x)/(R.x-D.x)*(R.y-D.y))._round():R.x>=p&&(R=new P(p,D.y+(p-D.x)/(R.x-D.x)*(R.y-D.y))._round()),D.y>=g&&R.y>=g||(D.y>=g?D=new P(D.x+(g-D.y)/(R.y-D.y)*(R.x-D.x),g)._round():R.y>=g&&(R=new P(D.x+(g-D.y)/(R.y-D.y)*(R.x-D.x),g)._round()),E&&D.equals(E[E.length-1])||(E=[D],v.push(E)),E.push(R)))))}}return v}ae("FeatureIndex",Pv,{omit:["rawTileData","sourceLayerCoder"]});class Hl extends P{constructor(i,l,p,g){super(i,l),this.angle=p,g!==void 0&&(this.segment=g)}clone(){return new Hl(this.x,this.y,this.angle,this.segment)}}function kv(s,i,l,p,g){if(i.segment===void 0||l===0)return!0;let v=i,x=i.segment+1,w=0;for(;w>-l/2;){if(x--,x<0)return!1;w-=s[x].dist(v),v=s[x]}w+=s[x].dist(s[x+1]),x++;const E=[];let L=0;for(;w<l/2;){const D=s[x],R=s[x+1];if(!R)return!1;let F=s[x-1].angleTo(D)-D.angleTo(R);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:F}),L+=F;w-E[0].distance>p;)L-=E.shift().angleDelta;if(L>g)return!1;x++,w+=D.dist(R)}return!0}function Rv(s){let i=0;for(let l=0;l<s.length-1;l++)i+=s[l].dist(s[l+1]);return i}function Nv(s,i,l){return s?.6*i*l:0}function Ov(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function wI(s,i,l,p,g,v){const x=Nv(l,g,v),w=Ov(l,p)*v;let E=0;const L=Rv(s)/2;for(let D=0;D<s.length-1;D++){const R=s[D],F=s[D+1],V=R.dist(F);if(E+V>L){const G=(L-E)/V,H=Ai.number(R.x,F.x,G),tt=Ai.number(R.y,F.y,G),ot=new Hl(H,tt,F.angleTo(R),D);return ot._round(),!x||kv(s,ot,w,x,i)?ot:void 0}E+=V}}function SI(s,i,l,p,g,v,x,w,E){const L=Nv(p,v,x),D=Ov(p,g),R=D*x,F=s[0].x===0||s[0].x===E||s[0].y===0||s[0].y===E;return i-R<i/4&&(i=R+i/4),zv(s,F?i/2*w%i:(D/2+2*v)*x*w%i,i,L,l,R,F,!1,E)}function zv(s,i,l,p,g,v,x,w,E){const L=v/2,D=Rv(s);let R=0,F=i-l,V=[];for(let G=0;G<s.length-1;G++){const H=s[G],tt=s[G+1],ot=H.dist(tt),vt=tt.angleTo(H);for(;F+l<R+ot;){F+=l;const at=(F-R)/ot,dt=Ai.number(H.x,tt.x,at),kt=Ai.number(H.y,tt.y,at);if(dt>=0&&dt<E&&kt>=0&&kt<E&&F-L>=0&&F+L<=D){const Ot=new Hl(dt,kt,vt,G);Ot._round(),p&&!kv(s,Ot,v,p,g)||V.push(Ot)}}R+=ot}return w||V.length||x||(V=zv(s,R/2,l,p,g,v,x,!0,E)),V}ae("Anchor",Hl);const ch=ho;function Fv(s,i,l,p){const g=[],v=s.image,x=v.pixelRatio,w=v.paddedRect.w-2*ch,E=v.paddedRect.h-2*ch,L=s.right-s.left,D=s.bottom-s.top,R=v.stretchX||[[0,w]],F=v.stretchY||[[0,E]],V=(Ht,ce)=>Ht+ce[1]-ce[0],G=R.reduce(V,0),H=F.reduce(V,0),tt=w-G,ot=E-H;let vt=0,at=G,dt=0,kt=H,Ot=0,ie=tt,fe=0,re=ot;if(v.content&&p){const Ht=v.content;vt=Jd(R,0,Ht[0]),dt=Jd(F,0,Ht[1]),at=Jd(R,Ht[0],Ht[2]),kt=Jd(F,Ht[1],Ht[3]),Ot=Ht[0]-vt,fe=Ht[1]-dt,ie=Ht[2]-Ht[0]-at,re=Ht[3]-Ht[1]-kt}const ee=(Ht,ce,Jt,Gt)=>{const ve=Qd(Ht.stretch-vt,at,L,s.left),de=$d(Ht.fixed-Ot,ie,Ht.stretch,G),Ye=Qd(ce.stretch-dt,kt,D,s.top),Gn=$d(ce.fixed-fe,re,ce.stretch,H),Yn=Qd(Jt.stretch-vt,at,L,s.left),Gr=$d(Jt.fixed-Ot,ie,Jt.stretch,G),ko=Qd(Gt.stretch-dt,kt,D,s.top),Xi=$d(Gt.fixed-fe,re,Gt.stretch,H),Nr=new P(ve,Ye),ai=new P(Yn,Ye),gi=new P(Yn,ko),Yi=new P(ve,ko),Ki=new P(de/x,Gn/x),qr=new P(Gr/x,Xi/x),jr=i*Math.PI/180;if(jr){const ki=Math.sin(jr),po=Math.cos(jr),fo=[po,-ki,ki,po];Nr._matMult(fo),ai._matMult(fo),Yi._matMult(fo),gi._matMult(fo)}const Di=Ht.stretch+Ht.fixed,Ji=ce.stretch+ce.fixed;return{tl:Nr,tr:ai,bl:Yi,br:gi,tex:{x:v.paddedRect.x+ch+Di,y:v.paddedRect.y+ch+Ji,w:Jt.stretch+Jt.fixed-Di,h:Gt.stretch+Gt.fixed-Ji},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ki,pixelOffsetBR:qr,minFontScaleX:ie/x/L,minFontScaleY:re/x/D,isSDF:l}};if(p&&(v.stretchX||v.stretchY)){const Ht=Bv(R,tt,G),ce=Bv(F,ot,H);for(let Jt=0;Jt<Ht.length-1;Jt++){const Gt=Ht[Jt],ve=Ht[Jt+1];for(let de=0;de<ce.length-1;de++)g.push(ee(Gt,ce[de],ve,ce[de+1]))}}else g.push(ee({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return g}function Jd(s,i,l){let p=0;for(const g of s)p+=Math.max(i,Math.min(l,g[1]))-Math.max(i,Math.min(l,g[0]));return p}function Bv(s,i,l){const p=[{fixed:-ch,stretch:0}];for(const[g,v]of s){const x=p[p.length-1];p.push({fixed:g-x.stretch,stretch:x.stretch}),p.push({fixed:g-x.stretch,stretch:x.stretch+(v-g)})}return p.push({fixed:i+ch,stretch:l}),p}function Qd(s,i,l,p){return s/i*l+p}function $d(s,i,l,p){return s-i*l/p}class tm{constructor(i,l,p,g,v,x,w,E,L,D){if(this.boxStartIndex=i.length,L){let R=x.top,F=x.bottom;const V=x.collisionPadding;V&&(R-=V[1],F+=V[3]);let G=F-R;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{let R=x.top*w-E[0],F=x.bottom*w+E[2],V=x.left*w-E[3],G=x.right*w+E[1];const H=x.collisionPadding;if(H&&(V-=H[0]*w,R-=H[1]*w,G+=H[2]*w,F+=H[3]*w),D){const tt=new P(V,R),ot=new P(G,R),vt=new P(V,F),at=new P(G,F),dt=D*Math.PI/180;tt._rotate(dt),ot._rotate(dt),vt._rotate(dt),at._rotate(dt),V=Math.min(tt.x,ot.x,vt.x,at.x),G=Math.max(tt.x,ot.x,vt.x,at.x),R=Math.min(tt.y,ot.y,vt.y,at.y),F=Math.max(tt.y,ot.y,vt.y,at.y)}i.emplaceBack(l.x,l.y,V,R,G,F,p,g,v)}this.boxEndIndex=i.length}}class II{constructor(i=[],l=EI){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:p}=this,g=l[i];for(;i>0;){const v=i-1>>1,x=l[v];if(p(g,x)>=0)break;l[i]=x,i=v}l[i]=g}_down(i){const{data:l,compare:p}=this,g=this.length>>1,v=l[i];for(;i<g;){let x=1+(i<<1),w=l[x];const E=x+1;if(E<this.length&&p(l[E],w)<0&&(x=E,w=l[E]),p(w,v)>=0)break;l[i]=w,i=x}l[i]=v}}function EI(s,i){return s<i?-1:s>i?1:0}function CI(s,i=1,l=!1){let p=1/0,g=1/0,v=-1/0,x=-1/0;const w=s[0];for(let V=0;V<w.length;V++){const G=w[V];(!V||G.x<p)&&(p=G.x),(!V||G.y<g)&&(g=G.y),(!V||G.x>v)&&(v=G.x),(!V||G.y>x)&&(x=G.y)}const E=Math.min(v-p,x-g);let L=E/2;const D=new II([],TI);if(E===0)return new P(p,g);for(let V=p;V<v;V+=E)for(let G=g;G<x;G+=E)D.push(new hh(V+L,G+L,L,s));let R=function(V){let G=0,H=0,tt=0;const ot=V[0];for(let vt=0,at=ot.length,dt=at-1;vt<at;dt=vt++){const kt=ot[vt],Ot=ot[dt],ie=kt.x*Ot.y-Ot.x*kt.y;H+=(kt.x+Ot.x)*ie,tt+=(kt.y+Ot.y)*ie,G+=3*ie}return new hh(H/G,tt/G,0,V)}(s),F=D.length;for(;D.length;){const V=D.pop();(V.d>R.d||!R.d)&&(R=V,l&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-R.d<=i||(L=V.h/2,D.push(new hh(V.p.x-L,V.p.y-L,L,s)),D.push(new hh(V.p.x+L,V.p.y-L,L,s)),D.push(new hh(V.p.x-L,V.p.y+L,L,s)),D.push(new hh(V.p.x+L,V.p.y+L,L,s)),F+=4)}return l&&(console.log(`num probes: ${F}`),console.log(`best distance: ${R.d}`)),R.p}function TI(s,i){return i.max-s.max}function hh(s,i,l,p){this.p=new P(s,i),this.h=l,this.d=function(g,v){let x=!1,w=1/0;for(let E=0;E<v.length;E++){const L=v[E];for(let D=0,R=L.length,F=R-1;D<R;F=D++){const V=L[D],G=L[F];V.y>g.y!=G.y>g.y&&g.x<(G.x-V.x)*(g.y-V.y)/(G.y-V.y)+V.x&&(x=!x),w=Math.min(w,w0(g,V,G))}}return(x?1:-1)*Math.sqrt(w)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}var mi;f.ap=void 0,(mi=f.ap||(f.ap={}))[mi.center=1]="center",mi[mi.left=2]="left",mi[mi.right=3]="right",mi[mi.top=4]="top",mi[mi.bottom=5]="bottom",mi[mi["top-left"]=6]="top-left",mi[mi["top-right"]=7]="top-right",mi[mi["bottom-left"]=8]="bottom-left",mi[mi["bottom-right"]=9]="bottom-right";const Xl=7,uy=Number.POSITIVE_INFINITY;function Vv(s,i){return i[1]!==uy?function(l,p,g){let v=0,x=0;switch(p=Math.abs(p),g=Math.abs(g),l){case"top-right":case"top-left":case"top":x=g-Xl;break;case"bottom-right":case"bottom-left":case"bottom":x=-g+Xl}switch(l){case"top-right":case"bottom-right":case"right":v=-p;break;case"top-left":case"bottom-left":case"left":v=p}return[v,x]}(s,i[0],i[1]):function(l,p){let g=0,v=0;p<0&&(p=0);const x=p/Math.SQRT2;switch(l){case"top-right":case"top-left":v=x-Xl;break;case"bottom-right":case"bottom-left":v=-x+Xl;break;case"bottom":v=-p+Xl;break;case"top":v=p-Xl}switch(l){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=p;break;case"right":g=-p}return[g,v]}(s,i[0])}function Uv(s,i,l){var p;const g=s.layout,v=(p=g.get("text-variable-anchor-offset"))===null||p===void 0?void 0:p.evaluate(i,{},l);if(v){const w=v.values,E=[];for(let L=0;L<w.length;L+=2){const D=E[L]=w[L],R=w[L+1].map(F=>F*Ur);D.startsWith("top")?R[1]-=Xl:D.startsWith("bottom")&&(R[1]+=Xl),E[L+1]=R}return new Po(E)}const x=g.get("text-variable-anchor");if(x){let w;w=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},l)*Ur,uy]:g.get("text-offset").evaluate(i,{},l).map(L=>L*Ur);const E=[];for(const L of x)E.push(L,Vv(L,w));return new Po(E)}return null}function cy(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function LI(s,i,l,p,g,v,x,w,E,L,D){let R=v.textMaxSize.evaluate(i,{});R===void 0&&(R=x);const F=s.layers[0].layout,V=F.get("icon-offset").evaluate(i,{},D),G=qv(l.horizontal),H=x/24,tt=s.tilePixelRatio*H,ot=s.tilePixelRatio*R/24,vt=s.tilePixelRatio*w,at=s.tilePixelRatio*F.get("symbol-spacing"),dt=F.get("text-padding")*s.tilePixelRatio,kt=function(Gt,ve,de,Ye=1){const Gn=Gt.get("icon-padding").evaluate(ve,{},de),Yn=Gn&&Gn.values;return[Yn[0]*Ye,Yn[1]*Ye,Yn[2]*Ye,Yn[3]*Ye]}(F,i,D,s.tilePixelRatio),Ot=F.get("text-max-angle")/180*Math.PI,ie=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",fe=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",re=F.get("symbol-placement"),ee=at/2,Ht=F.get("icon-text-fit");let ce;p&&Ht!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(ce=pv(p,l.vertical,Ht,F.get("icon-text-fit-padding"),V,H)),G&&(p=pv(p,G,Ht,F.get("icon-text-fit-padding"),V,H)));const Jt=(Gt,ve)=>{ve.x<0||ve.x>=gr||ve.y<0||ve.y>=gr||function(de,Ye,Gn,Yn,Gr,ko,Xi,Nr,ai,gi,Yi,Ki,qr,jr,Di,Ji,ki,po,fo,Wr,nn,Ri,yi,Zr,xs){const Zs=de.addToLineVertexArray(Ye,Gn);let Hs,ol,bs,Ko,mo=0,sl=0,tf=0,Hv=0,_y=-1,vy=-1;const al={};let Xv=ur("");if(de.allowVerticalPlacement&&Yn.vertical){const Ni=Nr.layout.get("text-rotate").evaluate(nn,{},Zr)+90;bs=new tm(ai,Ye,gi,Yi,Ki,Yn.vertical,qr,jr,Di,Ni),Xi&&(Ko=new tm(ai,Ye,gi,Yi,Ki,Xi,ki,po,Di,Ni))}if(Gr){const Ni=Nr.layout.get("icon-rotate").evaluate(nn,{}),Jo=Nr.layout.get("icon-text-fit")!=="none",Uu=Fv(Gr,Ni,yi,Jo),Ys=Xi?Fv(Xi,Ni,yi,Jo):void 0;ol=new tm(ai,Ye,gi,Yi,Ki,Gr,ki,po,!1,Ni),mo=4*Uu.length;const Gu=de.iconSizeData;let La=null;Gu.kind==="source"?(La=[Ta*Nr.layout.get("icon-size").evaluate(nn,{})],La[0]>Wl&&te(`${de.layerIds[0]}: Value for "icon-size" is >= ${Kp}. Reduce your "icon-size".`)):Gu.kind==="composite"&&(La=[Ta*Ri.compositeIconSizes[0].evaluate(nn,{},Zr),Ta*Ri.compositeIconSizes[1].evaluate(nn,{},Zr)],(La[0]>Wl||La[1]>Wl)&&te(`${de.layerIds[0]}: Value for "icon-size" is >= ${Kp}. Reduce your "icon-size".`)),de.addSymbols(de.icon,Uu,La,Wr,fo,nn,f.ah.none,Ye,Zs.lineStartIndex,Zs.lineLength,-1,Zr),_y=de.icon.placedSymbolArray.length-1,Ys&&(sl=4*Ys.length,de.addSymbols(de.icon,Ys,La,Wr,fo,nn,f.ah.vertical,Ye,Zs.lineStartIndex,Zs.lineLength,-1,Zr),vy=de.icon.placedSymbolArray.length-1)}const Yv=Object.keys(Yn.horizontal);for(const Ni of Yv){const Jo=Yn.horizontal[Ni];if(!Hs){Xv=ur(Jo.text);const Ys=Nr.layout.get("text-rotate").evaluate(nn,{},Zr);Hs=new tm(ai,Ye,gi,Yi,Ki,Jo,qr,jr,Di,Ys)}const Uu=Jo.positionedLines.length===1;if(tf+=Gv(de,Ye,Jo,ko,Nr,Di,nn,Ji,Zs,Yn.vertical?f.ah.horizontal:f.ah.horizontalOnly,Uu?Yv:[Ni],al,_y,Ri,Zr),Uu)break}Yn.vertical&&(Hv+=Gv(de,Ye,Yn.vertical,ko,Nr,Di,nn,Ji,Zs,f.ah.vertical,["vertical"],al,vy,Ri,Zr));const MI=Hs?Hs.boxStartIndex:de.collisionBoxArray.length,DI=Hs?Hs.boxEndIndex:de.collisionBoxArray.length,kI=bs?bs.boxStartIndex:de.collisionBoxArray.length,RI=bs?bs.boxEndIndex:de.collisionBoxArray.length,NI=ol?ol.boxStartIndex:de.collisionBoxArray.length,OI=ol?ol.boxEndIndex:de.collisionBoxArray.length,zI=Ko?Ko.boxStartIndex:de.collisionBoxArray.length,FI=Ko?Ko.boxEndIndex:de.collisionBoxArray.length;let Xs=-1;const nm=(Ni,Jo)=>Ni&&Ni.circleDiameter?Math.max(Ni.circleDiameter,Jo):Jo;Xs=nm(Hs,Xs),Xs=nm(bs,Xs),Xs=nm(ol,Xs),Xs=nm(Ko,Xs);const Kv=Xs>-1?1:0;Kv&&(Xs*=xs/Ur),de.glyphOffsetArray.length>=uh.MAX_GLYPHS&&te("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),nn.sortKey!==void 0&&de.addToSortKeyRanges(de.symbolInstances.length,nn.sortKey);const BI=Uv(Nr,nn,Zr),[VI,UI]=function(Ni,Jo){const Uu=Ni.length,Ys=Jo==null?void 0:Jo.values;if((Ys==null?void 0:Ys.length)>0)for(let Gu=0;Gu<Ys.length;Gu+=2){const La=Ys[Gu+1];Ni.emplaceBack(f.ap[Ys[Gu]],La[0],La[1])}return[Uu,Ni.length]}(de.textAnchorOffsets,BI);de.symbolInstances.emplaceBack(Ye.x,Ye.y,al.right>=0?al.right:-1,al.center>=0?al.center:-1,al.left>=0?al.left:-1,al.vertical||-1,_y,vy,Xv,MI,DI,kI,RI,NI,OI,zI,FI,gi,tf,Hv,mo,sl,Kv,0,qr,Xs,VI,UI)}(s,ve,Gt,l,p,g,ce,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,tt,[dt,dt,dt,dt],ie,E,vt,kt,fe,V,i,v,L,D,x)};if(re==="line")for(const Gt of Dv(i.geometry,0,0,gr,gr)){const ve=SI(Gt,at,Ot,l.vertical||G,p,24,ot,s.overscaling,gr);for(const de of ve)G&&PI(s,G.text,ee,de)||Jt(Gt,de)}else if(re==="line-center"){for(const Gt of i.geometry)if(Gt.length>1){const ve=wI(Gt,Ot,l.vertical||G,p,24,ot);ve&&Jt(Gt,ve)}}else if(i.type==="Polygon")for(const Gt of Gg(i.geometry,0)){const ve=CI(Gt,16);Jt(Gt[0],new Hl(ve.x,ve.y,0))}else if(i.type==="LineString")for(const Gt of i.geometry)Jt(Gt,new Hl(Gt[0].x,Gt[0].y,0));else if(i.type==="Point")for(const Gt of i.geometry)for(const ve of Gt)Jt([ve],new Hl(ve.x,ve.y,0))}function Gv(s,i,l,p,g,v,x,w,E,L,D,R,F,V,G){const H=function(vt,at,dt,kt,Ot,ie,fe,re){const ee=kt.layout.get("text-rotate").evaluate(ie,{})*Math.PI/180,Ht=[];for(const ce of at.positionedLines)for(const Jt of ce.positionedGlyphs){if(!Jt.rect)continue;const Gt=Jt.rect||{};let ve=ov+1,de=!0,Ye=1,Gn=0;const Yn=(Ot||re)&&Jt.vertical,Gr=Jt.metrics.advance*Jt.scale/2;if(re&&at.verticalizable&&(Gn=ce.lineOffset/2-(Jt.imageName?-(Ur-Jt.metrics.width*Jt.scale)/2:(Jt.scale-1)*Ur)),Jt.imageName){const Wr=fe[Jt.imageName];de=Wr.sdf,Ye=Wr.pixelRatio,ve=ho/Ye}const ko=Ot?[Jt.x+Gr,Jt.y]:[0,0];let Xi=Ot?[0,0]:[Jt.x+Gr+dt[0],Jt.y+dt[1]-Gn],Nr=[0,0];Yn&&(Nr=Xi,Xi=[0,0]);const ai=Jt.metrics.isDoubleResolution?2:1,gi=(Jt.metrics.left-ve)*Jt.scale-Gr+Xi[0],Yi=(-Jt.metrics.top-ve)*Jt.scale+Xi[1],Ki=gi+Gt.w/ai*Jt.scale/Ye,qr=Yi+Gt.h/ai*Jt.scale/Ye,jr=new P(gi,Yi),Di=new P(Ki,Yi),Ji=new P(gi,qr),ki=new P(Ki,qr);if(Yn){const Wr=new P(-Gr,Gr-Xp),nn=-Math.PI/2,Ri=Ur/2-Gr,yi=new P(5-Xp-Ri,-(Jt.imageName?Ri:0)),Zr=new P(...Nr);jr._rotateAround(nn,Wr)._add(yi)._add(Zr),Di._rotateAround(nn,Wr)._add(yi)._add(Zr),Ji._rotateAround(nn,Wr)._add(yi)._add(Zr),ki._rotateAround(nn,Wr)._add(yi)._add(Zr)}if(ee){const Wr=Math.sin(ee),nn=Math.cos(ee),Ri=[nn,-Wr,Wr,nn];jr._matMult(Ri),Di._matMult(Ri),Ji._matMult(Ri),ki._matMult(Ri)}const po=new P(0,0),fo=new P(0,0);Ht.push({tl:jr,tr:Di,bl:Ji,br:ki,tex:Gt,writingMode:at.writingMode,glyphOffset:ko,sectionIndex:Jt.sectionIndex,isSDF:de,pixelOffsetTL:po,pixelOffsetBR:fo,minFontScaleX:0,minFontScaleY:0})}return Ht}(0,l,w,g,v,x,p,s.allowVerticalPlacement),tt=s.textSizeData;let ot=null;tt.kind==="source"?(ot=[Ta*g.layout.get("text-size").evaluate(x,{})],ot[0]>Wl&&te(`${s.layerIds[0]}: Value for "text-size" is >= ${Kp}. Reduce your "text-size".`)):tt.kind==="composite"&&(ot=[Ta*V.compositeTextSizes[0].evaluate(x,{},G),Ta*V.compositeTextSizes[1].evaluate(x,{},G)],(ot[0]>Wl||ot[1]>Wl)&&te(`${s.layerIds[0]}: Value for "text-size" is >= ${Kp}. Reduce your "text-size".`)),s.addSymbols(s.text,H,ot,w,v,x,L,i,E.lineStartIndex,E.lineLength,F,G);for(const vt of D)R[vt]=s.text.placedSymbolArray.length-1;return 4*H.length}function qv(s){for(const i in s)return s[i];return null}function PI(s,i,l,p){const g=s.compareText;if(i in g){const v=g[i];for(let x=v.length-1;x>=0;x--)if(p.dist(v[x])<l)return!0}else g[i]=[];return g[i].push(p),!1}const jv=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hy{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,p]=new Uint8Array(i,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=p>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const v=jv[15&p];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(i,2,1),[w]=new Uint32Array(i,4,1);return new hy(w,x,v,i)}constructor(i,l=64,p=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=p,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const v=jv.indexOf(this.ArrayType),x=2*i*this.ArrayType.BYTES_PER_ELEMENT,w=i*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${p}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+E,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+x+w+E),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+E,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=i,this.coords[this._pos++]=l,p}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return py(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,p,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:w}=this,E=[0,v.length-1,0],L=[];for(;E.length;){const D=E.pop()||0,R=E.pop()||0,F=E.pop()||0;if(R-F<=w){for(let tt=F;tt<=R;tt++){const ot=x[2*tt],vt=x[2*tt+1];ot>=i&&ot<=p&&vt>=l&&vt<=g&&L.push(v[tt])}continue}const V=F+R>>1,G=x[2*V],H=x[2*V+1];G>=i&&G<=p&&H>=l&&H<=g&&L.push(v[V]),(D===0?i<=G:l<=H)&&(E.push(F),E.push(V-1),E.push(1-D)),(D===0?p>=G:g>=H)&&(E.push(V+1),E.push(R),E.push(1-D))}return L}within(i,l,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:x}=this,w=[0,g.length-1,0],E=[],L=p*p;for(;w.length;){const D=w.pop()||0,R=w.pop()||0,F=w.pop()||0;if(R-F<=x){for(let tt=F;tt<=R;tt++)Zv(v[2*tt],v[2*tt+1],i,l)<=L&&E.push(g[tt]);continue}const V=F+R>>1,G=v[2*V],H=v[2*V+1];Zv(G,H,i,l)<=L&&E.push(g[V]),(D===0?i-p<=G:l-p<=H)&&(w.push(F),w.push(V-1),w.push(1-D)),(D===0?i+p>=G:l+p>=H)&&(w.push(V+1),w.push(R),w.push(1-D))}return E}}function py(s,i,l,p,g,v){if(g-p<=l)return;const x=p+g>>1;Wv(s,i,x,p,g,v),py(s,i,l,p,x-1,1-v),py(s,i,l,x+1,g,1-v)}function Wv(s,i,l,p,g,v){for(;g>p;){if(g-p>600){const L=g-p+1,D=l-p+1,R=Math.log(L),F=.5*Math.exp(2*R/3),V=.5*Math.sqrt(R*F*(L-F)/L)*(D-L/2<0?-1:1);Wv(s,i,l,Math.max(p,Math.floor(l-D*F/L+V)),Math.min(g,Math.floor(l+(L-D)*F/L+V)),v)}const x=i[2*l+v];let w=p,E=g;for(Qp(s,i,p,l),i[2*g+v]>x&&Qp(s,i,p,g);w<E;){for(Qp(s,i,w,E),w++,E--;i[2*w+v]<x;)w++;for(;i[2*E+v]>x;)E--}i[2*p+v]===x?Qp(s,i,p,E):(E++,Qp(s,i,E,g)),E<=l&&(p=E+1),l<=E&&(g=E-1)}}function Qp(s,i,l,p){fy(s,l,p),fy(i,2*l,2*p),fy(i,2*l+1,2*p+1)}function fy(s,i,l){const p=s[i];s[i]=s[l],s[l]=p}function Zv(s,i,l,p){const g=s-l,v=i-p;return g*g+v*v}var dy;f.bd=void 0,(dy=f.bd||(f.bd={})).create="create",dy.load="load",dy.fullLoad="fullLoad";let em=null,$p=[];const my=1e3/60,gy="loadTime",yy="fullLoadTime",AI={mark(s){performance.mark(s)},frame(s){const i=s;em!=null&&$p.push(i-em),em=i},clearMetrics(){em=null,$p=[],performance.clearMeasures(gy),performance.clearMeasures(yy);for(const s in f.bd)performance.clearMarks(f.bd[s])},getPerformanceMetrics(){performance.measure(gy,f.bd.create,f.bd.load),performance.measure(yy,f.bd.create,f.bd.fullLoad);const s=performance.getEntriesByName(gy)[0].duration,i=performance.getEntriesByName(yy)[0].duration,l=$p.length,p=1/($p.reduce((v,x)=>v+x,0)/l/1e3),g=$p.filter(v=>v>my).reduce((v,x)=>v+(x-my)/my,0);return{loadTime:s,fullLoadTime:i,fps:p,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};f.$=Xt,f.A=rh,f.B=function(s){if(ue==null){const i=s.navigator?s.navigator.userAgent:null;ue=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return ue},f.C=class{constructor(s,i){this.target=s,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new xI(()=>this.process()),this.subscription=function(l,p,g,v){return l.addEventListener(p,g,!1),{unsubscribe:()=>{l.removeEventListener(p,g,!1)}}}(this.target,"message",l=>this.receive(l)),this.globalScope=De(self)?s:window}registerMessageHandler(s,i){this.messageHandlers[s]=i}sendAsync(s,i){return new Promise((l,p)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:l,reject:p},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const w={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},{once:!0});const v=[],x=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Bl(s.data,v)});this.target.postMessage(x,{transfer:v})})}receive(s){const i=s.data,l=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[l];const p=this.abortControllers[l];return delete this.abortControllers[l],void(p&&p.abort())}if(De(self)||i.mustQueue)return this.tasks[l]=i,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,i)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),i=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(s,i)}processTask(s,i){return u(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(i.error?g.reject(Vl(i.error)):g.resolve(Vl(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=Vl(i.data),p=new AbortController;this.abortControllers[s]=p;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,l,p);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,i,l){const p=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Bl(i):null,data:Bl(l,p)};this.target.postMessage(g,{transfer:p})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.D=me,f.E=cn,f.F=function(){var s=new rh(16);return rh!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},f.G=vn,f.H=function(s,i,l){var p,g,v,x,w,E,L,D,R,F,V,G,H=l[0],tt=l[1],ot=l[2];return i===s?(s[12]=i[0]*H+i[4]*tt+i[8]*ot+i[12],s[13]=i[1]*H+i[5]*tt+i[9]*ot+i[13],s[14]=i[2]*H+i[6]*tt+i[10]*ot+i[14],s[15]=i[3]*H+i[7]*tt+i[11]*ot+i[15]):(g=i[1],v=i[2],x=i[3],w=i[4],E=i[5],L=i[6],D=i[7],R=i[8],F=i[9],V=i[10],G=i[11],s[0]=p=i[0],s[1]=g,s[2]=v,s[3]=x,s[4]=w,s[5]=E,s[6]=L,s[7]=D,s[8]=R,s[9]=F,s[10]=V,s[11]=G,s[12]=p*H+w*tt+R*ot+i[12],s[13]=g*H+E*tt+F*ot+i[13],s[14]=v*H+L*tt+V*ot+i[14],s[15]=x*H+D*tt+G*ot+i[15]),s},f.I=Qg,f.J=function(s,i,l){var p=l[0],g=l[1],v=l[2];return s[0]=i[0]*p,s[1]=i[1]*p,s[2]=i[2]*p,s[3]=i[3]*p,s[4]=i[4]*g,s[5]=i[5]*g,s[6]=i[6]*g,s[7]=i[7]*g,s[8]=i[8]*v,s[9]=i[9]*v,s[10]=i[10]*v,s[11]=i[11]*v,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},f.K=C0,f.L=function(s,i){const l={};for(let p=0;p<i.length;p++){const g=i[p];g in s&&(l[g]=s[g])}return l},f.M=Zl,f.N=bv,f.O=wv,f.P=P,f.Q=Yo,f.R=Xo,f.S=_t,f.T=Sp,f.U=j,f.V=pe,f.W=gr,f.X=br,f.Y=Kd,f.Z=class extends Cp{},f._=u,f.a=Ze,f.a$=function(s,i,l){return s[0]=i[0]*l[0],s[1]=i[1]*l[1],s[2]=i[2]*l[2],s[3]=i[3]*l[3],s},f.a0=ly,f.a1=Wt,f.a2=s=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(l=>{i.onloadstart=()=>{l(i)};for(const p of s){const g=window.document.createElement("source");Fn(p)||(i.crossOrigin="Anonymous"),g.src=p,i.appendChild(g)}})},f.a3=function(){return Tt++},f.a4=y,f.a5=uh,f.a6=Oc,f.a7=rl,f.a8=Hn,f.a9=Lv,f.aA=J,f.aB=function(s,i){if(!s)return[{command:"setStyle",args:[i]}];let l=[];try{if(!Qe(s.version,i.version))return[{command:"setStyle",args:[i]}];Qe(s.center,i.center)||l.push({command:"setCenter",args:[i.center]}),Qe(s.zoom,i.zoom)||l.push({command:"setZoom",args:[i.zoom]}),Qe(s.bearing,i.bearing)||l.push({command:"setBearing",args:[i.bearing]}),Qe(s.pitch,i.pitch)||l.push({command:"setPitch",args:[i.pitch]}),Qe(s.sprite,i.sprite)||l.push({command:"setSprite",args:[i.sprite]}),Qe(s.glyphs,i.glyphs)||l.push({command:"setGlyphs",args:[i.glyphs]}),Qe(s.transition,i.transition)||l.push({command:"setTransition",args:[i.transition]}),Qe(s.light,i.light)||l.push({command:"setLight",args:[i.light]}),Qe(s.terrain,i.terrain)||l.push({command:"setTerrain",args:[i.terrain]}),Qe(s.sky,i.sky)||l.push({command:"setSky",args:[i.sky]});const p={},g=[];(function(x,w,E,L){let D;for(D in w=w||{},x=x||{})Object.prototype.hasOwnProperty.call(x,D)&&(Object.prototype.hasOwnProperty.call(w,D)||Tl(D,E,L));for(D in w)Object.prototype.hasOwnProperty.call(w,D)&&(Object.prototype.hasOwnProperty.call(x,D)?Qe(x[D],w[D])||(x[D].type==="geojson"&&w[D].type==="geojson"&&Pl(x,w,D)?Or(E,{command:"setGeoJSONSourceData",args:[D,w[D].data]}):Ll(D,w,E,L)):Cl(D,w,E))})(s.sources,i.sources,g,p);const v=[];s.layers&&s.layers.forEach(x=>{"source"in x&&p[x.source]?l.push({command:"removeLayer",args:[x.id]}):v.push(x)}),l=l.concat(g),function(x,w,E){w=w||[];const L=(x=x||[]).map(dc),D=w.map(dc),R=x.reduce(Za,{}),F=w.reduce(Za,{}),V=L.slice(),G=Object.create(null);let H,tt,ot,vt,at;for(let dt=0,kt=0;dt<L.length;dt++)H=L[dt],Object.prototype.hasOwnProperty.call(F,H)?kt++:(Or(E,{command:"removeLayer",args:[H]}),V.splice(V.indexOf(H,kt),1));for(let dt=0,kt=0;dt<D.length;dt++)H=D[D.length-1-dt],V[V.length-1-dt]!==H&&(Object.prototype.hasOwnProperty.call(R,H)?(Or(E,{command:"removeLayer",args:[H]}),V.splice(V.lastIndexOf(H,V.length-kt),1)):kt++,vt=V[V.length-dt],Or(E,{command:"addLayer",args:[F[H],vt]}),V.splice(V.length-dt,0,H),G[H]=!0);for(let dt=0;dt<D.length;dt++)if(H=D[dt],tt=R[H],ot=F[H],!G[H]&&!Qe(tt,ot))if(Qe(tt.source,ot.source)&&Qe(tt["source-layer"],ot["source-layer"])&&Qe(tt.type,ot.type)){for(at in ya(tt.layout,ot.layout,E,H,null,"setLayoutProperty"),ya(tt.paint,ot.paint,E,H,null,"setPaintProperty"),Qe(tt.filter,ot.filter)||Or(E,{command:"setFilter",args:[H,ot.filter]}),Qe(tt.minzoom,ot.minzoom)&&Qe(tt.maxzoom,ot.maxzoom)||Or(E,{command:"setLayerZoomRange",args:[H,ot.minzoom,ot.maxzoom]}),tt)Object.prototype.hasOwnProperty.call(tt,at)&&at!=="layout"&&at!=="paint"&&at!=="filter"&&at!=="metadata"&&at!=="minzoom"&&at!=="maxzoom"&&(at.indexOf("paint.")===0?ya(tt[at],ot[at],E,H,at.slice(6),"setPaintProperty"):Qe(tt[at],ot[at])||Or(E,{command:"setLayerProperty",args:[H,at,ot[at]]}));for(at in ot)Object.prototype.hasOwnProperty.call(ot,at)&&!Object.prototype.hasOwnProperty.call(tt,at)&&at!=="layout"&&at!=="paint"&&at!=="filter"&&at!=="metadata"&&at!=="minzoom"&&at!=="maxzoom"&&(at.indexOf("paint.")===0?ya(tt[at],ot[at],E,H,at.slice(6),"setPaintProperty"):Qe(tt[at],ot[at])||Or(E,{command:"setLayerProperty",args:[H,at,ot[at]]}))}else Or(E,{command:"removeLayer",args:[H]}),vt=V[V.lastIndexOf(H)+1],Or(E,{command:"addLayer",args:[ot,vt]})}(v,i.layers,l)}catch(p){console.warn("Unable to compute style diff:",p),l=[{command:"setStyle",args:[i]}]}return l},f.aC=function(s){const i=[],l=s.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},f.aD=function s(i,l){if(Array.isArray(i)){if(!Array.isArray(l)||i.length!==l.length)return!1;for(let p=0;p<i.length;p++)if(!s(i[p],l[p]))return!1;return!0}if(typeof i=="object"&&i!==null&&l!==null){if(typeof l!="object"||Object.keys(i).length!==Object.keys(l).length)return!1;for(const p in i)if(!s(i[p],l[p]))return!1;return!0}return i===l},f.aE=Vt,f.aF=Yt,f.aG=class extends Vr{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},f.aH=co,f.aI=class extends Vr{constructor(s,i){super(s,i),this.current=Bu}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},f.aJ=_s,f.aK=class extends Vr{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},f.aL=class extends Vr{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},f.aM=Ia,f.aN=function(s,i,l,p,g,v,x){var w=1/(i-l),E=1/(p-g),L=1/(v-x);return s[0]=-2*w,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*E,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*L,s[11]=0,s[12]=(i+l)*w,s[13]=(g+p)*E,s[14]=(x+v)*L,s[15]=1,s},f.aO=Tn,f.aP=tS,f.aQ=class extends Yc{},f.aR=XS,f.aS=class extends Kc{},f.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},f.aU=M0,f.aV=O,f.aW=class extends Dp{},f.aX=Dt,f.aY=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]&&s[4]===i[4]&&s[5]===i[5]&&s[6]===i[6]&&s[7]===i[7]&&s[8]===i[8]&&s[9]===i[9]&&s[10]===i[10]&&s[11]===i[11]&&s[12]===i[12]&&s[13]===i[13]&&s[14]===i[14]&&s[15]===i[15]},f.aZ=function(s,i){var l=s[0],p=s[1],g=s[2],v=s[3],x=s[4],w=s[5],E=s[6],L=s[7],D=s[8],R=s[9],F=s[10],V=s[11],G=s[12],H=s[13],tt=s[14],ot=s[15],vt=i[0],at=i[1],dt=i[2],kt=i[3],Ot=i[4],ie=i[5],fe=i[6],re=i[7],ee=i[8],Ht=i[9],ce=i[10],Jt=i[11],Gt=i[12],ve=i[13],de=i[14],Ye=i[15];return Math.abs(l-vt)<=Hi*Math.max(1,Math.abs(l),Math.abs(vt))&&Math.abs(p-at)<=Hi*Math.max(1,Math.abs(p),Math.abs(at))&&Math.abs(g-dt)<=Hi*Math.max(1,Math.abs(g),Math.abs(dt))&&Math.abs(v-kt)<=Hi*Math.max(1,Math.abs(v),Math.abs(kt))&&Math.abs(x-Ot)<=Hi*Math.max(1,Math.abs(x),Math.abs(Ot))&&Math.abs(w-ie)<=Hi*Math.max(1,Math.abs(w),Math.abs(ie))&&Math.abs(E-fe)<=Hi*Math.max(1,Math.abs(E),Math.abs(fe))&&Math.abs(L-re)<=Hi*Math.max(1,Math.abs(L),Math.abs(re))&&Math.abs(D-ee)<=Hi*Math.max(1,Math.abs(D),Math.abs(ee))&&Math.abs(R-Ht)<=Hi*Math.max(1,Math.abs(R),Math.abs(Ht))&&Math.abs(F-ce)<=Hi*Math.max(1,Math.abs(F),Math.abs(ce))&&Math.abs(V-Jt)<=Hi*Math.max(1,Math.abs(V),Math.abs(Jt))&&Math.abs(G-Gt)<=Hi*Math.max(1,Math.abs(G),Math.abs(Gt))&&Math.abs(H-ve)<=Hi*Math.max(1,Math.abs(H),Math.abs(ve))&&Math.abs(tt-de)<=Hi*Math.max(1,Math.abs(tt),Math.abs(de))&&Math.abs(ot-Ye)<=Hi*Math.max(1,Math.abs(ot),Math.abs(Ye))},f.a_=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},f.aa=function(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,p,g,v)=>{const x=g||v;return i[p]=!x||x.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i},f.ab=function(s,i){const l=[];for(const p in s)p in i||l.push(p);return l},f.ac=gt,f.ad=function(s,i,l){var p=Math.sin(l),g=Math.cos(l),v=i[0],x=i[1],w=i[2],E=i[3],L=i[4],D=i[5],R=i[6],F=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=v*g+L*p,s[1]=x*g+D*p,s[2]=w*g+R*p,s[3]=E*g+F*p,s[4]=L*g-v*p,s[5]=D*g-x*p,s[6]=R*g-w*p,s[7]=F*g-E*p,s},f.ae=function(s){var i=new rh(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},f.af=Bd,f.ag=function(s,i){let l=0,p=0;if(s.kind==="constant")p=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:x}=s,w=g?gt(di.interpolationFactor(g,i,v,x),0,1):0;s.kind==="camera"?p=Ai.number(s.minSize,s.maxSize,w):l=w}return{uSizeT:l,uSize:p}},f.ai=function(s,{uSize:i,uSizeT:l},{lowerSize:p,upperSize:g}){return s.kind==="source"?p/Ta:s.kind==="composite"?Ai.number(p/Ta,g/Ta,l):i},f.aj=ny,f.ak=function(s,i,l,p){const g=i.y-s.y,v=i.x-s.x,x=p.y-l.y,w=p.x-l.x,E=x*v-w*g;if(E===0)return null;const L=(w*(s.y-l.y)-x*(s.x-l.x))/E;return new P(s.x+L*v,s.y+L*g)},f.al=Dv,f.am=Rp,f.an=Ng,f.ao=Ur,f.aq=ey,f.ar=function(s,i){var l=i[0],p=i[1],g=i[2],v=i[3],x=i[4],w=i[5],E=i[6],L=i[7],D=i[8],R=i[9],F=i[10],V=i[11],G=i[12],H=i[13],tt=i[14],ot=i[15],vt=l*w-p*x,at=l*E-g*x,dt=l*L-v*x,kt=p*E-g*w,Ot=p*L-v*w,ie=g*L-v*E,fe=D*H-R*G,re=D*tt-F*G,ee=D*ot-V*G,Ht=R*tt-F*H,ce=R*ot-V*H,Jt=F*ot-V*tt,Gt=vt*Jt-at*ce+dt*Ht+kt*ee-Ot*re+ie*fe;return Gt?(s[0]=(w*Jt-E*ce+L*Ht)*(Gt=1/Gt),s[1]=(g*ce-p*Jt-v*Ht)*Gt,s[2]=(H*ie-tt*Ot+ot*kt)*Gt,s[3]=(F*Ot-R*ie-V*kt)*Gt,s[4]=(E*ee-x*Jt-L*re)*Gt,s[5]=(l*Jt-g*ee+v*re)*Gt,s[6]=(tt*dt-G*ie-ot*at)*Gt,s[7]=(D*ie-F*dt+V*at)*Gt,s[8]=(x*ce-w*ee+L*fe)*Gt,s[9]=(p*ee-l*ce-v*fe)*Gt,s[10]=(G*Ot-H*dt+ot*vt)*Gt,s[11]=(R*dt-D*Ot-V*vt)*Gt,s[12]=(w*re-x*Ht-E*fe)*Gt,s[13]=(l*Ht-p*re+g*fe)*Gt,s[14]=(H*at-G*kt-tt*vt)*Gt,s[15]=(D*kt-R*at+F*vt)*Gt,s):null},f.as=cy,f.at=ty,f.au=hy,f.av=function(){const s={},i=Ct.$version;for(const l in Ct.$root){const p=Ct.$root[l];if(p.required){let g=null;g=l==="version"?i:p.type==="array"?[]:{},g!=null&&(s[l]=g)}}return s},f.aw=Ed,f.ax=en,f.ay=function(s){s=s.slice();const i=Object.create(null);for(let l=0;l<s.length;l++)i[s[l].id]=s[l];for(let l=0;l<s.length;l++)"ref"in s[l]&&(s[l]=qo(s[l],i[s[l].ref]));return s},f.az=function(s){if(s.type==="custom")return new vI(s);switch(s.type){case"background":return new gI(s);case"circle":return new eS(s);case"fill":return new bS(s);case"fill-extrusion":return new OS(s);case"heatmap":return new rS(s);case"hillshade":return new oS(s);case"line":return new jS(s);case"raster":return new _I(s);case"symbol":return new Yd(s)}},f.b=tn,f.b0=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},f.b1=Lt,f.b2=Ev,f.b3=Sv,f.b4=function(s,i,l,p,g){var v,x=1/Math.tan(i/2);return s[0]=x/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+p)*(v=1/(p-g)),s[14]=2*g*p*v):(s[10]=-1,s[14]=-2*p),s},f.b5=function(s,i,l){var p=Math.sin(l),g=Math.cos(l),v=i[4],x=i[5],w=i[6],E=i[7],L=i[8],D=i[9],R=i[10],F=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=v*g+L*p,s[5]=x*g+D*p,s[6]=w*g+R*p,s[7]=E*g+F*p,s[8]=L*g-v*p,s[9]=D*g-x*p,s[10]=R*g-w*p,s[11]=F*g-E*p,s},f.b6=W,f.b7=st,f.b8=function(s){return s*Math.PI/180},f.b9=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},f.bA=Sa,f.ba=class extends js{},f.bb=sy,f.bc=AI,f.be=zn,f.bf=function(s,i){Ze.REGISTERED_PROTOCOLS[s]=i},f.bg=function(s){delete Ze.REGISTERED_PROTOCOLS[s]},f.bh=function(s,i){const l={};for(let g=0;g<s.length;g++){const v=i&&i[s[g].id]||Ag(s[g]);i&&(i[s[g].id]=v);let x=l[v];x||(x=l[v]=[]),x.push(s[g])}const p=[];for(const g in l)p.push(l[g]);return p},f.bi=ae,f.bj=Tv,f.bk=Pv,f.bl=av,f.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=gr/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0],l=i.layout,p=i._unevaluatedLayout._values,g={layoutIconSize:p["icon-size"].possiblyEvaluate(new Hn(s.bucket.zoom+1),s.canonical),layoutTextSize:p["text-size"].possiblyEvaluate(new Hn(s.bucket.zoom+1),s.canonical),textMaxSize:p["text-size"].possiblyEvaluate(new Hn(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:D}=s.bucket.textSizeData;g.compositeTextSizes=[p["text-size"].possiblyEvaluate(new Hn(L),s.canonical),p["text-size"].possiblyEvaluate(new Hn(D),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:D}=s.bucket.iconSizeData;g.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new Hn(L),s.canonical),p["icon-size"].possiblyEvaluate(new Hn(D),s.canonical)]}const v=l.get("text-line-height")*Ur,x=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",w=l.get("text-keep-upright"),E=l.get("text-size");for(const L of s.bucket.features){const D=l.get("text-font").evaluate(L,{},s.canonical).join(","),R=E.evaluate(L,{},s.canonical),F=g.layoutTextSize.evaluate(L,{},s.canonical),V=g.layoutIconSize.evaluate(L,{},s.canonical),G={horizontal:{},vertical:void 0},H=L.text;let tt,ot=[0,0];if(H){const dt=H.toString(),kt=l.get("text-letter-spacing").evaluate(L,{},s.canonical)*Ur,Ot=Cd(dt)?kt:0,ie=l.get("text-anchor").evaluate(L,{},s.canonical),fe=Uv(i,L,s.canonical);if(!fe){const Jt=l.get("text-radial-offset").evaluate(L,{},s.canonical);ot=Jt?Vv(ie,[Jt*Ur,uy]):l.get("text-offset").evaluate(L,{},s.canonical).map(Gt=>Gt*Ur)}let re=x?"center":l.get("text-justify").evaluate(L,{},s.canonical);const ee=l.get("symbol-placement"),Ht=ee==="point"?l.get("text-max-width").evaluate(L,{},s.canonical)*Ur:0,ce=()=>{s.bucket.allowVerticalPlacement&&Ul(dt)&&(G.vertical=Zd(H,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,ie,"left",Ot,ot,f.ah.vertical,!0,ee,F,R))};if(!x&&fe){const Jt=new Set;if(re==="auto")for(let ve=0;ve<fe.values.length;ve+=2)Jt.add(cy(fe.values[ve]));else Jt.add(re);let Gt=!1;for(const ve of Jt)if(!G.horizontal[ve])if(Gt)G.horizontal[ve]=G.horizontal[0];else{const de=Zd(H,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,"center",ve,Ot,ot,f.ah.horizontal,!1,ee,F,R);de&&(G.horizontal[ve]=de,Gt=de.positionedLines.length===1)}ce()}else{re==="auto"&&(re=cy(ie));const Jt=Zd(H,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,ie,re,Ot,ot,f.ah.horizontal,!1,ee,F,R);Jt&&(G.horizontal[re]=Jt),ce(),Ul(dt)&&x&&w&&(G.vertical=Zd(H,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,ie,re,Ot,ot,f.ah.vertical,!1,ee,F,R))}}let vt=!1;if(L.icon&&L.icon.name){const dt=s.imageMap[L.icon.name];dt&&(tt=hI(s.imagePositions[L.icon.name],l.get("icon-offset").evaluate(L,{},s.canonical),l.get("icon-anchor").evaluate(L,{},s.canonical)),vt=!!dt.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=vt:s.bucket.sdfIcons!==vt&&te("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(dt.pixelRatio!==s.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const at=qv(G.horizontal)||G.vertical;s.bucket.iconsInText=!!at&&at.iconsInText,(at||tt)&&LI(s.bucket,L,G,tt,s.imageMap,g,F,V,ot,vt,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},f.bn=Xg,f.bo=Wg,f.bp=Hg,f.bq=ql,f.br=Kg,f.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},f.bt=function(s,i,l,p,g){return u(this,void 0,void 0,function*(){if(j())try{return yield pe(s,i,l,p,g)}catch{}return function(v,x,w,E,L){const D=v.width,R=v.height;Ie&&we||(Ie=new OffscreenCanvas(D,R),we=Ie.getContext("2d",{willReadFrequently:!0})),Ie.width=D,Ie.height=R,we.drawImage(v,0,0,D,R);const F=we.getImageData(x,w,E,L);return we.clearRect(0,0,D,R),F.data}(s,i,l,p,g)})},f.bu=Cv,f.bv=b,f.bw=C,f.bx=Q0,f.by=Ja,f.bz=function(s){return s.message===on},f.c=Cn,f.d=s=>u(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(i)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.e=At,f.f=s=>new Promise((i,l)=>{const p=new Image;p.onload=()=>{i(p),URL.revokeObjectURL(p.src),p.onload=null,window.requestAnimationFrame(()=>{p.src=Ce})},p.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});p.src=s.byteLength?URL.createObjectURL(g):Ce}),f.g=Je,f.h=(s,i)=>xn(At(s,{type:"json"}),i),f.i=De,f.j=ke,f.k=xt,f.l=(s,i)=>xn(At(s,{type:"arrayBuffer"}),i),f.m=xn,f.n=function(s){return new Kg(s).readFields(oI,[])},f.o=Vp,f.p=sv,f.q=Zi,f.r=Mg,f.s=Fn,f.t=Fl,f.u=ne,f.v=Ct,f.w=te,f.x=$a,f.y=function([s,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(l),y:s*Math.sin(i)*Math.sin(l),z:s*Math.cos(l)}},f.z=Ai}),a("worker",["./shared"],function(f){class u{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,B){for(const K of z){this._layerConfigs[K.id]=K;const pt=this._layers[K.id]=f.az(K);pt._featureFilter=f.a6(pt.filter),this.keyCache[K.id]&&delete this.keyCache[K.id]}for(const K of B)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const q=f.bh(Object.values(this._layerConfigs),this.keyCache);for(const K of q){const pt=K.map(Rt=>this._layers[Rt.id]),ft=pt[0];if(ft.visibility==="none")continue;const yt=ft.source||"";let ut=this.familiesBySource[yt];ut||(ut=this.familiesBySource[yt]={});const wt=ft.sourceLayer||"_geojsonTileLayer";let zt=ut[wt];zt||(zt=ut[wt]=[]),zt.push(pt)}}}class b{constructor(z){const B={},q=[];for(const yt in z){const ut=z[yt],wt=B[yt]={};for(const zt in ut){const Rt=ut[+zt];if(!Rt||Rt.bitmap.width===0||Rt.bitmap.height===0)continue;const Nt={x:0,y:0,w:Rt.bitmap.width+2,h:Rt.bitmap.height+2};q.push(Nt),wt[zt]={rect:Nt,metrics:Rt.metrics}}}const{w:K,h:pt}=f.p(q),ft=new f.o({width:K||1,height:pt||1});for(const yt in z){const ut=z[yt];for(const wt in ut){const zt=ut[+wt];if(!zt||zt.bitmap.width===0||zt.bitmap.height===0)continue;const Rt=B[yt][wt].rect;f.o.copy(zt.bitmap,ft,{x:0,y:0},{x:Rt.x+1,y:Rt.y+1},zt.bitmap)}}this.image=ft,this.positions=B}}f.bi("GlyphAtlas",b);class C{constructor(z){this.tileID=new f.Q(z.tileID.overscaledZ,z.tileID.wrap,z.tileID.canonical.z,z.tileID.canonical.x,z.tileID.canonical.y),this.uid=z.uid,this.zoom=z.zoom,this.pixelRatio=z.pixelRatio,this.tileSize=z.tileSize,this.source=z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=z.showCollisionBoxes,this.collectResourceTiming=!!z.collectResourceTiming,this.returnDependencies=!!z.returnDependencies,this.promoteId=z.promoteId,this.inFlightDependencies=[]}parse(z,B,q,K){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=z,this.collisionBoxArray=new f.a4;const pt=new f.bj(Object.keys(z.layers).sort()),ft=new f.bk(this.tileID,this.promoteId);ft.bucketLayerIDs=[];const yt={},ut={featureIndex:ft,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},wt=B.familiesBySource[this.source];for(const qe in wt){const sr=z.layers[qe];if(!sr)continue;sr.version===1&&f.w(`Vector tile source "${this.source}" layer "${qe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Fr=pt.encode(qe),Pi=[];for(let qi=0;qi<sr.length;qi++){const Qr=sr.feature(qi),fs=ft.getId(Qr,qe);Pi.push({feature:Qr,id:fs,index:qi,sourceLayerIndex:Fr})}for(const qi of wt[qe]){const Qr=qi[0];Qr.source!==this.source&&f.w(`layer.source = ${Qr.source} does not equal this.source = ${this.source}`),Qr.minzoom&&this.zoom<Math.floor(Qr.minzoom)||Qr.maxzoom&&this.zoom>=Qr.maxzoom||Qr.visibility!=="none"&&(A(qi,this.zoom,q),(yt[Qr.id]=Qr.createBucket({index:ft.bucketLayerIDs.length,layers:qi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Fr,sourceID:this.source})).populate(Pi,ut,this.tileID.canonical),ft.bucketLayerIDs.push(qi.map(fs=>fs.id)))}}const zt=f.aE(ut.glyphDependencies,qe=>Object.keys(qe).map(Number));this.inFlightDependencies.forEach(qe=>qe==null?void 0:qe.abort()),this.inFlightDependencies=[];let Rt=Promise.resolve({});if(Object.keys(zt).length){const qe=new AbortController;this.inFlightDependencies.push(qe),Rt=K.sendAsync({type:"GG",data:{stacks:zt,source:this.source,tileID:this.tileID,type:"glyphs"}},qe)}const Nt=Object.keys(ut.iconDependencies);let ge=Promise.resolve({});if(Nt.length){const qe=new AbortController;this.inFlightDependencies.push(qe),ge=K.sendAsync({type:"GI",data:{icons:Nt,source:this.source,tileID:this.tileID,type:"icons"}},qe)}const xe=Object.keys(ut.patternDependencies);let ze=Promise.resolve({});if(xe.length){const qe=new AbortController;this.inFlightDependencies.push(qe),ze=K.sendAsync({type:"GI",data:{icons:xe,source:this.source,tileID:this.tileID,type:"patterns"}},qe)}const[Ae,sn,An]=yield Promise.all([Rt,ge,ze]),Zn=new b(Ae),Ar=new f.bl(sn,An);for(const qe in yt){const sr=yt[qe];sr instanceof f.a5?(A(sr.layers,this.zoom,q),f.bm({bucket:sr,glyphMap:Ae,glyphPositions:Zn.positions,imageMap:sn,imagePositions:Ar.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):sr.hasPattern&&(sr instanceof f.bn||sr instanceof f.bo||sr instanceof f.bp)&&(A(sr.layers,this.zoom,q),sr.addFeatures(ut,this.tileID.canonical,Ar.patternPositions))}return this.status="done",{buckets:Object.values(yt).filter(qe=>!qe.isEmpty()),featureIndex:ft,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Zn.image,imageAtlas:Ar,glyphMap:this.returnDependencies?Ae:null,iconMap:this.returnDependencies?sn:null,glyphPositions:this.returnDependencies?Zn.positions:null}})}}function A(et,z,B){const q=new f.a8(z);for(const K of et)K.recalculate(q,B)}class P{constructor(z,B,q){this.actor=z,this.layerIndex=B,this.availableImages=q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(z,B){return f._(this,void 0,void 0,function*(){const q=yield f.l(z.request,B);try{return{vectorTile:new f.bq.VectorTile(new f.br(q.data)),rawData:q.data,cacheControl:q.cacheControl,expires:q.expires}}catch(K){const pt=new Uint8Array(q.data);let ft=`Unable to parse the tile at ${z.request.url}, `;throw ft+=pt[0]===31&&pt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${K.messge}`,new Error(ft)}})}loadTile(z){return f._(this,void 0,void 0,function*(){const B=z.uid,q=!!(z&&z.request&&z.request.collectResourceTiming)&&new f.bs(z.request),K=new C(z);this.loading[B]=K;const pt=new AbortController;K.abort=pt;try{const ft=yield this.loadVectorTile(z,pt);if(delete this.loading[B],!ft)return null;const yt=ft.rawData,ut={};ft.expires&&(ut.expires=ft.expires),ft.cacheControl&&(ut.cacheControl=ft.cacheControl);const wt={};if(q){const Rt=q.finish();Rt&&(wt.resourceTiming=JSON.parse(JSON.stringify(Rt)))}K.vectorTile=ft.vectorTile;const zt=K.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[B]=K,this.fetching[B]={rawTileData:yt,cacheControl:ut,resourceTiming:wt};try{const Rt=yield zt;return f.e({rawTileData:yt.slice(0)},Rt,ut,wt)}finally{delete this.fetching[B]}}catch(ft){throw delete this.loading[B],K.status="done",this.loaded[B]=K,ft}})}reloadTile(z){return f._(this,void 0,void 0,function*(){const B=z.uid;if(!this.loaded||!this.loaded[B])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const q=this.loaded[B];if(q.showCollisionBoxes=z.showCollisionBoxes,q.status==="parsing"){const K=yield q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor);let pt;if(this.fetching[B]){const{rawTileData:ft,cacheControl:yt,resourceTiming:ut}=this.fetching[B];delete this.fetching[B],pt=f.e({rawTileData:ft.slice(0)},K,yt,ut)}else pt=K;return pt}if(q.status==="done"&&q.vectorTile)return q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(z){return f._(this,void 0,void 0,function*(){const B=this.loading,q=z.uid;B&&B[q]&&B[q].abort&&(B[q].abort.abort(),delete B[q])})}removeTile(z){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[z.uid]&&delete this.loaded[z.uid]})}}class k{constructor(){this.loaded={}}loadTile(z){return f._(this,void 0,void 0,function*(){const{uid:B,encoding:q,rawImageData:K,redFactor:pt,greenFactor:ft,blueFactor:yt,baseShift:ut}=z,wt=K.width+2,zt=K.height+2,Rt=f.b(K)?new f.R({width:wt,height:zt},yield f.bt(K,-1,-1,wt,zt)):K,Nt=new f.bu(B,Rt,q,pt,ft,yt,ut);return this.loaded=this.loaded||{},this.loaded[B]=Nt,Nt})}removeTile(z){const B=this.loaded,q=z.uid;B&&B[q]&&delete B[q]}}function Y(et,z){if(et.length!==0){X(et[0],z);for(var B=1;B<et.length;B++)X(et[B],!z)}}function X(et,z){for(var B=0,q=0,K=0,pt=et.length,ft=pt-1;K<pt;ft=K++){var yt=(et[K][0]-et[ft][0])*(et[ft][1]+et[K][1]),ut=B+yt;q+=Math.abs(B)>=Math.abs(yt)?B-ut+yt:yt-ut+B,B=ut}B+q>=0!=!!z&&et.reverse()}var lt=f.bv(function et(z,B){var q,K=z&&z.type;if(K==="FeatureCollection")for(q=0;q<z.features.length;q++)et(z.features[q],B);else if(K==="GeometryCollection")for(q=0;q<z.geometries.length;q++)et(z.geometries[q],B);else if(K==="Feature")et(z.geometry,B);else if(K==="Polygon")Y(z.coordinates,B);else if(K==="MultiPolygon")for(q=0;q<z.coordinates.length;q++)Y(z.coordinates[q],B);return z});const ht=f.bq.VectorTileFeature.prototype.toGeoJSON;var _t={exports:{}},j=f.bw,W=f.bq.VectorTileFeature,st=gt;function gt(et,z){this.options=z||{},this.features=et,this.length=et.length}function Lt(et,z){this.id=typeof et.id=="number"?et.id:void 0,this.type=et.type,this.rawGeometry=et.type===1?[et.geometry]:et.geometry,this.properties=et.tags,this.extent=z||4096}gt.prototype.feature=function(et){return new Lt(this.features[et],this.options.extent)},Lt.prototype.loadGeometry=function(){var et=this.rawGeometry;this.geometry=[];for(var z=0;z<et.length;z++){for(var B=et[z],q=[],K=0;K<B.length;K++)q.push(new j(B[K][0],B[K][1]));this.geometry.push(q)}return this.geometry},Lt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var et=this.geometry,z=1/0,B=-1/0,q=1/0,K=-1/0,pt=0;pt<et.length;pt++)for(var ft=et[pt],yt=0;yt<ft.length;yt++){var ut=ft[yt];z=Math.min(z,ut.x),B=Math.max(B,ut.x),q=Math.min(q,ut.y),K=Math.max(K,ut.y)}return[z,q,B,K]},Lt.prototype.toGeoJSON=W.prototype.toGeoJSON;var At=f.bx,Tt=st;function Vt(et){var z=new At;return function(B,q){for(var K in B.layers)q.writeMessage(3,Yt,B.layers[K])}(et,z),z.finish()}function Yt(et,z){var B;z.writeVarintField(15,et.version||1),z.writeStringField(1,et.name||""),z.writeVarintField(5,et.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<et.length;B++)q.feature=et.feature(B),z.writeMessage(2,J,q);var K=q.keys;for(B=0;B<K.length;B++)z.writeStringField(3,K[B]);var pt=q.values;for(B=0;B<pt.length;B++)z.writeMessage(4,De,pt[B])}function J(et,z){var B=et.feature;B.id!==void 0&&z.writeVarintField(1,B.id),z.writeMessage(2,Ut,et),z.writeVarintField(3,B.type),z.writeMessage(4,Xe,B)}function Ut(et,z){var B=et.feature,q=et.keys,K=et.values,pt=et.keycache,ft=et.valuecache;for(var yt in B.properties){var ut=B.properties[yt],wt=pt[yt];if(ut!==null){wt===void 0&&(q.push(yt),pt[yt]=wt=q.length-1),z.writeVarint(wt);var zt=typeof ut;zt!=="string"&&zt!=="boolean"&&zt!=="number"&&(ut=JSON.stringify(ut));var Rt=zt+":"+ut,Nt=ft[Rt];Nt===void 0&&(K.push(ut),ft[Rt]=Nt=K.length-1),z.writeVarint(Nt)}}}function te(et,z){return(z<<3)+(7&et)}function le(et){return et<<1^et>>31}function Xe(et,z){for(var B=et.loadGeometry(),q=et.type,K=0,pt=0,ft=B.length,yt=0;yt<ft;yt++){var ut=B[yt],wt=1;q===1&&(wt=ut.length),z.writeVarint(te(1,wt));for(var zt=q===3?ut.length-1:ut.length,Rt=0;Rt<zt;Rt++){Rt===1&&q!==1&&z.writeVarint(te(2,zt-1));var Nt=ut[Rt].x-K,ge=ut[Rt].y-pt;z.writeVarint(le(Nt)),z.writeVarint(le(ge)),K+=Nt,pt+=ge}q===3&&z.writeVarint(te(7,1))}}function De(et,z){var B=typeof et;B==="string"?z.writeStringField(1,et):B==="boolean"?z.writeBooleanField(7,et):B==="number"&&(et%1!=0?z.writeDoubleField(3,et):et<0?z.writeSVarintField(6,et):z.writeVarintField(5,et))}_t.exports=Vt,_t.exports.fromVectorTileJs=Vt,_t.exports.fromGeojsonVt=function(et,z){z=z||{};var B={};for(var q in et)B[q]=new Tt(et[q].features,z),B[q].name=q,B[q].version=z.version,B[q].extent=z.extent;return Vt({layers:B})},_t.exports.GeoJSONWrapper=Tt;var ue=f.bv(_t.exports);const tn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:et=>et},Ce=Math.fround||(pe=new Float32Array(1),et=>(pe[0]=+et,pe[0]));var pe;const Ie=3,we=5,on=6;class Cn{constructor(z){this.options=Object.assign(Object.create(tn),z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(z){const{log:B,minZoom:q,maxZoom:K}=this.options;B&&console.time("total time");const pt=`prepare ${z.length} points`;B&&console.time(pt),this.points=z;const ft=[];for(let ut=0;ut<z.length;ut++){const wt=z[ut];if(!wt.geometry)continue;const[zt,Rt]=wt.geometry.coordinates,Nt=Ce(vn(zt)),ge=Ce(zn(Rt));ft.push(Nt,ge,1/0,ut,-1,1),this.options.reduce&&ft.push(0)}let yt=this.trees[K+1]=this._createTree(ft);B&&console.timeEnd(pt);for(let ut=K;ut>=q;ut--){const wt=+Date.now();yt=this.trees[ut]=this._createTree(this._cluster(yt,ut)),B&&console.log("z%d: %d clusters in %dms",ut,yt.numItems,+Date.now()-wt)}return B&&console.timeEnd("total time"),this}getClusters(z,B){let q=((z[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,z[1]));let pt=z[2]===180?180:((z[2]+180)%360+360)%360-180;const ft=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)q=-180,pt=180;else if(q>pt){const Rt=this.getClusters([q,K,180,ft],B),Nt=this.getClusters([-180,K,pt,ft],B);return Rt.concat(Nt)}const yt=this.trees[this._limitZoom(B)],ut=yt.range(vn(q),zn(ft),vn(pt),zn(K)),wt=yt.data,zt=[];for(const Rt of ut){const Nt=this.stride*Rt;zt.push(wt[Nt+we]>1?Ze(wt,Nt,this.clusterProps):this.points[wt[Nt+Ie]])}return zt}getChildren(z){const B=this._getOriginId(z),q=this._getOriginZoom(z),K="No cluster with the specified id.",pt=this.trees[q];if(!pt)throw new Error(K);const ft=pt.data;if(B*this.stride>=ft.length)throw new Error(K);const yt=this.options.radius/(this.options.extent*Math.pow(2,q-1)),ut=pt.within(ft[B*this.stride],ft[B*this.stride+1],yt),wt=[];for(const zt of ut){const Rt=zt*this.stride;ft[Rt+4]===z&&wt.push(ft[Rt+we]>1?Ze(ft,Rt,this.clusterProps):this.points[ft[Rt+Ie]])}if(wt.length===0)throw new Error(K);return wt}getLeaves(z,B,q){const K=[];return this._appendLeaves(K,z,B=B||10,q=q||0,0),K}getTile(z,B,q){const K=this.trees[this._limitZoom(z)],pt=Math.pow(2,z),{extent:ft,radius:yt}=this.options,ut=yt/ft,wt=(q-ut)/pt,zt=(q+1+ut)/pt,Rt={features:[]};return this._addTileFeatures(K.range((B-ut)/pt,wt,(B+1+ut)/pt,zt),K.data,B,q,pt,Rt),B===0&&this._addTileFeatures(K.range(1-ut/pt,wt,1,zt),K.data,pt,q,pt,Rt),B===pt-1&&this._addTileFeatures(K.range(0,wt,ut/pt,zt),K.data,-1,q,pt,Rt),Rt.features.length?Rt:null}getClusterExpansionZoom(z){let B=this._getOriginZoom(z)-1;for(;B<=this.options.maxZoom;){const q=this.getChildren(z);if(B++,q.length!==1)break;z=q[0].properties.cluster_id}return B}_appendLeaves(z,B,q,K,pt){const ft=this.getChildren(B);for(const yt of ft){const ut=yt.properties;if(ut&&ut.cluster?pt+ut.point_count<=K?pt+=ut.point_count:pt=this._appendLeaves(z,ut.cluster_id,q,K,pt):pt<K?pt++:z.push(yt),z.length===q)break}return pt}_createTree(z){const B=new f.au(z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let q=0;q<z.length;q+=this.stride)B.add(z[q],z[q+1]);return B.finish(),B.data=z,B}_addTileFeatures(z,B,q,K,pt,ft){for(const yt of z){const ut=yt*this.stride,wt=B[ut+we]>1;let zt,Rt,Nt;if(wt)zt=Je(B,ut,this.clusterProps),Rt=B[ut],Nt=B[ut+1];else{const ze=this.points[B[ut+Ie]];zt=ze.properties;const[Ae,sn]=ze.geometry.coordinates;Rt=vn(Ae),Nt=zn(sn)}const ge={type:1,geometry:[[Math.round(this.options.extent*(Rt*pt-q)),Math.round(this.options.extent*(Nt*pt-K))]],tags:zt};let xe;xe=wt||this.options.generateId?B[ut+Ie]:this.points[B[ut+Ie]].id,xe!==void 0&&(ge.id=xe),ft.features.push(ge)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,B){const{radius:q,extent:K,reduce:pt,minPoints:ft}=this.options,yt=q/(K*Math.pow(2,B)),ut=z.data,wt=[],zt=this.stride;for(let Rt=0;Rt<ut.length;Rt+=zt){if(ut[Rt+2]<=B)continue;ut[Rt+2]=B;const Nt=ut[Rt],ge=ut[Rt+1],xe=z.within(ut[Rt],ut[Rt+1],yt),ze=ut[Rt+we];let Ae=ze;for(const sn of xe){const An=sn*zt;ut[An+2]>B&&(Ae+=ut[An+we])}if(Ae>ze&&Ae>=ft){let sn,An=Nt*ze,Zn=ge*ze,Ar=-1;const qe=((Rt/zt|0)<<5)+(B+1)+this.points.length;for(const sr of xe){const Fr=sr*zt;if(ut[Fr+2]<=B)continue;ut[Fr+2]=B;const Pi=ut[Fr+we];An+=ut[Fr]*Pi,Zn+=ut[Fr+1]*Pi,ut[Fr+4]=qe,pt&&(sn||(sn=this._map(ut,Rt,!0),Ar=this.clusterProps.length,this.clusterProps.push(sn)),pt(sn,this._map(ut,Fr)))}ut[Rt+4]=qe,wt.push(An/Ae,Zn/Ae,1/0,qe,-1,Ae),pt&&wt.push(Ar)}else{for(let sn=0;sn<zt;sn++)wt.push(ut[Rt+sn]);if(Ae>1)for(const sn of xe){const An=sn*zt;if(!(ut[An+2]<=B)){ut[An+2]=B;for(let Zn=0;Zn<zt;Zn++)wt.push(ut[An+Zn])}}}}return wt}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,B,q){if(z[B+we]>1){const ft=this.clusterProps[z[B+on]];return q?Object.assign({},ft):ft}const K=this.points[z[B+Ie]].properties,pt=this.options.map(K);return q&&pt===K?Object.assign({},pt):pt}}function Ze(et,z,B){return{type:"Feature",id:et[z+Ie],properties:Je(et,z,B),geometry:{type:"Point",coordinates:[(q=et[z],360*(q-.5)),en(et[z+1])]}};var q}function Je(et,z,B){const q=et[z+we],K=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q,pt=et[z+on],ft=pt===-1?{}:Object.assign({},B[pt]);return Object.assign(ft,{cluster:!0,cluster_id:et[z+Ie],point_count:q,point_count_abbreviated:K})}function vn(et){return et/360+.5}function zn(et){const z=Math.sin(et*Math.PI/180),B=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return B<0?0:B>1?1:B}function en(et){const z=(180-360*et)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function xn(et,z,B,q){for(var K,pt=q,ft=B-z>>1,yt=B-z,ut=et[z],wt=et[z+1],zt=et[B],Rt=et[B+1],Nt=z+3;Nt<B;Nt+=3){var ge=Fn(et[Nt],et[Nt+1],ut,wt,zt,Rt);if(ge>pt)K=Nt,pt=ge;else if(ge===pt){var xe=Math.abs(Nt-ft);xe<yt&&(K=Nt,yt=xe)}}pt>q&&(K-z>3&&xn(et,z,K,q),et[K+2]=pt,B-K>3&&xn(et,K,B,q))}function Fn(et,z,B,q,K,pt){var ft=K-B,yt=pt-q;if(ft!==0||yt!==0){var ut=((et-B)*ft+(z-q)*yt)/(ft*ft+yt*yt);ut>1?(B=K,q=pt):ut>0&&(B+=ft*ut,q+=yt*ut)}return(ft=et-B)*ft+(yt=z-q)*yt}function mr(et,z,B,q){var K={id:et===void 0?null:et,type:z,geometry:B,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pt){var ft=pt.geometry,yt=pt.type;if(yt==="Point"||yt==="MultiPoint"||yt==="LineString")rt(pt,ft);else if(yt==="Polygon"||yt==="MultiLineString")for(var ut=0;ut<ft.length;ut++)rt(pt,ft[ut]);else if(yt==="MultiPolygon")for(ut=0;ut<ft.length;ut++)for(var wt=0;wt<ft[ut].length;wt++)rt(pt,ft[ut][wt])}(K),K}function rt(et,z){for(var B=0;B<z.length;B+=3)et.minX=Math.min(et.minX,z[B]),et.minY=Math.min(et.minY,z[B+1]),et.maxX=Math.max(et.maxX,z[B]),et.maxY=Math.max(et.maxY,z[B+1])}function xt(et,z,B,q){if(z.geometry){var K=z.geometry.coordinates,pt=z.geometry.type,ft=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),yt=[],ut=z.id;if(B.promoteId?ut=z.properties[B.promoteId]:B.generateId&&(ut=q||0),pt==="Point")ke(K,yt);else if(pt==="MultiPoint")for(var wt=0;wt<K.length;wt++)ke(K[wt],yt);else if(pt==="LineString")cn(K,yt,ft,!1);else if(pt==="MultiLineString"){if(B.lineMetrics){for(wt=0;wt<K.length;wt++)cn(K[wt],yt=[],ft,!1),et.push(mr(ut,"LineString",yt,z.properties));return}Ct(K,yt,ft,!1)}else if(pt==="Polygon")Ct(K,yt,ft,!0);else{if(pt!=="MultiPolygon"){if(pt==="GeometryCollection"){for(wt=0;wt<z.geometry.geometries.length;wt++)xt(et,{id:ut,geometry:z.geometry.geometries[wt],properties:z.properties},B,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(wt=0;wt<K.length;wt++){var zt=[];Ct(K[wt],zt,ft,!0),yt.push(zt)}}et.push(mr(ut,pt,yt,z.properties))}}function ke(et,z){z.push($n(et[0])),z.push(qo(et[1])),z.push(0)}function cn(et,z,B,q){for(var K,pt,ft=0,yt=0;yt<et.length;yt++){var ut=$n(et[yt][0]),wt=qo(et[yt][1]);z.push(ut),z.push(wt),z.push(0),yt>0&&(ft+=q?(K*wt-ut*pt)/2:Math.sqrt(Math.pow(ut-K,2)+Math.pow(wt-pt,2))),K=ut,pt=wt}var zt=z.length-3;z[2]=1,xn(z,0,zt,B),z[zt+2]=1,z.size=Math.abs(ft),z.start=0,z.end=z.size}function Ct(et,z,B,q){for(var K=0;K<et.length;K++){var pt=[];cn(et[K],pt,B,q),z.push(pt)}}function $n(et){return et/360+.5}function qo(et){var z=Math.sin(et*Math.PI/180),B=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return B<0?0:B>1?1:B}function Qe(et,z,B,q,K,pt,ft,yt){if(q/=z,pt>=(B/=z)&&ft<q)return et;if(ft<B||pt>=q)return null;for(var ut=[],wt=0;wt<et.length;wt++){var zt=et[wt],Rt=zt.geometry,Nt=zt.type,ge=K===0?zt.minX:zt.minY,xe=K===0?zt.maxX:zt.maxY;if(ge>=B&&xe<q)ut.push(zt);else if(!(xe<B||ge>=q)){var ze=[];if(Nt==="Point"||Nt==="MultiPoint")Or(Rt,ze,B,q,K);else if(Nt==="LineString")Cl(Rt,ze,B,q,K,!1,yt.lineMetrics);else if(Nt==="MultiLineString")Ll(Rt,ze,B,q,K,!1);else if(Nt==="Polygon")Ll(Rt,ze,B,q,K,!0);else if(Nt==="MultiPolygon")for(var Ae=0;Ae<Rt.length;Ae++){var sn=[];Ll(Rt[Ae],sn,B,q,K,!0),sn.length&&ze.push(sn)}if(ze.length){if(yt.lineMetrics&&Nt==="LineString"){for(Ae=0;Ae<ze.length;Ae++)ut.push(mr(zt.id,Nt,ze[Ae],zt.tags));continue}Nt!=="LineString"&&Nt!=="MultiLineString"||(ze.length===1?(Nt="LineString",ze=ze[0]):Nt="MultiLineString"),Nt!=="Point"&&Nt!=="MultiPoint"||(Nt=ze.length===3?"Point":"MultiPoint"),ut.push(mr(zt.id,Nt,ze,zt.tags))}}}return ut.length?ut:null}function Or(et,z,B,q,K){for(var pt=0;pt<et.length;pt+=3){var ft=et[pt+K];ft>=B&&ft<=q&&(z.push(et[pt]),z.push(et[pt+1]),z.push(et[pt+2]))}}function Cl(et,z,B,q,K,pt,ft){for(var yt,ut,wt=Tl(et),zt=K===0?ya:dc,Rt=et.start,Nt=0;Nt<et.length-3;Nt+=3){var ge=et[Nt],xe=et[Nt+1],ze=et[Nt+2],Ae=et[Nt+3],sn=et[Nt+4],An=K===0?ge:xe,Zn=K===0?Ae:sn,Ar=!1;ft&&(yt=Math.sqrt(Math.pow(ge-Ae,2)+Math.pow(xe-sn,2))),An<B?Zn>B&&(ut=zt(wt,ge,xe,Ae,sn,B),ft&&(wt.start=Rt+yt*ut)):An>q?Zn<q&&(ut=zt(wt,ge,xe,Ae,sn,q),ft&&(wt.start=Rt+yt*ut)):Pl(wt,ge,xe,ze),Zn<B&&An>=B&&(ut=zt(wt,ge,xe,Ae,sn,B),Ar=!0),Zn>q&&An<=q&&(ut=zt(wt,ge,xe,Ae,sn,q),Ar=!0),!pt&&Ar&&(ft&&(wt.end=Rt+yt*ut),z.push(wt),wt=Tl(et)),ft&&(Rt+=yt)}var qe=et.length-3;ge=et[qe],xe=et[qe+1],ze=et[qe+2],(An=K===0?ge:xe)>=B&&An<=q&&Pl(wt,ge,xe,ze),qe=wt.length-3,pt&&qe>=3&&(wt[qe]!==wt[0]||wt[qe+1]!==wt[1])&&Pl(wt,wt[0],wt[1],wt[2]),wt.length&&z.push(wt)}function Tl(et){var z=[];return z.size=et.size,z.start=et.start,z.end=et.end,z}function Ll(et,z,B,q,K,pt){for(var ft=0;ft<et.length;ft++)Cl(et[ft],z,B,q,K,pt,!1)}function Pl(et,z,B,q){et.push(z),et.push(B),et.push(q)}function ya(et,z,B,q,K,pt){var ft=(pt-z)/(q-z);return et.push(pt),et.push(B+(K-B)*ft),et.push(1),ft}function dc(et,z,B,q,K,pt){var ft=(pt-B)/(K-B);return et.push(z+(q-z)*ft),et.push(pt),et.push(1),ft}function Za(et,z){for(var B=[],q=0;q<et.length;q++){var K,pt=et[q],ft=pt.type;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")K=Wt(pt.geometry,z);else if(ft==="MultiLineString"||ft==="Polygon"){K=[];for(var yt=0;yt<pt.geometry.length;yt++)K.push(Wt(pt.geometry[yt],z))}else if(ft==="MultiPolygon")for(K=[],yt=0;yt<pt.geometry.length;yt++){for(var ut=[],wt=0;wt<pt.geometry[yt].length;wt++)ut.push(Wt(pt.geometry[yt][wt],z));K.push(ut)}B.push(mr(pt.id,ft,K,pt.tags))}return B}function Wt(et,z){var B=[];B.size=et.size,et.start!==void 0&&(B.start=et.start,B.end=et.end);for(var q=0;q<et.length;q+=3)B.push(et[q]+z,et[q+1],et[q+2]);return B}function hs(et,z){if(et.transformed)return et;var B,q,K,pt=1<<et.z,ft=et.x,yt=et.y;for(B=0;B<et.features.length;B++){var ut=et.features[B],wt=ut.geometry,zt=ut.type;if(ut.geometry=[],zt===1)for(q=0;q<wt.length;q+=2)ut.geometry.push(oo(wt[q],wt[q+1],z,pt,ft,yt));else for(q=0;q<wt.length;q++){var Rt=[];for(K=0;K<wt[q].length;K+=2)Rt.push(oo(wt[q][K],wt[q][K+1],z,pt,ft,yt));ut.geometry.push(Rt)}}return et.transformed=!0,et}function oo(et,z,B,q,K,pt){return[Math.round(B*(et*q-K)),Math.round(B*(z*q-pt))]}function gu(et,z,B,q,K){for(var pt=z===K.maxZoom?0:K.tolerance/((1<<z)*K.extent),ft={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:q,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},yt=0;yt<et.length;yt++){ft.numFeatures++,fi(ft,et[yt],pt,K);var ut=et[yt].minX,wt=et[yt].minY,zt=et[yt].maxX,Rt=et[yt].maxY;ut<ft.minX&&(ft.minX=ut),wt<ft.minY&&(ft.minY=wt),zt>ft.maxX&&(ft.maxX=zt),Rt>ft.maxY&&(ft.maxY=Rt)}return ft}function fi(et,z,B,q){var K=z.geometry,pt=z.type,ft=[];if(pt==="Point"||pt==="MultiPoint")for(var yt=0;yt<K.length;yt+=3)ft.push(K[yt]),ft.push(K[yt+1]),et.numPoints++,et.numSimplified++;else if(pt==="LineString")$t(ft,K,et,B,!1,!1);else if(pt==="MultiLineString"||pt==="Polygon")for(yt=0;yt<K.length;yt++)$t(ft,K[yt],et,B,pt==="Polygon",yt===0);else if(pt==="MultiPolygon")for(var ut=0;ut<K.length;ut++){var wt=K[ut];for(yt=0;yt<wt.length;yt++)$t(ft,wt[yt],et,B,!0,yt===0)}if(ft.length){var zt=z.tags||null;if(pt==="LineString"&&q.lineMetrics){for(var Rt in zt={},z.tags)zt[Rt]=z.tags[Rt];zt.mapbox_clip_start=K.start/K.size,zt.mapbox_clip_end=K.end/K.size}var Nt={geometry:ft,type:pt==="Polygon"||pt==="MultiPolygon"?3:pt==="LineString"||pt==="MultiLineString"?2:1,tags:zt};z.id!==null&&(Nt.id=z.id),et.features.push(Nt)}}function $t(et,z,B,q,K,pt){var ft=q*q;if(q>0&&z.size<(K?ft:q))B.numPoints+=z.length/3;else{for(var yt=[],ut=0;ut<z.length;ut+=3)(q===0||z[ut+2]>ft)&&(B.numSimplified++,yt.push(z[ut]),yt.push(z[ut+1])),B.numPoints++;K&&function(wt,zt){for(var Rt=0,Nt=0,ge=wt.length,xe=ge-2;Nt<ge;xe=Nt,Nt+=2)Rt+=(wt[Nt]-wt[xe])*(wt[Nt+1]+wt[xe+1]);if(Rt>0===zt)for(Nt=0,ge=wt.length;Nt<ge/2;Nt+=2){var ze=wt[Nt],Ae=wt[Nt+1];wt[Nt]=wt[ge-2-Nt],wt[Nt+1]=wt[ge-1-Nt],wt[ge-2-Nt]=ze,wt[ge-1-Nt]=Ae}}(yt,pt),et.push(yt)}}function We(et,z){var B=(z=this.options=function(K,pt){for(var ft in pt)K[ft]=pt[ft];return K}(Object.create(this.options),z)).debug;if(B&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function(K,pt){var ft=[];if(K.type==="FeatureCollection")for(var yt=0;yt<K.features.length;yt++)xt(ft,K.features[yt],pt,yt);else xt(ft,K.type==="Feature"?K:{geometry:K},pt);return ft}(et,z);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function(K,pt){var ft=pt.buffer/pt.extent,yt=K,ut=Qe(K,1,-1-ft,ft,0,-1,2,pt),wt=Qe(K,1,1-ft,2+ft,0,-1,2,pt);return(ut||wt)&&(yt=Qe(K,1,-ft,1+ft,0,-1,2,pt)||[],ut&&(yt=Za(ut,1).concat(yt)),wt&&(yt=yt.concat(Za(wt,-1)))),yt}(q,z),q.length&&this.splitTile(q,0,0,0),B&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ge(et,z,B){return 32*((1<<et)*B+z)+et}function Pr(et,z){return z?et.properties[z]:et.id}function ps(et,z){if(et==null)return!0;if(et.type==="Feature")return Pr(et,z)!=null;if(et.type==="FeatureCollection"){const B=new Set;for(const q of et.features){const K=Pr(q,z);if(K==null||B.has(K))return!1;B.add(K)}return!0}return!1}function Oe(et,z){const B=new Map;if(et!=null)if(et.type==="Feature")B.set(Pr(et,z),et);else for(const q of et.features)B.set(Pr(q,z),q);return B}We.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},We.prototype.splitTile=function(et,z,B,q,K,pt,ft){for(var yt=[et,z,B,q],ut=this.options,wt=ut.debug;yt.length;){q=yt.pop(),B=yt.pop(),z=yt.pop(),et=yt.pop();var zt=1<<z,Rt=Ge(z,B,q),Nt=this.tiles[Rt];if(!Nt&&(wt>1&&console.time("creation"),Nt=this.tiles[Rt]=gu(et,z,B,q,ut),this.tileCoords.push({z,x:B,y:q}),wt)){wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,B,q,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));var ge="z"+z;this.stats[ge]=(this.stats[ge]||0)+1,this.total++}if(Nt.source=et,K){if(z===ut.maxZoom||z===K)continue;var xe=1<<K-z;if(B!==Math.floor(pt/xe)||q!==Math.floor(ft/xe))continue}else if(z===ut.indexMaxZoom||Nt.numPoints<=ut.indexMaxPoints)continue;if(Nt.source=null,et.length!==0){wt>1&&console.time("clipping");var ze,Ae,sn,An,Zn,Ar,qe=.5*ut.buffer/ut.extent,sr=.5-qe,Fr=.5+qe,Pi=1+qe;ze=Ae=sn=An=null,Zn=Qe(et,zt,B-qe,B+Fr,0,Nt.minX,Nt.maxX,ut),Ar=Qe(et,zt,B+sr,B+Pi,0,Nt.minX,Nt.maxX,ut),et=null,Zn&&(ze=Qe(Zn,zt,q-qe,q+Fr,1,Nt.minY,Nt.maxY,ut),Ae=Qe(Zn,zt,q+sr,q+Pi,1,Nt.minY,Nt.maxY,ut),Zn=null),Ar&&(sn=Qe(Ar,zt,q-qe,q+Fr,1,Nt.minY,Nt.maxY,ut),An=Qe(Ar,zt,q+sr,q+Pi,1,Nt.minY,Nt.maxY,ut),Ar=null),wt>1&&console.timeEnd("clipping"),yt.push(ze||[],z+1,2*B,2*q),yt.push(Ae||[],z+1,2*B,2*q+1),yt.push(sn||[],z+1,2*B+1,2*q),yt.push(An||[],z+1,2*B+1,2*q+1)}}},We.prototype.getTile=function(et,z,B){var q=this.options,K=q.extent,pt=q.debug;if(et<0||et>24)return null;var ft=1<<et,yt=Ge(et,z=(z%ft+ft)%ft,B);if(this.tiles[yt])return hs(this.tiles[yt],K);pt>1&&console.log("drilling down to z%d-%d-%d",et,z,B);for(var ut,wt=et,zt=z,Rt=B;!ut&&wt>0;)wt--,zt=Math.floor(zt/2),Rt=Math.floor(Rt/2),ut=this.tiles[Ge(wt,zt,Rt)];return ut&&ut.source?(pt>1&&console.log("found parent tile z%d-%d-%d",wt,zt,Rt),pt>1&&console.time("drilling down"),this.splitTile(ut.source,wt,zt,Rt,et,z,B),pt>1&&console.timeEnd("drilling down"),this.tiles[yt]?hs(this.tiles[yt],K):null):null};class Ha extends P{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(z,B){return f._(this,void 0,void 0,function*(){const q=z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const K=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!K)return null;const pt=new class{constructor(yt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.W,this.length=yt.length,this._features=yt}feature(yt){return new class{constructor(ut){this._feature=ut,this.extent=f.W,this.type=ut.type,this.properties=ut.tags,"id"in ut&&!isNaN(ut.id)&&(this.id=parseInt(ut.id,10))}loadGeometry(){if(this._feature.type===1){const ut=[];for(const wt of this._feature.geometry)ut.push([new f.P(wt[0],wt[1])]);return ut}{const ut=[];for(const wt of this._feature.geometry){const zt=[];for(const Rt of wt)zt.push(new f.P(Rt[0],Rt[1]));ut.push(zt)}return ut}}toGeoJSON(ut,wt,zt){return ht.call(this,ut,wt,zt)}}(this._features[yt])}}(K.features);let ft=ue(pt);return ft.byteOffset===0&&ft.byteLength===ft.buffer.byteLength||(ft=new Uint8Array(ft)),{vectorTile:pt,rawData:ft.buffer}})}loadData(z){return f._(this,void 0,void 0,function*(){var B;(B=this._pendingRequest)===null||B===void 0||B.abort();const q=!!(z&&z.request&&z.request.collectResourceTiming)&&new f.bs(z.request);this._pendingRequest=new AbortController;try{let K=yield this.loadGeoJSON(z,this._pendingRequest);if(delete this._pendingRequest,typeof K!="object")throw new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`);if(lt(K,!0),z.filter){const ft=f.by(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ft.result==="error")throw new Error(ft.value.map(ut=>`${ut.key}: ${ut.message}`).join(", "));K={type:"FeatureCollection",features:K.features.filter(ut=>ft.value.evaluate({zoom:0},ut))}}this._geoJSONIndex=z.cluster?new Cn(function({superclusterOptions:ft,clusterProperties:yt}){if(!yt||!ft)return ft;const ut={},wt={},zt={accumulated:null,zoom:0},Rt={properties:null},Nt=Object.keys(yt);for(const ge of Nt){const[xe,ze]=yt[ge],Ae=f.by(ze),sn=f.by(typeof xe=="string"?[xe,["accumulated"],["get",ge]]:xe);ut[ge]=Ae.value,wt[ge]=sn.value}return ft.map=ge=>{Rt.properties=ge;const xe={};for(const ze of Nt)xe[ze]=ut[ze].evaluate(zt,Rt);return xe},ft.reduce=(ge,xe)=>{Rt.properties=xe;for(const ze of Nt)zt.accumulated=ge[ze],ge[ze]=wt[ze].evaluate(zt,Rt)},ft}(z)).load(K.features):function(ft,yt){return new We(ft,yt)}(K,z.geojsonVtOptions),this.loaded={};const pt={};if(q){const ft=q.finish();ft&&(pt.resourceTiming={},pt.resourceTiming[z.source]=JSON.parse(JSON.stringify(ft)))}return pt}catch(K){if(delete this._pendingRequest,f.bz(K))return{abandoned:!0};throw K}})}reloadTile(z){const B=this.loaded;return B&&B[z.uid]?super.reloadTile(z):this.loadTile(z)}loadGeoJSON(z,B){return f._(this,void 0,void 0,function*(){const{promoteId:q}=z;if(z.request){const K=yield f.h(z.request,B);return this._dataUpdateable=ps(K.data,q)?Oe(K.data,q):void 0,K.data}if(typeof z.data=="string")try{const K=JSON.parse(z.data);return this._dataUpdateable=ps(K,q)?Oe(K,q):void 0,K}catch{throw new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`)}if(!z.dataDiff)throw new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${z.source}`);return function(K,pt,ft){var yt,ut,wt,zt;if(pt.removeAll&&K.clear(),pt.remove)for(const Rt of pt.remove)K.delete(Rt);if(pt.add)for(const Rt of pt.add){const Nt=Pr(Rt,ft);Nt!=null&&K.set(Nt,Rt)}if(pt.update)for(const Rt of pt.update){let Nt=K.get(Rt.id);if(Nt==null)continue;const ge=!Rt.removeAllProperties&&(((yt=Rt.removeProperties)===null||yt===void 0?void 0:yt.length)>0||((ut=Rt.addOrUpdateProperties)===null||ut===void 0?void 0:ut.length)>0);if((Rt.newGeometry||Rt.removeAllProperties||ge)&&(Nt=Object.assign({},Nt),K.set(Rt.id,Nt),ge&&(Nt.properties=Object.assign({},Nt.properties))),Rt.newGeometry&&(Nt.geometry=Rt.newGeometry),Rt.removeAllProperties)Nt.properties={};else if(((wt=Rt.removeProperties)===null||wt===void 0?void 0:wt.length)>0)for(const xe of Rt.removeProperties)Object.prototype.hasOwnProperty.call(Nt.properties,xe)&&delete Nt.properties[xe];if(((zt=Rt.addOrUpdateProperties)===null||zt===void 0?void 0:zt.length)>0)for(const{key:xe,value:ze}of Rt.addOrUpdateProperties)Nt.properties[xe]=ze}}(this._dataUpdateable,z.dataDiff,q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(z){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(z){return this._geoJSONIndex.getClusterExpansionZoom(z.clusterId)}getClusterChildren(z){return this._geoJSONIndex.getChildren(z.clusterId)}getClusterLeaves(z){return this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset)}}class zr{constructor(z){this.self=z,this.actor=new f.C(z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(B,q)=>{if(this.externalWorkerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.externalWorkerSourceTypes[B]=q},this.self.addProtocol=f.bf,this.self.removeProtocol=f.bg,this.self.registerRTLTextPlugin=B=>{if(f.bA.isParsed())throw new Error("RTL text plugin already registered.");f.bA.setMethods(B)},this.actor.registerMessageHandler("LDT",(B,q)=>this._getDEMWorkerSource(B,q.source).loadTile(q)),this.actor.registerMessageHandler("RDT",(B,q)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(B,q.source).removeTile(q)})),this.actor.registerMessageHandler("GCEZ",(B,q)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(B,q.type,q.source).getClusterExpansionZoom(q)})),this.actor.registerMessageHandler("GCC",(B,q)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(B,q.type,q.source).getClusterChildren(q)})),this.actor.registerMessageHandler("GCL",(B,q)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(B,q.type,q.source).getClusterLeaves(q)})),this.actor.registerMessageHandler("LD",(B,q)=>this._getWorkerSource(B,q.type,q.source).loadData(q)),this.actor.registerMessageHandler("LT",(B,q)=>this._getWorkerSource(B,q.type,q.source).loadTile(q)),this.actor.registerMessageHandler("RT",(B,q)=>this._getWorkerSource(B,q.type,q.source).reloadTile(q)),this.actor.registerMessageHandler("AT",(B,q)=>this._getWorkerSource(B,q.type,q.source).abortTile(q)),this.actor.registerMessageHandler("RMT",(B,q)=>this._getWorkerSource(B,q.type,q.source).removeTile(q)),this.actor.registerMessageHandler("RS",(B,q)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[B]||!this.workerSources[B][q.type]||!this.workerSources[B][q.type][q.source])return;const K=this.workerSources[B][q.type][q.source];delete this.workerSources[B][q.type][q.source],K.removeSource!==void 0&&K.removeSource(q)})),this.actor.registerMessageHandler("RM",B=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B]})),this.actor.registerMessageHandler("SR",(B,q)=>f._(this,void 0,void 0,function*(){this.referrer=q})),this.actor.registerMessageHandler("SRPS",(B,q)=>this._syncRTLPluginState(B,q)),this.actor.registerMessageHandler("IS",(B,q)=>f._(this,void 0,void 0,function*(){this.self.importScripts(q)})),this.actor.registerMessageHandler("SI",(B,q)=>this._setImages(B,q)),this.actor.registerMessageHandler("UL",(B,q)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(B).update(q.layers,q.removedIds)})),this.actor.registerMessageHandler("SL",(B,q)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(B).replace(q)}))}_setImages(z,B){return f._(this,void 0,void 0,function*(){this.availableImages[z]=B;for(const q in this.workerSources[z]){const K=this.workerSources[z][q];for(const pt in K)K[pt].availableImages=B}})}_syncRTLPluginState(z,B){return f._(this,void 0,void 0,function*(){if(f.bA.isParsed())return f.bA.getState();if(B.pluginStatus!=="loading")return f.bA.setState(B),B;const q=B.pluginURL;if(this.self.importScripts(q),f.bA.isParsed()){const K={pluginStatus:"loaded",pluginURL:q};return f.bA.setState(K),K}throw f.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${q}`)})}_getAvailableImages(z){let B=this.availableImages[z];return B||(B=[]),B}_getLayerIndex(z){let B=this.layerIndexes[z];return B||(B=this.layerIndexes[z]=new u),B}_getWorkerSource(z,B,q){if(this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][B]||(this.workerSources[z][B]={}),!this.workerSources[z][B][q]){const K={sendAsync:(pt,ft)=>(pt.targetMapId=z,this.actor.sendAsync(pt,ft))};switch(B){case"vector":this.workerSources[z][B][q]=new P(K,this._getLayerIndex(z),this._getAvailableImages(z));break;case"geojson":this.workerSources[z][B][q]=new Ha(K,this._getLayerIndex(z),this._getAvailableImages(z));break;default:this.workerSources[z][B][q]=new this.externalWorkerSourceTypes[B](K,this._getLayerIndex(z),this._getAvailableImages(z))}}return this.workerSources[z][B][q]}_getDEMWorkerSource(z,B){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][B]||(this.demWorkerSources[z][B]=new k),this.demWorkerSources[z][B]}}return f.i(self)&&(self.worker=new zr(self)),zr}),a("index",["exports","./shared"],function(f,u){var b="4.1.3";let C,A;const P={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((o,h)=>{const d=requestAnimationFrame(o);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(d),h(u.c())})}),getImageData(y,o=0){return this.getImageCanvasContext(y).getImageData(-o,-o,y.width+2*o,y.height+2*o)},getImageCanvasContext(y){const o=window.document.createElement("canvas"),h=o.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return o.width=y.width,o.height=y.height,h.drawImage(y,0,0,y.width,y.height),h},resolveURL:y=>(C||(C=document.createElement("a")),C.href=y,C.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(A==null&&(A=matchMedia("(prefers-reduced-motion: reduce)")),A.matches)}};class k{static testProp(o){if(!k.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in k.docStyle)return o[h];return o[0]}static create(o,h,d){const m=window.document.createElement(o);return h!==void 0&&(m.className=h),d&&d.appendChild(m),m}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){k.docStyle&&k.selectProp&&(k.userSelect=k.docStyle[k.selectProp],k.docStyle[k.selectProp]="none")}static enableDrag(){k.docStyle&&k.selectProp&&(k.docStyle[k.selectProp]=k.userSelect)}static setTransform(o,h){o.style[k.transformProp]=h}static addEventListener(o,h,d,m={}){o.addEventListener(h,d,"passive"in m?m:m.capture)}static removeEventListener(o,h,d,m={}){o.removeEventListener(h,d,"passive"in m?m:m.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",k.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",k.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",k.suppressClickInternal,!0)},0)}static getScale(o){const h=o.getBoundingClientRect();return{x:h.width/o.offsetWidth||1,y:h.height/o.offsetHeight||1,boundingClientRect:h}}static getPoint(o,h,d){const m=h.boundingClientRect;return new u.P((d.clientX-m.left)/h.x-o.clientLeft,(d.clientY-m.top)/h.y-o.clientTop)}static mousePos(o,h){const d=k.getScale(o);return k.getPoint(o,d,h)}static touchPos(o,h){const d=[],m=k.getScale(o);for(let _=0;_<h.length;_++)d.push(k.getPoint(o,m,h[_]));return d}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}k.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,k.selectProp=k.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),k.transformProp=k.testProp(["transform","WebkitTransform"]);const Y={supported:!1,testSupport:function(y){!ht&&lt&&(_t?j(y):X=y)}};let X,lt,ht=!1,_t=!1;function j(y){const o=y.createTexture();y.bindTexture(y.TEXTURE_2D,o);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,lt),y.isContextLost())return;Y.supported=!0}catch{}y.deleteTexture(o),ht=!0}var W;typeof document<"u"&&(lt=document.createElement("img"),lt.onload=function(){X&&j(X),X=null,_t=!0},lt.onerror=function(){ht=!0,X=null},lt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let o,h,d,m;y.resetRequestQueue=()=>{o=[],h=0,d=0,m={}},y.addThrottleControl=T=>{const M=d++;return m[M]=T,M},y.removeThrottleControl=T=>{delete m[T],S()},y.getImage=(T,M,N=!0)=>new Promise((O,U)=>{Y.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),u.e(T,{type:"image"}),o.push({abortController:M,requestParameters:T,supportImageRefresh:N,state:"queued",onError:$=>{U($)},onSuccess:$=>{O($)}}),S()});const _=T=>u._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:M,supportImageRefresh:N,onError:O,onSuccess:U,abortController:$}=T,Q=N===!1&&!u.i(self)&&!u.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce((ct,It)=>ct&&It==="accept",!0));h++;const nt=Q?I(M,$):u.m(M,$);try{const ct=yield nt;delete T.abortController,T.state="completed",ct.data instanceof HTMLImageElement||u.b(ct.data)?U(ct):ct.data&&U({data:yield(Z=ct.data,typeof createImageBitmap=="function"?u.d(Z):u.f(Z)),cacheControl:ct.cacheControl,expires:ct.expires})}catch(ct){delete T.abortController,O(ct)}finally{h--,S()}var Z}),S=()=>{const T=(()=>{for(const M of Object.keys(m))if(m[M]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=h;M<T&&o.length>0;M++){const N=o.shift();N.abortController.signal.aborted?M--:_(N)}},I=(T,M)=>new Promise((N,O)=>{const U=new Image,$=T.url,Q=T.credentials;Q&&Q==="include"?U.crossOrigin="use-credentials":(Q&&Q==="same-origin"||!u.s($))&&(U.crossOrigin="anonymous"),M.signal.addEventListener("abort",()=>{U.src="",O(u.c())}),U.fetchPriority="high",U.onload=()=>{U.onerror=U.onload=null,N({data:U})},U.onerror=()=>{U.onerror=U.onload=null,M.signal.aborted||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},U.src=$})}(W||(W={})),W.resetRequestQueue();class st{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeSpriteURL(o,h,d){const m=function(_){const S=_.match(gt);if(!S)throw new Error(`Unable to parse URL "${_}"`);return{protocol:S[1],authority:S[2],path:S[3]||"/",params:S[4]?S[4].split("&"):[]}}(o);return m.path+=`${h}${d}`,function(_){const S=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${S}`}(m)}setTransformRequest(o){this._transformRequestFn=o}}const gt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Lt(y){var o=new u.A(3);return o[0]=y[0],o[1]=y[1],o[2]=y[2],o}var At,Tt=function(y,o,h){return y[0]=o[0]-h[0],y[1]=o[1]-h[1],y[2]=o[2]-h[2],y};At=new u.A(3),u.A!=Float32Array&&(At[0]=0,At[1]=0,At[2]=0);var Vt=function(y){var o=y[0],h=y[1];return o*o+h*h};function Yt(y){const o=[];if(typeof y=="string")o.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:d,url:m}of y){const _=`${d}${m}`;h.indexOf(_)===-1&&(h.push(_),o.push({id:d,url:m}))}}return o}(function(){var y=new u.A(2);u.A!=Float32Array&&(y[0]=0,y[1]=0)})();class J{constructor(o,h,d,m){this.context=o,this.format=d,this.texture=o.gl.createTexture(),this.update(h,m)}update(o,h,d){const{width:m,height:_}=o,S=!(this.size&&this.size[0]===m&&this.size[1]===_||d),{context:I}=this,{gl:T}=I;if(this.useMipmap=!!(h&&h.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!h||h.premultiply!==!1)),S)this.size=[m,_],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||u.b(o)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,o):T.texImage2D(T.TEXTURE_2D,0,this.format,m,_,0,this.format,T.UNSIGNED_BYTE,o.data);else{const{x:M,y:N}=d||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||u.b(o)?T.texSubImage2D(T.TEXTURE_2D,0,M,N,T.RGBA,T.UNSIGNED_BYTE,o):T.texSubImage2D(T.TEXTURE_2D,0,M,N,m,_,T.RGBA,T.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(o,h,d){const{context:m}=this,{gl:_}=m;_.bindTexture(_.TEXTURE_2D,this.texture),d!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=_.LINEAR),o!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,d||o),this.filter=o),h!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,h),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function Ut(y){const{userImage:o}=y;return!!(o&&o.render&&o.render())&&(y.data.replace(new Uint8Array(o.data.buffer)),!0)}class te extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,promiseResolve:d}of this.requestors)d(this._getImagesForIds(h));this.requestors=[]}}getImage(o){const h=this.images[o];if(h&&!h.data&&h.spriteData){const d=h.spriteData;h.data=new u.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),h.spriteData=null}return h}addImage(o,h){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let d=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new u.j(new Error(`Image "${o}" has invalid "stretchX" value`))),d=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new u.j(new Error(`Image "${o}" has invalid "stretchY" value`))),d=!1),this._validateContent(h.content,h)||(this.fire(new u.j(new Error(`Image "${o}" has invalid "content" value`))),d=!1),d}_validateStretch(o,h){if(!o)return!0;let d=0;for(const m of o){if(m[0]<d||m[1]<m[0]||h<m[1])return!1;d=m[1]}return!0}_validateContent(o,h){if(!o)return!0;if(o.length!==4)return!1;const d=h.spriteData,m=d&&d.width||h.data.width,_=d&&d.height||h.data.height;return!(o[0]<0||m<o[0]||o[1]<0||_<o[1]||o[2]<0||m<o[2]||o[3]<0||_<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,h,d=!0){const m=this.getImage(o);if(d&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((h,d)=>{let m=!0;if(!this.isLoaded())for(const _ of o)this.images[_]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:h})})}_getImagesForIds(o){const h={};for(const d of o){let m=this.getImage(d);m||(this.fire(new u.k("styleimagemissing",{id:d})),m=this.getImage(d)),m?h[d]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:u.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],d=this.getImage(o);if(!d)return null;if(h&&h.position.version===d.version)return h.position;if(h)h.position.version=d.version;else{const m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},_=new u.I(m,d);this.patterns[o]={bin:m,position:_}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new J(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const _ in this.patterns)o.push(this.patterns[_].bin);const{w:h,h:d}=u.p(o),m=this.atlasImage;m.resize({width:h||1,height:d||1});for(const _ in this.patterns){const{bin:S}=this.patterns[_],I=S.x+1,T=S.y+1,M=this.getImage(_).data,N=M.width,O=M.height;u.R.copy(M,m,{x:0,y:0},{x:I,y:T},{width:N,height:O}),u.R.copy(M,m,{x:0,y:O-1},{x:I,y:T-1},{width:N,height:1}),u.R.copy(M,m,{x:0,y:0},{x:I,y:T+O},{width:N,height:1}),u.R.copy(M,m,{x:N-1,y:0},{x:I-1,y:T},{width:1,height:O}),u.R.copy(M,m,{x:0,y:0},{x:I+N,y:T},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const d=this.getImage(h);d||u.w(`Image with ID: "${h}" was not found`),Ut(d)&&this.updateImage(h,d)}}}const le=1e20;function Xe(y,o,h,d,m,_,S,I,T){for(let M=o;M<o+d;M++)De(y,h*_+M,_,m,S,I,T);for(let M=h;M<h+m;M++)De(y,M*_+o,1,d,S,I,T)}function De(y,o,h,d,m,_,S){_[0]=0,S[0]=-le,S[1]=le,m[0]=y[o];for(let I=1,T=0,M=0;I<d;I++){m[I]=y[o+I*h];const N=I*I;do{const O=_[T];M=(m[I]-m[O]+N-O*O)/(I-O)/2}while(M<=S[T]&&--T>-1);T++,_[T]=I,S[T]=M,S[T+1]=le}for(let I=0,T=0;I<d;I++){for(;S[T+1]<I;)T++;const M=_[T],N=I-M;y[o+I*h]=m[M]+N*N}}class ue{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return u._(this,void 0,void 0,function*(){const h=[];for(const _ in o)for(const S of o[_])h.push(this._getAndCacheGlyphsPromise(_,S));const d=yield Promise.all(h),m={};for(const{stack:_,id:S,glyph:I}of d)m[_]||(m[_]={}),m[_][S]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};return m})}_getAndCacheGlyphsPromise(o,h){return u._(this,void 0,void 0,function*(){let d=this.entries[o];d||(d=this.entries[o]={glyphs:{},requests:{},ranges:{}});let m=d.glyphs[h];if(m!==void 0)return{stack:o,id:h,glyph:m};if(m=this._tinySDF(d,o,h),m)return d.glyphs[h]=m,{stack:o,id:h,glyph:m};const _=Math.floor(h/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(d.ranges[_])return{stack:o,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!d.requests[_]){const I=ue.loadGlyphRange(o,_,this.url,this.requestManager);d.requests[_]=I}const S=yield d.requests[_];for(const I in S)this._doesCharSupportLocalGlyph(+I)||(d.glyphs[+I]=S[+I]);return d.ranges[_]=!0,{stack:o,id:h,glyph:S[h]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(u.u["CJK Unified Ideographs"](o)||u.u["Hangul Syllables"](o)||u.u.Hiragana(o)||u.u.Katakana(o))}_tinySDF(o,h,d){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let _=o.tinySDF;if(!_){let I="400";/bold/i.test(h)?I="900":/medium/i.test(h)?I="500":/light/i.test(h)&&(I="200"),_=o.tinySDF=new ue.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:I})}const S=_.draw(String.fromCharCode(d));return{id:d,bitmap:new u.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}ue.loadGlyphRange=function(y,o,h,d){return u._(this,void 0,void 0,function*(){const m=256*o,_=m+255,S=d.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${m}-${_}`),"Glyphs"),I=yield u.l(S,new AbortController);if(!I||!I.data)throw new Error(`Could not load glyph range. range: ${o}, ${m}-${_}`);const T={};for(const M of u.n(I.data))T[M.id]=M;return T})},ue.TinySDF=class{constructor({fontSize:y=24,buffer:o=3,radius:h=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:_="normal",fontStyle:S="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=h;const I=this.size=y+4*o,T=this._createCanvas(I),M=this.ctx=T.getContext("2d",{willReadFrequently:!0});M.font=`${S} ${_} ${y}px ${m}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(y){const o=document.createElement("canvas");return o.width=o.height=y,o}draw(y){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:_}=this.ctx.measureText(y),S=Math.ceil(h),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-m))),T=Math.min(this.size-this.buffer,S+Math.ceil(d)),M=I+2*this.buffer,N=T+2*this.buffer,O=Math.max(M*N,0),U=new Uint8ClampedArray(O),$={data:U,width:M,height:N,glyphWidth:I,glyphHeight:T,glyphTop:S,glyphLeft:0,glyphAdvance:o};if(I===0||T===0)return $;const{ctx:Q,buffer:nt,gridInner:Z,gridOuter:ct}=this;Q.clearRect(nt,nt,I,T),Q.fillText(y,nt,nt+S);const It=Q.getImageData(nt,nt,I,T);ct.fill(le,0,O),Z.fill(0,0,O);for(let it=0;it<T;it++)for(let mt=0;mt<I;mt++){const Et=It.data[4*(it*I+mt)+3]/255;if(Et===0)continue;const Pt=(it+nt)*M+mt+nt;if(Et===1)ct[Pt]=0,Z[Pt]=le;else{const Dt=.5-Et;ct[Pt]=Dt>0?Dt*Dt:0,Z[Pt]=Dt<0?Dt*Dt:0}}Xe(ct,0,0,M,N,M,this.f,this.v,this.z),Xe(Z,nt,nt,I,T,M,this.f,this.v,this.z);for(let it=0;it<O;it++){const mt=Math.sqrt(ct[it])-Math.sqrt(Z[it]);U[it]=Math.round(255-255*(mt/this.radius+this.cutoff))}return $}};class tn{constructor(){this.specification=u.v.light.position}possiblyEvaluate(o,h){return u.y(o.expression.evaluate(h))}interpolate(o,h,d){return{x:u.z.number(o.x,h.x,d),y:u.z.number(o.y,h.y,d),z:u.z.number(o.z,h.z,d)}}}let Ce;class pe extends u.E{constructor(o){super(),Ce=Ce||new u.q({anchor:new u.D(u.v.light.anchor),position:new tn,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(Ce),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(u.r,o,h))for(const d in o){const m=o[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,d){return(!d||d.validate!==!1)&&u.t(this,o.call(u.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}class Ie{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const d=o.join(",")+String(h);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(o,h)),this.dashEntry[d]}getDashRanges(o,h,d){const m=[];let _=o.length%2==1?-o[o.length-1]*d:0,S=o[0]*d,I=!0;m.push({left:_,right:S,isDash:I,zeroLength:o[0]===0});let T=o[0];for(let M=1;M<o.length;M++){I=!I;const N=o[M];_=T*d,T+=N,S=T*d,m.push({left:_,right:S,isDash:I,zeroLength:N===0})}return m}addRoundDash(o,h,d){const m=h/2;for(let _=-d;_<=d;_++){const S=this.width*(this.nextRow+d+_);let I=0,T=o[I];for(let M=0;M<this.width;M++){M/T.right>1&&(T=o[++I]);const N=Math.abs(M-T.left),O=Math.abs(M-T.right),U=Math.min(N,O);let $;const Q=_/d*(m+1);if(T.isDash){const nt=m-Math.abs(Q);$=Math.sqrt(U*U+nt*nt)}else $=m-Math.sqrt(U*U+Q*Q);this.data[S+M]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(o){for(let I=o.length-1;I>=0;--I){const T=o[I],M=o[I+1];T.zeroLength?o.splice(I,1):M&&M.isDash===T.isDash&&(M.left=T.left,o.splice(I,1))}const h=o[0],d=o[o.length-1];h.isDash===d.isDash&&(h.left=d.left-this.width,d.right=h.right+this.width);const m=this.width*this.nextRow;let _=0,S=o[_];for(let I=0;I<this.width;I++){I/S.right>1&&(S=o[++_]);const T=Math.abs(I-S.left),M=Math.abs(I-S.right),N=Math.min(T,M);this.data[m+I]=Math.max(0,Math.min(255,(S.isDash?N:-N)+128))}}addDash(o,h){const d=h?7:0,m=2*d+1;if(this.nextRow+m>this.height)return u.w("LineAtlas out of space"),null;let _=0;for(let I=0;I<o.length;I++)_+=o[I];if(_!==0){const I=this.width/_,T=this.getDashRanges(o,this.width,I);h?this.addRoundDash(T,I,d):this.addRegularDash(T)}const S={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:_};return this.nextRow+=m,this.dirty=!0,S}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const we="maplibre_preloaded_worker_pool";class on{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<on.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[we]}numActive(){return Object.keys(this.active).length}}const Cn=Math.floor(P.hardwareConcurrency/2);let Ze,Je;function vn(){return Ze||(Ze=new on),Ze}on.workerCount=u.B(globalThis)?Math.max(Math.min(Cn,3),1):1;class zn{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=h;const d=this.workerPool.acquire(h);for(let m=0;m<d.length;m++){const _=new u.C(d[m],h);_.name=`Worker ${m}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,h){const d=[];for(const m of this.actors)d.push(m.sendAsync({type:o,data:h}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,h){for(const d of this.actors)d.registerMessageHandler(o,h)}}function en(){return Je||(Je=new zn(vn(),u.G),Je.registerMessageHandler("GR",(y,o,h)=>u.m(o,h))),Je}function xn(y,o){const h=u.F();return u.H(h,h,[1,1,0]),u.J(h,h,[.5*y.width,.5*y.height,1]),u.K(h,h,y.calculatePosMatrix(o.toUnwrapped()))}function Fn(y,o,h,d,m,_){const S=function(O,U,$){if(O)for(const Q of O){const nt=U[Q];if(nt&&nt.source===$&&nt.type==="fill-extrusion")return!0}else for(const Q in U){const nt=U[Q];if(nt.source===$&&nt.type==="fill-extrusion")return!0}return!1}(m&&m.layers,o,y.id),I=_.maxPitchScaleFactor(),T=y.tilesIn(d,I,S);T.sort(mr);const M=[];for(const O of T)M.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(o,h,y._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,m,_,I,xn(y.transform,O.tileID))});const N=function(O){const U={},$={};for(const Q of O){const nt=Q.queryResults,Z=Q.wrappedTileID,ct=$[Z]=$[Z]||{};for(const It in nt){const it=nt[It],mt=ct[It]=ct[It]||{},Et=U[It]=U[It]||[];for(const Pt of it)mt[Pt.featureIndex]||(mt[Pt.featureIndex]=!0,Et.push(Pt))}}return U}(M);for(const O in N)N[O].forEach(U=>{const $=U.feature,Q=y.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=Q});return N}function mr(y,o){const h=y.tileID,d=o.tileID;return h.overscaledZ-d.overscaledZ||h.canonical.y-d.canonical.y||h.wrap-d.wrap||h.canonical.x-d.canonical.x}function rt(y,o,h){return u._(this,void 0,void 0,function*(){let d=y;if(y.url?d=(yield u.h(o.transformRequest(y.url,"Source"),h)).data:yield P.frameAsync(h),!d)return null;const m=u.L(u.e(d,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(m.vectorLayerIds=d.vector_layers.map(_=>_.id)),m})}class xt{constructor(o,h){o&&(h?this.setSouthWest(o).setNorthEast(h):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof u.M?new u.M(o.lng,o.lat):u.M.convert(o),this}setSouthWest(o){return this._sw=o instanceof u.M?new u.M(o.lng,o.lat):u.M.convert(o),this}extend(o){const h=this._sw,d=this._ne;let m,_;if(o instanceof u.M)m=o,_=o;else{if(!(o instanceof xt))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(xt.convert(o)):this.extend(u.M.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(u.M.convert(o)):this;if(m=o._sw,_=o._ne,!m||!_)return this}return h||d?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),d.lng=Math.max(_.lng,d.lng),d.lat=Math.max(_.lat,d.lat)):(this._sw=new u.M(m.lng,m.lat),this._ne=new u.M(_.lng,_.lat)),this}getCenter(){return new u.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.M(this.getWest(),this.getNorth())}getSouthEast(){return new u.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:h,lat:d}=u.M.convert(o);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&m}static convert(o){return o instanceof xt?o:o&&new xt(o)}static fromLngLat(o,h=0){const d=360*h/40075017,m=d/Math.cos(Math.PI/180*o.lat);return new xt(new u.M(o.lng-m,o.lat-d),new u.M(o.lng+m,o.lat+d))}}class ke{constructor(o,h,d){this.bounds=xt.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=d||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),d=Math.floor(u.N(this.bounds.getWest())*h),m=Math.floor(u.O(this.bounds.getNorth())*h),_=Math.ceil(u.N(this.bounds.getEast())*h),S=Math.ceil(u.O(this.bounds.getSouth())*h);return o.x>=d&&o.x<_&&o.y>=m&&o.y<S}}class cn extends u.E{constructor(o,h,d,m){if(super(),this.id=o,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.L(h,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield rt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(u.e(this,o),o.bounds&&(this.tileBounds=new ke(o.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new u.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(o){return u._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(h,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};d.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((_,S)=>{o.reloadPromise={resolve:_,reject:S}})}else o.actor=this.dispatcher.getActor(),m="LT";o.abortController=new AbortController;try{const _=yield o.actor.sendAsync({type:m,data:d},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,_)}catch(_){if(delete o.abortController,o.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,h){if(h&&h.resourceTiming&&(o.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&o.setExpiryData(h),o.loadVectorData(h,this.map.painter),o.reloadPromise){const d=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(d.resolve).catch(d.reject)}}abortTile(o){return u._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return u._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Ct extends u.E{constructor(o,h,d,m){super(),this.id=o,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},h),u.e(this,u.L(h,["url","scheme","tileSize"]))}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield rt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(u.e(this,o),o.bounds&&(this.tileBounds=new ke(o.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new u.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return u.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return u._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const d=yield W.getImage(this.map._requestManager.transformRequest(h,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&o.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const m=this.map.painter.context,_=m.gl,S=d.data;o.texture=this.map.painter.getTileTexture(S.width),o.texture?o.texture.update(S,{useMipmap:!0}):(o.texture=new J(m,S,_.RGBA,{useMipmap:!0}),o.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),o.state="loaded"}}catch(d){if(delete o.abortController,o.aborted)o.state="unloaded";else if(d)throw o.state="errored",d}})}abortTile(o){return u._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return u._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class $n extends Ct{constructor(o,h,d,m){super(o,h,d,m),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(o){return u._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(h,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const m=yield W.getImage(d,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(m&&m.data){const _=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&o.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const S=u.b(_)&&u.S()?_:yield this.readImageNow(_),I={type:this.type,uid:o.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const T=yield o.actor.sendAsync({type:"LDT",data:I});o.dem=T,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(m){if(delete o.abortController,o.aborted)o.state="unloaded";else if(m)throw o.state="errored",m}})}readImageNow(o){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.U()){const h=o.width+2,d=o.height+2;try{return new u.R({width:h,height:d},yield u.V(o,-1,-1,h,d))}catch{}}return P.getImageData(o,1)})}_getNeighboringTiles(o){const h=o.canonical,d=Math.pow(2,h.z),m=(h.x-1+d)%d,_=h.x===0?o.wrap-1:o.wrap,S=(h.x+1+d)%d,I=h.x+1===d?o.wrap+1:o.wrap,T={};return T[new u.Q(o.overscaledZ,_,h.z,m,h.y).key]={backfilled:!1},T[new u.Q(o.overscaledZ,I,h.z,S,h.y).key]={backfilled:!1},h.y>0&&(T[new u.Q(o.overscaledZ,_,h.z,m,h.y-1).key]={backfilled:!1},T[new u.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},T[new u.Q(o.overscaledZ,I,h.z,S,h.y-1).key]={backfilled:!1}),h.y+1<d&&(T[new u.Q(o.overscaledZ,_,h.z,m,h.y+1).key]={backfilled:!1},T[new u.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},T[new u.Q(o.overscaledZ,I,h.z,S,h.y+1).key]={backfilled:!1}),T}unloadTile(o){return u._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class qo extends u.E{constructor(o,h,d,m){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(m),this._data=h.data,this._options=u.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const _=u.W/this.tileSize;this.workerOptions=u.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*_,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*_,extent:u.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:u.W,radius:(h.clusterRadius||50)*_,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,h,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:h,offset:d}})}_updateWorkerData(o){return u._(this,void 0,void 0,function*(){const h=u.e({type:this.type},this.workerOptions);o?h.dataDiff=o:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(P.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||d.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let m=null;d.resourceTiming&&d.resourceTiming[this.id]&&(m=d.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&u.e(_,{resourceTiming:m}),this.fire(new u.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(d){if(this._pendingLoads--,this._removed)return void this.fire(new u.k("dataabort",{dataType:"source"}));this.fire(new u.j(d))}})}loaded(){return this._pendingLoads===0}loadTile(o){return u._(this,void 0,void 0,function*(){const h=o.actor?"RT":"LT";o.actor=this.actor;const d={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:d},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(o){return u._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return u._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Qe=u.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class Or extends u.E{constructor(o,h,d,m){super(),this.id=o,this.dispatcher=d,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(o){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield W.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,o&&(this.coordinates=o),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new u.j(h))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const h=o.map(u.Y.fromLngLat);this.tileID=function(m){let _=1/0,S=1/0,I=-1/0,T=-1/0;for(const U of m)_=Math.min(_,U.x),S=Math.min(S,U.y),I=Math.max(I,U.x),T=Math.max(T,U.y);const M=Math.max(I-_,T-S),N=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),O=Math.pow(2,N);return new u.a0(N,Math.floor((_+I)/2*O),Math.floor((S+T)/2*O))}(h),this.minzoom=this.maxzoom=this.tileID.z;const d=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new u.Z,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,u.W,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,u.W),this._boundsArray.emplaceBack(d[2].x,d[2].y,u.W,u.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Qe.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new J(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let d=!1;for(const m in this.tiles){const _=this.tiles[m];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,d=!0)}d&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Cl extends Or{constructor(o,h,d,m){super(o,h,d,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield u.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new u.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new u.j(new u.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,Qe.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new J(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let d=!1;for(const m in this.tiles){const _=this.tiles[m];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,d=!0)}d&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Tl extends Or{constructor(o,h,d,m){super(o,h,d,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(S=>typeof S!="number"))||this.fire(new u.j(new u.a1(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.a1(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new u.j(new u.a1(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.a1(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.a1(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,d=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,Qe.members)),this.boundsSegments||(this.boundsSegments=u.$.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new J(h,this.canvas,d.RGBA,{premultiply:!0});let m=!1;for(const _ in this.tiles){const S=this.tiles[_];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,m=!0)}m&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Ll={},Pl=y=>{switch(y){case"geojson":return qo;case"image":return Or;case"raster":return Ct;case"raster-dem":return $n;case"vector":return cn;case"video":return Cl;case"canvas":return Tl}return Ll[y]},ya="RTLPluginLoaded";class dc extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=en()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return u._(this,arguments,void 0,function*(h,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=P.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.k(ya))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Za=null;function Wt(){return Za||(Za=new dc),Za}class hs{constructor(o,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=u.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,h,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(m,_){const S={};if(!_)return S;for(const I of m){const T=I.layerIds.map(M=>_.getLayer(M)).filter(Boolean);if(T.length!==0){I.layers=T,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(M=>T.filter(N=>N.id===M)[0]));for(const M of T)S[M.id]=I}}return S}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const _=this.buckets[m];if(_ instanceof u.a5){if(this.hasSymbolBuckets=!0,!d)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const _=this.buckets[m];if(_ instanceof u.a5&&_.hasRTLText){this.hasRTLText=!0,Wt().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const _=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(_))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new u.a4}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const d in this.buckets){const m=this.buckets[d];m.uploadPending()&&m.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new J(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new J(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,d,m,_,S,I,T,M,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:_,scale:S,tileSize:this.tileSize,pixelPosMatrix:N,transform:T,params:I,queryPadding:this.queryPadding*M},o,h,d):{}}querySourceFeatures(o,h){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),_=h&&h.sourceLayer?h.sourceLayer:"",S=m._geojsonTileLayer||m[_];if(!S)return;const I=u.a6(h&&h.filter),{z:T,x:M,y:N}=this.tileID.canonical,O={z:T,x:M,y:N};for(let U=0;U<S.length;U++){const $=S.feature(U);if(I.needGeometry){const Z=u.a7($,!0);if(!I.filter(new u.a8(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!I.filter(new u.a8(this.tileID.overscaledZ),$))continue;const Q=d.getId($,_),nt=new u.a9($,T,M,N,Q);nt.tile=O,o.push(nt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const d=u.aa(o.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const _=this.expirationTime-h;_?this.expirationTime=d+Math.max(_,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const _=this.buckets[m],S=_.layers[0].sourceLayer||"_geojsonTileLayer",I=d[S],T=o[S];if(!I||!T||Object.keys(T).length===0)continue;_.update(T,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=h&&h.style&&h.style.getLayer(m);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<P.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=P.now()+o}setDependencies(o,h){const d={};for(const m of h)d[m]=!0;this.dependencies[o]=d}hasDependency(o,h){for(const d of o){const m=this.dependencies[d];if(m){for(const _ of h)if(m[_])return!0}}return!1}}class oo{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,d){const m=o.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const _={value:h,timeout:void 0};if(d!==void 0&&(_.timeout=setTimeout(()=>{this.remove(o,_)},d)),this.data[m].push(_),this.order.push(m),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const d=o.wrapped().key,m=h===void 0?0:this.data[d].indexOf(h),_=this.data[d][m];return this.data[d].splice(m,1),_.timeout&&clearTimeout(_.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(_.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const d in this.data)for(const m of this.data[d])o(m.value)||h.push(m);for(const d of h)this.remove(d.value.tileID,d)}}class gu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,d){const m=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},u.e(this.stateChanges[o][m],d),this.deletedStates[o]===null){this.deletedStates[o]={};for(const _ in this.state[o])_!==m&&(this.deletedStates[o][_]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][m]===null){this.deletedStates[o][m]={};for(const _ in this.state[o][m])d[_]||(this.deletedStates[o][m][_]=null)}else for(const _ in d)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][_]===null&&delete this.deletedStates[o][m][_]}removeFeatureState(o,h,d){if(this.deletedStates[o]===null)return;const m=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},d&&h!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][d]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(d in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][d]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}getState(o,h){const d=String(h),m=u.e({},(this.state[o]||{})[d],(this.stateChanges[o]||{})[d]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const _=this.deletedStates[o][h];if(_===null)return{};for(const S in _)delete m[S]}return m}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const _={};for(const S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),u.e(this.state[m][S],this.stateChanges[m][S]),_[S]=this.state[m][S];d[m]=_}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const _={};if(this.deletedStates[m]===null)for(const S in this.state[m])_[S]={},this.state[m][S]={};else for(const S in this.deletedStates[m]){if(this.deletedStates[m][S]===null)this.state[m][S]={};else for(const I of Object.keys(this.deletedStates[m][S]))delete this.state[m][S][I];_[S]=this.state[m][S]}d[m]=d[m]||{},u.e(d[m],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const m in o)o[m].setFeatureState(d,h)}}class fi extends u.E{constructor(o,h,d){super(),this.id=o,this.dispatcher=d,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,_,S,I)=>{const T=new(Pl(_.type))(m,_,S,I);if(T.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${T.id}`);return T})(o,h,d,this),this._tiles={},this._cache=new oo(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new gu,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,h,d){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,h,d)}catch(m){o.state="errored",m.status!==404?this._source.fire(new u.j(m,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new u.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const d=this._tiles[h];d.upload(o),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort($t).map(o=>o.key)}getRenderableIds(o){const h=[];for(const d in this._tiles)this._isIdRenderable(d,o)&&h.push(this._tiles[d]);return o?h.sort((d,m)=>{const _=d.tileID,S=m.tileID,I=new u.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),T=new u.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-S.overscaledZ||T.y-I.y||T.x-I.x}).map(d=>d.tileID.key):h.map(d=>d.tileID).sort($t).map(d=>d.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){return u._(this,void 0,void 0,function*(){const d=this._tiles[o];d&&(d.state!=="loading"&&(d.state=h),yield this._loadTile(d,o,h))})}_tileLoaded(o,h,d){o.timeAdded=P.now(),d==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const _=h[m];if(o.neighboringTiles&&o.neighboringTiles[_]){const S=this.getTileByID(_);d(o,S),d(S,o)}}function d(m,_){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let S=_.tileID.canonical.x-m.tileID.canonical.x;const I=_.tileID.canonical.y-m.tileID.canonical.y,T=Math.pow(2,m.tileID.canonical.z),M=_.tileID.key;S===0&&I===0||Math.abs(I)>1||(Math.abs(S)>1&&(Math.abs(S+T)===1?S+=T:Math.abs(S-T)===1&&(S-=T)),_.dem&&m.dem&&(m.dem.backfillBorder(_.dem,S,I),m.neighboringTiles&&m.neighboringTiles[M]&&(m.neighboringTiles[M].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,d,m){for(const _ in this._tiles){let S=this._tiles[_];if(m[_]||!S.hasData()||S.tileID.overscaledZ<=h||S.tileID.overscaledZ>d)continue;let I=S.tileID;for(;S&&S.tileID.overscaledZ>h+1;){const M=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[M.key],S&&S.hasData()&&(I=M)}let T=I;for(;T.overscaledZ>h;)if(T=T.scaledTo(T.overscaledZ-1),o[T.key]){m[I.key]=I;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const d=this._loadedParentTiles[o.key];return d&&d.tileID.overscaledZ>=h?d:null}for(let d=o.overscaledZ-1;d>=h;d--){const m=o.scaledTo(d),_=this._getLoadedTile(m);if(_)return _}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,d=Math.ceil(o.height/this._source.tileSize)+1,m=Math.floor(h*d*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(_)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const d={};for(const m in this._tiles){const _=this._tiles[m];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+h),d[_.tileID.key]=_}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(o,h){if(!this._sourceLoaded||this._paused)return;let d;this.transform=o,this.terrain=h,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(N=>new u.Q(N.canonical.z,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y)):(d=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(d=d.filter(N=>this._source.hasTile(N)))):d=[];const m=o.coveringZoomLevel(this._source),_=Math.max(m-fi.maxOverzooming,this._source.minzoom),S=Math.max(m+fi.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const N={};for(const O of d)if(O.canonical.z>this._source.minzoom){const U=O.scaledTo(O.canonical.z-1);N[U.key]=U;const $=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));N[$.key]=$}d=d.concat(Object.values(N))}const I=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,I&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(d,m);if(We(this._source.type)){const N={},O={},U=Object.keys(T),$=P.now();for(const Q of U){const nt=T[Q],Z=this._tiles[Q];if(!Z||Z.fadeEndTime!==0&&Z.fadeEndTime<=$)continue;const ct=this.findLoadedParent(nt,_);ct&&(this._addTile(ct.tileID),N[ct.tileID.key]=ct.tileID),O[Q]=nt}this._retainLoadedChildren(O,m,S,T);for(const Q in N)T[Q]||(this._coveredTiles[Q]=!0,T[Q]=N[Q]);if(h){const Q={},nt={};for(const Z of d)this._tiles[Z.key].hasData()?Q[Z.key]=Z:nt[Z.key]=Z;for(const Z in nt){const ct=nt[Z].children(this._source.maxzoom);this._tiles[ct[0].key]&&this._tiles[ct[1].key]&&this._tiles[ct[2].key]&&this._tiles[ct[3].key]&&(Q[ct[0].key]=T[ct[0].key]=ct[0],Q[ct[1].key]=T[ct[1].key]=ct[1],Q[ct[2].key]=T[ct[2].key]=ct[2],Q[ct[3].key]=T[ct[3].key]=ct[3],delete nt[Z])}for(const Z in nt){const ct=this.findLoadedParent(nt[Z],this._source.minzoom);if(ct){Q[ct.tileID.key]=T[ct.tileID.key]=ct.tileID;for(const It in Q)Q[It].isChildOf(ct.tileID)&&delete Q[It]}}for(const Z in this._tiles)Q[Z]||(this._coveredTiles[Z]=!0)}}for(const N in T)this._tiles[N].clearFadeHold();const M=u.ab(this._tiles,T);for(const N of M){const O=this._tiles[N];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(N)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){const d={},m={},_=Math.max(h-fi.maxOverzooming,this._source.minzoom),S=Math.max(h+fi.maxUnderzooming,this._source.minzoom),I={};for(const T of o){const M=this._addTile(T);d[T.key]=T,M.hasData()||h<this._source.maxzoom&&(I[T.key]=T)}this._retainLoadedChildren(I,h,S,d);for(const T of o){let M=this._tiles[T.key];if(M.hasData())continue;if(h+1>this._source.maxzoom){const O=T.children(this._source.maxzoom)[0],U=this.getTile(O);if(U&&U.hasData()){d[O.key]=O;continue}}else{const O=T.children(this._source.maxzoom);if(d[O[0].key]&&d[O[1].key]&&d[O[2].key]&&d[O[3].key])continue}let N=M.wasRequested();for(let O=T.overscaledZ-1;O>=_;--O){const U=T.scaledTo(O);if(m[U.key])break;if(m[U.key]=!0,M=this.getTile(U),!M&&N&&(M=this._addTile(U)),M){const $=M.hasData();if((N||$)&&(d[U.key]=U),N=M.wasRequested(),$)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let d,m=this._tiles[o].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}h.push(m.key);const _=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(_),d)break;m=_}for(const _ of h)this._loadedParentTiles[_]=d}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const d=h;return h||(h=new hs(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,o.key,h.state)),h.uses++,this._tiles[o.key]=h,d||this._source.fire(new u.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const d=h.getExpiryTimeout();d&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},d))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(o){const h=o.sourceDataType;o.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,d){const m=[],_=this.transform;if(!_)return m;const S=d?_.getCameraQueryGeometry(o):o,I=o.map(Q=>_.pointCoordinate(Q,this.terrain)),T=S.map(Q=>_.pointCoordinate(Q,this.terrain)),M=this.getIds();let N=1/0,O=1/0,U=-1/0,$=-1/0;for(const Q of T)N=Math.min(N,Q.x),O=Math.min(O,Q.y),U=Math.max(U,Q.x),$=Math.max($,Q.y);for(let Q=0;Q<M.length;Q++){const nt=this._tiles[M[Q]];if(nt.holdingForFade())continue;const Z=nt.tileID,ct=Math.pow(2,_.zoom-nt.tileID.overscaledZ),It=h*nt.queryPadding*u.W/nt.tileSize/ct,it=[Z.getTilePoint(new u.Y(N,O)),Z.getTilePoint(new u.Y(U,$))];if(it[0].x-It<u.W&&it[0].y-It<u.W&&it[1].x+It>=0&&it[1].y+It>=0){const mt=I.map(Pt=>Z.getTilePoint(Pt)),Et=T.map(Pt=>Z.getTilePoint(Pt));m.push({tile:nt,tileID:Z,queryGeometry:mt,cameraQueryGeometry:Et,scale:ct})}}return m}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(d=>this._tiles[d].tileID);for(const d of h)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(We(this._source.type)){const o=P.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=o)return!0}return!1}setFeatureState(o,h,d){this._state.updateState(o=o||"_geojsonTileLayer",h,d)}removeFeatureState(o,h,d){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,d)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,d){const m=this._tiles[o];m&&m.setDependencies(h,d)}reloadTilesForDependencies(o,h){for(const d in this._tiles)this._tiles[d].hasDependency(o,h)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(o,h))}}function $t(y,o){const h=Math.abs(2*y.wrap)-+(y.wrap<0),d=Math.abs(2*o.wrap)-+(o.wrap<0);return y.overscaledZ-o.overscaledZ||d-h||o.canonical.y-y.canonical.y||o.canonical.x-y.canonical.x}function We(y){return y==="raster"||y==="image"||y==="video"}fi.maxOverzooming=10,fi.maxUnderzooming=3;class Ge{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=u.ac(o,0,1);let h=1,d=this._distances[h];const m=o*this.paddedLength+this.padding;for(;d<m&&h<this._distances.length;)d=this._distances[++h];const _=h-1,S=this._distances[_],I=d-S,T=I>0?(m-S)/I:0;return this.points[_].mult(1-T).add(this.points[h].mult(T))}}function Pr(y,o){let h=!0;return y==="always"||y!=="never"&&o!=="never"||(h=!1),h}class ps{constructor(o,h,d){const m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(o/d),this.yCellCount=Math.ceil(h/d);for(let S=0;S<this.xCellCount*this.yCellCount;S++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,d,m,_){this._forEachCell(h,d,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(o,h,d,m){this._forEachCell(h-m,d-m,h+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(d),this.circles.push(m)}_insertBoxCell(o,h,d,m,_,S){this.boxCells[_].push(S)}_insertCircleCell(o,h,d,m,_,S){this.circleCells[_].push(S)}_query(o,h,d,m,_,S,I){if(d<0||o>this.width||m<0||h>this.height)return[];const T=[];if(o<=0&&h<=0&&this.width<=d&&this.height<=m){if(_)return[{key:null,x1:o,y1:h,x2:d,y2:m}];for(let M=0;M<this.boxKeys.length;M++)T.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const N=this.circles[3*M],O=this.circles[3*M+1],U=this.circles[3*M+2];T.push({key:this.circleKeys[M],x1:N-U,y1:O-U,x2:N+U,y2:O+U})}}else this._forEachCell(o,h,d,m,this._queryCell,T,{hitTest:_,overlapMode:S,seenUids:{box:{},circle:{}}},I);return T}query(o,h,d,m){return this._query(o,h,d,m,!1,null)}hitTest(o,h,d,m,_,S){return this._query(o,h,d,m,!0,_,S).length>0}hitTestCircle(o,h,d,m,_){const S=o-d,I=o+d,T=h-d,M=h+d;if(I<0||S>this.width||M<0||T>this.height)return!1;const N=[];return this._forEachCell(S,T,I,M,this._queryCellCircle,N,{hitTest:!0,overlapMode:m,circle:{x:o,y:h,radius:d},seenUids:{box:{},circle:{}}},_),N.length>0}_queryCell(o,h,d,m,_,S,I,T){const{seenUids:M,hitTest:N,overlapMode:O}=I,U=this.boxCells[_];if(U!==null){const Q=this.bboxes;for(const nt of U)if(!M.box[nt]){M.box[nt]=!0;const Z=4*nt,ct=this.boxKeys[nt];if(o<=Q[Z+2]&&h<=Q[Z+3]&&d>=Q[Z+0]&&m>=Q[Z+1]&&(!T||T(ct))&&(!N||!Pr(O,ct.overlapMode))&&(S.push({key:ct,x1:Q[Z],y1:Q[Z+1],x2:Q[Z+2],y2:Q[Z+3]}),N))return!0}}const $=this.circleCells[_];if($!==null){const Q=this.circles;for(const nt of $)if(!M.circle[nt]){M.circle[nt]=!0;const Z=3*nt,ct=this.circleKeys[nt];if(this._circleAndRectCollide(Q[Z],Q[Z+1],Q[Z+2],o,h,d,m)&&(!T||T(ct))&&(!N||!Pr(O,ct.overlapMode))){const It=Q[Z],it=Q[Z+1],mt=Q[Z+2];if(S.push({key:ct,x1:It-mt,y1:it-mt,x2:It+mt,y2:it+mt}),N)return!0}}}return!1}_queryCellCircle(o,h,d,m,_,S,I,T){const{circle:M,seenUids:N,overlapMode:O}=I,U=this.boxCells[_];if(U!==null){const Q=this.bboxes;for(const nt of U)if(!N.box[nt]){N.box[nt]=!0;const Z=4*nt,ct=this.boxKeys[nt];if(this._circleAndRectCollide(M.x,M.y,M.radius,Q[Z+0],Q[Z+1],Q[Z+2],Q[Z+3])&&(!T||T(ct))&&!Pr(O,ct.overlapMode))return S.push(!0),!0}}const $=this.circleCells[_];if($!==null){const Q=this.circles;for(const nt of $)if(!N.circle[nt]){N.circle[nt]=!0;const Z=3*nt,ct=this.circleKeys[nt];if(this._circlesCollide(Q[Z],Q[Z+1],Q[Z+2],M.x,M.y,M.radius)&&(!T||T(ct))&&!Pr(O,ct.overlapMode))return S.push(!0),!0}}}_forEachCell(o,h,d,m,_,S,I,T){const M=this._convertToXCellCoord(o),N=this._convertToYCellCoord(h),O=this._convertToXCellCoord(d),U=this._convertToYCellCoord(m);for(let $=M;$<=O;$++)for(let Q=N;Q<=U;Q++)if(_.call(this,o,h,d,m,this.xCellCount*Q+$,S,I,T))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,d,m,_,S){const I=m-o,T=_-h,M=d+S;return M*M>I*I+T*T}_circleAndRectCollide(o,h,d,m,_,S,I){const T=(S-m)/2,M=Math.abs(o-(m+T));if(M>T+d)return!1;const N=(I-_)/2,O=Math.abs(h-(_+N));if(O>N+d)return!1;if(M<=T||O<=N)return!0;const U=M-T,$=O-N;return U*U+$*$<=d*d}}function Oe(y,o,h,d,m){const _=u.F();return o?(u.J(_,_,[1/m,1/m,1]),h||u.ad(_,_,d.angle)):u.K(_,d.labelPlaneMatrix,y),_}function Ha(y,o,h,d,m){if(o){const _=u.ae(y);return u.J(_,_,[m,m,1]),h||u.ad(_,_,-d.angle),_}return d.glCoordMatrix}function zr(y,o,h){let d;h?(d=[y.x,y.y,h(y.x,y.y),1],u.af(d,d,o)):(d=[y.x,y.y,0,1],ge(d,d,o));const m=d[3];return{point:new u.P(d[0]/m,d[1]/m),signedDistanceFromCamera:m}}function et(y,o){return .5+y/o*.5}function z(y,o){const h=y[0]/y[3],d=y[1]/y[3];return h>=-o[0]&&h<=o[0]&&d>=-o[1]&&d<=o[1]}function B(y,o,h,d,m,_,S,I,T,M){const N=d?y.textSizeData:y.iconSizeData,O=u.ag(N,h.transform.zoom),U=[256/h.width*2+1,256/h.height*2+1],$=d?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;$.clear();const Q=y.lineVertexArray,nt=d?y.text.placedSymbolArray:y.icon.placedSymbolArray,Z=h.transform.width/h.transform.height;let ct=!1;for(let It=0;It<nt.length;It++){const it=nt.get(It);if(it.hidden||it.writingMode===u.ah.vertical&&!ct){Nt(it.numGlyphs,$);continue}let mt;if(ct=!1,M?(mt=[it.anchorX,it.anchorY,M(it.anchorX,it.anchorY),1],u.af(mt,mt,o)):(mt=[it.anchorX,it.anchorY,0,1],ge(mt,mt,o)),!z(mt,U)){Nt(it.numGlyphs,$);continue}const Et=et(h.transform.cameraToCenterDistance,mt[3]),Pt=u.ai(N,O,it),Dt=S?Pt/Et:Pt*Et,Bt=new u.P(it.anchorX,it.anchorY),Ft=zr(Bt,m,M).point,jt={projections:{},offsets:{}},Xt=pt(it,Dt,!1,I,o,m,_,y.glyphOffsetArray,Q,$,Ft,Bt,jt,Z,T,M);ct=Xt.useVertical,(Xt.notEnoughRoom||ct||Xt.needsFlipping&&pt(it,Dt,!0,I,o,m,_,y.glyphOffsetArray,Q,$,Ft,Bt,jt,Z,T,M).notEnoughRoom)&&Nt(it.numGlyphs,$)}d?y.text.dynamicLayoutVertexBuffer.updateData($):y.icon.dynamicLayoutVertexBuffer.updateData($)}function q(y,o,h,d,m,_,S,I,T,M,N,O,U){const $=I.glyphStartIndex+I.numGlyphs,Q=I.lineStartIndex,nt=I.lineStartIndex+I.lineLength,Z=o.getoffsetX(I.glyphStartIndex),ct=o.getoffsetX($-1),It=zt(y*Z,h,d,m,_,S,I.segment,Q,nt,T,M,N,O,U);if(!It)return null;const it=zt(y*ct,h,d,m,_,S,I.segment,Q,nt,T,M,N,O,U);return it?{first:It,last:it}:null}function K(y,o,h,d){return y===u.ah.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*d?{useVertical:!0}:(y===u.ah.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function pt(y,o,h,d,m,_,S,I,T,M,N,O,U,$,Q,nt){const Z=o/24,ct=y.lineOffsetX*Z,It=y.lineOffsetY*Z;let it;if(y.numGlyphs>1){const mt=y.glyphStartIndex+y.numGlyphs,Et=y.lineStartIndex,Pt=y.lineStartIndex+y.lineLength,Dt=q(Z,I,ct,It,h,N,O,y,T,_,U,Q,nt);if(!Dt)return{notEnoughRoom:!0};const Bt=zr(Dt.first.point,S,nt).point,Ft=zr(Dt.last.point,S,nt).point;if(d&&!h){const jt=K(y.writingMode,Bt,Ft,$);if(jt)return jt}it=[Dt.first];for(let jt=y.glyphStartIndex+1;jt<mt-1;jt++)it.push(zt(Z*I.getoffsetX(jt),ct,It,h,N,O,y.segment,Et,Pt,T,_,U,Q,nt));it.push(Dt.last)}else{if(d&&!h){const Et=zr(O,m,nt).point,Pt=y.lineStartIndex+y.segment+1,Dt=new u.P(T.getx(Pt),T.gety(Pt)),Bt=zr(Dt,m,nt),Ft=Bt.signedDistanceFromCamera>0?Bt.point:ft(O,Dt,Et,1,m,nt),jt=K(y.writingMode,Et,Ft,$);if(jt)return jt}const mt=zt(Z*I.getoffsetX(y.glyphStartIndex),ct,It,h,N,O,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,T,_,U,Q,nt);if(!mt)return{notEnoughRoom:!0};it=[mt]}for(const mt of it)u.aj(M,mt.point,mt.angle);return{}}function ft(y,o,h,d,m,_){const S=zr(y.add(y.sub(o)._unit()),m,_).point,I=h.sub(S);return h.add(I._mult(d/I.mag()))}function yt(y,o){const{projectionCache:h,lineVertexArray:d,labelPlaneMatrix:m,tileAnchorPoint:_,distanceFromAnchor:S,getElevation:I,previousVertex:T,direction:M,absOffsetX:N}=o;if(h.projections[y])return h.projections[y];const O=new u.P(d.getx(y),d.gety(y)),U=zr(O,m,I);if(U.signedDistanceFromCamera>0)return h.projections[y]=U.point,U.point;const $=y-M;return ft(S===0?_:new u.P(d.getx($),d.gety($)),O,T,N-S+1,m,I)}function ut(y,o,h){return y._unit()._perp()._mult(o*h)}function wt(y,o,h,d,m,_,S,I){const{projectionCache:T,direction:M}=I;if(T.offsets[y])return T.offsets[y];const N=h.add(o);if(y+M<d||y+M>=m)return T.offsets[y]=N,N;const O=yt(y+M,I),U=ut(O.sub(h),S,M),$=h.add(U),Q=O.add(U);return T.offsets[y]=u.ak(_,N,$,Q)||N,T.offsets[y]}function zt(y,o,h,d,m,_,S,I,T,M,N,O,U,$){const Q=d?y-o:y+o;let nt=Q>0?1:-1,Z=0;d&&(nt*=-1,Z=Math.PI),nt<0&&(Z+=Math.PI);let ct,It,it=nt>0?I+S:I+S+1,mt=m,Et=m,Pt=0,Dt=0;const Bt=Math.abs(Q),Ft=[];let jt;for(;Pt+Dt<=Bt;){if(it+=nt,it<I||it>=T)return null;Pt+=Dt,Et=mt,It=ct;const Kt={projectionCache:O,lineVertexArray:M,labelPlaneMatrix:N,tileAnchorPoint:_,distanceFromAnchor:Pt,getElevation:$,previousVertex:Et,direction:nt,absOffsetX:Bt};if(mt=yt(it,Kt),h===0)Ft.push(Et),jt=mt.sub(Et);else{let Se;const Be=mt.sub(Et);Se=Be.mag()===0?ut(yt(it+nt,Kt).sub(mt),h,nt):ut(Be,h,nt),It||(It=Et.add(Se)),ct=wt(it,Se,mt,I,T,It,h,Kt),Ft.push(It),jt=ct.sub(It)}Dt=jt.mag()}const Xt=jt._mult((Bt-Pt)/Dt)._add(It||Et),Fe=Z+Math.atan2(mt.y-Et.y,mt.x-Et.x);return Ft.push(Xt),{point:Xt,angle:U?Fe:0,path:Ft}}const Rt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Nt(y,o){for(let h=0;h<y;h++){const d=o.length;o.resize(d+4),o.float32.set(Rt,3*d)}}function ge(y,o,h){const d=o[0],m=o[1];return y[0]=h[0]*d+h[4]*m+h[12],y[1]=h[1]*d+h[5]*m+h[13],y[3]=h[3]*d+h[7]*m+h[15],y}const xe=100;class ze{constructor(o,h=new ps(o.width+200,o.height+200,25),d=new ps(o.width+200,o.height+200,25)){this.transform=o,this.grid=h,this.ignoredGrid=d,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+xe,this.screenBottomBoundary=o.height+xe,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,h,d,m,_,S){const I=this.projectAndGetPerspectiveRatio(m,o.anchorPointX,o.anchorPointY,S),T=d*I.perspectiveRatio,M=o.x1*T+I.point.x,N=o.y1*T+I.point.y,O=o.x2*T+I.point.x,U=o.y2*T+I.point.y;return!this.isInsideGrid(M,N,O,U)||h!=="always"&&this.grid.hitTest(M,N,O,U,h,_)||I.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[M,N,O,U],offscreen:this.isOffscreen(M,N,O,U)}}placeCollisionCircles(o,h,d,m,_,S,I,T,M,N,O,U,$,Q){const nt=[],Z=new u.P(h.anchorX,h.anchorY),ct=zr(Z,S,Q),It=et(this.transform.cameraToCenterDistance,ct.signedDistanceFromCamera),it=(N?_/It:_*It)/u.ao,mt=zr(Z,I,Q).point,Et=q(it,m,h.lineOffsetX*it,h.lineOffsetY*it,!1,mt,Z,h,d,I,{projections:{},offsets:{}},!1,Q);let Pt=!1,Dt=!1,Bt=!0;if(Et){const Ft=.5*U*It+$,jt=new u.P(-100,-100),Xt=new u.P(this.screenRightBoundary,this.screenBottomBoundary),Fe=new Ge,Kt=Et.first,Se=Et.last;let Be=[];for(let je=Kt.path.length-1;je>=1;je--)Be.push(Kt.path[je]);for(let je=1;je<Se.path.length;je++)Be.push(Se.path[je]);const ln=2.5*Ft;if(T){const je=Be.map(He=>zr(He,T,Q));Be=je.some(He=>He.signedDistanceFromCamera<=0)?[]:je.map(He=>He.point)}let Le=[];if(Be.length>0){const je=Be[0].clone(),He=Be[0].clone();for(let ur=1;ur<Be.length;ur++)je.x=Math.min(je.x,Be[ur].x),je.y=Math.min(je.y,Be[ur].y),He.x=Math.max(He.x,Be[ur].x),He.y=Math.max(He.y,Be[ur].y);Le=je.x>=jt.x&&He.x<=Xt.x&&je.y>=jt.y&&He.y<=Xt.y?[Be]:He.x<jt.x||je.x>Xt.x||He.y<jt.y||je.y>Xt.y?[]:u.al([Be],jt.x,jt.y,Xt.x,Xt.y)}for(const je of Le){Fe.reset(je,.25*Ft);let He=0;He=Fe.length<=.5*Ft?1:Math.ceil(Fe.paddedLength/ln)+1;for(let ur=0;ur<He;ur++){const Pn=ur/Math.max(He-1,1),uo=Fe.lerp(Pn),Br=uo.x+xe,er=uo.y+xe;nt.push(Br,er,Ft,0);const Vr=Br-Ft,co=er-Ft,_s=Br+Ft,Ia=er+Ft;if(Bt=Bt&&this.isOffscreen(Vr,co,_s,Ia),Dt=Dt||this.isInsideGrid(Vr,co,_s,Ia),o!=="always"&&this.grid.hitTestCircle(Br,er,Ft,o,O)&&(Pt=!0,!M))return{circles:[],offscreen:!1,collisionDetected:Pt}}}}return{circles:!M&&Pt||!Dt||It<this.perspectiveRatioCutoff?[]:nt,offscreen:Bt,collisionDetected:Pt}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let d=1/0,m=1/0,_=-1/0,S=-1/0;for(const N of o){const O=new u.P(N.x+xe,N.y+xe);d=Math.min(d,O.x),m=Math.min(m,O.y),_=Math.max(_,O.x),S=Math.max(S,O.y),h.push(O)}const I=this.grid.query(d,m,_,S).concat(this.ignoredGrid.query(d,m,_,S)),T={},M={};for(const N of I){const O=N.key;if(T[O.bucketInstanceId]===void 0&&(T[O.bucketInstanceId]={}),T[O.bucketInstanceId][O.featureIndex])continue;const U=[new u.P(N.x1,N.y1),new u.P(N.x2,N.y1),new u.P(N.x2,N.y2),new u.P(N.x1,N.y2)];u.am(h,U)&&(T[O.bucketInstanceId][O.featureIndex]=!0,M[O.bucketInstanceId]===void 0&&(M[O.bucketInstanceId]=[]),M[O.bucketInstanceId].push(O.featureIndex))}return M}insertCollisionBox(o,h,d,m,_,S){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:_,collisionGroupID:S,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,d,m,_,S){const I=d?this.ignoredGrid:this.grid,T={bucketInstanceId:m,featureIndex:_,collisionGroupID:S,overlapMode:h};for(let M=0;M<o.length;M+=4)I.insertCircle(T,o[M],o[M+1],o[M+2])}projectAndGetPerspectiveRatio(o,h,d,m){let _;return m?(_=[h,d,m(h,d),1],u.af(_,_,o)):(_=[h,d,0,1],ge(_,_,o)),{point:new u.P((_[0]/_[3]+1)/2*this.transform.width+xe,(-_[1]/_[3]+1)/2*this.transform.height+xe),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(o,h,d,m){return d<xe||o>=this.screenRightBoundary||m<xe||h>this.screenBottomBoundary}isInsideGrid(o,h,d,m){return d>=0&&o<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=u.an([]);return u.H(o,o,[-100,-100,0]),o}}function Ae(y,o,h){return o*(u.W/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class sn{constructor(o,h,d,m){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class An{constructor(o,h,d,m,_){this.text=new sn(o?o.text:null,h,d,_),this.icon=new sn(o?o.icon:null,h,m,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zn{constructor(o,h,d){this.text=o,this.icon=h,this.skipFade=d}}class Ar{constructor(){this.invProjMatrix=u.F(),this.viewportMatrix=u.F(),this.circles=[]}}class qe{constructor(o,h,d,m,_){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=_}}class sr{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:d=>d.collisionGroupID===h}}return this.collisionGroups[o]}}function Fr(y,o,h,d,m){const{horizontalAlign:_,verticalAlign:S}=u.at(y);return new u.P(-(_-.5)*o+d[0]*m,-(S-.5)*h+d[1]*m)}function Pi(y,o,h,d,m,_){const{x1:S,x2:I,y1:T,y2:M,anchorPointX:N,anchorPointY:O}=y,U=new u.P(o,h);return d&&U._rotate(m?_:-_),{x1:S+U.x,y1:T+U.y,x2:I+U.x,y2:M+U.y,anchorPointX:N,anchorPointY:O}}class qi{constructor(o,h,d,m,_){this.transform=o.clone(),this.terrain=h,this.collisionIndex=new ze(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new sr(m),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,d,m){const _=d.getBucket(h),S=d.latestFeatureIndex;if(!_||!S||h.id!==_.layerIds[0])return;const I=d.collisionBoxArray,T=_.layers[0].layout,M=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),N=d.tileSize/u.W,O=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),U=T.get("text-pitch-alignment")==="map",$=T.get("text-rotation-alignment")==="map",Q=Ae(d,1,this.transform.zoom),nt=Oe(O,U,$,this.transform,Q);let Z=null;if(U){const It=Ha(O,U,$,this.transform,Q);Z=u.K([],this.transform.labelPlaneMatrix,It)}this.retainedQueryData[_.bucketInstanceId]=new qe(_.bucketInstanceId,S,_.sourceLayerIndex,_.index,d.tileID);const ct={bucket:_,layout:T,posMatrix:O,textLabelPlaneMatrix:nt,labelToScreenMatrix:Z,scale:M,textPixelRatio:N,holdingForFade:d.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:u.ag(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(m)for(const It of _.sortKeyRanges){const{sortKey:it,symbolInstanceStart:mt,symbolInstanceEnd:Et}=It;o.push({sortKey:it,symbolInstanceStart:mt,symbolInstanceEnd:Et,parameters:ct})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ct})}attemptAnchorPlacement(o,h,d,m,_,S,I,T,M,N,O,U,$,Q,nt,Z){const ct=u.ap[o.textAnchor],It=[o.textOffset0,o.textOffset1],it=Fr(ct,d,m,It,_),mt=this.collisionIndex.placeCollisionBox(Pi(h,it.x,it.y,S,I,this.transform.angle),O,T,M,N.predicate,Z);if((!nt||this.collisionIndex.placeCollisionBox(Pi(nt,it.x,it.y,S,I,this.transform.angle),O,T,M,N.predicate,Z).box.length!==0)&&mt.box.length>0){let Et;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(Et=this.prevPlacement.variableOffsets[U.crossTileID].anchor),U.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:It,width:d,height:m,anchor:ct,textBoxScale:_,prevAnchor:Et},this.markUsedJustification($,ct,U,Q),$.allowVerticalPlacement&&(this.markUsedOrientation($,Q,U),this.placedOrientations[U.crossTileID]=Q),{shift:it,placedGlyphBoxes:mt}}}placeLayerBucketPart(o,h,d){const{bucket:m,layout:_,posMatrix:S,textLabelPlaneMatrix:I,labelToScreenMatrix:T,textPixelRatio:M,holdingForFade:N,collisionBoxArray:O,partiallyEvaluatedTextSize:U,collisionGroup:$}=o.parameters,Q=_.get("text-optional"),nt=_.get("icon-optional"),Z=u.aq(_,"text-overlap","text-allow-overlap"),ct=Z==="always",It=u.aq(_,"icon-overlap","icon-allow-overlap"),it=It==="always",mt=_.get("text-rotation-alignment")==="map",Et=_.get("text-pitch-alignment")==="map",Pt=_.get("icon-text-fit")!=="none",Dt=_.get("symbol-z-order")==="viewport-y",Bt=ct&&(it||!m.hasIconData()||nt),Ft=it&&(ct||!m.hasTextData()||Q);!m.collisionArrays&&O&&m.deserializeCollisionBoxes(O);const jt=this.retainedQueryData[m.bucketInstanceId].tileID,Xt=this.terrain?(Kt,Se)=>this.terrain.getElevation(jt,Kt,Se):null,Fe=(Kt,Se)=>{var Be,ln;if(h[Kt.crossTileID])return;if(N)return void(this.placements[Kt.crossTileID]=new Zn(!1,!1,!1));let Le=!1,je=!1,He=!0,ur=null,Pn={box:null,offscreen:null},uo={box:null,offscreen:null},Br=null,er=null,Vr=null,co=0,_s=0,Ia=0;Se.textFeatureIndex?co=Se.textFeatureIndex:Kt.useRuntimeCollisionCircles&&(co=Kt.featureIndex),Se.verticalTextFeatureIndex&&(_s=Se.verticalTextFeatureIndex);const Bu=Se.textBox;if(Bu){const Dr=kr=>{let rr=u.ah.horizontal;if(m.allowVerticalPlacement&&!kr&&this.prevPlacement){const Do=this.prevPlacement.placedOrientations[Kt.crossTileID];Do&&(this.placedOrientations[Kt.crossTileID]=Do,rr=Do,this.markUsedOrientation(m,rr,Kt))}return rr},nr=(kr,rr)=>{if(m.allowVerticalPlacement&&Kt.numVerticalGlyphVertices>0&&Se.verticalTextBox){for(const Do of m.writingModes)if(Do===u.ah.vertical?(Pn=rr(),uo=Pn):Pn=kr(),Pn&&Pn.box&&Pn.box.length)break}else Pn=kr()},Xn=Kt.textAnchorOffsetStartIndex,Mo=Kt.textAnchorOffsetEndIndex;if(Mo===Xn){const kr=(rr,Do)=>{const Rr=this.collisionIndex.placeCollisionBox(rr,Z,M,S,$.predicate,Xt);return Rr&&Rr.box&&Rr.box.length&&(this.markUsedOrientation(m,Do,Kt),this.placedOrientations[Kt.crossTileID]=Do),Rr};nr(()=>kr(Bu,u.ah.horizontal),()=>{const rr=Se.verticalTextBox;return m.allowVerticalPlacement&&Kt.numVerticalGlyphVertices>0&&rr?kr(rr,u.ah.vertical):{box:null,offscreen:null}}),Dr(Pn&&Pn.box&&Pn.box.length)}else{let kr=u.ap[(ln=(Be=this.prevPlacement)===null||Be===void 0?void 0:Be.variableOffsets[Kt.crossTileID])===null||ln===void 0?void 0:ln.anchor];const rr=(Rr,gr,kp)=>{const Nd=Rr.x2-Rr.x1,nl=Rr.y2-Rr.y1,rl=Kt.textBoxScale,th=Pt&&It==="never"?gr:null;let Ca={box:[],offscreen:!1},Rp=Z==="never"?1:2,Od="never";kr&&Rp++;for(let Np=0;Np<Rp;Np++){for(let Op=Xn;Op<Mo;Op++){const eh=m.textAnchorOffsets.get(Op);if(kr&&eh.textAnchor!==kr)continue;const zp=this.attemptAnchorPlacement(eh,Rr,Nd,nl,rl,mt,Et,M,S,$,Od,Kt,m,kp,th,Xt);if(zp&&(Ca=zp.placedGlyphBoxes,Ca&&Ca.box&&Ca.box.length))return Le=!0,ur=zp.shift,Ca}kr?kr=null:Od=Z}return Ca};nr(()=>rr(Bu,Se.iconBox,u.ah.horizontal),()=>{const Rr=Se.verticalTextBox;return m.allowVerticalPlacement&&!(Pn&&Pn.box&&Pn.box.length)&&Kt.numVerticalGlyphVertices>0&&Rr?rr(Rr,Se.verticalIconBox,u.ah.vertical):{box:null,offscreen:null}}),Pn&&(Le=Pn.box,He=Pn.offscreen);const Do=Dr(Pn&&Pn.box);if(!Le&&this.prevPlacement){const Rr=this.prevPlacement.variableOffsets[Kt.crossTileID];Rr&&(this.variableOffsets[Kt.crossTileID]=Rr,this.markUsedJustification(m,Rr.anchor,Kt,Do))}}}if(Br=Pn,Le=Br&&Br.box&&Br.box.length>0,He=Br&&Br.offscreen,Kt.useRuntimeCollisionCircles){const Dr=m.text.placedSymbolArray.get(Kt.centerJustifiedTextSymbolIndex),nr=u.ai(m.textSizeData,U,Dr),Xn=_.get("text-padding");er=this.collisionIndex.placeCollisionCircles(Z,Dr,m.lineVertexArray,m.glyphOffsetArray,nr,S,I,T,d,Et,$.predicate,Kt.collisionCircleDiameter,Xn,Xt),er.circles.length&&er.collisionDetected&&!d&&u.w("Collisions detected, but collision boxes are not shown"),Le=ct||er.circles.length>0&&!er.collisionDetected,He=He&&er.offscreen}if(Se.iconFeatureIndex&&(Ia=Se.iconFeatureIndex),Se.iconBox){const Dr=nr=>{const Xn=Pt&&ur?Pi(nr,ur.x,ur.y,mt,Et,this.transform.angle):nr;return this.collisionIndex.placeCollisionBox(Xn,It,M,S,$.predicate,Xt)};uo&&uo.box&&uo.box.length&&Se.verticalIconBox?(Vr=Dr(Se.verticalIconBox),je=Vr.box.length>0):(Vr=Dr(Se.iconBox),je=Vr.box.length>0),He=He&&Vr.offscreen}const Ea=Q||Kt.numHorizontalGlyphVertices===0&&Kt.numVerticalGlyphVertices===0,vs=nt||Kt.numIconVertices===0;if(Ea||vs?vs?Ea||(je=je&&Le):Le=je&&Le:je=Le=je&&Le,Le&&Br&&Br.box&&this.collisionIndex.insertCollisionBox(Br.box,Z,_.get("text-ignore-placement"),m.bucketInstanceId,uo&&uo.box&&_s?_s:co,$.ID),je&&Vr&&this.collisionIndex.insertCollisionBox(Vr.box,It,_.get("icon-ignore-placement"),m.bucketInstanceId,Ia,$.ID),er&&(Le&&this.collisionIndex.insertCollisionCircles(er.circles,Z,_.get("text-ignore-placement"),m.bucketInstanceId,co,$.ID),d)){const Dr=m.bucketInstanceId;let nr=this.collisionCircleArrays[Dr];nr===void 0&&(nr=this.collisionCircleArrays[Dr]=new Ar);for(let Xn=0;Xn<er.circles.length;Xn+=4)nr.circles.push(er.circles[Xn+0]),nr.circles.push(er.circles[Xn+1]),nr.circles.push(er.circles[Xn+2]),nr.circles.push(er.collisionDetected?1:0)}if(Kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Kt.crossTileID]=new Zn(Le||Bt,je||Ft,He||m.justReloaded),h[Kt.crossTileID]=!0};if(Dt){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Kt=m.getSortedSymbolIndexes(this.transform.angle);for(let Se=Kt.length-1;Se>=0;--Se){const Be=Kt[Se];Fe(m.symbolInstances.get(Be),m.collisionArrays[Be])}}else for(let Kt=o.symbolInstanceStart;Kt<o.symbolInstanceEnd;Kt++)Fe(m.symbolInstances.get(Kt),m.collisionArrays[Kt]);if(d&&m.bucketInstanceId in this.collisionCircleArrays){const Kt=this.collisionCircleArrays[m.bucketInstanceId];u.ar(Kt.invProjMatrix,S),Kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(o,h,d,m){let _;_=m===u.ah.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[u.as(h)];const S=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const I of S)I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=_>=0&&I!==_?0:d.crossTileID)}markUsedOrientation(o,h,d){const m=h===u.ah.horizontal||h===u.ah.horizontalOnly?h:0,_=h===u.ah.vertical?h:0,S=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const I of S)o.text.placedSymbolArray.get(I).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let d=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(o):1,_=h?h.opacities:{},S=h?h.variableOffsets:{},I=h?h.placedOrientations:{};for(const T in this.placements){const M=this.placements[T],N=_[T];N?(this.opacities[T]=new An(N,m,M.text,M.icon),d=d||M.text!==N.text.placed||M.icon!==N.icon.placed):(this.opacities[T]=new An(null,m,M.text,M.icon,M.skipFade),d=d||M.text||M.icon)}for(const T in _){const M=_[T];if(!this.opacities[T]){const N=new An(M,m,!1,!1);N.isHidden()||(this.opacities[T]=N,d=d||M.text.placed||M.icon.placed)}}for(const T in S)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=S[T]);for(const T in I)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=I[T]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const d={};for(const m of h){const _=m.getBucket(o);_&&m.latestFeatureIndex&&o.id===_.layerIds[0]&&this.updateBucketOpacities(_,d,m.collisionBoxArray)}}updateBucketOpacities(o,h,d){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const m=o.layers[0],_=m.layout,S=new An(null,0,!1,!1,!0),I=_.get("text-allow-overlap"),T=_.get("icon-allow-overlap"),M=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=_.get("text-rotation-alignment")==="map",O=_.get("text-pitch-alignment")==="map",U=_.get("icon-text-fit")!=="none",$=new An(null,0,I&&(T||!o.hasIconData()||_.get("icon-optional")),T&&(I||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&d&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(d);const Q=(nt,Z,ct)=>{for(let It=0;It<Z/4;It++)nt.opacityVertexArray.emplaceBack(ct);nt.hasVisibleVertices=nt.hasVisibleVertices||ct!==yu};for(let nt=0;nt<o.symbolInstances.length;nt++){const Z=o.symbolInstances.get(nt),{numHorizontalGlyphVertices:ct,numVerticalGlyphVertices:It,crossTileID:it}=Z;let mt=this.opacities[it];h[it]?mt=S:mt||(mt=$,this.opacities[it]=mt),h[it]=!0;const Et=Z.numIconVertices>0,Pt=this.placedOrientations[Z.crossTileID],Dt=Pt===u.ah.vertical,Bt=Pt===u.ah.horizontal||Pt===u.ah.horizontalOnly;if(ct>0||It>0){const Ft=ji(mt.text);Q(o.text,ct,Dt?yu:Ft),Q(o.text,It,Bt?yu:Ft);const jt=mt.text.isHidden();[Z.rightJustifiedTextSymbolIndex,Z.centerJustifiedTextSymbolIndex,Z.leftJustifiedTextSymbolIndex].forEach(Kt=>{Kt>=0&&(o.text.placedSymbolArray.get(Kt).hidden=jt||Dt?1:0)}),Z.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Z.verticalPlacedTextSymbolIndex).hidden=jt||Bt?1:0);const Xt=this.variableOffsets[Z.crossTileID];Xt&&this.markUsedJustification(o,Xt.anchor,Z,Pt);const Fe=this.placedOrientations[Z.crossTileID];Fe&&(this.markUsedJustification(o,"left",Z,Fe),this.markUsedOrientation(o,Fe,Z))}if(Et){const Ft=ji(mt.icon),jt=!(U&&Z.verticalPlacedIconSymbolIndex&&Dt);Z.placedIconSymbolIndex>=0&&(Q(o.icon,Z.numIconVertices,jt?Ft:yu),o.icon.placedSymbolArray.get(Z.placedIconSymbolIndex).hidden=mt.icon.isHidden()),Z.verticalPlacedIconSymbolIndex>=0&&(Q(o.icon,Z.numVerticalIconVertices,jt?yu:Ft),o.icon.placedSymbolArray.get(Z.verticalPlacedIconSymbolIndex).hidden=mt.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Ft=o.collisionArrays[nt];if(Ft){let jt=new u.P(0,0);if(Ft.textBox||Ft.verticalTextBox){let Fe=!0;if(M){const Kt=this.variableOffsets[it];Kt?(jt=Fr(Kt.anchor,Kt.width,Kt.height,Kt.textOffset,Kt.textBoxScale),N&&jt._rotate(O?this.transform.angle:-this.transform.angle)):Fe=!1}Ft.textBox&&Qr(o.textCollisionBox.collisionVertexArray,mt.text.placed,!Fe||Dt,jt.x,jt.y),Ft.verticalTextBox&&Qr(o.textCollisionBox.collisionVertexArray,mt.text.placed,!Fe||Bt,jt.x,jt.y)}const Xt=!!(!Bt&&Ft.verticalIconBox);Ft.iconBox&&Qr(o.iconCollisionBox.collisionVertexArray,mt.icon.placed,Xt,U?jt.x:0,U?jt.y:0),Ft.verticalIconBox&&Qr(o.iconCollisionBox.collisionVertexArray,mt.icon.placed,!Xt,U?jt.x:0,U?jt.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const nt=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=nt.invProjMatrix,o.placementViewportMatrix=nt.viewportMatrix,o.collisionCircleArray=nt.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const d=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*d>o}setStale(){this.stale=!0}}function Qr(y,o,h,d,m){y.emplaceBack(o?1:0,h?1:0,d||0,m||0),y.emplaceBack(o?1:0,h?1:0,d||0,m||0),y.emplaceBack(o?1:0,h?1:0,d||0,m||0),y.emplaceBack(o?1:0,h?1:0,d||0,m||0)}const fs=Math.pow(2,25),Qf=Math.pow(2,24),mg=Math.pow(2,17),Tn=Math.pow(2,16),ep=Math.pow(2,9),np=Math.pow(2,8),so=Math.pow(2,1);function ji(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const o=y.placed?1:0,h=Math.floor(127*y.opacity);return h*fs+o*Qf+h*mg+o*Tn+h*ep+o*np+h*so+o}const yu=0;class Po{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,d,m,_){const S=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(S,m,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((I,T)=>I.sortKey-T.sortKey));this._currentPartIndex<S.length;)if(h.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,_())return!0;return!1}}class Ao{constructor(o,h,d,m,_,S,I,T){this.placement=new qi(o,h,S,I,T),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(o,h,d){const m=P.now(),_=()=>!this._forceFullPlacement&&P.now()-m>2;for(;this._currentPlacementIndex>=0;){const S=h[o[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=I)&&(!S.maxzoom||S.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new Po(S)),this._inProgressLayer.continuePlacement(d[S.source],this.placement,this._showCollisionBoxes,S,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Al=512/u.W/2;class mc{constructor(o,h,d){this.tileID=o,this.bucketInstanceId=d,this._symbolsByKey={};const m=new Map;for(let _=0;_<h.length;_++){const S=h.get(_),I=S.key,T=m.get(I);T?T.push(S):m.set(I,[S])}for(const[_,S]of m){const I={positions:S.map(T=>({x:Math.floor(T.anchorX*Al),y:Math.floor(T.anchorY*Al)})),crossTileIDs:S.map(T=>T.crossTileID)};if(I.positions.length>128){const T=new u.au(I.positions.length,16,Uint16Array);for(const{x:M,y:N}of I.positions)T.add(M,N);T.finish(),delete I.positions,I.index=T}this._symbolsByKey[_]=I}}getScaledCoordinates(o,h){const{x:d,y:m,z:_}=this.tileID.canonical,{x:S,y:I,z:T}=h.canonical,M=Al/Math.pow(2,T-_),N=(I*u.W+o.anchorY)*M,O=m*u.W*Al;return{x:Math.floor((S*u.W+o.anchorX)*M-d*u.W*Al),y:Math.floor(N-O)}}findMatches(o,h,d){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let _=0;_<o.length;_++){const S=o.get(_);if(S.crossTileID)continue;const I=this._symbolsByKey[S.key];if(!I)continue;const T=this.getScaledCoordinates(S,h);if(I.index){const M=I.index.range(T.x-m,T.y-m,T.x+m,T.y+m).sort();for(const N of M){const O=I.crossTileIDs[N];if(!d[O]){d[O]=!0,S.crossTileID=O;break}}}else if(I.positions)for(let M=0;M<I.positions.length;M++){const N=I.positions[M],O=I.crossTileIDs[M];if(Math.abs(N.x-T.x)<=m&&Math.abs(N.y-T.y)<=m&&!d[O]){d[O]=!0,S.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Mr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _u{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const d in this.indexes){const m=this.indexes[d],_={};for(const S in m){const I=m[S];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),_[I.tileID.key]=I}this.indexes[d]=_}this.lng=o}addBucket(o,h,d){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let _=0;_<h.symbolInstances.length;_++)h.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const m=this.usedCrossTileIDs[o.overscaledZ];for(const _ in this.indexes){const S=this.indexes[_];if(Number(_)>o.overscaledZ)for(const I in S){const T=S[I];T.tileID.isChildOf(o)&&T.findMatches(h.symbolInstances,o,m)}else{const I=S[o.scaledTo(Number(_)).key];I&&I.findMatches(h.symbolInstances,o,m)}}for(let _=0;_<h.symbolInstances.length;_++){const S=h.symbolInstances.get(_);S.crossTileID||(S.crossTileID=d.generate(),m[S.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new mc(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const d of h.getCrossTileIDsLists())for(const m of d)delete this.usedCrossTileIDs[o][m]}removeStaleBuckets(o){let h=!1;for(const d in this.indexes){const m=this.indexes[d];for(const _ in m)o[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[_]),delete m[_],h=!0)}return h}}class _a{constructor(){this.layerIndexes={},this.crossTileIDs=new Mr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,d){let m=this.layerIndexes[o.id];m===void 0&&(m=this.layerIndexes[o.id]=new _u);let _=!1;const S={};m.handleWrapJump(d);for(const I of h){const T=I.getBucket(o);T&&o.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(I.tileID,T,this.crossTileIDs)&&(_=!0),S[T.bucketInstanceId]=!0)}return m.removeStaleBuckets(S)&&(_=!0),_}pruneUnusedLayers(o){const h={};o.forEach(d=>{h[d]=!0});for(const d in this.layerIndexes)h[d]||delete this.layerIndexes[d]}}const tr=(y,o)=>u.t(y,o&&o.filter(h=>h.identifier!=="source.canvas")),gc=u.av();class ao extends u.E{constructor(o,h={}){super(),this._rtlPluginLoaded=()=>{for(const d in this.sourceCaches){const m=this.sourceCaches[d].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[d].reload()}},this.map=o,this.dispatcher=new zn(vn(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(d,m)=>this.getGlyphs(d,m)),this.dispatcher.registerMessageHandler("GI",(d,m)=>this.getImages(d,m)),this.imageManager=new te,this.imageManager.setEventedParent(this),this.glyphManager=new ue(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ie(256,512),this.crossTileSymbolIndex=new _a,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",u.ax()),Wt().on(ya,this._rtlPluginLoaded),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const m=this.sourceCaches[d.sourceId];if(!m)return;const _=m.getSource();if(_&&_.vectorLayerIds)for(const S in this._layers){const I=this._layers[S];I.source===_.id&&this._validateLayer(I)}})}loadURL(o,h={},d){this.fire(new u.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController,u.h(m,this._loadStyleRequest).then(_=>{this._loadStyleRequest=null,this._load(_.data,h,d)}).catch(_=>{this._loadStyleRequest=null,_&&this.fire(new u.j(_))})}loadJSON(o,h={},d){this.fire(new u.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,P.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(o,h,d)}).catch(()=>{})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(gc,{validate:!1})}_load(o,h,d){var m;const _=h.transformStyle?h.transformStyle(d,o):o;if(!h.validate||!tr(this,u.x(_))){this._loaded=!0,this.stylesheet=_;for(const S in _.sources)this.addSource(S,_.sources[S],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new pe(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const o=u.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of o){const d=u.az(h);d.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=d}}_loadSprite(o,h=!1,d=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,S,I,T){return u._(this,void 0,void 0,function*(){const M=Yt(_),N=I>1?"@2x":"",O={},U={};for(const{id:$,url:Q}of M){const nt=S.transformRequest(S.normalizeSpriteURL(Q,N,".json"),"SpriteJSON");O[$]=u.h(nt,T);const Z=S.transformRequest(S.normalizeSpriteURL(Q,N,".png"),"SpriteImage");U[$]=W.getImage(Z,T)}return yield Promise.all([...Object.values(O),...Object.values(U)]),function($,Q){return u._(this,void 0,void 0,function*(){const nt={};for(const Z in $){nt[Z]={};const ct=P.getImageCanvasContext((yield Q[Z]).data),It=(yield $[Z]).data;for(const it in It){const{width:mt,height:Et,x:Pt,y:Dt,sdf:Bt,pixelRatio:Ft,stretchX:jt,stretchY:Xt,content:Fe}=It[it];nt[Z][it]={data:null,pixelRatio:Ft,sdf:Bt,stretchX:jt,stretchY:Xt,content:Fe,spriteData:{width:mt,height:Et,x:Pt,y:Dt,context:ct}}}}return nt})}(O,U)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const S in _){this._spritesImagesIds[S]=[];const I=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(T=>!(T in _)):[];for(const T of I)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in _[S]){const M=S==="default"?T:`${S}:${T}`;this._spritesImagesIds[S].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,_[S][T],!1):this.imageManager.addImage(M,_[S][T]),h&&(this._changedImages[M]=!0)}}}).catch(_=>{this._spriteRequest=null,m=_,this.fire(new u.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),d&&d(m)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const d=o.sourceLayer;if(!d)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(d)===-1)&&this.fire(new u.j(new Error(`Source layer "${d}" does not exist on source "${m.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){const h=this._serializedAllLayers();if(!o||o.length===0)return Object.values(h);const d=[];for(const m of o)h[m]&&d.push(h[m]);return d}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const h=Object.keys(this._layers);for(const d of h){const m=this._layers[d];m.type!=="custom"&&(o[d]=m.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(m.length||_.length)&&this._updateWorkerLayers(m,_);for(const S in this._updatedSources){const I=this._updatedSources[S];if(I==="reload")this._reloadSource(S);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const d={};for(const m in this.sourceCaches){const _=this.sourceCaches[m];d[m]=_.used,_.used=!1}for(const m of this._order){const _=this._layers[m];_.recalculate(o,this._availableImages),!_.isHidden(o.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const m in d){const _=this.sourceCaches[m];!!d[m]!=!!_.used&&_.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,h={}){var d;this._checkLoaded();const m=this.serialize();if(o=h.transformStyle?h.transformStyle(m,o):o,((d=h.validate)===null||d===void 0||d)&&tr(this,u.x(o)))return!1;(o=u.aA(o)).layers=u.ay(o.layers);const _=u.aB(m,o),S=this._getOperationsToPerform(_);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const I of S.operations)I();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const h=[],d=[];for(const m of o)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:d.push(m.command)}return{operations:h,unimplemented:d}}addImage(o,h){if(this.getImage(o))return this.fire(new u.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new u.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,d={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(u.x.source,`sources.${o}`,h,null,d))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[o]=new fi(o,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:o})),m.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===o)return this.fire(new u.j(new Error(`Source "${o}" cannot be removed while layer "${d}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const d=this.sourceCaches[o].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h,d={}){this._checkLoaded();const m=o.id;if(this.getLayer(m))return void this.fire(new u.j(new Error(`Layer "${m}" already exists on this map.`)));let _;if(o.type==="custom"){if(tr(this,u.aC(o)))return;_=u.az(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(m,o.source),o=u.aA(o),o=u.e(o,{source:m})),this._validate(u.x.layer,`layers.${m}`,o,{arrayIndex:-1},d))return;_=u.az(o),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}})}const S=h?this._order.indexOf(h):this._order.length;if(h&&S===-1)this.fire(new u.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(S,0,m),this._layerOrderChanged=!0,this._layers[m]=_,this._removedLayers[m]&&_.source&&_.type!=="custom"){const I=this._removedLayers[m];delete this._removedLayers[m],I.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new u.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const d=this._order.indexOf(o);this._order.splice(d,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new u.j(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(m,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const d=this._order.indexOf(o);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,d){this._checkLoaded();const m=this.getLayer(o);m?m.minzoom===h&&m.maxzoom===d||(h!=null&&(m.minzoom=h),d!=null&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h,d={}){this._checkLoaded();const m=this.getLayer(o);if(m){if(!u.aD(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(u.x.filter,`layers.${m.id}.filter`,h,null,d)||(m.filter=u.aA(h),this._updateLayer(m)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return u.aA(this.getLayer(o).filter)}setLayoutProperty(o,h,d,m={}){this._checkLoaded();const _=this.getLayer(o);_?u.aD(_.getLayoutProperty(h),d)||(_.setLayoutProperty(h,d,m),this._updateLayer(_)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const d=this.getLayer(o);if(d)return d.getLayoutProperty(h);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,d,m={}){this._checkLoaded();const _=this.getLayer(o);_?u.aD(_.getPaintProperty(h),d)||(_.setPaintProperty(h,d,m)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new u.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const d=o.source,m=o.sourceLayer,_=this.sourceCaches[d];if(_===void 0)return void this.fire(new u.j(new Error(`The source '${d}' does not exist in the map's style.`)));const S=_.getSource().type;S==="geojson"&&m?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||m?(o.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(m,o.id,h)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const d=o.source,m=this.sourceCaches[d];if(m===void 0)return void this.fire(new u.j(new Error(`The source '${d}' does not exist in the map's style.`)));const _=m.getSource().type,S=_==="vector"?o.sourceLayer:void 0;_!=="vector"||S?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(S,o.id,h):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,d=o.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||d?(o.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(d,o.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=u.aE(this.sourceCaches,_=>_.serialize()),h=this._serializeByIds(this._order),d=this.map.getTerrain()||void 0,m=this.stylesheet;return u.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:o,layers:h,terrain:d},_=>_!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=S=>this._layers[S].type==="fill-extrusion",d={},m=[];for(let S=this._order.length-1;S>=0;S--){const I=this._order[S];if(h(I)){d[I]=S;for(const T of o){const M=T[I];if(M)for(const N of M)m.push(N)}}}m.sort((S,I)=>I.intersectionZ-S.intersectionZ);const _=[];for(let S=this._order.length-1;S>=0;S--){const I=this._order[S];if(h(I))for(let T=m.length-1;T>=0;T--){const M=m[T].feature;if(d[M.layer.id]<S)break;_.push(M),m.pop()}else for(const T of o){const M=T[I];if(M)for(const N of M)_.push(N.feature)}}return _}queryRenderedFeatures(o,h,d){h&&h.filter&&this._validate(u.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new u.j(new Error("parameters.layers must be an Array."))),[];for(const I of h.layers){const T=this._layers[I];if(!T)return this.fire(new u.j(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];m[T.source]=!0}}const _=[];h.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const I in this.sourceCaches)h.layers&&!m[I]||_.push(Fn(this.sourceCaches[I],this._layers,S,o,h,d));return this.placement&&_.push(function(I,T,M,N,O,U,$){const Q={},nt=U.queryRenderedSymbols(N),Z=[];for(const ct of Object.keys(nt).map(Number))Z.push($[ct]);Z.sort(mr);for(const ct of Z){const It=ct.featureIndex.lookupSymbolFeatures(nt[ct.bucketInstanceId],T,ct.bucketIndex,ct.sourceLayerIndex,O.filter,O.layers,O.availableImages,I);for(const it in It){const mt=Q[it]=Q[it]||[],Et=It[it];Et.sort((Pt,Dt)=>{const Bt=ct.featureSortOrder;if(Bt){const Ft=Bt.indexOf(Pt.featureIndex);return Bt.indexOf(Dt.featureIndex)-Ft}return Dt.featureIndex-Pt.featureIndex});for(const Pt of Et)mt.push(Pt)}}for(const ct in Q)Q[ct].forEach(It=>{const it=It.feature,mt=M[I[ct].source].getFeatureState(it.layer["source-layer"],it.id);it.source=it.layer.source,it.layer["source-layer"]&&(it.sourceLayer=it.layer["source-layer"]),it.state=mt});return Q}(this._layers,S,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(o,h){h&&h.filter&&this._validate(u.x.filter,"querySourceFeatures.filter",h.filter,null,h);const d=this.sourceCaches[o];return d?function(m,_){const S=m.getRenderableIds().map(M=>m.getTileByID(M)),I=[],T={};for(let M=0;M<S.length;M++){const N=S[M],O=N.tileID.canonical.key;T[O]||(T[O]=!0,N.querySourceFeatures(I,_))}return I}(d,h):[]}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const S in o)if(!u.aD(o[S],d[S])){m=!0;break}if(!m)return;const _={now:P.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(_)}_validate(o,h,d,m,_={}){return(!_||_.validate!==!1)&&tr(this,o.call(u.x,u.e({key:h,style:this.serialize(),value:d,styleSpec:u.v},m)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Wt().off(ya,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const d=this.sourceCaches[h];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,d,m,_=!1){let S=!1,I=!1;const T={};for(const M of this._order){const N=this._layers[M];if(N.type!=="symbol")continue;if(!T[N.source]){const U=this.sourceCaches[N.source];T[N.source]=U.getRenderableIds(!0).map($=>U.getTileByID($)).sort(($,Q)=>Q.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(Q.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(N,T[N.source],o.center.lng);S=S||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(P.now(),o.zoom))&&(this.pauseablePlacement=new Ao(o,this.map.terrain,this._order,_,h,d,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(P.now()),I=!0),S&&this.pauseablePlacement.placement.setStale()),I||S)for(const M of this._order){const N=this._layers[M];N.type==="symbol"&&this.placement.updateLayerOpacities(N,T[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(P.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h){return u._(this,void 0,void 0,function*(){const d=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),d})}getGlyphs(o,h){return u._(this,void 0,void 0,function*(){const d=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),d})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,h={}){this._checkLoaded(),o&&this._validate(u.x.glyphs,"glyphs",o,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,h,d={},m){this._checkLoaded();const _=[{id:o,url:h}],S=[...Yt(this.stylesheet.sprite),..._];this._validate(u.x.sprite,"sprite",S,null,d)||(this.stylesheet.sprite=S,this._loadSprite(_,!0,m))}removeSprite(o){this._checkLoaded();const h=Yt(this.stylesheet.sprite);if(h.find(d=>d.id===o)){if(this._spritesImagesIds[o])for(const d of this._spritesImagesIds[o])this.imageManager.removeImage(d),this._changedImages[d]=!0;h.splice(h.findIndex(d=>d.id===o),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return Yt(this.stylesheet.sprite)}setSprite(o,h={},d){this._checkLoaded(),o&&this._validate(u.x.sprite,"sprite",o,null,h)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,d):(this._unloadSprite(),d&&d(null)))}}var yc=u.X([{name:"a_pos",type:"Int16",components:2}]),ds="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const vu={prelude:Ln(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Ln(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Ln(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Ln(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Ln("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ln(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Ln(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Ln("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Ln("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Ln("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Ln(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Ln(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Ln(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Ln(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Ln(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Ln(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Ln(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ln(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Ln(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Ln(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Ln(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Ln(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Ln(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Ln(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Ln(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Ln(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Ln("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",ds),terrainDepth:Ln("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",ds),terrainCoords:Ln("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",ds)};function Ln(y,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=o.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=_?_.concat(m):m,I={};return{fragmentSource:y=y.replace(h,(T,M,N,O,U)=>(I[U]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${N} ${O} ${U};
#else
uniform ${N} ${O} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${N} ${O} ${U} = u_${U};
#endif
`)),vertexSource:o=o.replace(h,(T,M,N,O,U)=>{const $=O==="float"?"vec2":"vec4",Q=U.match(/color/)?"color":$;return I[U]?M==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${N} ${$} a_${U};
varying ${N} ${O} ${U};
#else
uniform ${N} ${O} u_${U};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${N} ${O} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${Q}(a_${U}, u_${U}_t);
#else
    ${N} ${O} ${U} = u_${U};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${N} ${$} a_${U};
#else
uniform ${N} ${O} u_${U};
#endif
`:Q==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${N} ${O} ${U} = a_${U};
#else
    ${N} ${O} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${N} ${O} ${U} = unpack_mix_${Q}(a_${U}, u_${U}_t);
#else
    ${N} ${O} ${U} = u_${U};
#endif
`}),staticAttributes:d,staticUniforms:S}}class _c{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,d,m,_,S,I,T,M){this.context=o;let N=this.boundPaintVertexBuffers.length!==m.length;for(let O=0;!N&&O<m.length;O++)this.boundPaintVertexBuffers[O]!==m[O]&&(N=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==d||N||this.boundIndexBuffer!==_||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==M?this.freshBind(h,d,m,_,S,I,T,M):(o.bindVertexArray.set(this.vao),I&&I.bind(),_&&_.dynamicDraw&&_.bind(),T&&T.bind(),M&&M.bind())}freshBind(o,h,d,m,_,S,I,T){const M=o.numAttributes,N=this.context,O=N.gl;this.vao&&this.destroy(),this.vao=N.createVertexArray(),N.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=T,h.enableAttributes(O,o);for(const U of d)U.enableAttributes(O,o);S&&S.enableAttributes(O,o),I&&I.enableAttributes(O,o),T&&T.enableAttributes(O,o),h.bind(),h.setVertexAttribPointers(O,o,_);for(const U of d)U.bind(),U.setVertexAttribPointers(O,o,_);S&&(S.bind(),S.setVertexAttribPointers(O,o,_)),m&&m.bind(),I&&(I.bind(),I.setVertexAttribPointers(O,o,_)),T&&(T.bind(),T.setVertexAttribPointers(O,o,_)),N.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ml(y){const o=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const d=y[h].split(" ");o.push(d.pop())}return o}class va{constructor(o,h,d,m,_,S){const I=o.gl;this.program=I.createProgram();const T=Ml(h.staticAttributes),M=d?d.getBinderAttributes():[],N=T.concat(M),O=vu.prelude.staticUniforms?Ml(vu.prelude.staticUniforms):[],U=h.staticUniforms?Ml(h.staticUniforms):[],$=d?d.getBinderUniforms():[],Q=O.concat(U).concat($),nt=[];for(const Pt of Q)nt.indexOf(Pt)<0&&nt.push(Pt);const Z=d?d.defines():[];_&&Z.push("#define OVERDRAW_INSPECTOR;"),S&&Z.push("#define TERRAIN3D;");const ct=Z.concat(vu.prelude.fragmentSource,h.fragmentSource).join(`
`),It=Z.concat(vu.prelude.vertexSource,h.vertexSource).join(`
`),it=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(it,ct),I.compileShader(it),!I.getShaderParameter(it,I.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${I.getShaderInfoLog(it)}`);I.attachShader(this.program,it);const mt=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(mt,It),I.compileShader(mt),!I.getShaderParameter(mt,I.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${I.getShaderInfoLog(mt)}`);I.attachShader(this.program,mt),this.attributes={};const Et={};this.numAttributes=N.length;for(let Pt=0;Pt<this.numAttributes;Pt++)N[Pt]&&(I.bindAttribLocation(this.program,Pt,N[Pt]),this.attributes[N[Pt]]=Pt);if(I.linkProgram(this.program),!I.getProgramParameter(this.program,I.LINK_STATUS))throw new Error(`Program failed to link: ${I.getProgramInfoLog(this.program)}`);I.deleteShader(mt),I.deleteShader(it);for(let Pt=0;Pt<nt.length;Pt++){const Dt=nt[Pt];if(Dt&&!Et[Dt]){const Bt=I.getUniformLocation(this.program,Dt);Bt&&(Et[Dt]=Bt)}}this.fixedUniforms=m(o,Et),this.terrainUniforms=((Pt,Dt)=>({u_depth:new u.aG(Pt,Dt.u_depth),u_terrain:new u.aG(Pt,Dt.u_terrain),u_terrain_dim:new u.aH(Pt,Dt.u_terrain_dim),u_terrain_matrix:new u.aI(Pt,Dt.u_terrain_matrix),u_terrain_unpack:new u.aJ(Pt,Dt.u_terrain_unpack),u_terrain_exaggeration:new u.aH(Pt,Dt.u_terrain_exaggeration)}))(o,Et),this.binderUniforms=d?d.getUniforms(o,Et):[]}draw(o,h,d,m,_,S,I,T,M,N,O,U,$,Q,nt,Z,ct,It){const it=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(d),o.setStencilMode(m),o.setColorMode(_),o.setCullFace(S),T){o.activeTexture.set(it.TEXTURE2),it.bindTexture(it.TEXTURE_2D,T.depthTexture),o.activeTexture.set(it.TEXTURE3),it.bindTexture(it.TEXTURE_2D,T.texture);for(const Et in this.terrainUniforms)this.terrainUniforms[Et].set(T[Et])}for(const Et in this.fixedUniforms)this.fixedUniforms[Et].set(I[Et]);nt&&nt.setUniforms(o,this.binderUniforms,$,{zoom:Q});let mt=0;switch(h){case it.LINES:mt=2;break;case it.TRIANGLES:mt=3;break;case it.LINE_STRIP:mt=1}for(const Et of U.get()){const Pt=Et.vaos||(Et.vaos={});(Pt[M]||(Pt[M]=new _c)).bind(o,this,N,nt?nt.getPaintVertexBuffers():[],O,Et.vertexOffset,Z,ct,It),it.drawElements(h,Et.primitiveLength*mt,it.UNSIGNED_SHORT,Et.primitiveOffset*mt*2)}}}function vc(y,o,h){const d=1/Ae(h,1,o.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),_=h.tileSize*Math.pow(2,o.transform.tileZoom)/m,S=_*(h.tileID.canonical.x+h.tileID.wrap*m),I=_*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[d,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[S>>16,I>>16],u_pixel_coord_lower:[65535&S,65535&I]}}const xu=(y,o,h,d)=>{const m=o.style.light,_=m.properties.get("position"),S=[_.x,_.y,_.z],I=function(){var M=new u.A(9);return u.A!=Float32Array&&(M[1]=0,M[2]=0,M[3]=0,M[5]=0,M[6]=0,M[7]=0),M[0]=1,M[4]=1,M[8]=1,M}();m.properties.get("anchor")==="viewport"&&function(M,N){var O=Math.sin(N),U=Math.cos(N);M[0]=U,M[1]=O,M[2]=0,M[3]=-O,M[4]=U,M[5]=0,M[6]=0,M[7]=0,M[8]=1}(I,-o.transform.angle),function(M,N,O){var U=N[0],$=N[1],Q=N[2];M[0]=U*O[0]+$*O[3]+Q*O[6],M[1]=U*O[1]+$*O[4]+Q*O[7],M[2]=U*O[2]+$*O[5]+Q*O[8]}(S,S,I);const T=m.properties.get("color");return{u_matrix:y,u_lightpos:S,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+h,u_opacity:d}},gg=(y,o,h,d,m,_,S)=>u.e(xu(y,o,h,d),vc(_,o,S),{u_height_factor:-Math.pow(2,m.overscaledZ)/S.tileSize/8}),$f=y=>({u_matrix:y}),xc=(y,o,h,d)=>u.e($f(y),vc(h,o,d)),yg=(y,o)=>({u_matrix:y,u_world:o}),td=(y,o,h,d,m)=>u.e(xc(y,o,h,d),{u_world:m}),_g=(y,o,h,d)=>{const m=y.transform;let _,S;if(d.paint.get("circle-pitch-alignment")==="map"){const I=Ae(h,1,m.zoom);_=!0,S=[I,I]}else _=!1,S=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(o.posMatrix,h,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:S}},ed=(y,o,h)=>{const d=Ae(h,1,o.zoom),m=Math.pow(2,o.zoom-h.tileID.overscaledZ),_=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[o.pixelsToGLUnits[0]/(d*m),o.pixelsToGLUnits[1]/(d*m)],u_overscale_factor:_}},nd=(y,o,h=1)=>({u_matrix:y,u_color:o,u_overlay:0,u_overlay_scale:h}),bc=y=>({u_matrix:y}),rd=(y,o,h,d)=>({u_matrix:y,u_extrude_scale:Ae(o,1,h),u_intensity:d});function id(y,o){const h=Math.pow(2,o.canonical.z),d=o.canonical.y;return[new u.Y(0,d/h).toLngLat().lat,new u.Y(0,(d+1)/h).toLngLat().lat]}const wc=(y,o,h,d)=>{const m=y.transform;return{u_matrix:bu(y,o,h,d),u_ratio:1/Ae(o,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},od=(y,o,h,d,m)=>u.e(wc(y,o,h,m),{u_image:0,u_image_height:d}),Xa=(y,o,h,d,m)=>{const _=y.transform,S=lo(o,_);return{u_matrix:bu(y,o,h,m),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Ae(o,1,_.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[S,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Sc=(y,o,h,d,m,_)=>{const S=y.lineAtlas,I=lo(o,y.transform),T=h.layout.get("line-cap")==="round",M=S.getDash(d.from,T),N=S.getDash(d.to,T),O=M.width*m.fromScale,U=N.width*m.toScale;return u.e(wc(y,o,h,_),{u_patternscale_a:[I/O,-M.height/2],u_patternscale_b:[I/U,-N.height/2],u_sdfgamma:S.width/(256*Math.min(O,U)*y.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:N.y,u_mix:m.t})};function lo(y,o){return 1/Ae(y,1,o.tileZoom)}function bu(y,o,h,d){return y.translatePosMatrix(d?d.posMatrix:o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Ic=(y,o,h,d,m)=>{return{u_matrix:y,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(S=m.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(_=m.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:wu(m.paint.get("raster-hue-rotate"))};var _,S};function wu(y){y*=Math.PI/180;const o=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Su=(y,o,h,d,m,_,S,I,T,M)=>{const N=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:N.cameraToCenterDistance,u_pitch:N.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:N.width/N.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+T,u_pitch_with_map:+d,u_texsize:M,u_texture:0}},Iu=(y,o,h,d,m,_,S,I,T,M,N)=>{const O=m.transform;return u.e(Su(y,o,h,d,m,_,S,I,T,M),{u_gamma_scale:d?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+N})},Eu=(y,o,h,d,m,_,S,I,T,M)=>u.e(Iu(y,o,h,d,m,_,S,I,!0,T,!0),{u_texsize_icon:M,u_texture_icon:1}),vg=(y,o,h)=>({u_matrix:y,u_opacity:o,u_color:h}),xg=(y,o,h,d,m,_)=>u.e(function(S,I,T,M){const N=T.imageManager.getPattern(S.from.toString()),O=T.imageManager.getPattern(S.to.toString()),{width:U,height:$}=T.imageManager.getPixelSize(),Q=Math.pow(2,M.tileID.overscaledZ),nt=M.tileSize*Math.pow(2,T.transform.tileZoom)/Q,Z=nt*(M.tileID.canonical.x+M.tileID.wrap*Q),ct=nt*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:N.tl,u_pattern_br_a:N.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[U,$],u_mix:I.t,u_pattern_size_a:N.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/Ae(M,1,T.transform.tileZoom),u_pixel_coord_upper:[Z>>16,ct>>16],u_pixel_coord_lower:[65535&Z,65535&ct]}}(d,_,h,m),{u_matrix:y,u_opacity:o}),sd={fillExtrusion:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_lightpos:new u.aK(y,o.u_lightpos),u_lightintensity:new u.aH(y,o.u_lightintensity),u_lightcolor:new u.aK(y,o.u_lightcolor),u_vertical_gradient:new u.aH(y,o.u_vertical_gradient),u_opacity:new u.aH(y,o.u_opacity)}),fillExtrusionPattern:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_lightpos:new u.aK(y,o.u_lightpos),u_lightintensity:new u.aH(y,o.u_lightintensity),u_lightcolor:new u.aK(y,o.u_lightcolor),u_vertical_gradient:new u.aH(y,o.u_vertical_gradient),u_height_factor:new u.aH(y,o.u_height_factor),u_image:new u.aG(y,o.u_image),u_texsize:new u.aL(y,o.u_texsize),u_pixel_coord_upper:new u.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(y,o.u_pixel_coord_lower),u_scale:new u.aK(y,o.u_scale),u_fade:new u.aH(y,o.u_fade),u_opacity:new u.aH(y,o.u_opacity)}),fill:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix)}),fillPattern:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_image:new u.aG(y,o.u_image),u_texsize:new u.aL(y,o.u_texsize),u_pixel_coord_upper:new u.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(y,o.u_pixel_coord_lower),u_scale:new u.aK(y,o.u_scale),u_fade:new u.aH(y,o.u_fade)}),fillOutline:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_world:new u.aL(y,o.u_world)}),fillOutlinePattern:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_world:new u.aL(y,o.u_world),u_image:new u.aG(y,o.u_image),u_texsize:new u.aL(y,o.u_texsize),u_pixel_coord_upper:new u.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(y,o.u_pixel_coord_lower),u_scale:new u.aK(y,o.u_scale),u_fade:new u.aH(y,o.u_fade)}),circle:(y,o)=>({u_camera_to_center_distance:new u.aH(y,o.u_camera_to_center_distance),u_scale_with_map:new u.aG(y,o.u_scale_with_map),u_pitch_with_map:new u.aG(y,o.u_pitch_with_map),u_extrude_scale:new u.aL(y,o.u_extrude_scale),u_device_pixel_ratio:new u.aH(y,o.u_device_pixel_ratio),u_matrix:new u.aI(y,o.u_matrix)}),collisionBox:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_camera_to_center_distance:new u.aH(y,o.u_camera_to_center_distance),u_pixels_to_tile_units:new u.aH(y,o.u_pixels_to_tile_units),u_extrude_scale:new u.aL(y,o.u_extrude_scale),u_overscale_factor:new u.aH(y,o.u_overscale_factor)}),collisionCircle:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_inv_matrix:new u.aI(y,o.u_inv_matrix),u_camera_to_center_distance:new u.aH(y,o.u_camera_to_center_distance),u_viewport_size:new u.aL(y,o.u_viewport_size)}),debug:(y,o)=>({u_color:new u.aM(y,o.u_color),u_matrix:new u.aI(y,o.u_matrix),u_overlay:new u.aG(y,o.u_overlay),u_overlay_scale:new u.aH(y,o.u_overlay_scale)}),clippingMask:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix)}),heatmap:(y,o)=>({u_extrude_scale:new u.aH(y,o.u_extrude_scale),u_intensity:new u.aH(y,o.u_intensity),u_matrix:new u.aI(y,o.u_matrix)}),heatmapTexture:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_world:new u.aL(y,o.u_world),u_image:new u.aG(y,o.u_image),u_color_ramp:new u.aG(y,o.u_color_ramp),u_opacity:new u.aH(y,o.u_opacity)}),hillshade:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_image:new u.aG(y,o.u_image),u_latrange:new u.aL(y,o.u_latrange),u_light:new u.aL(y,o.u_light),u_shadow:new u.aM(y,o.u_shadow),u_highlight:new u.aM(y,o.u_highlight),u_accent:new u.aM(y,o.u_accent)}),hillshadePrepare:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_image:new u.aG(y,o.u_image),u_dimension:new u.aL(y,o.u_dimension),u_zoom:new u.aH(y,o.u_zoom),u_unpack:new u.aJ(y,o.u_unpack)}),line:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_ratio:new u.aH(y,o.u_ratio),u_device_pixel_ratio:new u.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new u.aL(y,o.u_units_to_pixels)}),lineGradient:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_ratio:new u.aH(y,o.u_ratio),u_device_pixel_ratio:new u.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new u.aL(y,o.u_units_to_pixels),u_image:new u.aG(y,o.u_image),u_image_height:new u.aH(y,o.u_image_height)}),linePattern:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_texsize:new u.aL(y,o.u_texsize),u_ratio:new u.aH(y,o.u_ratio),u_device_pixel_ratio:new u.aH(y,o.u_device_pixel_ratio),u_image:new u.aG(y,o.u_image),u_units_to_pixels:new u.aL(y,o.u_units_to_pixels),u_scale:new u.aK(y,o.u_scale),u_fade:new u.aH(y,o.u_fade)}),lineSDF:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_ratio:new u.aH(y,o.u_ratio),u_device_pixel_ratio:new u.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new u.aL(y,o.u_units_to_pixels),u_patternscale_a:new u.aL(y,o.u_patternscale_a),u_patternscale_b:new u.aL(y,o.u_patternscale_b),u_sdfgamma:new u.aH(y,o.u_sdfgamma),u_image:new u.aG(y,o.u_image),u_tex_y_a:new u.aH(y,o.u_tex_y_a),u_tex_y_b:new u.aH(y,o.u_tex_y_b),u_mix:new u.aH(y,o.u_mix)}),raster:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_tl_parent:new u.aL(y,o.u_tl_parent),u_scale_parent:new u.aH(y,o.u_scale_parent),u_buffer_scale:new u.aH(y,o.u_buffer_scale),u_fade_t:new u.aH(y,o.u_fade_t),u_opacity:new u.aH(y,o.u_opacity),u_image0:new u.aG(y,o.u_image0),u_image1:new u.aG(y,o.u_image1),u_brightness_low:new u.aH(y,o.u_brightness_low),u_brightness_high:new u.aH(y,o.u_brightness_high),u_saturation_factor:new u.aH(y,o.u_saturation_factor),u_contrast_factor:new u.aH(y,o.u_contrast_factor),u_spin_weights:new u.aK(y,o.u_spin_weights)}),symbolIcon:(y,o)=>({u_is_size_zoom_constant:new u.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aG(y,o.u_is_size_feature_constant),u_size_t:new u.aH(y,o.u_size_t),u_size:new u.aH(y,o.u_size),u_camera_to_center_distance:new u.aH(y,o.u_camera_to_center_distance),u_pitch:new u.aH(y,o.u_pitch),u_rotate_symbol:new u.aG(y,o.u_rotate_symbol),u_aspect_ratio:new u.aH(y,o.u_aspect_ratio),u_fade_change:new u.aH(y,o.u_fade_change),u_matrix:new u.aI(y,o.u_matrix),u_label_plane_matrix:new u.aI(y,o.u_label_plane_matrix),u_coord_matrix:new u.aI(y,o.u_coord_matrix),u_is_text:new u.aG(y,o.u_is_text),u_pitch_with_map:new u.aG(y,o.u_pitch_with_map),u_texsize:new u.aL(y,o.u_texsize),u_texture:new u.aG(y,o.u_texture)}),symbolSDF:(y,o)=>({u_is_size_zoom_constant:new u.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aG(y,o.u_is_size_feature_constant),u_size_t:new u.aH(y,o.u_size_t),u_size:new u.aH(y,o.u_size),u_camera_to_center_distance:new u.aH(y,o.u_camera_to_center_distance),u_pitch:new u.aH(y,o.u_pitch),u_rotate_symbol:new u.aG(y,o.u_rotate_symbol),u_aspect_ratio:new u.aH(y,o.u_aspect_ratio),u_fade_change:new u.aH(y,o.u_fade_change),u_matrix:new u.aI(y,o.u_matrix),u_label_plane_matrix:new u.aI(y,o.u_label_plane_matrix),u_coord_matrix:new u.aI(y,o.u_coord_matrix),u_is_text:new u.aG(y,o.u_is_text),u_pitch_with_map:new u.aG(y,o.u_pitch_with_map),u_texsize:new u.aL(y,o.u_texsize),u_texture:new u.aG(y,o.u_texture),u_gamma_scale:new u.aH(y,o.u_gamma_scale),u_device_pixel_ratio:new u.aH(y,o.u_device_pixel_ratio),u_is_halo:new u.aG(y,o.u_is_halo)}),symbolTextAndIcon:(y,o)=>({u_is_size_zoom_constant:new u.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aG(y,o.u_is_size_feature_constant),u_size_t:new u.aH(y,o.u_size_t),u_size:new u.aH(y,o.u_size),u_camera_to_center_distance:new u.aH(y,o.u_camera_to_center_distance),u_pitch:new u.aH(y,o.u_pitch),u_rotate_symbol:new u.aG(y,o.u_rotate_symbol),u_aspect_ratio:new u.aH(y,o.u_aspect_ratio),u_fade_change:new u.aH(y,o.u_fade_change),u_matrix:new u.aI(y,o.u_matrix),u_label_plane_matrix:new u.aI(y,o.u_label_plane_matrix),u_coord_matrix:new u.aI(y,o.u_coord_matrix),u_is_text:new u.aG(y,o.u_is_text),u_pitch_with_map:new u.aG(y,o.u_pitch_with_map),u_texsize:new u.aL(y,o.u_texsize),u_texsize_icon:new u.aL(y,o.u_texsize_icon),u_texture:new u.aG(y,o.u_texture),u_texture_icon:new u.aG(y,o.u_texture_icon),u_gamma_scale:new u.aH(y,o.u_gamma_scale),u_device_pixel_ratio:new u.aH(y,o.u_device_pixel_ratio),u_is_halo:new u.aG(y,o.u_is_halo)}),background:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_opacity:new u.aH(y,o.u_opacity),u_color:new u.aM(y,o.u_color)}),backgroundPattern:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_opacity:new u.aH(y,o.u_opacity),u_image:new u.aG(y,o.u_image),u_pattern_tl_a:new u.aL(y,o.u_pattern_tl_a),u_pattern_br_a:new u.aL(y,o.u_pattern_br_a),u_pattern_tl_b:new u.aL(y,o.u_pattern_tl_b),u_pattern_br_b:new u.aL(y,o.u_pattern_br_b),u_texsize:new u.aL(y,o.u_texsize),u_mix:new u.aH(y,o.u_mix),u_pattern_size_a:new u.aL(y,o.u_pattern_size_a),u_pattern_size_b:new u.aL(y,o.u_pattern_size_b),u_scale_a:new u.aH(y,o.u_scale_a),u_scale_b:new u.aH(y,o.u_scale_b),u_pixel_coord_upper:new u.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new u.aL(y,o.u_pixel_coord_lower),u_tile_units_to_pixels:new u.aH(y,o.u_tile_units_to_pixels)}),terrain:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_texture:new u.aG(y,o.u_texture),u_ele_delta:new u.aH(y,o.u_ele_delta)}),terrainDepth:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_ele_delta:new u.aH(y,o.u_ele_delta)}),terrainCoords:(y,o)=>({u_matrix:new u.aI(y,o.u_matrix),u_texture:new u.aG(y,o.u_texture),u_terrain_coords_id:new u.aH(y,o.u_terrain_coords_id),u_ele_delta:new u.aH(y,o.u_ele_delta)})};class bg{constructor(o,h,d){this.context=o;const m=o.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ya={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ec{constructor(o,h,d,m){this.length=h.length,this.attributes=d,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=o;const _=o.gl;this.buffer=_.createBuffer(),o.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let d=0;d<this.attributes.length;d++){const m=h.attributes[this.attributes[d].name];m!==void 0&&o.enableVertexAttribArray(m)}}setVertexAttribPointers(o,h,d){for(let m=0;m<this.attributes.length;m++){const _=this.attributes[m],S=h.attributes[_.name];S!==void 0&&o.vertexAttribPointer(S,_.components,o[Ya[_.type]],!1,this.itemSize,_.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ai=new WeakMap;function di(y){var o;if(Ai.has(y))return Ai.get(y);{const h=(o=y.getParameter(y.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return Ai.set(y,h),h}}class gn{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Cc extends gn{getDefault(){return u.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Tc extends gn{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class rp extends gn{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class ip extends gn{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Lc extends gn{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class op extends gn{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class sp extends gn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Pc extends gn{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class ad extends gn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class ld extends gn{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Dl extends gn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class wg extends gn{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Sg extends gn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class Ig extends gn{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Eg extends gn{getDefault(){return u.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Cg extends gn{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Tg extends gn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class ap extends gn{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Ac extends gn{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class lp extends gn{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class up extends gn{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class kl extends gn{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class ud extends gn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class cd extends gn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class cp extends gn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Ka extends gn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class hd extends gn{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Rl extends gn{getDefault(){return null}set(o){var h;if(o===this.current&&!this.dirty)return;const d=this.gl;di(d)?d.bindVertexArray(o):(h=d.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Nl extends gn{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class pd extends gn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class hp extends gn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class hn extends gn{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class Mc extends hn{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class Lg extends hn{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class fd extends hn{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Cu{constructor(o,h,d,m,_){this.context=o,this.width=h,this.height=d;const S=o.gl,I=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new Mc(o,I),m)this.depthAttachment=_?new fd(o,I):new Lg(o,I);else if(_)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const d=this.depthAttachment.get();d&&o.deleteRenderbuffer(d)}o.deleteFramebuffer(this.framebuffer)}}class xr{constructor(o,h,d){this.blendFunction=o,this.blendColor=h,this.mask=d}}xr.Replace=[1,0],xr.disabled=new xr(xr.Replace,u.aO.transparent,[!1,!1,!1,!1]),xr.unblended=new xr(xr.Replace,u.aO.transparent,[!0,!0,!0,!0]),xr.alphaBlended=new xr([1,771],u.aO.transparent,[!0,!0,!0,!0]);class Pg{constructor(o){var h,d;if(this.gl=o,this.clearColor=new Cc(this),this.clearDepth=new Tc(this),this.clearStencil=new rp(this),this.colorMask=new ip(this),this.depthMask=new Lc(this),this.stencilMask=new op(this),this.stencilFunc=new sp(this),this.stencilOp=new Pc(this),this.stencilTest=new ad(this),this.depthRange=new ld(this),this.depthTest=new Dl(this),this.depthFunc=new wg(this),this.blend=new Sg(this),this.blendFunc=new Ig(this),this.blendColor=new Eg(this),this.blendEquation=new Cg(this),this.cullFace=new Tg(this),this.cullFaceSide=new ap(this),this.frontFace=new Ac(this),this.program=new lp(this),this.activeTexture=new up(this),this.viewport=new kl(this),this.bindFramebuffer=new ud(this),this.bindRenderbuffer=new cd(this),this.bindTexture=new cp(this),this.bindVertexBuffer=new Ka(this),this.bindElementBuffer=new hd(this),this.bindVertexArray=new Rl(this),this.pixelStoreUnpack=new Nl(this),this.pixelStoreUnpackPremultiplyAlpha=new pd(this),this.pixelStoreUnpackFlipY=new hp(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),di(o)){this.HALF_FLOAT=o.HALF_FLOAT;const m=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=o.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(d=o.RGB16F)!==null&&d!==void 0?d:m==null?void 0:m.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const m=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new bg(this,o,h)}createVertexBuffer(o,h,d){return new Ec(this,o,h,d)}createRenderbuffer(o,h,d){const m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,o,h,d),this.bindRenderbuffer.set(null),_}createFramebuffer(o,h,d,m){return new Cu(this,o,h,d,m)}clear({color:o,depth:h,stencil:d}){const m=this.gl;let _=0;o&&(_|=m.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(_|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),d!==void 0&&(_|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),m.clear(_)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){u.aD(o.blendFunction,xr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return di(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var h;return di(this.gl)?this.gl.deleteVertexArray(o):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class an{constructor(o,h,d){this.func=o,this.mask=h,this.range=d}}an.ReadOnly=!1,an.ReadWrite=!0,an.disabled=new an(519,an.ReadOnly,[0,1]);const pp=7680;class Un{constructor(o,h,d,m,_,S){this.test=o,this.ref=h,this.mask=d,this.fail=m,this.depthFail=_,this.pass=S}}Un.disabled=new Un({func:519,mask:0},0,0,pp,pp,pp);class On{constructor(o,h,d){this.enable=o,this.mode=h,this.frontFace=d}}let Ja;function Dc(y,o,h,d,m,_,S){const I=y.context,T=I.gl,M=y.useProgram("collisionBox"),N=[];let O=0,U=0;for(let it=0;it<d.length;it++){const mt=d[it],Et=o.getTile(mt),Pt=Et.getBucket(h);if(!Pt)continue;let Dt=mt.posMatrix;m[0]===0&&m[1]===0||(Dt=y.translatePosMatrix(mt.posMatrix,Et,m,_));const Bt=S?Pt.textCollisionBox:Pt.iconCollisionBox,Ft=Pt.collisionCircleArray;if(Ft.length>0){const jt=u.F(),Xt=Dt;u.aP(jt,Pt.placementInvProjMatrix,y.transform.glCoordMatrix),u.aP(jt,jt,Pt.placementViewportMatrix),N.push({circleArray:Ft,circleOffset:U,transform:Xt,invTransform:jt,coord:mt}),O+=Ft.length/4,U=O}Bt&&M.draw(I,T.LINES,an.disabled,Un.disabled,y.colorModeForRenderPass(),On.disabled,ed(Dt,y.transform,Et),y.style.map.terrain&&y.style.map.terrain.getTerrainData(mt),h.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,null,y.transform.zoom,null,null,Bt.collisionVertexBuffer)}if(!S||!N.length)return;const $=y.useProgram("collisionCircle"),Q=new u.aQ;Q.resize(4*O),Q._trim();let nt=0;for(const it of N)for(let mt=0;mt<it.circleArray.length/4;mt++){const Et=4*mt,Pt=it.circleArray[Et+0],Dt=it.circleArray[Et+1],Bt=it.circleArray[Et+2],Ft=it.circleArray[Et+3];Q.emplace(nt++,Pt,Dt,Bt,Ft,0),Q.emplace(nt++,Pt,Dt,Bt,Ft,1),Q.emplace(nt++,Pt,Dt,Bt,Ft,2),Q.emplace(nt++,Pt,Dt,Bt,Ft,3)}(!Ja||Ja.length<2*O)&&(Ja=function(it){const mt=2*it,Et=new u.aS;Et.resize(mt),Et._trim();for(let Pt=0;Pt<mt;Pt++){const Dt=6*Pt;Et.uint16[Dt+0]=4*Pt+0,Et.uint16[Dt+1]=4*Pt+1,Et.uint16[Dt+2]=4*Pt+2,Et.uint16[Dt+3]=4*Pt+2,Et.uint16[Dt+4]=4*Pt+3,Et.uint16[Dt+5]=4*Pt+0}return Et}(O));const Z=I.createIndexBuffer(Ja,!0),ct=I.createVertexBuffer(Q,u.aR.members,!0);for(const it of N){const mt={u_matrix:it.transform,u_inv_matrix:it.invTransform,u_camera_to_center_distance:(It=y.transform).cameraToCenterDistance,u_viewport_size:[It.width,It.height]};$.draw(I,T.TRIANGLES,an.disabled,Un.disabled,y.colorModeForRenderPass(),On.disabled,mt,y.style.map.terrain&&y.style.map.terrain.getTerrainData(it.coord),h.id,ct,Z,u.$.simpleSegment(0,2*it.circleOffset,it.circleArray.length,it.circleArray.length/2),null,y.transform.zoom,null,null,null)}var It;ct.destroy(),Z.destroy()}On.disabled=new On(!1,1029,2305),On.backCCW=new On(!0,1029,2305);const fp=u.an(new Float32Array(16));function dd(y,o,h,d,m,_){const{horizontalAlign:S,verticalAlign:I}=u.at(y);return new u.P((-(S-.5)*o/m+d[0])*_,(-(I-.5)*h/m+d[1])*_)}function kc(y,o,h,d,m,_,S,I,T,M,N){const O=y.text.placedSymbolArray,U=y.text.dynamicLayoutVertexArray,$=y.icon.dynamicLayoutVertexArray,Q={};U.clear();for(let nt=0;nt<O.length;nt++){const Z=O.get(nt),ct=Z.hidden||!Z.crossTileID||y.allowVerticalPlacement&&!Z.placedOrientation?null:d[Z.crossTileID];if(ct){const It=new u.P(Z.anchorX,Z.anchorY),it=zr(It,h?S:_,N),mt=et(m.cameraToCenterDistance,it.signedDistanceFromCamera);let Et=u.ai(y.textSizeData,T,Z)*mt/u.ao;h&&(Et*=y.tilePixelRatio/I);const{width:Pt,height:Dt,anchor:Bt,textOffset:Ft,textBoxScale:jt}=ct,Xt=dd(Bt,Pt,Dt,Ft,jt,Et),Fe=h?zr(It.add(Xt),_,N).point:it.point.add(o?Xt.rotate(-m.angle):Xt),Kt=y.allowVerticalPlacement&&Z.placedOrientation===u.ah.vertical?Math.PI/2:0;for(let Se=0;Se<Z.numGlyphs;Se++)u.aj(U,Fe,Kt);M&&Z.associatedIconIndex>=0&&(Q[Z.associatedIconIndex]={shiftedAnchor:Fe,angle:Kt})}else Nt(Z.numGlyphs,U)}if(M){$.clear();const nt=y.icon.placedSymbolArray;for(let Z=0;Z<nt.length;Z++){const ct=nt.get(Z);if(ct.hidden)Nt(ct.numGlyphs,$);else{const It=Q[Z];if(It)for(let it=0;it<ct.numGlyphs;it++)u.aj($,It.shiftedAnchor,It.angle);else Nt(ct.numGlyphs,$)}}y.icon.dynamicLayoutVertexBuffer.updateData($)}y.text.dynamicLayoutVertexBuffer.updateData(U)}function Rc(y,o,h){return h.iconsInText&&o?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function Nc(y,o,h,d,m,_,S,I,T,M,N,O){const U=y.context,$=U.gl,Q=y.transform,nt=I==="map",Z=T==="map",ct=I!=="viewport"&&h.layout.get("symbol-placement")!=="point",It=nt&&!Z&&!ct,it=!h.layout.get("symbol-sort-key").isConstant();let mt=!1;const Et=y.depthModeForSublayer(0,an.ReadOnly),Pt=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Dt=[];for(const Bt of d){const Ft=o.getTile(Bt),jt=Ft.getBucket(h);if(!jt)continue;const Xt=m?jt.text:jt.icon;if(!Xt||!Xt.segments.get().length||!Xt.hasVisibleVertices)continue;const Fe=Xt.programConfigurations.get(h.id),Kt=m||jt.sdfIcons,Se=m?jt.textSizeData:jt.iconSizeData,Be=Z||Q.pitch!==0,ln=y.useProgram(Rc(Kt,m,jt),Fe),Le=u.ag(Se,Q.zoom),je=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Bt);let He,ur,Pn,uo,Br=[0,0],er=null;if(m)ur=Ft.glyphAtlasTexture,Pn=$.LINEAR,He=Ft.glyphAtlasTexture.size,jt.iconsInText&&(Br=Ft.imageAtlasTexture.size,er=Ft.imageAtlasTexture,uo=Be||y.options.rotating||y.options.zooming||Se.kind==="composite"||Se.kind==="camera"?$.LINEAR:$.NEAREST);else{const kr=h.layout.get("icon-size").constantOr(0)!==1||jt.iconsNeedLinear;ur=Ft.imageAtlasTexture,Pn=Kt||y.options.rotating||y.options.zooming||kr||Be?$.LINEAR:$.NEAREST,He=Ft.imageAtlasTexture.size}const Vr=Ae(Ft,1,y.transform.zoom),co=Oe(Bt.posMatrix,Z,nt,y.transform,Vr),_s=Ha(Bt.posMatrix,Z,nt,y.transform,Vr),Ia=Pt&&jt.hasTextData(),Bu=h.layout.get("icon-text-fit")!=="none"&&Ia&&jt.hasIconData();if(ct){const kr=y.style.map.terrain?(Do,Rr)=>y.style.map.terrain.getElevation(Bt,Do,Rr):null,rr=h.layout.get("text-rotation-alignment")==="map";B(jt,Bt.posMatrix,y,m,co,_s,Z,M,rr,kr)}const Ea=y.translatePosMatrix(Bt.posMatrix,Ft,_,S),vs=ct||m&&Pt||Bu?fp:co,Dr=y.translatePosMatrix(_s,Ft,_,S,!0),nr=Kt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Xn;Xn=Kt?jt.iconsInText?Eu(Se.kind,Le,It,Z,y,Ea,vs,Dr,He,Br):Iu(Se.kind,Le,It,Z,y,Ea,vs,Dr,m,He,!0):Su(Se.kind,Le,It,Z,y,Ea,vs,Dr,m,He);const Mo={program:ln,buffers:Xt,uniformValues:Xn,atlasTexture:ur,atlasTextureIcon:er,atlasInterpolation:Pn,atlasInterpolationIcon:uo,isSDF:Kt,hasHalo:nr};if(it&&jt.canOverlap){mt=!0;const kr=Xt.segments.get();for(const rr of kr)Dt.push({segments:new u.$([rr]),sortKey:rr.sortKey,state:Mo,terrainData:je})}else Dt.push({segments:Xt.segments,sortKey:0,state:Mo,terrainData:je})}mt&&Dt.sort((Bt,Ft)=>Bt.sortKey-Ft.sortKey);for(const Bt of Dt){const Ft=Bt.state;if(U.activeTexture.set($.TEXTURE0),Ft.atlasTexture.bind(Ft.atlasInterpolation,$.CLAMP_TO_EDGE),Ft.atlasTextureIcon&&(U.activeTexture.set($.TEXTURE1),Ft.atlasTextureIcon&&Ft.atlasTextureIcon.bind(Ft.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),Ft.isSDF){const jt=Ft.uniformValues;Ft.hasHalo&&(jt.u_is_halo=1,md(Ft.buffers,Bt.segments,h,y,Ft.program,Et,N,O,jt,Bt.terrainData)),jt.u_is_halo=0}md(Ft.buffers,Bt.segments,h,y,Ft.program,Et,N,O,Ft.uniformValues,Bt.terrainData)}}function md(y,o,h,d,m,_,S,I,T,M){const N=d.context;m.draw(N,N.gl.TRIANGLES,_,S,I,On.disabled,T,M,h.id,y.layoutVertexBuffer,y.indexBuffer,o,h.paint,d.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function Oc(y,o,h,d,m){if(!h||!d||!d.imageAtlas)return;const _=d.imageAtlas.patternPositions;let S=_[h.to.toString()],I=_[h.from.toString()];if(!S&&I&&(S=I),!I&&S&&(I=S),!S||!I){const T=m.getPaintProperty(o);S=_[T],I=_[T]}S&&I&&y.setConstantPatternPositions(S,I)}function gd(y,o,h,d,m,_,S){const I=y.context.gl,T="fill-pattern",M=h.paint.get(T),N=M&&M.constantOr(1),O=h.getCrossfadeParameters();let U,$,Q,nt,Z;S?($=N&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=I.LINES):($=N?"fillPattern":"fill",U=I.TRIANGLES);const ct=M.constantOr(null);for(const It of d){const it=o.getTile(It);if(N&&!it.patternsLoaded())continue;const mt=it.getBucket(h);if(!mt)continue;const Et=mt.programConfigurations.get(h.id),Pt=y.useProgram($,Et),Dt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(It);N&&(y.context.activeTexture.set(I.TEXTURE0),it.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Et.updatePaintBuffers(O)),Oc(Et,T,ct,it,h);const Bt=Dt?It:null,Ft=y.translatePosMatrix(Bt?Bt.posMatrix:It.posMatrix,it,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(S){nt=mt.indexBuffer2,Z=mt.segments2;const jt=[I.drawingBufferWidth,I.drawingBufferHeight];Q=$==="fillOutlinePattern"&&N?td(Ft,y,O,it,jt):yg(Ft,jt)}else nt=mt.indexBuffer,Z=mt.segments,Q=N?xc(Ft,y,O,it):$f(Ft);Pt.draw(y.context,U,m,y.stencilModeForClipping(It),_,On.disabled,Q,Dt,h.id,mt.layoutVertexBuffer,nt,Z,h.paint,y.transform.zoom,Et)}}function zc(y,o,h,d,m,_,S){const I=y.context,T=I.gl,M="fill-extrusion-pattern",N=h.paint.get(M),O=N.constantOr(1),U=h.getCrossfadeParameters(),$=h.paint.get("fill-extrusion-opacity"),Q=N.constantOr(null);for(const nt of d){const Z=o.getTile(nt),ct=Z.getBucket(h);if(!ct)continue;const It=y.style.map.terrain&&y.style.map.terrain.getTerrainData(nt),it=ct.programConfigurations.get(h.id),mt=y.useProgram(O?"fillExtrusionPattern":"fillExtrusion",it);O&&(y.context.activeTexture.set(T.TEXTURE0),Z.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),it.updatePaintBuffers(U)),Oc(it,M,Q,Z,h);const Et=y.translatePosMatrix(nt.posMatrix,Z,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),Pt=h.paint.get("fill-extrusion-vertical-gradient"),Dt=O?gg(Et,y,Pt,$,nt,U,Z):xu(Et,y,Pt,$);mt.draw(I,I.gl.TRIANGLES,m,_,S,On.backCCW,Dt,It,h.id,ct.layoutVertexBuffer,ct.indexBuffer,ct.segments,h.paint,y.transform.zoom,it,y.style.map.terrain&&ct.centroidVertexBuffer)}}function Fc(y,o,h,d,m,_,S){const I=y.context,T=I.gl,M=h.fbo;if(!M)return;const N=y.useProgram("hillshade"),O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(o);I.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,M.colorAttachment.get()),N.draw(I,T.TRIANGLES,m,_,S,On.disabled,((U,$,Q,nt)=>{const Z=Q.paint.get("hillshade-shadow-color"),ct=Q.paint.get("hillshade-highlight-color"),It=Q.paint.get("hillshade-accent-color");let it=Q.paint.get("hillshade-illumination-direction")*(Math.PI/180);Q.paint.get("hillshade-illumination-anchor")==="viewport"&&(it-=U.transform.angle);const mt=!U.options.moving;return{u_matrix:nt?nt.posMatrix:U.transform.calculatePosMatrix($.tileID.toUnwrapped(),mt),u_image:0,u_latrange:id(0,$.tileID),u_light:[Q.paint.get("hillshade-exaggeration"),it],u_shadow:Z,u_highlight:ct,u_accent:It}})(y,h,d,O?o:null),O,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function dp(y,o,h,d,m,_){const S=y.context,I=S.gl,T=o.dem;if(T&&T.data){const M=T.dim,N=T.stride,O=T.getPixels();if(S.activeTexture.set(I.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||y.getTileTexture(N),o.demTexture){const $=o.demTexture;$.update(O,{premultiply:!1}),$.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else o.demTexture=new J(S,O,I.RGBA,{premultiply:!1}),o.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);S.activeTexture.set(I.TEXTURE0);let U=o.fbo;if(!U){const $=new J(S,{width:M,height:M,data:null},I.RGBA);$.bind(I.LINEAR,I.CLAMP_TO_EDGE),U=o.fbo=S.createFramebuffer(M,M,!0,!1),U.colorAttachment.set($.texture)}S.bindFramebuffer.set(U.framebuffer),S.viewport.set([0,0,M,M]),y.useProgram("hillshadePrepare").draw(S,I.TRIANGLES,d,m,_,On.disabled,(($,Q)=>{const nt=Q.stride,Z=u.F();return u.aN(Z,0,u.W,-u.W,0,0,1),u.H(Z,Z,[0,-u.W,0]),{u_matrix:Z,u_image:1,u_dimension:[nt,nt],u_zoom:$.overscaledZ,u_unpack:Q.getUnpackVector()}})(o.tileID,T),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function yd(y,o,h,d,m,_){const S=d.paint.get("raster-fade-duration");if(!_&&S>0){const I=P.now(),T=(I-y.timeAdded)/S,M=o?(I-o.timeAdded)/S:-1,N=h.getSource(),O=m.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),U=!o||Math.abs(o.tileID.overscaledZ-O)>Math.abs(y.tileID.overscaledZ-O),$=U&&y.refreshedUponExpiration?1:u.ac(U?T:1-M,0,1);return y.refreshedUponExpiration&&T>=1&&(y.refreshedUponExpiration=!1),o?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}const _d=new u.aO(1,0,0,1),Bc=new u.aO(0,1,0,1),mp=new u.aO(0,0,1,1),Ag=new u.aO(1,0,1,1),vd=new u.aO(0,1,1,1);function ar(y,o,h,d){Mi(y,0,o+h/2,y.transform.width,h,d)}function xa(y,o,h,d){Mi(y,o-h/2,0,h,y.transform.height,d)}function Mi(y,o,h,d,m,_){const S=y.context,I=S.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*y.pixelRatio,h*y.pixelRatio,d*y.pixelRatio,m*y.pixelRatio),S.clear({color:_}),I.disable(I.SCISSOR_TEST)}function gp(y,o,h){const d=y.context,m=d.gl,_=h.posMatrix,S=y.useProgram("debug"),I=an.disabled,T=Un.disabled,M=y.colorModeForRenderPass(),N="$debug",O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);d.activeTexture.set(m.TEXTURE0);const U=o.getTileByID(h.key).latestRawTileData,$=Math.floor((U&&U.byteLength||0)/1024),Q=o.getTile(h).tileSize,nt=512/Math.min(Q,512)*(h.overscaledZ/y.transform.zoom)*.5;let Z=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Z+=` => ${h.overscaledZ}`),function(ct,It){ct.initDebugOverlayCanvas();const it=ct.debugOverlayCanvas,mt=ct.context.gl,Et=ct.debugOverlayCanvas.getContext("2d");Et.clearRect(0,0,it.width,it.height),Et.shadowColor="white",Et.shadowBlur=2,Et.lineWidth=1.5,Et.strokeStyle="white",Et.textBaseline="top",Et.font="bold 36px Open Sans, sans-serif",Et.fillText(It,5,5),Et.strokeText(It,5,5),ct.debugOverlayTexture.update(it),ct.debugOverlayTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE)}(y,`${Z} ${$}kB`),S.draw(d,m.TRIANGLES,I,T,xr.alphaBlended,On.disabled,nd(_,u.aO.transparent,nt),null,N,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),S.draw(d,m.LINE_STRIP,I,T,M,On.disabled,nd(_,u.aO.red),O,N,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Vc(y,o,h){const d=y.context,m=d.gl,_=y.colorModeForRenderPass(),S=new an(m.LEQUAL,an.ReadWrite,y.depthRangeFor3D),I=y.useProgram("terrain"),T=o.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,y.width,y.height]);for(const M of h){const N=y.renderToTexture.getTexture(M),O=o.getTerrainData(M.tileID);d.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,N.texture);const U={u_matrix:y.transform.calculatePosMatrix(M.tileID.toUnwrapped()),u_texture:0,u_ele_delta:o.getMeshFrameDelta(y.transform.zoom)};I.draw(d,m.TRIANGLES,S,Un.disabled,_,On.backCCW,U,O,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class xd{constructor(o,h){this.context=new Pg(o),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=fi.maxUnderzooming+fi.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new _a}resize(o,h,d){if(this.width=Math.floor(o*d),this.height=Math.floor(h*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const o=this.context,h=new u.aV;h.emplaceBack(0,0),h.emplaceBack(u.W,0),h.emplaceBack(0,u.W),h.emplaceBack(u.W,u.W),this.tileExtentBuffer=o.createVertexBuffer(h,yc.members),this.tileExtentSegments=u.$.simpleSegment(0,0,4,2);const d=new u.aV;d.emplaceBack(0,0),d.emplaceBack(u.W,0),d.emplaceBack(0,u.W),d.emplaceBack(u.W,u.W),this.debugBuffer=o.createVertexBuffer(d,yc.members),this.debugSegments=u.$.simpleSegment(0,0,4,5);const m=new u.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(u.W,0,u.W,0),m.emplaceBack(0,u.W,0,u.W),m.emplaceBack(u.W,u.W,u.W,u.W),this.rasterBoundsBuffer=o.createVertexBuffer(m,Qe.members),this.rasterBoundsSegments=u.$.simpleSegment(0,0,4,2);const _=new u.aV;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(_,yc.members),this.viewportSegments=u.$.simpleSegment(0,0,4,2);const S=new u.aW;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(S);const I=new u.aX;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(I);const T=this.context.gl;this.stencilClearMode=new Un({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=u.F();u.aN(d,0,this.width,this.height,0,0,1),u.J(d,d,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,an.disabled,this.stencilClearMode,xr.disabled,On.disabled,bc(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const d=this.context,m=d.gl;this.nextStencilID+h.length>256&&this.clearStencil(),d.setColorMode(xr.disabled),d.setDepthMode(an.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of h){const I=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);_.draw(d,m.TRIANGLES,an.disabled,new Un({func:m.ALWAYS,mask:0},I,255,m.KEEP,m.KEEP,m.REPLACE),xr.disabled,On.disabled,bc(S.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new Un({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new Un({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,d=o.sort((S,I)=>I.overscaledZ-S.overscaledZ),m=d[d.length-1].overscaledZ,_=d[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const S={};for(let I=0;I<_;I++)S[I+m]=new Un({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=_,[S,d]}return[{[m]:Un.disabled},d]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new xr([o.CONSTANT_COLOR,o.ONE],new u.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?xr.unblended:xr.alphaBlended}depthModeForSublayer(o,h,d){if(!this.opaquePassEnabledForLayer())return an.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new an(d||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(P.now()),this.imageManager.beginFrame();const d=this.style._order,m=this.style.sourceCaches,_={},S={},I={};for(const T in m){const M=m[T];M.used&&M.prepare(this.context),_[T]=M.getVisibleCoordinates(),S[T]=_[T].slice().reverse(),I[T]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<d.length;T++)if(this.style._layers[d[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of d){const M=this.style._layers[T];if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const N=S[M.source];(M.type==="custom"||N.length)&&this.renderLayer(this,m[M.source],M,N)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?u.aO.black:u.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[d[this.currentLayer]],M=m[T.source],N=_[T.source];this._renderTileClippingMasks(T,N),this.renderLayer(this,M,T,N)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const T=this.style._layers[d[this.currentLayer]],M=m[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const N=(T.type==="symbol"?I:S)[T.source];this._renderTileClippingMasks(T,_[T.source]),this.renderLayer(this,M,T,N)}if(this.options.showTileBoundaries){const T=function(M,N){let O=null;const U=Object.values(M._layers).flatMap(Z=>Z.source&&!Z.isHidden(N)?[M.sourceCaches[Z.source]]:[]),$=U.filter(Z=>Z.getSource().type==="vector"),Q=U.filter(Z=>Z.getSource().type!=="vector"),nt=Z=>{(!O||O.getSource().maxzoom<Z.getSource().maxzoom)&&(O=Z)};return $.forEach(Z=>nt(Z)),O||Q.forEach(Z=>nt(Z)),O}(this.style,this.transform.zoom);T&&function(M,N,O){for(let U=0;U<O.length;U++)gp(M,N,O[U])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const M=T.transform.padding;ar(T,T.transform.height-(M.top||0),3,_d),ar(T,M.bottom||0,3,Bc),xa(T,M.left||0,3,mp),xa(T,T.transform.width-(M.right||0),3,Ag);const N=T.transform.centerPoint;(function(O,U,$,Q){Mi(O,U-1,$-10,2,20,Q),Mi(O,U-10,$-1,20,2,Q)})(T,N.x,T.transform.height-N.y,vd)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,d=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=o?!u.aY(h,d):!u.aZ(h,d)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(u.a_(h,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,S){const I=_.context,T=I.gl,M=xr.unblended,N=new an(T.LEQUAL,an.ReadWrite,[0,1]),O=S.getTerrainMesh(),U=S.sourceCache.getRenderableTiles(),$=_.useProgram("terrainDepth");I.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),I.clear({color:u.aO.transparent,depth:1});for(const Q of U){const nt=S.getTerrainData(Q.tileID),Z={u_matrix:_.transform.calculatePosMatrix(Q.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(_.transform.zoom)};$.draw(I,T.TRIANGLES,N,Un.disabled,M,On.backCCW,Z,nt,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,S){const I=_.context,T=I.gl,M=xr.unblended,N=new an(T.LEQUAL,an.ReadWrite,[0,1]),O=S.getTerrainMesh(),U=S.getCoordsTexture(),$=S.sourceCache.getRenderableTiles(),Q=_.useProgram("terrainCoords");I.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),I.clear({color:u.aO.transparent,depth:1}),S.coordsIndex=[];for(const nt of $){const Z=S.getTerrainData(nt.tileID);I.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,U.texture);const ct={u_matrix:_.transform.calculatePosMatrix(nt.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(_.transform.zoom)};Q.draw(I,T.TRIANGLES,N,Un.disabled,M,On.backCCW,ct,Z,"terrain",O.vertexBuffer,O.indexBuffer,O.segments),S.coordsIndex.push(nt.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(o,h,d,m){if(!d.isHidden(this.transform.zoom)&&(d.type==="background"||d.type==="custom"||(m||[]).length))switch(this.id=d.id,d.type){case"symbol":(function(_,S,I,T,M){if(_.renderPass!=="translucent")return;const N=Un.disabled,O=_.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(U,$,Q,nt,Z,ct,It){const it=$.transform,mt=Z==="map",Et=ct==="map";for(const Pt of U){const Dt=nt.getTile(Pt),Bt=Dt.getBucket(Q);if(!Bt||!Bt.text||!Bt.text.segments.get().length)continue;const Ft=u.ag(Bt.textSizeData,it.zoom),jt=Ae(Dt,1,$.transform.zoom),Xt=Oe(Pt.posMatrix,Et,mt,$.transform,jt),Fe=Q.layout.get("icon-text-fit")!=="none"&&Bt.hasIconData();if(Ft){const Kt=Math.pow(2,it.zoom-Dt.tileID.overscaledZ);kc(Bt,mt,Et,It,it,Xt,Pt.posMatrix,Kt,Ft,Fe,$.style.map.terrain?(Se,Be)=>$.style.map.terrain.getElevation(Pt,Se,Be):null)}}}(T,_,I,S,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),M),I.paint.get("icon-opacity").constantOr(1)!==0&&Nc(_,S,I,T,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),N,O),I.paint.get("text-opacity").constantOr(1)!==0&&Nc(_,S,I,T,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),N,O),S.map.showCollisionBoxes&&(Dc(_,S,I,T,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),!0),Dc(_,S,I,T,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),!1))})(o,h,d,m,this.style.placement.variableOffsets);break;case"circle":(function(_,S,I,T){if(_.renderPass!=="translucent")return;const M=I.paint.get("circle-opacity"),N=I.paint.get("circle-stroke-width"),O=I.paint.get("circle-stroke-opacity"),U=!I.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(N.constantOr(1)===0||O.constantOr(1)===0))return;const $=_.context,Q=$.gl,nt=_.depthModeForSublayer(0,an.ReadOnly),Z=Un.disabled,ct=_.colorModeForRenderPass(),It=[];for(let it=0;it<T.length;it++){const mt=T[it],Et=S.getTile(mt),Pt=Et.getBucket(I);if(!Pt)continue;const Dt=Pt.programConfigurations.get(I.id),Bt=_.useProgram("circle",Dt),Ft=Pt.layoutVertexBuffer,jt=Pt.indexBuffer,Xt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(mt),Fe={programConfiguration:Dt,program:Bt,layoutVertexBuffer:Ft,indexBuffer:jt,uniformValues:_g(_,mt,Et,I),terrainData:Xt};if(U){const Kt=Pt.segments.get();for(const Se of Kt)It.push({segments:new u.$([Se]),sortKey:Se.sortKey,state:Fe})}else It.push({segments:Pt.segments,sortKey:0,state:Fe})}U&&It.sort((it,mt)=>it.sortKey-mt.sortKey);for(const it of It){const{programConfiguration:mt,program:Et,layoutVertexBuffer:Pt,indexBuffer:Dt,uniformValues:Bt,terrainData:Ft}=it.state;Et.draw($,Q.TRIANGLES,nt,Z,ct,On.disabled,Bt,Ft,I.id,Pt,Dt,it.segments,I.paint,_.transform.zoom,mt)}})(o,h,d,m);break;case"heatmap":(function(_,S,I,T){if(I.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const M=_.context,N=M.gl,O=Un.disabled,U=new xr([N.ONE,N.ONE],u.aO.transparent,[!0,!0,!0,!0]);(function($,Q,nt){const Z=$.gl;$.activeTexture.set(Z.TEXTURE1),$.viewport.set([0,0,Q.width/4,Q.height/4]);let ct=nt.heatmapFbo;if(ct)Z.bindTexture(Z.TEXTURE_2D,ct.colorAttachment.get()),$.bindFramebuffer.set(ct.framebuffer);else{const It=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,It),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),ct=nt.heatmapFbo=$.createFramebuffer(Q.width/4,Q.height/4,!1,!1),function(it,mt,Et,Pt){var Dt,Bt;const Ft=it.gl,jt=(Dt=it.HALF_FLOAT)!==null&&Dt!==void 0?Dt:Ft.UNSIGNED_BYTE,Xt=(Bt=it.RGBA16F)!==null&&Bt!==void 0?Bt:Ft.RGBA;Ft.texImage2D(Ft.TEXTURE_2D,0,Xt,mt.width/4,mt.height/4,0,Ft.RGBA,jt,null),Pt.colorAttachment.set(Et)}($,Q,It,ct)}})(M,_,I),M.clear({color:u.aO.transparent});for(let $=0;$<T.length;$++){const Q=T[$];if(S.hasRenderableParent(Q))continue;const nt=S.getTile(Q),Z=nt.getBucket(I);if(!Z)continue;const ct=Z.programConfigurations.get(I.id),It=_.useProgram("heatmap",ct),{zoom:it}=_.transform;It.draw(M,N.TRIANGLES,an.disabled,O,U,On.disabled,rd(Q.posMatrix,nt,it,I.paint.get("heatmap-intensity")),null,I.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,I.paint,_.transform.zoom,ct)}M.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(M,N){const O=M.context,U=O.gl,$=N.heatmapFbo;if(!$)return;O.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,$.colorAttachment.get()),O.activeTexture.set(U.TEXTURE1);let Q=N.colorRampTexture;Q||(Q=N.colorRampTexture=new J(O,N.colorRamp,U.RGBA)),Q.bind(U.LINEAR,U.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(O,U.TRIANGLES,an.disabled,Un.disabled,M.colorModeForRenderPass(),On.disabled,((nt,Z,ct,It)=>{const it=u.F();u.aN(it,0,nt.width,nt.height,0,0,1);const mt=nt.context.gl;return{u_matrix:it,u_world:[mt.drawingBufferWidth,mt.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}})(M,N),null,N.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,N.paint,M.transform.zoom)}(_,I))})(o,h,d,m);break;case"line":(function(_,S,I,T){if(_.renderPass!=="translucent")return;const M=I.paint.get("line-opacity"),N=I.paint.get("line-width");if(M.constantOr(1)===0||N.constantOr(1)===0)return;const O=_.depthModeForSublayer(0,an.ReadOnly),U=_.colorModeForRenderPass(),$=I.paint.get("line-dasharray"),Q=I.paint.get("line-pattern"),nt=Q.constantOr(1),Z=I.paint.get("line-gradient"),ct=I.getCrossfadeParameters(),It=nt?"linePattern":$?"lineSDF":Z?"lineGradient":"line",it=_.context,mt=it.gl;let Et=!0;for(const Pt of T){const Dt=S.getTile(Pt);if(nt&&!Dt.patternsLoaded())continue;const Bt=Dt.getBucket(I);if(!Bt)continue;const Ft=Bt.programConfigurations.get(I.id),jt=_.context.program.get(),Xt=_.useProgram(It,Ft),Fe=Et||Xt.program!==jt,Kt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Pt),Se=Q.constantOr(null);if(Se&&Dt.imageAtlas){const Le=Dt.imageAtlas,je=Le.patternPositions[Se.to.toString()],He=Le.patternPositions[Se.from.toString()];je&&He&&Ft.setConstantPatternPositions(je,He)}const Be=Kt?Pt:null,ln=nt?Xa(_,Dt,I,ct,Be):$?Sc(_,Dt,I,$,ct,Be):Z?od(_,Dt,I,Bt.lineClipsArray.length,Be):wc(_,Dt,I,Be);if(nt)it.activeTexture.set(mt.TEXTURE0),Dt.imageAtlasTexture.bind(mt.LINEAR,mt.CLAMP_TO_EDGE),Ft.updatePaintBuffers(ct);else if($&&(Fe||_.lineAtlas.dirty))it.activeTexture.set(mt.TEXTURE0),_.lineAtlas.bind(it);else if(Z){const Le=Bt.gradients[I.id];let je=Le.texture;if(I.gradientVersion!==Le.version){let He=256;if(I.stepInterpolant){const ur=S.getSource().maxzoom,Pn=Pt.canonical.z===ur?Math.ceil(1<<_.transform.maxZoom-Pt.canonical.z):1;He=u.ac(u.aT(Bt.maxLineLength/u.W*1024*Pn),256,it.maxTextureSize)}Le.gradient=u.aU({expression:I.gradientExpression(),evaluationKey:"lineProgress",resolution:He,image:Le.gradient||void 0,clips:Bt.lineClipsArray}),Le.texture?Le.texture.update(Le.gradient):Le.texture=new J(it,Le.gradient,mt.RGBA),Le.version=I.gradientVersion,je=Le.texture}it.activeTexture.set(mt.TEXTURE0),je.bind(I.stepInterpolant?mt.NEAREST:mt.LINEAR,mt.CLAMP_TO_EDGE)}Xt.draw(it,mt.TRIANGLES,O,_.stencilModeForClipping(Pt),U,On.disabled,ln,Kt,I.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,I.paint,_.transform.zoom,Ft,Bt.layoutVertexBuffer2),Et=!1}})(o,h,d,m);break;case"fill":(function(_,S,I,T){const M=I.paint.get("fill-color"),N=I.paint.get("fill-opacity");if(N.constantOr(1)===0)return;const O=_.colorModeForRenderPass(),U=I.paint.get("fill-pattern"),$=_.opaquePassEnabledForLayer()&&!U.constantOr(1)&&M.constantOr(u.aO.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===$){const Q=_.depthModeForSublayer(1,_.renderPass==="opaque"?an.ReadWrite:an.ReadOnly);gd(_,S,I,T,Q,O,!1)}if(_.renderPass==="translucent"&&I.paint.get("fill-antialias")){const Q=_.depthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,an.ReadOnly);gd(_,S,I,T,Q,O,!0)}})(o,h,d,m);break;case"fill-extrusion":(function(_,S,I,T){const M=I.paint.get("fill-extrusion-opacity");if(M!==0&&_.renderPass==="translucent"){const N=new an(_.context.gl.LEQUAL,an.ReadWrite,_.depthRangeFor3D);if(M!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))zc(_,S,I,T,N,Un.disabled,xr.disabled),zc(_,S,I,T,N,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const O=_.colorModeForRenderPass();zc(_,S,I,T,N,Un.disabled,O)}}})(o,h,d,m);break;case"hillshade":(function(_,S,I,T){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const M=_.context,N=_.depthModeForSublayer(0,an.ReadOnly),O=_.colorModeForRenderPass(),[U,$]=_.renderPass==="translucent"?_.stencilConfigForOverlap(T):[{},T];for(const Q of $){const nt=S.getTile(Q);nt.needsHillshadePrepare!==void 0&&nt.needsHillshadePrepare&&_.renderPass==="offscreen"?dp(_,nt,I,N,Un.disabled,O):_.renderPass==="translucent"&&Fc(_,Q,nt,I,N,U[Q.overscaledZ],O)}M.viewport.set([0,0,_.width,_.height])})(o,h,d,m);break;case"raster":(function(_,S,I,T){if(_.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!T.length)return;const M=_.context,N=M.gl,O=S.getSource(),U=_.useProgram("raster"),$=_.colorModeForRenderPass(),[Q,nt]=O instanceof Or?[{},T]:_.stencilConfigForOverlap(T),Z=nt[nt.length-1].overscaledZ,ct=!_.options.moving;for(const It of nt){const it=_.depthModeForSublayer(It.overscaledZ-Z,I.paint.get("raster-opacity")===1?an.ReadWrite:an.ReadOnly,N.LESS),mt=S.getTile(It);mt.registerFadeDuration(I.paint.get("raster-fade-duration"));const Et=S.findLoadedParent(It,0),Pt=yd(mt,Et,S,I,_.transform,_.style.map.terrain);let Dt,Bt;const Ft=I.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;M.activeTexture.set(N.TEXTURE0),mt.texture.bind(Ft,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(N.TEXTURE1),Et?(Et.texture.bind(Ft,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),Dt=Math.pow(2,Et.tileID.overscaledZ-mt.tileID.overscaledZ),Bt=[mt.tileID.canonical.x*Dt%1,mt.tileID.canonical.y*Dt%1]):mt.texture.bind(Ft,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST);const jt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(It),Xt=jt?It:null,Fe=Xt?Xt.posMatrix:_.transform.calculatePosMatrix(It.toUnwrapped(),ct),Kt=Ic(Fe,Bt||[0,0],Dt||1,Pt,I);O instanceof Or?U.draw(M,N.TRIANGLES,it,Un.disabled,$,On.disabled,Kt,jt,I.id,O.boundsBuffer,_.quadTriangleIndexBuffer,O.boundsSegments):U.draw(M,N.TRIANGLES,it,Q[It.overscaledZ],$,On.disabled,Kt,jt,I.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(o,h,d,m);break;case"background":(function(_,S,I,T){const M=I.paint.get("background-color"),N=I.paint.get("background-opacity");if(N===0)return;const O=_.context,U=O.gl,$=_.transform,Q=$.tileSize,nt=I.paint.get("background-pattern");if(_.isPatternMissing(nt))return;const Z=!nt&&M.a===1&&N===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==Z)return;const ct=Un.disabled,It=_.depthModeForSublayer(0,Z==="opaque"?an.ReadWrite:an.ReadOnly),it=_.colorModeForRenderPass(),mt=_.useProgram(nt?"backgroundPattern":"background"),Et=T||$.coveringTiles({tileSize:Q,terrain:_.style.map.terrain});nt&&(O.activeTexture.set(U.TEXTURE0),_.imageManager.bind(_.context));const Pt=I.getCrossfadeParameters();for(const Dt of Et){const Bt=T?Dt.posMatrix:_.transform.calculatePosMatrix(Dt.toUnwrapped()),Ft=nt?xg(Bt,N,_,nt,{tileID:Dt,tileSize:Q},Pt):vg(Bt,N,M),jt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Dt);mt.draw(O,U.TRIANGLES,It,ct,it,On.disabled,Ft,jt,I.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(o,0,d,m);break;case"custom":(function(_,S,I){const T=_.context,M=I.implementation;if(_.renderPass==="offscreen"){const N=M.prerender;N&&(_.setCustomLayerDefaults(),T.setColorMode(_.colorModeForRenderPass()),N.call(M,T.gl,_.transform.customLayerMatrix()),T.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),T.setColorMode(_.colorModeForRenderPass()),T.setStencilMode(Un.disabled);const N=M.renderingMode==="3d"?new an(_.context.gl.LEQUAL,an.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,an.ReadOnly);T.setDepthMode(N),M.render(T.gl,_.transform.customLayerMatrix()),T.setDirty(),_.setBaseState(),T.bindFramebuffer.set(null)}})(o,0,d)}}translatePosMatrix(o,h,d,m,_){if(!d[0]&&!d[1])return o;const S=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(S){const M=Math.sin(S),N=Math.cos(S);d=[d[0]*N-d[1]*M,d[0]*M+d[1]*N]}const I=[_?d[0]:Ae(h,d[0],this.transform.zoom),_?d[1]:Ae(h,d[1],this.transform.zoom),0],T=new Float32Array(16);return u.H(T,o,I),T}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),d=this.imageManager.getPattern(o.to.toString());return!h||!d}useProgram(o,h){this.cache=this.cache||{};const d=o+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new va(this.context,vu[o],h,sd[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new J(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:h}=this.context.gl;return this.width!==o||this.height!==h}}class ba{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,d){const m=Math.pow(2,d),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const T=1/(I=u.af([],I,o))[3]/h*m;return u.a$(I,I,[T,T,1/I[3],T])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const T=function(U,$){var Q=$[0],nt=$[1],Z=$[2],ct=Q*Q+nt*nt+Z*Z;return ct>0&&(ct=1/Math.sqrt(ct)),U[0]=$[0]*ct,U[1]=$[1]*ct,U[2]=$[2]*ct,U}([],function(U,$,Q){var nt=$[0],Z=$[1],ct=$[2],It=Q[0],it=Q[1],mt=Q[2];return U[0]=Z*mt-ct*it,U[1]=ct*It-nt*mt,U[2]=nt*it-Z*It,U}([],Tt([],_[I[0]],_[I[1]]),Tt([],_[I[2]],_[I[1]]))),M=-((N=T)[0]*(O=_[I[1]])[0]+N[1]*O[1]+N[2]*O[2]);var N,O;return T.concat(M)});return new ba(_,S)}}class wa{constructor(o,h){this.min=o,this.max=h,this.center=function(d,m,_){return d[0]=.5*m[0],d[1]=.5*m[1],d[2]=.5*m[2],d}([],function(d,m,_){return d[0]=m[0]+_[0],d[1]=m[1]+_[1],d[2]=m[2]+_[2],d}([],this.min,this.max))}quadrant(o){const h=[o%2==0,o<2],d=Lt(this.min),m=Lt(this.max);for(let _=0;_<h.length;_++)d[_]=h[_]?this.min[_]:this.center[_],m[_]=h[_]?this.center[_]:this.max[_];return m[2]=this.max[2],new wa(d,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let m=0;m<o.planes.length;m++){const _=o.planes[m];let S=0;for(let I=0;I<h.length;I++)u.b0(_,h[I])>=0&&S++;if(S===0)return 0;S!==h.length&&(d=!1)}if(d)return 2;for(let m=0;m<3;m++){let _=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let I=0;I<o.points.length;I++){const T=o.points[I][m]-this.min[m];_=Math.min(_,T),S=Math.max(S,T)}if(S<0||_>this.max[m]-this.min[m])return 0}return 1}}class Ol{constructor(o=0,h=0,d=0,m=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=d,this.right=m}interpolate(o,h,d){return h.top!=null&&o.top!=null&&(this.top=u.z.number(o.top,h.top,d)),h.bottom!=null&&o.bottom!=null&&(this.bottom=u.z.number(o.bottom,h.bottom,d)),h.left!=null&&o.left!=null&&(this.left=u.z.number(o.left,h.left,d)),h.right!=null&&o.right!=null&&(this.right=u.z.number(o.right,h.right,d)),this}getCenter(o,h){const d=u.ac((this.left+o-this.right)/2,0,o),m=u.ac((this.top+h-this.bottom)/2,0,h);return new u.P(d,m)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Ol(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const yp=85.051129;class Uc{constructor(o,h,d,m,_){this.tileSize=512,this._renderWorldCopies=_===void 0||!!_,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=d??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ol,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new Uc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-u.b1(o,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var d=new u.A(4);return u.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}(),function(d,m,_){var S=m[0],I=m[1],T=m[2],M=m[3],N=Math.sin(_),O=Math.cos(_);d[0]=S*O+T*N,d[1]=I*O+M*N,d[2]=S*-N+T*O,d[3]=I*-N+M*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=u.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,d){this._unmodified=!1,this._edgeInsets.interpolate(o,h,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new u.b2(0,o)];if(this._renderWorldCopies){const d=this.pointCoordinate(new u.P(0,0)),m=this.pointCoordinate(new u.P(this.width,0)),_=this.pointCoordinate(new u.P(this.width,this.height)),S=this.pointCoordinate(new u.P(0,this.height)),I=Math.floor(Math.min(d.x,m.x,_.x,S.x)),T=Math.floor(Math.max(d.x,m.x,_.x,S.x)),M=1;for(let N=I-M;N<=T+M;N++)N!==0&&h.push(new u.b2(N,o))}return h}coveringTiles(o){var h,d;let m=this.coveringZoomLevel(o);const _=m;if(o.minzoom!==void 0&&m<o.minzoom)return[];o.maxzoom!==void 0&&m>o.maxzoom&&(m=o.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),I=u.Y.fromLngLat(this.center),T=Math.pow(2,m),M=[T*S.x,T*S.y,0],N=[T*I.x,T*I.y,0],O=ba.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let U=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(U=m);const $=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,Q=it=>({aabb:new wa([it*T,0,0],[(it+1)*T,T,0]),zoom:0,x:0,y:0,wrap:it,fullyVisible:!1}),nt=[],Z=[],ct=m,It=o.reparseOverscaled?_:m;if(this._renderWorldCopies)for(let it=1;it<=3;it++)nt.push(Q(-it)),nt.push(Q(it));for(nt.push(Q(0));nt.length>0;){const it=nt.pop(),mt=it.x,Et=it.y;let Pt=it.fullyVisible;if(!Pt){const Xt=it.aabb.intersects(O);if(Xt===0)continue;Pt=Xt===2}const Dt=o.terrain?M:N,Bt=it.aabb.distanceX(Dt),Ft=it.aabb.distanceY(Dt),jt=Math.max(Math.abs(Bt),Math.abs(Ft));if(it.zoom===ct||jt>$+(1<<ct-it.zoom)-2&&it.zoom>=U){const Xt=ct-it.zoom,Fe=M[0]-.5-(mt<<Xt),Kt=M[1]-.5-(Et<<Xt);Z.push({tileID:new u.Q(it.zoom===ct?It:it.zoom,it.wrap,it.zoom,mt,Et),distanceSq:Vt([N[0]-.5-mt,N[1]-.5-Et]),tileDistanceToCamera:Math.sqrt(Fe*Fe+Kt*Kt)})}else for(let Xt=0;Xt<4;Xt++){const Fe=(mt<<1)+Xt%2,Kt=(Et<<1)+(Xt>>1),Se=it.zoom+1;let Be=it.aabb.quadrant(Xt);if(o.terrain){const ln=new u.Q(Se,it.wrap,Se,Fe,Kt),Le=o.terrain.getMinMaxElevation(ln),je=(h=Le.minElevation)!==null&&h!==void 0?h:this.elevation,He=(d=Le.maxElevation)!==null&&d!==void 0?d:this.elevation;Be=new wa([Be.min[0],Be.min[1],je],[Be.max[0],Be.max[1],He])}nt.push({aabb:Be,zoom:Se,x:Fe,y:Kt,wrap:it.wrap,fullyVisible:Pt})}}return Z.sort((it,mt)=>it.distanceSq-mt.distanceSq).map(it=>it.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=u.ac(o.lat,-85.051129,yp);return new u.P(u.N(o.lng)*this.worldSize,u.O(h)*this.worldSize)}unproject(o){return new u.Y(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const h=this.elevation,d=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,o),_=o.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-_))return;const S=d+h-_,I=Math.cos(this._pitch)*this.cameraToCenterDistance/S/u.b3(1,m.lat),T=this.scaleZoom(I/this.tileSize);this._elevation=_,this._center=m,this.zoom=T}setLocationAtPoint(o,h){const d=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(o),S=new u.Y(_.x-(d.x-m.x),_.y-(d.y-m.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,h){return h?this.coordinatePoint(this.locationCoordinate(o),h.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,h){return this.coordinateLocation(this.pointCoordinate(o,h))}locationCoordinate(o){return u.Y.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,h){if(h){const U=h.pointCoordinate(o);if(U!=null)return U}const d=[o.x,o.y,0,1],m=[o.x,o.y,1,1];u.af(d,d,this.pixelMatrixInverse),u.af(m,m,this.pixelMatrixInverse);const _=d[3],S=m[3],I=d[1]/_,T=m[1]/S,M=d[2]/_,N=m[2]/S,O=M===N?0:(0-M)/(N-M);return new u.Y(u.z.number(d[0]/_,m[0]/S,O)/this.worldSize,u.z.number(I,T,O)/this.worldSize)}coordinatePoint(o,h=0,d=this.pixelMatrix){const m=[o.x*this.worldSize,o.y*this.worldSize,h,1];return u.af(m,m,d),new u.P(m[0]/m[3],m[1]/m[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new xt().extend(this.pointLocation(new u.P(0,o))).extend(this.pointLocation(new u.P(this.width,o))).extend(this.pointLocation(new u.P(this.width,this.height))).extend(this.pointLocation(new u.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new xt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,yp])}calculatePosMatrix(o,h=!1){const d=o.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[d])return m[d];const _=o.canonical,S=this.worldSize/this.zoomScale(_.z),I=_.x+Math.pow(2,_.z)*o.wrap,T=u.an(new Float64Array(16));return u.H(T,T,[I*S,_.y*S,0]),u.J(T,T,[S/u.W,S/u.W,1]),u.K(T,h?this.alignedProjMatrix:this.projMatrix,T),m[d]=new Float32Array(T),m[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,h){h=u.ac(+h,this.minZoom,this.maxZoom);const d={center:new u.M(o.lng,o.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const it=179.9999999999;m=[-it,it]}const _=this.tileSize*this.zoomScale(d.zoom);let S=0,I=_,T=0,M=_,N=0,O=0;const{x:U,y:$}=this.size;if(this.latRange){const it=this.latRange;S=u.O(it[1])*_,I=u.O(it[0])*_,I-S<$&&(N=$/(I-S))}m&&(T=u.b1(u.N(m[0])*_,0,_),M=u.b1(u.N(m[1])*_,0,_),M<T&&(M+=_),M-T<U&&(O=U/(M-T)));const{x:Q,y:nt}=this.project.call({worldSize:_},o);let Z,ct;const It=Math.max(O||0,N||0);if(It){const it=new u.P(O?(M+T)/2:Q,N?(I+S)/2:nt);return d.center=this.unproject.call({worldSize:_},it).wrap(),d.zoom+=this.scaleZoom(It),d}if(this.latRange){const it=$/2;nt-it<S&&(ct=S+it),nt+it>I&&(ct=I-it)}if(m){const it=(T+M)/2;let mt=Q;this._renderWorldCopies&&(mt=u.b1(Q,it-_/2,it+_/2));const Et=U/2;mt-Et<T&&(Z=T+Et),mt+Et>M&&(Z=M-Et)}if(Z!==void 0||ct!==void 0){const it=new u.P(Z??Q,ct??nt);d.center=this.unproject.call({worldSize:_},it).wrap()}return d}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:h,zoom:d}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=d,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.b3(1,this.center.lat)*this.worldSize;let m=u.an(new Float64Array(16));u.J(m,m,[this.width/2,-this.height/2,1]),u.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=u.an(new Float64Array(16)),u.J(m,m,[1,-1,1]),u.H(m,m,[-1,-1,0]),u.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),S=Math.min(this.elevation,this.minElevationForCurrentTile),I=_-S*this._pixelPerMeter/Math.cos(this._pitch),T=S<0?I:_,M=Math.PI/2+this._pitch,N=this._fov*(.5+o.y/this.height),O=Math.sin(N)*T/Math.sin(u.ac(Math.PI-M-N,.01,Math.PI-.01)),U=this.getHorizon(),$=2*Math.atan(U/this.cameraToCenterDistance)*(.5+o.y/(2*U)),Q=Math.sin($)*T/Math.sin(u.ac(Math.PI-M-$,.01,Math.PI-.01)),nt=Math.min(O,Q),Z=1.01*(Math.cos(Math.PI/2-this._pitch)*nt+T),ct=this.height/50;m=new Float64Array(16),u.b4(m,this._fov,this.width/this.height,ct,Z),m[8]=2*-o.x/this.width,m[9]=2*o.y/this.height,u.J(m,m,[1,-1,1]),u.H(m,m,[0,0,-this.cameraToCenterDistance]),u.b5(m,m,this._pitch),u.ad(m,m,this.angle),u.H(m,m,[-h,-d,0]),this.mercatorMatrix=u.J([],m,[this.worldSize,this.worldSize,this.worldSize]),u.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.K(new Float64Array(16),this.labelPlaneMatrix,m),u.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=u.ar([],m),this.pixelMatrix3D=u.K(new Float64Array(16),this.labelPlaneMatrix,m);const It=this.width%2/2,it=this.height%2/2,mt=Math.cos(this.angle),Et=Math.sin(this.angle),Pt=h-Math.round(h)+mt*It+Et*it,Dt=d-Math.round(d)+mt*it+Et*It,Bt=new Float64Array(m);if(u.H(Bt,Bt,[Pt>.5?Pt-1:Pt,Dt>.5?Dt-1:Dt,0]),this.alignedProjMatrix=Bt,m=u.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new u.P(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return u.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let d=h.x,m=h.y,_=h.x,S=h.y;for(const I of o)d=Math.min(d,I.x),m=Math.min(m,I.y),_=Math.max(_,I.x),S=Math.max(S,I.y);return[new u.P(d,m),new u.P(_,m),new u.P(_,S),new u.P(d,S),new u.P(d,m)]}}lngLatToCameraDepth(o,h){const d=this.locationCoordinate(o),m=[d.x*this.worldSize,d.y*this.worldSize,h,1];return u.af(m,m,this.projMatrix),m[2]/m[3]}}function _p(y,o){let h,d=!1,m=null,_=null;const S=()=>{m=null,d&&(y.apply(_,h),m=setTimeout(S,o),d=!1)};return(...I)=>(d=!0,_=this,h=I,m||S(),m)}class vp{constructor(o){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let d;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(d=m)}),(d&&d[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:d,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=_p(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),S=Math.round(h.lng*_)/_,I=Math.round(h.lat*_)/_,T=this._map.getBearing(),M=this._map.getPitch();let N="";if(N+=o?`/${S}/${I}/${d}`:`${d}/${I}/${S}`,(T||M)&&(N+="/"+Math.round(10*T)/10),M&&(N+=`/${Math.round(M)}`),this._hashName){const O=this._hashName;let U=!1;const $=window.location.hash.slice(1).split("&").map(Q=>{const nt=Q.split("=")[0];return nt===O?(U=!0,`${nt}=${N}`):Q}).filter(Q=>Q);return U||$.push(`${O}=${N}`),`#${$.join("&")}`}return`#${N}`}}const Tu={linearity:.3,easing:u.b6(0,0,.3,1)},Qa=u.e({deceleration:2500,maxSpeed:1400},Tu),bd=u.e({deceleration:20,maxSpeed:1400},Tu),wd=u.e({deceleration:1e3,maxSpeed:360},Tu),Sd=u.e({deceleration:1e3,maxSpeed:90},Tu);class Id{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:P.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=P.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)h.zoom+=_.zoomDelta||0,h.bearing+=_.bearingDelta||0,h.pitch+=_.pitchDelta||0,_.panDelta&&h.pan._add(_.panDelta),_.around&&(h.around=_.around),_.pinchAround&&(h.pinchAround=_.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const _=Pu(h.pan.mag(),d,u.e({},Qa,o||{}));m.offset=h.pan.mult(_.amount/h.pan.mag()),m.center=this._map.transform.center,Lu(m,_)}if(h.zoom){const _=Pu(h.zoom,d,bd);m.zoom=this._map.transform.zoom+_.amount,Lu(m,_)}if(h.bearing){const _=Pu(h.bearing,d,wd);m.bearing=this._map.transform.bearing+u.ac(_.amount,-179,179),Lu(m,_)}if(h.pitch){const _=Pu(h.pitch,d,Sd);m.pitch=this._map.transform.pitch+_.amount,Lu(m,_)}if(m.zoom||m.bearing){const _=h.pinchAround===void 0?h.around:h.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),u.e(m,{noMoveStart:!0})}}function Lu(y,o){(!y.duration||y.duration<o.duration)&&(y.duration=o.duration,y.easing=o.easing)}function Pu(y,o,h){const{maxSpeed:d,linearity:m,deceleration:_}=h,S=u.ac(y*m/(o/1e3),-d,d),I=Math.abs(S)/(_*m);return{easing:h.easing,duration:1e3*I,amount:S*(I/2)}}class Wi extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,d,m={}){const _=k.mousePos(h.getCanvas(),d),S=h.unproject(_);super(o,u.e({point:_,lngLat:S,originalEvent:d},m)),this._defaultPrevented=!1,this.target=h}}class ms extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,d){const m=o==="touchend"?d.changedTouches:d.touches,_=k.touchPos(h.getCanvasContainer(),m),S=_.map(T=>h.unproject(T)),I=_.reduce((T,M,N,O)=>T.add(M.div(O.length)),new u.P(0,0));super(o,{points:_,point:I,lngLats:S,lngLat:h.unproject(I),originalEvent:d}),this._defaultPrevented=!1}}class xp extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,d){super(o,{originalEvent:d}),this._defaultPrevented=!1}}class jo{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new xp(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new Wi(o.type,this._map,o))}mouseup(o){this._map.fire(new Wi(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new Wi(o.type,this._map,o))}dblclick(o){return this._firePreventable(new Wi(o.type,this._map,o))}mouseover(o){this._map.fire(new Wi(o.type,this._map,o))}mouseout(o){this._map.fire(new Wi(o.type,this._map,o))}touchstart(o){return this._firePreventable(new ms(o.type,this._map,o))}touchmove(o){this._map.fire(new ms(o.type,this._map,o))}touchend(o){this._map.fire(new ms(o.type,this._map,o))}touchcancel(o){this._map.fire(new ms(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gs{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new Wi(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Wi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new Wi(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zl{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(u.P.convert(o),this._map.terrain)}}class Wo{constructor(o,h){this._map=o,this._tr=new zl(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(k.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const d=h;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=d,this._box||(this._box=k.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const _=Math.min(m.x,d.x),S=Math.max(m.x,d.x),I=Math.min(m.y,d.y),T=Math.max(m.y,d.y);k.setTransform(this._box,`translate(${_}px,${I}px)`),this._box.style.width=S-_+"px",this._box.style.height=T-I+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const d=this._startPos,m=h;if(this.reset(),k.suppressClick(),d.x!==m.x||d.y!==m.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:o})),{cameraAnimation:_=>_.fitScreenCoordinates(d,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(k.remove(this._box),this._box=null),k.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new u.k(o,{originalEvent:h}))}}function $a(y,o){if(y.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${o.length}`);const h={};for(let d=0;d<y.length;d++)h[y[d].identifier]=o[d];return h}class Mg{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const _=new u.P(0,0);for(const S of m)_._add(S);return _.div(m.length)}(h),this.touches=$a(d,h)))}touchmove(o,h,d){if(this.aborted||!this.centroid)return;const m=$a(d,h);for(const _ in this.touches){const S=m[_];(!S||S.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(o,h,d){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class bp{constructor(o){this.singleTap=new Mg(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,d){this.singleTap.touchstart(o,h,d)}touchmove(o,h,d){this.singleTap.touchmove(o,h,d)}touchend(o,h,d){const m=this.singleTap.touchend(o,h,d);if(m){const _=o.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(m)<30;if(_&&S||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Dg{constructor(o){this._tr=new zl(o),this._zoomIn=new bp({numTouches:1,numTaps:2}),this._zoomOut=new bp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,d){this._zoomIn.touchstart(o,h,d),this._zoomOut.touchstart(o,h,d)}touchmove(o,h,d){this._zoomIn.touchmove(o,h,d),this._zoomOut.touchmove(o,h,d)}touchend(o,h,d){const m=this._zoomIn.touchend(o,h,d),_=this._zoomOut.touchend(o,h,d),S=this._tr;return m?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(m)},{originalEvent:o})}):_?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(_)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fl{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const h=this._moveFunction(...o);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(o,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,h){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const m=h.length?h[0]:h;return!this._moved&&m.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(d,m))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&k.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Au={0:1,2:2};class ys{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const h=k.mouseButton(o);this._eventButton=h}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(h,d){const m=Au[d];return h.buttons===void 0||(h.buttons&m)!==m}(o,this._eventButton)}isValidEndEvent(o){return k.mouseButton(o)===this._eventButton}}class ae{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const Gc=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(o){o.preventDefault()}},Bl=({enable:y,clickTolerance:o,bearingDegreesPerPixelMoved:h=.8})=>{const d=new ys({checkCorrectEvent:m=>k.mouseButton(m)===0&&m.ctrlKey||k.mouseButton(m)===2});return new Fl({clickTolerance:o,move:(m,_)=>({bearingDelta:(_.x-m.x)*h}),moveStateManager:d,enable:y,assignEvents:Gc})},Vl=({enable:y,clickTolerance:o,pitchDegreesPerPixelMoved:h=-.5})=>{const d=new ys({checkCorrectEvent:m=>k.mouseButton(m)===0&&m.ctrlKey||k.mouseButton(m)===2});return new Fl({clickTolerance:o,move:(m,_)=>({pitchDelta:(_.y-m.y)*h}),moveStateManager:d,enable:y,assignEvents:Gc})};class Ed{constructor(o,h){this._clickTolerance=o.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(o,h,d){return this._calculateTransform(o,h,d)}touchmove(o,h,d){if(this._active&&!(d.length<this.minTouchs()))return o.preventDefault(),this._calculateTransform(o,h,d)}touchend(o,h,d){this._calculateTransform(o,h,d),this._active&&d.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,d){d.length>0&&(this._active=!0);const m=$a(d,h),_=new u.P(0,0),S=new u.P(0,0);let I=0;for(const M in m){const N=m[M],O=this._touches[M];O&&(_._add(N),S._add(N.sub(O)),I++,m[M]=N)}if(this._touches=m,I<this.minTouchs()||!S.mag())return;const T=S.div(I);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(I),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ne{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,h,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,d){if(!this._firstTwoTouches)return;o.preventDefault();const[m,_]=this._firstTwoTouches,S=Ul(d,h,m),I=Ul(d,h,_);if(!S||!I)return;const T=this._aroundCenter?null:S.add(I).div(2);return this._move([S,I],T,o)}touchend(o,h,d){if(!this._firstTwoTouches)return;const[m,_]=this._firstTwoTouches,S=Ul(d,h,m),I=Ul(d,h,_);S&&I||(this._active&&k.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ul(y,o,h){for(let d=0;d<y.length;d++)if(y[d].identifier===h)return o[d]}function Cd(y,o){return Math.log(y/o)/Math.LN2}class Td extends ne{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const d=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Cd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Cd(this._distance,d),pinchAround:h}}}function qc(y,o){return 180*y.angleWith(o)/Math.PI}class wp extends ne{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h,d){const m=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:qc(this._vector,m),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,d=qc(o,this._startVector);return Math.abs(d)<h}}function jc(y){return Math.abs(y.y)>Math.abs(y.x)}class Ld extends ne{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,h,d){super.touchstart(o,h,d),this._currentTouchCount=d.length}_start(o){this._lastPoints=o,jc(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=o[0].sub(this._lastPoints[0]),_=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,_,d.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(m.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(o,h,d){if(this._valid!==void 0)return this._valid;const m=o.mag()>=2,_=h.mag()>=2;if(!m&&!_)return;if(!m||!_)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const S=o.y>0==h.y>0;return jc(o)&&jc(h)&&S}}const kg={panStep:100,bearingStep:15,pitchStep:10};class Sa{constructor(o){this._tr=new zl(o);const h=kg;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,d=0,m=0,_=0,S=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?d=-1:(o.preventDefault(),_=-1);break;case 39:o.shiftKey?d=1:(o.preventDefault(),_=1);break;case 38:o.shiftKey?m=1:(o.preventDefault(),S=-1);break;case 40:o.shiftKey?m=-1:(o.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:I=>{const T=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:Hn,zoom:h?Math.round(T.zoom)+h*(o.shiftKey?2:1):T.zoom,bearing:T.bearing+d*this._bearingStep,pitch:T.pitch+m*this._pitchStep,offset:[-_*this._panStep,-S*this._panStep],center:T.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Hn(y){return y*(2-y)}const Mu=4.000244140625;class Wc{constructor(o,h){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=o,this._tr=new zl(o),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!o[this._map.cooperativeGestures._bypassKey])return;let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const d=P.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,h!==0&&h%Mu==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=k.mousePos(this._map.getCanvas(),o),d=this._tr;this._around=h.y>d.transform.height/2-d.transform.getHorizon()?u.M.convert(this._aroundCenter?d.center:d.unproject(h)):u.M.convert(d.center),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Mu?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&T!==0&&(T=1/T);const M=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(M*T))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,d=this._startZoom,m=this._easing;let _,S=!1;if(this._type==="wheel"&&d&&m){const I=Math.min((P.now()-this._lastWheelEventTime)/200,1),T=m(I);_=u.z.number(d,h,T),I<1?this._frameId||(this._frameId=!0):S=!0}else _=h,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:_-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=u.b7;if(this._prevEase){const d=this._prevEase,m=(P.now()-d.start)/d.duration,_=d.easing(m+.01)-d.easing(m),S=.27/Math.sqrt(_*_+1e-4)*.01,I=Math.sqrt(.0729-S*S);h=u.b6(S,I,.25,1)}return this._prevEase={start:P.now(),duration:o,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Sp{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Pd{constructor(o){this._tr=new zl(o),this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ad{constructor(){this._tap=new bp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,h,d){if(!this._swipePoint)if(this._tapTime){const m=h[0],_=o.timeStamp-this._tapTime<500,S=this._tapPoint.dist(m)<30;_&&S?d.length>0&&(this._swipePoint=m,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(o,h,d)}touchmove(o,h,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=h[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,o.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(o,h,d)}touchend(o,h,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const m=this._tap.touchend(o,h,d);m&&(this._tapTime=o.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Md{constructor(o,h,d){this._el=o,this._mousePan=h,this._touchPan=d}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zo{constructor(o,h,d){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Du{constructor(o,h,d,m){this._el=o,this._touchZoom=h,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class me{constructor(o,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=k.create("div","maplibregl-cooperative-gesture-screen",o);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=d,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(k.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(o){this._onCooperativeGesture(o.touches.length===1)}wheel(o){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!o[this._bypassKey])}_onCooperativeGesture(o){this._enabled&&o&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const be=y=>y.zoom||y.drag||y.pitch||y.rotate;class Zc extends u.k{}function ku(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Ip{constructor(o,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,_)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=m.type==="renderFrame"?void 0:m,I={needsRenderFrame:!1},T={},M={},N=m.touches,O=N?this._getMapTouches(N):void 0,U=O?k.touchPos(this._map.getCanvas(),O):k.mousePos(this._map.getCanvas(),m);for(const{handlerName:nt,handler:Z,allowed:ct}of this._handlers){if(!Z.isEnabled())continue;let It;this._blockedByActive(M,ct,nt)?Z.reset():Z[_||m.type]&&(It=Z[_||m.type](m,U,O),this.mergeHandlerResult(I,T,It,nt,S),It&&It.needsRenderFrame&&this._triggerRenderFrame()),(It||Z.isActive())&&(M[nt]=Z)}const $={};for(const nt in this._previousActiveHandlers)M[nt]||($[nt]=S);this._previousActiveHandlers=M,(Object.keys($).length||ku(I))&&(this._changes.push([I,T,$]),this._triggerRenderFrame()),(Object.keys(M).length||ku(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Q}=I;Q&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Q(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Id(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,_,S]of this._listeners)k.addEventListener(m,_,m===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[o,h,d]of this._listeners)k.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(o){const h=this._map,d=h.getCanvasContainer();this._add("mapEvent",new jo(h,o));const m=h.boxZoom=new Wo(h,o);this._add("boxZoom",m),o.interactive&&o.boxZoom&&m.enable();const _=h.cooperativeGestures=new me(h,o.cooperativeGestures);this._add("cooperativeGestures",_),o.cooperativeGestures&&_.enable();const S=new Dg(h),I=new Pd(h);h.doubleClickZoom=new Sp(I,S),this._add("tapZoom",S),this._add("clickZoom",I),o.interactive&&o.doubleClickZoom&&h.doubleClickZoom.enable();const T=new Ad;this._add("tapDragZoom",T);const M=h.touchPitch=new Ld(h);this._add("touchPitch",M),o.interactive&&o.touchPitch&&h.touchPitch.enable(o.touchPitch);const N=Bl(o),O=Vl(o);h.dragRotate=new Zo(o,N,O),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]),o.interactive&&o.dragRotate&&h.dragRotate.enable();const U=(({enable:It,clickTolerance:it})=>{const mt=new ys({checkCorrectEvent:Et=>k.mouseButton(Et)===0&&!Et.ctrlKey});return new Fl({clickTolerance:it,move:(Et,Pt)=>({around:Pt,panDelta:Pt.sub(Et)}),activateOnStart:!0,moveStateManager:mt,enable:It,assignEvents:Gc})})(o),$=new Ed(o,h);h.dragPan=new Md(d,U,$),this._add("mousePan",U),this._add("touchPan",$,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&h.dragPan.enable(o.dragPan);const Q=new wp,nt=new Td;h.touchZoomRotate=new Du(d,nt,Q,T),this._add("touchRotate",Q,["touchPan","touchZoom"]),this._add("touchZoom",nt,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&h.touchZoomRotate.enable(o.touchZoomRotate);const Z=h.scrollZoom=new Wc(h,()=>this._triggerRenderFrame());this._add("scrollZoom",Z,["mousePan"]),o.interactive&&o.scrollZoom&&h.scrollZoom.enable(o.scrollZoom);const ct=h.keyboard=new Sa(h);this._add("keyboard",ct),o.interactive&&o.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new gs(h))}_add(o,h,d){this._handlers.push({handlerName:o,handler:h,allowed:d}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!be(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,d){for(const m in o)if(m!==d&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(o){const h=[];for(const d of o)this._el.contains(d.target)&&h.push(d);return h}mergeHandlerResult(o,h,d,m,_){if(!d)return;u.e(o,d);const S={handlerName:m,originalEvent:d.originalEvent||_};d.zoomDelta!==void 0&&(h.zoom=S),d.panDelta!==void 0&&(h.drag=S),d.pitchDelta!==void 0&&(h.pitch=S),d.bearingDelta!==void 0&&(h.rotate=S)}_applyChanges(){const o={},h={},d={};for(const[m,_,S]of this._changes)m.panDelta&&(o.panDelta=(o.panDelta||new u.P(0,0))._add(m.panDelta)),m.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(o.around=m.around),m.pinchAround!==void 0&&(o.pinchAround=m.pinchAround),m.noInertia&&(o.noInertia=m.noInertia),u.e(h,_),u.e(d,S);this._updateMapTransform(o,h,d),this._changes=[]}_updateMapTransform(o,h,d){const m=this._map,_=m._getTransformForUpdate(),S=m.terrain;if(!(ku(o)||S&&this._terrainMovement))return this._fireEvents(h,d,!0);let{panDelta:I,zoomDelta:T,bearingDelta:M,pitchDelta:N,around:O,pinchAround:U}=o;U!==void 0&&(O=U),m._stop(!0),O=O||m.transform.centerPoint;const $=_.pointLocation(I?O.sub(I):O);M&&(_.bearing+=M),N&&(_.pitch+=N),T&&(_.zoom+=T),S?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(I)):_.setLocationAtPoint($,O):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint($,O),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,_.recalculateZoom(m.terrain)})):_.setLocationAtPoint($,O),m._applyUpdatedTransform(_),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,d,!0)}_fireEvents(o,h,d){const m=be(this._eventsInProgress),_=be(o),S={};for(const N in o){const{originalEvent:O}=o[N];this._eventsInProgress[N]||(S[`${N}start`]=O),this._eventsInProgress[N]=o[N]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(const N in S)this._fireEvent(N,S[N]);_&&this._fireEvent("move",_.originalEvent);for(const N in o){const{originalEvent:O}=o[N];this._fireEvent(N,O)}const I={};let T;for(const N in this._eventsInProgress){const{handlerName:O,originalEvent:U}=this._eventsInProgress[N];this._handlersById[O].isActive()||(delete this._eventsInProgress[N],T=h[O]||U,I[`${N}end`]=T)}for(const N in I)this._fireEvent(N,I[N]);const M=be(this._eventsInProgress);if(d&&(m||_)&&!M){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;!N||!N.essential&&P.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:T})),O(this._map.getBearing())&&this._map.resetNorth()):(O(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new u.k(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Zc("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Zi extends u.E{constructor(o,h){super(),this._renderFrameCallback=()=>{const d=Math.min((P.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.M(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,d){return o=u.P.convert(o).mult(-1),this.panTo(this.transform.center,u.e({offset:o},h),d)}panTo(o,h,d){return this.easeTo(u.e({center:o},h),d)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,d){return this.easeTo(u.e({zoom:o},h),d)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,d){return this.easeTo(u.e({bearing:o},h),d)}resetNorth(o,h){return this.rotateTo(0,u.e({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(u.e({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=xt.convert(o);const d=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),d,h)}_cameraForBoxAndBearing(o,h,d,m){const _={top:0,bottom:0,right:0,left:0};if(typeof(m=u.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Xt=m.padding;m.padding={top:Xt,bottom:Xt,right:Xt,left:Xt}}m.padding=u.e(_,m.padding);const S=this.transform,I=S.padding,T=new xt(o,h),M=S.project(T.getNorthWest()),N=S.project(T.getNorthEast()),O=S.project(T.getSouthEast()),U=S.project(T.getSouthWest()),$=u.b8(-d),Q=M.rotate($),nt=N.rotate($),Z=O.rotate($),ct=U.rotate($),It=new u.P(Math.max(Q.x,nt.x,ct.x,Z.x),Math.max(Q.y,nt.y,ct.y,Z.y)),it=new u.P(Math.min(Q.x,nt.x,ct.x,Z.x),Math.min(Q.y,nt.y,ct.y,Z.y)),mt=It.sub(it),Et=(S.width-(I.left+I.right+m.padding.left+m.padding.right))/mt.x,Pt=(S.height-(I.top+I.bottom+m.padding.top+m.padding.bottom))/mt.y;if(Pt<0||Et<0)return void u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Dt=Math.min(S.scaleZoom(S.scale*Math.min(Et,Pt)),m.maxZoom),Bt=u.P.convert(m.offset),Ft=new u.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(u.b8(d)),jt=Bt.add(Ft).mult(S.scale/S.zoomScale(Dt));return{center:S.unproject(M.add(O).div(2).sub(jt)),zoom:Dt,bearing:d}}fitBounds(o,h,d){return this._fitInternal(this.cameraForBounds(o,h),h,d)}fitScreenCoordinates(o,h,d,m,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.P.convert(o)),this.transform.pointLocation(u.P.convert(h)),d,m),m,_)}_fitInternal(o,h,d){return o?(delete(h=u.e(o,h)).padding,h.linear?this.easeTo(h,d):this.flyTo(h,d)):this}jumpTo(o,h){this.stop();const d=this._getTransformForUpdate();let m=!1,_=!1,S=!1;return"zoom"in o&&d.zoom!==+o.zoom&&(m=!0,d.zoom=+o.zoom),o.center!==void 0&&(d.center=u.M.convert(o.center)),"bearing"in o&&d.bearing!==+o.bearing&&(_=!0,d.bearing=+o.bearing),"pitch"in o&&d.pitch!==+o.pitch&&(S=!0,d.pitch=+o.pitch),o.padding==null||d.isPaddingEqual(o.padding)||(d.padding=o.padding),this._applyUpdatedTransform(d),this.fire(new u.k("movestart",h)).fire(new u.k("move",h)),m&&this.fire(new u.k("zoomstart",h)).fire(new u.k("zoom",h)).fire(new u.k("zoomend",h)),_&&this.fire(new u.k("rotatestart",h)).fire(new u.k("rotate",h)).fire(new u.k("rotateend",h)),S&&this.fire(new u.k("pitchstart",h)).fire(new u.k("pitch",h)).fire(new u.k("pitchend",h)),this.fire(new u.k("moveend",h))}calculateCameraOptionsFromTo(o,h,d,m=0){const _=u.Y.fromLngLat(o,h),S=u.Y.fromLngLat(d,m),I=S.x-_.x,T=S.y-_.y,M=S.z-_.z,N=Math.hypot(I,T,M);if(N===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(I,T),U=this.transform.scaleZoom(this.transform.cameraToCenterDistance/N/this.transform.tileSize),$=180*Math.atan2(I,-T)/Math.PI;let Q=180*Math.acos(O/N)/Math.PI;return Q=M<0?90-Q:90+Q,{center:S.toLngLat(),zoom:U,pitch:Q,bearing:$}}easeTo(o,h){var d;this._stop(!1,o.easeId),((o=u.e({offset:[0,0],duration:500,easing:u.b7},o)).animate===!1||!o.essential&&P.prefersReducedMotion)&&(o.duration=0);const m=this._getTransformForUpdate(),_=this.getZoom(),S=this.getBearing(),I=this.getPitch(),T=this.getPadding(),M="bearing"in o?this._normalizeBearing(o.bearing,S):S,N="pitch"in o?+o.pitch:I,O="padding"in o?o.padding:m.padding,U=u.P.convert(o.offset);let $=m.centerPoint.add(U);const Q=m.pointLocation($),{center:nt,zoom:Z}=m.getConstrained(u.M.convert(o.center||Q),(d=o.zoom)!==null&&d!==void 0?d:_);this._normalizeCenter(nt);const ct=m.project(Q),It=m.project(nt).sub(ct),it=m.zoomScale(Z-_);let mt,Et;o.around&&(mt=u.M.convert(o.around),Et=m.locationPoint(mt));const Pt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Z!==_,this._rotating=this._rotating||S!==M,this._pitching=this._pitching||N!==I,this._padding=!m.isPaddingEqual(O),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,Pt),this.terrain&&this._prepareElevation(nt),this._ease(Dt=>{if(this._zooming&&(m.zoom=u.z.number(_,Z,Dt)),this._rotating&&(m.bearing=u.z.number(S,M,Dt)),this._pitching&&(m.pitch=u.z.number(I,N,Dt)),this._padding&&(m.interpolatePadding(T,O,Dt),$=m.centerPoint.add(U)),this.terrain&&!o.freezeElevation&&this._updateElevation(Dt),mt)m.setLocationAtPoint(mt,Et);else{const Bt=m.zoomScale(m.zoom-_),Ft=Z>_?Math.min(2,it):Math.max(.5,it),jt=Math.pow(Ft,1-Dt),Xt=m.unproject(ct.add(It.mult(Dt*jt)).mult(Bt));m.setLocationAtPoint(m.renderWorldCopies?Xt.wrap():Xt,$)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},Dt=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,Dt)},o),this}_prepareEase(o,h,d={}){this._moving=!0,h||d.moving||this.fire(new u.k("movestart",o)),this._zooming&&!d.zooming&&this.fire(new u.k("zoomstart",o)),this._rotating&&!d.rotating&&this.fire(new u.k("rotatestart",o)),this._pitching&&!d.pitching&&this.fire(new u.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&h!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(d-(h-(d*o+this._elevationStart))/(1-o)),this._elevationTarget=h}this.transform.elevation=u.z.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(o){if(!this.transformCameraUpdate)return;const h=o.clone(),{center:d,zoom:m,pitch:_,bearing:S,elevation:I}=this.transformCameraUpdate(h);d&&(h.center=d),m!==void 0&&(h.zoom=m),_!==void 0&&(h.pitch=_),S!==void 0&&(h.bearing=S),I!==void 0&&(h.elevation=I),this.transform.apply(h)}_fireMoveEvents(o){this.fire(new u.k("move",o)),this._zooming&&this.fire(new u.k("zoom",o)),this._rotating&&this.fire(new u.k("rotate",o)),this._pitching&&this.fire(new u.k("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const d=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new u.k("zoomend",o)),m&&this.fire(new u.k("rotateend",o)),_&&this.fire(new u.k("pitchend",o)),this.fire(new u.k("moveend",o))}flyTo(o,h){var d;if(!o.essential&&P.prefersReducedMotion){const ln=u.L(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(ln,h)}this.stop(),o=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.b7},o);const m=this._getTransformForUpdate(),_=this.getZoom(),S=this.getBearing(),I=this.getPitch(),T=this.getPadding(),M="bearing"in o?this._normalizeBearing(o.bearing,S):S,N="pitch"in o?+o.pitch:I,O="padding"in o?o.padding:m.padding,U=u.P.convert(o.offset);let $=m.centerPoint.add(U);const Q=m.pointLocation($),{center:nt,zoom:Z}=m.getConstrained(u.M.convert(o.center||Q),(d=o.zoom)!==null&&d!==void 0?d:_);this._normalizeCenter(nt);const ct=m.zoomScale(Z-_),It=m.project(Q),it=m.project(nt).sub(It);let mt=o.curve;const Et=Math.max(m.width,m.height),Pt=Et/ct,Dt=it.mag();if("minZoom"in o){const ln=u.ac(Math.min(o.minZoom,_,Z),m.minZoom,m.maxZoom),Le=Et/m.zoomScale(ln-_);mt=Math.sqrt(Le/Dt*2)}const Bt=mt*mt;function Ft(ln){const Le=(Pt*Pt-Et*Et+(ln?-1:1)*Bt*Bt*Dt*Dt)/(2*(ln?Pt:Et)*Bt*Dt);return Math.log(Math.sqrt(Le*Le+1)-Le)}function jt(ln){return(Math.exp(ln)-Math.exp(-ln))/2}function Xt(ln){return(Math.exp(ln)+Math.exp(-ln))/2}const Fe=Ft(!1);let Kt=function(ln){return Xt(Fe)/Xt(Fe+mt*ln)},Se=function(ln){return Et*((Xt(Fe)*(jt(Le=Fe+mt*ln)/Xt(Le))-jt(Fe))/Bt)/Dt;var Le},Be=(Ft(!0)-Fe)/mt;if(Math.abs(Dt)<1e-6||!isFinite(Be)){if(Math.abs(Et-Pt)<1e-6)return this.easeTo(o,h);const ln=Pt<Et?-1:1;Be=Math.abs(Math.log(Pt/Et))/mt,Se=function(){return 0},Kt=function(Le){return Math.exp(ln*mt*Le)}}return o.duration="duration"in o?+o.duration:1e3*Be/("screenSpeed"in o?+o.screenSpeed/mt:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=S!==M,this._pitching=N!==I,this._padding=!m.isPaddingEqual(O),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(nt),this._ease(ln=>{const Le=ln*Be,je=1/Kt(Le);m.zoom=ln===1?Z:_+m.scaleZoom(je),this._rotating&&(m.bearing=u.z.number(S,M,ln)),this._pitching&&(m.pitch=u.z.number(I,N,ln)),this._padding&&(m.interpolatePadding(T,O,ln),$=m.centerPoint.add(U)),this.terrain&&!o.freezeElevation&&this._updateElevation(ln);const He=ln===1?nt:m.unproject(It.add(it.mult(Se(Le))).mult(je));m.setLocationAtPoint(m.renderWorldCopies?He.wrap():He,$),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,h)}if(!o){const d=this.handlers;d&&d.stop(!1)}return this}_ease(o,h,d){d.animate===!1||d.duration===0?(o(1),h()):(this._easeStart=P.now(),this._easeOptions=d,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,h){o=u.b1(o,-180,180);const d=Math.abs(o-h);return Math.abs(o-360-h)<d&&(o-=360),Math.abs(o+360-h)<d&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const d=o.lng-h.center.lng;o.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(u.M.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const Ep={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ho{constructor(o=Ep){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=k.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=k.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=k.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){k.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const d=this._map._getUIString(`AttributionControl.${h}`);o.title=d,o.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const _=h[m];if(_.used||_.usedForTerrain){const S=_.getSource();S.attribution&&o.indexOf(S.attribution)<0&&o.push(S.attribution)}}o=o.filter(m=>String(m).trim()),o.sort((m,_)=>m.length-_.length),o=o.filter((m,_)=>{for(let S=_+1;S<o.length;S++)if(o[S].indexOf(m)>=0)return!1;return!0});const d=o.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,o.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Dd{constructor(o={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const d=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=k.create("div","maplibregl-ctrl");const h=k.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){k.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ru{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,d=h?this._queue.concat(h):this._queue;for(const m of d)if(m.id===o)return void(m.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const d of h)if(!d.cancelled&&(d.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var lr=u.X([{name:"a_pos3d",type:"Int16",components:3}]);class br extends u.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,h){this.sourceCache.update(o,h),this._renderableTilesKeys=[];const d={};for(const m of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))d[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),u.aN(m.posMatrix,0,u.W,0,u.W,0,1),this._tiles[m.key]=new hs(m,this.tileSize));for(const m in this._tiles)d[m]||delete this._tiles[m]}freeRtt(o){for(const h in this._tiles){const d=this._tiles[h];(!o||d.tileID.equals(o)||d.tileID.isChildOf(o)||o.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const h={};for(const d of this._renderableTilesKeys){const m=this._tiles[d].tileID;if(m.canonical.equals(o.canonical)){const _=o.clone();_.posMatrix=new Float64Array(16),u.aN(_.posMatrix,0,u.W,0,u.W,0,1),h[d]=_}else if(m.canonical.isChildOf(o.canonical)){const _=o.clone();_.posMatrix=new Float64Array(16);const S=m.canonical.z-o.canonical.z,I=m.canonical.x-(m.canonical.x>>S<<S),T=m.canonical.y-(m.canonical.y>>S<<S),M=u.W>>S;u.aN(_.posMatrix,0,M,0,M,0,1),u.H(_.posMatrix,_.posMatrix,[-I*M,-T*M,0]),h[d]=_}else if(o.canonical.isChildOf(m.canonical)){const _=o.clone();_.posMatrix=new Float64Array(16);const S=o.canonical.z-m.canonical.z,I=o.canonical.x-(o.canonical.x>>S<<S),T=o.canonical.y-(o.canonical.y>>S<<S),M=u.W>>S;u.aN(_.posMatrix,0,u.W,0,u.W,0,1),u.H(_.posMatrix,_.posMatrix,[I*M,T*M,0]),u.J(_.posMatrix,_.posMatrix,[1/2**S,1/2**S,0]),h[d]=_}}return h}getSourceTile(o,h){const d=this.sourceCache._source;let m=o.overscaledZ-this.deltaZoom;if(m>d.maxzoom&&(m=d.maxzoom),m<d.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(m).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!_||!_.dem)&&h)for(;m>=d.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(o.scaledTo(m--).key);return _}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=o)}}class kd{constructor(o,h,d){this.painter=o,this.sourceCache=new br(h),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,h,d,m=u.W){var _;if(!(h>=0&&h<m&&d>=0&&d<m))return 0;const S=this.getTerrainData(o),I=(_=S.tile)===null||_===void 0?void 0:_.dem;if(!I)return 0;const T=function(Q,nt,Z){var ct=nt[0],It=nt[1];return Q[0]=Z[0]*ct+Z[4]*It+Z[12],Q[1]=Z[1]*ct+Z[5]*It+Z[13],Q}([],[h/m*u.W,d/m*u.W],S.u_terrain_matrix),M=[T[0]*I.dim,T[1]*I.dim],N=Math.floor(M[0]),O=Math.floor(M[1]),U=M[0]-N,$=M[1]-O;return I.get(N,O)*(1-U)*(1-$)+I.get(N+1,O)*U*(1-$)+I.get(N,O+1)*(1-U)*$+I.get(N+1,O+1)*U*$}getElevationForLngLatZoom(o,h){const{tileID:d,mercatorX:m,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(o,h);return this.getElevation(d,m%u.W,_%u.W,u.W)}getElevation(o,h,d,m=u.W){return this.getDEMElevation(o,h,d,m)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const m=this.painter.context,_=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new J(m,_,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new J(m,new u.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.an([])}const h=this.sourceCache.getSourceTile(o,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new J(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const d=h&&h+h.tileID.key+o.key;if(d&&!this._demMatrixCache[d]){const m=this.sourceCache.sourceCache._source.maxzoom;let _=o.canonical.z-h.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=m?_=o.canonical.z-m:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=o.canonical.x-(o.canonical.x>>_<<_),I=o.canonical.y-(o.canonical.y>>_<<_),T=u.b9(new Float64Array(16),[1/(u.W<<_),1/(u.W<<_),0]);u.H(T,T,[S*u.W,I*u.W,0]),this._demMatrixCache[o.key]={matrix:T,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(o){const h=this.painter,d=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new J(h.context,{width:d,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new J(h.context,{width:d,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(d,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,d,m))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,S=0;_<this._coordsTextureSize;_++)for(let I=0;I<this._coordsTextureSize;I++,S+=4)h[S+0]=255&I,h[S+1]=255&_,h[S+2]=I>>8<<4|_>>8,h[S+3]=0;const d=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new J(o,d,o.gl.RGBA,{premultiply:!1});return m.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),d=this.painter.context,m=d.gl,_=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),I=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(_,I-S-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),d.bindFramebuffer.set(null);const T=h[0]+(h[2]>>4<<8),M=h[1]+((15&h[2])<<8),N=this.coordsIndex[255-h[3]],O=N&&this.sourceCache.getTileByID(N);if(!O)return null;const U=this._coordsTextureSize,$=(1<<O.tileID.canonical.z)*U;return new u.Y((O.tileID.canonical.x*U+T)/$+O.tileID.wrap,(O.tileID.canonical.y*U+M)/$,this.getElevation(O.tileID,T,M,U))}depthAtPoint(o){const h=new Uint8Array(4),d=this.painter.context,m=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),d.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,h=new u.ba,d=new u.aX,m=this.meshSize,_=u.W/m,S=m*m;for(let O=0;O<=m;O++)for(let U=0;U<=m;U++)h.emplaceBack(U*_,O*_,0);for(let O=0;O<S;O+=m+1)for(let U=0;U<m;U++)d.emplaceBack(U+O,m+U+O+1,m+U+O+2),d.emplaceBack(U+O,m+U+O+2,U+O+1);const I=h.length,T=I+2*(m+1);for(const O of[0,1])for(let U=0;U<=m;U++)for(const $ of[0,1])h.emplaceBack(U*_,O*u.W,$);for(let O=0;O<2*m;O+=2)d.emplaceBack(T+O,T+O+1,T+O+3),d.emplaceBack(T+O,T+O+3,T+O+2),d.emplaceBack(I+O,I+O+3,I+O+1),d.emplaceBack(I+O,I+O+2,I+O+3);const M=h.length,N=M+2*(m+1);for(const O of[0,1])for(let U=0;U<=m;U++)for(const $ of[0,1])h.emplaceBack(O*u.W,U*_,$);for(let O=0;O<2*m;O+=2)d.emplaceBack(M+O,M+O+1,M+O+3),d.emplaceBack(M+O,M+O+3,M+O+2),d.emplaceBack(N+O,N+O+3,N+O+1),d.emplaceBack(N+O,N+O+2,N+O+3);return this._mesh={indexBuffer:o.createIndexBuffer(d),vertexBuffer:o.createVertexBuffer(h,lr.members),segments:u.$.simpleSegment(0,0,h.length,d.length)},this._mesh}getMeshFrameDelta(o){return 2*Math.PI*u.bb/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,h){var d;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(o,h);return(d=this.getMinMaxElevation(m).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(o){const h=this.getTerrainData(o).tile,d={minElevation:null,maxElevation:null};return h&&h.dem&&(d.minElevation=h.dem.min*this.exaggeration,d.maxElevation=h.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(o,h){const d=u.Y.fromLngLat(o.wrap()),m=(1<<h)*u.W,_=d.x*m,S=d.y*m,I=Math.floor(_/u.W),T=Math.floor(S/u.W);return{tileID:new u.Q(h,0,h,I,T),mercatorX:_,mercatorY:S}}}class Nu{constructor(o,h,d){this._context=o,this._size=h,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new J(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(d.texture),{id:o,fbo:h,texture:d,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>o.id!==h),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const js={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Cp{constructor(o,h){this.painter=o,this.terrain=h,this.pool=new Nu(o.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(d=>!o._layers[d].isHidden(h)),this._coordsDescendingInv={};for(const d in o.sourceCaches){this._coordsDescendingInv[d]={};const m=o.sourceCaches[d].getVisibleCoordinates();for(const _ of m){const S=this.terrain.sourceCache.getTerrainCoords(_);for(const I in S)this._coordsDescendingInv[d][I]||(this._coordsDescendingInv[d][I]=[]),this._coordsDescendingInv[d][I].push(S[I])}}this._coordsDescendingInvStr={};for(const d of o._order){const m=o._layers[d],_=m.source;if(js[m.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const S in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][S]=this._coordsDescendingInv[_][S].map(I=>I.key).sort().join()}}for(const d of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[m][d.tileID.key];_&&_!==d.rttCoords[m]&&(d.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const h=o.type,d=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(js[h]&&(this._prevType&&js[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(o.id),!m))return!0;if(js[this._prevType]||js[h]&&m){this._prevType=h;const _=this._stacks.length-1,S=this._stacks[_]||[];for(const I of this._renderableTiles){if(this.pool.isFull()&&(Vc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(I),I.rtt[_]){const M=this.pool.getObjectForId(I.rtt[_].id);if(M.stamp===I.rtt[_].stamp){this.pool.useObject(M);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),I.rtt[_]={id:T.id,stamp:T.stamp},d.context.bindFramebuffer.set(T.fbo.framebuffer),d.context.clear({color:u.aO.transparent,stencil:0}),d.currentStencilSource=void 0;for(let M=0;M<S.length;M++){const N=d.style._layers[S[M]],O=N.source?this._coordsDescendingInv[N.source][I.tileID.key]:[I.tileID];d.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),d._renderTileClippingMasks(N,O),d.renderLayer(d,d.style.sourceCaches[N.source],N,O),N.source&&(I.rttCoords[N.source]=this._coordsDescendingInvStr[N.source][I.tileID.key])}}return Vc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),js[h]}return!1}}const Tp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Lp=b,Ou={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Ep,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Hc=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Pp={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ap{constructor(o,h,d=!1){this.mousedown=S=>{this.startMouse(u.e({},S,{ctrlKey:!0,preventDefault:()=>S.preventDefault()}),k.mousePos(this.element,S)),k.addEventListener(window,"mousemove",this.mousemove),k.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.moveMouse(S,k.mousePos(this.element,S))},this.mouseup=S=>{this.mouseRotate.dragEnd(S),this.mousePitch&&this.mousePitch.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=k.touchPos(this.element,S.targetTouches)[0],this.startTouch(S,this._startPos),k.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=k.touchPos(this.element,S.targetTouches)[0],this.moveTouch(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=o.dragRotate._mouseRotate.getClickTolerance(),_=o.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Bl({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:I,bearingDegreesPerPixelMoved:T=.8})=>{const M=new ae;return new Fl({clickTolerance:I,move:(N,O)=>({bearingDelta:(O.x-N.x)*T}),moveStateManager:M,enable:S,assignEvents:Hc})})({clickTolerance:m,enable:!0}),this.map=o,d&&(this.mousePitch=Vl({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:I,pitchDegreesPerPixelMoved:T=-.5})=>{const M=new ae;return new Fl({clickTolerance:I,move:(N,O)=>({pitchDelta:(O.y-N.y)*T}),moveStateManager:M,enable:S,assignEvents:Hc})})({clickTolerance:_,enable:!0})),k.addEventListener(h,"mousedown",this.mousedown),k.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),k.addEventListener(h,"touchcancel",this.reset)}startMouse(o,h){this.mouseRotate.dragStart(o,h),this.mousePitch&&this.mousePitch.dragStart(o,h),k.disableDrag()}startTouch(o,h){this.touchRotate.dragStart(o,h),this.touchPitch&&this.touchPitch.dragStart(o,h),k.disableDrag()}moveMouse(o,h){const d=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(o,h)||{};if(m&&d.setBearing(d.getBearing()+m),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(o,h)||{};_&&d.setPitch(d.getPitch()+_)}}moveTouch(o,h){const d=this.map,{bearingDelta:m}=this.touchRotate.dragMove(o,h)||{};if(m&&d.setBearing(d.getBearing()+m),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(o,h)||{};_&&d.setPitch(d.getPitch()+_)}}off(){const o=this.element;k.removeEventListener(o,"mousedown",this.mousedown),k.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend),k.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){k.enableDrag(),k.removeEventListener(window,"mousemove",this.mousemove),k.removeEventListener(window,"mouseup",this.mouseup),k.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),k.removeEventListener(window,"touchend",this.touchend)}}let Ws;function Xc(y,o,h){const d=new u.M(y.lng,y.lat);if(y=new u.M(y.lng,y.lat),o){const m=new u.M(y.lng-360,y.lat),_=new u.M(y.lng+360,y.lat),S=h.locationPoint(y).distSqr(o);h.locationPoint(m).distSqr(o)<S?y=m:h.locationPoint(_).distSqr(o)<S&&(y=_)}for(;Math.abs(y.lng-h.center.lng)>180;){const m=h.locationPoint(y);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y.lng!==d.lng&&h.locationPoint(y).y>h.height/2-h.getHorizon()?y:d}const zu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Yc(y,o,h){const d=y.classList;for(const m in zu)d.remove(`maplibregl-${h}-anchor-${m}`);d.add(`maplibregl-${h}-anchor-${o}`)}class Fu extends u.E{constructor(o){if(super(),this._onKeyPress=h=>{const d=h.code,m=h.charCode||h.keyCode;d!=="Space"&&d!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const d=h.originalEvent.target,m=this._element;this._popup&&(d===m||m.contains(d))&&this.togglePopup()},this._update=h=>{var d;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Xc(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),k.setTransform(this._element,`${zu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${_}`),P.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=u.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=k.create("div"),this._element.setAttribute("aria-label","Map marker");const h=k.createNS("http://www.w3.org/2000/svg","svg"),d=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${d}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${d}`);const _=k.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const S=k.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const I=k.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ct of T){const It=k.createNS("http://www.w3.org/2000/svg","ellipse");It.setAttributeNS(null,"opacity","0.04"),It.setAttributeNS(null,"cx","10.5"),It.setAttributeNS(null,"cy","5.80029008"),It.setAttributeNS(null,"rx",ct.rx),It.setAttributeNS(null,"ry",ct.ry),I.appendChild(It)}const M=k.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const N=k.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(N);const O=k.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const U=k.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(U);const $=k.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const Q=k.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const nt=k.createNS("http://www.w3.org/2000/svg","circle");nt.setAttributeNS(null,"fill","#000000"),nt.setAttributeNS(null,"opacity","0.25"),nt.setAttributeNS(null,"cx","5.5"),nt.setAttributeNS(null,"cy","5.5"),nt.setAttributeNS(null,"r","5.4999962");const Z=k.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#FFFFFF"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962"),Q.appendChild(nt),Q.appendChild(Z),S.appendChild(I),S.appendChild(M),S.appendChild(O),S.appendChild($),S.appendChild(Q),h.appendChild(S),h.setAttributeNS(null,"height",d*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=u.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Yc(this._element,this._anchor,"marker"),o&&o.className)for(const h of o.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),k.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=u.M.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const m=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var h,d;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,_=m.terrain.depthAtPoint(this._pos),S=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,S)-_<.006)return void(this._element.style.opacity=this._opacity);const I=-this._offset.y/m.transform._pixelPerMeter,T=Math.sin(m.getPitch()*Math.PI/180)*I,M=m.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),N=m.transform.lngLatToCameraDepth(this._lngLat,S+T)-M>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&N&&this._popup.remove(),this._element.style.opacity=N?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=u.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,h){return o===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Kc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Gl=0,tl=!1;const Jc={maxWidth:100,unit:"metric"};function Qc(y,o,h){const d=h&&h.maxWidth||100,m=y._container.clientHeight/2,_=y.unproject([0,m]),S=y.unproject([d,m]),I=_.distanceTo(S);if(h&&h.unit==="imperial"){const T=3.2808*I;T>5280?el(o,d,T/5280,y._getUIString("ScaleControl.Miles")):el(o,d,T,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?el(o,d,I/1852,y._getUIString("ScaleControl.NauticalMiles")):I>=1e3?el(o,d,I/1e3,y._getUIString("ScaleControl.Kilometers")):el(o,d,I,y._getUIString("ScaleControl.Meters"))}function el(y,o,h,d){const m=function(_){const S=Math.pow(10,`${Math.floor(_)}`.length-1);let I=_/S;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(T){const M=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*M)/M}(I),S*I}(h);y.style.width=o*(m/h)+"px",y.innerHTML=`${m}&nbsp;${d}`}const Mp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Dp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function $c(y){if(y){if(typeof y=="number"){const o=Math.round(Math.abs(y)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,y),"top-left":new u.P(o,o),"top-right":new u.P(-o,o),bottom:new u.P(0,-y),"bottom-left":new u.P(o,-o),"bottom-right":new u.P(-o,-o),left:new u.P(y,0),right:new u.P(-y,0)}}if(y instanceof u.P||Array.isArray(y)){const o=u.P.convert(y);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:u.P.convert(y.center||[0,0]),top:u.P.convert(y.top||[0,0]),"top-left":u.P.convert(y["top-left"]||[0,0]),"top-right":u.P.convert(y["top-right"]||[0,0]),bottom:u.P.convert(y.bottom||[0,0]),"bottom-left":u.P.convert(y["bottom-left"]||[0,0]),"bottom-right":u.P.convert(y["bottom-right"]||[0,0]),left:u.P.convert(y.left||[0,0]),right:u.P.convert(y.right||[0,0])}}return $c(new u.P(0,0))}const Rd=b;f.AJAXError=u.be,f.Evented=u.E,f.LngLat=u.M,f.MercatorCoordinate=u.Y,f.Point=u.P,f.addProtocol=u.bf,f.config=u.a,f.removeProtocol=u.bg,f.AttributionControl=Ho,f.BoxZoomHandler=Wo,f.CanvasSource=Tl,f.CooperativeGesturesHandler=me,f.DoubleClickZoomHandler=Sp,f.DragPanHandler=Md,f.DragRotateHandler=Zo,f.EdgeInsets=Ol,f.FullscreenControl=class extends u.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var o;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=h==null?void 0:h.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){k.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=k.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);k.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=qo,f.GeolocateControl=class extends u.E{constructor(y){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const h=new u.M(o.coords.longitude,o.coords.latitude),d=o.coords.accuracy,m=this._map.getBearing(),_=u.e({bearing:m},this.options.fitBoundsOptions),S=xt.fromLngLat(h,d);this._map.fitBounds(S,_,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const h=new u.M(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&tl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=o=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=k.create("button","maplibregl-ctrl-geolocate",this._container),k.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",o===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=k.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Fu({element:this._dotElement}),this._circleElement=k.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")))})}},this.options=u.e({},Kc,y)}onAdd(y){return this._map=y,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return u._(this,arguments,void 0,function*(o=!1){if(Ws!==void 0&&!o)return Ws;if(window.navigator.permissions===void 0)return Ws=!!window.navigator.geolocation,Ws;try{Ws=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Ws=!!window.navigator.geolocation}return Ws})}().then(o=>this._setupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),k.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Gl=0,tl=!1}_isOutOfMapMaxBounds(y){const o=this._map.getMaxBounds(),h=y.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),o=y.getSouthEast(),h=y.getNorthEast(),d=o.distanceTo(h),m=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Gl--,tl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Gl++,Gl>1?(y={maximumAge:6e5,timeout:0},tl=!0):(y=this.options.positionOptions,tl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.Hash=vp,f.ImageSource=Or,f.KeyboardHandler=Sa,f.LngLatBounds=xt,f.LogoControl=Dd,f.Map=class extends Zi{constructor(y){if(u.bc.mark(u.bd.create),(y=u.e({},Ou,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Uc(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Ru,this._controls=[],this._mapId=u.a3(),this._locale=u.e({},Tp,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=W.addThrottleControl(()=>this.isMoving()),this._requestManager=new st(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const h=_p(d=>{this._trackResize&&!this._removed&&this.resize(d)._update()},50);this._resizeObserver=new ResizeObserver(d=>{o?h(d):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ip(this,y),this._hash=y.hash&&new vp(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,u.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new Ho(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new Dd,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new u.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new u.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new u.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(y,o){if(o===void 0&&(o=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const d=this._controlPositions[o];return o.indexOf("bottom")!==-1?d.insertBefore(h,d.firstChild):d.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(y);return o>-1&&this._controls.splice(o,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,o,h,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,o,h,d)}resize(y){var o;const h=this._containerDimensions(),d=h[0],m=h[1],_=this._getClampedPixelRatio(d,m);if(this._resizeCanvas(d,m,_),this.painter.resize(d,m,_),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const T=this._getClampedPixelRatio(d,m);this._resizeCanvas(d,m,T),this.painter.resize(d,m,T)}this.transform.resize(d,m),(o=this._requestedCameraState)===null||o===void 0||o.resize(d,m);const S=!this._moving;return S&&(this.stop(),this.fire(new u.k("movestart",y)).fire(new u.k("move",y))),this.fire(new u.k("resize",y)),S&&this.fire(new u.k("moveend",y)),this}_getClampedPixelRatio(y,o){const{0:h,1:d}=this._maxCanvasSize,m=this.getPixelRatio(),_=y*m,S=o*m;return Math.min(_>h?h/_:1,S>d?d/S:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(xt.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(u.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(u.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,o,h){if(y==="mouseenter"||y==="mouseover"){let d=!1;return{layer:o,listener:h,delegates:{mousemove:_=>{const S=this.getLayer(o)?this.queryRenderedFeatures(_.point,{layers:[o]}):[];S.length?d||(d=!0,h.call(this,new Wi(y,this,_.originalEvent,{features:S}))):d=!1},mouseout:()=>{d=!1}}}}if(y==="mouseleave"||y==="mouseout"){let d=!1;return{layer:o,listener:h,delegates:{mousemove:S=>{(this.getLayer(o)?this.queryRenderedFeatures(S.point,{layers:[o]}):[]).length?d=!0:d&&(d=!1,h.call(this,new Wi(y,this,S.originalEvent)))},mouseout:S=>{d&&(d=!1,h.call(this,new Wi(y,this,S.originalEvent)))}}}}{const d=m=>{const _=this.getLayer(o)?this.queryRenderedFeatures(m.point,{layers:[o]}):[];_.length&&(m.features=_,h.call(this,m),delete m.features)};return{layer:o,listener:h,delegates:{[y]:d}}}}on(y,o,h){if(h===void 0)return super.on(y,o);const d=this._createDelegatedListener(y,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(y,o,h){if(h===void 0)return super.once(y,o);const d=this._createDelegatedListener(y,o,h);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(y,o,h){return h===void 0?super.off(y,o):(this._delegatedListeners&&this._delegatedListeners[y]&&(d=>{const m=this._delegatedListeners[y];for(let _=0;_<m.length;_++){const S=m[_];if(S.layer===o&&S.listener===h){for(const I in S.delegates)this.off(I,S.delegates[I]);return m.splice(_,1),this}}})(),this)}queryRenderedFeatures(y,o){if(!this.style)return[];let h;const d=y instanceof u.P||Array.isArray(y),m=d?y:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(d?{}:y)||{},m instanceof u.P||typeof m[0]=="number")h=[u.P.convert(m)];else{const _=u.P.convert(m[0]),S=u.P.convert(m[1]);h=[_,new u.P(S.x,_.y),S,new u.P(_.x,S.y),_]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(y,o){return this.style.querySourceFeatures(y,o)}setStyle(y,o){return(o=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(y,o))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const o=this._locale[y];if(o==null)throw new Error(`Missing UI string '${y}'`);return o}_updateStyle(y,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,o));const h=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new ao(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,o,h):this.style.loadJSON(y,o,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ao(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,o){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,"Style");u.h(h,new AbortController).then(d=>{this._updateDiff(d.data,o)}).catch(d=>{d&&this.fire(new u.j(d))})}else typeof y=="object"&&this._updateDiff(y,o)}_updateDiff(y,o){try{this.style.setState(y,o)&&this._update(!0)}catch(h){u.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(y,o){return this._lazyInitEmptyStyle(),this.style.addSource(y,o),this._update(!0)}isSourceLoaded(y){const o=this.style&&this.style.sourceCaches[y];if(o!==void 0)return o.loaded();this.fire(new u.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const o=this.style.sourceCaches[y.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&o.reload();for(const h in this.style._layers){const d=this.style._layers[h];d.type==="hillshade"&&d.source===y.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new kd(this.painter,o,y),this.painter.renderToTexture=new Cp(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.k("terrain",{terrain:y})),this}getTerrain(){var y,o;return(o=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const o in y){const h=y[o]._tiles;for(const d in h){const m=h[d];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,o,h={}){const{pixelRatio:d=1,sdf:m=!1,stretchX:_,stretchY:S,content:I}=h;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||u.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:M,data:N}=o,O=o;return this.style.addImage(y,{data:new u.R({width:T,height:M},new Uint8Array(N)),pixelRatio:d,stretchX:_,stretchY:S,content:I,sdf:m,version:0,userImage:O}),O.onAdd&&O.onAdd(this,y),this}}{const{width:T,height:M,data:N}=P.getImageData(o);this.style.addImage(y,{data:new u.R({width:T,height:M},N),pixelRatio:d,stretchX:_,stretchY:S,content:I,sdf:m,version:0})}}updateImage(y,o){const h=this.style.getImage(y);if(!h)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=o instanceof HTMLImageElement||u.b(o)?P.getImageData(o):o,{width:m,height:_,data:S}=d;if(m===void 0||_===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||_!==h.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(o instanceof HTMLImageElement||u.b(o));return h.data.replace(S,I),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return W.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,o){return this._lazyInitEmptyStyle(),this.style.addLayer(y,o),this._update(!0)}moveLayer(y,o){return this.style.moveLayer(y,o),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,o,h){return this.style.setLayerZoomRange(y,o,h),this._update(!0)}setFilter(y,o,h={}){return this.style.setFilter(y,o,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,o,h,d={}){return this.style.setPaintProperty(y,o,h,d),this._update(!0)}getPaintProperty(y,o){return this.style.getPaintProperty(y,o)}setLayoutProperty(y,o,h,d={}){return this.style.setLayoutProperty(y,o,h,d),this._update(!0)}getLayoutProperty(y,o){return this.style.getLayoutProperty(y,o)}setGlyphs(y,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,o,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,o,h,d=>{d||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,o,h=>{h||this._update(!0)}),this}setLight(y,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,o){return this.style.setFeatureState(y,o),this._update()}removeFeatureState(y,o){return this.style.removeFeatureState(y,o),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,o=0;return this._container&&(y=this._container.clientWidth||400,o=this._container.clientHeight||300),[y,o]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const o=this._canvasContainer=k.create("div","maplibregl-canvas-container",y);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=k.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),d=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],d);const m=this._controlContainer=k.create("div","maplibregl-control-container",y),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{_[S]=k.create("div",`maplibregl-ctrl-${S} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,o,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*o),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{o={requestedAttributes:y},d&&(o.statusMessage=d.statusMessage,o.type=d.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const d="Failed to initialize WebGL";throw o?(o.message=d,new Error(JSON.stringify(o))):new Error(d)}this.painter=new xd(h,this.transform),Y.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,_=P.now();this.style.zoomHistory.update(m,_);const S=new u.a8(m,{now:_,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),I=S.crossFadingFactor();I===1&&I===this._crossFadingFactor||(h=!0,this._crossFadingFactor=I),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.bc.mark(u.bd.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,u.bc.mark(u.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),W.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),k.remove(this._canvasContainer),k.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),u.bc.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,P.frameAsync(this._frameRequest).then(y=>{u.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Lp}getCameraTargetElevation(){return this.transform.elevation}},f.MapMouseEvent=Wi,f.MapTouchEvent=ms,f.MapWheelEvent=xp,f.Marker=Fu,f.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const o=this._map.getZoom(),h=o===this._map.getMaxZoom(),d=o===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,h)=>{const d=this._map._getUIString(`NavigationControl.${h}`);o.title=d,o.setAttribute("aria-label",d)},this.options=u.e({},Pp,y),this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),k.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),k.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=k.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ap(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){k.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,o){const h=k.create("button",y,this._container);return h.type="button",h.addEventListener("click",o),h}},f.Popup=class extends u.E{constructor(y){super(),this.remove=()=>(this._content&&k.remove(this._content),this._container&&(k.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=k.create("div","maplibregl-popup",this._map.getContainer()),this._tip=k.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Xc(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!o)return;const d=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const _=$c(this.options.offset);if(!m){const I=this._container.offsetWidth,T=this._container.offsetHeight;let M;M=d.y+_.bottom.y<T?["top"]:d.y>this._map.transform.height-T?["bottom"]:[],d.x<I/2?M.push("left"):d.x>this._map.transform.width-I/2&&M.push("right"),m=M.length===0?"bottom":M.join("-")}let S=d.add(_[m]);this.options.subpixelPositioning||(S=S.round()),k.setTransform(this._container,`${zu[m]} translate(${S.x}px,${S.y}px)`),Yc(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(Mp),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=u.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const o=document.createDocumentFragment(),h=document.createElement("body");let d;for(h.innerHTML=y;d=h.firstChild,d;)o.appendChild(d);return this.setDOMContent(o)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=k.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=k.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Dp);y&&y.focus()}},f.RasterDEMTileSource=$n,f.RasterTileSource=Ct,f.ScaleControl=class{constructor(y){this._onMove=()=>{Qc(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,Qc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Jc),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){k.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=Wc,f.Style=ao,f.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=k.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=k.create("button","maplibregl-ctrl-terrain",this._container),k.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){k.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=Ld,f.TwoFingersTouchRotateHandler=wp,f.TwoFingersTouchZoomHandler=Td,f.TwoFingersTouchZoomRotateHandler=Du,f.VectorTileSource=cn,f.VideoSource=Cl,f.addSourceType=(y,o)=>u._(void 0,void 0,void 0,function*(){if(Pl(y))throw new Error(`A source type called "${y}" already exists.`);((h,d)=>{Ll[h]=d})(y,o)}),f.clearPrewarmedResources=function(){const y=Ze;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(we),Ze=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return Wt().getRTLTextPluginStatus()},f.getVersion=function(){return Rd},f.getWorkerCount=function(){return on.workerCount},f.getWorkerUrl=function(){return u.a.WORKER_URL},f.importScriptInWorkers=function(y){return en().broadcast("IS",y)},f.prewarm=function(){vn().acquire(we)},f.setMaxParallelImageRequests=function(y){u.a.MAX_PARALLEL_IMAGE_REQUESTS=y},f.setRTLTextPlugin=function(y,o){return Wt().setRTLTextPlugin(y,o)},f.setWorkerCount=function(y){on.workerCount=y},f.setWorkerUrl=function(y){u.a.WORKER_URL=y}});var c=n;return c})})(Kw);var FA=Kw.exports;const ea=P_(FA),BA="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(BA);const VA=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],UA={decimalLatitude:40.123,decimalLongitude:-74.123},GA=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],qA=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function jA(){const e=[];return VA.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...UA})}),[...e,...GA,...qA]}const WA=jA();WA.map(e=>e.verbatimCoordinates);/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function ZA(e,t){var n={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},r,a,c,f;return f={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function u(C){return function(A){return b([C,A])}}function b(C){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,a&&(c=C[0]&2?a.return:C[0]?a.throw||((c=a.return)&&c.call(a),0):a.next)&&!(c=c.call(a,C[1])).done)return c;switch(a=0,c&&(C=[C[0]&2,c.value]),C[0]){case 0:case 1:c=C;break;case 4:return n.label++,{value:C[1],done:!1};case 5:n.label++,a=C[1],C=[0];continue;case 7:C=n.ops.pop(),n.trys.pop();continue;default:if(c=n.trys,!(c=c.length>0&&c[c.length-1])&&(C[0]===6||C[0]===2)){n=0;continue}if(C[0]===3&&(!c||C[1]>c[0]&&C[1]<c[3])){n.label=C[1];break}if(C[0]===6&&n.label<c[1]){n.label=c[1],c=C;break}if(c&&n.label<c[2]){n.label=c[2],n.ops.push(C);break}c[2]&&n.ops.pop(),n.trys.pop();continue}C=t.call(e,n)}catch(A){C=[6,A],a=0}finally{r=c=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}var nu=function(){function e(t,n){this.next=null,this.key=t,this.data=n,this.left=null,this.right=null}return e}();function HA(e,t){return e>t?1:e<t?-1:0}function Jl(e,t,n){for(var r=new nu(null,null),a=r,c=r;;){var f=n(e,t.key);if(f<0){if(t.left===null)break;if(n(e,t.left.key)<0){var u=t.left;if(t.left=u.right,u.right=t,t=u,t.left===null)break}c.left=t,c=t,t=t.left}else if(f>0){if(t.right===null)break;if(n(e,t.right.key)>0){var u=t.right;if(t.right=u.left,u.left=t,t=u,t.right===null)break}a.right=t,a=t,t=t.right}else break}return a.right=t.left,c.left=t.right,t.left=r.right,t.right=r.left,t}function qy(e,t,n,r){var a=new nu(e,t);if(n===null)return a.left=a.right=null,a;n=Jl(e,n,r);var c=r(e,n.key);return c<0?(a.left=n.left,a.right=n,n.left=null):c>=0&&(a.right=n.right,a.left=n,n.right=null),a}function Tx(e,t,n){var r=null,a=null;if(t){t=Jl(e,t,n);var c=n(t.key,e);c===0?(r=t.left,a=t.right):c<0?(a=t.right,t.right=null,r=t):(r=t.left,t.left=null,a=t)}return{left:r,right:a}}function XA(e,t,n){return t===null?e:(e===null||(t=Jl(e.key,t,n),t.left=e),t)}function g_(e,t,n,r,a){if(e){r(""+t+(n?"└── ":"├── ")+a(e)+`
`);var c=t+(n?"    ":"│   ");e.left&&g_(e.left,c,!1,r,a),e.right&&g_(e.right,c,!0,r,a)}}var J_=function(){function e(t){t===void 0&&(t=HA),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,n){return this._size++,this._root=qy(t,n,this._root,this._comparator)},e.prototype.add=function(t,n){var r=new nu(t,n);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var a=this._comparator,c=Jl(t,this._root,a),f=a(t,c.key);return f===0?this._root=c:(f<0?(r.left=c.left,r.right=c,c.left=null):f>0&&(r.right=c.right,r.left=c,c.right=null),this._size++,this._root=r),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,n,r){var a;if(n===null)return null;n=Jl(t,n,r);var c=r(t,n.key);return c===0?(n.left===null?a=n.right:(a=Jl(t,n.left,r),a.right=n.right),this._size--,a):n},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Jl(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var n=this._root,r=this._comparator;n;){var a=r(t,n.key);if(a===0)return n;a<0?n=n.left:n=n.right}return null},e.prototype.find=function(t){return this._root&&(this._root=Jl(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var n=this._root,r=this._comparator;n;){var a=r(t,n.key);if(a===0)return!0;a<0?n=n.left:n=n.right}return!1},e.prototype.forEach=function(t,n){for(var r=this._root,a=[],c=!1;!c;)r!==null?(a.push(r),r=r.left):a.length!==0?(r=a.pop(),t.call(n,r),r=r.right):c=!0;return this},e.prototype.range=function(t,n,r,a){for(var c=[],f=this._comparator,u=this._root,b;c.length!==0||u;)if(u)c.push(u),u=u.left;else{if(u=c.pop(),b=f(u.key,n),b>0)break;if(f(u.key,t)>=0&&r.call(a,u))return this;u=u.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(n){var r=n.key;return t.push(r)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(n){var r=n.data;return t.push(r)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var n=this._root,r=!1,a=0,c=[];!r;)if(n)c.push(n),n=n.left;else if(c.length>0){if(n=c.pop(),a===t)return n;a++,n=n.right}else r=!0;return null},e.prototype.next=function(t){var n=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var a=this._comparator;n;){var c=a(t.key,n.key);if(c===0)break;c<0?(r=n,n=n.left):n=n.right}return r},e.prototype.prev=function(t){var n=this._root,r=null;if(t.left!==null){for(r=t.left;r.right;)r=r.right;return r}for(var a=this._comparator;n;){var c=a(t.key,n.key);if(c===0)break;c<0?n=n.left:(r=n,n=n.right)}return r},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return KA(this._root)},e.prototype.load=function(t,n,r){n===void 0&&(n=[]),r===void 0&&(r=!1);var a=t.length,c=this._comparator;if(r&&v_(t,n,0,a-1,c),this._root===null)this._root=y_(t,n,0,a),this._size=a;else{var f=JA(this.toList(),YA(t,n),c);a=this._size+a,this._root=__({head:f},0,a)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(r){return String(r.key)});var n=[];return g_(this._root,"",!0,function(r){return n.push(r)},t),n.join("")},e.prototype.update=function(t,n,r){var a=this._comparator,c=Tx(t,this._root,a),f=c.left,u=c.right;a(t,n)<0?u=qy(n,r,u,a):f=qy(n,r,f,a),this._root=XA(f,u,a)},e.prototype.split=function(t){return Tx(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t,n,r;return ZA(this,function(a){switch(a.label){case 0:t=this._root,n=[],r=!1,a.label=1;case 1:return r?[3,6]:t===null?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return n.length===0?[3,4]:(t=n.pop(),[4,t]);case 3:return a.sent(),t=t.right,[3,5];case 4:r=!0,a.label=5;case 5:return[3,1];case 6:return[2]}})},e}();function y_(e,t,n,r){var a=r-n;if(a>0){var c=n+Math.floor(a/2),f=e[c],u=t[c],b=new nu(f,u);return b.left=y_(e,t,n,c),b.right=y_(e,t,c+1,r),b}return null}function YA(e,t){for(var n=new nu(null,null),r=n,a=0;a<e.length;a++)r=r.next=new nu(e[a],t[a]);return r.next=null,n.next}function KA(e){for(var t=e,n=[],r=!1,a=new nu(null,null),c=a;!r;)t?(n.push(t),t=t.left):n.length>0?(t=c=c.next=n.pop(),t=t.right):r=!0;return c.next=null,a.next}function __(e,t,n){var r=n-t;if(r>0){var a=t+Math.floor(r/2),c=__(e,t,a),f=e.head;return f.left=c,e.head=e.head.next,f.right=__(e,a+1,n),f}return null}function JA(e,t,n){for(var r=new nu(null,null),a=r,c=e,f=t;c!==null&&f!==null;)n(c.key,f.key)<0?(a.next=c,c=c.next):(a.next=f,f=f.next),a=a.next;return c!==null?a.next=c:f!==null&&(a.next=f),r.next}function v_(e,t,n,r,a){if(!(n>=r)){for(var c=e[n+r>>1],f=n-1,u=r+1;;){do f++;while(a(e[f],c)<0);do u--;while(a(e[u],c)>0);if(f>=u)break;var b=e[f];e[f]=e[u],e[u]=b,b=t[f],t[f]=t[u],t[u]=b}v_(e,t,n,u,a),v_(e,t,u+1,r,a)}}function Us(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function So(e,t,n){return t&&Lx(e.prototype,t),n&&Lx(e,n),e}var of=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},x_=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x,a=e.ll.y<t.ll.y?t.ll.y:e.ll.y,c=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:a},ur:{x:r,y:c}}},$l=Number.EPSILON;$l===void 0&&($l=Math.pow(2,-52));var QA=$l*$l,b_=function(e,t){if(-$l<e&&e<$l&&-$l<t&&t<$l)return 0;var n=e-t;return n*n<QA*e*t?0:e<t?-1:1},$A=function(){function e(){Us(this,e),this.reset()}return So(e,[{key:"reset",value:function(){this.xRounder=new Px,this.yRounder=new Px}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),e}(),Px=function(){function e(){Us(this,e),this.tree=new J_,this.round(0)}return So(e,[{key:"round",value:function(t){var n=this.tree.add(t),r=this.tree.prev(n);if(r!==null&&b_(n.key,r.key)===0)return this.tree.remove(t),r.key;var a=this.tree.next(n);return a!==null&&b_(n.key,a.key)===0?(this.tree.remove(t),a.key):t}}]),e}(),wf=new $A,vf=function(e,t){return e.x*t.y-e.y*t.x},Qw=function(e,t){return e.x*t.x+e.y*t.y},Ax=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},a={x:n.x-e.x,y:n.y-e.y},c=vf(r,a);return b_(c,0)},Fm=function(e){return Math.sqrt(Qw(e,e))},tM=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},a={x:n.x-e.x,y:n.y-e.y};return vf(a,r)/Fm(a)/Fm(r)},eM=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},a={x:n.x-e.x,y:n.y-e.y};return Qw(a,r)/Fm(a)/Fm(r)},Mx=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Dx=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},nM=function(e,t,n,r){if(t.x===0)return Dx(n,r,e.x);if(r.x===0)return Dx(e,t,n.x);if(t.y===0)return Mx(n,r,e.y);if(r.y===0)return Mx(e,t,n.y);var a=vf(t,r);if(a==0)return null;var c={x:n.x-e.x,y:n.y-e.y},f=vf(c,t)/a,u=vf(c,r)/a,b=e.x+u*t.x,C=n.x+f*r.x,A=e.y+u*t.y,P=n.y+f*r.y,k=(b+C)/2,Y=(A+P)/2;return{x:k,y:Y}},Da=function(){So(e,null,[{key:"compare",value:function(t,n){var r=e.comparePoints(t.point,n.point);return r!==0?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Bm.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function e(t,n){Us(this,e),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}return So(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,r=0,a=n.length;r<a;r++){var c=n[r];this.point.events.push(c),c.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var r=this.point.events[n];if(r.segment.consumedBy===void 0)for(var a=n+1;a<t;a++){var c=this.point.events[a];c.consumedBy===void 0&&r.otherSE.point.events===c.otherSE.point.events&&r.segment.consume(c.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,r=this.point.events.length;n<r;n++){var a=this.point.events[n];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&t.push(a)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,r=new Map,a=function(c){var f=c.otherSE;r.set(c,{sine:tM(n.point,t.point,f.point),cosine:eM(n.point,t.point,f.point)})};return function(c,f){r.has(c)||a(c),r.has(f)||a(f);var u=r.get(c),b=u.sine,C=u.cosine,A=r.get(f),P=A.sine,k=A.cosine;return b>=0&&P>=0?C<k?1:C>k?-1:0:b<0&&P<0?C<k?-1:C>k?1:0:P<b?-1:P>b?1:0}}}]),e}(),rM=0,Bm=function(){So(e,null,[{key:"compare",value:function(t,n){var r=t.leftSE.point.x,a=n.leftSE.point.x,c=t.rightSE.point.x,f=n.rightSE.point.x;if(f<r)return 1;if(c<a)return-1;var u=t.leftSE.point.y,b=n.leftSE.point.y,C=t.rightSE.point.y,A=n.rightSE.point.y;if(r<a){if(b<u&&b<C)return 1;if(b>u&&b>C)return-1;var P=t.comparePoint(n.leftSE.point);if(P<0)return 1;if(P>0)return-1;var k=n.comparePoint(t.rightSE.point);return k!==0?k:-1}if(r>a){if(u<b&&u<A)return-1;if(u>b&&u>A)return 1;var Y=n.comparePoint(t.leftSE.point);if(Y!==0)return Y;var X=t.comparePoint(n.rightSE.point);return X<0?1:X>0?-1:1}if(u<b)return-1;if(u>b)return 1;if(c<f){var lt=n.comparePoint(t.rightSE.point);if(lt!==0)return lt}if(c>f){var ht=t.comparePoint(n.rightSE.point);if(ht<0)return 1;if(ht>0)return-1}if(c!==f){var _t=C-u,j=c-r,W=A-b,st=f-a;if(_t>j&&W<st)return 1;if(_t<j&&W>st)return-1}return c>f?1:c<f||C<A?-1:C>A?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function e(t,n,r,a){Us(this,e),this.id=++rM,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=r,this.windings=a}return So(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,r=this.rightSE.point,a=this.vector();if(n.x===r.x)return t.x===n.x?0:t.x<n.x?1:-1;var c=(t.y-n.y)/a.y,f=n.x+c*a.x;if(t.x===f)return 0;var u=(t.x-n.x)/a.x,b=n.y+u*a.y;return t.y===b?0:t.y<b?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),r=t.bbox(),a=x_(n,r);if(a===null)return null;var c=this.leftSE.point,f=this.rightSE.point,u=t.leftSE.point,b=t.rightSE.point,C=of(n,u)&&this.comparePoint(u)===0,A=of(r,c)&&t.comparePoint(c)===0,P=of(n,b)&&this.comparePoint(b)===0,k=of(r,f)&&t.comparePoint(f)===0;if(A&&C)return k&&!P?f:!k&&P?b:null;if(A)return P&&c.x===b.x&&c.y===b.y?null:c;if(C)return k&&f.x===u.x&&f.y===u.y?null:u;if(k&&P)return null;if(k)return f;if(P)return b;var Y=nM(c,this.vector(),u,t.vector());return Y===null||!of(a,Y)?null:wf.round(Y.x,Y.y)}},{key:"split",value:function(t){var n=[],r=t.events!==void 0,a=new Da(t,!0),c=new Da(t,!1),f=this.rightSE;this.replaceRightSE(c),n.push(c),n.push(a);var u=new e(a,f,this.rings.slice(),this.windings.slice());return Da.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),Da.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(a.checkForConsuming(),c.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,r=this.windings.length;n<r;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,r=t;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var a=e.compare(n,r);if(a!==0){if(a>0){var c=n;n=r,r=c}if(n.prev===r){var f=n;n=r,r=f}for(var u=0,b=r.rings.length;u<b;u++){var C=r.rings[u],A=r.windings[u],P=n.rings.indexOf(C);P===-1?(n.rings.push(C),n.windings.push(A)):n.windings[P]+=A}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,r=this._afterState.windings,a=this._afterState.multiPolys,c=0,f=this.rings.length;c<f;c++){var u=this.rings[c],b=this.windings[c],C=n.indexOf(u);C===-1?(n.push(u),r.push(b)):r[C]+=b}for(var A=[],P=[],k=0,Y=n.length;k<Y;k++)if(r[k]!==0){var X=n[k],lt=X.poly;if(P.indexOf(lt)===-1)if(X.isExterior)A.push(lt);else{P.indexOf(lt)===-1&&P.push(lt);var ht=A.indexOf(X.poly);ht!==-1&&A.splice(ht,1)}}for(var _t=0,j=A.length;_t<j;_t++){var W=A[_t].multiPoly;a.indexOf(W)===-1&&a.push(W)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(ju.type){case"union":{var r=t.length===0,a=n.length===0;this._isInResult=r!==a;break}case"intersection":{var c,f;t.length<n.length?(c=t.length,f=n.length):(c=n.length,f=t.length),this._isInResult=f===ju.numMultiPolys&&c<f;break}case"xor":{var u=Math.abs(t.length-n.length);this._isInResult=u%2===1;break}case"difference":{var b=function(C){return C.length===1&&C[0].isSubject};this._isInResult=b(t)!==b(n);break}default:throw new Error("Unrecognized operation type found ".concat(ju.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,r){var a,c,f,u=Da.comparePoints(t,n);if(u<0)a=t,c=n,f=1;else if(u>0)a=n,c=t,f=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var b=new Da(a,!0),C=new Da(c,!1);return new e(b,C,[r],[f])}}]),e}(),kx=function(){function e(t,n,r){if(Us(this,e),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=wf.round(t[0][0],t[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};for(var c=a,f=1,u=t.length;f<u;f++){if(typeof t[f][0]!="number"||typeof t[f][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var b=wf.round(t[f][0],t[f][1]);b.x===c.x&&b.y===c.y||(this.segments.push(Bm.fromRing(c,b,this)),b.x<this.bbox.ll.x&&(this.bbox.ll.x=b.x),b.y<this.bbox.ll.y&&(this.bbox.ll.y=b.y),b.x>this.bbox.ur.x&&(this.bbox.ur.x=b.x),b.y>this.bbox.ur.y&&(this.bbox.ur.y=b.y),c=b)}(a.x!==c.x||a.y!==c.y)&&this.segments.push(Bm.fromRing(c,a,this))}return So(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,r=this.segments.length;n<r;n++){var a=this.segments[n];t.push(a.leftSE),t.push(a.rightSE)}return t}}]),e}(),iM=function(){function e(t,n){if(Us(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new kx(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,a=t.length;r<a;r++){var c=new kx(t[r],this,!1);c.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=c.bbox.ur.y),this.interiorRings.push(c)}this.multiPoly=n}return So(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,r=this.interiorRings.length;n<r;n++)for(var a=this.interiorRings[n].getSweepEvents(),c=0,f=a.length;c<f;c++)t.push(a[c]);return t}}]),e}(),Rx=function(){function e(t,n){if(Us(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,a=t.length;r<a;r++){var c=new iM(t[r],this);c.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=c.bbox.ll.x),c.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=c.bbox.ll.y),c.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=c.bbox.ur.x),c.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=c.bbox.ur.y),this.polys.push(c)}this.isSubject=n}return So(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,r=this.polys.length;n<r;n++)for(var a=this.polys[n].getSweepEvents(),c=0,f=a.length;c<f;c++)t.push(a[c]);return t}}]),e}(),oM=function(){So(e,null,[{key:"factory",value:function(t){for(var n=[],r=0,a=t.length;r<a;r++){var c=t[r];if(!(!c.isInResult()||c.ringOut)){for(var f=null,u=c.leftSE,b=c.rightSE,C=[u],A=u.point,P=[];f=u,u=b,C.push(u),u.point!==A;)for(;;){var k=u.getAvailableLinkedEvents();if(k.length===0){var Y=C[0].point,X=C[C.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(Y.x,",")+" ".concat(Y.y,"]. Last matching segment found ends at")+" [".concat(X.x,", ").concat(X.y,"]."))}if(k.length===1){b=k[0].otherSE;break}for(var lt=null,ht=0,_t=P.length;ht<_t;ht++)if(P[ht].point===u.point){lt=ht;break}if(lt!==null){var j=P.splice(lt)[0],W=C.splice(j.index);W.unshift(W[0].otherSE),n.push(new e(W.reverse()));continue}P.push({index:C.length,point:u.point});var st=u.getLeftmostComparator(f);b=k.sort(st)[0].otherSE;break}n.push(new e(C))}}return n}}]);function e(t){Us(this,e),this.events=t;for(var n=0,r=t.length;n<r;n++)t[n].segment.ringOut=this;this.poly=null}return So(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],r=1,a=this.events.length-1;r<a;r++){var c=this.events[r].point,f=this.events[r+1].point;Ax(c,t,f)!==0&&(n.push(c),t=c)}if(n.length===1)return null;var u=n[0],b=n[1];Ax(u,t,b)===0&&n.shift(),n.push(n[0]);for(var C=this.isExteriorRing()?1:-1,A=this.isExteriorRing()?0:n.length-1,P=this.isExteriorRing()?n.length:-1,k=[],Y=A;Y!=P;Y+=C)k.push([n[Y].x,n[Y].y]);return k}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,r=this.events.length;n<r;n++){var a=this.events[n];Da.compare(t,a)>0&&(t=a)}for(var c=t.segment.prevInResult(),f=c?c.prevInResult():null;;){if(!c)return null;if(!f)return c.ringOut;if(f.ringOut!==c.ringOut)return f.ringOut.enclosingRing()!==c.ringOut?c.ringOut:c.ringOut.enclosingRing();c=f.prevInResult(),f=c?c.prevInResult():null}}}]),e}(),Nx=function(){function e(t){Us(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return So(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,r=this.interiorRings.length;n<r;n++){var a=this.interiorRings[n].getGeom();a!==null&&t.push(a)}return t}}]),e}(),sM=function(){function e(t){Us(this,e),this.rings=t,this.polys=this._composePolys(t)}return So(e,[{key:"getGeom",value:function(){for(var t=[],n=0,r=this.polys.length;n<r;n++){var a=this.polys[n].getGeom();a!==null&&t.push(a)}return t}},{key:"_composePolys",value:function(t){for(var n=[],r=0,a=t.length;r<a;r++){var c=t[r];if(!c.poly)if(c.isExteriorRing())n.push(new Nx(c));else{var f=c.enclosingRing();f.poly||n.push(new Nx(f)),f.poly.addInterior(c)}}return n}}]),e}(),aM=function(){function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Bm.compare;Us(this,e),this.queue=t,this.tree=new J_(n),this.segments=[]}return So(e,[{key:"process",value:function(t){var n=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),r;var a=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!a)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var c=a,f=a,u=void 0,b=void 0;u===void 0;)c=this.tree.prev(c),c===null?u=null:c.key.consumedBy===void 0&&(u=c.key);for(;b===void 0;)f=this.tree.next(f),f===null?b=null:f.key.consumedBy===void 0&&(b=f.key);if(t.isLeft){var C=null;if(u){var A=u.getIntersection(n);if(A!==null&&(n.isAnEndpoint(A)||(C=A),!u.isAnEndpoint(A)))for(var P=this._splitSafely(u,A),k=0,Y=P.length;k<Y;k++)r.push(P[k])}var X=null;if(b){var lt=b.getIntersection(n);if(lt!==null&&(n.isAnEndpoint(lt)||(X=lt),!b.isAnEndpoint(lt)))for(var ht=this._splitSafely(b,lt),_t=0,j=ht.length;_t<j;_t++)r.push(ht[_t])}if(C!==null||X!==null){var W=null;if(C===null)W=X;else if(X===null)W=C;else{var st=Da.comparePoints(C,X);W=st<=0?C:X}this.queue.remove(n.rightSE),r.push(n.rightSE);for(var gt=n.split(W),Lt=0,At=gt.length;Lt<At;Lt++)r.push(gt[Lt])}r.length>0?(this.tree.remove(n),r.push(t)):(this.segments.push(n),n.prev=u)}else{if(u&&b){var Tt=u.getIntersection(b);if(Tt!==null){if(!u.isAnEndpoint(Tt))for(var Vt=this._splitSafely(u,Tt),Yt=0,J=Vt.length;Yt<J;Yt++)r.push(Vt[Yt]);if(!b.isAnEndpoint(Tt))for(var Ut=this._splitSafely(b,Tt),te=0,le=Ut.length;te<le;te++)r.push(Ut[te])}}this.tree.remove(n)}return r}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var r=t.rightSE;this.queue.remove(r);var a=t.split(n);return a.push(r),t.consumedBy===void 0&&this.tree.insert(t),a}}]),e}(),Ox=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,lM=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,uM=function(){function e(){Us(this,e)}return So(e,[{key:"run",value:function(t,n,r){ju.type=t,wf.reset();for(var a=[new Rx(n,!0)],c=0,f=r.length;c<f;c++)a.push(new Rx(r[c],!1));if(ju.numMultiPolys=a.length,ju.type==="difference")for(var u=a[0],b=1;b<a.length;)x_(a[b].bbox,u.bbox)!==null?b++:a.splice(b,1);if(ju.type==="intersection"){for(var C=0,A=a.length;C<A;C++)for(var P=a[C],k=C+1,Y=a.length;k<Y;k++)if(x_(P.bbox,a[k].bbox)===null)return[]}for(var X=new J_(Da.compare),lt=0,ht=a.length;lt<ht;lt++)for(var _t=a[lt].getSweepEvents(),j=0,W=_t.length;j<W;j++)if(X.insert(_t[j]),X.size>Ox)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var st=new aM(X),gt=X.size,Lt=X.pop();Lt;){var At=Lt.key;if(X.size===gt){var Tt=At.segment;throw new Error("Unable to pop() ".concat(At.isLeft?"left":"right"," SweepEvent ")+"[".concat(At.point.x,", ").concat(At.point.y,"] from segment #").concat(Tt.id," ")+"[".concat(Tt.leftSE.point.x,", ").concat(Tt.leftSE.point.y,"] -> ")+"[".concat(Tt.rightSE.point.x,", ").concat(Tt.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(X.size>Ox)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(st.segments.length>lM)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Vt=st.process(At),Yt=0,J=Vt.length;Yt<J;Yt++){var Ut=Vt[Yt];Ut.consumedBy===void 0&&X.insert(Ut)}gt=X.size,Lt=X.pop()}wf.reset();var te=oM.factory(st.segments),le=new sM(te);return le.getGeom()}}]),e}(),ju=new uM;function $w(e,t,n){if(e!==null)for(var r,a,c,f,u,b,C,A=0,P=0,k,Y=e.type,X=Y==="FeatureCollection",lt=Y==="Feature",ht=X?e.features.length:1,_t=0;_t<ht;_t++){C=X?e.features[_t].geometry:lt?e.geometry:e,k=C?C.type==="GeometryCollection":!1,u=k?C.geometries.length:1;for(var j=0;j<u;j++){var W=0,st=0;if(f=k?C.geometries[j]:C,f!==null){b=f.coordinates;var gt=f.type;switch(A=n&&(gt==="Polygon"||gt==="MultiPolygon")?1:0,gt){case null:break;case"Point":if(t(b,P,_t,W,st)===!1)return!1;P++,W++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],P,_t,W,st)===!1)return!1;P++,gt==="MultiPoint"&&W++}gt==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],P,_t,W,st)===!1)return!1;P++}gt==="MultiLineString"&&W++,gt==="Polygon"&&st++}gt==="Polygon"&&W++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(st=0,a=0;a<b[r].length;a++){for(c=0;c<b[r][a].length-A;c++){if(t(b[r][a][c],P,_t,W,st)===!1)return!1;P++}st++}W++}break;case"GeometryCollection":for(r=0;r<f.geometries.length;r++)if($w(f.geometries[r],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function zx(e){var t=[1/0,1/0,-1/0,-1/0];return $w(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}zx.default=zx;"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var t=Object(this),n=Math.max(Math.min(t.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var a=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(a=a<0?Math.max(n+arguments[2],0):Math.min(a,n);r<a;)t[r]=e,++r;return t},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var Hu=function(){};Hu.prototype.interfaces_=function(){return[]};Hu.prototype.getClass=function(){return Hu};Hu.prototype.equalsWithTolerance=function(e,t,n){return Math.abs(e-t)<=n};var jn=function(e){function t(n){e.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),Me=function(){},t2={MAX_VALUE:{configurable:!0}};Me.isNaN=function(e){return Number.isNaN(e)};Me.doubleToLongBits=function(e){return e};Me.longBitsToDouble=function(e){return e};Me.isInfinite=function(e){return!Number.isFinite(e)};t2.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(Me,t2);var Uo=function(){},tg=function(){},Lh=function(){};function Go(){}var bt=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},uc={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};bt.prototype.setOrdinate=function(e,t){switch(e){case bt.X:this.x=t;break;case bt.Y:this.y=t;break;case bt.Z:this.z=t;break;default:throw new jn("Invalid ordinate index: "+e)}};bt.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return!(!Hu.equalsWithTolerance(this.x,t.x,n)||!Hu.equalsWithTolerance(this.y,t.y,n))}};bt.prototype.getOrdinate=function(e){switch(e){case bt.X:return this.x;case bt.Y:return this.y;case bt.Z:return this.z}throw new jn("Invalid ordinate index: "+e)};bt.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||Me.isNaN(this.z))&&Me.isNaN(e.z)};bt.prototype.equals=function(e){return e instanceof bt?this.equals2D(e):!1};bt.prototype.equalInZ=function(e,t){return Hu.equalsWithTolerance(this.z,e.z,t)};bt.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0};bt.prototype.clone=function(){};bt.prototype.copy=function(){return new bt(this)};bt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};bt.prototype.distance3D=function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return Math.sqrt(t*t+n*n+r*r)};bt.prototype.distance=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)};bt.prototype.hashCode=function(){var e=17;return e=37*e+bt.hashCode(this.x),e=37*e+bt.hashCode(this.y),e};bt.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};bt.prototype.interfaces_=function(){return[Uo,tg,Go]};bt.prototype.getClass=function(){return bt};bt.hashCode=function(){if(arguments.length===1){var e=arguments[0],t=Me.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}};uc.DimensionalComparator.get=function(){return dl};uc.serialVersionUID.get=function(){return 6683108902428367e3};uc.NULL_ORDINATE.get=function(){return Me.NaN};uc.X.get=function(){return 0};uc.Y.get=function(){return 1};uc.Z.get=function(){return 2};Object.defineProperties(bt,uc);var dl=function(e){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new jn("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};dl.prototype.compare=function(e,t){var n=e,r=t,a=dl.compare(n.x,r.x);if(a!==0)return a;var c=dl.compare(n.y,r.y);if(c!==0)return c;if(this._dimensionsToTest<=2)return 0;var f=dl.compare(n.z,r.z);return f};dl.prototype.interfaces_=function(){return[Lh]};dl.prototype.getClass=function(){return dl};dl.compare=function(e,t){return e<t?-1:e>t?1:Me.isNaN(e)?Me.isNaN(t)?0:-1:Me.isNaN(t)?1:0};var Ph=function(){};Ph.prototype.create=function(){};Ph.prototype.interfaces_=function(){return[]};Ph.prototype.getClass=function(){return Ph};var St=function(){},Uf={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};St.prototype.interfaces_=function(){return[]};St.prototype.getClass=function(){return St};St.toLocationSymbol=function(e){switch(e){case St.EXTERIOR:return"e";case St.BOUNDARY:return"b";case St.INTERIOR:return"i";case St.NONE:return"-"}throw new jn("Unknown location value: "+e)};Uf.INTERIOR.get=function(){return 0};Uf.BOUNDARY.get=function(){return 1};Uf.EXTERIOR.get=function(){return 2};Uf.NONE.get=function(){return-1};Object.defineProperties(St,Uf);var Te=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},Io=function(){},e2={LOG_10:{configurable:!0}};Io.prototype.interfaces_=function(){return[]};Io.prototype.getClass=function(){return Io};Io.log10=function(e){var t=Math.log(e);return Me.isInfinite(t)||Me.isNaN(t)?t:t/Io.LOG_10};Io.min=function(e,t,n,r){var a=e;return t<a&&(a=t),n<a&&(a=n),r<a&&(a=r),a};Io.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],a=arguments[1],c=arguments[2];return r<a?a:r>c?c:r}};Io.wrap=function(e,t){return e<0?t- -e%t:e%t};Io.max=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2],r=e;return t>r&&(r=t),n>r&&(r=n),r}else if(arguments.length===4){var a=arguments[0],c=arguments[1],f=arguments[2],u=arguments[3],b=a;return c>b&&(b=c),f>b&&(b=f),u>b&&(b=u),b}};Io.average=function(e,t){return(e+t)/2};e2.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Io,e2);var Gs=function(e){this.str=e};Gs.prototype.append=function(e){this.str+=e};Gs.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)};Gs.prototype.toString=function(e){return this.str};var Ps=function(e){this.value=e};Ps.prototype.intValue=function(){return this.value};Ps.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};Ps.isNaN=function(e){return Number.isNaN(e)};var Sf=function(){};Sf.isWhitespace=function(e){return e<=32&&e>=0||e===127};Sf.toUpperCase=function(e){return e.toUpperCase()};var Mt=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var r=arguments[0];e.call(this,e.parse(r))}}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.init(a,c)}},us={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Mt.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};Mt.prototype.extractSignificantDigits=function(e,t){var n=this.abs(),r=Mt.magnitude(n._hi),a=Mt.TEN.pow(r);n=n.divide(a),n.gt(Mt.TEN)?(n=n.divide(Mt.TEN),r+=1):n.lt(Mt.ONE)&&(n=n.multiply(Mt.TEN),r-=1);for(var c=r+1,f=new Gs,u=Mt.MAX_PRINT_DIGITS-1,b=0;b<=u;b++){e&&b===c&&f.append(".");var C=Math.trunc(n._hi);if(C<0)break;var A=!1,P=0;C>9?(A=!0,P="9"):P="0"+C,f.append(P),n=n.subtract(Mt.valueOf(C)).multiply(Mt.TEN),A&&n.selfAdd(Mt.TEN);var k=!0,Y=Mt.magnitude(n._hi);if(Y<0&&Math.abs(Y)>=u-b&&(k=!1),!k)break}return t[0]=r,f.toString()};Mt.prototype.sqr=function(){return this.multiply(this)};Mt.prototype.doubleValue=function(){return this._hi+this._lo};Mt.prototype.subtract=function(){if(arguments[0]instanceof Mt){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}};Mt.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};Mt.prototype.isZero=function(){return this._hi===0&&this._lo===0};Mt.prototype.selfSubtract=function(){if(arguments[0]instanceof Mt){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}};Mt.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Mt.prototype.min=function(e){return this.le(e)?this:e};Mt.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Mt){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=null,c=null,f=null,u=null,b=null,C=null,A=null,P=null;return b=this._hi/n,C=Mt.SPLIT*b,a=C-b,P=Mt.SPLIT*n,a=C-a,c=b-a,f=P-n,A=b*n,f=P-f,u=n-f,P=a*f-A+a*u+c*f+c*u,C=(this._hi-A-P+this._lo-b*r)/n,P=b+C,this._hi=P,this._lo=b-P+C,this}};Mt.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Mt.prototype.divide=function(){if(arguments[0]instanceof Mt){var e=arguments[0],t=null,n=null,r=null,a=null,c=null,f=null,u=null,b=null;c=this._hi/e._hi,f=Mt.SPLIT*c,t=f-c,b=Mt.SPLIT*e._hi,t=f-t,n=c-t,r=b-e._hi,u=c*e._hi,r=b-r,a=e._hi-r,b=t*r-u+t*a+n*r+n*a,f=(this._hi-u-b+this._lo-c*e._lo)/e._hi,b=c+f;var C=b,A=c-b+f;return new Mt(C,A)}else if(typeof arguments[0]=="number"){var P=arguments[0];return Me.isNaN(P)?Mt.createNaN():Mt.copy(this).selfDivide(P,0)}};Mt.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};Mt.prototype.pow=function(e){if(e===0)return Mt.valueOf(1);var t=new Mt(this),n=Mt.valueOf(1),r=Math.abs(e);if(r>1)for(;r>0;)r%2===1&&n.selfMultiply(t),r/=2,r>0&&(t=t.sqr());else n=t;return e<0?n.reciprocal():n};Mt.prototype.ceil=function(){if(this.isNaN())return Mt.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new Mt(e,t)};Mt.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0};Mt.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};Mt.prototype.setValue=function(){if(arguments[0]instanceof Mt){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}};Mt.prototype.max=function(e){return this.ge(e)?this:e};Mt.prototype.sqrt=function(){if(this.isZero())return Mt.valueOf(0);if(this.isNegative())return Mt.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,n=Mt.valueOf(t),r=this.subtract(n.sqr()),a=r._hi*(e*.5);return n.add(a)};Mt.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Mt){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0],n=null,r=null,a=null,c=null,f=null,u=null;return a=this._hi+t,f=a-this._hi,c=a-f,c=t-f+(this._hi-c),u=c+this._lo,n=a+u,r=u+(a-n),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(arguments.length===2){var b=arguments[0],C=arguments[1],A=null,P=null,k=null,Y=null,X=null,lt=null,ht=null,_t=null;X=this._hi+b,k=this._lo+C,ht=X-this._hi,_t=k-this._lo,lt=X-ht,Y=k-_t,lt=b-ht+(this._hi-lt),Y=C-_t+(this._lo-Y),ht=lt+k,A=X+ht,P=ht+(X-A),ht=Y+P;var j=A+ht,W=ht+(A-j);return this._hi=j,this._lo=W,this}};Mt.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Mt){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=null,c=null,f=null,u=null,b=null,C=null;b=Mt.SPLIT*this._hi,a=b-this._hi,C=Mt.SPLIT*n,a=b-a,c=this._hi-a,f=C-n,b=this._hi*n,f=C-f,u=n-f,C=a*f-b+a*u+c*f+c*u+(this._hi*r+this._lo*n);var A=b+C;a=b-A;var P=C+a;return this._hi=A,this._lo=P,this}};Mt.prototype.selfSqr=function(){return this.selfMultiply(this)};Mt.prototype.floor=function(){if(this.isNaN())return Mt.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new Mt(e,t)};Mt.prototype.negate=function(){return this.isNaN()?this:new Mt(-this._hi,-this._lo)};Mt.prototype.clone=function(){};Mt.prototype.multiply=function(){if(arguments[0]instanceof Mt){var e=arguments[0];return e.isNaN()?Mt.createNaN():Mt.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return Me.isNaN(t)?Mt.createNaN():Mt.copy(this).selfMultiply(t,0)}};Mt.prototype.isNaN=function(){return Me.isNaN(this._hi)};Mt.prototype.intValue=function(){return Math.trunc(this._hi)};Mt.prototype.toString=function(){var e=Mt.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};Mt.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),r=t[0]+1,a=n;if(n.charAt(0)===".")a="0"+n;else if(r<0)a="0."+Mt.stringOfChar("0",-r)+n;else if(n.indexOf(".")===-1){var c=r-n.length,f=Mt.stringOfChar("0",c);a=n+f+".0"}return this.isNegative()?"-"+a:a};Mt.prototype.reciprocal=function(){var e=null,t=null,n=null,r=null,a=null,c=null,f=null,u=null;a=1/this._hi,c=Mt.SPLIT*a,e=c-a,u=Mt.SPLIT*this._hi,e=c-e,t=a-e,n=u-this._hi,f=a*this._hi,n=u-n,r=this._hi-n,u=e*n-f+e*r+t*n+t*r,c=(1-f-u-a*this._lo)/this._hi;var b=a+c,C=a-b+c;return new Mt(b,C)};Mt.prototype.toSciNotation=function(){if(this.isZero())return Mt.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),r=Mt.SCI_NOT_EXPONENT_CHAR+t[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var a="";n.length>1&&(a=n.substring(1));var c=n.charAt(0)+"."+a;return this.isNegative()?"-"+c+r:c+r};Mt.prototype.abs=function(){return this.isNaN()?Mt.NaN:this.isNegative()?this.negate():new Mt(this)};Mt.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Mt.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};Mt.prototype.add=function(){if(arguments[0]instanceof Mt){var e=arguments[0];return Mt.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return Mt.copy(this).selfAdd(t)}};Mt.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof Mt){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}};Mt.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};Mt.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Mt.prototype.trunc=function(){return this.isNaN()?Mt.NaN:this.isPositive()?this.floor():this.ceil()};Mt.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Mt.prototype.interfaces_=function(){return[Go,Uo,tg]};Mt.prototype.getClass=function(){return Mt};Mt.sqr=function(e){return Mt.valueOf(e).selfMultiply(e)};Mt.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return Mt.parse(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return new Mt(t)}};Mt.sqrt=function(e){return Mt.valueOf(e).sqrt()};Mt.parse=function(e){for(var t=0,n=e.length;Sf.isWhitespace(e.charAt(t));)t++;var r=!1;if(t<n){var a=e.charAt(t);(a==="-"||a==="+")&&(t++,a==="-"&&(r=!0))}for(var c=new Mt,f=0,u=0,b=0;!(t>=n);){var C=e.charAt(t);if(t++,Sf.isDigit(C)){var A=C-"0";c.selfMultiply(Mt.TEN),c.selfAdd(A),f++;continue}if(C==="."){u=f;continue}if(C==="e"||C==="E"){var P=e.substring(t);try{b=Ps.parseInt(P)}catch(ht){throw ht instanceof Error?new Error("Invalid exponent "+P+" in string "+e):ht}finally{}break}throw new Error("Unexpected character '"+C+"' at position "+t+" in string "+e)}var k=c,Y=f-u-b;if(Y===0)k=c;else if(Y>0){var X=Mt.TEN.pow(Y);k=c.divide(X)}else if(Y<0){var lt=Mt.TEN.pow(-Y);k=c.multiply(lt)}return r?k.negate():k};Mt.createNaN=function(){return new Mt(Me.NaN,Me.NaN)};Mt.copy=function(e){return new Mt(e)};Mt.magnitude=function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),r=Math.trunc(Math.floor(n)),a=Math.pow(10,r);return a*10<=t&&(r+=1),r};Mt.stringOfChar=function(e,t){for(var n=new Gs,r=0;r<t;r++)n.append(e);return n.toString()};us.PI.get=function(){return new Mt(3.141592653589793,12246467991473532e-32)};us.TWO_PI.get=function(){return new Mt(6.283185307179586,24492935982947064e-32)};us.PI_2.get=function(){return new Mt(1.5707963267948966,6123233995736766e-32)};us.E.get=function(){return new Mt(2.718281828459045,14456468917292502e-32)};us.NaN.get=function(){return new Mt(Me.NaN,Me.NaN)};us.EPS.get=function(){return 123259516440783e-46};us.SPLIT.get=function(){return 134217729};us.MAX_PRINT_DIGITS.get=function(){return 32};us.TEN.get=function(){return Mt.valueOf(10)};us.ONE.get=function(){return Mt.valueOf(1)};us.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};us.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Mt,us);var zi=function(){},n2={DP_SAFE_EPSILON:{configurable:!0}};zi.prototype.interfaces_=function(){return[]};zi.prototype.getClass=function(){return zi};zi.orientationIndex=function(e,t,n){var r=zi.orientationIndexFilter(e,t,n);if(r<=1)return r;var a=Mt.valueOf(t.x).selfAdd(-e.x),c=Mt.valueOf(t.y).selfAdd(-e.y),f=Mt.valueOf(n.x).selfAdd(-t.x),u=Mt.valueOf(n.y).selfAdd(-t.y);return a.selfMultiply(u).selfSubtract(c.selfMultiply(f)).signum()};zi.signOfDet2x2=function(e,t,n,r){var a=e.multiply(r).selfSubtract(t.multiply(n));return a.signum()};zi.intersection=function(e,t,n,r){var a=Mt.valueOf(r.y).selfSubtract(n.y).selfMultiply(Mt.valueOf(t.x).selfSubtract(e.x)),c=Mt.valueOf(r.x).selfSubtract(n.x).selfMultiply(Mt.valueOf(t.y).selfSubtract(e.y)),f=a.subtract(c),u=Mt.valueOf(r.x).selfSubtract(n.x).selfMultiply(Mt.valueOf(e.y).selfSubtract(n.y)),b=Mt.valueOf(r.y).selfSubtract(n.y).selfMultiply(Mt.valueOf(e.x).selfSubtract(n.x)),C=u.subtract(b),A=C.selfDivide(f).doubleValue(),P=Mt.valueOf(e.x).selfAdd(Mt.valueOf(t.x).selfSubtract(e.x).selfMultiply(A)).doubleValue(),k=Mt.valueOf(t.x).selfSubtract(e.x).selfMultiply(Mt.valueOf(e.y).selfSubtract(n.y)),Y=Mt.valueOf(t.y).selfSubtract(e.y).selfMultiply(Mt.valueOf(e.x).selfSubtract(n.x)),X=k.subtract(Y),lt=X.selfDivide(f).doubleValue(),ht=Mt.valueOf(n.y).selfAdd(Mt.valueOf(r.y).selfSubtract(n.y).selfMultiply(lt)).doubleValue();return new bt(P,ht)};zi.orientationIndexFilter=function(e,t,n){var r=null,a=(e.x-n.x)*(t.y-n.y),c=(e.y-n.y)*(t.x-n.x),f=a-c;if(a>0){if(c<=0)return zi.signum(f);r=a+c}else if(a<0){if(c>=0)return zi.signum(f);r=-a-c}else return zi.signum(f);var u=zi.DP_SAFE_EPSILON*r;return f>=u||-f>=u?zi.signum(f):2};zi.signum=function(e){return e>0?1:e<0?-1:0};n2.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(zi,n2);var un=function(){},Gf={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Gf.X.get=function(){return 0};Gf.Y.get=function(){return 1};Gf.Z.get=function(){return 2};Gf.M.get=function(){return 3};un.prototype.setOrdinate=function(e,t,n){};un.prototype.size=function(){};un.prototype.getOrdinate=function(e,t){};un.prototype.getCoordinate=function(){};un.prototype.getCoordinateCopy=function(e){};un.prototype.getDimension=function(){};un.prototype.getX=function(e){};un.prototype.clone=function(){};un.prototype.expandEnvelope=function(e){};un.prototype.copy=function(){};un.prototype.getY=function(e){};un.prototype.toCoordinateArray=function(){};un.prototype.interfaces_=function(){return[tg]};un.prototype.getClass=function(){return un};Object.defineProperties(un,Gf);var r2=function(){},Kh=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(r2),ri=function(){};ri.arraycopy=function(e,t,n,r,a){for(var c=0,f=t;f<t+a;f++)n[r+c]=e[f],c++};ri.getProperty=function(e){return{"line.separator":`
`}[e]};var $o=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var a=arguments[0],c=arguments[1];this.x=a.y*c.w-c.y*a.w,this.y=c.x*a.w-a.x*c.w,this.w=a.x*c.y-c.x*a.y}else if(arguments[0]instanceof bt&&arguments[1]instanceof bt){var f=arguments[0],u=arguments[1];this.x=f.y-u.y,this.y=u.x-f.x,this.w=f.x*u.y-u.x*f.y}}else if(arguments.length===3){var b=arguments[0],C=arguments[1],A=arguments[2];this.x=b,this.y=C,this.w=A}else if(arguments.length===4){var P=arguments[0],k=arguments[1],Y=arguments[2],X=arguments[3],lt=P.y-k.y,ht=k.x-P.x,_t=P.x*k.y-k.x*P.y,j=Y.y-X.y,W=X.x-Y.x,st=Y.x*X.y-X.x*Y.y;this.x=ht*st-W*_t,this.y=j*_t-lt*st,this.w=lt*W-j*ht}};$o.prototype.getY=function(){var e=this.y/this.w;if(Me.isNaN(e)||Me.isInfinite(e))throw new Kh;return e};$o.prototype.getX=function(){var e=this.x/this.w;if(Me.isNaN(e)||Me.isInfinite(e))throw new Kh;return e};$o.prototype.getCoordinate=function(){var e=new bt;return e.x=this.getX(),e.y=this.getY(),e};$o.prototype.interfaces_=function(){return[]};$o.prototype.getClass=function(){return $o};$o.intersection=function(e,t,n,r){var a=e.y-t.y,c=t.x-e.x,f=e.x*t.y-t.x*e.y,u=n.y-r.y,b=r.x-n.x,C=n.x*r.y-r.x*n.y,A=c*C-b*f,P=u*f-a*C,k=a*b-u*c,Y=A/k,X=P/k;if(Me.isNaN(Y)||Me.isInfinite(Y)||Me.isNaN(X)||Me.isInfinite(X))throw new Kh;return new bt(Y,X)};var ye=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof bt){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.init(r.x,a.x,r.y,a.y)}else if(arguments.length===4){var c=arguments[0],f=arguments[1],u=arguments[2],b=arguments[3];this.init(c,f,u,b)}},i2={serialVersionUID:{configurable:!0}};ye.prototype.getArea=function(){return this.getWidth()*this.getHeight()};ye.prototype.equals=function(e){if(!(e instanceof ye))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()};ye.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new ye;var t=this._minx>e._minx?this._minx:e._minx,n=this._miny>e._miny?this._miny:e._miny,r=this._maxx<e._maxx?this._maxx:e._maxx,a=this._maxy<e._maxy?this._maxy:e._maxy;return new ye(t,r,n,a)};ye.prototype.isNull=function(){return this._maxx<this._minx};ye.prototype.getMaxX=function(){return this._maxx};ye.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof bt){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof ye){var t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}};ye.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof ye){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof bt){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}};ye.prototype.getMinY=function(){return this._miny};ye.prototype.getMinX=function(){return this._minx};ye.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof bt){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof ye){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}};ye.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t};ye.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};ye.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0};ye.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)};ye.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};ye.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};ye.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};ye.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t};ye.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};ye.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof ye){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof bt){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.covers(n,r)}};ye.prototype.centre=function(){return this.isNull()?null:new bt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};ye.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof bt){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof ye){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(arguments.length===4){var a=arguments[0],c=arguments[1],f=arguments[2],u=arguments[3];a<c?(this._minx=a,this._maxx=c):(this._minx=c,this._maxx=a),f<u?(this._miny=f,this._maxy=u):(this._miny=u,this._maxy=f)}};ye.prototype.getMaxY=function(){return this._maxy};ye.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),t===0?n:n===0?t:Math.sqrt(t*t+n*n)};ye.prototype.hashCode=function(){var e=17;return e=37*e+bt.hashCode(this._minx),e=37*e+bt.hashCode(this._maxx),e=37*e+bt.hashCode(this._miny),e=37*e+bt.hashCode(this._maxy),e};ye.prototype.interfaces_=function(){return[Uo,Go]};ye.prototype.getClass=function(){return ye};ye.intersects=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}else if(arguments.length===4){var r=arguments[0],a=arguments[1],c=arguments[2],f=arguments[3],u=Math.min(c.x,f.x),b=Math.max(c.x,f.x),C=Math.min(r.x,a.x),A=Math.max(r.x,a.x);return!(C>b||A<u||(u=Math.min(c.y,f.y),b=Math.max(c.y,f.y),C=Math.min(r.y,a.y),A=Math.max(r.y,a.y),C>b)||A<u)}};i2.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(ye,i2);var ws={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},eg=function(e){this.geometryFactory=e||new $e};eg.prototype.read=function(e){var t,n,r;e=e.replace(/[\n\r]/g," ");var a=ws.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(a=ws.emptyTypeStr.exec(e),a[2]=void 0),a&&(n=a[1].toLowerCase(),r=a[2],bh[n]&&(t=bh[n].apply(this,[r]))),t===void 0)throw new Error("Could not parse WKT "+e);return t};eg.prototype.write=function(e){return this.extractGeometry(e)};eg.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!Ma[t])return null;var n=t.toUpperCase(),r;return e.isEmpty()?r=n+" EMPTY":r=n+"("+Ma[t].apply(this,[e])+")",r};var Ma={coordinate:function(e){return e.x+" "+e.y},point:function(e){return Ma.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=this,n=[],r=0,a=e._geometries.length;r<a;++r)n.push("("+Ma.point.apply(t,[e._geometries[r]])+")");return n.join(",")},linestring:function(e){for(var t=this,n=[],r=0,a=e._points._coordinates.length;r<a;++r)n.push(Ma.coordinate.apply(t,[e._points._coordinates[r]]));return n.join(",")},linearring:function(e){for(var t=this,n=[],r=0,a=e._points._coordinates.length;r<a;++r)n.push(Ma.coordinate.apply(t,[e._points._coordinates[r]]));return n.join(",")},multilinestring:function(e){for(var t=this,n=[],r=0,a=e._geometries.length;r<a;++r)n.push("("+Ma.linestring.apply(t,[e._geometries[r]])+")");return n.join(",")},polygon:function(e){var t=this,n=[];n.push("("+Ma.linestring.apply(this,[e._shell])+")");for(var r=0,a=e._holes.length;r<a;++r)n.push("("+Ma.linestring.apply(t,[e._holes[r]])+")");return n.join(",")},multipolygon:function(e){for(var t=this,n=[],r=0,a=e._geometries.length;r<a;++r)n.push("("+Ma.polygon.apply(t,[e._geometries[r]])+")");return n.join(",")},geometrycollection:function(e){for(var t=this,n=[],r=0,a=e._geometries.length;r<a;++r)n.push(t.extractGeometry(e._geometries[r]));return n.join(",")}},bh={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var t=e.trim().split(ws.spaces);return this.geometryFactory.createPoint(new bt(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var n,r=e.trim().split(","),a=[],c=0,f=r.length;c<f;++c)n=r[c].replace(ws.trimParens,"$1"),a.push(bh.point.apply(t,[n]));return this.geometryFactory.createMultiPoint(a)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var t=e.trim().split(","),n=[],r,a=0,c=t.length;a<c;++a)r=t[a].trim().split(ws.spaces),n.push(new bt(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLineString(n)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var t=e.trim().split(","),n=[],r,a=0,c=t.length;a<c;++a)r=t[a].trim().split(ws.spaces),n.push(new bt(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var n,r=e.trim().split(ws.parenComma),a=[],c=0,f=r.length;c<f;++c)n=r[c].replace(ws.trimParens,"$1"),a.push(bh.linestring.apply(t,[n]));return this.geometryFactory.createMultiLineString(a)},polygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var n,r,a,c=e.trim().split(ws.parenComma),f,u=[],b=0,C=c.length;b<C;++b)n=c[b].replace(ws.trimParens,"$1"),r=bh.linestring.apply(t,[n]),a=t.geometryFactory.createLinearRing(r._points),b===0?f=a:u.push(a);return this.geometryFactory.createPolygon(f,u)},multipolygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var n,r=e.trim().split(ws.doubleParenComma),a=[],c=0,f=r.length;c<f;++c)n=r[c].replace(ws.trimParens,"$1"),a.push(bh.polygon.apply(t,[n]));return this.geometryFactory.createMultiPolygon(a)},geometrycollection:function(e){var t=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=e.trim().split("|"),r=[],a=0,c=n.length;a<c;++a)r.push(t.read(n[a]));return this.geometryFactory.createGeometryCollection(r)}},es=function(e){this.parser=new eg(e)};es.prototype.write=function(e){return this.parser.write(e)};es.toLineString=function(e,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var za=function(e){function t(n){e.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),Vm=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var n=arguments[0];e.call(this,n)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(za),Ue=function(){};Ue.prototype.interfaces_=function(){return[]};Ue.prototype.getClass=function(){return Ue};Ue.shouldNeverReachHere=function(){if(arguments.length===0)Ue.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new Vm("Should never reach here"+(e!==null?": "+e:""))}};Ue.isTrue=function(){var e,t;if(arguments.length===1)e=arguments[0],Ue.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],t=arguments[1],!e))throw t===null?new Vm:new Vm(t)};Ue.equals=function(){var e,t,n;if(arguments.length===2)e=arguments[0],t=arguments[1],Ue.equals(e,t,null);else if(arguments.length===3&&(e=arguments[0],t=arguments[1],n=arguments[2],!t.equals(e)))throw new Vm("Expected "+e+" but encountered "+t+(n!==null?": "+n:""))};var Jn=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new bt,this._intPt[1]=new bt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},cc={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Jn.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]};Jn.prototype.getTopologySummary=function(){var e=new Gs;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};Jn.prototype.computeIntersection=function(e,t,n,r){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(e,t,n,r)};Jn.prototype.getIntersectionNum=function(){return this._result};Jn.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],t=this.getEdgeDistance(e,0),n=this.getEdgeDistance(e,1);t>n?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};Jn.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};Jn.prototype.setPrecisionModel=function(e){this._precisionModel=e};Jn.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var t=arguments[0],n=0;n<this._result;n++)if(!(e._intPt[n].equals2D(e._inputLines[t][0])||e._intPt[n].equals2D(e._inputLines[t][1])))return!0;return!1}};Jn.prototype.getIntersection=function(e){return this._intPt[e]};Jn.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};Jn.prototype.hasIntersection=function(){return this._result!==Jn.NO_INTERSECTION};Jn.prototype.getEdgeDistance=function(e,t){var n=Jn.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1]);return n};Jn.prototype.isCollinear=function(){return this._result===Jn.COLLINEAR_INTERSECTION};Jn.prototype.toString=function(){return es.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+es.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};Jn.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]};Jn.prototype.isIntersection=function(e){for(var t=this,n=0;n<this._result;n++)if(t._intPt[n].equals2D(e))return!0;return!1};Jn.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]};Jn.prototype.interfaces_=function(){return[]};Jn.prototype.getClass=function(){return Jn};Jn.computeEdgeDistance=function(e,t,n){var r=Math.abs(n.x-t.x),a=Math.abs(n.y-t.y),c=-1;if(e.equals(t))c=0;else if(e.equals(n))r>a?c=r:c=a;else{var f=Math.abs(e.x-t.x),u=Math.abs(e.y-t.y);r>a?c=f:c=u,c===0&&!e.equals(t)&&(c=Math.max(f,u))}return Ue.isTrue(!(c===0&&!e.equals(t)),"Bad distance calculation"),c};Jn.nonRobustComputeEdgeDistance=function(e,t,n){var r=e.x-t.x,a=e.y-t.y,c=Math.sqrt(r*r+a*a);return Ue.isTrue(!(c===0&&!e.equals(t)),"Invalid distance calculation"),c};cc.DONT_INTERSECT.get=function(){return 0};cc.DO_INTERSECT.get=function(){return 1};cc.COLLINEAR.get=function(){return 2};cc.NO_INTERSECTION.get=function(){return 0};cc.POINT_INTERSECTION.get=function(){return 1};cc.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(Jn,cc);var du=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(n){var r=new ye(this._inputLines[0][0],this._inputLines[0][1]),a=new ye(this._inputLines[1][0],this._inputLines[1][1]);return r.contains(n)&&a.contains(n)},t.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];if(this._isProper=!1,ye.intersects(r,a,n)&&oe.orientationIndex(r,a,n)===0&&oe.orientationIndex(a,r,n)===0)return this._isProper=!0,(n.equals(r)||n.equals(a))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(n,r,a,c,f){f.x=this.smallestInAbsValue(n.x,r.x,a.x,c.x),f.y=this.smallestInAbsValue(n.y,r.y,a.y,c.y),n.x-=f.x,n.y-=f.y,r.x-=f.x,r.y-=f.y,a.x-=f.x,a.y-=f.y,c.x-=f.x,c.y-=f.y},t.prototype.safeHCoordinateIntersection=function(n,r,a,c){var f=null;try{f=$o.intersection(n,r,a,c)}catch(u){if(u instanceof Kh)f=t.nearestEndpoint(n,r,a,c);else throw u}finally{}return f},t.prototype.intersection=function(n,r,a,c){var f=this.intersectionWithNormalization(n,r,a,c);return this.isInSegmentEnvelopes(f)||(f=new bt(t.nearestEndpoint(n,r,a,c))),this._precisionModel!==null&&this._precisionModel.makePrecise(f),f},t.prototype.smallestInAbsValue=function(n,r,a,c){var f=n,u=Math.abs(f);return Math.abs(r)<u&&(f=r,u=Math.abs(r)),Math.abs(a)<u&&(f=a,u=Math.abs(a)),Math.abs(c)<u&&(f=c),f},t.prototype.checkDD=function(n,r,a,c,f){var u=zi.intersection(n,r,a,c),b=this.isInSegmentEnvelopes(u);ri.out.println("DD in env = "+b+"  --------------------- "+u),f.distance(u)>1e-4&&ri.out.println("Distance = "+f.distance(u))},t.prototype.intersectionWithNormalization=function(n,r,a,c){var f=new bt(n),u=new bt(r),b=new bt(a),C=new bt(c),A=new bt;this.normalizeToEnvCentre(f,u,b,C,A);var P=this.safeHCoordinateIntersection(f,u,b,C);return P.x+=A.x,P.y+=A.y,P},t.prototype.computeCollinearIntersection=function(n,r,a,c){var f=ye.intersects(n,r,a),u=ye.intersects(n,r,c),b=ye.intersects(a,c,n),C=ye.intersects(a,c,r);return f&&u?(this._intPt[0]=a,this._intPt[1]=c,e.COLLINEAR_INTERSECTION):b&&C?(this._intPt[0]=n,this._intPt[1]=r,e.COLLINEAR_INTERSECTION):f&&b?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!u&&!C?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):f&&C?(this._intPt[0]=a,this._intPt[1]=r,a.equals(r)&&!u&&!b?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):u&&b?(this._intPt[0]=c,this._intPt[1]=n,c.equals(n)&&!f&&!C?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):u&&C?(this._intPt[0]=c,this._intPt[1]=r,c.equals(r)&&!f&&!b?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(n,r,a,c,f){var u=n.x<r.x?n.x:r.x,b=n.y<r.y?n.y:r.y,C=n.x>r.x?n.x:r.x,A=n.y>r.y?n.y:r.y,P=a.x<c.x?a.x:c.x,k=a.y<c.y?a.y:c.y,Y=a.x>c.x?a.x:c.x,X=a.y>c.y?a.y:c.y,lt=u>P?u:P,ht=C<Y?C:Y,_t=b>k?b:k,j=A<X?A:X,W=(lt+ht)/2,st=(_t+j)/2;f.x=W,f.y=st,n.x-=f.x,n.y-=f.y,r.x-=f.x,r.y-=f.y,a.x-=f.x,a.y-=f.y,c.x-=f.x,c.y-=f.y},t.prototype.computeIntersect=function(n,r,a,c){if(this._isProper=!1,!ye.intersects(n,r,a,c))return e.NO_INTERSECTION;var f=oe.orientationIndex(n,r,a),u=oe.orientationIndex(n,r,c);if(f>0&&u>0||f<0&&u<0)return e.NO_INTERSECTION;var b=oe.orientationIndex(a,c,n),C=oe.orientationIndex(a,c,r);if(b>0&&C>0||b<0&&C<0)return e.NO_INTERSECTION;var A=f===0&&u===0&&b===0&&C===0;return A?this.computeCollinearIntersection(n,r,a,c):(f===0||u===0||b===0||C===0?(this._isProper=!1,n.equals2D(a)||n.equals2D(c)?this._intPt[0]=n:r.equals2D(a)||r.equals2D(c)?this._intPt[0]=r:f===0?this._intPt[0]=new bt(a):u===0?this._intPt[0]=new bt(c):b===0?this._intPt[0]=new bt(n):C===0&&(this._intPt[0]=new bt(r))):(this._isProper=!0,this._intPt[0]=this.intersection(n,r,a,c)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(n,r,a,c){var f=n,u=oe.distancePointLine(n,a,c),b=oe.distancePointLine(r,a,c);return b<u&&(u=b,f=r),b=oe.distancePointLine(a,n,r),b<u&&(u=b,f=a),b=oe.distancePointLine(c,n,r),b<u&&(u=b,f=c),f},t}(Jn),Xu=function(){};Xu.prototype.interfaces_=function(){return[]};Xu.prototype.getClass=function(){return Xu};Xu.orientationIndex=function(e,t,n){var r=t.x-e.x,a=t.y-e.y,c=n.x-t.x,f=n.y-t.y;return Xu.signOfDet2x2(r,a,c,f)};Xu.signOfDet2x2=function(e,t,n,r){var a=null,c=null,f=null;if(a=1,e===0||r===0)return t===0||n===0?0:t>0?n>0?-a:a:n>0?a:-a;if(t===0||n===0)return r>0?e>0?a:-a:e>0?-a:a;if(t>0?r>0?t<=r||(a=-a,c=e,e=n,n=c,c=t,t=r,r=c):t<=-r?(a=-a,n=-n,r=-r):(c=e,e=-n,n=c,c=t,t=-r,r=c):r>0?-t<=r?(a=-a,e=-e,t=-t):(c=-e,e=n,n=c,c=-t,t=r,r=c):t>=r?(e=-e,t=-t,n=-n,r=-r):(a=-a,c=-e,e=-n,n=c,c=-t,t=-r,r=c),e>0)if(n>0){if(!(e<=n))return a}else return a;else{if(n>0)return-a;if(e>=n)a=-a,e=-e,n=-n;else return-a}for(;;){if(f=Math.floor(n/e),n=n-f*e,r=r-f*t,r<0)return-a;if(r>t)return a;if(e>n+n){if(t<r+r)return a}else{if(t>r+r)return-a;n=e-n,r=t-r,a=-a}if(r===0)return n===0?0:-a;if(n===0||(f=Math.floor(e/n),e=e-f*n,t=t-f*r,t<0))return a;if(t>r)return-a;if(n>e+e){if(r<t+t)return-a}else{if(r>t+t)return a;e=n-e,t=r-t,a=-a}if(t===0)return e===0?0:a;if(e===0)return-a}};var Ts=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};Ts.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,r=t.x;return n>r&&(n=t.x,r=e.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var a=e.x-this._p.x,c=e.y-this._p.y,f=t.x-this._p.x,u=t.y-this._p.y,b=Xu.signOfDet2x2(a,c,f,u);if(b===0)return this._isPointOnSegment=!0,null;u<c&&(b=-b),b>0&&this._crossingCount++}};Ts.prototype.isPointInPolygon=function(){return this.getLocation()!==St.EXTERIOR};Ts.prototype.getLocation=function(){return this._isPointOnSegment?St.BOUNDARY:this._crossingCount%2===1?St.INTERIOR:St.EXTERIOR};Ts.prototype.isOnSegment=function(){return this._isPointOnSegment};Ts.prototype.interfaces_=function(){return[]};Ts.prototype.getClass=function(){return Ts};Ts.locatePointInRing=function(){if(arguments[0]instanceof bt&&Te(arguments[1],un)){for(var e=arguments[0],t=arguments[1],n=new Ts(e),r=new bt,a=new bt,c=1;c<t.size();c++)if(t.getCoordinate(c,r),t.getCoordinate(c-1,a),n.countSegment(r,a),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof bt&&arguments[1]instanceof Array){for(var f=arguments[0],u=arguments[1],b=new Ts(f),C=1;C<u.length;C++){var A=u[C],P=u[C-1];if(b.countSegment(A,P),b.isOnSegment())return b.getLocation()}return b.getLocation()}};var oe=function(){},hc={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};oe.prototype.interfaces_=function(){return[]};oe.prototype.getClass=function(){return oe};oe.orientationIndex=function(e,t,n){return zi.orientationIndex(e,t,n)};oe.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,r=1;r<e.length-1;r++){var a=e[r].x-n,c=e[r+1].y,f=e[r-1].y;t+=a*(f-c)}return t/2}else if(Te(arguments[0],un)){var u=arguments[0],b=u.size();if(b<3)return 0;var C=new bt,A=new bt,P=new bt;u.getCoordinate(0,A),u.getCoordinate(1,P);var k=A.x;P.x-=k;for(var Y=0,X=1;X<b-1;X++)C.y=A.y,A.x=P.x,A.y=P.y,u.getCoordinate(X+1,P),P.x-=k,Y+=A.x*(C.y-P.y);return Y/2}};oe.distanceLineLine=function(e,t,n,r){if(e.equals(t))return oe.distancePointLine(e,n,r);if(n.equals(r))return oe.distancePointLine(r,e,t);var a=!1;if(!ye.intersects(e,t,n,r))a=!0;else{var c=(t.x-e.x)*(r.y-n.y)-(t.y-e.y)*(r.x-n.x);if(c===0)a=!0;else{var f=(e.y-n.y)*(r.x-n.x)-(e.x-n.x)*(r.y-n.y),u=(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y),b=u/c,C=f/c;(C<0||C>1||b<0||b>1)&&(a=!0)}}return a?Io.min(oe.distancePointLine(e,n,r),oe.distancePointLine(t,n,r),oe.distancePointLine(n,e,t),oe.distancePointLine(r,e,t)):0};oe.isPointInRing=function(e,t){return oe.locatePointInRing(e,t)!==St.EXTERIOR};oe.computeLength=function(e){var t=e.size();if(t<=1)return 0;var n=0,r=new bt;e.getCoordinate(0,r);for(var a=r.x,c=r.y,f=1;f<t;f++){e.getCoordinate(f,r);var u=r.x,b=r.y,C=u-a,A=b-c;n+=Math.sqrt(C*C+A*A),a=u,c=b}return n};oe.isCCW=function(e){var t=e.length-1;if(t<3)throw new jn("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=e[0],r=0,a=1;a<=t;a++){var c=e[a];c.y>n.y&&(n=c,r=a)}var f=r;do f=f-1,f<0&&(f=t);while(e[f].equals2D(n)&&f!==r);var u=r;do u=(u+1)%t;while(e[u].equals2D(n)&&u!==r);var b=e[f],C=e[u];if(b.equals2D(n)||C.equals2D(n)||b.equals2D(C))return!1;var A=oe.computeOrientation(b,n,C),P=!1;return A===0?P=b.x>C.x:P=A>0,P};oe.locatePointInRing=function(e,t){return Ts.locatePointInRing(e,t)};oe.distancePointLinePerpendicular=function(e,t,n){var r=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),a=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/r;return Math.abs(a)*Math.sqrt(r)};oe.computeOrientation=function(e,t,n){return oe.orientationIndex(e,t,n)};oe.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(t.length===0)throw new jn("Line array must contain at least one vertex");for(var n=e.distance(t[0]),r=0;r<t.length-1;r++){var a=oe.distancePointLine(e,t[r],t[r+1]);a<n&&(n=a)}return n}else if(arguments.length===3){var c=arguments[0],f=arguments[1],u=arguments[2];if(f.x===u.x&&f.y===u.y)return c.distance(f);var b=(u.x-f.x)*(u.x-f.x)+(u.y-f.y)*(u.y-f.y),C=((c.x-f.x)*(u.x-f.x)+(c.y-f.y)*(u.y-f.y))/b;if(C<=0)return c.distance(f);if(C>=1)return c.distance(u);var A=((f.y-c.y)*(u.x-f.x)-(f.x-c.x)*(u.y-f.y))/b;return Math.abs(A)*Math.sqrt(b)}};oe.isOnLine=function(e,t){for(var n=new du,r=1;r<t.length;r++){var a=t[r-1],c=t[r];if(n.computeIntersection(e,a,c),n.hasIntersection())return!0}return!1};hc.CLOCKWISE.get=function(){return-1};hc.RIGHT.get=function(){return oe.CLOCKWISE};hc.COUNTERCLOCKWISE.get=function(){return 1};hc.LEFT.get=function(){return oe.COUNTERCLOCKWISE};hc.COLLINEAR.get=function(){return 0};hc.STRAIGHT.get=function(){return oe.COLLINEAR};Object.defineProperties(oe,hc);var Fa=function(){};Fa.prototype.filter=function(e){};Fa.prototype.interfaces_=function(){return[]};Fa.prototype.getClass=function(){return Fa};var Ee=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},ga={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Ee.prototype.isGeometryCollection=function(){return this.getSortIndex()===Ee.SORTINDEX_GEOMETRYCOLLECTION};Ee.prototype.getFactory=function(){return this._factory};Ee.prototype.getGeometryN=function(e){return this};Ee.prototype.getArea=function(){return 0};Ee.prototype.isRectangle=function(){return!1};Ee.prototype.equals=function(){if(arguments[0]instanceof Ee){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof Ee))return!1;var n=t;return this.equalsExact(n)}};Ee.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};Ee.prototype.geometryChanged=function(){this.apply(Ee.geometryChangedFilter)};Ee.prototype.geometryChangedAction=function(){this._envelope=null};Ee.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};Ee.prototype.getLength=function(){return 0};Ee.prototype.getNumGeometries=function(){return 1};Ee.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}};Ee.prototype.getUserData=function(){return this._userData};Ee.prototype.getSRID=function(){return this._SRID};Ee.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};Ee.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===Ee.SORTINDEX_GEOMETRYCOLLECTION)throw new jn("This method does not support GeometryCollection arguments")};Ee.prototype.equal=function(e,t,n){return n===0?e.equals(t):e.distance(t)<=n};Ee.prototype.norm=function(){var e=this.copy();return e.normalize(),e};Ee.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Ee.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new ye(this._envelope)};Ee.prototype.setSRID=function(e){this._SRID=e};Ee.prototype.setUserData=function(e){this._userData=e};Ee.prototype.compare=function(e,t){for(var n=e.iterator(),r=t.iterator();n.hasNext()&&r.hasNext();){var a=n.next(),c=r.next(),f=a.compareTo(c);if(f!==0)return f}return n.hasNext()?1:r.hasNext()?-1:0};Ee.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Ee.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Ee.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Ee.SORTINDEX_MULTIPOINT||this.getSortIndex()===Ee.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Ee.SORTINDEX_MULTIPOLYGON};Ee.prototype.interfaces_=function(){return[tg,Uo,Go]};Ee.prototype.getClass=function(){return Ee};Ee.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1};Ee.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(e[t]===null)return!0;return!1};ga.serialVersionUID.get=function(){return 8763622679187377e3};ga.SORTINDEX_POINT.get=function(){return 0};ga.SORTINDEX_MULTIPOINT.get=function(){return 1};ga.SORTINDEX_LINESTRING.get=function(){return 2};ga.SORTINDEX_LINEARRING.get=function(){return 3};ga.SORTINDEX_MULTILINESTRING.get=function(){return 4};ga.SORTINDEX_POLYGON.get=function(){return 5};ga.SORTINDEX_MULTIPOLYGON.get=function(){return 6};ga.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};ga.geometryChangedFilter.get=function(){return Q_};Object.defineProperties(Ee,ga);var Q_=function(){};Q_.interfaces_=function(){return[Fa]};Q_.filter=function(e){e.geometryChangedAction()};var sa=function(){};sa.prototype.filter=function(e){};sa.prototype.interfaces_=function(){return[]};sa.prototype.getClass=function(){return sa};var Fo=function(){},ja={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Fo.prototype.isInBoundary=function(e){};Fo.prototype.interfaces_=function(){return[]};Fo.prototype.getClass=function(){return Fo};ja.Mod2BoundaryNodeRule.get=function(){return Ah};ja.EndPointBoundaryNodeRule.get=function(){return Mh};ja.MultiValentEndPointBoundaryNodeRule.get=function(){return Dh};ja.MonoValentEndPointBoundaryNodeRule.get=function(){return kh};ja.MOD2_BOUNDARY_RULE.get=function(){return new Ah};ja.ENDPOINT_BOUNDARY_RULE.get=function(){return new Mh};ja.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Dh};ja.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new kh};ja.OGC_SFS_BOUNDARY_RULE.get=function(){return Fo.MOD2_BOUNDARY_RULE};Object.defineProperties(Fo,ja);var Ah=function(){};Ah.prototype.isInBoundary=function(e){return e%2===1};Ah.prototype.interfaces_=function(){return[Fo]};Ah.prototype.getClass=function(){return Ah};var Mh=function(){};Mh.prototype.isInBoundary=function(e){return e>0};Mh.prototype.interfaces_=function(){return[Fo]};Mh.prototype.getClass=function(){return Mh};var Dh=function(){};Dh.prototype.isInBoundary=function(e){return e>1};Dh.prototype.interfaces_=function(){return[Fo]};Dh.prototype.getClass=function(){return Dh};var kh=function(){};kh.prototype.isInBoundary=function(e){return e===1};kh.prototype.interfaces_=function(){return[Fo]};kh.prototype.getClass=function(){return kh};var Sr=function(){};Sr.prototype.add=function(){};Sr.prototype.addAll=function(){};Sr.prototype.isEmpty=function(){};Sr.prototype.iterator=function(){};Sr.prototype.size=function(){};Sr.prototype.toArray=function(){};Sr.prototype.remove=function(){};function $_(e){this.message=e||""}$_.prototype=new Error;$_.prototype.name="IndexOutOfBoundsException";var Jh=function(){};Jh.prototype.hasNext=function(){};Jh.prototype.next=function(){};Jh.prototype.remove=function(){};var ts=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(Sr);function Qh(e){this.message=e||""}Qh.prototype=new Error;Qh.prototype.name="NoSuchElementException";var Qt=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Sr&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,Sr]},t.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(n){for(var r=this,a=n.iterator();a.hasNext();)r.add(a.next());return!0},t.prototype.set=function(n,r){var a=this.array_[n];return this.array_[n]=r,a},t.prototype.iterator=function(){return new cM(this)},t.prototype.get=function(n){if(n<0||n>=this.size())throw new $_;return this.array_[n]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var n=this,r=[],a=0,c=this.array_.length;a<c;a++)r.push(n.array_[a]);return r},t.prototype.remove=function(n){for(var r=this,a=!1,c=0,f=this.array_.length;c<f;c++)if(r.array_[c]===n){r.array_.splice(c,1),a=!0;break}return a},t}(ts),cM=function(e){function t(n){e.call(this),this.arrayList_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Qh;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(Jh),qf=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];this.ensureCapacity(a.length),this.add(a,c)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(r){return this.get(r)},t.prototype.addAll=function(){var r=this;if(arguments.length===2){for(var a=arguments[0],c=arguments[1],f=!1,u=a.iterator();u.hasNext();)r.add(u.next(),c),f=!0;return f}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var r=this,a=e.prototype.clone.call(this),c=0;c<this.size();c++)a.add(c,r.get(c).copy());return a},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var r=this;if(arguments.length===1){var a=arguments[0];e.prototype.add.call(this,a)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var c=arguments[0],f=arguments[1];return this.add(c,f,!0),!0}else if(arguments[0]instanceof bt&&typeof arguments[1]=="boolean"){var u=arguments[0],b=arguments[1];if(!b&&this.size()>=1){var C=this.get(this.size()-1);if(C.equals2D(u))return null}e.prototype.add.call(this,u)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var A=arguments[0],P=arguments[1];return this.add(A,P),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var k=arguments[0],Y=arguments[1],X=arguments[2];if(X)for(var lt=0;lt<k.length;lt++)r.add(k[lt],Y);else for(var ht=k.length-1;ht>=0;ht--)r.add(k[ht],Y);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof bt){var _t=arguments[0],j=arguments[1],W=arguments[2];if(!W){var st=this.size();if(st>0){if(_t>0){var gt=this.get(_t-1);if(gt.equals2D(j))return null}if(_t<st){var Lt=this.get(_t);if(Lt.equals2D(j))return null}}}e.prototype.add.call(this,_t,j)}}else if(arguments.length===4){var At=arguments[0],Tt=arguments[1],Vt=arguments[2],Yt=arguments[3],J=1;Vt>Yt&&(J=-1);for(var Ut=Vt;Ut!==Yt;Ut+=J)r.add(At[Ut],Tt);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new bt(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(Qt),Ke=function(){},ng={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};ng.ForwardComparator.get=function(){return If};ng.BidirectionalComparator.get=function(){return Rh};ng.coordArrayType.get=function(){return new Array(0).fill(null)};Ke.prototype.interfaces_=function(){return[]};Ke.prototype.getClass=function(){return Ke};Ke.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};Ke.ptNotInList=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(Ke.indexOf(r,t)<0)return r}return null};Ke.scroll=function(e,t){var n=Ke.indexOf(t,e);if(n<0)return null;var r=new Array(e.length).fill(null);ri.arraycopy(e,n,r,0,e.length-n),ri.arraycopy(e,0,r,e.length-n,n),ri.arraycopy(r,0,e,0,e.length)};Ke.equals=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(e===null||t===null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}else if(arguments.length===3){var r=arguments[0],a=arguments[1],c=arguments[2];if(r===a)return!0;if(r===null||a===null||r.length!==a.length)return!1;for(var f=0;f<r.length;f++)if(c.compare(r[f],a[f])!==0)return!1;return!0}};Ke.intersection=function(e,t){for(var n=new qf,r=0;r<e.length;r++)t.intersects(e[r])&&n.add(e[r],!0);return n.toCoordinateArray()};Ke.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1};Ke.removeRepeatedPoints=function(e){if(!Ke.hasRepeatedPoints(e))return e;var t=new qf(e,!1);return t.toCoordinateArray()};Ke.reverse=function(e){for(var t=e.length-1,n=Math.trunc(t/2),r=0;r<=n;r++){var a=e[r];e[r]=e[t-r],e[t-r]=a}};Ke.removeNull=function(e){for(var t=0,n=0;n<e.length;n++)e[n]!==null&&t++;var r=new Array(t).fill(null);if(t===0)return r;for(var a=0,c=0;c<e.length;c++)e[c]!==null&&(r[a++]=e[c]);return r};Ke.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=new bt(e[n]);return t}else if(arguments.length===5)for(var r=arguments[0],a=arguments[1],c=arguments[2],f=arguments[3],u=arguments[4],b=0;b<u;b++)c[f+b]=new bt(r[a+b])};Ke.isEqualReversed=function(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=t[e.length-n-1];if(r.compareTo(a)!==0)return!1}return!0};Ke.envelope=function(e){for(var t=new ye,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t};Ke.toCoordinateArray=function(e){return e.toArray(Ke.coordArrayType)};Ke.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]};Ke.indexOf=function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1};Ke.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,r=e[t].compareTo(e[n]);if(r!==0)return r}return 1};Ke.compare=function(e,t){for(var n=0;n<e.length&&n<t.length;){var r=e[n].compareTo(t[n]);if(r!==0)return r;n++}return n<t.length?-1:n<e.length?1:0};Ke.minCoordinate=function(e){for(var t=null,n=0;n<e.length;n++)(t===null||t.compareTo(e[n])>0)&&(t=e[n]);return t};Ke.extract=function(e,t,n){t=Io.clamp(t,0,e.length),n=Io.clamp(n,-1,e.length);var r=n-t+1;n<0&&(r=0),t>=e.length&&(r=0),n<t&&(r=0);var a=new Array(r).fill(null);if(r===0)return a;for(var c=0,f=t;f<=n;f++)a[c++]=e[f];return a};Object.defineProperties(Ke,ng);var If=function(){};If.prototype.compare=function(e,t){var n=e,r=t;return Ke.compare(n,r)};If.prototype.interfaces_=function(){return[Lh]};If.prototype.getClass=function(){return If};var Rh=function(){};Rh.prototype.compare=function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;var a=Ke.compare(n,r),c=Ke.isEqualReversed(n,r);return c?0:a};Rh.prototype.OLDcompare=function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;for(var a=Ke.increasingDirection(n),c=Ke.increasingDirection(r),f=a>0?0:n.length-1,u=c>0?0:n.length-1,b=0;b<n.length;b++){var C=n[f].compareTo(r[u]);if(C!==0)return C;f+=a,u+=c}return 0};Rh.prototype.interfaces_=function(){return[Lh]};Rh.prototype.getClass=function(){return Rh};var pc=function(){};pc.prototype.get=function(){};pc.prototype.put=function(){};pc.prototype.size=function(){};pc.prototype.values=function(){};pc.prototype.entrySet=function(){};var hM=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(pc);function jf(e){this.message=e||""}jf.prototype=new Error;jf.prototype.name="OperationNotSupported";function rg(){}rg.prototype=new Sr;rg.prototype.contains=function(){};var t0=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Sr&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(n){for(var r=this,a=0,c=this.array_.length;a<c;a++){var f=r.array_[a];if(f===n)return!0}return!1},t.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},t.prototype.addAll=function(n){for(var r=this,a=n.iterator();a.hasNext();)r.add(a.next());return!0},t.prototype.remove=function(n){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var n=this,r=[],a=0,c=this.array_.length;a<c;a++)r.push(n.array_[a]);return r},t.prototype.iterator=function(){return new pM(this)},t}(rg),pM=function(e){function t(n){e.call(this),this.hashSet_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Qh;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new jf},t}(Jh),ka=0,Yl=1;function Fx(e){return e===null?ka:e.color}function Dn(e){return e===null?null:e.parent}function Pa(e,t){e!==null&&(e.color=t)}function jy(e){return e===null?null:e.left}function Bx(e){return e===null?null:e.right}function ci(){this.root_=null,this.size_=0}ci.prototype=new hM;ci.prototype.get=function(e){for(var t=this.root_;t!==null;){var n=e.compareTo(t.key);if(n<0)t=t.left;else if(n>0)t=t.right;else return t.value}return null};ci.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:ka,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,r,a;do if(r=n,a=e.compareTo(n.key),a<0)n=n.left;else if(a>0)n=n.right;else{var c=n.value;return n.value=t,c}while(n!==null);var f={key:e,left:null,right:null,value:t,parent:r,color:ka,getValue:function(){return this.value},getKey:function(){return this.key}};return a<0?r.left=f:r.right=f,this.fixAfterInsertion(f),this.size_++,null};ci.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=Yl;e!=null&&e!==this.root_&&e.parent.color===Yl;)if(Dn(e)===jy(Dn(Dn(e)))){var n=Bx(Dn(Dn(e)));Fx(n)===Yl?(Pa(Dn(e),ka),Pa(n,ka),Pa(Dn(Dn(e)),Yl),e=Dn(Dn(e))):(e===Bx(Dn(e))&&(e=Dn(e),t.rotateLeft(e)),Pa(Dn(e),ka),Pa(Dn(Dn(e)),Yl),t.rotateRight(Dn(Dn(e))))}else{var r=jy(Dn(Dn(e)));Fx(r)===Yl?(Pa(Dn(e),ka),Pa(r,ka),Pa(Dn(Dn(e)),Yl),e=Dn(Dn(e))):(e===jy(Dn(e))&&(e=Dn(e),t.rotateRight(e)),Pa(Dn(e),ka),Pa(Dn(Dn(e)),Yl),t.rotateLeft(Dn(Dn(e))))}this.root_.color=ka};ci.prototype.values=function(){var e=new Qt,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=ci.successor(t))!==null;)e.add(t.value);return e};ci.prototype.entrySet=function(){var e=new t0,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=ci.successor(t))!==null;)e.add(t);return e};ci.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};ci.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};ci.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};ci.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var n=e.parent,r=e;n!==null&&r===n.right;)r=n,n=n.parent;return n}};ci.prototype.size=function(){return this.size_};var Ef=function(){};Ef.prototype.interfaces_=function(){return[]};Ef.prototype.getClass=function(){return Ef};function o2(){}o2.prototype=new rg;function As(){this.array_=[],arguments[0]instanceof Sr&&this.addAll(arguments[0])}As.prototype=new o2;As.prototype.contains=function(e){for(var t=this,n=0,r=this.array_.length;n<r;n++){var a=t.array_[n];if(a.compareTo(e)===0)return!0}return!1};As.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var n=0,r=this.array_.length;n<r;n++){var a=t.array_[n];if(a.compareTo(e)===1)return t.array_.splice(n,0,e),!0}return this.array_.push(e),!0};As.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next());return!0};As.prototype.remove=function(e){throw new jf};As.prototype.size=function(){return this.array_.length};As.prototype.isEmpty=function(){return this.array_.length===0};As.prototype.toArray=function(){for(var e=this,t=[],n=0,r=this.array_.length;n<r;n++)t.push(e.array_[n]);return t};As.prototype.iterator=function(){return new ig(this)};var ig=function(e){this.treeSet_=e,this.position_=0};ig.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Qh;return this.treeSet_.array_[this.position_++]};ig.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};ig.prototype.remove=function(){throw new jf};var tu=function(){};tu.sort=function(){var e=arguments[0],t,n,r,a;if(arguments.length===1)a=function(f,u){return f.compareTo(u)},e.sort(a);else if(arguments.length===2)r=arguments[1],a=function(f,u){return r.compare(f,u)},e.sort(a);else if(arguments.length===3){n=e.slice(arguments[1],arguments[2]),n.sort();var c=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length));for(e.splice(0,e.length),t=0;t<c.length;t++)e.push(c[t])}else if(arguments.length===4)for(n=e.slice(arguments[1],arguments[2]),r=arguments[3],a=function(f,u){return r.compare(f,u)},n.sort(a),c=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<c.length;t++)e.push(c[t])};tu.asList=function(e){for(var t=new Qt,n=0,r=e.length;n<r;n++)t.add(e[n]);return t};var fn=function(){},cs={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};cs.P.get=function(){return 0};cs.L.get=function(){return 1};cs.A.get=function(){return 2};cs.FALSE.get=function(){return-1};cs.TRUE.get=function(){return-2};cs.DONTCARE.get=function(){return-3};cs.SYM_FALSE.get=function(){return"F"};cs.SYM_TRUE.get=function(){return"T"};cs.SYM_DONTCARE.get=function(){return"*"};cs.SYM_P.get=function(){return"0"};cs.SYM_L.get=function(){return"1"};cs.SYM_A.get=function(){return"2"};fn.prototype.interfaces_=function(){return[]};fn.prototype.getClass=function(){return fn};fn.toDimensionSymbol=function(e){switch(e){case fn.FALSE:return fn.SYM_FALSE;case fn.TRUE:return fn.SYM_TRUE;case fn.DONTCARE:return fn.SYM_DONTCARE;case fn.P:return fn.SYM_P;case fn.L:return fn.SYM_L;case fn.A:return fn.SYM_A}throw new jn("Unknown dimension value: "+e)};fn.toDimensionValue=function(e){switch(Sf.toUpperCase(e)){case fn.SYM_FALSE:return fn.FALSE;case fn.SYM_TRUE:return fn.TRUE;case fn.SYM_DONTCARE:return fn.DONTCARE;case fn.SYM_P:return fn.P;case fn.SYM_L:return fn.L;case fn.SYM_A:return fn.A}throw new jn("Unknown dimension symbol: "+e)};Object.defineProperties(fn,cs);var Ms=function(){};Ms.prototype.filter=function(e){};Ms.prototype.interfaces_=function(){return[]};Ms.prototype.getClass=function(){return Ms};var ns=function(){};ns.prototype.filter=function(e,t){};ns.prototype.isDone=function(){};ns.prototype.isGeometryChanged=function(){};ns.prototype.interfaces_=function(){return[]};ns.prototype.getClass=function(){return ns};var Ei=function(e){function t(r,a){if(e.call(this,a),this._geometries=r||[],e.hasNullElements(this._geometries))throw new jn("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var r=this,a=new ye,c=0;c<this._geometries.length;c++)a.expandToInclude(r._geometries[c].getEnvelopeInternal());return a},t.prototype.getGeometryN=function(r){return this._geometries[r]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var r=this,a=new Array(this.getNumPoints()).fill(null),c=-1,f=0;f<this._geometries.length;f++)for(var u=r._geometries[f].getCoordinates(),b=0;b<u.length;b++)c++,a[c]=u[b];return a},t.prototype.getArea=function(){for(var r=this,a=0,c=0;c<this._geometries.length;c++)a+=r._geometries[c].getArea();return a},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var a=arguments[0],c=arguments[1];if(!this.isEquivalentClass(a))return!1;var f=a;if(this._geometries.length!==f._geometries.length)return!1;for(var u=0;u<this._geometries.length;u++)if(!r._geometries[u].equalsExact(f._geometries[u],c))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var r=this,a=0;a<this._geometries.length;a++)r._geometries[a].normalize();tu.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var r=this,a=fn.FALSE,c=0;c<this._geometries.length;c++)a=Math.max(a,r._geometries[c].getBoundaryDimension());return a},t.prototype.getDimension=function(){for(var r=this,a=fn.FALSE,c=0;c<this._geometries.length;c++)a=Math.max(a,r._geometries[c].getDimension());return a},t.prototype.getLength=function(){for(var r=this,a=0,c=0;c<this._geometries.length;c++)a+=r._geometries[c].getLength();return a},t.prototype.getNumPoints=function(){for(var r=this,a=0,c=0;c<this._geometries.length;c++)a+=r._geometries[c].getNumPoints();return a},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var r=this,a=this._geometries.length,c=new Array(a).fill(null),f=0;f<this._geometries.length;f++)c[f]=r._geometries[f].reverse();return this.getFactory().createGeometryCollection(c)},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var a=arguments[0],c=new As(tu.asList(this._geometries)),f=new As(tu.asList(a._geometries));return this.compare(c,f)}else if(arguments.length===2){for(var u=arguments[0],b=arguments[1],C=u,A=this.getNumGeometries(),P=C.getNumGeometries(),k=0;k<A&&k<P;){var Y=r.getGeometryN(k),X=C.getGeometryN(k),lt=Y.compareToSameClass(X,b);if(lt!==0)return lt;k++}return k<A?1:k<P?-1:0}},t.prototype.apply=function(){var r=this;if(Te(arguments[0],sa))for(var a=arguments[0],c=0;c<this._geometries.length;c++)r._geometries[c].apply(a);else if(Te(arguments[0],ns)){var f=arguments[0];if(this._geometries.length===0)return null;for(var u=0;u<this._geometries.length&&(r._geometries[u].apply(f),!f.isDone());u++);f.isGeometryChanged()&&this.geometryChanged()}else if(Te(arguments[0],Ms)){var b=arguments[0];b.filter(this);for(var C=0;C<this._geometries.length;C++)r._geometries[C].apply(b)}else if(Te(arguments[0],Fa)){var A=arguments[0];A.filter(this);for(var P=0;P<this._geometries.length;P++)r._geometries[P].apply(A)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Ue.shouldNeverReachHere(),null},t.prototype.clone=function(){var r=this,a=e.prototype.clone.call(this);a._geometries=new Array(this._geometries.length).fill(null);for(var c=0;c<this._geometries.length;c++)a._geometries[c]=r._geometries[c].clone();return a},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var r=this,a=new Array(this._geometries.length).fill(null),c=0;c<a.length;c++)a[c]=r._geometries[c].copy();return new t(a,this._factory)},t.prototype.isEmpty=function(){for(var r=this,a=0;a<this._geometries.length;a++)if(!r._geometries[a].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,n),t}(Ee),ru=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Ee.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.isEquivalentClass(r)?e.prototype.equalsExact.call(this,r,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?fn.FALSE:0},t.prototype.isClosed=function(){var r=this;if(this.isEmpty())return!1;for(var a=0;a<this._geometries.length;a++)if(!r._geometries[a].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var r=this,a=this._geometries.length,c=new Array(a).fill(null),f=0;f<this._geometries.length;f++)c[a-1-f]=r._geometries[f].reverse();return this.getFactory().createMultiLineString(c)},t.prototype.getBoundary=function(){return new No(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var r=this,a=new Array(this._geometries.length).fill(null),c=0;c<a.length;c++)a[c]=r._geometries[c].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[Ef]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,n),t}(Ei),No=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],t=Fo.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};No.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return t.length===1?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)};No.prototype.getBoundary=function(){return this._geom instanceof ir?this.boundaryLineString(this._geom):this._geom instanceof ru?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};No.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var t=this._bnRule.isInBoundary(2);return t?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};No.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};No.prototype.computeBoundaryCoordinates=function(e){var t=this,n=new Qt;this._endpointMap=new ci;for(var r=0;r<e.getNumGeometries();r++){var a=e.getGeometryN(r);a.getNumPoints()!==0&&(t.addEndpoint(a.getCoordinateN(0)),t.addEndpoint(a.getCoordinateN(a.getNumPoints()-1)))}for(var c=this._endpointMap.entrySet().iterator();c.hasNext();){var f=c.next(),u=f.getValue(),b=u.count;t._bnRule.isInBoundary(b)&&n.add(f.getKey())}return Ke.toCoordinateArray(n)};No.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);t===null&&(t=new Um,this._endpointMap.put(e,t)),t.count++};No.prototype.interfaces_=function(){return[]};No.prototype.getClass=function(){return No};No.getBoundary=function(){if(arguments.length===1){var e=arguments[0],t=new No(e);return t.getBoundary()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=new No(n,r);return a.getBoundary()}};var Um=function(){this.count=null};Um.prototype.interfaces_=function(){return[]};Um.prototype.getClass=function(){return Um};function fM(){}function dM(){}var mM=function(){};function gM(){}function yM(){}function _M(){}var Oo=function(){},e0={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Oo.prototype.interfaces_=function(){return[]};Oo.prototype.getClass=function(){return Oo};Oo.chars=function(e,t){for(var n=new Array(t).fill(null),r=0;r<t;r++)n[r]=e;return String(n)};Oo.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],t=new gM,n=new fM;return e.printStackTrace(n),t.toString()}else if(arguments.length===2){var r=arguments[0],a=arguments[1],c="";new dM(Oo.getStackTrace(r));for(var f=new _M,u=0;u<a;u++)try{c+=f.readLine()+Oo.NEWLINE}catch(b){if(b instanceof yM)Ue.shouldNeverReachHere();else throw b}finally{}return c}};Oo.split=function(e,t){for(var n=t.length,r=new Qt,a=""+e,c=a.indexOf(t);c>=0;){var f=a.substring(0,c);r.add(f),a=a.substring(c+n),c=a.indexOf(t)}a.length>0&&r.add(a);for(var u=new Array(r.size()).fill(null),b=0;b<u.length;b++)u[b]=r.get(b);return u};Oo.toString=function(){if(arguments.length===1){var e=arguments[0];return Oo.SIMPLE_ORDINATE_FORMAT.format(e)}};Oo.spaces=function(e){return Oo.chars(" ",e)};e0.NEWLINE.get=function(){return ri.getProperty("line.separator")};e0.SIMPLE_ORDINATE_FORMAT.get=function(){return new mM};Object.defineProperties(Oo,e0);var fr=function(){};fr.prototype.interfaces_=function(){return[]};fr.prototype.getClass=function(){return fr};fr.copyCoord=function(e,t,n,r){for(var a=Math.min(e.getDimension(),n.getDimension()),c=0;c<a;c++)n.setOrdinate(r,c,e.getOrdinate(t,c))};fr.isRing=function(e){var t=e.size();return t===0?!0:t<=3?!1:e.getOrdinate(0,un.X)===e.getOrdinate(t-1,un.X)&&e.getOrdinate(0,un.Y)===e.getOrdinate(t-1,un.Y)};fr.isEqual=function(e,t){var n=e.size(),r=t.size();if(n!==r)return!1;for(var a=Math.min(e.getDimension(),t.getDimension()),c=0;c<n;c++)for(var f=0;f<a;f++){var u=e.getOrdinate(c,f),b=t.getOrdinate(c,f);if(e.getOrdinate(c,f)!==t.getOrdinate(c,f)&&!(Me.isNaN(u)&&Me.isNaN(b)))return!1}return!0};fr.extend=function(e,t,n){var r=e.create(n,t.getDimension()),a=t.size();if(fr.copy(t,0,r,0,a),a>0)for(var c=a;c<n;c++)fr.copy(t,a-1,r,c,1);return r};fr.reverse=function(e){for(var t=e.size()-1,n=Math.trunc(t/2),r=0;r<=n;r++)fr.swap(e,r,t-r)};fr.swap=function(e,t,n){if(t===n)return null;for(var r=0;r<e.getDimension();r++){var a=e.getOrdinate(t,r);e.setOrdinate(t,r,e.getOrdinate(n,r)),e.setOrdinate(n,r,a)}};fr.copy=function(e,t,n,r,a){for(var c=0;c<a;c++)fr.copyCoord(e,t+c,n,r+c)};fr.toString=function(){if(arguments.length===1){var e=arguments[0],t=e.size();if(t===0)return"()";var n=e.getDimension(),r=new Gs;r.append("(");for(var a=0;a<t;a++){a>0&&r.append(" ");for(var c=0;c<n;c++)c>0&&r.append(","),r.append(Oo.toString(e.getOrdinate(a,c)))}return r.append(")"),r.toString()}};fr.ensureValidRing=function(e,t){var n=t.size();if(n===0)return t;if(n<=3)return fr.createClosedRing(e,t,4);var r=t.getOrdinate(0,un.X)===t.getOrdinate(n-1,un.X)&&t.getOrdinate(0,un.Y)===t.getOrdinate(n-1,un.Y);return r?t:fr.createClosedRing(e,t,n+1)};fr.createClosedRing=function(e,t,n){var r=e.create(n,t.getDimension()),a=t.size();fr.copy(t,0,r,0,a);for(var c=a;c<n;c++)fr.copy(t,0,r,c,1);return r};var ir=function(e){function t(r,a){e.call(this,a),this._points=null,this.init(r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new ye:this._points.expandEnvelope(new ye)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var a=arguments[0],c=arguments[1];if(!this.isEquivalentClass(a))return!1;var f=a;if(this._points.size()!==f._points.size())return!1;for(var u=0;u<this._points.size();u++)if(!r.equal(r._points.getCoordinate(u),f._points.getCoordinate(u),c))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var r=this,a=0;a<Math.trunc(this._points.size()/2);a++){var c=r._points.size()-1-a;if(!r._points.getCoordinate(a).equals(r._points.getCoordinate(c)))return r._points.getCoordinate(a).compareTo(r._points.getCoordinate(c))>0&&fr.reverse(r._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?fn.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return oe.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var r=this._points.copy();fr.reverse(r);var a=this.getFactory().createLineString(r);return a},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){for(var a=arguments[0],c=a,f=0,u=0;f<this._points.size()&&u<c._points.size();){var b=r._points.getCoordinate(f).compareTo(c._points.getCoordinate(u));if(b!==0)return b;f++,u++}return f<this._points.size()?1:u<c._points.size()?-1:0}else if(arguments.length===2){var C=arguments[0],A=arguments[1],P=C;return A.compare(this._points,P._points)}},t.prototype.apply=function(){var r=this;if(Te(arguments[0],sa))for(var a=arguments[0],c=0;c<this._points.size();c++)a.filter(r._points.getCoordinate(c));else if(Te(arguments[0],ns)){var f=arguments[0];if(this._points.size()===0)return null;for(var u=0;u<this._points.size()&&(f.filter(r._points,u),!f.isDone());u++);f.isGeometryChanged()&&this.geometryChanged()}else if(Te(arguments[0],Ms)){var b=arguments[0];b.filter(this)}else if(Te(arguments[0],Fa)){var C=arguments[0];C.filter(this)}},t.prototype.getBoundary=function(){return new No(this).getBoundary()},t.prototype.isEquivalentClass=function(r){return r instanceof t},t.prototype.clone=function(){var r=e.prototype.clone.call(this);return r._points=this._points.clone(),r},t.prototype.getCoordinateN=function(r){return this._points.getCoordinate(r)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(r){if(r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),r.size()===1)throw new jn("Invalid number of points in LineString (found "+r.size()+" - must be 0 or >= 2)");this._points=r},t.prototype.isCoordinate=function(r){for(var a=this,c=0;c<this._points.size();c++)if(a._points.getCoordinate(c).equals(r))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(r){return this.getFactory().createPoint(this._points.getCoordinate(r))},t.prototype.interfaces_=function(){return[Ef]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}(Ee),Cf=function(){};Cf.prototype.interfaces_=function(){return[]};Cf.prototype.getClass=function(){return Cf};var eo=function(e){function t(r,a){e.call(this,a),this._coordinates=r||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new ye;var r=new ye;return r.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),r},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.isEquivalentClass(r)?this.isEmpty()&&r.isEmpty()?!0:this.isEmpty()!==r.isEmpty()?!1:this.equal(r.getCoordinate(),this.getCoordinate(),a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return fn.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var r=arguments[0],a=r;return this.getCoordinate().compareTo(a.getCoordinate())}else if(arguments.length===2){var c=arguments[0],f=arguments[1],u=c;return f.compare(this._coordinates,u._coordinates)}},t.prototype.apply=function(){if(Te(arguments[0],sa)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this.getCoordinate())}else if(Te(arguments[0],ns)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this._coordinates,0),a.isGeometryChanged()&&this.geometryChanged()}else if(Te(arguments[0],Ms)){var c=arguments[0];c.filter(this)}else if(Te(arguments[0],Fa)){var f=arguments[0];f.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var r=e.prototype.clone.call(this);return r._coordinates=this._coordinates.clone(),r},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(r){r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),Ue.isTrue(r.size()<=1),this._coordinates=r},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[Cf]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,n),t}(Ee),yl=function(){};yl.prototype.interfaces_=function(){return[]};yl.prototype.getClass=function(){return yl};var Cr=function(e){function t(r,a,c){if(e.call(this,c),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),a===null&&(a=[]),e.hasNullElements(a))throw new jn("holes must not contain null elements");if(r.isEmpty()&&e.hasNonEmptyElements(a))throw new jn("shell is empty but holes are not");this._shell=r,this._holes=a}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var r=this;if(this.isEmpty())return[];for(var a=new Array(this.getNumPoints()).fill(null),c=-1,f=this._shell.getCoordinates(),u=0;u<f.length;u++)c++,a[c]=f[u];for(var b=0;b<this._holes.length;b++)for(var C=r._holes[b].getCoordinates(),A=0;A<C.length;A++)c++,a[c]=C[A];return a},t.prototype.getArea=function(){var r=this,a=0;a+=Math.abs(oe.signedArea(this._shell.getCoordinateSequence()));for(var c=0;c<this._holes.length;c++)a-=Math.abs(oe.signedArea(r._holes[c].getCoordinateSequence()));return a},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var r=this._shell.getCoordinateSequence(),a=this.getEnvelopeInternal(),c=0;c<5;c++){var f=r.getX(c);if(!(f===a.getMinX()||f===a.getMaxX()))return!1;var u=r.getY(c);if(!(u===a.getMinY()||u===a.getMaxY()))return!1}for(var b=r.getX(0),C=r.getY(0),A=1;A<=4;A++){var P=r.getX(A),k=r.getY(A),Y=P!==b,X=k!==C;if(Y===X)return!1;b=P,C=k}return!0},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var a=arguments[0],c=arguments[1];if(!this.isEquivalentClass(a))return!1;var f=a,u=this._shell,b=f._shell;if(!u.equalsExact(b,c)||this._holes.length!==f._holes.length)return!1;for(var C=0;C<this._holes.length;C++)if(!r._holes[C].equalsExact(f._holes[C],c))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var r=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var a=0;a<this._holes.length;a++)r.normalize(r._holes[a],!1);tu.sort(this._holes)}else if(arguments.length===2){var c=arguments[0],f=arguments[1];if(c.isEmpty())return null;var u=new Array(c.getCoordinates().length-1).fill(null);ri.arraycopy(c.getCoordinates(),0,u,0,u.length);var b=Ke.minCoordinate(c.getCoordinates());Ke.scroll(u,b),ri.arraycopy(u,0,c.getCoordinates(),0,u.length),c.getCoordinates()[u.length]=u[0],oe.isCCW(c.getCoordinates())===f&&Ke.reverse(c.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var r=this,a=0;a+=this._shell.getLength();for(var c=0;c<this._holes.length;c++)a+=r._holes[c].getLength();return a},t.prototype.getNumPoints=function(){for(var r=this,a=this._shell.getNumPoints(),c=0;c<this._holes.length;c++)a+=r._holes[c].getNumPoints();return a},t.prototype.reverse=function(){var r=this,a=this.copy();a._shell=this._shell.copy().reverse(),a._holes=new Array(this._holes.length).fill(null);for(var c=0;c<this._holes.length;c++)a._holes[c]=r._holes[c].copy().reverse();return a},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var a=arguments[0],c=this._shell,f=a._shell;return c.compareToSameClass(f)}else if(arguments.length===2){var u=arguments[0],b=arguments[1],C=u,A=this._shell,P=C._shell,k=A.compareToSameClass(P,b);if(k!==0)return k;for(var Y=this.getNumInteriorRing(),X=C.getNumInteriorRing(),lt=0;lt<Y&&lt<X;){var ht=r.getInteriorRingN(lt),_t=C.getInteriorRingN(lt),j=ht.compareToSameClass(_t,b);if(j!==0)return j;lt++}return lt<Y?1:lt<X?-1:0}},t.prototype.apply=function(r){var a=this;if(Te(r,sa)){this._shell.apply(r);for(var c=0;c<this._holes.length;c++)a._holes[c].apply(r)}else if(Te(r,ns)){if(this._shell.apply(r),!r.isDone())for(var f=0;f<this._holes.length&&(a._holes[f].apply(r),!r.isDone());f++);r.isGeometryChanged()&&this.geometryChanged()}else if(Te(r,Ms))r.filter(this);else if(Te(r,Fa)){r.filter(this),this._shell.apply(r);for(var u=0;u<this._holes.length;u++)a._holes[u].apply(r)}},t.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var a=new Array(this._holes.length+1).fill(null);a[0]=this._shell;for(var c=0;c<this._holes.length;c++)a[c+1]=r._holes[c];return a.length<=1?this.getFactory().createLinearRing(a[0].getCoordinateSequence()):this.getFactory().createMultiLineString(a)},t.prototype.clone=function(){var r=this,a=e.prototype.clone.call(this);a._shell=this._shell.clone(),a._holes=new Array(this._holes.length).fill(null);for(var c=0;c<this._holes.length;c++)a._holes[c]=r._holes[c].clone();return a},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var r=this,a=this._shell.copy(),c=new Array(this._holes.length).fill(null),f=0;f<c.length;f++)c[f]=r._holes[f].copy();return new t(a,c,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(r){return this._holes[r]},t.prototype.interfaces_=function(){return[yl]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}(Ee),Nh=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Ee.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.isEquivalentClass(r)?e.prototype.equalsExact.call(this,r,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var r=arguments[0];return this._geometries[r].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return fn.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var r=this,a=new Array(this._geometries.length).fill(null),c=0;c<a.length;c++)a[c]=r._geometries[c].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[Cf]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,n),t}(Ei),aa=function(e){function t(r,a){r instanceof bt&&a instanceof $e&&(r=a.getCoordinateSequenceFactory().create(r)),e.call(this,r,a),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Ee.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return fn.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var r=this._points.copy();fr.reverse(r);var a=this.getFactory().createLinearRing(r);return a},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new jn("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new jn("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(ir),ra=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Ee.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.isEquivalentClass(r)?e.prototype.equalsExact.call(this,r,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var r=this,a=this._geometries.length,c=new Array(a).fill(null),f=0;f<this._geometries.length;f++)c[f]=r._geometries[f].reverse();return this.getFactory().createMultiPolygon(c)},t.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var a=new Qt,c=0;c<this._geometries.length;c++)for(var f=r._geometries[c],u=f.getBoundary(),b=0;b<u.getNumGeometries();b++)a.add(u.getGeometryN(b));var C=new Array(a.size()).fill(null);return this.getFactory().createMultiLineString(a.toArray(C))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var r=this,a=new Array(this._geometries.length).fill(null),c=0;c<a.length;c++)a[c]=r._geometries[c].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[yl]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(Ei),Bo=function(e){this._factory=e||null,this._isUserDataCopied=!1},og={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Bo.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};Bo.prototype.edit=function(e,t){if(e===null)return null;var n=this.editInternal(e,t);return this._isUserDataCopied&&n.setUserData(e.getUserData()),n};Bo.prototype.editInternal=function(e,t){return this._factory===null&&(this._factory=e.getFactory()),e instanceof Ei?this.editGeometryCollection(e,t):e instanceof Cr?this.editPolygon(e,t):e instanceof eo?t.edit(e,this._factory):e instanceof ir?t.edit(e,this._factory):(Ue.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};Bo.prototype.editGeometryCollection=function(e,t){for(var n=this,r=t.edit(e,this._factory),a=new Qt,c=0;c<r.getNumGeometries();c++){var f=n.edit(r.getGeometryN(c),t);f===null||f.isEmpty()||a.add(f)}return r.getClass()===Nh?this._factory.createMultiPoint(a.toArray([])):r.getClass()===ru?this._factory.createMultiLineString(a.toArray([])):r.getClass()===ra?this._factory.createMultiPolygon(a.toArray([])):this._factory.createGeometryCollection(a.toArray([]))};Bo.prototype.editPolygon=function(e,t){var n=this,r=t.edit(e,this._factory);if(r===null&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var a=this.edit(r.getExteriorRing(),t);if(a===null||a.isEmpty())return this._factory.createPolygon();for(var c=new Qt,f=0;f<r.getNumInteriorRing();f++){var u=n.edit(r.getInteriorRingN(f),t);u===null||u.isEmpty()||c.add(u)}return this._factory.createPolygon(a,c.toArray([]))};Bo.prototype.interfaces_=function(){return[]};Bo.prototype.getClass=function(){return Bo};Bo.GeometryEditorOperation=function(){};og.NoOpGeometryOperation.get=function(){return Tf};og.CoordinateOperation.get=function(){return Lf};og.CoordinateSequenceOperation.get=function(){return Pf};Object.defineProperties(Bo,og);var Tf=function(){};Tf.prototype.edit=function(e,t){return e};Tf.prototype.interfaces_=function(){return[Bo.GeometryEditorOperation]};Tf.prototype.getClass=function(){return Tf};var Lf=function(){};Lf.prototype.edit=function(e,t){var n=this.editCoordinates(e.getCoordinates(),e);return n===null?e:e instanceof aa?t.createLinearRing(n):e instanceof ir?t.createLineString(n):e instanceof eo?n.length>0?t.createPoint(n[0]):t.createPoint():e};Lf.prototype.interfaces_=function(){return[Bo.GeometryEditorOperation]};Lf.prototype.getClass=function(){return Lf};var Pf=function(){};Pf.prototype.edit=function(e,t){return e instanceof aa?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof ir?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof eo?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e};Pf.prototype.interfaces_=function(){return[Bo.GeometryEditorOperation]};Pf.prototype.getClass=function(){return Pf};var hr=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var n=0;n<t;n++)e._coordinates[n]=new bt}else if(Te(arguments[0],un)){var r=arguments[0];if(r===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var a=0;a<this._coordinates.length;a++)e._coordinates[a]=r.getCoordinateCopy(a)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var c=arguments[0],f=arguments[1];this._coordinates=c,this._dimension=f,c===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],b=arguments[1];this._coordinates=new Array(u).fill(null),this._dimension=b;for(var C=0;C<u;C++)e._coordinates[C]=new bt}}},s2={serialVersionUID:{configurable:!0}};hr.prototype.setOrdinate=function(e,t,n){switch(t){case un.X:this._coordinates[e].x=n;break;case un.Y:this._coordinates[e].y=n;break;case un.Z:this._coordinates[e].z=n;break;default:throw new jn("invalid ordinateIndex")}};hr.prototype.size=function(){return this._coordinates.length};hr.prototype.getOrdinate=function(e,t){switch(t){case un.X:return this._coordinates[e].x;case un.Y:return this._coordinates[e].y;case un.Z:return this._coordinates[e].z}return Me.NaN};hr.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var t=arguments[0],n=arguments[1];n.x=this._coordinates[t].x,n.y=this._coordinates[t].y,n.z=this._coordinates[t].z}};hr.prototype.getCoordinateCopy=function(e){return new bt(this._coordinates[e])};hr.prototype.getDimension=function(){return this._dimension};hr.prototype.getX=function(e){return this._coordinates[e].x};hr.prototype.clone=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].clone();return new hr(t,this._dimension)};hr.prototype.expandEnvelope=function(e){for(var t=this,n=0;n<this._coordinates.length;n++)e.expandToInclude(t._coordinates[n]);return e};hr.prototype.copy=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].copy();return new hr(t,this._dimension)};hr.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var t=new Gs(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)t.append(", "),t.append(e._coordinates[n]);return t.append(")"),t.toString()}else return"()"};hr.prototype.getY=function(e){return this._coordinates[e].y};hr.prototype.toCoordinateArray=function(){return this._coordinates};hr.prototype.interfaces_=function(){return[un,Go]};hr.prototype.getClass=function(){return hr};s2.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(hr,s2);var la=function(){},n0={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};la.prototype.readResolve=function(){return la.instance()};la.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new hr(e)}else if(Te(arguments[0],un)){var t=arguments[0];return new hr(t)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new hr(n):new hr(n,r)}};la.prototype.interfaces_=function(){return[Ph,Go]};la.prototype.getClass=function(){return la};la.instance=function(){return la.instanceObject};n0.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};n0.instanceObject.get=function(){return new la};Object.defineProperties(la,n0);var a2=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n){return this.map_.get(n)||null},t.prototype.put=function(n,r){return this.map_.set(n,r),r},t.prototype.values=function(){for(var n=new Qt,r=this.map_.values(),a=r.next();!a.done;)n.add(a.value),a=r.next();return n},t.prototype.entrySet=function(){var n=new t0;return this.map_.entries().forEach(function(r){return n.add(r)}),n},t.prototype.size=function(){return this.map_.size()},t}(pc),_n=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Ds){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},r0={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};_n.prototype.equals=function(e){if(!(e instanceof _n))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale};_n.prototype.compareTo=function(e){var t=e,n=this.getMaximumSignificantDigits(),r=t.getMaximumSignificantDigits();return new Ps(n).compareTo(new Ps(r))};_n.prototype.getScale=function(){return this._scale};_n.prototype.isFloating=function(){return this._modelType===_n.FLOATING||this._modelType===_n.FLOATING_SINGLE};_n.prototype.getType=function(){return this._modelType};_n.prototype.toString=function(){var e="UNKNOWN";return this._modelType===_n.FLOATING?e="Floating":this._modelType===_n.FLOATING_SINGLE?e="Floating-Single":this._modelType===_n.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};_n.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(Me.isNaN(e))return e;if(this._modelType===_n.FLOATING_SINGLE){var t=e;return t}return this._modelType===_n.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof bt){var n=arguments[0];if(this._modelType===_n.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};_n.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===_n.FLOATING?e=16:this._modelType===_n.FLOATING_SINGLE?e=6:this._modelType===_n.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};_n.prototype.setScale=function(e){this._scale=Math.abs(e)};_n.prototype.interfaces_=function(){return[Go,Uo]};_n.prototype.getClass=function(){return _n};_n.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t};r0.serialVersionUID.get=function(){return 7777263578777804e3};r0.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(_n,r0);var Ds=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},i0={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Ds.prototype.readResolve=function(){return Ds.nameToTypeMap.get(this._name)};Ds.prototype.toString=function(){return this._name};Ds.prototype.interfaces_=function(){return[Go]};Ds.prototype.getClass=function(){return Ds};i0.serialVersionUID.get=function(){return-552860263173159e4};i0.nameToTypeMap.get=function(){return new a2};Object.defineProperties(Ds,i0);_n.Type=Ds;_n.FIXED=new Ds("FIXED");_n.FLOATING=new Ds("FLOATING");_n.FLOATING_SINGLE=new Ds("FLOATING SINGLE");var $e=function e(){this._precisionModel=new _n,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?Te(arguments[0],Ph)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof _n&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},l2={serialVersionUID:{configurable:!0}};$e.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new bt(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new bt(e.getMinX(),e.getMinY()),new bt(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new bt(e.getMinX(),e.getMinY()),new bt(e.getMinX(),e.getMaxY()),new bt(e.getMaxX(),e.getMaxY()),new bt(e.getMaxX(),e.getMinY()),new bt(e.getMinX(),e.getMinY())]),null)};$e.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new ir(this.getCoordinateSequenceFactory().create(e),this);if(Te(e,un))return new ir(e,this)}else return new ir(this.getCoordinateSequenceFactory().create([]),this)};$e.prototype.createMultiLineString=function(){if(arguments.length===0)return new ru(null,this);if(arguments.length===1){var e=arguments[0];return new ru(e,this)}};$e.prototype.buildGeometry=function(e){for(var t=null,n=!1,r=!1,a=e.iterator();a.hasNext();){var c=a.next(),f=c.getClass();t===null&&(t=f),f!==t&&(n=!0),c.isGeometryCollectionOrDerived()&&(r=!0)}if(t===null)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection($e.toGeometryArray(e));var u=e.iterator().next(),b=e.size()>1;if(b){if(u instanceof Cr)return this.createMultiPolygon($e.toPolygonArray(e));if(u instanceof ir)return this.createMultiLineString($e.toLineStringArray(e));if(u instanceof eo)return this.createMultiPoint($e.toPointArray(e));Ue.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u};$e.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};$e.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof bt){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(Te(arguments[0],un)){var t=arguments[0];return new eo(t,this)}}};$e.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};$e.prototype.createPolygon=function(){if(arguments.length===0)return new Cr(null,null,this);if(arguments.length===1){if(Te(arguments[0],un)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof aa){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];return new Cr(r,a,this)}};$e.prototype.getSRID=function(){return this._SRID};$e.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Ei(null,this);if(arguments.length===1){var e=arguments[0];return new Ei(e,this)}};$e.prototype.createGeometry=function(e){var t=new Bo(this);return t.edit(e,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};$e.prototype.getPrecisionModel=function(){return this._precisionModel};$e.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(Te(arguments[0],un)){var t=arguments[0];return new aa(t,this)}}};$e.prototype.createMultiPolygon=function(){if(arguments.length===0)return new ra(null,this);if(arguments.length===1){var e=arguments[0];return new ra(e,this)}};$e.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new Nh(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Nh(t,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(Te(arguments[0],un)){var r=arguments[0];if(r===null)return this.createMultiPoint(new Array(0).fill(null));for(var a=new Array(r.size()).fill(null),c=0;c<r.size();c++){var f=e.getCoordinateSequenceFactory().create(1,r.getDimension());fr.copy(r,c,f,0,1),a[c]=e.createPoint(f)}return this.createMultiPoint(a)}}};$e.prototype.interfaces_=function(){return[Go]};$e.prototype.getClass=function(){return $e};$e.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};$e.toGeometryArray=function(e){if(e===null)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)};$e.getDefaultCoordinateSequenceFactory=function(){return la.instance()};$e.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};$e.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};$e.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};$e.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};$e.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};$e.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};$e.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)};l2.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties($e,l2);var qt=function(){},sg={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};qt.prototype.interfaces_=function(){return[]};qt.prototype.getClass=function(){return qt};qt.opposite=function(e){return e===qt.LEFT?qt.RIGHT:e===qt.RIGHT?qt.LEFT:e};sg.ON.get=function(){return 0};sg.LEFT.get=function(){return 1};sg.RIGHT.get=function(){return 2};Object.defineProperties(qt,sg);function ag(e){this.message=e||""}ag.prototype=new Error;ag.prototype.name="EmptyStackException";function qs(){this.array_=[]}qs.prototype=new ts;qs.prototype.add=function(e){return this.array_.push(e),!0};qs.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};qs.prototype.push=function(e){return this.array_.push(e),e};qs.prototype.pop=function(e){if(this.array_.length===0)throw new ag;return this.array_.pop()};qs.prototype.peek=function(){if(this.array_.length===0)throw new ag;return this.array_[this.array_.length-1]};qs.prototype.empty=function(){return this.array_.length===0};qs.prototype.isEmpty=function(){return this.empty()};qs.prototype.search=function(e){return this.array_.indexOf(e)};qs.prototype.size=function(){return this.array_.length};qs.prototype.toArray=function(){for(var e=this,t=[],n=0,r=this.array_.length;n<r;n++)t.push(e.array_[n]);return t};var ks=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};ks.prototype.getCoordinate=function(){return this._minCoord};ks.prototype.getRightmostSide=function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n};ks.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();Ue.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],r=oe.computeOrientation(this._minCoord,n,t),a=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&r===oe.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&r===oe.CLOCKWISE)&&(a=!0),a&&(this._minIndex=this._minIndex-1)};ks.prototype.getRightmostSideOfSegment=function(e,t){var n=e.getEdge(),r=n.getCoordinates();if(t<0||t+1>=r.length||r[t].y===r[t+1].y)return-1;var a=qt.LEFT;return r[t].y<r[t+1].y&&(a=qt.RIGHT),a};ks.prototype.getEdge=function(){return this._orientedDe};ks.prototype.checkForRightmostCoordinate=function(e){for(var t=this,n=e.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(t._minCoord===null||n[r].x>t._minCoord.x)&&(t._minDe=e,t._minIndex=r,t._minCoord=n[r])};ks.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),t=e.getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};ks.prototype.findEdge=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next();r.isForward()&&t.checkForRightmostCoordinate(r)}Ue.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var a=this.getRightmostSide(this._minDe,this._minIndex);a===qt.LEFT&&(this._orientedDe=this._minDe.getSym())};ks.prototype.interfaces_=function(){return[]};ks.prototype.getClass=function(){return ks};var Ba=function(e){function t(n,r){e.call(this,t.msgWithCoord(n,r)),this.pt=r?new bt(r):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(n,r){return r?n:n+" [ "+r+" ]"},t}(za),lg=function(){this.array_=[]};lg.prototype.addLast=function(e){this.array_.push(e)};lg.prototype.removeFirst=function(){return this.array_.shift()};lg.prototype.isEmpty=function(){return this.array_.length===0};var Ci=function(){this._finder=null,this._dirEdgeList=new Qt,this._nodes=new Qt,this._rightMostCoord=null,this._env=null,this._finder=new ks};Ci.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.setVisited(!1)}};Ci.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Ci.prototype.computeNodeDepth=function(e){for(var t=this,n=null,r=e.getEdges().iterator();r.hasNext();){var a=r.next();if(a.isVisited()||a.getSym().isVisited()){n=a;break}}if(n===null)throw new Ba("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(n);for(var c=e.getEdges().iterator();c.hasNext();){var f=c.next();f.setVisited(!0),t.copySymDepths(f)}};Ci.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(qt.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)};Ci.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Ci.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(qt.RIGHT)>=1&&t.getDepth(qt.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}};Ci.prototype.computeDepths=function(e){var t=this,n=new t0,r=new lg,a=e.getNode();for(r.addLast(a),n.add(a),e.setVisited(!0);!r.isEmpty();){var c=r.removeFirst();n.add(c),t.computeNodeDepth(c);for(var f=c.getEdges().iterator();f.hasNext();){var u=f.next(),b=u.getSym();if(!b.isVisited()){var C=b.getNode();n.contains(C)||(r.addLast(C),n.add(C))}}}};Ci.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0};Ci.prototype.getEnvelope=function(){if(this._env===null){for(var e=new ye,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next(),r=n.getEdge().getCoordinates(),a=0;a<r.length-1;a++)e.expandToInclude(r[a]);this._env=e}return this._env};Ci.prototype.addReachable=function(e){var t=this,n=new qs;for(n.add(e);!n.empty();){var r=n.pop();t.add(r,n)}};Ci.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(qt.LEFT,e.getDepth(qt.RIGHT)),t.setDepth(qt.RIGHT,e.getDepth(qt.LEFT))};Ci.prototype.add=function(e,t){var n=this;e.setVisited(!0),this._nodes.add(e);for(var r=e.getEdges().iterator();r.hasNext();){var a=r.next();n._dirEdgeList.add(a);var c=a.getSym(),f=c.getNode();f.isVisited()||t.push(f)}};Ci.prototype.getNodes=function(){return this._nodes};Ci.prototype.getDirectedEdges=function(){return this._dirEdgeList};Ci.prototype.interfaces_=function(){return[Uo]};Ci.prototype.getClass=function(){return Ci};var kn=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[qt.ON]=r}else if(arguments[0]instanceof e){var a=arguments[0];if(this.init(a.location.length),a!==null)for(var c=0;c<this.location.length;c++)t.location[c]=a.location[c]}}else if(arguments.length===3){var f=arguments[0],u=arguments[1],b=arguments[2];this.init(3),this.location[qt.ON]=f,this.location[qt.LEFT]=u,this.location[qt.RIGHT]=b}};kn.prototype.setAllLocations=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]=e};kn.prototype.isNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]!==St.NONE)return!1;return!0};kn.prototype.setAllLocationsIfNull=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]===St.NONE&&(t.location[n]=e)};kn.prototype.isLine=function(){return this.location.length===1};kn.prototype.merge=function(e){var t=this;if(e.location.length>this.location.length){var n=new Array(3).fill(null);n[qt.ON]=this.location[qt.ON],n[qt.LEFT]=St.NONE,n[qt.RIGHT]=St.NONE,this.location=n}for(var r=0;r<this.location.length;r++)t.location[r]===St.NONE&&r<e.location.length&&(t.location[r]=e.location[r])};kn.prototype.getLocations=function(){return this.location};kn.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[qt.LEFT];this.location[qt.LEFT]=this.location[qt.RIGHT],this.location[qt.RIGHT]=e};kn.prototype.toString=function(){var e=new Gs;return this.location.length>1&&e.append(St.toLocationSymbol(this.location[qt.LEFT])),e.append(St.toLocationSymbol(this.location[qt.ON])),this.location.length>1&&e.append(St.toLocationSymbol(this.location[qt.RIGHT])),e.toString()};kn.prototype.setLocations=function(e,t,n){this.location[qt.ON]=e,this.location[qt.LEFT]=t,this.location[qt.RIGHT]=n};kn.prototype.get=function(e){return e<this.location.length?this.location[e]:St.NONE};kn.prototype.isArea=function(){return this.location.length>1};kn.prototype.isAnyNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]===St.NONE)return!0;return!1};kn.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(qt.ON,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.location[t]=n}};kn.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(St.NONE)};kn.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]};kn.prototype.allPositionsEqual=function(e){for(var t=this,n=0;n<this.location.length;n++)if(t.location[n]!==e)return!1;return!0};kn.prototype.interfaces_=function(){return[]};kn.prototype.getClass=function(){return kn};var bn=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new kn(t),this.elt[1]=new kn(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new kn(n.elt[0]),this.elt[1]=new kn(n.elt[1])}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.elt[0]=new kn(St.NONE),this.elt[1]=new kn(St.NONE),this.elt[r].setLocation(a)}else if(arguments.length===3){var c=arguments[0],f=arguments[1],u=arguments[2];this.elt[0]=new kn(c,f,u),this.elt[1]=new kn(c,f,u)}else if(arguments.length===4){var b=arguments[0],C=arguments[1],A=arguments[2],P=arguments[3];this.elt[0]=new kn(St.NONE,St.NONE,St.NONE),this.elt[1]=new kn(St.NONE,St.NONE,St.NONE),this.elt[b].setLocations(C,A,P)}};bn.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};bn.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)};bn.prototype.isNull=function(e){return this.elt[e].isNull()};bn.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}};bn.prototype.isLine=function(e){return this.elt[e].isLine()};bn.prototype.merge=function(e){for(var t=this,n=0;n<2;n++)t.elt[n]===null&&e.elt[n]!==null?t.elt[n]=new kn(e.elt[n]):t.elt[n].merge(e.elt[n])};bn.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};bn.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(qt.ON)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}};bn.prototype.toString=function(){var e=new Gs;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};bn.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};bn.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};bn.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(qt.ON,t)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];this.elt[n].setLocation(r,a)}};bn.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)};bn.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)};bn.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new kn(this.elt[e].location[0]))};bn.prototype.interfaces_=function(){return[]};bn.prototype.getClass=function(){return bn};bn.toLineLabel=function(e){for(var t=new bn(St.NONE),n=0;n<2;n++)t.setLocation(n,e.getLocation(n));return t};var vr=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Qt,this._pts=new Qt,this._label=new bn(St.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Qt,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()};vr.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var t=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)t[n]=e._pts.get(n);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=oe.isCCW(this._ring.getCoordinates())};vr.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};vr.prototype.computePoints=function(e){var t=this;this._startDe=e;var n=e,r=!0;do{if(n===null)throw new Ba("Found null DirectedEdge");if(n.getEdgeRing()===t)throw new Ba("Directed Edge visited twice during ring-building at "+n.getCoordinate());t._edges.add(n);var a=n.getLabel();Ue.isTrue(a.isArea()),t.mergeLabel(a),t.addPoints(n.getEdge(),n.isForward(),r),r=!1,t.setEdgeRing(n,t),n=t.getNext(n)}while(n!==this._startDe)};vr.prototype.getLinearRing=function(){return this._ring};vr.prototype.getCoordinate=function(e){return this._pts.get(e)};vr.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var t=this._startDe;do{var n=t.getNode(),r=n.getEdges().getOutgoingDegree(e);r>e._maxNodeDegree&&(e._maxNodeDegree=r),t=e.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2};vr.prototype.addPoints=function(e,t,n){var r=this,a=e.getCoordinates();if(t){var c=1;n&&(c=0);for(var f=c;f<a.length;f++)r._pts.add(a[f])}else{var u=a.length-2;n&&(u=a.length-1);for(var b=u;b>=0;b--)r._pts.add(a[b])}};vr.prototype.isHole=function(){return this._isHole};vr.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};vr.prototype.containsPoint=function(e){var t=this.getLinearRing(),n=t.getEnvelopeInternal();if(!n.contains(e)||!oe.isPointInRing(e,t.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();){var a=r.next();if(a.containsPoint(e))return!1}return!0};vr.prototype.addHole=function(e){this._holes.add(e)};vr.prototype.isShell=function(){return this._shell===null};vr.prototype.getLabel=function(){return this._label};vr.prototype.getEdges=function(){return this._edges};vr.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};vr.prototype.getShell=function(){return this._shell};vr.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],r=t.getLocation(n,qt.RIGHT);if(r===St.NONE)return null;if(this._label.getLocation(n)===St.NONE)return this._label.setLocation(n,r),null}};vr.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};vr.prototype.toPolygon=function(e){for(var t=this,n=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)n[r]=t._holes.get(r).getLinearRing();var a=e.createPolygon(this.getLinearRing(),n);return a};vr.prototype.interfaces_=function(){return[]};vr.prototype.getClass=function(){return vr};var vM=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(n,r){n.setMinEdgeRing(r)},t.prototype.getNext=function(n){return n.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(vr),xM=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var n=this,r=new Qt,a=this._startDe;do{if(a.getMinEdgeRing()===null){var c=new vM(a,n._geometryFactory);r.add(c)}a=a.getNext()}while(a!==this._startDe);return r},t.prototype.setEdgeRing=function(n,r){n.setEdgeRing(r)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,r=this._startDe;do{var a=r.getNode();a.getEdges().linkMinimalDirectedEdges(n),r=r.getNext()}while(r!==this._startDe)},t.prototype.getNext=function(n){return n.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(vr),Eo=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._label=e}};Eo.prototype.setVisited=function(e){this._isVisited=e};Eo.prototype.setInResult=function(e){this._isInResult=e};Eo.prototype.isCovered=function(){return this._isCovered};Eo.prototype.isCoveredSet=function(){return this._isCoveredSet};Eo.prototype.setLabel=function(e){this._label=e};Eo.prototype.getLabel=function(){return this._label};Eo.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};Eo.prototype.updateIM=function(e){Ue.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};Eo.prototype.isInResult=function(){return this._isInResult};Eo.prototype.isVisited=function(){return this._isVisited};Eo.prototype.interfaces_=function(){return[]};Eo.prototype.getClass=function(){return Eo};var ug=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var n=arguments[0],r=arguments[1];this._coord=n,this._edges=r,this._label=new bn(0,St.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var r=n.next();if(r.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(n){},t.prototype.computeMergedLocation=function(n,r){var a=St.NONE;if(a=this._label.getLocation(r),!n.isNull(r)){var c=n.getLocation(r);a!==St.BOUNDARY&&(a=c)}return a},t.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];this._label===null?this._label=new bn(n,r):this._label.setLocation(n,r)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof t){var r=arguments[0];this.mergeLabel(r._label)}else if(arguments[0]instanceof bn)for(var a=arguments[0],c=0;c<2;c++){var f=n.computeMergedLocation(a,c),u=n._label.getLocation(c);u===St.NONE&&n._label.setLocation(c,f)}},t.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},t.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var r=St.NONE;this._label!==null&&(r=this._label.getLocation(n));var a=null;switch(r){case St.BOUNDARY:a=St.INTERIOR;break;case St.INTERIOR:a=St.BOUNDARY;break;default:a=St.BOUNDARY;break}this._label.setLocation(n,a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Eo),Rs=function(){this.nodeMap=new ci,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};Rs.prototype.find=function(e){return this.nodeMap.get(e)};Rs.prototype.addNode=function(){if(arguments[0]instanceof bt){var e=arguments[0],t=this.nodeMap.get(e);return t===null&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}else if(arguments[0]instanceof ug){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return r===null?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}};Rs.prototype.print=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};Rs.prototype.iterator=function(){return this.nodeMap.values().iterator()};Rs.prototype.values=function(){return this.nodeMap.values()};Rs.prototype.getBoundaryNodes=function(e){for(var t=new Qt,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(e)===St.BOUNDARY&&t.add(r)}return t};Rs.prototype.add=function(e){var t=e.getCoordinate(),n=this.addNode(t);n.add(e)};Rs.prototype.interfaces_=function(){return[]};Rs.prototype.getClass=function(){return Rs};var In=function(){},Wf={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};In.prototype.interfaces_=function(){return[]};In.prototype.getClass=function(){return In};In.isNorthern=function(e){return e===In.NE||e===In.NW};In.isOpposite=function(e,t){if(e===t)return!1;var n=(e-t+4)%4;return n===2};In.commonHalfPlane=function(e,t){if(e===t)return e;var n=(e-t+4)%4;if(n===2)return-1;var r=e<t?e:t,a=e>t?e:t;return r===0&&a===3?3:r};In.isInHalfPlane=function(e,t){return t===In.SE?e===In.SE||e===In.SW:e===t||e===t+1};In.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new jn("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?In.NE:In.SE:t>=0?In.NW:In.SW}else if(arguments[0]instanceof bt&&arguments[1]instanceof bt){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new jn("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?In.NE:In.SE:r.y>=n.y?In.NW:In.SW}};Wf.NE.get=function(){return 0};Wf.NW.get=function(){return 1};Wf.SW.get=function(){return 2};Wf.SE.get=function(){return 3};Object.defineProperties(In,Wf);var hi=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2],a=null;this._edge=t,this.init(n,r),this._label=a}else if(arguments.length===4){var c=arguments[0],f=arguments[1],u=arguments[2],b=arguments[3];this._edge=c,this.init(f,u),this._label=b}};hi.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:oe.computeOrientation(e._p0,e._p1,this._p1)};hi.prototype.getDy=function(){return this._dy};hi.prototype.getCoordinate=function(){return this._p0};hi.prototype.setNode=function(e){this._node=e};hi.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),a=n.substring(r+1);e.print("  "+a+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)};hi.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)};hi.prototype.getDirectedCoordinate=function(){return this._p1};hi.prototype.getDx=function(){return this._dx};hi.prototype.getLabel=function(){return this._label};hi.prototype.getEdge=function(){return this._edge};hi.prototype.getQuadrant=function(){return this._quadrant};hi.prototype.getNode=function(){return this._node};hi.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf("."),r=t.substring(n+1);return"  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};hi.prototype.computeLabel=function(e){};hi.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=In.quadrant(this._dx,this._dy),Ue.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};hi.prototype.interfaces_=function(){return[Uo]};hi.prototype.getClass=function(){return hi};var w_=function(e){function t(){var n=arguments[0],r=arguments[1];if(e.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var a=n.getNumPoints()-1;this.init(n.getCoordinate(a),n.getCoordinate(a-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(n){return this._depth[n]},t.prototype.setVisited=function(n){this._isVisited=n},t.prototype.computeDirectedLabel=function(){this._label=new bn(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(n,r){if(this._depth[n]!==-999&&this._depth[n]!==r)throw new Ba("assigned depths do not match",this.getCoordinate());this._depth[n]=r},t.prototype.isInteriorAreaEdge=function(){for(var n=this,r=!0,a=0;a<2;a++)n._label.isArea(a)&&n._label.getLocation(a,qt.LEFT)===St.INTERIOR&&n._label.getLocation(a,qt.RIGHT)===St.INTERIOR||(r=!1);return r},t.prototype.setNextMin=function(n){this._nextMin=n},t.prototype.print=function(n){e.prototype.print.call(this,n),n.print(" "+this._depth[qt.LEFT]+"/"+this._depth[qt.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},t.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},t.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),r=!this._label.isArea(0)||this._label.allPositionsEqual(0,St.EXTERIOR),a=!this._label.isArea(1)||this._label.allPositionsEqual(1,St.EXTERIOR);return n&&r&&a},t.prototype.setEdgeRing=function(n){this._edgeRing=n},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},t.prototype.setInResult=function(n){this._isInResult=n},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},t.prototype.setSym=function(n){this._sym=n},t.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},t.prototype.setEdgeDepths=function(n,r){var a=this.getEdge().getDepthDelta();this._isForward||(a=-a);var c=1;n===qt.LEFT&&(c=-1);var f=qt.opposite(n),u=a*c,b=r+u;this.setDepth(n,r),this.setDepth(f,b)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(n){this._next=n},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(n,r){return n===St.EXTERIOR&&r===St.INTERIOR?1:n===St.INTERIOR&&r===St.EXTERIOR?-1:0},t}(hi),Oh=function(){};Oh.prototype.createNode=function(e){return new ug(e,null)};Oh.prototype.interfaces_=function(){return[]};Oh.prototype.getClass=function(){return Oh};var Qn=function(){if(this._edges=new Qt,this._nodes=null,this._edgeEndList=new Qt,arguments.length===0)this._nodes=new Rs(new Oh);else if(arguments.length===1){var e=arguments[0];this._nodes=new Rs(e)}};Qn.prototype.printEdges=function(e){var t=this;e.println("Edges:");for(var n=0;n<this._edges.size();n++){e.println("edge "+n+":");var r=t._edges.get(n);r.print(e),r.eiList.print(e)}};Qn.prototype.find=function(e){return this._nodes.find(e)};Qn.prototype.addNode=function(){if(arguments[0]instanceof ug){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof bt){var t=arguments[0];return this._nodes.addNode(t)}};Qn.prototype.getNodeIterator=function(){return this._nodes.iterator()};Qn.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkResultDirectedEdges()}};Qn.prototype.debugPrintln=function(e){ri.out.println(e)};Qn.prototype.isBoundaryNode=function(e,t){var n=this._nodes.find(t);if(n===null)return!1;var r=n.getLabel();return r!==null&&r.getLocation(e)===St.BOUNDARY};Qn.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkAllDirectedEdges()}};Qn.prototype.matchInSameDirection=function(e,t,n,r){return e.equals(n)?oe.computeOrientation(e,t,r)===oe.COLLINEAR&&In.quadrant(e,t)===In.quadrant(n,r):!1};Qn.prototype.getEdgeEnds=function(){return this._edgeEndList};Qn.prototype.debugPrint=function(e){ri.out.print(e)};Qn.prototype.getEdgeIterator=function(){return this._edges.iterator()};Qn.prototype.findEdgeInSameDirection=function(e,t){for(var n=this,r=0;r<this._edges.size();r++){var a=n._edges.get(r),c=a.getCoordinates();if(n.matchInSameDirection(e,t,c[0],c[1])||n.matchInSameDirection(e,t,c[c.length-1],c[c.length-2]))return a}return null};Qn.prototype.insertEdge=function(e){this._edges.add(e)};Qn.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null};Qn.prototype.addEdges=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next();t._edges.add(r);var a=new w_(r,!0),c=new w_(r,!1);a.setSym(c),c.setSym(a),t.add(a),t.add(c)}};Qn.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};Qn.prototype.getNodes=function(){return this._nodes.values()};Qn.prototype.findEdge=function(e,t){for(var n=this,r=0;r<this._edges.size();r++){var a=n._edges.get(r),c=a.getCoordinates();if(e.equals(c[0])&&t.equals(c[1]))return a}return null};Qn.prototype.interfaces_=function(){return[]};Qn.prototype.getClass=function(){return Qn};Qn.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.getEdges().linkResultDirectedEdges()}};var no=function(){this._geometryFactory=null,this._shellList=new Qt;var e=arguments[0];this._geometryFactory=e};no.prototype.sortShellsAndHoles=function(e,t,n){for(var r=e.iterator();r.hasNext();){var a=r.next();a.isHole()?n.add(a):t.add(a)}};no.prototype.computePolygons=function(e){for(var t=this,n=new Qt,r=e.iterator();r.hasNext();){var a=r.next(),c=a.toPolygon(t._geometryFactory);n.add(c)}return n};no.prototype.placeFreeHoles=function(e,t){for(var n=this,r=t.iterator();r.hasNext();){var a=r.next();if(a.getShell()===null){var c=n.findEdgeRingContaining(a,e);if(c===null)throw new Ba("unable to assign hole to a shell",a.getCoordinate(0));a.setShell(c)}}};no.prototype.buildMinimalEdgeRings=function(e,t,n){for(var r=this,a=new Qt,c=e.iterator();c.hasNext();){var f=c.next();if(f.getMaxNodeDegree()>2){f.linkDirectedEdgesForMinimalEdgeRings();var u=f.buildMinimalRings(),b=r.findShell(u);b!==null?(r.placePolygonHoles(b,u),t.add(b)):n.addAll(u)}else a.add(f)}return a};no.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();){var n=t.next();if(n.containsPoint(e))return!0}return!1};no.prototype.buildMaximalEdgeRings=function(e){for(var t=this,n=new Qt,r=e.iterator();r.hasNext();){var a=r.next();if(a.isInResult()&&a.getLabel().isArea()&&a.getEdgeRing()===null){var c=new xM(a,t._geometryFactory);n.add(c),c.setInResult()}}return n};no.prototype.placePolygonHoles=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(e)}};no.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};no.prototype.findEdgeRingContaining=function(e,t){for(var n=e.getLinearRing(),r=n.getEnvelopeInternal(),a=n.getCoordinateN(0),c=null,f=null,u=t.iterator();u.hasNext();){var b=u.next(),C=b.getLinearRing(),A=C.getEnvelopeInternal();c!==null&&(f=c.getLinearRing().getEnvelopeInternal());var P=!1;A.contains(r)&&oe.isPointInRing(a,C.getCoordinates())&&(P=!0),P&&(c===null||f.contains(A))&&(c=b)}return c};no.prototype.findShell=function(e){for(var t=0,n=null,r=e.iterator();r.hasNext();){var a=r.next();a.isHole()||(n=a,t++)}return Ue.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n};no.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var t=arguments[0],n=arguments[1];Qn.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(t),a=new Qt,c=this.buildMinimalEdgeRings(r,this._shellList,a);this.sortShellsAndHoles(c,this._shellList,a),this.placeFreeHoles(this._shellList,a)}};no.prototype.interfaces_=function(){return[]};no.prototype.getClass=function(){return no};var zh=function(){};zh.prototype.getBounds=function(){};zh.prototype.interfaces_=function(){return[]};zh.prototype.getClass=function(){return zh};var rs=function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t};rs.prototype.getItem=function(){return this._item};rs.prototype.getBounds=function(){return this._bounds};rs.prototype.interfaces_=function(){return[zh,Go]};rs.prototype.getClass=function(){return rs};var Va=function(){this._size=null,this._items=null,this._size=0,this._items=new Qt,this._items.add(null)};Va.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};Va.prototype.size=function(){return this._size};Va.prototype.reorder=function(e){for(var t=this,n=null,r=this._items.get(e);e*2<=this._size&&(n=e*2,n!==t._size&&t._items.get(n+1).compareTo(t._items.get(n))<0&&n++,t._items.get(n).compareTo(r)<0);e=n)t._items.set(e,t._items.get(n));this._items.set(e,r)};Va.prototype.clear=function(){this._size=0,this._items.clear()};Va.prototype.isEmpty=function(){return this._size===0};Va.prototype.add=function(e){var t=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)t._items.set(n,t._items.get(Math.trunc(n/2)));this._items.set(n,e)};Va.prototype.interfaces_=function(){return[]};Va.prototype.getClass=function(){return Va};var _l=function(){};_l.prototype.visitItem=function(e){};_l.prototype.interfaces_=function(){return[]};_l.prototype.getClass=function(){return _l};var Yu=function(){};Yu.prototype.insert=function(e,t){};Yu.prototype.remove=function(e,t){};Yu.prototype.query=function(){};Yu.prototype.interfaces_=function(){return[]};Yu.prototype.getClass=function(){return Yu};var Er=function(){if(this._childBoundables=new Qt,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._level=e}},u2={serialVersionUID:{configurable:!0}};Er.prototype.getLevel=function(){return this._level};Er.prototype.size=function(){return this._childBoundables.size()};Er.prototype.getChildBoundables=function(){return this._childBoundables};Er.prototype.addChildBoundable=function(e){Ue.isTrue(this._bounds===null),this._childBoundables.add(e)};Er.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Er.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Er.prototype.interfaces_=function(){return[zh,Go]};Er.prototype.getClass=function(){return Er};u2.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Er,u2);var is=function(){};is.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}};is.min=function(e){return is.sort(e),e.get(0)};is.sort=function(e,t){var n=e.toArray();t?tu.sort(n,t):tu.sort(n);for(var r=e.iterator(),a=0,c=n.length;a<c;a++)r.next(),r.set(n[a])};is.singletonList=function(e){var t=new Qt;return t.add(e),t};var yr=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()};yr.prototype.expandToQueue=function(e,t){var n=yr.isComposite(this._boundable1),r=yr.isComposite(this._boundable2);if(n&&r)return yr.area(this._boundable1)>yr.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(n)return this.expand(this._boundable1,this._boundable2,e,t),null;if(r)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new jn("neither boundable is composite")};yr.prototype.isLeaves=function(){return!(yr.isComposite(this._boundable1)||yr.isComposite(this._boundable2))};yr.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0};yr.prototype.expand=function(e,t,n,r){for(var a=this,c=e.getChildBoundables(),f=c.iterator();f.hasNext();){var u=f.next(),b=new yr(u,t,a._itemDistance);b.getDistance()<r&&n.add(b)}};yr.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};yr.prototype.getDistance=function(){return this._distance};yr.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};yr.prototype.interfaces_=function(){return[Uo]};yr.prototype.getClass=function(){return yr};yr.area=function(e){return e.getBounds().getArea()};yr.isComposite=function(e){return e instanceof Er};var Yr=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new Qt,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var n=arguments[0];Ue.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},cg={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Yr.prototype.getNodeCapacity=function(){return this._nodeCapacity};Yr.prototype.lastNode=function(e){return e.get(e.size()-1)};Yr.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,r=t.getChildBoundables().iterator();r.hasNext();){var a=r.next();a instanceof Er?n+=e.size(a):a instanceof rs&&(n+=1)}return n}};Yr.prototype.removeItem=function(e,t){for(var n=null,r=e.getChildBoundables().iterator();r.hasNext();){var a=r.next();a instanceof rs&&a.getItem()===t&&(n=a)}return n!==null?(e.getChildBoundables().remove(n),!0):!1};Yr.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new Qt:t}else if(arguments.length===1){for(var n=arguments[0],r=new Qt,a=n.getChildBoundables().iterator();a.hasNext();){var c=a.next();if(c instanceof Er){var f=e.itemsTree(c);f!==null&&r.add(f)}else c instanceof rs?r.add(c.getItem()):Ue.shouldNeverReachHere()}return r.size()<=0?null:r}};Yr.prototype.insert=function(e,t){Ue.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new rs(e,t))};Yr.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var t=arguments[0],n=new Qt;return this.boundablesAtLevel(t,this._root,n),n}else if(arguments.length===3){var r=arguments[0],a=arguments[1],c=arguments[2];if(Ue.isTrue(r>-2),a.getLevel()===r)return c.add(a),null;for(var f=a.getChildBoundables().iterator();f.hasNext();){var u=f.next();u instanceof Er?e.boundablesAtLevel(r,u,c):(Ue.isTrue(u instanceof rs),r===-1&&c.add(u))}return null}};Yr.prototype.query=function(){var e=this;if(arguments.length===1){var t=arguments[0];this.build();var n=new Qt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,n),n}else if(arguments.length===2){var r=arguments[0],a=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,a)}else if(arguments.length===3){if(Te(arguments[2],_l)&&arguments[0]instanceof Object&&arguments[1]instanceof Er)for(var c=arguments[0],f=arguments[1],u=arguments[2],b=f.getChildBoundables(),C=0;C<b.size();C++){var A=b.get(C);e.getIntersectsOp().intersects(A.getBounds(),c)&&(A instanceof Er?e.query(c,A,u):A instanceof rs?u.visitItem(A.getItem()):Ue.shouldNeverReachHere())}else if(Te(arguments[2],ts)&&arguments[0]instanceof Object&&arguments[1]instanceof Er)for(var P=arguments[0],k=arguments[1],Y=arguments[2],X=k.getChildBoundables(),lt=0;lt<X.size();lt++){var ht=X.get(lt);e.getIntersectsOp().intersects(ht.getBounds(),P)&&(ht instanceof Er?e.query(P,ht,Y):ht instanceof rs?Y.add(ht.getItem()):Ue.shouldNeverReachHere())}}};Yr.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Yr.prototype.getRoot=function(){return this.build(),this._root};Yr.prototype.remove=function(){var e=this;if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,n):!1}else if(arguments.length===3){var r=arguments[0],a=arguments[1],c=arguments[2],f=this.removeItem(a,c);if(f)return!0;for(var u=null,b=a.getChildBoundables().iterator();b.hasNext();){var C=b.next();if(e.getIntersectsOp().intersects(C.getBounds(),r)&&C instanceof Er&&(f=e.remove(r,C,c),f)){u=C;break}}return u!==null&&u.getChildBoundables().isEmpty()&&a.getChildBoundables().remove(u),f}};Yr.prototype.createHigherLevels=function(e,t){Ue.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return n.size()===1?n.get(0):this.createHigherLevels(n,t+1)};Yr.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,r=t.getChildBoundables().iterator();r.hasNext();){var a=r.next();if(a instanceof Er){var c=e.depth(a);c>n&&(n=c)}}return n+1}};Yr.prototype.createParentBoundables=function(e,t){var n=this;Ue.isTrue(!e.isEmpty());var r=new Qt;r.add(this.createNode(t));var a=new Qt(e);is.sort(a,this.getComparator());for(var c=a.iterator();c.hasNext();){var f=c.next();n.lastNode(r).getChildBoundables().size()===n.getNodeCapacity()&&r.add(n.createNode(t)),n.lastNode(r).addChildBoundable(f)}return r};Yr.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Yr.prototype.interfaces_=function(){return[Go]};Yr.prototype.getClass=function(){return Yr};Yr.compareDoubles=function(e,t){return e>t?1:e<t?-1:0};cg.IntersectsOp.get=function(){return bM};cg.serialVersionUID.get=function(){return-3886435814360241e3};cg.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Yr,cg);var bM=function(){},Fh=function(){};Fh.prototype.distance=function(e,t){};Fh.prototype.interfaces_=function(){return[]};Fh.prototype.getClass=function(){return Fh};var c2=function(e){function t(r){r=r||t.DEFAULT_NODE_CAPACITY,e.call(this,r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(r,a){var c=this;Ue.isTrue(r.length>0);for(var f=new Qt,u=0;u<r.length;u++)f.addAll(c.createParentBoundablesFromVerticalSlice(r[u],a));return f},t.prototype.createNode=function(r){return new Vx(r)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];if(r.isNull())return null;e.prototype.insert.call(this,r,a)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(r,a){for(var c=Math.trunc(Math.ceil(r.size()/a)),f=new Array(a).fill(null),u=r.iterator(),b=0;b<a;b++){f[b]=new Qt;for(var C=0;u.hasNext()&&C<c;){var A=u.next();f[b].add(A),C++}}return f},t.prototype.query=function(){if(arguments.length===1){var r=arguments[0];return e.prototype.query.call(this,r)}else if(arguments.length===2){var a=arguments[0],c=arguments[1];e.prototype.query.call(this,a,c)}else if(arguments.length===3){if(Te(arguments[2],_l)&&arguments[0]instanceof Object&&arguments[1]instanceof Er){var f=arguments[0],u=arguments[1],b=arguments[2];e.prototype.query.call(this,f,u,b)}else if(Te(arguments[2],ts)&&arguments[0]instanceof Object&&arguments[1]instanceof Er){var C=arguments[0],A=arguments[1],P=arguments[2];e.prototype.query.call(this,C,A,P)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(r,a){return e.prototype.createParentBoundables.call(this,r,a)},t.prototype.remove=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return e.prototype.remove.call(this,r,a)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(r,a){Ue.isTrue(!r.isEmpty());var c=Math.trunc(Math.ceil(r.size()/this.getNodeCapacity())),f=new Qt(r);is.sort(f,t.xComparator);var u=this.verticalSlices(f,Math.trunc(Math.ceil(Math.sqrt(c))));return this.createParentBoundablesFromVerticalSlices(u,a)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(Te(arguments[0],Fh)){var r=arguments[0],a=new yr(this.getRoot(),this.getRoot(),r);return this.nearestNeighbour(a)}else if(arguments[0]instanceof yr){var c=arguments[0];return this.nearestNeighbour(c,Me.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&Te(arguments[1],Fh)){var f=arguments[0],u=arguments[1],b=new yr(this.getRoot(),f.getRoot(),u);return this.nearestNeighbour(b)}else if(arguments[0]instanceof yr&&typeof arguments[1]=="number"){var C=arguments[0],A=arguments[1],P=A,k=null,Y=new Va;for(Y.add(C);!Y.isEmpty()&&P>0;){var X=Y.poll(),lt=X.getDistance();if(lt>=P)break;X.isLeaves()?(P=lt,k=X):X.expandToQueue(Y,P)}return[k.getBoundable(0).getItem(),k.getBoundable(1).getItem()]}}else if(arguments.length===3){var ht=arguments[0],_t=arguments[1],j=arguments[2],W=new rs(ht,_t),st=new yr(this.getRoot(),W,j);return this.nearestNeighbour(st)[0]}},t.prototype.interfaces_=function(){return[Yu,Go]},t.prototype.getClass=function(){return t},t.centreX=function(r){return t.avg(r.getMinX(),r.getMaxX())},t.avg=function(r,a){return(r+a)/2},t.centreY=function(r){return t.avg(r.getMinY(),r.getMaxY())},n.STRtreeNode.get=function(){return Vx},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[Lh]},compare:function(r,a){return e.compareDoubles(t.centreX(r.getBounds()),t.centreX(a.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[Lh]},compare:function(r,a){return e.compareDoubles(t.centreY(r.getBounds()),t.centreY(a.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(r,a){return r.intersects(a)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,n),t}(Yr),Vx=function(e){function t(){var n=arguments[0];e.call(this,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var n=null,r=this.getChildBoundables().iterator();r.hasNext();){var a=r.next();n===null?n=new ye(a.getBounds()):n.expandToInclude(a.getBounds())}return n},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Er),Oi=function(){};Oi.prototype.interfaces_=function(){return[]};Oi.prototype.getClass=function(){return Oi};Oi.relativeSign=function(e,t){return e<t?-1:e>t?1:0};Oi.compare=function(e,t,n){if(t.equals2D(n))return 0;var r=Oi.relativeSign(t.x,n.x),a=Oi.relativeSign(t.y,n.y);switch(e){case 0:return Oi.compareValue(r,a);case 1:return Oi.compareValue(a,r);case 2:return Oi.compareValue(a,-r);case 3:return Oi.compareValue(-r,a);case 4:return Oi.compareValue(-r,-a);case 5:return Oi.compareValue(-a,-r);case 6:return Oi.compareValue(-a,r);case 7:return Oi.compareValue(r,-a)}return Ue.shouldNeverReachHere("invalid octant value"),0};Oi.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0};var vl=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._segString=e,this.coord=new bt(t),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!t.equals2D(e.getCoordinate(n))};vl.prototype.getCoordinate=function(){return this.coord};vl.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};vl.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:Oi.compare(this._segmentOctant,this.coord,t.coord)};vl.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};vl.prototype.isInterior=function(){return this._isInterior};vl.prototype.interfaces_=function(){return[Uo]};vl.prototype.getClass=function(){return vl};var Ti=function(){this._nodeMap=new ci,this._edge=null;var e=arguments[0];this._edge=e};Ti.prototype.getSplitCoordinates=function(){var e=this,t=new qf;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var a=n.next();e.addEdgeCoordinates(r,a,t),r=a}return t.toCoordinateArray()};Ti.prototype.addCollapsedNodes=function(){var e=this,t=new Qt;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var n=t.iterator();n.hasNext();){var r=n.next().intValue();e.add(e._edge.getCoordinate(r),r)}};Ti.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};Ti.prototype.findCollapsesFromExistingVertices=function(e){for(var t=this,n=0;n<this._edge.size()-2;n++){var r=t._edge.getCoordinate(n),a=t._edge.getCoordinate(n+2);r.equals2D(a)&&e.add(new Ps(n+1))}};Ti.prototype.addEdgeCoordinates=function(e,t,n){var r=this,a=this._edge.getCoordinate(t.segmentIndex),c=t.isInterior()||!t.coord.equals2D(a);n.add(new bt(e.coord),!1);for(var f=e.segmentIndex+1;f<=t.segmentIndex;f++)n.add(r._edge.getCoordinate(f));c&&n.add(new bt(t.coord))};Ti.prototype.iterator=function(){return this._nodeMap.values().iterator()};Ti.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),r=n.next();n.hasNext();){var a=n.next(),c=t.createSplitEdge(r,a);e.add(c),r=a}};Ti.prototype.findCollapseIndex=function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var r=t.segmentIndex-e.segmentIndex;return t.isInterior()||r--,r===1?(n[0]=e.segmentIndex+1,!0):!1};Ti.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=this,n=new Array(1).fill(null),r=this.iterator(),a=r.next();r.hasNext();){var c=r.next(),f=t.findCollapseIndex(a,c,n);f&&e.add(new Ps(n[0])),a=c}};Ti.prototype.getEdge=function(){return this._edge};Ti.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};Ti.prototype.createSplitEdge=function(e,t){var n=this,r=t.segmentIndex-e.segmentIndex+2,a=this._edge.getCoordinate(t.segmentIndex),c=t.isInterior()||!t.coord.equals2D(a);c||r--;var f=new Array(r).fill(null),u=0;f[u++]=new bt(e.coord);for(var b=e.segmentIndex+1;b<=t.segmentIndex;b++)f[u++]=n._edge.getCoordinate(b);return c&&(f[u]=new bt(t.coord)),new dr(f,this._edge.getData())};Ti.prototype.add=function(e,t){var n=new vl(this._edge,e,t,this._edge.getSegmentOctant(t)),r=this._nodeMap.get(n);return r!==null?(Ue.isTrue(r.coord.equals2D(e),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)};Ti.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),n=e.get(0),r=n.getCoordinate(0);if(!r.equals2D(t[0]))throw new za("bad split edge start point at "+r);var a=e.get(e.size()-1),c=a.getCoordinates(),f=c[c.length-1];if(!f.equals2D(t[t.length-1]))throw new za("bad split edge end point at "+f)};Ti.prototype.interfaces_=function(){return[]};Ti.prototype.getClass=function(){return Ti};var Ku=function(){};Ku.prototype.interfaces_=function(){return[]};Ku.prototype.getClass=function(){return Ku};Ku.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new jn("Cannot compute the octant for point ( "+e+", "+t+" )");var n=Math.abs(e),r=Math.abs(t);return e>=0?t>=0?n>=r?0:1:n>=r?7:6:t>=0?n>=r?3:2:n>=r?4:5}else if(arguments[0]instanceof bt&&arguments[1]instanceof bt){var a=arguments[0],c=arguments[1],f=c.x-a.x,u=c.y-a.y;if(f===0&&u===0)throw new jn("Cannot compute the octant for two identical points "+a);return Ku.octant(f,u)}};var ua=function(){};ua.prototype.getCoordinates=function(){};ua.prototype.size=function(){};ua.prototype.getCoordinate=function(e){};ua.prototype.isClosed=function(){};ua.prototype.setData=function(e){};ua.prototype.getData=function(){};ua.prototype.interfaces_=function(){return[]};ua.prototype.getClass=function(){return ua};var Af=function(){};Af.prototype.addIntersection=function(e,t){};Af.prototype.interfaces_=function(){return[ua]};Af.prototype.getClass=function(){return Af};var dr=function(){this._nodeList=new Ti(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};dr.prototype.getCoordinates=function(){return this._pts};dr.prototype.size=function(){return this._pts.length};dr.prototype.getCoordinate=function(e){return this._pts[e]};dr.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};dr.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};dr.prototype.setData=function(e){this._data=e};dr.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:Ku.octant(e,t)};dr.prototype.getData=function(){return this._data};dr.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(arguments.length===4){var n=arguments[0],r=arguments[1],a=arguments[3],c=new bt(n.getIntersection(a));this.addIntersection(c,r)}};dr.prototype.toString=function(){return es.toLineString(new hr(this._pts))};dr.prototype.getNodeList=function(){return this._nodeList};dr.prototype.addIntersectionNode=function(e,t){var n=t,r=n+1;if(r<this._pts.length){var a=this._pts[r];e.equals2D(a)&&(n=r)}var c=this._nodeList.add(e,n);return c};dr.prototype.addIntersections=function(e,t,n){for(var r=this,a=0;a<e.getIntersectionNum();a++)r.addIntersection(e,t,n,a)};dr.prototype.interfaces_=function(){return[Af]};dr.prototype.getClass=function(){return dr};dr.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],t=new Qt;return dr.getNodedSubstrings(e,t),t}else if(arguments.length===2)for(var n=arguments[0],r=arguments[1],a=n.iterator();a.hasNext();){var c=a.next();c.getNodeList().addSplitEdges(r)}};var _e=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new bt,this.p1=new bt;else if(arguments.length===1){var e=arguments[0];this.p0=new bt(e.p0),this.p1=new bt(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var t=arguments[0],n=arguments[1],r=arguments[2],a=arguments[3];this.p0=new bt(t,n),this.p1=new bt(r,a)}},h2={serialVersionUID:{configurable:!0}};_e.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};_e.prototype.orientationIndex=function(){if(arguments[0]instanceof _e){var e=arguments[0],t=oe.orientationIndex(this.p0,this.p1,e.p0),n=oe.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}else if(arguments[0]instanceof bt){var r=arguments[0];return oe.orientationIndex(this.p0,this.p1,r)}};_e.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};_e.prototype.isVertical=function(){return this.p0.x===this.p1.x};_e.prototype.equals=function(e){if(!(e instanceof _e))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)};_e.prototype.intersection=function(e){var t=new du;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null};_e.prototype.project=function(){if(arguments[0]instanceof bt){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new bt(e);var t=this.projectionFactor(e),n=new bt;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof _e){var r=arguments[0],a=this.projectionFactor(r.p0),c=this.projectionFactor(r.p1);if(a>=1&&c>=1||a<=0&&c<=0)return null;var f=this.project(r.p0);a<0&&(f=this.p0),a>1&&(f=this.p1);var u=this.project(r.p1);return c<0&&(u=this.p0),c>1&&(u=this.p1),new _e(f,u)}};_e.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};_e.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};_e.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};_e.prototype.distancePerpendicular=function(e){return oe.distancePointLinePerpendicular(e,this.p0,this.p1)};_e.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};_e.prototype.midPoint=function(){return _e.midPoint(this.p0,this.p1)};_e.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=t*t+n*n;if(r<=0)return Me.NaN;var a=((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/r;return a};_e.prototype.closestPoints=function(e){var t=this.intersection(e);if(t!==null)return[t,t];var n=new Array(2).fill(null),r=Me.MAX_VALUE,a=null,c=this.closestPoint(e.p0);r=c.distance(e.p0),n[0]=c,n[1]=e.p0;var f=this.closestPoint(e.p1);a=f.distance(e.p1),a<r&&(r=a,n[0]=f,n[1]=e.p1);var u=e.closestPoint(this.p0);a=u.distance(this.p0),a<r&&(r=a,n[0]=this.p0,n[1]=u);var b=e.closestPoint(this.p1);return a=b.distance(this.p1),a<r&&(r=a,n[0]=this.p1,n[1]=b),n};_e.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);var n=this.p0.distance(e),r=this.p1.distance(e);return n<r?this.p0:this.p1};_e.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};_e.prototype.getLength=function(){return this.p0.distance(this.p1)};_e.prototype.compareTo=function(e){var t=e,n=this.p0.compareTo(t.p0);return n!==0?n:this.p1.compareTo(t.p1)};_e.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};_e.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};_e.prototype.lineIntersection=function(e){try{var t=$o.intersection(this.p0,this.p1,e.p0,e.p1);return t}catch(n){if(!(n instanceof Kh))throw n}finally{}return null};_e.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};_e.prototype.pointAlongOffset=function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),r=this.p0.y+e*(this.p1.y-this.p0.y),a=this.p1.x-this.p0.x,c=this.p1.y-this.p0.y,f=Math.sqrt(a*a+c*c),u=0,b=0;if(t!==0){if(f<=0)throw new Error("Cannot compute offset from zero-length line segment");u=t*a/f,b=t*c/f}var C=n-b,A=r+u,P=new bt(C,A);return P};_e.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}};_e.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||Me.isNaN(t))&&(t=1),t};_e.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};_e.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};_e.prototype.distance=function(){if(arguments[0]instanceof _e){var e=arguments[0];return oe.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof bt){var t=arguments[0];return oe.distancePointLine(t,this.p0,this.p1)}};_e.prototype.pointAlong=function(e){var t=new bt;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t};_e.prototype.hashCode=function(){var e=Me.doubleToLongBits(this.p0.x);e^=Me.doubleToLongBits(this.p0.y)*31;var t=Math.trunc(e)^Math.trunc(e>>32),n=Me.doubleToLongBits(this.p1.x);n^=Me.doubleToLongBits(this.p1.y)*31;var r=Math.trunc(n)^Math.trunc(n>>32);return t^r};_e.prototype.interfaces_=function(){return[Uo,Go]};_e.prototype.getClass=function(){return _e};_e.midPoint=function(e,t){return new bt((e.x+t.x)/2,(e.y+t.y)/2)};h2.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(_e,h2);var Mf=function(){this.tempEnv1=new ye,this.tempEnv2=new ye,this._overlapSeg1=new _e,this._overlapSeg2=new _e};Mf.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];e.getLineSegment(t,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};Mf.prototype.interfaces_=function(){return[]};Mf.prototype.getClass=function(){return Mf};var ro=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._pts=e,this._start=t,this._end=n,this._context=r};ro.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]};ro.prototype.computeSelect=function(e,t,n,r){var a=this._pts[t],c=this._pts[n];if(r.tempEnv1.init(a,c),n-t===1)return r.select(this,t),null;if(!e.intersects(r.tempEnv1))return null;var f=Math.trunc((t+n)/2);t<f&&this.computeSelect(e,t,f,r),f<n&&this.computeSelect(e,f,n,r)};ro.prototype.getCoordinates=function(){for(var e=this,t=new Array(this._end-this._start+1).fill(null),n=0,r=this._start;r<=this._end;r++)t[n++]=e._pts[r];return t};ro.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)};ro.prototype.setId=function(e){this._id=e};ro.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)};ro.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],t=this._pts[this._end];this._env=new ye(e,t)}return this._env};ro.prototype.getEndIndex=function(){return this._end};ro.prototype.getStartIndex=function(){return this._start};ro.prototype.getContext=function(){return this._context};ro.prototype.getId=function(){return this._id};ro.prototype.computeOverlapsInternal=function(e,t,n,r,a,c){var f=this._pts[e],u=this._pts[t],b=n._pts[r],C=n._pts[a];if(t-e===1&&a-r===1)return c.overlap(this,e,n,r),null;if(c.tempEnv1.init(f,u),c.tempEnv2.init(b,C),!c.tempEnv1.intersects(c.tempEnv2))return null;var A=Math.trunc((e+t)/2),P=Math.trunc((r+a)/2);e<A&&(r<P&&this.computeOverlapsInternal(e,A,n,r,P,c),P<a&&this.computeOverlapsInternal(e,A,n,P,a,c)),A<t&&(r<P&&this.computeOverlapsInternal(A,t,n,r,P,c),P<a&&this.computeOverlapsInternal(A,t,n,P,a,c))};ro.prototype.interfaces_=function(){return[]};ro.prototype.getClass=function(){return ro};var Ls=function(){};Ls.prototype.interfaces_=function(){return[]};Ls.prototype.getClass=function(){return Ls};Ls.getChainStartIndices=function(e){var t=0,n=new Qt;n.add(new Ps(t));do{var r=Ls.findChainEnd(e,t);n.add(new Ps(r)),t=r}while(t<e.length-1);var a=Ls.toIntArray(n);return a};Ls.findChainEnd=function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var r=In.quadrant(e[n],e[n+1]),a=t+1;a<e.length;){if(!e[a-1].equals2D(e[a])){var c=In.quadrant(e[a-1],e[a]);if(c!==r)break}a++}return a-1};Ls.getChains=function(){if(arguments.length===1){var e=arguments[0];return Ls.getChains(e,null)}else if(arguments.length===2){for(var t=arguments[0],n=arguments[1],r=new Qt,a=Ls.getChainStartIndices(t),c=0;c<a.length-1;c++){var f=new ro(t,a[c],a[c+1],n);r.add(f)}return r}};Ls.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var iu=function(){};iu.prototype.computeNodes=function(e){};iu.prototype.getNodedSubstrings=function(){};iu.prototype.interfaces_=function(){return[]};iu.prototype.getClass=function(){return iu};var Df=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}};Df.prototype.setSegmentIntersector=function(e){this._segInt=e};Df.prototype.interfaces_=function(){return[iu]};Df.prototype.getClass=function(){return Df};var o0=function(e){function t(r){r?e.call(this,r):e.call(this),this._monoChains=new Qt,this._index=new c2,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return dr.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(r){for(var a=this,c=Ls.getChains(r.getCoordinates(),r),f=c.iterator();f.hasNext();){var u=f.next();u.setId(a._idCounter++),a._index.insert(u.getEnvelope(),u),a._monoChains.add(u)}},t.prototype.computeNodes=function(r){var a=this;this._nodedSegStrings=r;for(var c=r.iterator();c.hasNext();)a.add(c.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var r=this,a=new Ux(this._segInt),c=this._monoChains.iterator();c.hasNext();)for(var f=c.next(),u=r._index.query(f.getEnvelope()),b=u.iterator();b.hasNext();){var C=b.next();if(C.getId()>f.getId()&&(f.computeOverlaps(C,a),r._nOverlaps++),r._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return Ux},Object.defineProperties(t,n),t}(Df),Ux=function(e){function t(){e.call(this),this._si=null;var n=arguments[0];this._si=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],r=arguments[1],a=arguments[2],c=arguments[3],f=n.getContext(),u=a.getContext();this._si.processIntersections(f,r,u,c)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Mf),dn=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(arguments.length===4){var a=arguments[0],c=arguments[1],f=arguments[2],u=arguments[3];this.setQuadrantSegments(a),this.setEndCapStyle(c),this.setJoinStyle(f),this.setMitreLimit(u)}}},Wa={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};dn.prototype.getEndCapStyle=function(){return this._endCapStyle};dn.prototype.isSingleSided=function(){return this._isSingleSided};dn.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=dn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=dn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==dn.JOIN_ROUND&&(this._quadrantSegments=dn.DEFAULT_QUADRANT_SEGMENTS)};dn.prototype.getJoinStyle=function(){return this._joinStyle};dn.prototype.setJoinStyle=function(e){this._joinStyle=e};dn.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};dn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};dn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};dn.prototype.setEndCapStyle=function(e){this._endCapStyle=e};dn.prototype.getMitreLimit=function(){return this._mitreLimit};dn.prototype.setMitreLimit=function(e){this._mitreLimit=e};dn.prototype.setSingleSided=function(e){this._isSingleSided=e};dn.prototype.interfaces_=function(){return[]};dn.prototype.getClass=function(){return dn};dn.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)};Wa.CAP_ROUND.get=function(){return 1};Wa.CAP_FLAT.get=function(){return 2};Wa.CAP_SQUARE.get=function(){return 3};Wa.JOIN_ROUND.get=function(){return 1};Wa.JOIN_MITRE.get=function(){return 2};Wa.JOIN_BEVEL.get=function(){return 3};Wa.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};Wa.DEFAULT_MITRE_LIMIT.get=function(){return 5};Wa.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(dn,Wa);var or=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=oe.COUNTERCLOCKWISE,this._inputLine=e||null},Zf={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};or.prototype.isDeletable=function(e,t,n,r){var a=this._inputLine[e],c=this._inputLine[t],f=this._inputLine[n];return!this.isConcave(a,c,f)||!this.isShallow(a,c,f,r)?!1:this.isShallowSampled(a,c,e,n,r)};or.prototype.deleteShallowConcavities=function(){for(var e=this,t=1,n=this.findNextNonDeletedIndex(t),r=this.findNextNonDeletedIndex(n),a=!1;r<this._inputLine.length;){var c=!1;e.isDeletable(t,n,r,e._distanceTol)&&(e._isDeleted[n]=or.DELETE,c=!0,a=!0),c?t=r:t=n,n=e.findNextNonDeletedIndex(t),r=e.findNextNonDeletedIndex(n)}return a};or.prototype.isShallowConcavity=function(e,t,n,r){var a=oe.computeOrientation(e,t,n),c=a===this._angleOrientation;if(!c)return!1;var f=oe.distancePointLine(t,e,n);return f<r};or.prototype.isShallowSampled=function(e,t,n,r,a){var c=this,f=Math.trunc((r-n)/or.NUM_PTS_TO_CHECK);f<=0&&(f=1);for(var u=n;u<r;u+=f)if(!c.isShallow(e,t,c._inputLine[u],a))return!1;return!0};or.prototype.isConcave=function(e,t,n){var r=oe.computeOrientation(e,t,n),a=r===this._angleOrientation;return a};or.prototype.simplify=function(e){var t=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=oe.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=t.deleteShallowConcavities();while(n);return this.collapseLine()};or.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===or.DELETE;)t++;return t};or.prototype.isShallow=function(e,t,n,r){var a=oe.distancePointLine(t,e,n);return a<r};or.prototype.collapseLine=function(){for(var e=this,t=new qf,n=0;n<this._inputLine.length;n++)e._isDeleted[n]!==or.DELETE&&t.add(e._inputLine[n]);return t.toCoordinateArray()};or.prototype.interfaces_=function(){return[]};or.prototype.getClass=function(){return or};or.simplify=function(e,t){var n=new or(e);return n.simplify(t)};Zf.INIT.get=function(){return 0};Zf.DELETE.get=function(){return 1};Zf.KEEP.get=function(){return 1};Zf.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(or,Zf);var Co=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Qt},p2={COORDINATE_ARRAY_TYPE:{configurable:!0}};Co.prototype.getCoordinates=function(){var e=this._ptList.toArray(Co.COORDINATE_ARRAY_TYPE);return e};Co.prototype.setPrecisionModel=function(e){this._precisionModel=e};Co.prototype.addPt=function(e){var t=new bt(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)};Co.prototype.revere=function(){};Co.prototype.addPts=function(e,t){var n=this;if(t)for(var r=0;r<e.length;r++)n.addPt(e[r]);else for(var a=e.length-1;a>=0;a--)n.addPt(e[a])};Co.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1),n=e.distance(t);return n<this._minimimVertexDistance};Co.prototype.toString=function(){var e=new $e,t=e.createLineString(this.getCoordinates());return t.toString()};Co.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new bt(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)};Co.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};Co.prototype.interfaces_=function(){return[]};Co.prototype.getClass=function(){return Co};p2.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Co,p2);var rn=function(){},fc={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};rn.prototype.interfaces_=function(){return[]};rn.prototype.getClass=function(){return rn};rn.toDegrees=function(e){return e*180/Math.PI};rn.normalize=function(e){for(;e>Math.PI;)e-=rn.PI_TIMES_2;for(;e<=-Math.PI;)e+=rn.PI_TIMES_2;return e};rn.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],r=n.x-t.x,a=n.y-t.y;return Math.atan2(a,r)}};rn.isAcute=function(e,t,n){var r=e.x-t.x,a=e.y-t.y,c=n.x-t.x,f=n.y-t.y,u=r*c+a*f;return u>0};rn.isObtuse=function(e,t,n){var r=e.x-t.x,a=e.y-t.y,c=n.x-t.x,f=n.y-t.y,u=r*c+a*f;return u<0};rn.interiorAngle=function(e,t,n){var r=rn.angle(t,e),a=rn.angle(t,n);return Math.abs(a-r)};rn.normalizePositive=function(e){if(e<0){for(;e<0;)e+=rn.PI_TIMES_2;e>=rn.PI_TIMES_2&&(e=0)}else{for(;e>=rn.PI_TIMES_2;)e-=rn.PI_TIMES_2;e<0&&(e=0)}return e};rn.angleBetween=function(e,t,n){var r=rn.angle(t,e),a=rn.angle(t,n);return rn.diff(r,a)};rn.diff=function(e,t){var n=null;return e<t?n=t-e:n=e-t,n>Math.PI&&(n=2*Math.PI-n),n};rn.toRadians=function(e){return e*Math.PI/180};rn.getTurn=function(e,t){var n=Math.sin(t-e);return n>0?rn.COUNTERCLOCKWISE:n<0?rn.CLOCKWISE:rn.NONE};rn.angleBetweenOriented=function(e,t,n){var r=rn.angle(t,e),a=rn.angle(t,n),c=a-r;return c<=-Math.PI?c+rn.PI_TIMES_2:c>Math.PI?c-rn.PI_TIMES_2:c};fc.PI_TIMES_2.get=function(){return 2*Math.PI};fc.PI_OVER_2.get=function(){return Math.PI/2};fc.PI_OVER_4.get=function(){return Math.PI/4};fc.COUNTERCLOCKWISE.get=function(){return oe.COUNTERCLOCKWISE};fc.CLOCKWISE.get=function(){return oe.CLOCKWISE};fc.NONE.get=function(){return oe.COLLINEAR};Object.defineProperties(rn,fc);var Bn=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new _e,this._seg1=new _e,this._offset0=new _e,this._offset1=new _e,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new du,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===dn.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},Hf={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Bn.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=oe.computeOrientation(this._s0,this._s1,this._s2),r=n===oe.CLOCKWISE&&this._side===qt.LEFT||n===oe.COUNTERCLOCKWISE&&this._side===qt.RIGHT;n===0?this.addCollinear(t):r?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)};Bn.prototype.addLineEndCap=function(e,t){var n=new _e(e,t),r=new _e;this.computeOffsetSegment(n,qt.LEFT,this._distance,r);var a=new _e;this.computeOffsetSegment(n,qt.RIGHT,this._distance,a);var c=t.x-e.x,f=t.y-e.y,u=Math.atan2(f,c);switch(this._bufParams.getEndCapStyle()){case dn.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(t,u+Math.PI/2,u-Math.PI/2,oe.CLOCKWISE,this._distance),this._segList.addPt(a.p1);break;case dn.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(a.p1);break;case dn.CAP_SQUARE:var b=new bt;b.x=Math.abs(this._distance)*Math.cos(u),b.y=Math.abs(this._distance)*Math.sin(u);var C=new bt(r.p1.x+b.x,r.p1.y+b.y),A=new bt(a.p1.x+b.x,a.p1.y+b.y);this._segList.addPt(C),this._segList.addPt(A);break}};Bn.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};Bn.prototype.addMitreJoin=function(e,t,n,r){var a=!0,c=null;try{c=$o.intersection(t.p0,t.p1,n.p0,n.p1);var f=r<=0?1:c.distance(e)/Math.abs(r);f>this._bufParams.getMitreLimit()&&(a=!1)}catch(u){if(u instanceof Kh)c=new bt(0,0),a=!1;else throw u}finally{}a?this._segList.addPt(c):this.addLimitedMitreJoin(t,n,r,this._bufParams.getMitreLimit())};Bn.prototype.addFilletCorner=function(e,t,n,r,a){var c=t.x-e.x,f=t.y-e.y,u=Math.atan2(f,c),b=n.x-e.x,C=n.y-e.y,A=Math.atan2(C,b);r===oe.CLOCKWISE?u<=A&&(u+=2*Math.PI):u>=A&&(u-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,u,A,r,a),this._segList.addPt(n)};Bn.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Bn.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===dn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===dn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};Bn.prototype.createSquare=function(e){this._segList.addPt(new bt(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new bt(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new bt(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new bt(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};Bn.prototype.addSegments=function(e,t){this._segList.addPts(e,t)};Bn.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};Bn.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};Bn.prototype.initSideSegments=function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};Bn.prototype.addLimitedMitreJoin=function(e,t,n,r){var a=this._seg0.p1,c=rn.angle(a,this._seg0.p0),f=rn.angleBetweenOriented(this._seg0.p0,a,this._seg1.p1),u=f/2,b=rn.normalize(c+u),C=rn.normalize(b+Math.PI),A=r*n,P=A*Math.abs(Math.sin(u)),k=n-P,Y=a.x+A*Math.cos(C),X=a.y+A*Math.sin(C),lt=new bt(Y,X),ht=new _e(a,lt),_t=ht.pointAlongOffset(1,k),j=ht.pointAlongOffset(1,-k);this._side===qt.LEFT?(this._segList.addPt(_t),this._segList.addPt(j)):(this._segList.addPt(j),this._segList.addPt(_t))};Bn.prototype.computeOffsetSegment=function(e,t,n,r){var a=t===qt.LEFT?1:-1,c=e.p1.x-e.p0.x,f=e.p1.y-e.p0.y,u=Math.sqrt(c*c+f*f),b=a*n*c/u,C=a*n*f/u;r.p0.x=e.p0.x-C,r.p0.y=e.p0.y+b,r.p1.x=e.p1.x-C,r.p1.y=e.p1.y+b};Bn.prototype.addFilletArc=function(e,t,n,r,a){var c=this,f=r===oe.CLOCKWISE?-1:1,u=Math.abs(t-n),b=Math.trunc(u/this._filletAngleQuantum+.5);if(b<1)return null;for(var C=0,A=u/b,P=C,k=new bt;P<u;){var Y=t+f*P;k.x=e.x+a*Math.cos(Y),k.y=e.y+a*Math.sin(Y),c._segList.addPt(k),P+=A}};Bn.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Bn.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new bt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new bt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};Bn.prototype.createCircle=function(e){var t=new bt(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};Bn.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)};Bn.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Co,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*Bn.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};Bn.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var t=this._li.getIntersectionNum();t>=2&&(this._bufParams.getJoinStyle()===dn.JOIN_BEVEL||this._bufParams.getJoinStyle()===dn.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,oe.CLOCKWISE,this._distance))};Bn.prototype.closeRing=function(){this._segList.closeRing()};Bn.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};Bn.prototype.interfaces_=function(){return[]};Bn.prototype.getClass=function(){return Bn};Hf.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};Hf.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};Hf.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};Hf.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(Bn,Hf);var Bi=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t};Bi.prototype.getOffsetCurve=function(e,t){if(this._distance=t,t===0)return null;var n=t<0,r=Math.abs(t),a=this.getSegGen(r);e.length<=1?this.computePointCurve(e[0],a):this.computeOffsetCurve(e,n,a);var c=a.getCoordinates();return n&&Ke.reverse(c),c};Bi.prototype.computeSingleSidedBufferCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var a=or.simplify(e,-r),c=a.length-1;n.initSideSegments(a[c],a[c-1],qt.LEFT),n.addFirstSegment();for(var f=c-2;f>=0;f--)n.addNextSegment(a[f],!0)}else{n.addSegments(e,!1);var u=or.simplify(e,r),b=u.length-1;n.initSideSegments(u[0],u[1],qt.LEFT),n.addFirstSegment();for(var C=2;C<=b;C++)n.addNextSegment(u[C],!0)}n.addLastSegment(),n.closeRing()};Bi.prototype.computeRingBufferCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);t===qt.RIGHT&&(r=-r);var a=or.simplify(e,r),c=a.length-1;n.initSideSegments(a[c-1],a[0],t);for(var f=1;f<=c;f++){var u=f!==1;n.addNextSegment(a[f],u)}n.closeRing()};Bi.prototype.computeLineBufferCurve=function(e,t){var n=this.simplifyTolerance(this._distance),r=or.simplify(e,n),a=r.length-1;t.initSideSegments(r[0],r[1],qt.LEFT);for(var c=2;c<=a;c++)t.addNextSegment(r[c],!0);t.addLastSegment(),t.addLineEndCap(r[a-1],r[a]);var f=or.simplify(e,-n),u=f.length-1;t.initSideSegments(f[u],f[u-1],qt.LEFT);for(var b=u-2;b>=0;b--)t.addNextSegment(f[b],!0);t.addLastSegment(),t.addLineEndCap(f[1],f[0]),t.closeRing()};Bi.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case dn.CAP_ROUND:t.createCircle(e);break;case dn.CAP_SQUARE:t.createSquare(e);break}};Bi.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided()||t===0)return null;var n=Math.abs(t),r=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],r);else if(this._bufParams.isSingleSided()){var a=t<0;this.computeSingleSidedBufferCurve(e,a,r)}else this.computeLineBufferCurve(e,r);var c=r.getCoordinates();return c};Bi.prototype.getBufferParameters=function(){return this._bufParams};Bi.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};Bi.prototype.getRingCurve=function(e,t,n){if(this._distance=n,e.length<=2)return this.getLineCurve(e,n);if(n===0)return Bi.copyCoordinates(e);var r=this.getSegGen(n);return this.computeRingBufferCurve(e,t,r),r.getCoordinates()};Bi.prototype.computeOffsetCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){var a=or.simplify(e,-r),c=a.length-1;n.initSideSegments(a[c],a[c-1],qt.LEFT),n.addFirstSegment();for(var f=c-2;f>=0;f--)n.addNextSegment(a[f],!0)}else{var u=or.simplify(e,r),b=u.length-1;n.initSideSegments(u[0],u[1],qt.LEFT),n.addFirstSegment();for(var C=2;C<=b;C++)n.addNextSegment(u[C],!0)}n.addLastSegment()};Bi.prototype.getSegGen=function(e){return new Bn(this._precisionModel,this._bufParams,e)};Bi.prototype.interfaces_=function(){return[]};Bi.prototype.getClass=function(){return Bi};Bi.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new bt(e[n]);return t};var Ju=function(){this._subgraphs=null,this._seg=new _e,this._cga=new oe;var e=arguments[0];this._subgraphs=e},f2={DepthSegment:{configurable:!0}};Ju.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=new Qt,r=this._subgraphs.iterator();r.hasNext();){var a=r.next(),c=a.getEnvelope();t.y<c.getMinY()||t.y>c.getMaxY()||e.findStabbedSegments(t,a.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(Te(arguments[2],ts)&&arguments[0]instanceof bt&&arguments[1]instanceof w_)for(var f=arguments[0],u=arguments[1],b=arguments[2],C=u.getEdge().getCoordinates(),A=0;A<C.length-1;A++){e._seg.p0=C[A],e._seg.p1=C[A+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var P=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(P<f.x)&&!e._seg.isHorizontal()&&!(f.y<e._seg.p0.y||f.y>e._seg.p1.y)&&oe.computeOrientation(e._seg.p0,e._seg.p1,f)!==oe.RIGHT){var k=u.getDepth(qt.LEFT);e._seg.p0.equals(C[A])||(k=u.getDepth(qt.RIGHT));var Y=new ou(e._seg,k);b.add(Y)}}else if(Te(arguments[2],ts)&&arguments[0]instanceof bt&&Te(arguments[1],ts))for(var X=arguments[0],lt=arguments[1],ht=arguments[2],_t=lt.iterator();_t.hasNext();){var j=_t.next();j.isForward()&&e.findStabbedSegments(X,j,ht)}}};Ju.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(t.size()===0)return 0;var n=is.min(t);return n._leftDepth};Ju.prototype.interfaces_=function(){return[]};Ju.prototype.getClass=function(){return Ju};f2.DepthSegment.get=function(){return ou};Object.defineProperties(Ju,f2);var ou=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new _e(e),this._leftDepth=t};ou.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return n!==0||(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(t._upwardSeg)};ou.prototype.compareX=function(e,t){var n=e.p0.compareTo(t.p0);return n!==0?n:e.p1.compareTo(t.p1)};ou.prototype.toString=function(){return this._upwardSeg.toString()};ou.prototype.interfaces_=function(){return[Uo]};ou.prototype.getClass=function(){return ou};var mn=function(e,t,n){this.p0=e||null,this.p1=t||null,this.p2=n||null};mn.prototype.area=function(){return mn.area(this.p0,this.p1,this.p2)};mn.prototype.signedArea=function(){return mn.signedArea(this.p0,this.p1,this.p2)};mn.prototype.interpolateZ=function(e){if(e===null)throw new jn("Supplied point is null.");return mn.interpolateZ(e,this.p0,this.p1,this.p2)};mn.prototype.longestSideLength=function(){return mn.longestSideLength(this.p0,this.p1,this.p2)};mn.prototype.isAcute=function(){return mn.isAcute(this.p0,this.p1,this.p2)};mn.prototype.circumcentre=function(){return mn.circumcentre(this.p0,this.p1,this.p2)};mn.prototype.area3D=function(){return mn.area3D(this.p0,this.p1,this.p2)};mn.prototype.centroid=function(){return mn.centroid(this.p0,this.p1,this.p2)};mn.prototype.inCentre=function(){return mn.inCentre(this.p0,this.p1,this.p2)};mn.prototype.interfaces_=function(){return[]};mn.prototype.getClass=function(){return mn};mn.area=function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)};mn.signedArea=function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2};mn.det=function(e,t,n,r){return e*r-t*n};mn.interpolateZ=function(e,t,n,r){var a=t.x,c=t.y,f=n.x-a,u=r.x-a,b=n.y-c,C=r.y-c,A=f*C-u*b,P=e.x-a,k=e.y-c,Y=(C*P-u*k)/A,X=(-b*P+f*k)/A,lt=t.z+Y*(n.z-t.z)+X*(r.z-t.z);return lt};mn.longestSideLength=function(e,t,n){var r=e.distance(t),a=t.distance(n),c=n.distance(e),f=r;return a>f&&(f=a),c>f&&(f=c),f};mn.isAcute=function(e,t,n){return!(!rn.isAcute(e,t,n)||!rn.isAcute(t,n,e)||!rn.isAcute(n,e,t))};mn.circumcentre=function(e,t,n){var r=n.x,a=n.y,c=e.x-r,f=e.y-a,u=t.x-r,b=t.y-a,C=2*mn.det(c,f,u,b),A=mn.det(f,c*c+f*f,b,u*u+b*b),P=mn.det(c,c*c+f*f,u,u*u+b*b),k=r-A/C,Y=a+P/C;return new bt(k,Y)};mn.perpendicularBisector=function(e,t){var n=t.x-e.x,r=t.y-e.y,a=new $o(e.x+n/2,e.y+r/2,1),c=new $o(e.x-r+n/2,e.y+n+r/2,1);return new $o(a,c)};mn.angleBisector=function(e,t,n){var r=t.distance(e),a=t.distance(n),c=r/(r+a),f=n.x-e.x,u=n.y-e.y,b=new bt(e.x+c*f,e.y+c*u);return b};mn.area3D=function(e,t,n){var r=t.x-e.x,a=t.y-e.y,c=t.z-e.z,f=n.x-e.x,u=n.y-e.y,b=n.z-e.z,C=a*b-c*u,A=c*f-r*b,P=r*u-a*f,k=C*C+A*A+P*P,Y=Math.sqrt(k)/2;return Y};mn.centroid=function(e,t,n){var r=(e.x+t.x+n.x)/3,a=(e.y+t.y+n.y)/3;return new bt(r,a)};mn.inCentre=function(e,t,n){var r=t.distance(n),a=e.distance(n),c=e.distance(t),f=r+a+c,u=(r*e.x+a*t.x+c*n.x)/f,b=(r*e.y+a*t.y+c*n.y)/f;return new bt(u,b)};var Vo=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Qt;var e=arguments[0],t=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=n};Vo.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,St.EXTERIOR,St.INTERIOR)};Vo.prototype.addPolygon=function(e){var t=this,n=this._distance,r=qt.LEFT;this._distance<0&&(n=-this._distance,r=qt.RIGHT);var a=e.getExteriorRing(),c=Ke.removeRepeatedPoints(a.getCoordinates());if(this._distance<0&&this.isErodedCompletely(a,this._distance)||this._distance<=0&&c.length<3)return null;this.addPolygonRing(c,n,r,St.EXTERIOR,St.INTERIOR);for(var f=0;f<e.getNumInteriorRing();f++){var u=e.getInteriorRingN(f),b=Ke.removeRepeatedPoints(u.getCoordinates());t._distance>0&&t.isErodedCompletely(u,-t._distance)||t.addPolygonRing(b,n,qt.opposite(r),St.INTERIOR,St.EXTERIOR)}};Vo.prototype.isTriangleErodedCompletely=function(e,t){var n=new mn(e[0],e[1],e[2]),r=n.inCentre(),a=oe.distancePointLine(r,n.p0,n.p1);return a<Math.abs(t)};Vo.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=Ke.removeRepeatedPoints(e.getCoordinates()),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,St.EXTERIOR,St.INTERIOR)};Vo.prototype.addCurve=function(e,t,n){if(e===null||e.length<2)return null;var r=new dr(e,new bn(0,St.BOUNDARY,t,n));this._curveList.add(r)};Vo.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Vo.prototype.addPolygonRing=function(e,t,n,r,a){if(t===0&&e.length<aa.MINIMUM_VALID_SIZE)return null;var c=r,f=a;e.length>=aa.MINIMUM_VALID_SIZE&&oe.isCCW(e)&&(c=a,f=r,n=qt.opposite(n));var u=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(u,c,f)};Vo.prototype.add=function(e){if(e.isEmpty())return null;e instanceof Cr?this.addPolygon(e):e instanceof ir?this.addLineString(e):e instanceof eo?this.addPoint(e):e instanceof Nh?this.addCollection(e):e instanceof ru?this.addCollection(e):e instanceof ra?this.addCollection(e):e instanceof Ei&&this.addCollection(e)};Vo.prototype.isErodedCompletely=function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(n.length===4)return this.isTriangleErodedCompletely(n,t);var r=e.getEnvelopeInternal(),a=Math.min(r.getHeight(),r.getWidth());return t<0&&2*Math.abs(t)>a};Vo.prototype.addCollection=function(e){for(var t=this,n=0;n<e.getNumGeometries();n++){var r=e.getGeometryN(n);t.add(r)}};Vo.prototype.interfaces_=function(){return[]};Vo.prototype.getClass=function(){return Vo};var Bh=function(){};Bh.prototype.locate=function(e){};Bh.prototype.interfaces_=function(){return[]};Bh.prototype.getClass=function(){return Bh};var ia=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};ia.prototype.next=function(){if(this._atStart)return this._atStart=!1,ia.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Qh;var e=this._parent.getGeometryN(this._index++);return e instanceof Ei?(this._subcollectionIterator=new ia(e),this._subcollectionIterator.next()):e};ia.prototype.remove=function(){throw new Error(this.getClass().getName())};ia.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};ia.prototype.interfaces_=function(){return[Jh]};ia.prototype.getClass=function(){return ia};ia.isAtomic=function(e){return!(e instanceof Ei)};var _o=function(){this._geom=null;var e=arguments[0];this._geom=e};_o.prototype.locate=function(e){return _o.locate(e,this._geom)};_o.prototype.interfaces_=function(){return[Bh]};_o.prototype.getClass=function(){return _o};_o.isPointInRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?oe.isPointInRing(e,t.getCoordinates()):!1};_o.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!_o.isPointInRing(e,n))return!1;for(var r=0;r<t.getNumInteriorRing();r++){var a=t.getInteriorRingN(r);if(_o.isPointInRing(e,a))return!1}return!0};_o.containsPoint=function(e,t){if(t instanceof Cr)return _o.containsPointInPolygon(e,t);if(t instanceof Ei)for(var n=new ia(t);n.hasNext();){var r=n.next();if(r!==t&&_o.containsPoint(e,r))return!0}return!1};_o.locate=function(e,t){return t.isEmpty()?St.EXTERIOR:_o.containsPoint(e,t)?St.INTERIOR:St.EXTERIOR};var pi=function(){this._edgeMap=new ci,this._edgeList=null,this._ptInAreaLocation=[St.NONE,St.NONE]};pi.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return t===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};pi.prototype.propagateSideLabels=function(e){for(var t=St.NONE,n=this.iterator();n.hasNext();){var r=n.next(),a=r.getLabel();a.isArea(e)&&a.getLocation(e,qt.LEFT)!==St.NONE&&(t=a.getLocation(e,qt.LEFT))}if(t===St.NONE)return null;for(var c=t,f=this.iterator();f.hasNext();){var u=f.next(),b=u.getLabel();if(b.getLocation(e,qt.ON)===St.NONE&&b.setLocation(e,qt.ON,c),b.isArea(e)){var C=b.getLocation(e,qt.LEFT),A=b.getLocation(e,qt.RIGHT);if(A!==St.NONE){if(A!==c)throw new Ba("side location conflict",u.getCoordinate());C===St.NONE&&Ue.shouldNeverReachHere("found single null side (at "+u.getCoordinate()+")"),c=C}else Ue.isTrue(b.getLocation(e,qt.LEFT)===St.NONE,"found single null side"),b.setLocation(e,qt.RIGHT,c),b.setLocation(e,qt.LEFT,c)}}};pi.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var t=e.next();return t.getCoordinate()};pi.prototype.print=function(e){ri.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};pi.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};pi.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,r=t.get(n).getLabel(),a=r.getLocation(e,qt.LEFT);Ue.isTrue(a!==St.NONE,"Found unlabelled area edge");for(var c=a,f=this.iterator();f.hasNext();){var u=f.next(),b=u.getLabel();Ue.isTrue(b.isArea(e),"Found non-area edge");var C=b.getLocation(e,qt.LEFT),A=b.getLocation(e,qt.RIGHT);if(C===A||A!==c)return!1;c=C}return!0};pi.prototype.findIndex=function(e){var t=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var r=t._edgeList.get(n);if(r===e)return n}return-1};pi.prototype.iterator=function(){return this.getEdges().iterator()};pi.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new Qt(this._edgeMap.values())),this._edgeList};pi.prototype.getLocation=function(e,t,n){return this._ptInAreaLocation[e]===St.NONE&&(this._ptInAreaLocation[e]=_o.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]};pi.prototype.toString=function(){var e=new Gs;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append(`
`)}return e.toString()};pi.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.computeLabel(e)}};pi.prototype.computeLabelling=function(e){var t=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],r=this.iterator();r.hasNext();)for(var a=r.next(),c=a.getLabel(),f=0;f<2;f++)c.isLine(f)&&c.getLocation(f)===St.BOUNDARY&&(n[f]=!0);for(var u=this.iterator();u.hasNext();)for(var b=u.next(),C=b.getLabel(),A=0;A<2;A++)if(C.isAnyNull(A)){var P=St.NONE;if(n[A])P=St.EXTERIOR;else{var k=b.getCoordinate();P=t.getLocation(A,k,e)}C.setAllLocationsIfNull(A,P)}};pi.prototype.getDegree=function(){return this._edgeMap.size()};pi.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null};pi.prototype.interfaces_=function(){return[]};pi.prototype.getClass=function(){return pi};var wM=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var r=null,a=null,c=this._SCANNING_FOR_INCOMING,f=0;f<this._resultAreaEdgeList.size();f++){var u=n._resultAreaEdgeList.get(f),b=u.getSym();if(u.getLabel().isArea())switch(r===null&&u.isInResult()&&(r=u),c){case n._SCANNING_FOR_INCOMING:if(!b.isInResult())continue;a=b,c=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!u.isInResult())continue;a.setNext(u),c=n._SCANNING_FOR_INCOMING;break}}if(c===this._LINKING_TO_OUTGOING){if(r===null)throw new Ba("no outgoing dirEdge found",this.getCoordinate());Ue.isTrue(r.isInResult(),"unable to link last incoming dirEdge"),a.setNext(r)}},t.prototype.insert=function(n){var r=n;this.insertEdgeEnd(r,r)},t.prototype.getRightmostEdge=function(){var n=this.getEdges(),r=n.size();if(r<1)return null;var a=n.get(0);if(r===1)return a;var c=n.get(r-1),f=a.getQuadrant(),u=c.getQuadrant();return In.isNorthern(f)&&In.isNorthern(u)?a:!In.isNorthern(f)&&!In.isNorthern(u)?c:a.getDy()!==0?a:c.getDy()!==0?c:(Ue.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(n){ri.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var a=r.next();n.print("out "),a.print(n),n.println(),n.print("in "),a.getSym().print(n),n.println()}},t.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Qt;for(var r=this.iterator();r.hasNext();){var a=r.next();(a.isInResult()||a.getSym().isInResult())&&n._resultAreaEdgeList.add(a)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(n){for(var r=this.iterator();r.hasNext();){var a=r.next(),c=a.getLabel();c.setAllLocationsIfNull(0,n.getLocation(0)),c.setAllLocationsIfNull(1,n.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var r=null,a=null,c=this._edgeList.size()-1;c>=0;c--){var f=n._edgeList.get(c),u=f.getSym();a===null&&(a=u),r!==null&&u.setNext(r),r=f}a.setNext(r)},t.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var r=arguments[0],a=this.findIndex(r),c=r.getDepth(qt.LEFT),f=r.getDepth(qt.RIGHT),u=this.computeDepths(a+1,this._edgeList.size(),c),b=this.computeDepths(0,a,u);if(b!==f)throw new Ba("depth mismatch at "+r.getCoordinate())}else if(arguments.length===3){for(var C=arguments[0],A=arguments[1],P=arguments[2],k=P,Y=C;Y<A;Y++){var X=n._edgeList.get(Y);X.setEdgeDepths(qt.RIGHT,k),k=X.getDepth(qt.LEFT)}return k}},t.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var r=n.next(),a=r.getLabel();a.merge(r.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(n){for(var r=this,a=null,c=null,f=this._SCANNING_FOR_INCOMING,u=this._resultAreaEdgeList.size()-1;u>=0;u--){var b=r._resultAreaEdgeList.get(u),C=b.getSym();switch(a===null&&b.getEdgeRing()===n&&(a=b),f){case r._SCANNING_FOR_INCOMING:if(C.getEdgeRing()!==n)continue;c=C,f=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(b.getEdgeRing()!==n)continue;c.setNextMin(b),f=r._SCANNING_FOR_INCOMING;break}}f===this._LINKING_TO_OUTGOING&&(Ue.isTrue(a!==null,"found null for first outgoing dirEdge"),Ue.isTrue(a.getEdgeRing()===n,"unable to link last incoming dirEdge"),c.setNextMin(a))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,r=this.iterator();r.hasNext();){var a=r.next();a.isInResult()&&n++}return n}else if(arguments.length===1){for(var c=arguments[0],f=0,u=this.iterator();u.hasNext();){var b=u.next();b.getEdgeRing()===c&&f++}return f}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var n=St.NONE,r=this.iterator();r.hasNext();){var a=r.next(),c=a.getSym();if(!a.isLineEdge()){if(a.isInResult()){n=St.INTERIOR;break}if(c.isInResult()){n=St.EXTERIOR;break}}}if(n===St.NONE)return null;for(var f=n,u=this.iterator();u.hasNext();){var b=u.next(),C=b.getSym();b.isLineEdge()?b.getEdge().setCovered(f===St.INTERIOR):(b.isInResult()&&(f=St.EXTERIOR),C.isInResult()&&(f=St.INTERIOR))}},t.prototype.computeLabelling=function(n){var r=this;e.prototype.computeLabelling.call(this,n),this._label=new bn(St.NONE);for(var a=this.iterator();a.hasNext();)for(var c=a.next(),f=c.getEdge(),u=f.getLabel(),b=0;b<2;b++){var C=u.getLocation(b);(C===St.INTERIOR||C===St.BOUNDARY)&&r._label.setLocation(b,St.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(pi),d2=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(n){return new ug(n,new wM)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Oh),xl=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};xl.prototype.compareTo=function(e){var t=e,n=xl.compareOriented(this._pts,this._orientation,t._pts,t._orientation);return n};xl.prototype.interfaces_=function(){return[Uo]};xl.prototype.getClass=function(){return xl};xl.orientation=function(e){return Ke.increasingDirection(e)===1};xl.compareOriented=function(e,t,n,r){for(var a=t?1:-1,c=r?1:-1,f=t?e.length:-1,u=r?n.length:-1,b=t?0:e.length-1,C=r?0:n.length-1;;){var A=e[b].compareTo(n[C]);if(A!==0)return A;b+=a,C+=c;var P=b===f,k=C===u;if(P&&!k)return-1;if(!P&&k)return 1;if(P&&k)return 0}};var os=function(){this._edges=new Qt,this._ocaMap=new ci};os.prototype.print=function(e){var t=this;e.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var r=t._edges.get(n);n>0&&e.print(","),e.print("(");for(var a=r.getCoordinates(),c=0;c<a.length;c++)c>0&&e.print(","),e.print(a[c].x+" "+a[c].y);e.println(")")}e.print(")  ")};os.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next())};os.prototype.findEdgeIndex=function(e){for(var t=this,n=0;n<this._edges.size();n++)if(t._edges.get(n).equals(e))return n;return-1};os.prototype.iterator=function(){return this._edges.iterator()};os.prototype.getEdges=function(){return this._edges};os.prototype.get=function(e){return this._edges.get(e)};os.prototype.findEqualEdge=function(e){var t=new xl(e.getCoordinates()),n=this._ocaMap.get(t);return n};os.prototype.add=function(e){this._edges.add(e);var t=new xl(e.getCoordinates());this._ocaMap.put(t,e)};os.prototype.interfaces_=function(){return[]};os.prototype.getClass=function(){return os};var su=function(){};su.prototype.processIntersections=function(e,t,n,r){};su.prototype.isDone=function(){};su.prototype.interfaces_=function(){return[]};su.prototype.getClass=function(){return su};var To=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};To.prototype.isTrivialIntersection=function(e,t,n,r){if(e===n&&this._li.getIntersectionNum()===1){if(To.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var a=e.size()-1;if(t===0&&r===a||r===0&&t===a)return!0}}return!1};To.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};To.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};To.prototype.getLineIntersector=function(){return this._li};To.prototype.hasProperIntersection=function(){return this._hasProper};To.prototype.processIntersections=function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var a=e.getCoordinates()[t],c=e.getCoordinates()[t+1],f=n.getCoordinates()[r],u=n.getCoordinates()[r+1];this._li.computeIntersection(a,c,f,u),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};To.prototype.hasIntersection=function(){return this._hasIntersection};To.prototype.isDone=function(){return!1};To.prototype.hasInteriorIntersection=function(){return this._hasInterior};To.prototype.interfaces_=function(){return[su]};To.prototype.getClass=function(){return To};To.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var Ns=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.coord=new bt(e),this.segmentIndex=t,this.dist=n};Ns.prototype.getSegmentIndex=function(){return this.segmentIndex};Ns.prototype.getCoordinate=function(){return this.coord};Ns.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};Ns.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)};Ns.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};Ns.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};Ns.prototype.getDistance=function(){return this.dist};Ns.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0};Ns.prototype.interfaces_=function(){return[Uo]};Ns.prototype.getClass=function(){return Ns};var ca=function(){this._nodeMap=new ci,this.edge=null;var e=arguments[0];this.edge=e};ca.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};ca.prototype.iterator=function(){return this._nodeMap.values().iterator()};ca.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var a=n.next(),c=t.createSplitEdge(r,a);e.add(c),r=a}};ca.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};ca.prototype.createSplitEdge=function(e,t){var n=this,r=t.segmentIndex-e.segmentIndex+2,a=this.edge.pts[t.segmentIndex],c=t.dist>0||!t.coord.equals2D(a);c||r--;var f=new Array(r).fill(null),u=0;f[u++]=new bt(e.coord);for(var b=e.segmentIndex+1;b<=t.segmentIndex;b++)f[u++]=n.edge.pts[b];return c&&(f[u]=t.coord),new Gm(f,new bn(this.edge._label))};ca.prototype.add=function(e,t,n){var r=new Ns(e,t,n),a=this._nodeMap.get(r);return a!==null?a:(this._nodeMap.put(r,r),r)};ca.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();if(n.coord.equals(e))return!0}return!1};ca.prototype.interfaces_=function(){return[]};ca.prototype.getClass=function(){return ca};var au=function(){};au.prototype.getChainStartIndices=function(e){var t=this,n=0,r=new Qt;r.add(new Ps(n));do{var a=t.findChainEnd(e,n);r.add(new Ps(a)),n=a}while(n<e.length-1);var c=au.toIntArray(r);return c};au.prototype.findChainEnd=function(e,t){for(var n=In.quadrant(e[t],e[t+1]),r=t+1;r<e.length;){var a=In.quadrant(e[r-1],e[r]);if(a!==n)break;r++}return r-1};au.prototype.interfaces_=function(){return[]};au.prototype.getClass=function(){return au};au.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var Ua=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new ye,this.env2=new ye;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new au;this.startIndex=t.getChainStartIndices(this.pts)};Ua.prototype.getCoordinates=function(){return this.pts};Ua.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t>n?t:n};Ua.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n};Ua.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],r)}else if(arguments.length===6){var a=arguments[0],c=arguments[1],f=arguments[2],u=arguments[3],b=arguments[4],C=arguments[5],A=this.pts[a],P=this.pts[c],k=f.pts[u],Y=f.pts[b];if(c-a===1&&b-u===1)return C.addIntersections(this.e,a,f.e,u),null;if(this.env1.init(A,P),this.env2.init(k,Y),!this.env1.intersects(this.env2))return null;var X=Math.trunc((a+c)/2),lt=Math.trunc((u+b)/2);a<X&&(u<lt&&this.computeIntersectsForChain(a,X,f,u,lt,C),lt<b&&this.computeIntersectsForChain(a,X,f,lt,b,C)),X<c&&(u<lt&&this.computeIntersectsForChain(X,c,f,u,lt,C),lt<b&&this.computeIntersectsForChain(X,c,f,lt,b,C))}};Ua.prototype.getStartIndexes=function(){return this.startIndex};Ua.prototype.computeIntersects=function(e,t){for(var n=this,r=0;r<this.startIndex.length-1;r++)for(var a=0;a<e.startIndex.length-1;a++)n.computeIntersectsForChain(r,e,a,t)};Ua.prototype.interfaces_=function(){return[]};Ua.prototype.getClass=function(){return Ua};var ni=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var r=0;r<3;r++)t._depth[n][r]=e.NULL_VALUE},m2={NULL_VALUE:{configurable:!0}};ni.prototype.getDepth=function(e,t){return this._depth[e][t]};ni.prototype.setDepth=function(e,t,n){this._depth[e][t]=n};ni.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(e._depth[t][n]!==ni.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var r=arguments[0];return this._depth[r][1]===ni.NULL_VALUE}else if(arguments.length===2){var a=arguments[0],c=arguments[1];return this._depth[a][c]===ni.NULL_VALUE}};ni.prototype.normalize=function(){for(var e=this,t=0;t<2;t++)if(!e.isNull(t)){var n=e._depth[t][1];e._depth[t][2]<n&&(n=e._depth[t][2]),n<0&&(n=0);for(var r=1;r<3;r++){var a=0;e._depth[t][r]>n&&(a=1),e._depth[t][r]=a}}};ni.prototype.getDelta=function(e){return this._depth[e][qt.RIGHT]-this._depth[e][qt.LEFT]};ni.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?St.EXTERIOR:St.INTERIOR};ni.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};ni.prototype.add=function(){var e=this;if(arguments.length===1)for(var t=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var a=t.getLocation(n,r);(a===St.EXTERIOR||a===St.INTERIOR)&&(e.isNull(n,r)?e._depth[n][r]=ni.depthAtLocation(a):e._depth[n][r]+=ni.depthAtLocation(a))}else if(arguments.length===3){var c=arguments[0],f=arguments[1],u=arguments[2];u===St.INTERIOR&&this._depth[c][f]++}};ni.prototype.interfaces_=function(){return[]};ni.prototype.getClass=function(){return ni};ni.depthAtLocation=function(e){return e===St.EXTERIOR?0:e===St.INTERIOR?1:ni.NULL_VALUE};m2.NULL_VALUE.get=function(){return-1};Object.defineProperties(ni,m2);var Gm=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new ca(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ni,this._depthDelta=0,arguments.length===1){var n=arguments[0];t.call(this,n,null)}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.pts=r,this._label=a}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var r=new t(n,bn.toLineLabel(this._label));return r},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(n){this._isIsolated=n},t.prototype.setName=function(n){this._name=n},t.prototype.equals=function(n){var r=this;if(!(n instanceof t))return!1;var a=n;if(this.pts.length!==a.pts.length)return!1;for(var c=!0,f=!0,u=this.pts.length,b=0;b<this.pts.length;b++)if(r.pts[b].equals2D(a.pts[b])||(c=!1),r.pts[b].equals2D(a.pts[--u])||(f=!1),!c&&!f)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},t.prototype.print=function(n){var r=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&n.print(","),n.print(r.pts[a].x+" "+r.pts[a].y);n.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(n){t.updateIM(this._label,n)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(n){var r=this;n.print("edge "+this._name+": ");for(var a=this.pts.length-1;a>=0;a--)n.print(r.pts[a]+" ");n.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new Ua(this)),this._mce},t.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new ye;for(var r=0;r<this.pts.length;r++)n._env.expandToInclude(n.pts[r])}return this._env},t.prototype.addIntersection=function(n,r,a,c){var f=new bt(n.getIntersection(c)),u=r,b=n.getEdgeDistance(a,c),C=u+1;if(C<this.pts.length){var A=this.pts[C];f.equals2D(A)&&(u=C,b=0)}this.eiList.add(f,u,b)},t.prototype.toString=function(){var n=this,r=new Gs;r.append("edge "+this._name+": "),r.append("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&r.append(","),r.append(n.pts[a].x+" "+n.pts[a].y);return r.append(")  "+this._label+" "+this._depthDelta),r.toString()},t.prototype.isPointwiseEqual=function(n){var r=this;if(this.pts.length!==n.pts.length)return!1;for(var a=0;a<this.pts.length;a++)if(!r.pts[a].equals2D(n.pts[a]))return!1;return!0},t.prototype.setDepthDelta=function(n){this._depthDelta=n},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(n,r,a){for(var c=this,f=0;f<n.getIntersectionNum();f++)c.addIntersection(n,r,a,f)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];r.setAtLeastIfValid(n.getLocation(0,qt.ON),n.getLocation(1,qt.ON),1),n.isArea()&&(r.setAtLeastIfValid(n.getLocation(0,qt.LEFT),n.getLocation(1,qt.LEFT),2),r.setAtLeastIfValid(n.getLocation(0,qt.RIGHT),n.getLocation(1,qt.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(Eo),Ii=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new os,this._bufParams=e||null};Ii.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};Ii.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(t!==null){var n=t.getLabel(),r=e.getLabel();t.isPointwiseEqual(e)||(r=new bn(e.getLabel()),r.flip()),n.merge(r);var a=Ii.depthDelta(r),c=t.getDepthDelta(),f=c+a;t.setDepthDelta(f)}else this._edgeList.add(e),e.setDepthDelta(Ii.depthDelta(e.getLabel()))};Ii.prototype.buildSubgraphs=function(e,t){for(var n=new Qt,r=e.iterator();r.hasNext();){var a=r.next(),c=a.getRightmostCoordinate(),f=new Ju(n),u=f.getDepth(c);a.computeDepth(u),a.findResultEdges(),n.add(a),t.add(a.getDirectedEdges(),a.getNodes())}};Ii.prototype.createSubgraphs=function(e){for(var t=new Qt,n=e.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var a=new Ci;a.create(r),t.add(a)}}return is.sort(t,is.reverseOrder()),t};Ii.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};Ii.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var t=new o0,n=new du;return n.setPrecisionModel(e),t.setSegmentIntersector(new To(n)),t};Ii.prototype.buffer=function(e,t){var n=this._workingPrecisionModel;n===null&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var r=new Bi(n,this._bufParams),a=new Vo(e,t,r),c=a.getCurves();if(c.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(c,n),this._graph=new Qn(new d2),this._graph.addEdges(this._edgeList.getEdges());var f=this.createSubgraphs(this._graph),u=new no(this._geomFact);this.buildSubgraphs(f,u);var b=u.getPolygons();if(b.size()<=0)return this.createEmptyResultGeometry();var C=this._geomFact.buildGeometry(b);return C};Ii.prototype.computeNodedEdges=function(e,t){var n=this,r=this.getNoder(t);r.computeNodes(e);for(var a=r.getNodedSubstrings(),c=a.iterator();c.hasNext();){var f=c.next(),u=f.getCoordinates();if(!(u.length===2&&u[0].equals2D(u[1]))){var b=f.getData(),C=new Gm(f.getCoordinates(),new bn(b));n.insertUniqueEdge(C)}}};Ii.prototype.setNoder=function(e){this._workingNoder=e};Ii.prototype.interfaces_=function(){return[]};Ii.prototype.getClass=function(){return Ii};Ii.depthDelta=function(e){var t=e.getLocation(0,qt.LEFT),n=e.getLocation(0,qt.RIGHT);return t===St.INTERIOR&&n===St.EXTERIOR?1:t===St.EXTERIOR&&n===St.INTERIOR?-1:0};Ii.convertSegStrings=function(e){for(var t=new $e,n=new Qt;e.hasNext();){var r=e.next(),a=t.createLineString(r.getCoordinates());n.add(a)}return t.buildGeometry(n)};var bl=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],r=arguments[1],a=arguments[2],c=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=a,this._offsetY=c,this._isScaled=!this.isIntegerPrecision()}};bl.prototype.rescale=function(){var e=this;if(Te(arguments[0],Sr))for(var t=arguments[0],n=t.iterator();n.hasNext();){var r=n.next();e.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var a=arguments[0],c=0;c<a.length;c++)a[c].x=a[c].x/e._scaleFactor+e._offsetX,a[c].y=a[c].y/e._scaleFactor+e._offsetY;a.length===2&&a[0].equals2D(a[1])&&ri.out.println(a)}};bl.prototype.scale=function(){var e=this;if(Te(arguments[0],Sr)){for(var t=arguments[0],n=new Qt,r=t.iterator();r.hasNext();){var a=r.next();n.add(new dr(e.scale(a.getCoordinates()),a.getData()))}return n}else if(arguments[0]instanceof Array){for(var c=arguments[0],f=new Array(c.length).fill(null),u=0;u<c.length;u++)f[u]=new bt(Math.round((c[u].x-e._offsetX)*e._scaleFactor),Math.round((c[u].y-e._offsetY)*e._scaleFactor),c[u].z);var b=Ke.removeRepeatedPoints(f);return b}};bl.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};bl.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};bl.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)};bl.prototype.interfaces_=function(){return[iu]};bl.prototype.getClass=function(){return bl};var Os=function(){this._li=new du,this._segStrings=null;var e=arguments[0];this._segStrings=e},g2={fact:{configurable:!0}};Os.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next(),r=n.getCoordinates();e.checkEndPtVertexIntersections(r[0],e._segStrings),e.checkEndPtVertexIntersections(r[r.length-1],e._segStrings)}else if(arguments.length===2){for(var a=arguments[0],c=arguments[1],f=c.iterator();f.hasNext();)for(var u=f.next(),b=u.getCoordinates(),C=1;C<b.length-1;C++)if(b[C].equals(a))throw new za("found endpt/interior pt intersection at index "+C+" :pt "+a)}};Os.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var n=t.next(),r=this._segStrings.iterator();r.hasNext();){var a=r.next();e.checkInteriorIntersections(n,a)}else if(arguments.length===2)for(var c=arguments[0],f=arguments[1],u=c.getCoordinates(),b=f.getCoordinates(),C=0;C<u.length-1;C++)for(var A=0;A<b.length-1;A++)e.checkInteriorIntersections(c,C,f,A);else if(arguments.length===4){var P=arguments[0],k=arguments[1],Y=arguments[2],X=arguments[3];if(P===Y&&k===X)return null;var lt=P.getCoordinates()[k],ht=P.getCoordinates()[k+1],_t=Y.getCoordinates()[X],j=Y.getCoordinates()[X+1];if(this._li.computeIntersection(lt,ht,_t,j),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,lt,ht)||this.hasInteriorIntersection(this._li,_t,j)))throw new za("found non-noded intersection at "+lt+"-"+ht+" and "+_t+"-"+j)}};Os.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};Os.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next();e.checkCollapses(n)}else if(arguments.length===1)for(var r=arguments[0],a=r.getCoordinates(),c=0;c<a.length-2;c++)e.checkCollapse(a[c],a[c+1],a[c+2])};Os.prototype.hasInteriorIntersection=function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++){var a=e.getIntersection(r);if(!(a.equals(t)||a.equals(n)))return!0}return!1};Os.prototype.checkCollapse=function(e,t,n){if(e.equals(n))throw new za("found non-noded collapse at "+Os.fact.createLineString([e,t,n]))};Os.prototype.interfaces_=function(){return[]};Os.prototype.getClass=function(){return Os};g2.fact.get=function(){return new $e};Object.defineProperties(Os,g2);var Vi=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new jn("Scale factor must be non-zero");t!==1&&(this._pt=new bt(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new bt,this._p1Scaled=new bt),this.initCorners(this._pt)},y2={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Vi.prototype.intersectsScaled=function(e,t){var n=Math.min(e.x,t.x),r=Math.max(e.x,t.x),a=Math.min(e.y,t.y),c=Math.max(e.y,t.y),f=this._maxx<n||this._minx>r||this._maxy<a||this._miny>c;if(f)return!1;var u=this.intersectsToleranceSquare(e,t);return Ue.isTrue(!(f&&u),"Found bad envelope test"),u};Vi.prototype.initCorners=function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new bt(this._maxx,this._maxy),this._corner[1]=new bt(this._minx,this._maxy),this._corner[2]=new bt(this._minx,this._miny),this._corner[3]=new bt(this._maxx,this._miny)};Vi.prototype.intersects=function(e,t){return this._scaleFactor===1?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};Vi.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};Vi.prototype.getCoordinate=function(){return this._originalPt};Vi.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)};Vi.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=Vi.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new ye(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};Vi.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))};Vi.prototype.intersectsToleranceSquare=function(e,t){var n=!1,r=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper())||n&&r||e.equals(this._pt)||t.equals(this._pt))};Vi.prototype.addSnappedNode=function(e,t){var n=e.getCoordinate(t),r=e.getCoordinate(t+1);return this.intersects(n,r)?(e.addIntersection(this.getCoordinate(),t),!0):!1};Vi.prototype.interfaces_=function(){return[]};Vi.prototype.getClass=function(){return Vi};y2.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(Vi,y2);var kf=function(){this.tempEnv1=new ye,this.selectedSegment=new _e};kf.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}};kf.prototype.interfaces_=function(){return[]};kf.prototype.getClass=function(){return kf};var Vh=function(){this._index=null;var e=arguments[0];this._index=e},_2={HotPixelSnapAction:{configurable:!0}};Vh.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2],a=t.getSafeEnvelope(),c=new v2(t,n,r);return this._index.query(a,{interfaces_:function(){return[_l]},visitItem:function(f){var u=f;u.select(a,c)}}),c.isNodeAdded()}};Vh.prototype.interfaces_=function(){return[]};Vh.prototype.getClass=function(){return Vh};_2.HotPixelSnapAction.get=function(){return v2};Object.defineProperties(Vh,_2);var v2=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],r=arguments[1],a=arguments[2];this._hotPixel=n,this._parentEdge=r,this._hotPixelVertexIndex=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1],a=n.getContext();if(this._parentEdge!==null&&a===this._parentEdge&&r===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(a,r)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(kf),Qu=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new Qt};Qu.prototype.processIntersections=function(e,t,n,r){var a=this;if(e===n&&t===r)return null;var c=e.getCoordinates()[t],f=e.getCoordinates()[t+1],u=n.getCoordinates()[r],b=n.getCoordinates()[r+1];if(this._li.computeIntersection(c,f,u,b),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var C=0;C<this._li.getIntersectionNum();C++)a._interiorIntersections.add(a._li.getIntersection(C));e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)}};Qu.prototype.isDone=function(){return!1};Qu.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Qu.prototype.interfaces_=function(){return[su]};Qu.prototype.getClass=function(){return Qu};var ha=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new du,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};ha.prototype.checkCorrectness=function(e){var t=dr.getNodedSubstrings(e),n=new Os(t);try{n.checkValid()}catch(r){if(r instanceof r2)r.printStackTrace();else throw r}finally{}};ha.prototype.getNodedSubstrings=function(){return dr.getNodedSubstrings(this._nodedSegStrings)};ha.prototype.snapRound=function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)};ha.prototype.findInteriorIntersections=function(e,t){var n=new Qu(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()};ha.prototype.computeVertexSnaps=function(){var e=this;if(Te(arguments[0],Sr))for(var t=arguments[0],n=t.iterator();n.hasNext();){var r=n.next();e.computeVertexSnaps(r)}else if(arguments[0]instanceof dr)for(var a=arguments[0],c=a.getCoordinates(),f=0;f<c.length;f++){var u=new Vi(c[f],e._scaleFactor,e._li),b=e._pointSnapper.snap(u,a,f);b&&a.addIntersection(c[f],f)}};ha.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new o0,this._pointSnapper=new Vh(this._noder.getIndex()),this.snapRound(e,this._li)};ha.prototype.computeIntersectionSnaps=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next(),a=new Vi(r,t._scaleFactor,t._li);t._pointSnapper.snap(a)}};ha.prototype.interfaces_=function(){return[iu]};ha.prototype.getClass=function(){return ha};var li=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new dn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}},$h={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};li.prototype.bufferFixedPrecision=function(e){var t=new bl(new ha(new _n(1)),e.getScale()),n=new Ii(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)};li.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var t=li.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(c){if(c instanceof Ba)e._saveException=c;else throw c}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],r=li.precisionScaleFactor(this._argGeom,this._distance,n),a=new _n(r);this.bufferFixedPrecision(a)}};li.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===_n.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};li.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};li.prototype.bufferOriginalPrecision=function(){try{var e=new Ii(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof za)this._saveException=t;else throw t}finally{}};li.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};li.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};li.prototype.interfaces_=function(){return[]};li.prototype.getClass=function(){return li};li.bufferOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new li(e),r=n.getResultGeometry(t);return r}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ee&&typeof arguments[1]=="number"){var a=arguments[0],c=arguments[1],f=arguments[2],u=new li(a);u.setQuadrantSegments(f);var b=u.getResultGeometry(c);return b}else if(arguments[2]instanceof dn&&arguments[0]instanceof Ee&&typeof arguments[1]=="number"){var C=arguments[0],A=arguments[1],P=arguments[2],k=new li(C,P),Y=k.getResultGeometry(A);return Y}}else if(arguments.length===4){var X=arguments[0],lt=arguments[1],ht=arguments[2],_t=arguments[3],j=new li(X);j.setQuadrantSegments(ht),j.setEndCapStyle(_t);var W=j.getResultGeometry(lt);return W}};li.precisionScaleFactor=function(e,t,n){var r=e.getEnvelopeInternal(),a=Io.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY())),c=t>0?t:0,f=a+2*c,u=Math.trunc(Math.log(f)/Math.log(10)+1),b=n-u,C=Math.pow(10,b);return C};$h.CAP_ROUND.get=function(){return dn.CAP_ROUND};$h.CAP_BUTT.get=function(){return dn.CAP_FLAT};$h.CAP_FLAT.get=function(){return dn.CAP_FLAT};$h.CAP_SQUARE.get=function(){return dn.CAP_SQUARE};$h.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(li,$h);var wi=function(){this._pt=[new bt,new bt],this._distance=Me.NaN,this._isNull=!0};wi.prototype.getCoordinates=function(){return this._pt};wi.prototype.getCoordinate=function(e){return this._pt[e]};wi.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r<this._distance&&this.initialize(t,n,r)}};wi.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=a,this._isNull=!1}};wi.prototype.getDistance=function(){return this._distance};wi.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r>this._distance&&this.initialize(t,n,r)}};wi.prototype.interfaces_=function(){return[]};wi.prototype.getClass=function(){return wi};var Qs=function(){};Qs.prototype.interfaces_=function(){return[]};Qs.prototype.getClass=function(){return Qs};Qs.computeDistance=function(){if(arguments[2]instanceof wi&&arguments[0]instanceof ir&&arguments[1]instanceof bt)for(var e=arguments[0],t=arguments[1],n=arguments[2],r=e.getCoordinates(),a=new _e,c=0;c<r.length-1;c++){a.setCoordinates(r[c],r[c+1]);var f=a.closestPoint(t);n.setMinimum(f,t)}else if(arguments[2]instanceof wi&&arguments[0]instanceof Cr&&arguments[1]instanceof bt){var u=arguments[0],b=arguments[1],C=arguments[2];Qs.computeDistance(u.getExteriorRing(),b,C);for(var A=0;A<u.getNumInteriorRing();A++)Qs.computeDistance(u.getInteriorRingN(A),b,C)}else if(arguments[2]instanceof wi&&arguments[0]instanceof Ee&&arguments[1]instanceof bt){var P=arguments[0],k=arguments[1],Y=arguments[2];if(P instanceof ir)Qs.computeDistance(P,k,Y);else if(P instanceof Cr)Qs.computeDistance(P,k,Y);else if(P instanceof Ei)for(var X=P,lt=0;lt<X.getNumGeometries();lt++){var ht=X.getGeometryN(lt);Qs.computeDistance(ht,k,Y)}else Y.setMinimum(P.getCoordinate(),k)}else if(arguments[2]instanceof wi&&arguments[0]instanceof _e&&arguments[1]instanceof bt){var _t=arguments[0],j=arguments[1],W=arguments[2],st=_t.closestPoint(j);W.setMinimum(st,j)}};var lu=function(e){this._maxPtDist=new wi,this._inputGeom=e||null},s0={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};lu.prototype.computeMaxMidpointDistance=function(e){var t=new wl(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};lu.prototype.computeMaxVertexDistance=function(e){var t=new $u(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};lu.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};lu.prototype.getDistancePoints=function(){return this._maxPtDist};lu.prototype.interfaces_=function(){return[]};lu.prototype.getClass=function(){return lu};s0.MaxPointDistanceFilter.get=function(){return $u};s0.MaxMidpointDistanceFilter.get=function(){return wl};Object.defineProperties(lu,s0);var $u=function(e){this._maxPtDist=new wi,this._minPtDist=new wi,this._geom=e||null};$u.prototype.filter=function(e){this._minPtDist.initialize(),Qs.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};$u.prototype.getMaxPointDistance=function(){return this._maxPtDist};$u.prototype.interfaces_=function(){return[sa]};$u.prototype.getClass=function(){return $u};var wl=function(e){this._maxPtDist=new wi,this._minPtDist=new wi,this._geom=e||null};wl.prototype.filter=function(e,t){if(t===0)return null;var n=e.getCoordinate(t-1),r=e.getCoordinate(t),a=new bt((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),Qs.computeDistance(this._geom,a,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};wl.prototype.isDone=function(){return!1};wl.prototype.isGeometryChanged=function(){return!1};wl.prototype.getMaxPointDistance=function(){return this._maxPtDist};wl.prototype.interfaces_=function(){return[ns]};wl.prototype.getClass=function(){return wl};var Na=function(e){this._comps=e||null};Na.prototype.filter=function(e){e instanceof Cr&&this._comps.add(e)};Na.prototype.interfaces_=function(){return[Ms]};Na.prototype.getClass=function(){return Na};Na.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return Na.getPolygons(e,new Qt)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof Cr?n.add(t):t instanceof Ei&&t.apply(new Na(n)),n}};var ti=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._lines=t,this._isForcedToLineString=n}};ti.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof aa){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof ir&&this._lines.add(e)};ti.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};ti.prototype.interfaces_=function(){return[Fa]};ti.prototype.getClass=function(){return ti};ti.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(ti.getLines(e))}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t.getFactory().buildGeometry(ti.getLines(t,n))}};ti.getLines=function(){if(arguments.length===1){var e=arguments[0];return ti.getLines(e,!1)}else if(arguments.length===2){if(Te(arguments[0],Sr)&&Te(arguments[1],Sr)){for(var t=arguments[0],n=arguments[1],r=t.iterator();r.hasNext();){var a=r.next();ti.getLines(a,n)}return n}else if(arguments[0]instanceof Ee&&typeof arguments[1]=="boolean"){var c=arguments[0],f=arguments[1],u=new Qt;return c.apply(new ti(u,f)),u}else if(arguments[0]instanceof Ee&&Te(arguments[1],Sr)){var b=arguments[0],C=arguments[1];return b instanceof ir?C.add(b):b.apply(new ti(C)),C}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&Te(arguments[0],Sr)&&Te(arguments[1],Sr)){for(var A=arguments[0],P=arguments[1],k=arguments[2],Y=A.iterator();Y.hasNext();){var X=Y.next();ti.getLines(X,P,k)}return P}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Ee&&Te(arguments[1],Sr)){var lt=arguments[0],ht=arguments[1],_t=arguments[2];return lt.apply(new ti(ht,_t)),ht}}};var ss=function(){if(this._boundaryRule=Fo.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e===null)throw new jn("Rule must be non-null");this._boundaryRule=e}};ss.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof bt&&arguments[1]instanceof Cr){var t=arguments[0],n=arguments[1];if(n.isEmpty())return St.EXTERIOR;var r=n.getExteriorRing(),a=this.locateInPolygonRing(t,r);if(a===St.EXTERIOR)return St.EXTERIOR;if(a===St.BOUNDARY)return St.BOUNDARY;for(var c=0;c<n.getNumInteriorRing();c++){var f=n.getInteriorRingN(c),u=e.locateInPolygonRing(t,f);if(u===St.INTERIOR)return St.EXTERIOR;if(u===St.BOUNDARY)return St.BOUNDARY}return St.INTERIOR}else if(arguments[0]instanceof bt&&arguments[1]instanceof ir){var b=arguments[0],C=arguments[1];if(!C.getEnvelopeInternal().intersects(b))return St.EXTERIOR;var A=C.getCoordinates();return!C.isClosed()&&(b.equals(A[0])||b.equals(A[A.length-1]))?St.BOUNDARY:oe.isOnLine(b,A)?St.INTERIOR:St.EXTERIOR}else if(arguments[0]instanceof bt&&arguments[1]instanceof eo){var P=arguments[0],k=arguments[1],Y=k.getCoordinate();return Y.equals2D(P)?St.INTERIOR:St.EXTERIOR}};ss.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?oe.locatePointInRing(e,t.getCoordinates()):St.EXTERIOR};ss.prototype.intersects=function(e,t){return this.locate(e,t)!==St.EXTERIOR};ss.prototype.updateLocationInfo=function(e){e===St.INTERIOR&&(this._isIn=!0),e===St.BOUNDARY&&this._numBoundaries++};ss.prototype.computeLocation=function(e,t){var n=this;if(t instanceof eo&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof ir)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Cr)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof ru)for(var r=t,a=0;a<r.getNumGeometries();a++){var c=r.getGeometryN(a);n.updateLocationInfo(n.locateInternal(e,c))}else if(t instanceof ra)for(var f=t,u=0;u<f.getNumGeometries();u++){var b=f.getGeometryN(u);n.updateLocationInfo(n.locateInternal(e,b))}else if(t instanceof Ei)for(var C=new ia(t);C.hasNext();){var A=C.next();A!==t&&n.computeLocation(e,A)}};ss.prototype.locate=function(e,t){return t.isEmpty()?St.EXTERIOR:t instanceof ir?this.locateInternal(e,t):t instanceof Cr?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?St.BOUNDARY:this._numBoundaries>0||this._isIn?St.INTERIOR:St.EXTERIOR)};ss.prototype.interfaces_=function(){return[]};ss.prototype.getClass=function(){return ss};var Si=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],n=arguments[1];e.call(this,t,e.INSIDE_AREA,n)}else if(arguments.length===3){var r=arguments[0],a=arguments[1],c=arguments[2];this._component=r,this._segIndex=a,this._pt=c}},x2={INSIDE_AREA:{configurable:!0}};Si.prototype.isInsideArea=function(){return this._segIndex===Si.INSIDE_AREA};Si.prototype.getCoordinate=function(){return this._pt};Si.prototype.getGeometryComponent=function(){return this._component};Si.prototype.getSegmentIndex=function(){return this._segIndex};Si.prototype.interfaces_=function(){return[]};Si.prototype.getClass=function(){return Si};x2.INSIDE_AREA.get=function(){return-1};Object.defineProperties(Si,x2);var ml=function(e){this._pts=e||null};ml.prototype.filter=function(e){e instanceof eo&&this._pts.add(e)};ml.prototype.interfaces_=function(){return[Ms]};ml.prototype.getClass=function(){return ml};ml.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof eo?is.singletonList(e):ml.getPoints(e,new Qt)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof eo?n.add(t):t instanceof Ei&&t.apply(new ml(n)),n}};var tc=function(){this._locations=null;var e=arguments[0];this._locations=e};tc.prototype.filter=function(e){(e instanceof eo||e instanceof ir||e instanceof Cr)&&this._locations.add(new Si(e,0,e.getCoordinate()))};tc.prototype.interfaces_=function(){return[Ms]};tc.prototype.getClass=function(){return tc};tc.getLocations=function(e){var t=new Qt;return e.apply(new tc(t)),t};var ii=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new ss,this._minDistanceLocation=null,this._minDistance=Me.MAX_VALUE,arguments.length===2){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=a}};ii.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=1-n,c=Na.getPolygons(this._geom[n]);if(c.size()>0){var f=tc.getLocations(this._geom[a]);if(this.computeContainmentDistance(f,c,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[a]=r[0],this._minDistanceLocation[n]=r[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&Te(arguments[0],ts)&&Te(arguments[1],ts)){for(var u=arguments[0],b=arguments[1],C=arguments[2],A=0;A<u.size();A++)for(var P=u.get(A),k=0;k<b.size();k++)if(e.computeContainmentDistance(P,b.get(k),C),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Si&&arguments[1]instanceof Cr){var Y=arguments[0],X=arguments[1],lt=arguments[2],ht=Y.getCoordinate();if(St.EXTERIOR!==this._ptLocator.locate(ht,X))return this._minDistance=0,lt[0]=Y,lt[1]=new Si(X,ht),null}}};ii.prototype.computeMinDistanceLinesPoints=function(e,t,n){for(var r=this,a=0;a<e.size();a++)for(var c=e.get(a),f=0;f<t.size();f++){var u=t.get(f);if(r.computeMinDistance(c,u,n),r._minDistance<=r._terminateDistance)return null}};ii.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=ti.getLines(this._geom[0]),n=ti.getLines(this._geom[1]),r=ml.getPoints(this._geom[0]),a=ml.getPoints(this._geom[1]);if(this.computeMinDistanceLines(t,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,a,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,r,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(r,a,e),this.updateMinDistance(e,!1)};ii.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};ii.prototype.updateMinDistance=function(e,t){if(e[0]===null)return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};ii.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};ii.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof ir&&arguments[1]instanceof eo){var t=arguments[0],n=arguments[1],r=arguments[2];if(t.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var a=t.getCoordinates(),c=n.getCoordinate(),f=0;f<a.length-1;f++){var u=oe.distancePointLine(c,a[f],a[f+1]);if(u<e._minDistance){e._minDistance=u;var b=new _e(a[f],a[f+1]),C=b.closestPoint(c);r[0]=new Si(t,f,C),r[1]=new Si(n,0,c)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof ir&&arguments[1]instanceof ir){var A=arguments[0],P=arguments[1],k=arguments[2];if(A.getEnvelopeInternal().distance(P.getEnvelopeInternal())>this._minDistance)return null;for(var Y=A.getCoordinates(),X=P.getCoordinates(),lt=0;lt<Y.length-1;lt++)for(var ht=0;ht<X.length-1;ht++){var _t=oe.distanceLineLine(Y[lt],Y[lt+1],X[ht],X[ht+1]);if(_t<e._minDistance){e._minDistance=_t;var j=new _e(Y[lt],Y[lt+1]),W=new _e(X[ht],X[ht+1]),st=j.closestPoints(W);k[0]=new Si(A,lt,st[0]),k[1]=new Si(P,ht,st[1])}if(e._minDistance<=e._terminateDistance)return null}}}};ii.prototype.computeMinDistancePoints=function(e,t,n){for(var r=this,a=0;a<e.size();a++)for(var c=e.get(a),f=0;f<t.size();f++){var u=t.get(f),b=c.getCoordinate().distance(u.getCoordinate());if(b<r._minDistance&&(r._minDistance=b,n[0]=new Si(c,0,c.getCoordinate()),n[1]=new Si(u,0,u.getCoordinate())),r._minDistance<=r._terminateDistance)return null}};ii.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new jn("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};ii.prototype.computeMinDistanceLines=function(e,t,n){for(var r=this,a=0;a<e.size();a++)for(var c=e.get(a),f=0;f<t.size();f++){var u=t.get(f);if(r.computeMinDistance(c,u,n),r._minDistance<=r._terminateDistance)return null}};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};ii.distance=function(e,t){var n=new ii(e,t);return n.distance()};ii.isWithinDistance=function(e,t,n){var r=new ii(e,t,n);return r.distance()<=n};ii.nearestPoints=function(e,t){var n=new ii(e,t);return n.nearestPoints()};var ui=function(){this._pt=[new bt,new bt],this._distance=Me.NaN,this._isNull=!0};ui.prototype.getCoordinates=function(){return this._pt};ui.prototype.getCoordinate=function(e){return this._pt[e]};ui.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r<this._distance&&this.initialize(t,n,r)}};ui.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=a,this._isNull=!1}};ui.prototype.toString=function(){return es.toLineString(this._pt[0],this._pt[1])};ui.prototype.getDistance=function(){return this._distance};ui.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r>this._distance&&this.initialize(t,n,r)}};ui.prototype.interfaces_=function(){return[]};ui.prototype.getClass=function(){return ui};var Ss=function(){};Ss.prototype.interfaces_=function(){return[]};Ss.prototype.getClass=function(){return Ss};Ss.computeDistance=function(){if(arguments[2]instanceof ui&&arguments[0]instanceof ir&&arguments[1]instanceof bt)for(var e=arguments[0],t=arguments[1],n=arguments[2],r=new _e,a=e.getCoordinates(),c=0;c<a.length-1;c++){r.setCoordinates(a[c],a[c+1]);var f=r.closestPoint(t);n.setMinimum(f,t)}else if(arguments[2]instanceof ui&&arguments[0]instanceof Cr&&arguments[1]instanceof bt){var u=arguments[0],b=arguments[1],C=arguments[2];Ss.computeDistance(u.getExteriorRing(),b,C);for(var A=0;A<u.getNumInteriorRing();A++)Ss.computeDistance(u.getInteriorRingN(A),b,C)}else if(arguments[2]instanceof ui&&arguments[0]instanceof Ee&&arguments[1]instanceof bt){var P=arguments[0],k=arguments[1],Y=arguments[2];if(P instanceof ir)Ss.computeDistance(P,k,Y);else if(P instanceof Cr)Ss.computeDistance(P,k,Y);else if(P instanceof Ei)for(var X=P,lt=0;lt<X.getNumGeometries();lt++){var ht=X.getGeometryN(lt);Ss.computeDistance(ht,k,Y)}else Y.setMinimum(P.getCoordinate(),k)}else if(arguments[2]instanceof ui&&arguments[0]instanceof _e&&arguments[1]instanceof bt){var _t=arguments[0],j=arguments[1],W=arguments[2],st=_t.closestPoint(j);W.setMinimum(st,j)}};var zo=function(){this._g0=null,this._g1=null,this._ptDist=new ui,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t},a0={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};zo.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};zo.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new jn("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};zo.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)};zo.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};zo.prototype.computeOrientedDistance=function(e,t,n){var r=new ec(t);if(e.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var a=new Sl(t,this._densifyFrac);e.apply(a),n.setMaximum(a.getMaxPointDistance())}};zo.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};zo.prototype.interfaces_=function(){return[]};zo.prototype.getClass=function(){return zo};zo.distance=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new zo(e,t);return n.distance()}else if(arguments.length===3){var r=arguments[0],a=arguments[1],c=arguments[2],f=new zo(r,a);return f.setDensifyFraction(c),f.distance()}};a0.MaxPointDistanceFilter.get=function(){return ec};a0.MaxDensifiedByFractionDistanceFilter.get=function(){return Sl};Object.defineProperties(zo,a0);var ec=function(){this._maxPtDist=new ui,this._minPtDist=new ui,this._euclideanDist=new Ss,this._geom=null;var e=arguments[0];this._geom=e};ec.prototype.filter=function(e){this._minPtDist.initialize(),Ss.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ec.prototype.getMaxPointDistance=function(){return this._maxPtDist};ec.prototype.interfaces_=function(){return[sa]};ec.prototype.getClass=function(){return ec};var Sl=function(){this._maxPtDist=new ui,this._minPtDist=new ui,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))};Sl.prototype.filter=function(e,t){var n=this;if(t===0)return null;for(var r=e.getCoordinate(t-1),a=e.getCoordinate(t),c=(a.x-r.x)/this._numSubSegs,f=(a.y-r.y)/this._numSubSegs,u=0;u<this._numSubSegs;u++){var b=r.x+u*c,C=r.y+u*f,A=new bt(b,C);n._minPtDist.initialize(),Ss.computeDistance(n._geom,A,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};Sl.prototype.isDone=function(){return!1};Sl.prototype.isGeometryChanged=function(){return!1};Sl.prototype.getMaxPointDistance=function(){return this._maxPtDist};Sl.prototype.interfaces_=function(){return[ns]};Sl.prototype.getClass=function(){return Sl};var $i=function(e,t,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=n||null},l0={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};$i.prototype.checkMaximumDistance=function(e,t,n){var r=new zo(t,e);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var a=r.getCoordinates();this._errorLocation=a[1],this._errorIndicator=e.getFactory().createLineString(a),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+es.toLineString(a[0],a[1])+")"}};$i.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=$i.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),$i.VERBOSE&&ri.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};$i.prototype.checkNegativeValid=function(){if(!(this._input instanceof Cr||this._input instanceof ra||this._input instanceof Ei))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};$i.prototype.getErrorIndicator=function(){return this._errorIndicator};$i.prototype.checkMinimumDistance=function(e,t,n){var r=new ii(e,t,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var a=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(a),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+es.toLineString(a[0],a[1])+" )"}};$i.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};$i.prototype.getErrorLocation=function(){return this._errorLocation};$i.prototype.getPolygonLines=function(e){for(var t=new Qt,n=new ti(t),r=Na.getPolygons(e),a=r.iterator();a.hasNext();){var c=a.next();c.apply(n)}return e.getFactory().buildGeometry(t)};$i.prototype.getErrorMessage=function(){return this._errMsg};$i.prototype.interfaces_=function(){return[]};$i.prototype.getClass=function(){return $i};l0.VERBOSE.get=function(){return!1};l0.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties($i,l0);var oi=function(e,t,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=n||null},u0={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};oi.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};oi.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*oi.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var t=new ye(this._input.getEnvelopeInternal());t.expandBy(this._distance);var n=new ye(this._result.getEnvelopeInternal());n.expandBy(e),n.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};oi.prototype.checkDistance=function(){var e=new $i(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};oi.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};oi.prototype.checkPolygonal=function(){this._result instanceof Cr||this._result instanceof ra||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};oi.prototype.getErrorIndicator=function(){return this._errorIndicator};oi.prototype.getErrorLocation=function(){return this._errorLocation};oi.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};oi.prototype.report=function(e){if(!oi.VERBOSE)return null;ri.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};oi.prototype.getErrorMessage=function(){return this._errorMsg};oi.prototype.interfaces_=function(){return[]};oi.prototype.getClass=function(){return oi};oi.isValidMsg=function(e,t,n){var r=new oi(e,t,n);return r.isValid()?null:r.getErrorMessage()};oi.isValid=function(e,t,n){var r=new oi(e,t,n);return!!r.isValid()};u0.VERBOSE.get=function(){return!1};u0.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(oi,u0);var zs=function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};zs.prototype.getCoordinates=function(){return this._pts};zs.prototype.size=function(){return this._pts.length};zs.prototype.getCoordinate=function(e){return this._pts[e]};zs.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};zs.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:Ku.octant(this.getCoordinate(e),this.getCoordinate(e+1))};zs.prototype.setData=function(e){this._data=e};zs.prototype.getData=function(){return this._data};zs.prototype.toString=function(){return es.toLineString(new hr(this._pts))};zs.prototype.interfaces_=function(){return[ua]};zs.prototype.getClass=function(){return zs};var Kr=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Qt,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};Kr.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Kr.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};Kr.prototype.getIntersectionSegments=function(){return this._intSegments};Kr.prototype.count=function(){return this._intersectionCount};Kr.prototype.getIntersections=function(){return this._intersections};Kr.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Kr.prototype.setKeepIntersections=function(e){this._keepIntersections=e};Kr.prototype.processIntersections=function(e,t,n,r){if(!this._findAllIntersections&&this.hasIntersection()||e===n&&t===r)return null;if(this._isCheckEndSegmentsOnly){var a=this.isEndSegment(e,t)||this.isEndSegment(n,r);if(!a)return null}var c=e.getCoordinates()[t],f=e.getCoordinates()[t+1],u=n.getCoordinates()[r],b=n.getCoordinates()[r+1];this._li.computeIntersection(c,f,u,b),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=c,this._intSegments[1]=f,this._intSegments[2]=u,this._intSegments[3]=b,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Kr.prototype.isEndSegment=function(e,t){return t===0||t>=e.size()-2};Kr.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Kr.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Kr.prototype.interfaces_=function(){return[su]};Kr.prototype.getClass=function(){return Kr};Kr.createAllIntersectionsFinder=function(e){var t=new Kr(e);return t.setFindAllIntersections(!0),t};Kr.createAnyIntersectionFinder=function(e){return new Kr(e)};Kr.createIntersectionCounter=function(e){var t=new Kr(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var as=function(){this._li=new du,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};as.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};as.prototype.getIntersections=function(){return this._segInt.getIntersections()};as.prototype.isValid=function(){return this.execute(),this._isValid};as.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};as.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Kr(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new o0;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};as.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Ba(this.getErrorMessage(),this._segInt.getInteriorIntersection())};as.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+es.toLineString(e[0],e[1])+" and "+es.toLineString(e[2],e[3])};as.prototype.interfaces_=function(){return[]};as.prototype.getClass=function(){return as};as.computeIntersections=function(e){var t=new as(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var uu=function e(){this._nv=null;var t=arguments[0];this._nv=new as(e.toSegmentStrings(t))};uu.prototype.checkValid=function(){this._nv.checkValid()};uu.prototype.interfaces_=function(){return[]};uu.prototype.getClass=function(){return uu};uu.toSegmentStrings=function(e){for(var t=new Qt,n=e.iterator();n.hasNext();){var r=n.next();t.add(new zs(r.getCoordinates(),r))}return t};uu.checkValid=function(e){var t=new uu(e);t.checkValid()};var nc=function(e){this._mapOp=e};nc.prototype.map=function(e){for(var t=this,n=new Qt,r=0;r<e.getNumGeometries();r++){var a=t._mapOp.map(e.getGeometryN(r));a.isEmpty()||n.add(a)}return e.getFactory().createGeometryCollection($e.toGeometryArray(n))};nc.prototype.interfaces_=function(){return[]};nc.prototype.getClass=function(){return nc};nc.map=function(e,t){var n=new nc(t);return n.map(e)};var Fs=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Qt,this._resultLineList=new Qt;var e=arguments[0],t=arguments[1],n=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=n};Fs.prototype.collectLines=function(e){for(var t=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next();t.collectLineEdge(r,e,t._lineEdgesList),t.collectBoundaryTouchEdge(r,e,t._lineEdgesList)}};Fs.prototype.labelIsolatedLine=function(e,t){var n=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,n)};Fs.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};Fs.prototype.collectLineEdge=function(e,t,n){var r=e.getLabel(),a=e.getEdge();e.isLineEdge()&&!e.isVisited()&&Ne.isResultOfOp(r,t)&&!a.isCovered()&&(n.add(a),e.setVisitedEdge(!0))};Fs.prototype.findCoveredLineEdges=function(){for(var e=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();n.getEdges().findCoveredLineEdges()}for(var r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var a=r.next(),c=a.getEdge();if(a.isLineEdge()&&!c.isCoveredSet()){var f=e._op.isCoveredByA(a.getCoordinate());c.setCovered(f)}}};Fs.prototype.labelIsolatedLines=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next(),a=r.getLabel();r.isIsolated()&&(a.isNull(0)?t.labelIsolatedLine(r,0):t.labelIsolatedLine(r,1))}};Fs.prototype.buildLines=function(e){for(var t=this,n=this._lineEdgesList.iterator();n.hasNext();){var r=n.next(),a=t._geometryFactory.createLineString(r.getCoordinates());t._resultLineList.add(a),r.setInResult(!0)}};Fs.prototype.collectBoundaryTouchEdge=function(e,t,n){var r=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;Ue.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),Ne.isResultOfOp(r,t)&&t===Ne.INTERSECTION&&(n.add(e.getEdge()),e.setVisitedEdge(!0))};Fs.prototype.interfaces_=function(){return[]};Fs.prototype.getClass=function(){return Fs};var rc=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Qt;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t};rc.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var n=this._geometryFactory.createPoint(t);this._resultPointList.add(n)}};rc.prototype.extractNonCoveredResultNodes=function(e){for(var t=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isInResult()&&!r.isIncidentEdgeInResult()&&(r.getEdges().getDegree()===0||e===Ne.INTERSECTION)){var a=r.getLabel();Ne.isResultOfOp(a,e)&&t.filterCoveredNodeToPoint(r)}}};rc.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};rc.prototype.interfaces_=function(){return[]};rc.prototype.getClass=function(){return rc};var Ui=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Ui.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};Ui.prototype.transformPolygon=function(e,t){var n=this,r=!0,a=this.transformLinearRing(e.getExteriorRing(),e);(a===null||!(a instanceof aa)||a.isEmpty())&&(r=!1);for(var c=new Qt,f=0;f<e.getNumInteriorRing();f++){var u=n.transformLinearRing(e.getInteriorRingN(f),e);u===null||u.isEmpty()||(u instanceof aa||(r=!1),c.add(u))}if(r)return this._factory.createPolygon(a,c.toArray([]));var b=new Qt;return a!==null&&b.add(a),b.addAll(c),this._factory.buildGeometry(b)};Ui.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};Ui.prototype.getInputGeometry=function(){return this._inputGeom};Ui.prototype.transformMultiLineString=function(e,t){for(var n=this,r=new Qt,a=0;a<e.getNumGeometries();a++){var c=n.transformLineString(e.getGeometryN(a),e);c!==null&&(c.isEmpty()||r.add(c))}return this._factory.buildGeometry(r)};Ui.prototype.transformCoordinates=function(e,t){return this.copy(e)};Ui.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};Ui.prototype.transformMultiPoint=function(e,t){for(var n=this,r=new Qt,a=0;a<e.getNumGeometries();a++){var c=n.transformPoint(e.getGeometryN(a),e);c!==null&&(c.isEmpty()||r.add(c))}return this._factory.buildGeometry(r)};Ui.prototype.transformMultiPolygon=function(e,t){for(var n=this,r=new Qt,a=0;a<e.getNumGeometries();a++){var c=n.transformPolygon(e.getGeometryN(a),e);c!==null&&(c.isEmpty()||r.add(c))}return this._factory.buildGeometry(r)};Ui.prototype.copy=function(e){return e.copy()};Ui.prototype.transformGeometryCollection=function(e,t){for(var n=this,r=new Qt,a=0;a<e.getNumGeometries();a++){var c=n.transform(e.getGeometryN(a));c!==null&&(n._pruneEmptyGeometry&&c.isEmpty()||r.add(c))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection($e.toGeometryArray(r)):this._factory.buildGeometry(r)};Ui.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof eo)return this.transformPoint(e,null);if(e instanceof Nh)return this.transformMultiPoint(e,null);if(e instanceof aa)return this.transformLinearRing(e,null);if(e instanceof ir)return this.transformLineString(e,null);if(e instanceof ru)return this.transformMultiLineString(e,null);if(e instanceof Cr)return this.transformPolygon(e,null);if(e instanceof ra)return this.transformMultiPolygon(e,null);if(e instanceof Ei)return this.transformGeometryCollection(e,null);throw new jn("Unknown Geometry subtype: "+e.getClass().getName())};Ui.prototype.transformLinearRing=function(e,t){var n=this.transformCoordinates(e.getCoordinateSequence(),e);if(n===null)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};Ui.prototype.interfaces_=function(){return[]};Ui.prototype.getClass=function(){return Ui};var pa=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new _e,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof ir&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];e.call(this,t.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],a=arguments[1];this._srcPts=r,this._isClosed=e.isClosed(r),this._snapTolerance=a}};pa.prototype.snapVertices=function(e,t){for(var n=this,r=this._isClosed?e.size()-1:e.size(),a=0;a<r;a++){var c=e.get(a),f=n.findSnapForVertex(c,t);f!==null&&(e.set(a,new bt(f)),a===0&&n._isClosed&&e.set(e.size()-1,new bt(f)))}};pa.prototype.findSnapForVertex=function(e,t){for(var n=this,r=0;r<t.length;r++){if(e.equals2D(t[r]))return null;if(e.distance(t[r])<n._snapTolerance)return t[r]}return null};pa.prototype.snapTo=function(e){var t=new qf(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);var n=t.toCoordinateArray();return n};pa.prototype.snapSegments=function(e,t){var n=this;if(t.length===0)return null;var r=t.length;t[0].equals2D(t[t.length-1])&&(r=t.length-1);for(var a=0;a<r;a++){var c=t[a],f=n.findSegmentIndexToSnap(c,e);f>=0&&e.add(f+1,new bt(c),!1)}};pa.prototype.findSegmentIndexToSnap=function(e,t){for(var n=this,r=Me.MAX_VALUE,a=-1,c=0;c<t.size()-1;c++){if(n._seg.p0=t.get(c),n._seg.p1=t.get(c+1),n._seg.p0.equals2D(e)||n._seg.p1.equals2D(e)){if(n._allowSnappingToSourceVertices)continue;return-1}var f=n._seg.distance(e);f<n._snapTolerance&&f<r&&(r=f,a=c)}return a};pa.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};pa.prototype.interfaces_=function(){return[]};pa.prototype.getClass=function(){return pa};pa.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var pr=function(e){this._srcGeom=e||null},b2={SNAP_PRECISION_FACTOR:{configurable:!0}};pr.prototype.snapTo=function(e,t){var n=this.extractTargetCoordinates(e),r=new w2(t,n);return r.transform(this._srcGeom)};pr.prototype.snapToSelf=function(e,t){var n=this.extractTargetCoordinates(this._srcGeom),r=new w2(e,n,!0),a=r.transform(this._srcGeom),c=a;return t&&Te(c,yl)&&(c=a.buffer(0)),c};pr.prototype.computeSnapTolerance=function(e){var t=this.computeMinimumSegmentLength(e),n=t/10;return n};pr.prototype.extractTargetCoordinates=function(e){for(var t=new As,n=e.getCoordinates(),r=0;r<n.length;r++)t.add(n[r]);return t.toArray(new Array(0).fill(null))};pr.prototype.computeMinimumSegmentLength=function(e){for(var t=Me.MAX_VALUE,n=0;n<e.length-1;n++){var r=e[n].distance(e[n+1]);r<t&&(t=r)}return t};pr.prototype.interfaces_=function(){return[]};pr.prototype.getClass=function(){return pr};pr.snap=function(e,t,n){var r=new Array(2).fill(null),a=new pr(e);r[0]=a.snapTo(t,n);var c=new pr(t);return r[1]=c.snapTo(r[0],n),r};pr.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],t=pr.computeSizeBasedSnapTolerance(e),n=e.getPrecisionModel();if(n.getType()===_n.FIXED){var r=1/n.getScale()*2/1.415;r>t&&(t=r)}return t}else if(arguments.length===2){var a=arguments[0],c=arguments[1];return Math.min(pr.computeOverlaySnapTolerance(a),pr.computeOverlaySnapTolerance(c))}};pr.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal(),n=Math.min(t.getHeight(),t.getWidth()),r=n*pr.SNAP_PRECISION_FACTOR;return r};pr.snapToSelf=function(e,t,n){var r=new pr(e);return r.snapToSelf(t,n)};b2.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(pr,b2);var w2=function(e){function t(n,r,a){e.call(this),this._snapTolerance=n||null,this._snapPts=r||null,this._isSelfSnap=a!==void 0?a:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(n,r){var a=new pa(n,this._snapTolerance);return a.setAllowSnappingToSourceVertices(this._isSelfSnap),a.snapTo(r)},t.prototype.transformCoordinates=function(n,r){var a=n.toCoordinateArray(),c=this.snapLine(a,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(c)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ui),vi=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};vi.prototype.getCommon=function(){return Me.longBitsToDouble(this._commonBits)};vi.prototype.add=function(e){var t=Me.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=vi.signExpBits(this._commonBits),this._isFirst=!1,null;var n=vi.signExpBits(t);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=vi.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=vi.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};vi.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],t=Me.longBitsToDouble(e),n=Me.toBinaryString(e),r="0000000000000000000000000000000000000000000000000000000000000000"+n,a=r.substring(r.length-64),c=a.substring(0,1)+"  "+a.substring(1,12)+"(exp) "+a.substring(12)+" [ "+t+" ]";return c}};vi.prototype.interfaces_=function(){return[]};vi.prototype.getClass=function(){return vi};vi.getBit=function(e,t){var n=1<<t;return e&n?1:0};vi.signExpBits=function(e){return e>>52};vi.zeroLowerBits=function(e,t){var n=(1<<t)-1,r=~n,a=e&r;return a};vi.numCommonMostSigMantissaBits=function(e,t){for(var n=0,r=52;r>=0;r--){if(vi.getBit(e,r)!==vi.getBit(t,r))return n;n++}return 52};var Il=function(){this._commonCoord=null,this._ccFilter=new ic},c0={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Il.prototype.addCommonBits=function(e){var t=new El(this._commonCoord);e.apply(t),e.geometryChanged()};Il.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var t=new bt(this._commonCoord);t.x=-t.x,t.y=-t.y;var n=new El(t);return e.apply(n),e.geometryChanged(),e};Il.prototype.getCommonCoordinate=function(){return this._commonCoord};Il.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Il.prototype.interfaces_=function(){return[]};Il.prototype.getClass=function(){return Il};c0.CommonCoordinateFilter.get=function(){return ic};c0.Translater.get=function(){return El};Object.defineProperties(Il,c0);var ic=function(){this._commonBitsX=new vi,this._commonBitsY=new vi};ic.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};ic.prototype.getCommonCoordinate=function(){return new bt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};ic.prototype.interfaces_=function(){return[sa]};ic.prototype.getClass=function(){return ic};var El=function(){this.trans=null;var e=arguments[0];this.trans=e};El.prototype.filter=function(e,t){var n=e.getOrdinate(t,0)+this.trans.x,r=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,n),e.setOrdinate(t,1,r)};El.prototype.isDone=function(){return!1};El.prototype.isGeometryChanged=function(){return!0};El.prototype.interfaces_=function(){return[ns]};El.prototype.getClass=function(){return El};var Jr=function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()};Jr.prototype.selfSnap=function(e){var t=new pr(e),n=t.snapTo(e,this._snapTolerance);return n};Jr.prototype.removeCommonBits=function(e){this._cbr=new Il,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t};Jr.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};Jr.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),n=Ne.overlayOp(t[0],t[1],e);return this.prepareResult(n)};Jr.prototype.checkValid=function(e){e.isValid()||ri.out.println("Snapped geometry is invalid")};Jr.prototype.computeSnapTolerance=function(){this._snapTolerance=pr.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};Jr.prototype.snap=function(e){var t=this.removeCommonBits(e),n=pr.snap(t[0],t[1],this._snapTolerance);return n};Jr.prototype.interfaces_=function(){return[]};Jr.prototype.getClass=function(){return Jr};Jr.overlayOp=function(e,t,n){var r=new Jr(e,t);return r.getResultGeometry(n)};Jr.union=function(e,t){return Jr.overlayOp(e,t,Ne.UNION)};Jr.intersection=function(e,t){return Jr.overlayOp(e,t,Ne.INTERSECTION)};Jr.symDifference=function(e,t){return Jr.overlayOp(e,t,Ne.SYMDIFFERENCE)};Jr.difference=function(e,t){return Jr.overlayOp(e,t,Ne.DIFFERENCE)};var Li=function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t};Li.prototype.getResultGeometry=function(e){var t=null,n=!1,r=null;try{t=Ne.overlayOp(this._geom[0],this._geom[1],e);var a=!0;a&&(n=!0)}catch(c){if(c instanceof za)r=c;else throw c}finally{}if(!n)try{t=Jr.overlayOp(this._geom[0],this._geom[1],e)}catch(c){throw c instanceof za?r:c}finally{}return t};Li.prototype.interfaces_=function(){return[]};Li.prototype.getClass=function(){return Li};Li.overlayOp=function(e,t,n){var r=new Li(e,t);return r.getResultGeometry(n)};Li.union=function(e,t){return Li.overlayOp(e,t,Ne.UNION)};Li.intersection=function(e,t){return Li.overlayOp(e,t,Ne.INTERSECTION)};Li.symDifference=function(e,t){return Li.overlayOp(e,t,Ne.SYMDIFFERENCE)};Li.difference=function(e,t){return Li.overlayOp(e,t,Ne.DIFFERENCE)};var Rf=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t};Rf.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)};Rf.prototype.interfaces_=function(){return[]};Rf.prototype.getClass=function(){return Rf};var io=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],n=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=n}else if(arguments.length===3){var r=arguments[0],a=arguments[1],c=arguments[2];this._eventType=e.INSERT,this._label=r,this._xValue=a,this._obj=c}},h0={INSERT:{configurable:!0},DELETE:{configurable:!0}};io.prototype.isDelete=function(){return this._eventType===io.DELETE};io.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};io.prototype.getObject=function(){return this._obj};io.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0};io.prototype.getInsertEvent=function(){return this._insertEvent};io.prototype.isInsert=function(){return this._eventType===io.INSERT};io.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};io.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};io.prototype.interfaces_=function(){return[Uo]};io.prototype.getClass=function(){return io};h0.INSERT.get=function(){return 1};h0.DELETE.get=function(){return 2};Object.defineProperties(io,h0);var qm=function(){};qm.prototype.interfaces_=function(){return[]};qm.prototype.getClass=function(){return qm};var si=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=n};si.prototype.isTrivialIntersection=function(e,t,n,r){if(e===n&&this._li.getIntersectionNum()===1){if(si.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var a=e.getNumPoints()-1;if(t===0&&r===a||r===0&&t===a)return!0}}return!1};si.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};si.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};si.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};si.prototype.isBoundaryPointInternal=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next(),a=r.getCoordinate();if(e.isIntersection(a))return!0}return!1};si.prototype.hasProperIntersection=function(){return this._hasProper};si.prototype.hasIntersection=function(){return this._hasIntersection};si.prototype.isDone=function(){return this._isDone};si.prototype.isBoundaryPoint=function(e,t){return t===null?!1:!!(this.isBoundaryPointInternal(e,t[0])||this.isBoundaryPointInternal(e,t[1]))};si.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t};si.prototype.addIntersections=function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var a=e.getCoordinates()[t],c=e.getCoordinates()[t+1],f=n.getCoordinates()[r],u=n.getCoordinates()[r+1];this._li.computeIntersection(a,c,f,u),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};si.prototype.interfaces_=function(){return[]};si.prototype.getClass=function(){return si};si.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var SM=function(e){function t(){e.call(this),this.events=new Qt,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var n=this;is.sort(this.events);for(var r=0;r<this.events.size();r++){var a=n.events.get(r);a.isDelete()&&a.getInsertEvent().setDeleteEventIndex(r)}},t.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var r=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var a=0;a<this.events.size();a++){var c=n.events.get(a);if(c.isInsert()&&n.processOverlaps(a,c.getDeleteEventIndex(),c,r),r.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof si&&Te(arguments[0],ts)&&Te(arguments[1],ts)){var f=arguments[0],u=arguments[1],b=arguments[2];this.addEdges(f,f),this.addEdges(u,u),this.computeIntersections(b)}else if(typeof arguments[2]=="boolean"&&Te(arguments[0],ts)&&arguments[1]instanceof si){var C=arguments[0],A=arguments[1],P=arguments[2];P?this.addEdges(C,null):this.addEdges(C),this.computeIntersections(A)}}},t.prototype.addEdge=function(n,r){for(var a=this,c=n.getMonotoneChainEdge(),f=c.getStartIndexes(),u=0;u<f.length-1;u++){var b=new Rf(c,u),C=new io(r,c.getMinX(u),b);a.events.add(C),a.events.add(new io(c.getMaxX(u),C))}},t.prototype.processOverlaps=function(n,r,a,c){for(var f=this,u=a.getObject(),b=n;b<r;b++){var C=f.events.get(b);if(C.isInsert()){var A=C.getObject();a.isSameLabel(C)||(u.computeIntersections(A,c),f.nOverlaps++)}}},t.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var r=arguments[0],a=r.iterator();a.hasNext();){var c=a.next();n.addEdge(c,c)}else if(arguments.length===2)for(var f=arguments[0],u=arguments[1],b=f.iterator();b.hasNext();){var C=b.next();n.addEdge(C,u)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(qm),fa=function(){this._min=Me.POSITIVE_INFINITY,this._max=Me.NEGATIVE_INFINITY},S2={NodeComparator:{configurable:!0}};fa.prototype.getMin=function(){return this._min};fa.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)};fa.prototype.getMax=function(){return this._max};fa.prototype.toString=function(){return es.toLineString(new bt(this._min,0),new bt(this._max,0))};fa.prototype.interfaces_=function(){return[]};fa.prototype.getClass=function(){return fa};S2.NodeComparator.get=function(){return Nf};Object.defineProperties(fa,S2);var Nf=function(){};Nf.prototype.compare=function(e,t){var n=e,r=t,a=(n._min+n._max)/2,c=(r._min+r._max)/2;return a<c?-1:a>c?1:0};Nf.prototype.interfaces_=function(){return[Lh]};Nf.prototype.getClass=function(){return Nf};var IM=function(e){function t(){e.call(this),this._item=null;var n=arguments[0],r=arguments[1],a=arguments[2];this._min=n,this._max=r,this._item=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(n,r,a){if(!this.intersects(n,r))return null;a.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fa),EM=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var n=arguments[0],r=arguments[1];this._node1=n,this._node2=r,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(n,r){this._min=Math.min(n._min,r._min),this._max=Math.max(n._max,r._max)},t.prototype.query=function(n,r,a){if(!this.intersects(n,r))return null;this._node1!==null&&this._node1.query(n,r,a),this._node2!==null&&this._node2.query(n,r,a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fa),da=function(){this._leaves=new Qt,this._root=null,this._level=0};da.prototype.buildTree=function(){var e=this;is.sort(this._leaves,new fa.NodeComparator);for(var t=this._leaves,n=null,r=new Qt;;){if(e.buildLevel(t,r),r.size()===1)return r.get(0);n=t,t=r,r=n}};da.prototype.insert=function(e,t,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new IM(e,t,n))};da.prototype.query=function(e,t,n){this.init(),this._root.query(e,t,n)};da.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};da.prototype.printNode=function(e){ri.out.println(es.toLineString(new bt(e._min,this._level),new bt(e._max,this._level)))};da.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};da.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var n=0;n<e.size();n+=2){var r=e.get(n),a=n+1<e.size()?e.get(n):null;if(a===null)t.add(r);else{var c=new EM(e.get(n),e.get(n+1));t.add(c)}}};da.prototype.interfaces_=function(){return[]};da.prototype.getClass=function(){return da};var Uh=function(){this._items=new Qt};Uh.prototype.visitItem=function(e){this._items.add(e)};Uh.prototype.getItems=function(){return this._items};Uh.prototype.interfaces_=function(){return[_l]};Uh.prototype.getClass=function(){return Uh};var Gh=function(){this._index=null;var e=arguments[0];if(!Te(e,yl))throw new jn("Argument must be Polygonal");this._index=new cu(e)},p0={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Gh.prototype.locate=function(e){var t=new Ts(e),n=new qh(t);return this._index.query(e.y,e.y,n),t.getLocation()};Gh.prototype.interfaces_=function(){return[Bh]};Gh.prototype.getClass=function(){return Gh};p0.SegmentVisitor.get=function(){return qh};p0.IntervalIndexedGeometry.get=function(){return cu};Object.defineProperties(Gh,p0);var qh=function(){this._counter=null;var e=arguments[0];this._counter=e};qh.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))};qh.prototype.interfaces_=function(){return[_l]};qh.prototype.getClass=function(){return qh};var cu=function(){this._index=new da;var e=arguments[0];this.init(e)};cu.prototype.init=function(e){for(var t=this,n=ti.getLines(e),r=n.iterator();r.hasNext();){var a=r.next(),c=a.getCoordinates();t.addLine(c)}};cu.prototype.addLine=function(e){for(var t=this,n=1;n<e.length;n++){var r=new _e(e[n-1],e[n]),a=Math.min(r.p0.y,r.p1.y),c=Math.max(r.p0.y,r.p1.y);t._index.insert(a,c,r)}};cu.prototype.query=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Uh;return this._index.query(e,t,n),n.getItems()}else if(arguments.length===3){var r=arguments[0],a=arguments[1],c=arguments[2];this._index.query(r,a,c)}};cu.prototype.interfaces_=function(){return[]};cu.prototype.getClass=function(){return cu};var sf=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new a2,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new ss,arguments.length===2){var n=arguments[0],r=arguments[1],a=Fo.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=r,this._boundaryNodeRule=a,r!==null&&this.add(r)}else if(arguments.length===3){var c=arguments[0],f=arguments[1],u=arguments[2];this._argIndex=c,this._parentGeom=f,this._boundaryNodeRule=u,f!==null&&this.add(f)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(n,r){var a=this._nodes.addNode(r),c=a.getLabel(),f=1,u=St.NONE;u=c.getLocation(n,qt.ON),u===St.BOUNDARY&&f++;var b=t.determineBoundary(this._boundaryNodeRule,f);c.setLocation(n,b)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.computeSelfNodes(n,r,!1)}else if(arguments.length===3){var a=arguments[0],c=arguments[1],f=arguments[2],u=new si(a,!0,!1);u.setIsDoneIfProperInt(f);var b=this.createEdgeSetIntersector(),C=this._parentGeom instanceof aa||this._parentGeom instanceof Cr||this._parentGeom instanceof ra,A=c||!C;return b.computeIntersections(this._edges,u,A),this.addSelfIntersectionNodes(this._argIndex),u}},t.prototype.computeSplitEdges=function(n){for(var r=this._edges.iterator();r.hasNext();){var a=r.next();a.eiList.addSplitEdges(n)}},t.prototype.computeEdgeIntersections=function(n,r,a){var c=new si(r,a,!0);c.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var f=this.createEdgeSetIntersector();return f.computeIntersections(this._edges,n._edges,c),c},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof eo){var n=arguments[0],r=n.getCoordinate();this.insertPoint(this._argIndex,r,St.INTERIOR)}else if(arguments[0]instanceof bt){var a=arguments[0];this.insertPoint(this._argIndex,a,St.INTERIOR)}},t.prototype.addPolygon=function(n){var r=this;this.addPolygonRing(n.getExteriorRing(),St.EXTERIOR,St.INTERIOR);for(var a=0;a<n.getNumInteriorRing();a++){var c=n.getInteriorRingN(a);r.addPolygonRing(c,St.INTERIOR,St.EXTERIOR)}},t.prototype.addEdge=function(n){this.insertEdge(n);var r=n.getCoordinates();this.insertPoint(this._argIndex,r[0],St.BOUNDARY),this.insertPoint(this._argIndex,r[r.length-1],St.BOUNDARY)},t.prototype.addLineString=function(n){var r=Ke.removeRepeatedPoints(n.getCoordinates());if(r.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var a=new Gm(r,new bn(this._argIndex,St.INTERIOR));this._lineEdgeMap.put(n,a),this.insertEdge(a),Ue.isTrue(r.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,r[0]),this.insertBoundaryPoint(this._argIndex,r[r.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),r=new Array(n.size()).fill(null),a=0,c=n.iterator();c.hasNext();){var f=c.next();r[a++]=f.getCoordinate().copy()}return r},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(n,r,a){if(this.isBoundaryNode(n,r))return null;a===St.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,r):this.insertPoint(n,r,a)},t.prototype.addPolygonRing=function(n,r,a){if(n.isEmpty())return null;var c=Ke.removeRepeatedPoints(n.getCoordinates());if(c.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=c[0],null;var f=r,u=a;oe.isCCW(c)&&(f=a,u=r);var b=new Gm(c,new bn(this._argIndex,St.BOUNDARY,f,u));this._lineEdgeMap.put(n,b),this.insertEdge(b),this.insertPoint(this._argIndex,c[0],St.BOUNDARY)},t.prototype.insertPoint=function(n,r,a){var c=this._nodes.addNode(r),f=c.getLabel();f===null?c._label=new bn(n,a):f.setLocation(n,a)},t.prototype.createEdgeSetIntersector=function(){return new SM},t.prototype.addSelfIntersectionNodes=function(n){for(var r=this,a=this._edges.iterator();a.hasNext();)for(var c=a.next(),f=c.getLabel().getLocation(n),u=c.eiList.iterator();u.hasNext();){var b=u.next();r.addSelfIntersectionNode(n,b.coord,f)}},t.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof ra&&(this._useBoundaryDeterminationRule=!1),n instanceof Cr)this.addPolygon(n);else if(n instanceof ir)this.addLineString(n);else if(n instanceof eo)this.addPoint(n);else if(n instanceof Nh)this.addCollection(n);else if(n instanceof ru)this.addCollection(n);else if(n instanceof ra)this.addCollection(n);else if(n instanceof Ei)this.addCollection(n);else throw new Error(n.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(n){for(var r=this,a=0;a<n.getNumGeometries();a++){var c=n.getGeometryN(a);r.add(c)}},t.prototype.locate=function(n){return Te(this._parentGeom,yl)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Gh(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(n,r){return n.isInBoundary(r)?St.BOUNDARY:St.INTERIOR},t}(Qn),jh=function(){if(this._li=new du,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new sf(0,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],r=Fo.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new sf(0,t,r),this._arg[1]=new sf(1,n,r)}else if(arguments.length===3){var a=arguments[0],c=arguments[1],f=arguments[2];a.getPrecisionModel().compareTo(c.getPrecisionModel())>=0?this.setComputationPrecision(a.getPrecisionModel()):this.setComputationPrecision(c.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new sf(0,a,f),this._arg[1]=new sf(1,c,f)}};jh.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};jh.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};jh.prototype.interfaces_=function(){return[]};jh.prototype.getClass=function(){return jh};var eu=function(){};eu.prototype.interfaces_=function(){return[]};eu.prototype.getClass=function(){return eu};eu.map=function(){if(arguments[0]instanceof Ee&&Te(arguments[1],eu.MapOp)){for(var e=arguments[0],t=arguments[1],n=new Qt,r=0;r<e.getNumGeometries();r++){var a=t.map(e.getGeometryN(r));a!==null&&n.add(a)}return e.getFactory().buildGeometry(n)}else if(Te(arguments[0],Sr)&&Te(arguments[1],eu.MapOp)){for(var c=arguments[0],f=arguments[1],u=new Qt,b=c.iterator();b.hasNext();){var C=b.next(),A=f.map(C);A!==null&&u.add(A)}return u}};eu.MapOp=function(){};var Ne=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r),this._ptLocator=new ss,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new os,this._resultPolyList=new Qt,this._resultLineList=new Qt,this._resultPointList=new Qt,this._graph=new Qn(new d2),this._geomFact=n.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(n){var r=this._edgeList.findEqualEdge(n);if(r!==null){var a=r.getLabel(),c=n.getLabel();r.isPointwiseEqual(n)||(c=new bn(n.getLabel()),c.flip());var f=r.getDepth();f.isNull()&&f.add(a),f.add(c),a.merge(c)}else this._edgeList.add(n)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),a=r.getSym();r.isInResult()&&a.isInResult()&&(r.setInResult(!1),a.setInResult(!1))}},t.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},t.prototype.computeGeometry=function(n,r,a,c){var f=new Qt;return f.addAll(n),f.addAll(r),f.addAll(a),f.isEmpty()?t.createEmptyResult(c,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(f)},t.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next();r.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(n,r){for(var a=this,c=r.iterator();c.hasNext();){var f=c.next(),u=a._ptLocator.locate(n,f);if(u!==St.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var n=new Qt,r=this._edgeList.iterator();r.hasNext();){var a=r.next();a.isCollapsed()&&(r.remove(),n.add(a.getCollapsedEdge()))}this._edgeList.addAll(n)},t.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next(),a=r.getEdges().getLabel();r.getLabel().merge(a)}},t.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},t.prototype.insertUniqueEdges=function(n){for(var r=this,a=n.iterator();a.hasNext();){var c=a.next();r.insertUniqueEdge(c)}},t.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var r=new Qt;this._arg[0].computeSplitEdges(r),this._arg[1].computeSplitEdges(r),this.insertUniqueEdges(r),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),uu.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var a=new no(this._geomFact);a.add(this._graph),this._resultPolyList=a.getPolygons();var c=new Fs(this,this._geomFact,this._ptLocator);this._resultLineList=c.build(n);var f=new rc(this,this._geomFact,this._ptLocator);this._resultPointList=f.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},t.prototype.labelIncompleteNode=function(n,r){var a=this._ptLocator.locate(n.getCoordinate(),this._arg[r].getGeometry());n.getLabel().setLocation(r,a)},t.prototype.copyPoints=function(n){for(var r=this,a=this._arg[n].getNodeIterator();a.hasNext();){var c=a.next(),f=r._graph.addNode(c.getCoordinate());f.setLabel(n,c.getLabel().getLocation(n))}},t.prototype.findResultAreaEdges=function(n){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var a=r.next(),c=a.getLabel();c.isArea()&&!a.isInteriorAreaEdge()&&t.isResultOfOp(c.getLocation(0,qt.RIGHT),c.getLocation(1,qt.RIGHT),n)&&a.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var r=n.next(),a=r.getLabel(),c=r.getDepth();if(!c.isNull()){c.normalize();for(var f=0;f<2;f++)!a.isNull(f)&&a.isArea()&&!c.isNull(f)&&(c.getDelta(f)===0?a.toLine(f):(Ue.isTrue(!c.isNull(f,qt.LEFT),"depth of LEFT side has not been initialized"),a.setLocation(f,qt.LEFT,c.getLocation(f,qt.LEFT)),Ue.isTrue(!c.isNull(f,qt.RIGHT),"depth of RIGHT side has not been initialized"),a.setLocation(f,qt.RIGHT,c.getLocation(f,qt.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var a=r.next();a.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var a=r.next(),c=a.getLabel();a.isIsolated()&&(c.isNull(0)?n.labelIncompleteNode(a,0):n.labelIncompleteNode(a,1)),a.getEdges().updateLabelling(c)}},t.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(jh);Ne.overlayOp=function(e,t,n){var r=new Ne(e,t),a=r.getResultGeometry(n);return a};Ne.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return Ne.createEmptyResult(Ne.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var n=t;return nc.map(e,{interfaces_:function(){return[eu.MapOp]},map:function(r){return r.intersection(n)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Li.overlayOp(e,t,Ne.INTERSECTION)};Ne.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return Ne.createEmptyResult(Ne.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Li.overlayOp(e,t,Ne.SYMDIFFERENCE)};Ne.resultDimension=function(e,t,n){var r=t.getDimension(),a=n.getDimension(),c=-1;switch(e){case Ne.INTERSECTION:c=Math.min(r,a);break;case Ne.UNION:c=Math.max(r,a);break;case Ne.DIFFERENCE:c=r;break;case Ne.SYMDIFFERENCE:c=Math.max(r,a);break}return c};Ne.createEmptyResult=function(e,t,n,r){var a=null;switch(Ne.resultDimension(e,t,n)){case-1:a=r.createGeometryCollection(new Array(0).fill(null));break;case 0:a=r.createPoint();break;case 1:a=r.createLineString();break;case 2:a=r.createPolygon();break}return a};Ne.difference=function(e,t){return e.isEmpty()?Ne.createEmptyResult(Ne.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Li.overlayOp(e,t,Ne.DIFFERENCE))};Ne.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=e.getLocation(0),r=e.getLocation(1);return Ne.isResultOfOp(n,r,t)}else if(arguments.length===3){var a=arguments[0],c=arguments[1],f=arguments[2];switch(a===St.BOUNDARY&&(a=St.INTERIOR),c===St.BOUNDARY&&(c=St.INTERIOR),f){case Ne.INTERSECTION:return a===St.INTERIOR&&c===St.INTERIOR;case Ne.UNION:return a===St.INTERIOR||c===St.INTERIOR;case Ne.DIFFERENCE:return a===St.INTERIOR&&c!==St.INTERIOR;case Ne.SYMDIFFERENCE:return a===St.INTERIOR&&c!==St.INTERIOR||a!==St.INTERIOR&&c===St.INTERIOR}return!1}};Ne.INTERSECTION=1;Ne.UNION=2;Ne.DIFFERENCE=3;Ne.SYMDIFFERENCE=4;var gl=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new ss,this._seg=new _e;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)};gl.prototype.isWithinToleranceOfBoundary=function(e){for(var t=this,n=0;n<this._linework.getNumGeometries();n++)for(var r=t._linework.getGeometryN(n),a=r.getCoordinateSequence(),c=0;c<a.size()-1;c++){a.getCoordinate(c,t._seg.p0),a.getCoordinate(c+1,t._seg.p1);var f=t._seg.distance(e);if(f<=t._boundaryDistanceTolerance)return!0}return!1};gl.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?St.BOUNDARY:this._ptLocator.locate(e,this._g)};gl.prototype.extractLinework=function(e){var t=new Wh;e.apply(t);var n=t.getLinework(),r=$e.toLineStringArray(n);return e.getFactory().createMultiLineString(r)};gl.prototype.interfaces_=function(){return[]};gl.prototype.getClass=function(){return gl};var Wh=function(){this._linework=null,this._linework=new Qt};Wh.prototype.getLinework=function(){return this._linework};Wh.prototype.filter=function(e){var t=this;if(e instanceof Cr){var n=e;this._linework.add(n.getExteriorRing());for(var r=0;r<n.getNumInteriorRing();r++)t._linework.add(n.getInteriorRingN(r))}};Wh.prototype.interfaces_=function(){return[Ms]};Wh.prototype.getClass=function(){return Wh};var hu=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};hu.prototype.extractPoints=function(e,t,n){for(var r=this,a=e.getCoordinates(),c=0;c<a.length-1;c++)r.computeOffsetPoints(a[c],a[c+1],t,n)};hu.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t};hu.prototype.getPoints=function(e){for(var t=this,n=new Qt,r=ti.getLines(this._g),a=r.iterator();a.hasNext();){var c=a.next();t.extractPoints(c,e,n)}return n};hu.prototype.computeOffsetPoints=function(e,t,n,r){var a=t.x-e.x,c=t.y-e.y,f=Math.sqrt(a*a+c*c),u=n*a/f,b=n*c/f,C=(t.x+e.x)/2,A=(t.y+e.y)/2;if(this._doLeft){var P=new bt(C-b,A+u);r.add(P)}if(this._doRight){var k=new bt(C+b,A-u);r.add(k)}};hu.prototype.interfaces_=function(){return[]};hu.prototype.getClass=function(){return hu};var Lo=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new Qt;var t=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,n),this._geom=[t,n,r],this._locFinder=[new gl(this._geom[0],this._boundaryDistanceTolerance),new gl(this._geom[1],this._boundaryDistanceTolerance),new gl(this._geom[2],this._boundaryDistanceTolerance)]},I2={TOLERANCE:{configurable:!0}};Lo.prototype.reportResult=function(e,t,n){ri.out.println("Overlay result invalid - A:"+St.toLocationSymbol(t[0])+" B:"+St.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+St.toLocationSymbol(t[2]))};Lo.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t};Lo.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=0;n<this._testCoords.size();n++){var r=e._testCoords.get(n);if(!e.checkValid(t,r))return e._invalidLocation=r,!1}return!0}else if(arguments.length===2){var a=arguments[0],c=arguments[1];return this._location[0]=this._locFinder[0].getLocation(c),this._location[1]=this._locFinder[1].getLocation(c),this._location[2]=this._locFinder[2].getLocation(c),Lo.hasLocation(this._location,St.BOUNDARY)?!0:this.isValidResult(a,this._location)}};Lo.prototype.addTestPts=function(e){var t=new hu(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))};Lo.prototype.isValidResult=function(e,t){var n=Ne.isResultOfOp(t[0],t[1],e),r=t[2]===St.INTERIOR,a=!(n^r);return a||this.reportResult(e,t,n),a};Lo.prototype.getInvalidLocation=function(){return this._invalidLocation};Lo.prototype.interfaces_=function(){return[]};Lo.prototype.getClass=function(){return Lo};Lo.hasLocation=function(e,t){for(var n=0;n<3;n++)if(e[n]===t)return!0;return!1};Lo.computeBoundaryDistanceTolerance=function(e,t){return Math.min(pr.computeSizeBasedSnapTolerance(e),pr.computeSizeBasedSnapTolerance(t))};Lo.isValid=function(e,t,n,r){var a=new Lo(e,t,r);return a.isValid(n)};I2.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Lo,I2);var yo=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};yo.prototype.extractElements=function(e,t){var n=this;if(e===null)return null;for(var r=0;r<e.getNumGeometries();r++){var a=e.getGeometryN(r);n._skipEmpty&&a.isEmpty()||t.add(a)}};yo.prototype.combine=function(){for(var e=this,t=new Qt,n=this._inputGeoms.iterator();n.hasNext();){var r=n.next();e.extractElements(r,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)};yo.prototype.interfaces_=function(){return[]};yo.prototype.getClass=function(){return yo};yo.combine=function(){if(arguments.length===1){var e=arguments[0],t=new yo(e);return t.combine()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=new yo(yo.createList(n,r));return a.combine()}else if(arguments.length===3){var c=arguments[0],f=arguments[1],u=arguments[2],b=new yo(yo.createList(c,f,u));return b.combine()}};yo.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};yo.createList=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Qt;return n.add(e),n.add(t),n}else if(arguments.length===3){var r=arguments[0],a=arguments[1],c=arguments[2],f=new Qt;return f.add(r),f.add(a),f.add(c),f}};var _r=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new Qt)},E2={STRTREE_NODE_CAPACITY:{configurable:!0}};_r.prototype.reduceToGeometries=function(e){for(var t=this,n=new Qt,r=e.iterator();r.hasNext();){var a=r.next(),c=null;Te(a,ts)?c=t.unionTree(a):a instanceof Ee&&(c=a),n.add(c)}return n};_r.prototype.extractByEnvelope=function(e,t,n){for(var r=new Qt,a=0;a<t.getNumGeometries();a++){var c=t.getGeometryN(a);c.getEnvelopeInternal().intersects(e)?r.add(c):n.add(c)}return this._geomFactory.buildGeometry(r)};_r.prototype.unionOptimized=function(e,t){var n=e.getEnvelopeInternal(),r=t.getEnvelopeInternal();if(!n.intersects(r)){var a=yo.combine(e,t);return a}if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var c=n.intersection(r);return this.unionUsingEnvelopeIntersection(e,t,c)};_r.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new c2(_r.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var n=t.next();e.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=e.itemsTree(),a=this.unionTree(r);return a};_r.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var a=_r.getGeometry(t,n);return this.unionSafe(a,null)}else{if(r-n===2)return this.unionSafe(_r.getGeometry(t,n),_r.getGeometry(t,n+1));var c=Math.trunc((r+n)/2),f=this.binaryUnion(t,n,c),u=this.binaryUnion(t,c,r);return this.unionSafe(f,u)}}};_r.prototype.repeatedUnion=function(e){for(var t=null,n=e.iterator();n.hasNext();){var r=n.next();t===null?t=r.copy():t=t.union(r)}return t};_r.prototype.unionSafe=function(e,t){return e===null&&t===null?null:e===null?t.copy():t===null?e.copy():this.unionOptimized(e,t)};_r.prototype.unionActual=function(e,t){return _r.restrictToPolygons(e.union(t))};_r.prototype.unionTree=function(e){var t=this.reduceToGeometries(e),n=this.binaryUnion(t);return n};_r.prototype.unionUsingEnvelopeIntersection=function(e,t,n){var r=new Qt,a=this.extractByEnvelope(n,e,r),c=this.extractByEnvelope(n,t,r),f=this.unionActual(a,c);r.add(f);var u=yo.combine(r);return u};_r.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],t=e.get(0).getFactory(),n=t.buildGeometry(e),r=n.buffer(0);return r}else if(arguments.length===2){var a=arguments[0],c=arguments[1],f=a.getFactory(),u=f.createGeometryCollection([a,c]),b=u.buffer(0);return b}};_r.prototype.interfaces_=function(){return[]};_r.prototype.getClass=function(){return _r};_r.restrictToPolygons=function(e){if(Te(e,yl))return e;var t=Na.getPolygons(e);return t.size()===1?t.get(0):e.getFactory().createMultiPolygon($e.toPolygonArray(t))};_r.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)};_r.union=function(e){var t=new _r(e);return t.union()};E2.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(_r,E2);var jm=function(){};jm.prototype.interfaces_=function(){return[]};jm.prototype.getClass=function(){return jm};jm.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return Ne.createEmptyResult(Ne.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Li.overlayOp(e,t,Ne.UNION)};function mu(){return new Wm}function Wm(){this.reset()}Wm.prototype={constructor:Wm,reset:function(){this.s=this.t=0},add:function(e){Gx(sm,e,this.t),Gx(this,sm.s,this.s),this.s?this.t+=sm.t:this.s=sm.t},valueOf:function(){return this.s}};var sm=new Wm;function Gx(e,t,n){var r=e.s=t+n,a=r-t,c=r-a;e.t=t-c+(n-a)}var S_=Math.PI,qx=S_*2;mu();mu();mu();function jx(e,t){return[e>S_?e-qx:e<-S_?e+qx:e,t]}jx.invert=jx;function C2(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function CM(e){return e.length===1&&(e=TM(e)),{left:function(t,n,r,a){for(r==null&&(r=0),a==null&&(a=t.length);r<a;){var c=r+a>>>1;e(t[c],n)<0?r=c+1:a=c}return r},right:function(t,n,r,a){for(r==null&&(r=0),a==null&&(a=t.length);r<a;){var c=r+a>>>1;e(t[c],n)>0?a=c:r=c+1}return r}}}function TM(e){return function(t,n){return C2(e(t),n)}}CM(C2);mu();mu();mu();mu();mu();function Wx(){}Wx.prototype={constructor:Wx,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function Zx(e,t){return[e,t]}Zx.invert=Zx;const LM=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],PM={decimalLatitude:40.123,decimalLongitude:-74.123},AM=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],MM=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function DM(){const e=[];return LM.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...PM})}),[...e,...AM,...MM]}const kM=DM();kM.map(e=>e.verbatimCoordinates);const RM=Symbol.for("svelte-maplibre");function NM(){return L_(RM)}function OM(e){return"layerType"in e&&e.layerType==="deckgl"}var oc=zM;function zM(e){var t,n,r;if(e){if(Array.isArray(e)){for(t=[],n=e.length,r=0;r<n;r++){var a=e[r];a!=null&&t.push(a)}return t}if(typeof e=="object"){t={};var c=Object.keys(e);for(n=c.length,r=0;r<n;r++){var f=c[r],u=e[f];u!=null&&(t[f]=u)}return t}}}var gh=f0;function f0(e,t){return e===t||e!==e&&t!==t?!0:typeof e!=typeof t||{}.toString.call(e)!={}.toString.call(t)||e!==Object(e)||!e?!1:Array.isArray(e)?Hx(e,t):{}.toString.call(e)=="[object Set]"?Hx(Array.from(e),Array.from(t)):{}.toString.call(e)=="[object Object]"?BM(e,t):FM(e,t)}function FM(e,t){return e.toString()===t.toString()}function Hx(e,t){var n=e.length;if(n!=t.length)return!1;for(var r=0;r<n;r++)if(!f0(e[r],t[r]))return!1;return!0}function BM(e,t){var n=Object.keys(e),r=n.length;if(r!=Object.keys(t).length)return!1;for(var a=0;a<r;a++){var c=n[a];if(!(t.hasOwnProperty(c)&&f0(e[c],t[c])))return!1}return!0}const VM=e=>({features:e[0]&16,data:e[0]&16,map:e[0]&4,close:e[0]&1}),Xx=e=>{var t;return{features:e[4],data:(t=e[4])==null?void 0:t[0],map:e[2],close:e[31]}};function Yx(e){let t,n,r=(e[4]||e[3]instanceof ea.Marker)&&Kx(e);return{c(){t=Pe("div"),r&&r.c()},m(a,c){Ve(a,t,c),r&&r.m(t,null),e[32](t),n=!0},p(a,c){a[4]||a[3]instanceof ea.Marker?r?(r.p(a,c),c[0]&24&&Zt(r,1)):(r=Kx(a),r.c(),Zt(r,1),r.m(t,null)):r&&(xi(),se(r,1,1,()=>{r=null}),bi())},i(a){n||(Zt(r),n=!0)},o(a){se(r),n=!1},d(a){a&&Re(t),r&&r.d(),e[32](null)}}}function Kx(e){let t;const n=e[30].default,r=vo(n,e,e[29],Xx);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c[0]&536870933)&&bo(r,n,a,a[29],t?xo(n,a[29],c,VM):wo(a[29]),Xx)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function UM(e){let t,n,r=e[9].default&&Yx(e);return{c(){r&&r.c(),t=ma()},m(a,c){r&&r.m(a,c),Ve(a,t,c),n=!0},p(a,c){a[9].default?r?(r.p(a,c),c[0]&512&&Zt(r,1)):(r=Yx(a),r.c(),Zt(r,1),r.m(t.parentNode,t)):r&&(xi(),se(r,1,1,()=>{r=null}),bi())},i(a){n||(Zt(r),n=!0)},o(a){se(r),n=!1},d(a){a&&Re(t),r&&r.d(a)}}}function GM(e,t,n){let r,a,c,f,u,b,{$$slots:C={},$$scope:A}=t;const P=ZI(C);let{closeButton:k=void 0}=t,{closeOnClickOutside:Y=!0}=t,{closeOnClickInside:X=!1}=t,{closeOnMove:lt=!1}=t,{openOn:ht="click"}=t,{openIfTopMost:_t=!0}=t,{focusAfterOpen:j=!0}=t,{anchor:W=void 0}=t,{offset:st=void 0}=t,{popupClass:gt=void 0}=t,{maxWidth:Lt=void 0}=t,{lngLat:At=void 0}=t,{html:Tt=void 0}=t,{open:Vt=!1}=t;const Yt=Xm(),{map:J,popupTarget:Ut,layerEvent:te,layer:le,eventTopMost:Xe}=NM();qn(e,J,xt=>n(2,c=xt)),qn(e,Ut,xt=>n(3,u=xt)),qn(e,te,xt=>n(28,f=xt)),qn(e,le,xt=>n(35,b=xt));const De=["click","dblclick","contextmenu"];let ue,tn=!1,Ce;function pe(){if(!ue)return;let xt=ue.getElement();!xt||xt===Ce||(Ce=xt,ht==="hover"&&(Ce.style.pointerEvents="none"),Ce.addEventListener("mouseenter",()=>{n(24,tn=!0)},{passive:!0}),Ce.addEventListener("mouseleave",()=>{n(24,tn=!1)},{passive:!0}),Ce.addEventListener("click",()=>{X&&n(0,Vt=!1)},{passive:!0}))}$I(()=>{if(c)return c.on("click",xn),c.on("contextmenu",xn),typeof u=="string"&&(c.on("click",u,Cn),c.on("dblclick",u,Cn),c.on("contextmenu",u,Cn),c.on("mousemove",u,en),c.on("mouseleave",u,zn),c.on("touchstart",u,Je),c.on("touchend",u,vn)),()=>{c!=null&&c.loaded()&&(ue==null||ue.remove(),c.off("click",xn),c.off("contextmenu",xn),u instanceof ea.Marker?u.getPopup()===ue&&u.setPopup(void 0):typeof u=="string"&&(c.off("click",u,Cn),c.off("dblclick",u,Cn),c.off("contextmenu",u,Cn),c.off("mousemove",u,en),c.off("mouseleave",u,zn),c.off("touchstart",u,Je),c.off("touchend",u,vn)))}});function Ie(xt){return _t?!("marker"in xt)&&!OM(xt)&&Xe(xt)!==b:!1}let we=null,on="normal";function Cn(xt){xt.type===ht&&(Ie(xt)||("layerType"in xt?xt.layerType==="deckgl"?(n(10,At=xt.coordinate),n(4,we=xt.object?[xt.object]:null)):(n(10,At=xt.lngLat),n(4,we=xt.features??[])):(n(10,At=xt.lngLat),n(4,we=xt.features??[])),setTimeout(()=>n(0,Vt=!0))))}let Ze=null;function Je(xt){Ze=xt.point}function vn(xt){if(!Ze||ht!=="hover")return;let ke=Ze.dist(xt.point);Ze=null,ke<3&&(n(10,At=xt.lngLat),n(4,we=xt.features??[]),ue.isOpen()?n(25,on="justOpened"):(n(25,on="opening"),n(0,Vt=!0)))}function zn(xt){ht!=="hover"||Ze||on!=="normal"||(n(0,Vt=!1),n(4,we=null))}function en(xt){if(!(ht!=="hover"||Ze||on!=="normal")){if(Ie(xt)){n(0,Vt=!1),n(4,we=null);return}n(0,Vt=!0),n(4,we=xt.features??[]),n(10,At=xt.lngLat)}}function xn(xt){if(on==="justOpened"){n(25,on="normal");return}if(!Y)return;let ke=[Ce,u instanceof ea.Marker?u==null?void 0:u.getElement():null];Vt&&ue.isOpen()&&!ke.some(cn=>cn==null?void 0:cn.contains(xt.originalEvent.target))&&(xt.type==="contextmenu"&&ht==="contextmenu"||xt.type!=="contextmenu")&&n(0,Vt=!1)}oa(()=>{c&&(ue!=null&&ue.isOpen())&&ue.remove()});let Fn;const mr=()=>n(0,Vt=!1);function rt(xt){Fi[xt?"unshift":"push"](()=>{Fn=xt,n(1,Fn)})}return e.$$set=xt=>{"closeButton"in xt&&n(11,k=xt.closeButton),"closeOnClickOutside"in xt&&n(12,Y=xt.closeOnClickOutside),"closeOnClickInside"in xt&&n(13,X=xt.closeOnClickInside),"closeOnMove"in xt&&n(14,lt=xt.closeOnMove),"openOn"in xt&&n(15,ht=xt.openOn),"openIfTopMost"in xt&&n(16,_t=xt.openIfTopMost),"focusAfterOpen"in xt&&n(17,j=xt.focusAfterOpen),"anchor"in xt&&n(18,W=xt.anchor),"offset"in xt&&n(19,st=xt.offset),"popupClass"in xt&&n(20,gt=xt.popupClass),"maxWidth"in xt&&n(21,Lt=xt.maxWidth),"lngLat"in xt&&n(10,At=xt.lngLat),"html"in xt&&n(22,Tt=xt.html),"open"in xt&&n(0,Vt=xt.open),"$$scope"in xt&&n(29,A=xt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&14336&&n(27,r=k??(!Y&&!X)),e.$$.dirty[0]&146685952&&(ue||(n(23,ue=new ea.Popup({closeButton:r,closeOnClick:!1,closeOnMove:lt,focusAfterOpen:j,maxWidth:Lt,className:gt,anchor:W,offset:st})),Ce=ue.getElement(),ue.on("open",()=>{n(0,Vt=!0),pe(),Yt("open",ue)}),ue.on("close",()=>{n(0,Vt=!1),Yt("close",ue)}),ue.on("hover",()=>{Yt("hover",ue)}))),e.$$.dirty[0]&8421384&&ue&&u instanceof ea.Marker&&(ht==="click"?u.setPopup(ue):u.getPopup()===ue&&u.setPopup(void 0)),e.$$.dirty[0]&268468224&&De.includes(ht)&&(f==null?void 0:f.type)===ht&&(Cn(f),Cs(te,f=null,f)),e.$$.dirty[0]&268468224&&n(26,a=ht==="hover"&&((f==null?void 0:f.type)==="mousemove"||(f==null?void 0:f.type)==="mouseenter")),e.$$.dirty[0]&352354304&&ht==="hover"&&te&&(a&&f&&(f.layerType==="deckgl"?(n(10,At=f.coordinate),n(4,we=f.object?[f.object]:null)):(n(10,At=f.lngLat),n(4,we=f.features??[]))),n(0,Vt=(a||tn)??!1)),e.$$.dirty[0]&12582914&&(Fn?ue.setDOMContent(Fn):Tt&&ue.setHTML(Tt)),e.$$.dirty[0]&8389632&&At&&ue.setLngLat(At),e.$$.dirty[0]&41943045&&c){let xt=ue.isOpen();Vt&&!xt?(ue.addTo(c),on==="opening"&&n(25,on="justOpened")):!Vt&&xt&&ue.remove()}},[Vt,Fn,c,u,we,J,Ut,te,le,P,At,k,Y,X,lt,ht,_t,j,W,st,gt,Lt,Tt,ue,tn,on,a,r,f,A,C,mr,rt]}class qM extends Lr{constructor(t){super(),Tr(this,t,GM,UM,Wn,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var Xf=Uint8Array,T2=Uint16Array,jM=Int32Array,WM=new Xf([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ZM=new Xf([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),L2=function(e,t){for(var n=new T2(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var a=new jM(n[30]),r=1;r<30;++r)for(var c=n[r];c<n[r+1];++c)a[c]=c-n[r]<<5|r;return{b:n,r:a}},P2=L2(WM,2),HM=P2.b,XM=P2.r;HM[28]=258,XM[258]=28;L2(ZM,0);var YM=new T2(32768);for(Nn=0;Nn<32768;++Nn)ul=(Nn&43690)>>1|(Nn&21845)<<1,ul=(ul&52428)>>2|(ul&13107)<<2,ul=(ul&61680)>>4|(ul&3855)<<4,YM[Nn]=((ul&65280)>>8|(ul&255)<<8)>>1;var ul,Nn,hg=new Xf(288);for(Nn=0;Nn<144;++Nn)hg[Nn]=8;var Nn;for(Nn=144;Nn<256;++Nn)hg[Nn]=9;var Nn;for(Nn=256;Nn<280;++Nn)hg[Nn]=7;var Nn;for(Nn=280;Nn<288;++Nn)hg[Nn]=8;var Nn,KM=new Xf(32);for(Nn=0;Nn<32;++Nn)KM[Nn]=5;var Nn,JM=new Xf(0),QM=typeof TextDecoder<"u"&&new TextDecoder,$M=0;try{QM.decode(JM,{stream:!0}),$M=1}catch{}const t5=e=>({props:e&8}),Jx=e=>({props:r5(e[3])});function e5(e){let t;const n=e[1].default,r=vo(n,e,e[2],Jx);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c&12)&&bo(r,n,a,a[2],t?xo(n,a[2],c,t5):wo(a[2]),Jx)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function n5(e){let t,n;return t=new qM({props:{openOn:e[0],$$slots:{default:[e5,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:e}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,[a]){const c={};a&1&&(c.openOn=r[0]),a&12&&(c.$$scope={dirty:a,ctx:r}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function r5(e){return e?e[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function i5(e,t,n){let{$$slots:r={},$$scope:a}=t,{openOn:c="hover"}=t;return e.$$set=f=>{"openOn"in f&&n(0,c=f.openOn),"$$scope"in f&&n(2,a=f.$$scope)},[c,r,a]}class o5 extends Lr{constructor(t){super(),Tr(this,t,i5,n5,Wn,{openOn:0})}}let s5=Date.now();function pg(e){return`${e}-${s5++}`}const d0=Symbol.for("svelte-maplibre");function Yf(){return L_(d0)}function a5(e){let t=new WeakMap;return n=>{var f;let r=t.get(n.originalEvent);if(r!==void 0)return r;let c=(f=n.target.queryRenderedFeatures(n.point).find(u=>{var b;return(b=e.get(u.layer.id))==null?void 0:b.interactive}))==null?void 0:f.layer.id;return t.set(n.originalEvent,c),c}}function l5(){let e=new Map;return T_(d0,{map:go(null),source:wy(null),layer:wy(null),popupTarget:wy(null),cluster:go(),loadedImages:go(new Set),minzoom:go(0),maxzoom:go(24),layerEvent:go(null),layerInfo:e,eventTopMost:a5(e)})}function Qx(e){return{subscribe:e.subscribe}}function A2({key:e,setPopupTarget:t=!1,setCluster:n=!1,setMouseEvent:r=!1}){let a=Yf(),c=go(null),f=Qx(c),u={...a,[e]:Qx(c)};if(t&&(u.popupTarget=f),r){let b=go(null);u.layerEvent=b,a.layerEvent=b}return n&&(u.cluster=go()),T_(d0,u),{...a,self:c}}function u5(){return A2({key:"source",setCluster:!0})}function c5(e=!0){return A2({key:"layer",setPopupTarget:e,setMouseEvent:e})}function $x(e){let t;return n=>{if(n)for(let r in n){let a=t==null?void 0:t[r],c=n[r];a!==c&&e(r,c,a)}else if(t)for(let r in t)e(r,void 0,t[r]);t=n}}function h5(e,...t){let n=[e];for(let r of t)if(r)Array.isArray(r)&&r[0]===e?n.push(...r.slice(1)):n.push(r);else continue;if(n.length!==1)return n.length===2?n[1]:n}function p5(e){return e===!0?["has","point_count"]:e===!1?["!",["has","point_count"]]:void 0}function M2(e,t){return["case",["boolean",["feature-state","hover"],!1],t,e]}function tb(e){let t=e[0],n,r,a=eb(e);return{c(){a.c(),n=ma()},m(c,f){a.m(c,f),Ve(c,n,f),r=!0},p(c,f){f[0]&1&&Wn(t,t=c[0])?(xi(),se(a,1,1,Xr),bi(),a=eb(c),a.c(),Zt(a,1),a.m(n.parentNode,n)):a.p(c,f)},i(c){r||(Zt(a),r=!0)},o(c){se(a),r=!1},d(c){c&&Re(n),a.d(c)}}}function eb(e){let t;const n=e[36].default,r=vo(n,e,e[35],null);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c[1]&16)&&bo(r,n,a,a[35],t?xo(n,a[35],c,null):wo(a[35]),null)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function f5(e){let t,n,r=e[0]&&tb(e);return{c(){r&&r.c(),t=ma()},m(a,c){r&&r.m(a,c),Ve(a,t,c),n=!0},p(a,c){a[0]?r?(r.p(a,c),c[0]&1&&Zt(r,1)):(r=tb(a),r.c(),Zt(r,1),r.m(t.parentNode,t)):r&&(xi(),se(r,1,1,()=>{r=null}),bi())},i(a){n||(Zt(r),n=!0)},o(a){se(r),n=!1},d(a){a&&Re(t),r&&r.d(a)}}}function d5(e,t,n){let r,a,c,f,u,b,C,A,P,k,Y,X,{$$slots:lt={},$$scope:ht}=t,{id:_t=pg("layer")}=t,{source:j=void 0}=t,{sourceLayer:W=void 0}=t,{beforeId:st=void 0}=t,{beforeLayerType:gt=void 0}=t,{type:Lt}=t,{paint:At=void 0}=t,{layout:Tt=void 0}=t,{filter:Vt=void 0}=t,{applyToClusters:Yt=void 0}=t,{minzoom:J=void 0}=t,{maxzoom:Ut=void 0}=t,{manageHoverState:te=!1}=t,{hovered:le=null}=t,{interactive:Xe=!0}=t,{hoverCursor:De=void 0}=t,{eventsIfTopMost:ue=!1}=t;const tn=Xm(),{map:Ce,source:pe,self:Ie,minzoom:we,maxzoom:on,eventTopMost:Cn,layerInfo:Ze}=c5();qn(e,Ce,rt=>n(31,P=rt)),qn(e,pe,rt=>n(32,k=rt)),qn(e,Ie,rt=>n(0,A=rt)),qn(e,we,rt=>n(34,X=rt)),qn(e,on,rt=>n(33,Y=rt)),oa(()=>{A&&P&&(Ze.delete(A),P==null||P.removeLayer(A))});let Je;function vn(rt){var Ct,$n;if(!Xe||!A||!P||ue&&Cn(rt)!==A)return;let xt=rt.features??[],ke=($n=(Ct=xt[0])==null?void 0:Ct.properties)==null?void 0:$n.cluster_id,cn={event:rt,map:P,clusterId:ke,layer:A,source:u,features:xt};tn(rt.type,cn)}function zn(rt){var Ct,$n;if(!Xe||!A||!P||ue&&Cn(rt)!==A)return;De&&(P.getCanvas().style.cursor=De);let xt=rt.features??[];n(6,le=xt[0]??null);let ke=($n=(Ct=xt[0])==null?void 0:Ct.properties)==null?void 0:$n.cluster_id;tn("mouseenter",{event:rt,map:P,clusterId:ke,layer:A,source:u,features:xt})}function en(rt){var Ct,$n,qo;if(!Xe||!P)return;if(ue&&Cn(rt)!==A){n(6,le=null),te&&Je!==void 0&&(P==null||P.setFeatureState({source:u,sourceLayer:W,id:Je},{hover:!1}),Je=void 0);return}P.getCanvas().style.cursor=De;let xt=rt.features??[],ke=($n=(Ct=xt[0])==null?void 0:Ct.properties)==null?void 0:$n.cluster_id,cn=(qo=xt[0])==null?void 0:qo.id;cn!==Je&&(te&&(Je!==void 0&&(P==null||P.setFeatureState({source:u,id:Je,sourceLayer:W},{hover:!1})),P==null||P.setFeatureState({source:u,id:cn,sourceLayer:W},{hover:!0})),Je=cn,n(6,le=xt[0]??null)),tn("mousemove",{event:rt,map:P,clusterId:ke,layer:A,source:u,features:xt})}function xn(rt){if(!(!Xe||!A||!P)){if(De&&(P.getCanvas().style.cursor=""),n(6,le=null),te&&Je!==void 0){const xt={source:u,id:Je,sourceLayer:W};P==null||P.setFeatureState(xt,{hover:!1}),Je=void 0}tn("mouseleave",{map:P,layer:A,source:u})}}let Fn=!0;function mr(rt){P&&(P.off("click",rt,vn),P.off("dblclick",rt,vn),P.off("contextmenu",rt,vn),P.off("mouseenter",rt,zn),P.off("mousemove",rt,en),P.off("mouseleave",rt,xn))}return oa(()=>{P&&A&&mr(A)}),e.$$set=rt=>{"id"in rt&&n(7,_t=rt.id),"source"in rt&&n(8,j=rt.source),"sourceLayer"in rt&&n(9,W=rt.sourceLayer),"beforeId"in rt&&n(10,st=rt.beforeId),"beforeLayerType"in rt&&n(11,gt=rt.beforeLayerType),"type"in rt&&n(12,Lt=rt.type),"paint"in rt&&n(13,At=rt.paint),"layout"in rt&&n(14,Tt=rt.layout),"filter"in rt&&n(15,Vt=rt.filter),"applyToClusters"in rt&&n(16,Yt=rt.applyToClusters),"minzoom"in rt&&n(17,J=rt.minzoom),"maxzoom"in rt&&n(18,Ut=rt.maxzoom),"manageHoverState"in rt&&n(19,te=rt.manageHoverState),"hovered"in rt&&n(6,le=rt.hovered),"interactive"in rt&&n(20,Xe=rt.interactive),"hoverCursor"in rt&&n(21,De=rt.hoverCursor),"eventsIfTopMost"in rt&&n(22,ue=rt.eventsIfTopMost),"$$scope"in rt&&n(35,ht=rt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&65536&&n(30,r=p5(Yt)),e.$$.dirty[0]&1073774592&&n(24,a=h5("all",r,Vt)),e.$$.dirty[0]&131072|e.$$.dirty[1]&8&&n(26,c=J??X),e.$$.dirty[0]&262144|e.$$.dirty[1]&4&&n(25,f=Ut??Y),e.$$.dirty[0]&256|e.$$.dirty[1]&2&&n(29,u=j||k),e.$$.dirty[0]&654343809|e.$$.dirty[1]&1&&P&&A!==_t&&u){A&&(mr(A),Ze.delete(A));let rt=st;if(!st&&gt){let xt=P.getStyle().layers,ke=typeof gt=="function"?gt:Ct=>Ct.type===gt,cn=xt==null?void 0:xt.find(ke);cn&&(rt=cn.id)}Cs(Ie,A=_t,A),P.addLayer(oc({id:A,type:Lt,source:u,"source-layer":W,filter:a,paint:At,layout:Tt,minzoom:c,maxzoom:f}),rt),n(23,Fn=!0),P.on("click",A,vn),P.on("dblclick",A,vn),P.on("contextmenu",A,vn),P.on("mouseenter",A,zn),P.on("mousemove",A,en),P.on("mouseleave",A,xn)}e.$$.dirty[0]&1048577&&A&&Ze.set(A,{interactive:Xe}),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(28,b=A?$x((rt,xt)=>P==null?void 0:P.setPaintProperty(A,rt,xt)):void 0),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(27,C=A?$x((rt,xt)=>P==null?void 0:P.setLayoutProperty(A,rt,xt)):void 0),e.$$.dirty[0]&268443648&&(b==null||b(At)),e.$$.dirty[0]&134234112&&(C==null||C(Tt)),e.$$.dirty[0]&100663297|e.$$.dirty[1]&1&&A&&(P==null||P.setLayerZoomRange(A,c,f)),e.$$.dirty[0]&25165825|e.$$.dirty[1]&1&&A&&(Fn?n(23,Fn=!1):P==null||P.setFilter(A,a))},[A,Ce,pe,Ie,we,on,le,_t,j,W,st,gt,Lt,At,Tt,Vt,Yt,J,Ut,te,Xe,De,ue,Fn,a,f,c,C,b,u,r,P,k,Y,X,ht,lt]}let D2=class extends Lr{constructor(t){super(),Tr(this,t,d5,f5,Wn,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function m5(e){let t;const n=e[15].default,r=vo(n,e,e[23],null);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c&8388608)&&bo(r,n,a,a[23],t?xo(n,a[23],c,null):wo(a[23]),null)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function g5(e){let t,n,r;function a(f){e[16](f)}let c={id:e[1],type:"fill",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[m5]},$$scope:{ctx:e}};return e[0]!==void 0&&(c.hovered=e[0]),t=new D2({props:c}),Fi.push(()=>ta(t,"hovered",a)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){En(t.$$.fragment)},m(f,u){wn(t,f,u),r=!0},p(f,[u]){const b={};u&2&&(b.id=f[1]),u&4&&(b.source=f[2]),u&8&&(b.sourceLayer=f[3]),u&16&&(b.beforeId=f[4]),u&32&&(b.beforeLayerType=f[5]),u&64&&(b.paint=f[6]),u&128&&(b.layout=f[7]),u&256&&(b.filter=f[8]),u&512&&(b.minzoom=f[9]),u&1024&&(b.maxzoom=f[10]),u&2048&&(b.hoverCursor=f[11]),u&4096&&(b.manageHoverState=f[12]),u&8192&&(b.eventsIfTopMost=f[13]),u&16384&&(b.interactive=f[14]),u&8388608&&(b.$$scope={dirty:u,ctx:f}),!n&&u&1&&(n=!0,b.hovered=f[0],$s(()=>n=!1)),t.$set(b)},i(f){r||(Zt(t.$$.fragment,f),r=!0)},o(f){se(t.$$.fragment,f),r=!1},d(f){Sn(t,f)}}}function y5(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:c=pg("fill")}=t,{source:f=void 0}=t,{sourceLayer:u=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:k=void 0}=t,{minzoom:Y=void 0}=t,{maxzoom:X=void 0}=t,{hoverCursor:lt=void 0}=t,{manageHoverState:ht=!1}=t,{hovered:_t=null}=t,{eventsIfTopMost:j=!1}=t,{interactive:W=!0}=t;function st(J){_t=J,n(0,_t)}function gt(J){Rn.call(this,e,J)}function Lt(J){Rn.call(this,e,J)}function At(J){Rn.call(this,e,J)}function Tt(J){Rn.call(this,e,J)}function Vt(J){Rn.call(this,e,J)}function Yt(J){Rn.call(this,e,J)}return e.$$set=J=>{"id"in J&&n(1,c=J.id),"source"in J&&n(2,f=J.source),"sourceLayer"in J&&n(3,u=J.sourceLayer),"beforeId"in J&&n(4,b=J.beforeId),"beforeLayerType"in J&&n(5,C=J.beforeLayerType),"paint"in J&&n(6,A=J.paint),"layout"in J&&n(7,P=J.layout),"filter"in J&&n(8,k=J.filter),"minzoom"in J&&n(9,Y=J.minzoom),"maxzoom"in J&&n(10,X=J.maxzoom),"hoverCursor"in J&&n(11,lt=J.hoverCursor),"manageHoverState"in J&&n(12,ht=J.manageHoverState),"hovered"in J&&n(0,_t=J.hovered),"eventsIfTopMost"in J&&n(13,j=J.eventsIfTopMost),"interactive"in J&&n(14,W=J.interactive),"$$scope"in J&&n(23,a=J.$$scope)},[_t,c,f,u,b,C,A,P,k,Y,X,lt,ht,j,W,r,st,gt,Lt,At,Tt,Vt,Yt,a]}let k2=class extends Lr{constructor(t){super(),Tr(this,t,y5,g5,Wn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function _5(e,t,n){let r;const{map:a}=Yf();qn(e,a,b=>n(4,r=b));let{position:c="top-left"}=t,{container:f=void 0}=t,u=null;return oa(()=>{r!=null&&r.loaded()&&u&&r.removeControl(u)}),e.$$set=b=>{"position"in b&&n(1,c=b.position),"container"in b&&n(2,f=b.container)},e.$$.update=()=>{if(e.$$.dirty&30&&r&&!u){let b;typeof f=="string"?b=document.querySelector(f)??void 0:b=f,n(3,u=new ea.FullscreenControl({container:b})),r.addControl(u,c)}},[a,c,f,u,r]}class v5 extends Lr{constructor(t){super(),Tr(this,t,_5,null,Wn,{position:1,container:2})}}function x5(e,t,n,r,a){let c=!1;e.getSource(t)&&(c=!0,e.removeSource(t));const f=()=>{r(t)&&(e.addSource(t,n),a())};if(c){const u=()=>{t&&(e.getSource(t)?setTimeout(u,1):f())};u()}else f()}function b5(e,t,n){Nb().then(()=>{let r=Ab(e);if(!r)return;r.getSource(t)===n&&r.removeSource(t)})}function nb(e){let t=e[0],n,r,a=rb(e);return{c(){a.c(),n=ma()},m(c,f){a.m(c,f),Ve(c,n,f),r=!0},p(c,f){f&1&&Wn(t,t=c[0])?(xi(),se(a,1,1,Xr),bi(),a=rb(c),a.c(),Zt(a,1),a.m(n.parentNode,n)):a.p(c,f)},i(c){r||(Zt(a),r=!0)},o(c){se(a),r=!1},d(c){c&&Re(n),a.d(c)}}}function rb(e){let t;const n=e[19].default,r=vo(n,e,e[18],null);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c&262144)&&bo(r,n,a,a[18],t?xo(n,a[18],c,null):wo(a[18]),null)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function w5(e){let t,n,r=e[0]&&nb(e);return{c(){r&&r.c(),t=ma()},m(a,c){r&&r.m(a,c),Ve(a,t,c),n=!0},p(a,[c]){a[0]?r?(r.p(a,c),c&1&&Zt(r,1)):(r=nb(a),r.c(),Zt(r,1),r.m(t.parentNode,t)):r&&(xi(),se(r,1,1,()=>{r=null}),bi())},i(a){n||(Zt(r),n=!0)},o(a){se(r),n=!1},d(a){a&&Re(t),r&&r.d(a)}}}function S5(e,t,n){let r,a,c,{$$slots:f={},$$scope:u}=t,{id:b=pg("geojson")}=t,{data:C}=t,{generateId:A=!1}=t,{promoteId:P=void 0}=t,{filter:k=void 0}=t,{lineMetrics:Y=void 0}=t,{cluster:X=void 0}=t,{maxzoom:lt=void 0}=t,{attribution:ht=void 0}=t,{buffer:_t=void 0}=t,{tolerance:j=void 0}=t;const{map:W,cluster:st,self:gt}=u5();qn(e,W,Tt=>n(17,a=Tt)),qn(e,st,Tt=>n(20,c=Tt)),qn(e,gt,Tt=>n(0,r=Tt));let Lt,At=!0;return oa(()=>{r&&Lt&&a&&(b5(W,r,Lt),Cs(gt,r=null,r),n(15,Lt=void 0))}),e.$$set=Tt=>{"id"in Tt&&n(4,b=Tt.id),"data"in Tt&&n(5,C=Tt.data),"generateId"in Tt&&n(6,A=Tt.generateId),"promoteId"in Tt&&n(7,P=Tt.promoteId),"filter"in Tt&&n(8,k=Tt.filter),"lineMetrics"in Tt&&n(9,Y=Tt.lineMetrics),"cluster"in Tt&&n(10,X=Tt.cluster),"maxzoom"in Tt&&n(11,lt=Tt.maxzoom),"attribution"in Tt&&n(12,ht=Tt.attribution),"buffer"in Tt&&n(13,_t=Tt.buffer),"tolerance"in Tt&&n(14,j=Tt.tolerance),"$$scope"in Tt&&n(18,u=Tt.$$scope)},e.$$.update=()=>{e.$$.dirty&1024&&Cs(st,c=X,c),e.$$.dirty&196593&&a&&r!==b&&(Cs(gt,r=b,r),x5(a,r,oc({type:"geojson",data:C,filter:k,lineMetrics:Y,generateId:A,promoteId:P,cluster:!!X,clusterMinPoints:X==null?void 0:X.minPoints,clusterMaxZoom:X==null?void 0:X.maxZoom,clusterRadius:X==null?void 0:X.radius,clusterProperties:X==null?void 0:X.properties,maxzoom:lt,attribution:ht,buffer:_t,tolerance:j}),Tt=>a&&Tt===r,()=>{r&&(n(15,Lt=a==null?void 0:a.getSource(r)),n(16,At=!0))})),e.$$.dirty&131088&&(a==null||a.on("style.load",()=>{n(15,Lt=a==null?void 0:a.getSource(b))})),e.$$.dirty&98336&&Lt&&(At?n(16,At=!1):Lt.setData(C)),e.$$.dirty&33792&&(Lt==null||Lt.setClusterOptions(oc({cluster:!!X,clusterMaxZoom:X==null?void 0:X.maxZoom,clusterRadius:X==null?void 0:X.radius})))},[r,W,st,gt,b,C,A,P,k,Y,X,lt,ht,_t,j,Lt,At,a,u,f]}let fg=class extends Lr{constructor(t){super(),Tr(this,t,S5,w5,Wn,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function I5(e,t,n){let r;const{map:a}=Yf();qn(e,a,k=>n(8,r=k));let{position:c="top-left"}=t,{positionOptions:f=void 0}=t,{fitBoundsOptions:u=void 0}=t,{trackUserLocation:b=!1}=t,{showAccuracyCircle:C=!0}=t,{showUserLocation:A=!0}=t,{control:P=null}=t;return oa(()=>{r!=null&&r.loaded()&&P&&r.removeControl(P)}),e.$$set=k=>{"position"in k&&n(2,c=k.position),"positionOptions"in k&&n(3,f=k.positionOptions),"fitBoundsOptions"in k&&n(4,u=k.fitBoundsOptions),"trackUserLocation"in k&&n(5,b=k.trackUserLocation),"showAccuracyCircle"in k&&n(6,C=k.showAccuracyCircle),"showUserLocation"in k&&n(7,A=k.showUserLocation),"control"in k&&n(1,P=k.control)},e.$$.update=()=>{e.$$.dirty&510&&r&&!P&&(n(1,P=new ea.GeolocateControl({positionOptions:f,fitBoundsOptions:u,trackUserLocation:b,showAccuracyCircle:C,showUserLocation:A})),r.addControl(P,c))},[a,P,c,f,u,b,C,A,r]}class E5 extends Lr{constructor(t){super(),Tr(this,t,I5,null,Wn,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function C5(e){let t;const n=e[15].default,r=vo(n,e,e[23],null);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c&8388608)&&bo(r,n,a,a[23],t?xo(n,a[23],c,null):wo(a[23]),null)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function T5(e){let t,n,r;function a(f){e[16](f)}let c={id:e[1],type:"line",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[C5]},$$scope:{ctx:e}};return e[0]!==void 0&&(c.hovered=e[0]),t=new D2({props:c}),Fi.push(()=>ta(t,"hovered",a)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){En(t.$$.fragment)},m(f,u){wn(t,f,u),r=!0},p(f,[u]){const b={};u&2&&(b.id=f[1]),u&4&&(b.source=f[2]),u&8&&(b.sourceLayer=f[3]),u&16&&(b.beforeId=f[4]),u&32&&(b.beforeLayerType=f[5]),u&64&&(b.paint=f[6]),u&128&&(b.layout=f[7]),u&256&&(b.filter=f[8]),u&512&&(b.minzoom=f[9]),u&1024&&(b.maxzoom=f[10]),u&2048&&(b.hoverCursor=f[11]),u&4096&&(b.manageHoverState=f[12]),u&8192&&(b.eventsIfTopMost=f[13]),u&16384&&(b.interactive=f[14]),u&8388608&&(b.$$scope={dirty:u,ctx:f}),!n&&u&1&&(n=!0,b.hovered=f[0],$s(()=>n=!1)),t.$set(b)},i(f){r||(Zt(t.$$.fragment,f),r=!0)},o(f){se(t.$$.fragment,f),r=!1},d(f){Sn(t,f)}}}function L5(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:c=pg("line")}=t,{source:f=void 0}=t,{sourceLayer:u=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:k=void 0}=t,{minzoom:Y=void 0}=t,{maxzoom:X=void 0}=t,{hoverCursor:lt=void 0}=t,{manageHoverState:ht=!1}=t,{hovered:_t=null}=t,{eventsIfTopMost:j=!1}=t,{interactive:W=!0}=t;function st(J){_t=J,n(0,_t)}function gt(J){Rn.call(this,e,J)}function Lt(J){Rn.call(this,e,J)}function At(J){Rn.call(this,e,J)}function Tt(J){Rn.call(this,e,J)}function Vt(J){Rn.call(this,e,J)}function Yt(J){Rn.call(this,e,J)}return e.$$set=J=>{"id"in J&&n(1,c=J.id),"source"in J&&n(2,f=J.source),"sourceLayer"in J&&n(3,u=J.sourceLayer),"beforeId"in J&&n(4,b=J.beforeId),"beforeLayerType"in J&&n(5,C=J.beforeLayerType),"paint"in J&&n(6,A=J.paint),"layout"in J&&n(7,P=J.layout),"filter"in J&&n(8,k=J.filter),"minzoom"in J&&n(9,Y=J.minzoom),"maxzoom"in J&&n(10,X=J.maxzoom),"hoverCursor"in J&&n(11,lt=J.hoverCursor),"manageHoverState"in J&&n(12,ht=J.manageHoverState),"hovered"in J&&n(0,_t=J.hovered),"eventsIfTopMost"in J&&n(13,j=J.eventsIfTopMost),"interactive"in J&&n(14,W=J.interactive),"$$scope"in J&&n(23,a=J.$$scope)},[_t,c,f,u,b,C,A,P,k,Y,X,lt,ht,j,W,r,st,gt,Lt,At,Tt,Vt,Yt,a]}let R2=class extends Lr{constructor(t){super(),Tr(this,t,L5,T5,Wn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function P5(e){let t=e.getCenter(),n=Math.round(e.getZoom()*100)/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,r),c=Math.round(t.lat*a)/a,f=Math.round(t.lng*a)/a,u=`${n}/${c}/${f}`,b=e.getBearing(),C=e.getPitch();return(b||C)&&(u+=`/${Math.round(b*10)/10}`),C&&(u+=`/${Math.round(C)}`),`#${u}`}function A5(e){return e.replace("#","").split("/").map(parseFloat)}function M5(e,t,n){let r;const{map:a}=Yf();qn(e,a,A=>n(6,r=A));let{position:c="top-left"}=t,{showCompass:f=!0}=t,{showZoom:u=!0}=t,{visualizePitch:b=!1}=t,C=null;return oa(()=>{r!=null&&r.loaded()&&C&&r.removeControl(C)}),e.$$set=A=>{"position"in A&&n(1,c=A.position),"showCompass"in A&&n(2,f=A.showCompass),"showZoom"in A&&n(3,u=A.showZoom),"visualizePitch"in A&&n(4,b=A.visualizePitch)},e.$$.update=()=>{e.$$.dirty&126&&r&&!C&&(n(5,C=new ea.NavigationControl({showCompass:f,showZoom:u,visualizePitch:b})),r.addControl(C,c))},[a,c,f,u,b,C,r]}class D5 extends Lr{constructor(t){super(),Tr(this,t,M5,null,Wn,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function k5(e,t,n){let r;const{map:a}=Yf();qn(e,a,C=>n(5,r=C));let{position:c="bottom-left"}=t,{maxWidth:f=void 0}=t,{unit:u="metric"}=t,b=null;return oa(()=>{r!=null&&r.loaded()&&b&&r.removeControl(b)}),e.$$set=C=>{"position"in C&&n(1,c=C.position),"maxWidth"in C&&n(2,f=C.maxWidth),"unit"in C&&n(3,u=C.unit)},e.$$.update=()=>{e.$$.dirty&62&&r&&!b&&(n(4,b=new ea.ScaleControl({maxWidth:f,unit:u})),r.addControl(b,c))},[a,c,f,u,b,r]}class R5 extends Lr{constructor(t){super(),Tr(this,t,k5,null,Wn,{position:1,maxWidth:2,unit:3})}}const{window:N5}=XI,O5=e=>({map:e[0]&16,loadedImages:e[0]&32,allImagesLoaded:e[0]&64}),ib=e=>({map:e[4],loadedImages:e[5],allImagesLoaded:e[6]});function ob(e){let t,n,r=e[3]&&sb(e);const a=e[40].default,c=vo(a,e,e[39],ib);return{c(){r&&r.c(),t=pn(),c&&c.c()},m(f,u){r&&r.m(f,u),Ve(f,t,u),c&&c.m(f,u),n=!0},p(f,u){f[3]?r?(r.p(f,u),u[0]&8&&Zt(r,1)):(r=sb(f),r.c(),Zt(r,1),r.m(t.parentNode,t)):r&&(xi(),se(r,1,1,()=>{r=null}),bi()),c&&c.p&&(!n||u[0]&112|u[1]&256)&&bo(c,a,f,f[39],n?xo(a,f[39],u,O5):wo(f[39]),ib)},i(f){n||(Zt(r),Zt(c,f),n=!0)},o(f){se(r),se(c,f),n=!1},d(f){f&&Re(t),r&&r.d(f),c&&c.d(f)}}}function sb(e){let t,n,r,a,c,f,u,b;return t=new D5({props:{position:e[7]}}),r=new E5({props:{position:e[7],fitBoundsOptions:{maxZoom:12}}}),c=new v5({props:{position:e[7]}}),u=new R5({props:{position:e[7]}}),{c(){En(t.$$.fragment),n=pn(),En(r.$$.fragment),a=pn(),En(c.$$.fragment),f=pn(),En(u.$$.fragment)},m(C,A){wn(t,C,A),Ve(C,n,A),wn(r,C,A),Ve(C,a,A),wn(c,C,A),Ve(C,f,A),wn(u,C,A),b=!0},p(C,A){const P={};A[0]&128&&(P.position=C[7]),t.$set(P);const k={};A[0]&128&&(k.position=C[7]),r.$set(k);const Y={};A[0]&128&&(Y.position=C[7]),c.$set(Y);const X={};A[0]&128&&(X.position=C[7]),u.$set(X)},i(C){b||(Zt(t.$$.fragment,C),Zt(r.$$.fragment,C),Zt(c.$$.fragment,C),Zt(u.$$.fragment,C),b=!0)},o(C){se(t.$$.fragment,C),se(r.$$.fragment,C),se(c.$$.fragment,C),se(u.$$.fragment,C),b=!1},d(C){C&&(Re(n),Re(a),Re(f)),Sn(t,C),Sn(r,C),Sn(c,C),Sn(u,C)}}}function z5(e){let t,n,r,a,c,f=e[4]&&e[0]&&ob(e);return{c(){t=Pe("div"),f&&f.c(),cr(t,"class",n=Qv(e[2])+" svelte-p00lfq"),cr(t,"data-testid","map-container"),t1(t,"expand-map",!e[2])},m(u,b){Ve(u,t,b),f&&f.m(t,null),e[41](t),r=!0,a||(c=[ei(N5,"hashchange",e[11]),HI(e[10].call(null,t))],a=!0)},p(u,b){u[4]&&u[0]?f?(f.p(u,b),b[0]&17&&Zt(f,1)):(f=ob(u),f.c(),Zt(f,1),f.m(t,null)):f&&(xi(),se(f,1,1,()=>{f=null}),bi()),(!r||b[0]&4&&n!==(n=Qv(u[2])+" svelte-p00lfq"))&&cr(t,"class",n),(!r||b[0]&4)&&t1(t,"expand-map",!u[2])},i(u){r||(Zt(f),r=!0)},o(u){se(f),r=!1},d(u){u&&Re(t),f&&f.d(),e[41](null),a=!1,ls(c)}}}function F5(e,t,n){let r,a,c,f,{$$slots:u={},$$scope:b}=t,{map:C=null}=t,{mapContainer:A=void 0}=t,{class:P=void 0}=t,{style:k}=t,{diffStyleUpdates:Y=!1}=t,{center:X=void 0}=t,{zoom:lt=void 0}=t,{pitch:ht=0}=t,{bearing:_t=0}=t,{bounds:j=void 0}=t,{hash:W=!1}=t,{updateHash:st=rt=>{window.history.replaceState(window.history.state,"",rt)}}=t,{loaded:gt=!1}=t,{minZoom:Lt=0}=t,{maxZoom:At=22}=t,{antialias:Tt=void 0}=t,{zoomOnDoubleClick:Vt=!0}=t,{locale:Yt=void 0}=t,{interactive:J=!0}=t,{attributionControl:Ut=!0}=t,{cooperativeGestures:te=!1}=t,{preserveDrawingBuffer:le=!1}=t,{maxBounds:Xe=void 0}=t,{images:De=[]}=t,{standardControls:ue=!1}=t,{filterLayers:tn=void 0}=t,{transformRequest:Ce=void 0}=t;const pe=Xm(),{map:Ie,loadedImages:we}=l5();qn(e,Ie,rt=>n(4,c=rt)),qn(e,we,rt=>n(5,f=rt));let on=new Set;async function Cn(rt,xt=!1){if(c&&!(!c.loaded()&&!xt))if("url"in rt){on.add(rt.id);try{let ke=await c.loadImage(rt.url);c==null||c.addImage(rt.id,ke.data,rt.options),f.add(rt.id),we.set(f)}catch(ke){pe("error",ke)}finally{on.delete(rt.id)}}else c.addImage(rt.id,rt.data,rt.options),f.add(rt.id),we.set(f)}let Ze,Je,vn,zn;function en(rt){return Fn(),Cs(Ie,c=new ea.Map(oc({container:rt,style:k,locale:Yt,center:X,zoom:lt,pitch:ht,bearing:_t,minZoom:Lt,maxZoom:At,antialias:Tt,interactive:J,preserveDrawingBuffer:le,maxBounds:Xe,bounds:j,attributionControl:Ut,transformRequest:Ce,cooperativeGestures:te})),c),c.on("load",xt=>{xt.target.getContainer().setAttribute("data-testid","map"),xt.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,gt=!0),pe("load",c)}),c.on("error",xt=>pe("error",{...xt,map:c})),c.on("movestart",xt=>pe("movestart",{...xt,map:c})),c.on("moveend",xt=>{if(n(12,X=xt.target.getCenter()),n(13,lt=xt.target.getZoom()),n(14,ht=xt.target.getPitch()),n(15,_t=xt.target.getBearing()),n(16,j=xt.target.getBounds()),pe("moveend",{...xt,map:c}),W){let ke=new URL(window.location.href.replace(/(#.+)?$/,P5(c)));st(ke)}}),c.on("click",xt=>pe("click",{...xt,map:c})),c.on("dblclick",xt=>pe("dblclick",{...xt,map:c})),c.on("contextmenu",xt=>pe("contextmenu",{...xt,map:c})),c.on("zoomstart",xt=>pe("zoomstart",{...xt,map:c})),c.on("zoom",xt=>{pe("zoom",{...xt,map:c})}),c.on("zoomend",xt=>{pe("zoomend",{...xt,map:c})}),c.on("style.load",()=>{if(c){const xt=c.getStyle();if(n(36,Ze=xt.layers.map(ke=>ke.id)),n(37,Je=Object.keys(xt.sources)),zn)for(const[ke,cn]of Object.entries(zn))c.addSource(ke,cn);if(vn)for(const ke of vn)c.addLayer(ke);for(const ke of De)Cn(ke,!0)}}),c.on("styledata",xt=>{if(c&&tn){const ke=c.getStyle().layers;if(ke)for(let cn of ke)tn(cn)||c.setLayoutProperty(cn.id,"visibility","none")}pe("styledata",{...xt,map:c})}),{destroy(){n(0,gt=!1),c==null||c.remove(),Cs(Ie,c=null,c)}}}let xn=k;function Fn(){if(W){let rt=A5(window.location.hash);rt.length>=3&&(n(13,lt=rt[0]),n(12,X=[rt[2],rt[1]])),rt.length==5&&(n(15,_t=rt[3]),n(14,ht=rt[4]))}}function mr(rt){Fi[rt?"unshift":"push"](()=>{A=rt,n(1,A)})}return e.$$set=rt=>{"map"in rt&&n(17,C=rt.map),"mapContainer"in rt&&n(1,A=rt.mapContainer),"class"in rt&&n(2,P=rt.class),"style"in rt&&n(18,k=rt.style),"diffStyleUpdates"in rt&&n(19,Y=rt.diffStyleUpdates),"center"in rt&&n(12,X=rt.center),"zoom"in rt&&n(13,lt=rt.zoom),"pitch"in rt&&n(14,ht=rt.pitch),"bearing"in rt&&n(15,_t=rt.bearing),"bounds"in rt&&n(16,j=rt.bounds),"hash"in rt&&n(20,W=rt.hash),"updateHash"in rt&&n(21,st=rt.updateHash),"loaded"in rt&&n(0,gt=rt.loaded),"minZoom"in rt&&n(22,Lt=rt.minZoom),"maxZoom"in rt&&n(23,At=rt.maxZoom),"antialias"in rt&&n(24,Tt=rt.antialias),"zoomOnDoubleClick"in rt&&n(25,Vt=rt.zoomOnDoubleClick),"locale"in rt&&n(26,Yt=rt.locale),"interactive"in rt&&n(27,J=rt.interactive),"attributionControl"in rt&&n(28,Ut=rt.attributionControl),"cooperativeGestures"in rt&&n(29,te=rt.cooperativeGestures),"preserveDrawingBuffer"in rt&&n(30,le=rt.preserveDrawingBuffer),"maxBounds"in rt&&n(31,Xe=rt.maxBounds),"images"in rt&&n(32,De=rt.images),"standardControls"in rt&&n(3,ue=rt.standardControls),"filterLayers"in rt&&n(33,tn=rt.filterLayers),"transformRequest"in rt&&n(34,Ce=rt.transformRequest),"$$scope"in rt&&n(39,b=rt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&8&&n(7,r=typeof ue=="boolean"?void 0:ue),e.$$.dirty[0]&16&&n(17,C=c),e.$$.dirty[0]&786448|e.$$.dirty[1]&224&&c&&!gh(k,xn)){const rt=c.getStyle();if(Ze&&(vn=rt.layers.filter(xt=>!Ze.includes(xt.id))),Je){const xt=Object.keys(rt.sources).filter(ke=>!Je.includes(ke));zn={};for(const ke of xt)zn[ke]=rt.sources[ke]}n(38,xn=k),c.setStyle(k,{diff:Y}),Cs(we,f=new Set,f),n(35,on=new Set)}if(e.$$.dirty[0]&49|e.$$.dirty[1]&18&&gt&&c!=null&&c.loaded())for(let rt of De)!f.has(rt.id)&&!on.has(rt.id)&&!c.hasImage(rt.id)&&Cn(rt);if(e.$$.dirty[0]&32|e.$$.dirty[1]&2&&n(6,a=De.every(rt=>f.has(rt.id))),e.$$.dirty[0]&61456&&c){let rt={};X!=null&&!gh(X,c==null?void 0:c.getCenter())&&(rt.center=X),lt!=null&&!gh(lt,c==null?void 0:c.getZoom())&&(rt.zoom=lt),_t!=null&&!gh(_t,c==null?void 0:c.getBearing())&&(rt.bearing=_t),ht!=null&&!gh(ht,c==null?void 0:c.getPitch())&&(rt.pitch=ht),Object.keys(rt).length&&c.easeTo(rt)}e.$$.dirty[0]&65552&&j&&!gh(j,c==null?void 0:c.getBounds())&&(c==null||c.fitBounds(j)),e.$$.dirty[0]&33554448&&(Vt?c==null||c.doubleClickZoom.enable():c==null||c.doubleClickZoom.disable())},[gt,A,P,ue,c,f,a,r,Ie,we,en,Fn,X,lt,ht,_t,j,C,k,Y,W,st,Lt,At,Tt,Vt,Yt,J,Ut,te,le,Xe,De,tn,Ce,on,Ze,Je,xn,b,u,mr]}class B5 extends Lr{constructor(t){super(),Tr(this,t,F5,z5,Wn,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,antialias:24,zoomOnDoubleClick:25,locale:26,interactive:27,attributionControl:28,cooperativeGestures:29,preserveDrawingBuffer:30,maxBounds:31,images:32,standardControls:3,filterLayers:33,transformRequest:34},null,[-1,-1])}}var Qi=63710088e-1,m0={centimeters:Qi*100,centimetres:Qi*100,degrees:Qi/111325,feet:Qi*3.28084,inches:Qi*39.37,kilometers:Qi/1e3,kilometres:Qi/1e3,meters:Qi,metres:Qi,miles:Qi/1609.344,millimeters:Qi*1e3,millimetres:Qi*1e3,nauticalmiles:Qi/1852,radians:1,yards:Qi*1.0936},V5={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Qi,yards:1.0936133},I_={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Bs(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function U5(e,t,n){switch(e){case"Point":return Ro(t).geometry;case"LineString":return Is(t).geometry;case"Polygon":return g0(t).geometry;case"MultiPoint":return O2(t).geometry;case"MultiLineString":return N2(t).geometry;case"MultiPolygon":return z2(t).geometry;default:throw new Error(e+" is invalid")}}function Ro(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Zm(e[0])||!Zm(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return Bs(r,t,n)}function G5(e,t,n){return n===void 0&&(n={}),sc(e.map(function(r){return Ro(r,t)}),n)}function g0(e,t,n){n===void 0&&(n={});for(var r=0,a=e;r<a.length;r++){var c=a[r];if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var f=0;f<c[c.length-1].length;f++)if(c[c.length-1][f]!==c[0][f])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:e};return Bs(u,t,n)}function q5(e,t,n){return n===void 0&&(n={}),sc(e.map(function(r){return g0(r,t)}),n)}function Is(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:e};return Bs(r,t,n)}function j5(e,t,n){return n===void 0&&(n={}),sc(e.map(function(r){return Is(r,t)}),n)}function sc(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function N2(e,t,n){n===void 0&&(n={});var r={type:"MultiLineString",coordinates:e};return Bs(r,t,n)}function O2(e,t,n){n===void 0&&(n={});var r={type:"MultiPoint",coordinates:e};return Bs(r,t,n)}function z2(e,t,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:e};return Bs(r,t,n)}function W5(e,t,n){n===void 0&&(n={});var r={type:"GeometryCollection",geometries:e};return Bs(r,t,n)}function Z5(e,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n}function y0(e,t){t===void 0&&(t="kilometers");var n=m0[t];if(!n)throw new Error(t+" units is invalid");return e*n}function dg(e,t){t===void 0&&(t="kilometers");var n=m0[t];if(!n)throw new Error(t+" units is invalid");return e/n}function H5(e,t){return Of(dg(e,t))}function X5(e){var t=e%360;return t<0&&(t+=360),t}function Of(e){var t=e%(2*Math.PI);return t*180/Math.PI}function Es(e){var t=e%360;return t*Math.PI/180}function Y5(e,t,n){if(t===void 0&&(t="kilometers"),n===void 0&&(n="kilometers"),!(e>=0))throw new Error("length must be a positive number");return y0(dg(e,t),n)}function K5(e,t,n){if(t===void 0&&(t="meters"),n===void 0&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var r=I_[t];if(!r)throw new Error("invalid original units");var a=I_[n];if(!a)throw new Error("invalid final units");return e/r*a}function Zm(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function _0(e){return!!e&&e.constructor===Object}function J5(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!Zm(t))throw new Error("bbox must only contain numbers")})}function Q5(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}const $5=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:I_,bearingToAzimuth:X5,convertArea:K5,convertLength:Y5,degreesToRadians:Es,earthRadius:Qi,factors:m0,feature:Bs,featureCollection:sc,geometry:U5,geometryCollection:W5,isNumber:Zm,isObject:_0,lengthToDegrees:H5,lengthToRadians:dg,lineString:Is,lineStrings:j5,multiLineString:N2,multiPoint:O2,multiPolygon:z2,point:Ro,points:G5,polygon:g0,polygons:q5,radiansToDegrees:Of,radiansToLength:y0,round:Z5,unitsFactors:V5,validateBBox:J5,validateId:Q5},Symbol.toStringTag,{value:"Module"}));function zf(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Zh(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function F2(e,t,n){if(n===void 0&&(n={}),n.final===!0)return t3(e,t);var r=zf(e),a=zf(t),c=Es(r[0]),f=Es(a[0]),u=Es(r[1]),b=Es(a[1]),C=Math.sin(f-c)*Math.cos(b),A=Math.cos(u)*Math.sin(b)-Math.sin(u)*Math.cos(b)*Math.cos(f-c);return Of(Math.atan2(C,A))}function t3(e,t){var n=F2(t,e);return n=(n+180)%360,n}function af(e,t,n){n===void 0&&(n={});var r=zf(e),a=zf(t),c=Es(a[1]-r[1]),f=Es(a[0]-r[0]),u=Es(r[1]),b=Es(a[1]),C=Math.pow(Math.sin(c/2),2)+Math.pow(Math.sin(f/2),2)*Math.cos(u)*Math.cos(b);return y0(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)),n.units)}function ab(e,t,n,r){r===void 0&&(r={});var a=zf(e),c=Es(a[0]),f=Es(a[1]),u=Es(n),b=dg(t,r.units),C=Math.asin(Math.sin(f)*Math.cos(b)+Math.cos(f)*Math.sin(b)*Math.cos(u)),A=c+Math.atan2(Math.sin(u)*Math.sin(b)*Math.cos(f),Math.cos(b)-Math.sin(f)*Math.sin(C)),P=Of(A),k=Of(C);return Ro([P,k],r.properties)}function Kf(e,t,n){if(e!==null)for(var r,a,c,f,u,b,C,A=0,P=0,k,Y=e.type,X=Y==="FeatureCollection",lt=Y==="Feature",ht=X?e.features.length:1,_t=0;_t<ht;_t++){C=X?e.features[_t].geometry:lt?e.geometry:e,k=C?C.type==="GeometryCollection":!1,u=k?C.geometries.length:1;for(var j=0;j<u;j++){var W=0,st=0;if(f=k?C.geometries[j]:C,f!==null){b=f.coordinates;var gt=f.type;switch(A=n&&(gt==="Polygon"||gt==="MultiPolygon")?1:0,gt){case null:break;case"Point":if(t(b,P,_t,W,st)===!1)return!1;P++,W++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],P,_t,W,st)===!1)return!1;P++,gt==="MultiPoint"&&W++}gt==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],P,_t,W,st)===!1)return!1;P++}gt==="MultiLineString"&&W++,gt==="Polygon"&&st++}gt==="Polygon"&&W++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(st=0,a=0;a<b[r].length;a++){for(c=0;c<b[r][a].length-A;c++){if(t(b[r][a][c],P,_t,W,st)===!1)return!1;P++}st++}W++}break;case"GeometryCollection":for(r=0;r<f.geometries.length;r++)if(Kf(f.geometries[r],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function e3(e,t,n,r){var a=n;return Kf(e,function(c,f,u,b,C){f===0&&n===void 0?a=c:a=t(a,c,f,u,b,C)},r),a}function B2(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&t(e.features[n].properties,n)!==!1;n++);break;case"Feature":t(e.properties,0);break}}function n3(e,t,n){var r=n;return B2(e,function(a,c){c===0&&n===void 0?r=a:r=t(r,a,c)}),r}function Hm(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function r3(e,t,n){var r=n;return Hm(e,function(a,c){c===0&&n===void 0?r=a:r=t(r,a,c)}),r}function i3(e){var t=[];return Kf(e,function(n){t.push(n)}),t}function v0(e,t){var n,r,a,c,f,u,b,C,A,P,k=0,Y=e.type==="FeatureCollection",X=e.type==="Feature",lt=Y?e.features.length:1;for(n=0;n<lt;n++){for(u=Y?e.features[n].geometry:X?e.geometry:e,C=Y?e.features[n].properties:X?e.properties:{},A=Y?e.features[n].bbox:X?e.bbox:void 0,P=Y?e.features[n].id:X?e.id:void 0,b=u?u.type==="GeometryCollection":!1,f=b?u.geometries.length:1,a=0;a<f;a++){if(c=b?u.geometries[a]:u,c===null){if(t(null,k,C,A,P)===!1)return!1;continue}switch(c.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(c,k,C,A,P)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<c.geometries.length;r++)if(t(c.geometries[r],k,C,A,P)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}k++}}function o3(e,t,n){var r=n;return v0(e,function(a,c,f,u,b){c===0&&n===void 0?r=a:r=t(r,a,c,f,u,b)}),r}function tp(e,t){v0(e,function(n,r,a,c,f){var u=n===null?null:n.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return t(Bs(n,a,{bbox:c,id:f}),r,0)===!1?!1:void 0}var b;switch(u){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var C=0;C<n.coordinates.length;C++){var A=n.coordinates[C],P={type:b,coordinates:A};if(t(Bs(P,a),r,C)===!1)return!1}})}function s3(e,t,n){var r=n;return tp(e,function(a,c,f){c===0&&f===0&&n===void 0?r=a:r=t(r,a,c,f)}),r}function V2(e,t){tp(e,function(n,r,a){var c=0;if(n.geometry){var f=n.geometry.type;if(!(f==="Point"||f==="MultiPoint")){var u,b=0,C=0,A=0;if(Kf(n,function(P,k,Y,X,lt){if(u===void 0||r>b||X>C||lt>A){u=P,b=r,C=X,A=lt,c=0;return}var ht=Is([u,P],n.properties);if(t(ht,r,a,lt,c)===!1)return!1;c++,u=P})===!1)return!1}}})}function a3(e,t,n){var r=n,a=!1;return V2(e,function(c,f,u,b,C){a===!1&&n===void 0?r=c:r=t(r,c,f,u,b,C),a=!0}),r}function U2(e,t){if(!e)throw new Error("geojson is required");tp(e,function(n,r,a){if(n.geometry!==null){var c=n.geometry.type,f=n.geometry.coordinates;switch(c){case"LineString":if(t(n,r,a,0,0)===!1)return!1;break;case"Polygon":for(var u=0;u<f.length;u++)if(t(Is(f[u],n.properties),r,a,u)===!1)return!1;break}}})}function l3(e,t,n){var r=n;return U2(e,function(a,c,f,u){c===0&&n===void 0?r=a:r=t(r,a,c,f,u)}),r}function u3(e,t){if(t=t||{},!_0(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,a=t.geometryIndex||0,c=t.segmentIndex||0,f=t.properties,u;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),f=f||e.features[n].properties,u=e.features[n].geometry;break;case"Feature":f=f||e.properties,u=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=e;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var b=u.coordinates;switch(u.type){case"Point":case"MultiPoint":return null;case"LineString":return c<0&&(c=b.length+c-1),Is([b[c],b[c+1]],f,t);case"Polygon":return a<0&&(a=b.length+a),c<0&&(c=b[a].length+c-1),Is([b[a][c],b[a][c+1]],f,t);case"MultiLineString":return r<0&&(r=b.length+r),c<0&&(c=b[r].length+c-1),Is([b[r][c],b[r][c+1]],f,t);case"MultiPolygon":return r<0&&(r=b.length+r),a<0&&(a=b[r].length+a),c<0&&(c=b[r][a].length-c-1),Is([b[r][a][c],b[r][a][c+1]],f,t)}throw new Error("geojson is invalid")}function c3(e,t){if(t=t||{},!_0(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,a=t.geometryIndex||0,c=t.coordIndex||0,f=t.properties,u;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),f=f||e.features[n].properties,u=e.features[n].geometry;break;case"Feature":f=f||e.properties,u=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":u=e;break;default:throw new Error("geojson is invalid")}if(u===null)return null;var b=u.coordinates;switch(u.type){case"Point":return Ro(b,f,t);case"MultiPoint":return r<0&&(r=b.length+r),Ro(b[r],f,t);case"LineString":return c<0&&(c=b.length+c),Ro(b[c],f,t);case"Polygon":return a<0&&(a=b.length+a),c<0&&(c=b[a].length+c),Ro(b[a][c],f,t);case"MultiLineString":return r<0&&(r=b.length+r),c<0&&(c=b[r].length+c),Ro(b[r][c],f,t);case"MultiPolygon":return r<0&&(r=b.length+r),a<0&&(a=b[r].length+a),c<0&&(c=b[r][a].length-c),Ro(b[r][a][c],f,t)}throw new Error("geojson is invalid")}const h3=Object.freeze(Object.defineProperty({__proto__:null,coordAll:i3,coordEach:Kf,coordReduce:e3,featureEach:Hm,featureReduce:r3,findPoint:c3,findSegment:u3,flattenEach:tp,flattenReduce:s3,geomEach:v0,geomReduce:o3,lineEach:U2,lineReduce:l3,propEach:B2,propReduce:n3,segmentEach:V2,segmentReduce:a3},Symbol.toStringTag,{value:"Module"}));function lb(e){if(!e)throw new Error("geojson is required");var t=[];return tp(e,function(n){p3(n,t)}),sc(t)}function p3(e,t){var n=[],r=e.geometry;if(r!==null){switch(r.type){case"Polygon":n=Zh(r);break;case"LineString":n=[Zh(r)]}n.forEach(function(a){var c=f3(a,e.properties);c.forEach(function(f){f.id=t.length,t.push(f)})})}}function f3(e,t){var n=[];return e.reduce(function(r,a){var c=Is([r,a],t);return c.bbox=d3(r,a),n.push(c),a}),n}function d3(e,t){var n=e[0],r=e[1],a=t[0],c=t[1],f=n<a?n:a,u=r<c?r:c,b=n>a?n:a,C=r>c?r:c;return[f,u,b,C]}var x0={exports:{}},G2={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Bf,function(){function n(j,W,st,gt,Lt){(function At(Tt,Vt,Yt,J,Ut){for(;J>Yt;){if(J-Yt>600){var te=J-Yt+1,le=Vt-Yt+1,Xe=Math.log(te),De=.5*Math.exp(2*Xe/3),ue=.5*Math.sqrt(Xe*De*(te-De)/te)*(le-te/2<0?-1:1),tn=Math.max(Yt,Math.floor(Vt-le*De/te+ue)),Ce=Math.min(J,Math.floor(Vt+(te-le)*De/te+ue));At(Tt,Vt,tn,Ce,Ut)}var pe=Tt[Vt],Ie=Yt,we=J;for(r(Tt,Yt,Vt),Ut(Tt[J],pe)>0&&r(Tt,Yt,J);Ie<we;){for(r(Tt,Ie,we),Ie++,we--;Ut(Tt[Ie],pe)<0;)Ie++;for(;Ut(Tt[we],pe)>0;)we--}Ut(Tt[Yt],pe)===0?r(Tt,Yt,we):r(Tt,++we,J),we<=Vt&&(Yt=we+1),Vt<=we&&(J=we-1)}})(j,W,st||0,gt||j.length-1,Lt||a)}function r(j,W,st){var gt=j[W];j[W]=j[st],j[st]=gt}function a(j,W){return j<W?-1:j>W?1:0}var c=function(j){j===void 0&&(j=9),this._maxEntries=Math.max(4,j),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function f(j,W,st){if(!st)return W.indexOf(j);for(var gt=0;gt<W.length;gt++)if(st(j,W[gt]))return gt;return-1}function u(j,W){b(j,0,j.children.length,W,j)}function b(j,W,st,gt,Lt){Lt||(Lt=ht(null)),Lt.minX=1/0,Lt.minY=1/0,Lt.maxX=-1/0,Lt.maxY=-1/0;for(var At=W;At<st;At++){var Tt=j.children[At];C(Lt,j.leaf?gt(Tt):Tt)}return Lt}function C(j,W){return j.minX=Math.min(j.minX,W.minX),j.minY=Math.min(j.minY,W.minY),j.maxX=Math.max(j.maxX,W.maxX),j.maxY=Math.max(j.maxY,W.maxY),j}function A(j,W){return j.minX-W.minX}function P(j,W){return j.minY-W.minY}function k(j){return(j.maxX-j.minX)*(j.maxY-j.minY)}function Y(j){return j.maxX-j.minX+(j.maxY-j.minY)}function X(j,W){return j.minX<=W.minX&&j.minY<=W.minY&&W.maxX<=j.maxX&&W.maxY<=j.maxY}function lt(j,W){return W.minX<=j.maxX&&W.minY<=j.maxY&&W.maxX>=j.minX&&W.maxY>=j.minY}function ht(j){return{children:j,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function _t(j,W,st,gt,Lt){for(var At=[W,st];At.length;)if(!((st=At.pop())-(W=At.pop())<=gt)){var Tt=W+Math.ceil((st-W)/gt/2)*gt;n(j,Tt,W,st,Lt),At.push(W,Tt,Tt,st)}}return c.prototype.all=function(){return this._all(this.data,[])},c.prototype.search=function(j){var W=this.data,st=[];if(!lt(j,W))return st;for(var gt=this.toBBox,Lt=[];W;){for(var At=0;At<W.children.length;At++){var Tt=W.children[At],Vt=W.leaf?gt(Tt):Tt;lt(j,Vt)&&(W.leaf?st.push(Tt):X(j,Vt)?this._all(Tt,st):Lt.push(Tt))}W=Lt.pop()}return st},c.prototype.collides=function(j){var W=this.data;if(!lt(j,W))return!1;for(var st=[];W;){for(var gt=0;gt<W.children.length;gt++){var Lt=W.children[gt],At=W.leaf?this.toBBox(Lt):Lt;if(lt(j,At)){if(W.leaf||X(j,At))return!0;st.push(Lt)}}W=st.pop()}return!1},c.prototype.load=function(j){if(!j||!j.length)return this;if(j.length<this._minEntries){for(var W=0;W<j.length;W++)this.insert(j[W]);return this}var st=this._build(j.slice(),0,j.length-1,0);if(this.data.children.length)if(this.data.height===st.height)this._splitRoot(this.data,st);else{if(this.data.height<st.height){var gt=this.data;this.data=st,st=gt}this._insert(st,this.data.height-st.height-1,!0)}else this.data=st;return this},c.prototype.insert=function(j){return j&&this._insert(j,this.data.height-1),this},c.prototype.clear=function(){return this.data=ht([]),this},c.prototype.remove=function(j,W){if(!j)return this;for(var st,gt,Lt,At=this.data,Tt=this.toBBox(j),Vt=[],Yt=[];At||Vt.length;){if(At||(At=Vt.pop(),gt=Vt[Vt.length-1],st=Yt.pop(),Lt=!0),At.leaf){var J=f(j,At.children,W);if(J!==-1)return At.children.splice(J,1),Vt.push(At),this._condense(Vt),this}Lt||At.leaf||!X(At,Tt)?gt?(st++,At=gt.children[st],Lt=!1):At=null:(Vt.push(At),Yt.push(st),st=0,gt=At,At=At.children[0])}return this},c.prototype.toBBox=function(j){return j},c.prototype.compareMinX=function(j,W){return j.minX-W.minX},c.prototype.compareMinY=function(j,W){return j.minY-W.minY},c.prototype.toJSON=function(){return this.data},c.prototype.fromJSON=function(j){return this.data=j,this},c.prototype._all=function(j,W){for(var st=[];j;)j.leaf?W.push.apply(W,j.children):st.push.apply(st,j.children),j=st.pop();return W},c.prototype._build=function(j,W,st,gt){var Lt,At=st-W+1,Tt=this._maxEntries;if(At<=Tt)return u(Lt=ht(j.slice(W,st+1)),this.toBBox),Lt;gt||(gt=Math.ceil(Math.log(At)/Math.log(Tt)),Tt=Math.ceil(At/Math.pow(Tt,gt-1))),(Lt=ht([])).leaf=!1,Lt.height=gt;var Vt=Math.ceil(At/Tt),Yt=Vt*Math.ceil(Math.sqrt(Tt));_t(j,W,st,Yt,this.compareMinX);for(var J=W;J<=st;J+=Yt){var Ut=Math.min(J+Yt-1,st);_t(j,J,Ut,Vt,this.compareMinY);for(var te=J;te<=Ut;te+=Vt){var le=Math.min(te+Vt-1,Ut);Lt.children.push(this._build(j,te,le,gt-1))}}return u(Lt,this.toBBox),Lt},c.prototype._chooseSubtree=function(j,W,st,gt){for(;gt.push(W),!W.leaf&&gt.length-1!==st;){for(var Lt=1/0,At=1/0,Tt=void 0,Vt=0;Vt<W.children.length;Vt++){var Yt=W.children[Vt],J=k(Yt),Ut=(te=j,le=Yt,(Math.max(le.maxX,te.maxX)-Math.min(le.minX,te.minX))*(Math.max(le.maxY,te.maxY)-Math.min(le.minY,te.minY))-J);Ut<At?(At=Ut,Lt=J<Lt?J:Lt,Tt=Yt):Ut===At&&J<Lt&&(Lt=J,Tt=Yt)}W=Tt||W.children[0]}var te,le;return W},c.prototype._insert=function(j,W,st){var gt=st?j:this.toBBox(j),Lt=[],At=this._chooseSubtree(gt,this.data,W,Lt);for(At.children.push(j),C(At,gt);W>=0&&Lt[W].children.length>this._maxEntries;)this._split(Lt,W),W--;this._adjustParentBBoxes(gt,Lt,W)},c.prototype._split=function(j,W){var st=j[W],gt=st.children.length,Lt=this._minEntries;this._chooseSplitAxis(st,Lt,gt);var At=this._chooseSplitIndex(st,Lt,gt),Tt=ht(st.children.splice(At,st.children.length-At));Tt.height=st.height,Tt.leaf=st.leaf,u(st,this.toBBox),u(Tt,this.toBBox),W?j[W-1].children.push(Tt):this._splitRoot(st,Tt)},c.prototype._splitRoot=function(j,W){this.data=ht([j,W]),this.data.height=j.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},c.prototype._chooseSplitIndex=function(j,W,st){for(var gt,Lt,At,Tt,Vt,Yt,J,Ut=1/0,te=1/0,le=W;le<=st-W;le++){var Xe=b(j,0,le,this.toBBox),De=b(j,le,st,this.toBBox),ue=(Lt=Xe,At=De,Tt=void 0,Vt=void 0,Yt=void 0,J=void 0,Tt=Math.max(Lt.minX,At.minX),Vt=Math.max(Lt.minY,At.minY),Yt=Math.min(Lt.maxX,At.maxX),J=Math.min(Lt.maxY,At.maxY),Math.max(0,Yt-Tt)*Math.max(0,J-Vt)),tn=k(Xe)+k(De);ue<Ut?(Ut=ue,gt=le,te=tn<te?tn:te):ue===Ut&&tn<te&&(te=tn,gt=le)}return gt||st-W},c.prototype._chooseSplitAxis=function(j,W,st){var gt=j.leaf?this.compareMinX:A,Lt=j.leaf?this.compareMinY:P;this._allDistMargin(j,W,st,gt)<this._allDistMargin(j,W,st,Lt)&&j.children.sort(gt)},c.prototype._allDistMargin=function(j,W,st,gt){j.children.sort(gt);for(var Lt=this.toBBox,At=b(j,0,W,Lt),Tt=b(j,st-W,st,Lt),Vt=Y(At)+Y(Tt),Yt=W;Yt<st-W;Yt++){var J=j.children[Yt];C(At,j.leaf?Lt(J):J),Vt+=Y(At)}for(var Ut=st-W-1;Ut>=W;Ut--){var te=j.children[Ut];C(Tt,j.leaf?Lt(te):te),Vt+=Y(Tt)}return Vt},c.prototype._adjustParentBBoxes=function(j,W,st){for(var gt=st;gt>=0;gt--)C(W[gt],j)},c.prototype._condense=function(j){for(var W=j.length-1,st=void 0;W>=0;W--)j[W].children.length===0?W>0?(st=j[W-1].children).splice(st.indexOf(j[W]),1):this.clear():u(j[W],this.toBBox)},c})})(G2);var m3=G2.exports;const g3=Ym($5),y3=Ym(h3),_3=Ym(zA);var Aa=m3,q2=g3,j2=y3,yh=_3.default,v3=j2.featureEach;j2.coordEach;q2.polygon;var ub=q2.featureCollection;function W2(e){var t=new Aa(e);return t.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:yh(n),Aa.prototype.insert.call(this,n)},t.load=function(n){var r=[];return Array.isArray(n)?n.forEach(function(a){if(a.type!=="Feature")throw new Error("invalid features");a.bbox=a.bbox?a.bbox:yh(a),r.push(a)}):v3(n,function(a){if(a.type!=="Feature")throw new Error("invalid features");a.bbox=a.bbox?a.bbox:yh(a),r.push(a)}),Aa.prototype.load.call(this,r)},t.remove=function(n,r){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:yh(n),Aa.prototype.remove.call(this,n,r)},t.clear=function(){return Aa.prototype.clear.call(this)},t.search=function(n){var r=Aa.prototype.search.call(this,this.toBBox(n));return ub(r)},t.collides=function(n){return Aa.prototype.collides.call(this,this.toBBox(n))},t.all=function(){var n=Aa.prototype.all.call(this);return ub(n)},t.toJSON=function(){return Aa.prototype.toJSON.call(this)},t.fromJSON=function(n){return Aa.prototype.fromJSON.call(this,n)},t.toBBox=function(n){var r;if(n.bbox)r=n.bbox;else if(Array.isArray(n)&&n.length===4)r=n;else if(Array.isArray(n)&&n.length===6)r=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")r=yh(n);else if(n.type==="FeatureCollection")r=yh(n);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},t}x0.exports=W2;x0.exports.default=W2;var x3=x0.exports;const b3=P_(x3);function w3(e,t){var n={},r=[];if(e.type==="LineString"&&(e=Bs(e)),t.type==="LineString"&&(t=Bs(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var a=cb(e,t);return a&&r.push(a),sc(r)}var c=b3();return c.load(lb(t)),Hm(lb(e),function(f){Hm(c.search(f),function(u){var b=cb(f,u);if(b){var C=Zh(b).join(",");n[C]||(n[C]=!0,r.push(b))}})}),sc(r)}function cb(e,t){var n=Zh(e),r=Zh(t);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var a=n[0][0],c=n[0][1],f=n[1][0],u=n[1][1],b=r[0][0],C=r[0][1],A=r[1][0],P=r[1][1],k=(P-C)*(f-a)-(A-b)*(u-c),Y=(A-b)*(c-C)-(P-C)*(a-b),X=(f-a)*(c-C)-(u-c)*(a-b);if(k===0)return null;var lt=Y/k,ht=X/k;if(lt>=0&&lt<=1&&ht>=0&&ht<=1){var _t=a+lt*(f-a),j=c+lt*(u-c);return Ro([_t,j])}return null}function S3(e,t,n){n===void 0&&(n={});var r=Ro([1/0,1/0],{dist:1/0}),a=0;return tp(e,function(c){for(var f=Zh(c),u=0;u<f.length-1;u++){var b=Ro(f[u]);b.properties.dist=af(t,b,n);var C=Ro(f[u+1]);C.properties.dist=af(t,C,n);var A=af(b,C,n),P=Math.max(b.properties.dist,C.properties.dist),k=F2(b,C),Y=ab(t,P,k+90,n),X=ab(t,P,k-90,n),lt=w3(Is([Y.geometry.coordinates,X.geometry.coordinates]),Is([b.geometry.coordinates,C.geometry.coordinates])),ht=null;lt.features.length>0&&(ht=lt.features[0],ht.properties.dist=af(t,ht,n),ht.properties.location=a+af(b,ht,n)),b.properties.dist<r.properties.dist&&(r=b,r.properties.index=u,r.properties.location=a),C.properties.dist<r.properties.dist&&(r=C,r.properties.index=u+1,r.properties.location=a+A),ht&&ht.properties.dist<r.properties.dist&&(r=ht,r.properties.index=u),a+=A}}),r}const I3=["==",["geometry-type"],"Polygon"],E3=["==",["geometry-type"],"LineString"],C3=["==",["geometry-type"],"Point"];function Wy(e){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Z2(e)}}}function Z2(e){return[Math.round(e[0]*1e7)/1e7,Math.round(e[1]*1e7)/1e7]}const H2=go({type:"FeatureCollection",features:[]}),X2=go(0),T3=100;class L3{constructor(t){$r(this,"map");$r(this,"active");$r(this,"eventListenersSuccess");$r(this,"eventListenersUpdated");$r(this,"eventListenersFailure");$r(this,"points");$r(this,"cursor");$r(this,"hover");$r(this,"dragFrom");$r(this,"previousStates");$r(this,"onMouseMove",t=>{if(this.active&&!this.dragFrom)this.recalculateHovering(t);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-t.lngLat.lng,r=this.dragFrom[1]-t.lngLat.lat;for(let a of this.points)a[0]-=n,a[1]-=r}else this.points[this.hover]=t.lngLat.toArray();this.dragFrom=t.lngLat.toArray(),this.redraw()}});$r(this,"onClick",t=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(hb(this.points).forEach((r,a)=>{n.push([a+1,S3(r,this.cursor).properties.dist])}),n.sort((r,a)=>r[1]-a[1]),n.length>0){let r=n[0][0];this.points.splice(r,0,this.cursor.geometry.coordinates),this.hover=r}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(t))});$r(this,"onDoubleClick",t=>{this.active&&(t.preventDefault(),this.cursor=Wy(t.lngLat.toArray()),this.onClick(t),this.finish())});$r(this,"onMouseDown",t=>{this.active&&!this.dragFrom&&this.hover!=null&&(t.preventDefault(),this.cursor=null,this.dragFrom=t.lngLat.toArray(),this.beforeUpdate(),this.redraw())});$r(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});$r(this,"onKeypress",t=>{this.active&&(t.key=="Enter"?(t.stopPropagation(),this.finish()):t.key=="z"&&t.ctrlKey&&this.undo())});$r(this,"onKeyDown",t=>{this.active&&t.key=="Escape"&&(t.stopPropagation(),this.cancel())});this.map=t,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let t=this.polygonFeature();if(t)for(let n of this.eventListenersSuccess)n(t);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let t of this.eventListenersFailure)t();this.stop()}addEventListenerSuccess(t){this.eventListenersSuccess.push(t)}addEventListenerUpdated(t){this.eventListenersUpdated.push(t)}addEventListenerFailure(t){this.eventListenersFailure.push(t)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(t){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(t.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let t={type:"FeatureCollection",features:[]};this.points.forEach((a,c)=>{let f=Wy(a);f.properties.hover=this.hover==c,f.properties.idx=c,t.features.push(f)}),t.features=t.features.concat(hb(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",t.features.push(n)),H2.set(t);let r="crosshair";this.hover!=null&&(r=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=r,X2.set(this.previousStates.length)}pointsUpdated(){let t=this.polygonFeature();if(t)for(let n of this.eventListenersUpdated)n(t)}recalculateHovering(t){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(t.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=Wy(t.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let t=this.points.map(Z2),n=[JSON.parse(JSON.stringify(t))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>T3&&this.previousStates.shift()}}function hb(e){let t=[];for(let n=0;n<e.length-1;n++)t.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[n],e[n+1]]},properties:{}});return e.length>=3&&t.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[e.length-1],e[0]]},properties:{}}),t}function P3(e){let t,n,r;return{c(){t=Ir("Undo ("),n=Ir(e[1]),r=Ir(")")},m(a,c){Ve(a,t,c),Ve(a,n,c),Ve(a,r,c)},p(a,c){c&2&&xm(n,a[1])},d(a){a&&(Re(t),Re(n),Re(r))}}}function A3(e){let t;return{c(){t=Ir("Undo")},m(n,r){Ve(n,t,r)},p:Xr,d(n){n&&Re(t)}}}function M3(e){let t,n,r,a,c,f,u,b,C,A,P;function k(lt,ht){return lt[1]==0?A3:P3}let Y=k(e),X=Y(e);return{c(){t=Pe("div"),n=Pe("button"),n.textContent="Finish",r=pn(),a=Pe("button"),a.textContent="Cancel",c=pn(),f=Pe("button"),X.c(),b=pn(),C=Pe("ul"),C.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,f.disabled=u=e[1]==0,ff(t,"display","flex"),ff(t,"justify-content","space-between")},m(lt,ht){Ve(lt,t,ht),he(t,n),he(t,r),he(t,a),he(t,c),he(t,f),X.m(f,null),Ve(lt,b,ht),Ve(lt,C,ht),A||(P=[ei(n,"click",e[2]),ei(a,"click",e[3]),ei(f,"click",e[4])],A=!0)},p(lt,[ht]){Y===(Y=k(lt))&&X?X.p(lt,ht):(X.d(1),X=Y(lt),X&&(X.c(),X.m(f,null))),ht&2&&u!==(u=lt[1]==0)&&(f.disabled=u)},i:Xr,o:Xr,d(lt){lt&&(Re(t),Re(b),Re(C)),X.d(),A=!1,ls(P)}}}function D3(e,t,n){let r;qn(e,X2,b=>n(1,r=b));let{polygonTool:a}=t;const c=()=>a.finish(),f=()=>a.cancel(),u=()=>a.undo();return e.$$set=b=>{"polygonTool"in b&&n(0,a=b.polygonTool)},[a,r,c,f,u]}class k3 extends Lr{constructor(t){super(),Tr(this,t,D3,M3,Wn,{polygonTool:0})}}let R3=Date.now();function Jf(e){return`${e}-${R3++}`}const Y2=Symbol.for("svelte-maplibre");function N3(){return L_(Y2)}function pb(e){return{subscribe:e.subscribe}}function K2({key:e,setPopupTarget:t=!1,setCluster:n=!1,setMouseEvent:r=!1}){let a=N3(),c=go(null),f=pb(c),u={...a,[e]:pb(c)};if(t&&(u.popupTarget=f),r){let b=go(null);u.layerEvent=b,a.layerEvent=b}return n&&(u.cluster=go()),T_(Y2,u),{...a,self:c}}function O3(){return K2({key:"source",setCluster:!0})}function z3(e=!0){return K2({key:"layer",setPopupTarget:e,setMouseEvent:e})}function fb(e){let t;return n=>{if(n)for(let r in n){let a=t==null?void 0:t[r],c=n[r];a!==c&&e(r,c,a)}else if(t)for(let r in t)e(r,void 0,t[r]);t=n}}function F3(e,...t){let n=[e];for(let r of t)if(r)Array.isArray(r)&&r[0]===e?n.push(...r.slice(1)):n.push(r);else continue;if(n.length!==1)return n.length===2?n[1]:n}function B3(e){return e===!0?["has","point_count"]:e===!1?["!",["has","point_count"]]:void 0}function db(e){let t=e[0],n,r,a=mb(e);return{c(){a.c(),n=ma()},m(c,f){a.m(c,f),Ve(c,n,f),r=!0},p(c,f){f[0]&1&&Wn(t,t=c[0])?(xi(),se(a,1,1,Xr),bi(),a=mb(c),a.c(),Zt(a,1),a.m(n.parentNode,n)):a.p(c,f)},i(c){r||(Zt(a),r=!0)},o(c){se(a),r=!1},d(c){c&&Re(n),a.d(c)}}}function mb(e){let t;const n=e[36].default,r=vo(n,e,e[35],null);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c[1]&16)&&bo(r,n,a,a[35],t?xo(n,a[35],c,null):wo(a[35]),null)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function V3(e){let t,n,r=e[0]&&db(e);return{c(){r&&r.c(),t=ma()},m(a,c){r&&r.m(a,c),Ve(a,t,c),n=!0},p(a,c){a[0]?r?(r.p(a,c),c[0]&1&&Zt(r,1)):(r=db(a),r.c(),Zt(r,1),r.m(t.parentNode,t)):r&&(xi(),se(r,1,1,()=>{r=null}),bi())},i(a){n||(Zt(r),n=!0)},o(a){se(r),n=!1},d(a){a&&Re(t),r&&r.d(a)}}}function U3(e,t,n){let r,a,c,f,u,b,C,A,P,k,Y,X,{$$slots:lt={},$$scope:ht}=t,{id:_t=Jf("layer")}=t,{source:j=void 0}=t,{sourceLayer:W=void 0}=t,{beforeId:st=void 0}=t,{beforeLayerType:gt=void 0}=t,{type:Lt}=t,{paint:At=void 0}=t,{layout:Tt=void 0}=t,{filter:Vt=void 0}=t,{applyToClusters:Yt=void 0}=t,{minzoom:J=void 0}=t,{maxzoom:Ut=void 0}=t,{manageHoverState:te=!1}=t,{hovered:le=null}=t,{interactive:Xe=!0}=t,{hoverCursor:De=void 0}=t,{eventsIfTopMost:ue=!1}=t;const tn=Xm(),{map:Ce,source:pe,self:Ie,minzoom:we,maxzoom:on,eventTopMost:Cn,layerInfo:Ze}=z3();qn(e,Ce,rt=>n(31,P=rt)),qn(e,pe,rt=>n(32,k=rt)),qn(e,Ie,rt=>n(0,A=rt)),qn(e,we,rt=>n(34,X=rt)),qn(e,on,rt=>n(33,Y=rt)),oa(()=>{A&&P&&(Ze.delete(A),P==null||P.removeLayer(A))});let Je;function vn(rt){var Ct,$n;if(!Xe||!A||!P||ue&&Cn(rt)!==A)return;let xt=rt.features??[],ke=($n=(Ct=xt[0])==null?void 0:Ct.properties)==null?void 0:$n.cluster_id,cn={event:rt,map:P,clusterId:ke,layer:A,source:u,features:xt};tn(rt.type,cn)}function zn(rt){var Ct,$n;if(!Xe||!A||!P||ue&&Cn(rt)!==A)return;De&&(P.getCanvas().style.cursor=De);let xt=rt.features??[];n(6,le=xt[0]??null);let ke=($n=(Ct=xt[0])==null?void 0:Ct.properties)==null?void 0:$n.cluster_id;tn("mouseenter",{event:rt,map:P,clusterId:ke,layer:A,source:u,features:xt})}function en(rt){var Ct,$n,qo;if(!Xe||!P)return;if(ue&&Cn(rt)!==A){n(6,le=null),te&&Je!==void 0&&(P==null||P.setFeatureState({source:u,sourceLayer:W,id:Je},{hover:!1}),Je=void 0);return}P.getCanvas().style.cursor=De;let xt=rt.features??[],ke=($n=(Ct=xt[0])==null?void 0:Ct.properties)==null?void 0:$n.cluster_id,cn=(qo=xt[0])==null?void 0:qo.id;cn!==Je&&(te&&(Je!==void 0&&(P==null||P.setFeatureState({source:u,id:Je,sourceLayer:W},{hover:!1})),P==null||P.setFeatureState({source:u,id:cn,sourceLayer:W},{hover:!0})),Je=cn,n(6,le=xt[0]??null)),tn("mousemove",{event:rt,map:P,clusterId:ke,layer:A,source:u,features:xt})}function xn(rt){if(!(!Xe||!A||!P)){if(De&&(P.getCanvas().style.cursor=""),n(6,le=null),te&&Je!==void 0){const xt={source:u,id:Je,sourceLayer:W};P==null||P.setFeatureState(xt,{hover:!1}),Je=void 0}tn("mouseleave",{map:P,layer:A,source:u})}}let Fn=!0;function mr(rt){P&&(P.off("click",rt,vn),P.off("dblclick",rt,vn),P.off("contextmenu",rt,vn),P.off("mouseenter",rt,zn),P.off("mousemove",rt,en),P.off("mouseleave",rt,xn))}return oa(()=>{P&&A&&mr(A)}),e.$$set=rt=>{"id"in rt&&n(7,_t=rt.id),"source"in rt&&n(8,j=rt.source),"sourceLayer"in rt&&n(9,W=rt.sourceLayer),"beforeId"in rt&&n(10,st=rt.beforeId),"beforeLayerType"in rt&&n(11,gt=rt.beforeLayerType),"type"in rt&&n(12,Lt=rt.type),"paint"in rt&&n(13,At=rt.paint),"layout"in rt&&n(14,Tt=rt.layout),"filter"in rt&&n(15,Vt=rt.filter),"applyToClusters"in rt&&n(16,Yt=rt.applyToClusters),"minzoom"in rt&&n(17,J=rt.minzoom),"maxzoom"in rt&&n(18,Ut=rt.maxzoom),"manageHoverState"in rt&&n(19,te=rt.manageHoverState),"hovered"in rt&&n(6,le=rt.hovered),"interactive"in rt&&n(20,Xe=rt.interactive),"hoverCursor"in rt&&n(21,De=rt.hoverCursor),"eventsIfTopMost"in rt&&n(22,ue=rt.eventsIfTopMost),"$$scope"in rt&&n(35,ht=rt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&65536&&n(30,r=B3(Yt)),e.$$.dirty[0]&1073774592&&n(24,a=F3("all",r,Vt)),e.$$.dirty[0]&131072|e.$$.dirty[1]&8&&n(26,c=J??X),e.$$.dirty[0]&262144|e.$$.dirty[1]&4&&n(25,f=Ut??Y),e.$$.dirty[0]&256|e.$$.dirty[1]&2&&n(29,u=j||k),e.$$.dirty[0]&654343809|e.$$.dirty[1]&1&&P&&A!==_t&&u){A&&(mr(A),Ze.delete(A));let rt=st;if(!st&&gt){let xt=P.getStyle().layers,ke=typeof gt=="function"?gt:Ct=>Ct.type===gt,cn=xt==null?void 0:xt.find(ke);cn&&(rt=cn.id)}Cs(Ie,A=_t,A),P.addLayer(oc({id:A,type:Lt,source:u,"source-layer":W,filter:a,paint:At,layout:Tt,minzoom:c,maxzoom:f}),rt),n(23,Fn=!0),P.on("click",A,vn),P.on("dblclick",A,vn),P.on("contextmenu",A,vn),P.on("mouseenter",A,zn),P.on("mousemove",A,en),P.on("mouseleave",A,xn)}e.$$.dirty[0]&1048577&&A&&Ze.set(A,{interactive:Xe}),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(28,b=A?fb((rt,xt)=>P==null?void 0:P.setPaintProperty(A,rt,xt)):void 0),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(27,C=A?fb((rt,xt)=>P==null?void 0:P.setLayoutProperty(A,rt,xt)):void 0),e.$$.dirty[0]&268443648&&(b==null||b(At)),e.$$.dirty[0]&134234112&&(C==null||C(Tt)),e.$$.dirty[0]&100663297|e.$$.dirty[1]&1&&A&&(P==null||P.setLayerZoomRange(A,c,f)),e.$$.dirty[0]&25165825|e.$$.dirty[1]&1&&A&&(Fn?n(23,Fn=!1):P==null||P.setFilter(A,a))},[A,Ce,pe,Ie,we,on,le,_t,j,W,st,gt,Lt,At,Tt,Vt,Yt,J,Ut,te,Xe,De,ue,Fn,a,f,c,C,b,u,r,P,k,Y,X,ht,lt]}class b0 extends Lr{constructor(t){super(),Tr(this,t,U3,V3,Wn,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function G3(e){let t;const n=e[16].default,r=vo(n,e,e[24],null);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c&16777216)&&bo(r,n,a,a[24],t?xo(n,a[24],c,null):wo(a[24]),null)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function q3(e){let t,n,r;function a(f){e[17](f)}let c={id:e[1],type:"circle",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],applyToClusters:e[9],minzoom:e[10],maxzoom:e[11],hoverCursor:e[12],manageHoverState:e[13],eventsIfTopMost:e[14],interactive:e[15],$$slots:{default:[G3]},$$scope:{ctx:e}};return e[0]!==void 0&&(c.hovered=e[0]),t=new b0({props:c}),Fi.push(()=>ta(t,"hovered",a)),t.$on("click",e[18]),t.$on("dblclick",e[19]),t.$on("contextmenu",e[20]),t.$on("mouseenter",e[21]),t.$on("mousemove",e[22]),t.$on("mouseleave",e[23]),{c(){En(t.$$.fragment)},m(f,u){wn(t,f,u),r=!0},p(f,[u]){const b={};u&2&&(b.id=f[1]),u&4&&(b.source=f[2]),u&8&&(b.sourceLayer=f[3]),u&16&&(b.beforeId=f[4]),u&32&&(b.beforeLayerType=f[5]),u&64&&(b.paint=f[6]),u&128&&(b.layout=f[7]),u&256&&(b.filter=f[8]),u&512&&(b.applyToClusters=f[9]),u&1024&&(b.minzoom=f[10]),u&2048&&(b.maxzoom=f[11]),u&4096&&(b.hoverCursor=f[12]),u&8192&&(b.manageHoverState=f[13]),u&16384&&(b.eventsIfTopMost=f[14]),u&32768&&(b.interactive=f[15]),u&16777216&&(b.$$scope={dirty:u,ctx:f}),!n&&u&1&&(n=!0,b.hovered=f[0],$s(()=>n=!1)),t.$set(b)},i(f){r||(Zt(t.$$.fragment,f),r=!0)},o(f){se(t.$$.fragment,f),r=!1},d(f){Sn(t,f)}}}function j3(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:c=Jf("circle")}=t,{source:f=void 0}=t,{sourceLayer:u=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:k=void 0}=t,{applyToClusters:Y=void 0}=t,{minzoom:X=void 0}=t,{maxzoom:lt=void 0}=t,{hoverCursor:ht=void 0}=t,{manageHoverState:_t=!1}=t,{hovered:j=null}=t,{eventsIfTopMost:W=!1}=t,{interactive:st=!0}=t;function gt(Ut){j=Ut,n(0,j)}function Lt(Ut){Rn.call(this,e,Ut)}function At(Ut){Rn.call(this,e,Ut)}function Tt(Ut){Rn.call(this,e,Ut)}function Vt(Ut){Rn.call(this,e,Ut)}function Yt(Ut){Rn.call(this,e,Ut)}function J(Ut){Rn.call(this,e,Ut)}return e.$$set=Ut=>{"id"in Ut&&n(1,c=Ut.id),"source"in Ut&&n(2,f=Ut.source),"sourceLayer"in Ut&&n(3,u=Ut.sourceLayer),"beforeId"in Ut&&n(4,b=Ut.beforeId),"beforeLayerType"in Ut&&n(5,C=Ut.beforeLayerType),"paint"in Ut&&n(6,A=Ut.paint),"layout"in Ut&&n(7,P=Ut.layout),"filter"in Ut&&n(8,k=Ut.filter),"applyToClusters"in Ut&&n(9,Y=Ut.applyToClusters),"minzoom"in Ut&&n(10,X=Ut.minzoom),"maxzoom"in Ut&&n(11,lt=Ut.maxzoom),"hoverCursor"in Ut&&n(12,ht=Ut.hoverCursor),"manageHoverState"in Ut&&n(13,_t=Ut.manageHoverState),"hovered"in Ut&&n(0,j=Ut.hovered),"eventsIfTopMost"in Ut&&n(14,W=Ut.eventsIfTopMost),"interactive"in Ut&&n(15,st=Ut.interactive),"$$scope"in Ut&&n(24,a=Ut.$$scope)},[j,c,f,u,b,C,A,P,k,Y,X,lt,ht,_t,W,st,r,gt,Lt,At,Tt,Vt,Yt,J,a]}class W3 extends Lr{constructor(t){super(),Tr(this,t,j3,q3,Wn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Z3(e){let t;const n=e[15].default,r=vo(n,e,e[23],null);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c&8388608)&&bo(r,n,a,a[23],t?xo(n,a[23],c,null):wo(a[23]),null)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function H3(e){let t,n,r;function a(f){e[16](f)}let c={id:e[1],type:"fill",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[Z3]},$$scope:{ctx:e}};return e[0]!==void 0&&(c.hovered=e[0]),t=new b0({props:c}),Fi.push(()=>ta(t,"hovered",a)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){En(t.$$.fragment)},m(f,u){wn(t,f,u),r=!0},p(f,[u]){const b={};u&2&&(b.id=f[1]),u&4&&(b.source=f[2]),u&8&&(b.sourceLayer=f[3]),u&16&&(b.beforeId=f[4]),u&32&&(b.beforeLayerType=f[5]),u&64&&(b.paint=f[6]),u&128&&(b.layout=f[7]),u&256&&(b.filter=f[8]),u&512&&(b.minzoom=f[9]),u&1024&&(b.maxzoom=f[10]),u&2048&&(b.hoverCursor=f[11]),u&4096&&(b.manageHoverState=f[12]),u&8192&&(b.eventsIfTopMost=f[13]),u&16384&&(b.interactive=f[14]),u&8388608&&(b.$$scope={dirty:u,ctx:f}),!n&&u&1&&(n=!0,b.hovered=f[0],$s(()=>n=!1)),t.$set(b)},i(f){r||(Zt(t.$$.fragment,f),r=!0)},o(f){se(t.$$.fragment,f),r=!1},d(f){Sn(t,f)}}}function X3(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:c=Jf("fill")}=t,{source:f=void 0}=t,{sourceLayer:u=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:k=void 0}=t,{minzoom:Y=void 0}=t,{maxzoom:X=void 0}=t,{hoverCursor:lt=void 0}=t,{manageHoverState:ht=!1}=t,{hovered:_t=null}=t,{eventsIfTopMost:j=!1}=t,{interactive:W=!0}=t;function st(J){_t=J,n(0,_t)}function gt(J){Rn.call(this,e,J)}function Lt(J){Rn.call(this,e,J)}function At(J){Rn.call(this,e,J)}function Tt(J){Rn.call(this,e,J)}function Vt(J){Rn.call(this,e,J)}function Yt(J){Rn.call(this,e,J)}return e.$$set=J=>{"id"in J&&n(1,c=J.id),"source"in J&&n(2,f=J.source),"sourceLayer"in J&&n(3,u=J.sourceLayer),"beforeId"in J&&n(4,b=J.beforeId),"beforeLayerType"in J&&n(5,C=J.beforeLayerType),"paint"in J&&n(6,A=J.paint),"layout"in J&&n(7,P=J.layout),"filter"in J&&n(8,k=J.filter),"minzoom"in J&&n(9,Y=J.minzoom),"maxzoom"in J&&n(10,X=J.maxzoom),"hoverCursor"in J&&n(11,lt=J.hoverCursor),"manageHoverState"in J&&n(12,ht=J.manageHoverState),"hovered"in J&&n(0,_t=J.hovered),"eventsIfTopMost"in J&&n(13,j=J.eventsIfTopMost),"interactive"in J&&n(14,W=J.interactive),"$$scope"in J&&n(23,a=J.$$scope)},[_t,c,f,u,b,C,A,P,k,Y,X,lt,ht,j,W,r,st,gt,Lt,At,Tt,Vt,Yt,a]}class Y3 extends Lr{constructor(t){super(),Tr(this,t,X3,H3,Wn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function K3(e,t,n,r,a){let c=!1;e.getSource(t)&&(c=!0,e.removeSource(t));const f=()=>{r(t)&&(e.addSource(t,n),a())};if(c){const u=()=>{t&&(e.getSource(t)?setTimeout(u,1):f())};u()}else f()}function J3(e,t,n){Nb().then(()=>{let r=Ab(e);if(!r)return;r.getSource(t)===n&&r.removeSource(t)})}function gb(e){let t=e[0],n,r,a=yb(e);return{c(){a.c(),n=ma()},m(c,f){a.m(c,f),Ve(c,n,f),r=!0},p(c,f){f&1&&Wn(t,t=c[0])?(xi(),se(a,1,1,Xr),bi(),a=yb(c),a.c(),Zt(a,1),a.m(n.parentNode,n)):a.p(c,f)},i(c){r||(Zt(a),r=!0)},o(c){se(a),r=!1},d(c){c&&Re(n),a.d(c)}}}function yb(e){let t;const n=e[15].default,r=vo(n,e,e[14],null);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c&16384)&&bo(r,n,a,a[14],t?xo(n,a[14],c,null):wo(a[14]),null)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function Q3(e){let t,n,r=e[0]&&gb(e);return{c(){r&&r.c(),t=ma()},m(a,c){r&&r.m(a,c),Ve(a,t,c),n=!0},p(a,[c]){a[0]?r?(r.p(a,c),c&1&&Zt(r,1)):(r=gb(a),r.c(),Zt(r,1),r.m(t.parentNode,t)):r&&(xi(),se(r,1,1,()=>{r=null}),bi())},i(a){n||(Zt(r),n=!0)},o(a){se(r),n=!1},d(a){a&&Re(t),r&&r.d(a)}}}function $3(e,t,n){let r,a,c,{$$slots:f={},$$scope:u}=t,{id:b=Jf("geojson")}=t,{data:C}=t,{generateId:A=!1}=t,{promoteId:P=void 0}=t,{filter:k=void 0}=t,{lineMetrics:Y=void 0}=t,{cluster:X=void 0}=t;const{map:lt,cluster:ht,self:_t}=O3();qn(e,lt,st=>n(13,a=st)),qn(e,ht,st=>n(16,c=st)),qn(e,_t,st=>n(0,r=st));let j,W=!0;return oa(()=>{r&&j&&a&&(J3(lt,r,j),Cs(_t,r=null,r),n(11,j=void 0))}),e.$$set=st=>{"id"in st&&n(4,b=st.id),"data"in st&&n(5,C=st.data),"generateId"in st&&n(6,A=st.generateId),"promoteId"in st&&n(7,P=st.promoteId),"filter"in st&&n(8,k=st.filter),"lineMetrics"in st&&n(9,Y=st.lineMetrics),"cluster"in st&&n(10,X=st.cluster),"$$scope"in st&&n(14,u=st.$$scope)},e.$$.update=()=>{e.$$.dirty&1024&&Cs(ht,c=X,c),e.$$.dirty&12273&&a&&r!==b&&(Cs(_t,r=b,r),K3(a,r,oc({type:"geojson",data:C,filter:k,lineMetrics:Y,generateId:A,promoteId:P,cluster:!!X,clusterMinPoints:X==null?void 0:X.minPoints,clusterMaxZoom:X==null?void 0:X.maxZoom,clusterRadius:X==null?void 0:X.radius,clusterProperties:X==null?void 0:X.properties}),st=>a&&st===r,()=>{r&&(n(11,j=a==null?void 0:a.getSource(r)),n(12,W=!0))})),e.$$.dirty&8208&&(a==null||a.on("style.load",()=>{n(11,j=a==null?void 0:a.getSource(b))})),e.$$.dirty&6176&&j&&(W?n(12,W=!1):j.setData(C)),e.$$.dirty&3072&&(j==null||j.setClusterOptions(oc({cluster:!!X,clusterMaxZoom:X==null?void 0:X.maxZoom,clusterRadius:X==null?void 0:X.radius})))},[r,lt,ht,_t,b,C,A,P,k,Y,X,j,W,a,u,f]}class t4 extends Lr{constructor(t){super(),Tr(this,t,$3,Q3,Wn,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function e4(e){let t;const n=e[15].default,r=vo(n,e,e[23],null);return{c(){r&&r.c()},m(a,c){r&&r.m(a,c),t=!0},p(a,c){r&&r.p&&(!t||c&8388608)&&bo(r,n,a,a[23],t?xo(n,a[23],c,null):wo(a[23]),null)},i(a){t||(Zt(r,a),t=!0)},o(a){se(r,a),t=!1},d(a){r&&r.d(a)}}}function n4(e){let t,n,r;function a(f){e[16](f)}let c={id:e[1],type:"line",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[e4]},$$scope:{ctx:e}};return e[0]!==void 0&&(c.hovered=e[0]),t=new b0({props:c}),Fi.push(()=>ta(t,"hovered",a)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){En(t.$$.fragment)},m(f,u){wn(t,f,u),r=!0},p(f,[u]){const b={};u&2&&(b.id=f[1]),u&4&&(b.source=f[2]),u&8&&(b.sourceLayer=f[3]),u&16&&(b.beforeId=f[4]),u&32&&(b.beforeLayerType=f[5]),u&64&&(b.paint=f[6]),u&128&&(b.layout=f[7]),u&256&&(b.filter=f[8]),u&512&&(b.minzoom=f[9]),u&1024&&(b.maxzoom=f[10]),u&2048&&(b.hoverCursor=f[11]),u&4096&&(b.manageHoverState=f[12]),u&8192&&(b.eventsIfTopMost=f[13]),u&16384&&(b.interactive=f[14]),u&8388608&&(b.$$scope={dirty:u,ctx:f}),!n&&u&1&&(n=!0,b.hovered=f[0],$s(()=>n=!1)),t.$set(b)},i(f){r||(Zt(t.$$.fragment,f),r=!0)},o(f){se(t.$$.fragment,f),r=!1},d(f){Sn(t,f)}}}function r4(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:c=Jf("line")}=t,{source:f=void 0}=t,{sourceLayer:u=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:k=void 0}=t,{minzoom:Y=void 0}=t,{maxzoom:X=void 0}=t,{hoverCursor:lt=void 0}=t,{manageHoverState:ht=!1}=t,{hovered:_t=null}=t,{eventsIfTopMost:j=!1}=t,{interactive:W=!0}=t;function st(J){_t=J,n(0,_t)}function gt(J){Rn.call(this,e,J)}function Lt(J){Rn.call(this,e,J)}function At(J){Rn.call(this,e,J)}function Tt(J){Rn.call(this,e,J)}function Vt(J){Rn.call(this,e,J)}function Yt(J){Rn.call(this,e,J)}return e.$$set=J=>{"id"in J&&n(1,c=J.id),"source"in J&&n(2,f=J.source),"sourceLayer"in J&&n(3,u=J.sourceLayer),"beforeId"in J&&n(4,b=J.beforeId),"beforeLayerType"in J&&n(5,C=J.beforeLayerType),"paint"in J&&n(6,A=J.paint),"layout"in J&&n(7,P=J.layout),"filter"in J&&n(8,k=J.filter),"minzoom"in J&&n(9,Y=J.minzoom),"maxzoom"in J&&n(10,X=J.maxzoom),"hoverCursor"in J&&n(11,lt=J.hoverCursor),"manageHoverState"in J&&n(12,ht=J.manageHoverState),"hovered"in J&&n(0,_t=J.hovered),"eventsIfTopMost"in J&&n(13,j=J.eventsIfTopMost),"interactive"in J&&n(14,W=J.interactive),"$$scope"in J&&n(23,a=J.$$scope)},[_t,c,f,u,b,C,A,P,k,Y,X,lt,ht,j,W,r,st,gt,Lt,At,Tt,Vt,Yt,a]}class i4 extends Lr{constructor(t){super(),Tr(this,t,r4,n4,Wn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function o4(e){let t,n,r,a,c,f;return t=new Y3({props:{id:"edit-polygon-fill",filter:I3,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),r=new i4({props:{id:"edit-polygon-lines",filter:E3,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),c=new W3({props:{id:"edit-polygon-vertices",filter:C3,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){En(t.$$.fragment),n=pn(),En(r.$$.fragment),a=pn(),En(c.$$.fragment)},m(u,b){wn(t,u,b),Ve(u,n,b),wn(r,u,b),Ve(u,a,b),wn(c,u,b),f=!0},p:Xr,i(u){f||(Zt(t.$$.fragment,u),Zt(r.$$.fragment,u),Zt(c.$$.fragment,u),f=!0)},o(u){se(t.$$.fragment,u),se(r.$$.fragment,u),se(c.$$.fragment,u),f=!1},d(u){u&&(Re(n),Re(a)),Sn(t,u),Sn(r,u),Sn(c,u)}}}function s4(e){let t,n;return t=new t4({props:{data:e[0],$$slots:{default:[o4]},$$scope:{ctx:e}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,[a]){const c={};a&1&&(c.data=r[0]),a&2&&(c.$$scope={dirty:a,ctx:r}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function a4(e,t,n){let r;return qn(e,H2,a=>n(0,r=a)),[r]}class l4 extends Lr{constructor(t){super(),Tr(this,t,a4,s4,Wn,{})}}function u4(e){let t,n,r,a,c,f,u,b,C;return{c(){t=Pe("label"),n=Pe("input"),r=pn(),a=Ir(e[1]),c=pn(),f=Pe("input"),cr(n,"type","checkbox"),cr(f,"type","number"),f.disabled=u=!e[2]},m(A,P){Ve(A,t,P),he(t,n),n.checked=e[2],he(t,r),he(t,a),he(t,c),he(t,f),bm(f,e[0]),b||(C=[ei(n,"change",e[4]),ei(f,"input",e[5])],b=!0)},p(A,[P]){P&4&&(n.checked=A[2]),P&2&&xm(a,A[1]),P&4&&u!==(u=!A[2])&&(f.disabled=u),P&1&&Db(f.value)!==A[0]&&bm(f,A[0])},i:Xr,o:Xr,d(A){A&&Re(t),b=!1,ls(C)}}}function c4(e,t,n){let{label:r}=t,{value:a}=t,{defaultNumber:c}=t,f=a!=null;function u(){f=this.checked,n(2,f)}function b(){a=Db(this.value),n(0,a),n(2,f),n(3,c)}return e.$$set=C=>{"label"in C&&n(1,r=C.label),"value"in C&&n(0,a=C.value),"defaultNumber"in C&&n(3,c=C.defaultNumber)},e.$$.update=()=>{e.$$.dirty&13&&(f&&a==null?n(0,a=c):f||n(0,a=void 0))},[a,r,f,c,u,b]}class am extends Lr{constructor(t){super(),Tr(this,t,c4,u4,Wn,{label:1,value:0,defaultNumber:3})}}function h4(e){let t,n,r,a,c,f,u,b,C,A,P,k,Y,X,lt,ht,_t,j,W,st,gt,Lt,At,Tt,Vt,Yt,J;function Ut(pe){e[1](pe)}let te={label:"Remove holes in input polygons larger than this area (sq m)",defaultNumber:100};e[0].remove_holes!==void 0&&(te.value=e[0].remove_holes),a=new am({props:te}),Fi.push(()=>ta(a,"value",Ut));function le(pe){e[3](pe)}let Xe={label:"Filter skeleton lines closer than this to the boundary (m)",defaultNumber:.1};e[0].filter_skeletons_near_boundary!==void 0&&(Xe.value=e[0].filter_skeletons_near_boundary),k=new am({props:Xe}),Fi.push(()=>ta(k,"value",le));function De(pe){e[5](pe)}let ue={label:"Remove short skeleton lines less than this ratio (to the longest)",defaultNumber:.1};e[0].remove_short_skeletons!==void 0&&(ue.value=e[0].remove_short_skeletons),st=new am({props:ue}),Fi.push(()=>ta(st,"value",De));function tn(pe){e[6](pe)}let Ce={label:"Generate perpendicular lines at this step size (m)",defaultNumber:5};return e[0].make_perps_step_size!==void 0&&(Ce.value=e[0].make_perps_step_size),At=new am({props:Ce}),Fi.push(()=>ta(At,"value",tn)),{c(){t=Pe("details"),n=Pe("summary"),n.textContent="Config",r=pn(),En(a.$$.fragment),f=pn(),u=Pe("div"),b=Pe("label"),C=Pe("input"),A=Ir(`
      Filter skeleton lines outside polygon`),P=pn(),En(k.$$.fragment),X=pn(),lt=Pe("div"),ht=Pe("label"),_t=Pe("input"),j=Ir(`
      Join skeleton lines`),W=pn(),En(st.$$.fragment),Lt=pn(),En(At.$$.fragment),cr(C,"type","checkbox"),cr(_t,"type","checkbox"),t.open=!0,cr(t,"class","svelte-eu3ecd")},m(pe,Ie){Ve(pe,t,Ie),he(t,n),he(t,r),wn(a,t,null),he(t,f),he(t,u),he(u,b),he(b,C),C.checked=e[0].filter_skeletons_outside,he(b,A),he(t,P),wn(k,t,null),he(t,X),he(t,lt),he(lt,ht),he(ht,_t),_t.checked=e[0].join_skeletons,he(ht,j),he(t,W),wn(st,t,null),he(t,Lt),wn(At,t,null),Vt=!0,Yt||(J=[ei(C,"change",e[2]),ei(_t,"change",e[4])],Yt=!0)},p(pe,[Ie]){const we={};!c&&Ie&1&&(c=!0,we.value=pe[0].remove_holes,$s(()=>c=!1)),a.$set(we),Ie&1&&(C.checked=pe[0].filter_skeletons_outside);const on={};!Y&&Ie&1&&(Y=!0,on.value=pe[0].filter_skeletons_near_boundary,$s(()=>Y=!1)),k.$set(on),Ie&1&&(_t.checked=pe[0].join_skeletons);const Cn={};!gt&&Ie&1&&(gt=!0,Cn.value=pe[0].remove_short_skeletons,$s(()=>gt=!1)),st.$set(Cn);const Ze={};!Tt&&Ie&1&&(Tt=!0,Ze.value=pe[0].make_perps_step_size,$s(()=>Tt=!1)),At.$set(Ze)},i(pe){Vt||(Zt(a.$$.fragment,pe),Zt(k.$$.fragment,pe),Zt(st.$$.fragment,pe),Zt(At.$$.fragment,pe),Vt=!0)},o(pe){se(a.$$.fragment,pe),se(k.$$.fragment,pe),se(st.$$.fragment,pe),se(At.$$.fragment,pe),Vt=!1},d(pe){pe&&Re(t),Sn(a),Sn(k),Sn(st),Sn(At),Yt=!1,ls(J)}}}function p4(e,t,n){let{cfg:r}=t;function a(A){e.$$.not_equal(r.remove_holes,A)&&(r.remove_holes=A,n(0,r))}function c(){r.filter_skeletons_outside=this.checked,n(0,r)}function f(A){e.$$.not_equal(r.filter_skeletons_near_boundary,A)&&(r.filter_skeletons_near_boundary=A,n(0,r))}function u(){r.join_skeletons=this.checked,n(0,r)}function b(A){e.$$.not_equal(r.remove_short_skeletons,A)&&(r.remove_short_skeletons=A,n(0,r))}function C(A){e.$$.not_equal(r.make_perps_step_size,A)&&(r.make_perps_step_size=A,n(0,r))}return e.$$set=A=>{"cfg"in A&&n(0,r=A.cfg)},[r,a,c,f,u,b,C]}class f4 extends Lr{constructor(t){super(),Tr(this,t,p4,h4,Wn,{cfg:0})}}let E_={"just a rectangle":"POLYGON((-0.1008378 51.4893734,-0.099282 51.4898419,-0.0992257 51.4897652,-0.1007816 51.4893016,-0.1008378 51.4893734))","simple L":"POLYGON((-0.1021076 51.4896734,-0.1015438 51.489379,-0.10134 51.4895191,-0.101303 51.4894982,-0.1015399 51.4893283,-0.102142 51.4896457,-0.1021076 51.4896734))","many width changes":"POLYGON((-0.1018838 51.4895115,-0.1017193 51.4894192,-0.1016939 51.4894361,-0.1016541 51.4894124,-0.1016219 51.4894303,-0.1015788 51.489405,-0.1016067 51.4893771,-0.1014222 51.4892885,-0.1015086 51.4892326,-0.1016694 51.4893138,-0.1016423 51.4893317,-0.1016804 51.4893581,-0.1017074 51.4893381,-0.1018361 51.4894213,-0.1018818 51.4894061,-0.1019284 51.4894366,-0.1019038 51.4894609,-0.1019443 51.4894764,-0.1018838 51.4895115))","not many perp lines in result":"POLYGON((13.3562208 52.5297463,13.3560897 52.5299508,13.3569956 52.5304672,13.3562493 52.5304083,13.3558676 52.5300582,13.3555314 52.5296423,13.3562094 52.5294482,13.3568987 52.5294309,13.3577818 52.5295522,13.3583401 52.52993,13.3587674 52.5301692,13.3584882 52.5303771,13.3584939 52.5307341,13.3582318 52.5308485,13.3577989 52.5304568,13.3574285 52.5298918,13.3562208 52.5297463))","curvy L":"POLYGON((-0.1243813 51.50106430000000302,-0.12479800000000001 51.50107640000000231,-0.124885 51.5010789000000031,-0.12497220000000001 51.50108149999999796,-0.1253871 51.50109350000000319,-0.12541060000000001 51.50109570000000048,-0.12542239999999999 51.50110159999999837,-0.12542890000000001 51.50111030000000056,-0.12543509999999999 51.50112359999999967,-0.12545809999999999 51.50110420000000033,-0.12545709999999999 51.50107719999999745,-0.12545609999999999 51.5010667999999967,-0.12544810000000001 51.5010594000000026,-0.1254353 51.50105560000000082,-0.1246506 51.50103409999999826,-0.12443170000000001 51.50102569999999957,-0.12438639999999999 51.50102669999999705,-0.1243496 51.50103200000000214,-0.12431739999999999 51.50104309999999685,-0.12429270000000001 51.50105359999999877,-0.12426570000000001 51.50106999999999857,-0.1242398 51.50109479999999706,-0.1242162 51.50114039999999704,-0.1241848 51.50121070000000145,-0.1242273 51.50124189999999658,-0.124194 51.50146910000000133,-0.1241453 51.50149749999999926,-0.1241608 51.50152549999999962,-0.1242166 51.50152560000000079,-0.12429419999999999 51.50152539999999846,-0.1243064 51.50136369999999886,-0.1243146 51.50125529999999685,-0.12432699999999999 51.50109170000000347,-0.124332 51.50107959999999707,-0.12434290000000001 51.50107030000000208,-0.12435839999999999 51.50106569999999806,-0.1243813 51.50106430000000302))","long T":"POLYGON((-0.1260973 51.5058446000000032,-0.12657669999999999 51.50572009999999779,-0.12660589999999999 51.50571370000000115,-0.1266294 51.50571430000000106,-0.12665290000000001 51.50571970000000022,-0.12668209999999999 51.50573920000000072,-0.12663720000000001 51.50564150000000296,-0.12659709999999999 51.50555210000000272,-0.12659200000000001 51.50557280000000304,-0.1265868 51.50558379999999659,-0.12657009999999999 51.50560089999999747,-0.12652959999999999 51.50562939999999656,-0.12645680000000001 51.50565790000000277,-0.12637019999999999 51.50568280000000243,-0.124559 51.50615839999999679,-0.1245126 51.50616699999999781,-0.1244765 51.50617210000000057,-0.1244473 51.506171700000003,-0.1244131 51.506165799999998,-0.124389 51.50615549999999843,-0.1243693 51.50613859999999988,-0.1243541 51.50611800000000073,-0.1243522 51.50609990000000238,-0.12437719999999999 51.50603350000000091,-0.1244817 51.50577839999999696,-0.1247093 51.50522269999999736,-0.1247944 51.50521030000000167,-0.1247582 51.5052012000000019,-0.12474109999999999 51.5051910000000035,-0.1247341 51.50517750000000206,-0.12473919999999999 51.50515980000000127,-0.1247856 51.50510289999999713,-0.1247409 51.5050965000000005,-0.12468310000000001 51.50508820000000298,-0.1246582 51.50514559999999875,-0.12468319999999999 51.50514960000000286,-0.12442640000000001 51.50576829999999973,-0.1243972 51.50583859999999703,-0.1243731 51.50583389999999895,-0.1242501 51.50613150000000218,-0.12421840000000001 51.50619970000000336,-0.12420639999999999 51.50622260000000097,-0.1241867 51.50624040000000292,-0.1241601 51.50625649999999922,-0.12413730000000001 51.50626439999999917,-0.1241252 51.50626760000000104,-0.1240834 51.50625930000000352,-0.1236097 51.5063847999999993,-0.1236232 51.50640489999999971,-0.1236227 51.50641130000000345,-0.1236408 51.50643889999999914,-0.1236559 51.50646179999999674,-0.12366489999999999 51.50646600000000319,-0.1236685 51.50646929999999912,-0.1236752 51.50647740000000141,-0.12368460000000001 51.5064801999999986,-0.1236993 51.50647850000000005,-0.12549199999999999 51.50601300000000293,-0.1255077 51.50601460000000031,-0.12551889999999999 51.50602099999999695,-0.12552430000000001 51.50603050000000138,-0.12559310000000001 51.5060128000000006,-0.12560540000000001 51.50600959999999873,-0.1256023 51.5060001000000014,-0.12560499999999999 51.50598759999999743,-0.125613 51.50597719999999669,-0.1256225 51.50597049999999655,-0.12562889999999999 51.50596790000000169,-0.1259643 51.50588599999999673,-0.12598429999999999 51.50586229999999688,-0.12606410000000001 51.50584039999999675,-0.1260973 51.5058446000000032))","complex loop":"POLYGON((13.37066169999999943 52.52428640000000115,13.37065879999999929 52.52477549999999695,13.3706517999999992 52.52570510000000326,13.37065049999999999 52.52577130000000238,13.37064699999999995 52.52577709999999911,13.37064080000000033 52.52578079999999972,13.37063110000000066 52.52578309999999817,13.37061910000000076 52.52578390000000041,13.3703328999999993 52.52578319999999934,13.37032950000000042 52.52577449999999715,13.37032969999999921 52.52576140000000038,13.37043710000000019 52.52576200000000028,13.3704376000000007 52.52572750000000212,13.37005229999999933 52.52572550000000007,13.37005169999999943 52.52576239999999785,13.37022559999999949 52.52576330000000127,13.3702255000000001 52.52577399999999841,13.37021969999999982 52.525782999999997,13.36828670000000052 52.52577120000000122,13.36826390000000053 52.52576830000000285,13.36824660000000087 52.52576100000000281,13.36823719999999938 52.52574839999999767,13.36823590000000017 52.52573370000000352,13.36823730000000054 52.525621000000001,13.36825750000000035 52.52562110000000217,13.3682692000000003 52.52562050000000227,13.36827730000000081 52.52561670000000049,13.36828260000000057 52.52561039999999792,13.3682824999999994 52.52560220000000157,13.36828670000000052 52.52521670000000142,13.3682856000000001 52.52521089999999759,13.36828019999999917 52.52520609999999834,13.36827489999999941 52.52520340000000232,13.36826650000000072 52.52520220000000251,13.36823919999999966 52.525201899999999,13.36824350000000017 52.52425300000000163,13.36824359999999956 52.52423960000000136,13.36824440000000003 52.524230799999998,13.36824930000000045 52.52422440000000137,13.36826720000000002 52.52421819999999997,13.36830529999999939 52.52421760000000006,13.37063009999999963 52.52422640000000342,13.37065029999999943 52.52422680000000099,13.37066000000000088 52.524230799999998,13.37066489999999952 52.52423819999999921,13.37066169999999943 52.52428640000000115),(13.37062449999999991 52.52428900000000311,13.37045250000000074 52.52429289999999895,13.37029519999999927 52.52429469999999867,13.37028849999999913 52.52429300000000012,13.37023789999999934 52.52436529999999948,13.36991229999999931 52.52436569999999705,13.36991070000000015 52.52436689999999686,13.36973790000000051 52.52436600000000055,13.36972029999999911 52.52436610000000172,13.36970320000000001 52.52436610000000172,13.3696868000000002 52.52436610000000172,13.36966920000000059 52.52436610000000172,13.36965179999999975 52.52436620000000289,13.36963420000000013 52.52436620000000289,13.36961709999999925 52.52436620000000289,13.36958470000000077 52.52436629999999695,13.3695877000000003 52.52436209999999761,13.36958100000000016 52.52436029999999789,13.36962899999999976 52.52429240000000021,13.36929310000000015 52.52429200000000264,13.36928799999999917 52.52429959999999909,13.36927140000000058 52.52432389999999884,13.36912519999999915 52.52432379999999768,13.36908039999999964 52.52432379999999768,13.36900409999999972 52.52432389999999884,13.36892819999999915 52.52432400000000001,13.36835690000000021 52.52432089999999931,13.36834799999999923 52.52562429999999694,13.36834559999999961 52.52565030000000235,13.36829110000000043 52.5257284999999996,13.36859150000000085 52.52573180000000264,13.36860719999999958 52.52571009999999774,13.36869699999999916 52.52558520000000186,13.36934220000000018 52.52568819999999761,13.36931719999999935 52.52572609999999997,13.36941140000000061 52.52572529999999773,13.3695567000000004 52.52572419999999909,13.36961980000000061 52.52572500000000133,13.36983350000000037 52.52570740000000171,13.3699198999999993 52.52570730000000054,13.36998610000000021 52.52570759999999694,13.37055490000000013 52.52570630000000307,13.37056229999999957 52.5247286000000031,13.37056409999999929 52.52468470000000167,13.37057730000000078 52.52435299999999785,13.37062449999999991 52.52428900000000311))"},_b=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,vb=new RegExp("^"+_b.source+"(\\s"+_b.source+"){1,}");const d4=e=>{let t=e.split(";"),n=t.pop(),r=(t.shift()||"").split("=").pop(),a=0;function c(j){let W=n.substring(a).match(j);return W?(a+=W[0].length,W[0]):null}function f(j){return j&&r.match(/\d+/)&&(j.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+r}}),j}function u(){c(/^\s*/)}function b(){u();let j=0,W=[],st=[W],gt=W,Lt;for(;Lt=c(/^(\()/)||c(/^(\))/)||c(/^(,)/)||c(vb);){if(Lt==="(")st.push(gt),gt=[],st[st.length-1].push(gt),j++;else if(Lt===")"){if(gt.length===0||(gt=st.pop(),!gt))return null;if(j--,j===0)break}else if(Lt===",")gt=[],st[st.length-1].push(gt);else if(!Lt.split(/\s/g).some(isNaN))Array.prototype.push.apply(gt,Lt.split(/\s/g).map(parseFloat));else return null;u()}return j!==0?null:W}function C(){let j=[],W,st;for(;st=c(vb)||c(/^(,)/);)st===","?(j.push(W),W=[]):st.split(/\s/g).some(isNaN)||(W||(W=[]),Array.prototype.push.apply(W,st.split(/\s/g).map(parseFloat))),u();if(W)j.push(W);else return null;return j.length?j:null}function A(){if(!c(/^(point(\sz)?)/i)||(u(),!c(/^(\()/)))return null;let j=C();return!j||(u(),!c(/^(\))/))?null:{type:"Point",coordinates:j[0]}}function P(){if(!c(/^(multipoint(\sz)?)/i))return null;u(),n="MULTIPOINT ("+n.substring(n.indexOf("(")+1,n.length-1).replace(/\(/g,"").replace(/\)/g,"")+")";let W=b();return W?(u(),{type:"MultiPoint",coordinates:W}):null}function k(){if(!c(/^(multilinestring(\sz)?)/i))return null;u();let j=b();return j?(u(),{type:"MultiLineString",coordinates:j}):null}function Y(){if(!c(/^(linestring(\sz)?)/i)||(u(),!c(/^(\()/)))return null;let j=C();return!j||!c(/^(\))/)?null:{type:"LineString",coordinates:j}}function X(){if(!c(/^(polygon(\sz)?)/i))return null;u();let j=b();return j?{type:"Polygon",coordinates:j}:null}function lt(){if(!c(/^(multipolygon(\sz)?)/i))return null;u();let j=b();return j?{type:"MultiPolygon",coordinates:j}:null}function ht(){let j=[],W;if(!c(/^(geometrycollection)/i)||(u(),!c(/^(\()/)))return null;for(;W=_t();)j.push(W),u(),c(/^(,)/),u();return c(/^(\))/)?{type:"GeometryCollection",geometries:j}:null}function _t(){return A()||Y()||X()||P()||k()||lt()||ht()}return f(_t())},J2=e=>{e.type==="Feature"&&(e=e.geometry);function t(u){return u.join(" ")}function n(u){return u.map(t).join(", ")}function r(u){return u.map(n).map(c).join(", ")}function a(u){return u.map(r).map(c).join(", ")}function c(u){return"("+u+")"}let f=e;switch(f.type){case"Point":return f.coordinates&&f.coordinates.length===3?"POINT Z ("+t(f.coordinates)+")":"POINT ("+t(f.coordinates)+")";case"LineString":return f.coordinates&&f.coordinates[0]&&f.coordinates[0].length===3?"LINESTRING Z ("+n(f.coordinates)+")":"LINESTRING ("+n(f.coordinates)+")";case"Polygon":return f.coordinates&&f.coordinates[0]&&f.coordinates[0][0]&&f.coordinates[0][0].length===3?"POLYGON Z ("+r(f.coordinates)+")":"POLYGON ("+r(f.coordinates)+")";case"MultiPoint":return f.coordinates&&f.coordinates[0]&&f.coordinates[0].length===3?"MULTIPOINT Z ("+n(f.coordinates)+")":"MULTIPOINT ("+n(f.coordinates)+")";case"MultiLineString":return f.coordinates&&f.coordinates[0]&&f.coordinates[0][0]&&f.coordinates[0][0].length===3?"MULTILINESTRING Z ("+r(f.coordinates)+")":"MULTILINESTRING ("+r(f.coordinates)+")";case"MultiPolygon":return f.coordinates&&f.coordinates[0]&&f.coordinates[0][0]&&f.coordinates[0][0]&&f.coordinates[0][0][0].length===3?"MULTIPOLYGON Z ("+a(f.coordinates)+")":"MULTIPOLYGON ("+a(f.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+f.geometries.map(J2).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}};var m4={parse:d4,stringify:J2};function xb(e,t,n){const r=e.slice();return r[33]=t[n],r}function g4(e){let t,n,r,a,c,f,u,b,C,A,P,k,Y,X,lt,ht=e[6]&&bb(e),_t=e1(Object.keys(E_)),j=[];for(let W=0;W<_t.length;W+=1)j[W]=wb(xb(e,_t,W));return{c(){t=Pe("label"),n=Ir(`Load a .geojson file with polygons
          `),r=Pe("input"),a=pn(),c=Pe("div"),f=Pe("button"),f.textContent="Draw your own polygon",u=pn(),ht&&ht.c(),b=pn(),C=Pe("label"),A=Ir(`Choose a test case:

          `),P=Pe("select"),k=Pe("option"),k.textContent="None";for(let W=0;W<j.length;W+=1)j[W].c();Y=Ir(`

          (some from OpenStreetMap)`),cr(r,"type","file"),cr(f,"type","button"),k.__value="",bm(k,k.__value),e[0]===void 0&&wm(()=>e[23].call(P))},m(W,st){Ve(W,t,st),he(t,n),he(t,r),e[19](r),Ve(W,a,st),Ve(W,c,st),he(c,f),Ve(W,u,st),ht&&ht.m(W,st),Ve(W,b,st),Ve(W,C,st),he(C,A),he(C,P),he(P,k);for(let gt=0;gt<j.length;gt+=1)j[gt]&&j[gt].m(P,null);$v(P,e[0],!0),he(C,Y),X||(lt=[ei(r,"change",e[15]),ei(f,"click",e[20]),ei(P,"change",e[23])],X=!0)},p(W,st){if(W[6]?ht?ht.p(W,st):(ht=bb(W),ht.c(),ht.m(b.parentNode,b)):ht&&(ht.d(1),ht=null),st&0){_t=e1(Object.keys(E_));let gt;for(gt=0;gt<_t.length;gt+=1){const Lt=xb(W,_t,gt);j[gt]?j[gt].p(Lt,st):(j[gt]=wb(Lt),j[gt].c(),j[gt].m(P,null))}for(;gt<j.length;gt+=1)j[gt].d(1);j.length=_t.length}st[0]&1&&$v(P,W[0])},i:Xr,o:Xr,d(W){W&&(Re(t),Re(a),Re(c),Re(u),Re(b),Re(C)),e[19](null),ht&&ht.d(W),YI(j,W),X=!1,ls(lt)}}}function y4(e){let t,n;return t=new k3({props:{polygonTool:e[14]}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[0]&16384&&(c.polygonTool=r[14]),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function bb(e){let t,n,r,a,c,f,u,b;return{c(){t=Pe("div"),n=Pe("button"),n.textContent="Copy polygon as WKT",r=pn(),a=Pe("button"),c=Ir("Edit polygon"),cr(n,"class","secondary"),cr(a,"class","secondary"),a.disabled=f=e[14]!=null},m(C,A){Ve(C,t,A),he(t,n),he(t,r),he(t,a),he(a,c),u||(b=[ei(n,"click",e[21]),ei(a,"click",e[22])],u=!0)},p(C,A){A[0]&16384&&f!==(f=C[14]!=null)&&(a.disabled=f)},d(C){C&&Re(t),u=!1,ls(b)}}}function wb(e){let t,n=e[33]+"",r;return{c(){t=Pe("option"),r=Ir(n),t.__value=e[33],bm(t,t.__value)},m(a,c){Ve(a,t,c),he(t,r)},p:Xr,d(a){a&&Re(t)}}}function _4(e){let t,n,r,a,c,f,u,b,C,A,P,k,Y,X,lt,ht,_t,j,W,st,gt,Lt,At,Tt,Vt,Yt,J,Ut,te,le,Xe,De,ue,tn,Ce,pe,Ie,we,on;const Cn=[y4,g4],Ze=[];function Je(en,xn){return en[14]?0:1}C=Je(e),A=Ze[C]=Cn[C](e);function vn(en){e[28](en)}let zn={};return e[1]!==void 0&&(zn.cfg=e[1]),Ce=new f4({props:zn}),Fi.push(()=>ta(Ce,"cfg",vn)),{c(){t=Pe("div"),n=Pe("h1"),n.textContent="Polygon width",r=pn(),a=Pe("a"),a.textContent="About",c=pn(),f=Pe("details"),u=Pe("summary"),u.textContent="Input",b=pn(),A.c(),P=pn(),k=Pe("hr"),Y=pn(),X=Pe("details"),lt=Pe("summary"),lt.textContent="Layers",ht=pn(),_t=Pe("label"),j=Pe("input"),W=Ir(`
        Show input polygons`),st=pn(),gt=Pe("label"),Lt=Pe("input"),At=Ir(`
        Show center line`),Tt=pn(),Vt=Pe("label"),Yt=Pe("input"),J=Ir(`
        Show perpendicular lines`),Ut=pn(),te=Pe("label"),le=Pe("input"),Xe=Ir(`
        Show thickened polygons`),De=pn(),ue=Pe("hr"),tn=pn(),En(Ce.$$.fragment),cr(a,"href","https://github.com/dabreegster/polygon-width?tab=readme-ov-file#polygon-width"),cr(a,"target","_blank"),f.open=!0,cr(f,"class","svelte-eu3ecd"),cr(j,"type","checkbox"),cr(Lt,"type","checkbox"),cr(Yt,"type","checkbox"),cr(le,"type","checkbox"),X.open=!0,cr(X,"class","svelte-eu3ecd"),cr(t,"slot","left")},m(en,xn){Ve(en,t,xn),he(t,n),he(t,r),he(t,a),he(t,c),he(t,f),he(f,u),he(f,b),Ze[C].m(f,null),he(t,P),he(t,k),he(t,Y),he(t,X),he(X,lt),he(X,ht),he(X,_t),he(_t,j),j.checked=e[7],he(_t,W),he(X,st),he(X,gt),he(gt,Lt),Lt.checked=e[8],he(gt,At),he(X,Tt),he(X,Vt),he(Vt,Yt),Yt.checked=e[9],he(Vt,J),he(X,Ut),he(X,te),he(te,le),le.checked=e[10],he(te,Xe),he(t,De),he(t,ue),he(t,tn),wn(Ce,t,null),Ie=!0,we||(on=[ei(j,"change",e[24]),ei(Lt,"change",e[25]),ei(Yt,"change",e[26]),ei(le,"change",e[27])],we=!0)},p(en,xn){let Fn=C;C=Je(en),C===Fn?Ze[C].p(en,xn):(xi(),se(Ze[Fn],1,1,()=>{Ze[Fn]=null}),bi(),A=Ze[C],A?A.p(en,xn):(A=Ze[C]=Cn[C](en),A.c()),Zt(A,1),A.m(f,null)),xn[0]&128&&(j.checked=en[7]),xn[0]&256&&(Lt.checked=en[8]),xn[0]&512&&(Yt.checked=en[9]),xn[0]&1024&&(le.checked=en[10]);const mr={};!pe&&xn[0]&2&&(pe=!0,mr.cfg=en[1],$s(()=>pe=!1)),Ce.$set(mr)},i(en){Ie||(Zt(A),Zt(Ce.$$.fragment,en),Ie=!0)},o(en){se(A),se(Ce.$$.fragment,en),Ie=!1},d(en){en&&Re(t),Ze[C].d(),Sn(Ce),we=!1,ls(on)}}}function Sb(e){let t,n;return t=new fg({props:{data:e[2],$$slots:{default:[v4]},$$scope:{ctx:e}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[0]&4&&(c.data=r[2]),a[0]&128|a[1]&32&&(c.$$scope={dirty:a,ctx:r}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function v4(e){let t,n;return t=new k2({props:{paint:{"fill-color":"black","fill-opacity":.5},layout:{visibility:e[7]?"visible":"none"}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[0]&128&&(c.layout={visibility:r[7]?"visible":"none"}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function Ib(e){let t,n;return t=new fg({props:{data:e[3],generateId:!0,$$slots:{default:[x4]},$$scope:{ctx:e}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[0]&8&&(c.data=r[3]),a[0]&256|a[1]&32&&(c.$$scope={dirty:a,ctx:r}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function x4(e){let t,n;return t=new R2({props:{manageHoverState:!0,paint:{"line-color":M2("red","blue"),"line-width":4},layout:{visibility:e[8]?"visible":"none"}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[0]&256&&(c.layout={visibility:r[8]?"visible":"none"}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function Eb(e){let t,n;return t=new fg({props:{data:e[4],$$slots:{default:[b4]},$$scope:{ctx:e}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[0]&16&&(c.data=r[4]),a[0]&512|a[1]&32&&(c.$$scope={dirty:a,ctx:r}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function b4(e){let t,n;return t=new R2({props:{paint:{"line-color":"green","line-width":2},layout:{visibility:e[9]?"visible":"none"}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[0]&512&&(c.layout={visibility:r[9]?"visible":"none"}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function Cb(e){let t,n;return t=new fg({props:{data:e[5],generateId:!0,$$slots:{default:[I4]},$$scope:{ctx:e}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[0]&32&&(c.data=r[5]),a[0]&1024|a[1]&32&&(c.$$scope={dirty:a,ctx:r}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function w4(e){let t,n,r=e[32].width1.toFixed(1)+"",a,c,f=e[32].width2.toFixed(1)+"",u,b;return{c(){t=Pe("p"),n=Ir("Width between "),a=Ir(r),c=Ir("m and "),u=Ir(f),b=Ir("m")},m(C,A){Ve(C,t,A),he(t,n),he(t,a),he(t,c),he(t,u),he(t,b)},p(C,A){A[1]&2&&r!==(r=C[32].width1.toFixed(1)+"")&&xm(a,r),A[1]&2&&f!==(f=C[32].width2.toFixed(1)+"")&&xm(u,f)},d(C){C&&Re(t)}}}function S4(e){let t,n;return t=new o5({props:{$$slots:{default:[w4,({props:r})=>({32:r}),({props:r})=>[0,r?2:0]]},$$scope:{ctx:e}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[1]&34&&(c.$$scope={dirty:a,ctx:r}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function I4(e){let t,n;return t=new k2({props:{manageHoverState:!0,paint:{"fill-color":"cyan","fill-opacity":M2(.5,.8)},layout:{visibility:e[10]?"visible":"none"},$$slots:{default:[S4]},$$scope:{ctx:e}}}),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[0]&1024&&(c.layout={visibility:r[10]?"visible":"none"}),a[1]&32&&(c.$$scope={dirty:a,ctx:r}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function E4(e){let t,n,r,a,c,f,u;t=new l4({});let b=e[2]&&Sb(e),C=e[3]&&Ib(e),A=e[4]&&Eb(e),P=e[5]&&Cb(e);return{c(){En(t.$$.fragment),n=pn(),b&&b.c(),r=pn(),C&&C.c(),a=pn(),A&&A.c(),c=pn(),P&&P.c(),f=ma()},m(k,Y){wn(t,k,Y),Ve(k,n,Y),b&&b.m(k,Y),Ve(k,r,Y),C&&C.m(k,Y),Ve(k,a,Y),A&&A.m(k,Y),Ve(k,c,Y),P&&P.m(k,Y),Ve(k,f,Y),u=!0},p(k,Y){k[2]?b?(b.p(k,Y),Y[0]&4&&Zt(b,1)):(b=Sb(k),b.c(),Zt(b,1),b.m(r.parentNode,r)):b&&(xi(),se(b,1,1,()=>{b=null}),bi()),k[3]?C?(C.p(k,Y),Y[0]&8&&Zt(C,1)):(C=Ib(k),C.c(),Zt(C,1),C.m(a.parentNode,a)):C&&(xi(),se(C,1,1,()=>{C=null}),bi()),k[4]?A?(A.p(k,Y),Y[0]&16&&Zt(A,1)):(A=Eb(k),A.c(),Zt(A,1),A.m(c.parentNode,c)):A&&(xi(),se(A,1,1,()=>{A=null}),bi()),k[5]?P?(P.p(k,Y),Y[0]&32&&Zt(P,1)):(P=Cb(k),P.c(),Zt(P,1),P.m(f.parentNode,f)):P&&(xi(),se(P,1,1,()=>{P=null}),bi())},i(k){u||(Zt(t.$$.fragment,k),Zt(b),Zt(C),Zt(A),Zt(P),u=!0)},o(k){se(t.$$.fragment,k),se(b),se(C),se(A),se(P),u=!1},d(k){k&&(Re(n),Re(r),Re(a),Re(c),Re(f)),Sn(t,k),b&&b.d(k),C&&C.d(k),A&&A.d(k),P&&P.d(k)}}}function C4(e){let t,n,r,a;function c(u){e[18](u)}let f={style:`https://api.maptiler.com/maps/dataviz/style.json?key=${P4}`,standardControls:!0,hash:!0,$$slots:{default:[E4]},$$scope:{ctx:e}};return e[12]!==void 0&&(f.map=e[12]),n=new B5({props:f}),Fi.push(()=>ta(n,"map",c)),{c(){t=Pe("div"),En(n.$$.fragment),cr(t,"slot","main"),ff(t,"position","relative"),ff(t,"width","100%"),ff(t,"height","100vh")},m(u,b){Ve(u,t,b),wn(n,t,null),a=!0},p(u,b){const C={};b[0]&1980|b[1]&32&&(C.$$scope={dirty:b,ctx:u}),!r&&b[0]&4096&&(r=!0,C.map=u[12],$s(()=>r=!1)),n.$set(C)},i(u){a||(Zt(n.$$.fragment,u),a=!0)},o(u){se(n.$$.fragment,u),a=!1},d(u){u&&Re(t),Sn(n)}}}function Tb(e){let t,n;return t=new vE({props:{$$slots:{default:[T4]},$$scope:{ctx:e}}}),t.$on("close",e[29]),{c(){En(t.$$.fragment)},m(r,a){wn(t,r,a),n=!0},p(r,a){const c={};a[0]&64|a[1]&32&&(c.$$scope={dirty:a,ctx:r}),t.$set(c)},i(r){n||(Zt(t.$$.fragment,r),n=!0)},o(r){se(t.$$.fragment,r),n=!1},d(r){Sn(t,r)}}}function T4(e){let t;return{c(){t=Pe("textarea"),cr(t,"rows","10"),t.value=e[6]},m(n,r){Ve(n,t,r)},p(n,r){r[0]&64&&(t.value=n[6])},d(n){n&&Re(t)}}}function L4(e){let t,n,r,a;t=new mE({props:{$$slots:{main:[C4],left:[_4]},$$scope:{ctx:e}}});let c=e[11]&&Tb(e);return{c(){En(t.$$.fragment),n=pn(),c&&c.c(),r=ma()},m(f,u){wn(t,f,u),Ve(f,n,u),c&&c.m(f,u),Ve(f,r,u),a=!0},p(f,u){const b={};u[0]&32767|u[1]&32&&(b.$$scope={dirty:u,ctx:f}),t.$set(b),f[11]?c?(c.p(f,u),u[0]&2048&&Zt(c,1)):(c=Tb(f),c.c(),Zt(c,1),c.m(r.parentNode,r)):c&&(xi(),se(c,1,1,()=>{c=null}),bi())},i(f){a||(Zt(t.$$.fragment,f),Zt(c),a=!0)},o(f){se(t.$$.fragment,f),se(c),a=!1},d(f){f&&(Re(n),Re(r)),Sn(t,f),c&&c.d(f)}}}let P4="MZEJTanw3WpxRvt7qDfo";function A4(e,t,n){let r=null,a=null,c=null,f=null,u="",b=!0,C=!0,A=!0,P=!1,k=!1,Y,X,lt=null,ht="",_t="",j={remove_holes:100,filter_skeletons_outside:!0,filter_skeletons_near_boundary:.1,join_skeletons:!0,remove_short_skeletons:.1,make_perps_step_size:5},W=!0;async function st(Ce,pe){if(!Ce)return;await Bb();let Ie=JSON.parse(aE(Ce,pe));n(2,r=Ie.input),n(3,a=Ie.skeletons),n(4,c=Ie.perps),n(5,f=Ie.thickened),n(6,u=Ie.wkt_input),W&&(Y==null||Y.fitBounds(Yw(r),{animate:!1,padding:10}),W=!1)}async function gt(Ce){W=!0,n(0,ht=""),n(17,_t=await X.files[0].text())}function Lt(Ce){Y&&(n(14,lt=new L3(Y)),Ce?lt.editExisting(JSON.parse(_t)):lt.startNew(),lt.addEventListenerSuccess(async pe=>{n(14,lt=null),W=!0,n(0,ht=""),n(17,_t=JSON.stringify(pe))}),lt.addEventListenerFailure(()=>{n(14,lt=null)}))}function At(Ce){Y=Ce,n(12,Y)}function Tt(Ce){Fi[Ce?"unshift":"push"](()=>{X=Ce,n(13,X)})}const Vt=()=>Lt(!1),Yt=()=>n(11,k=!0),J=()=>Lt(!0);function Ut(){ht=JI(this),n(0,ht)}function te(){b=this.checked,n(7,b)}function le(){C=this.checked,n(8,C)}function Xe(){A=this.checked,n(9,A)}function De(){P=this.checked,n(10,P)}function ue(Ce){j=Ce,n(1,j)}const tn=()=>n(11,k=!1);return e.$$.update=()=>{if(e.$$.dirty[0]&1&&ht!=""){let Ce=E_[ht];W=!0,n(17,_t=JSON.stringify({type:"Feature",geometry:m4.parse(Ce),properties:{}}))}e.$$.dirty[0]&131074&&st(_t,j)},[ht,j,r,a,c,f,u,b,C,A,P,k,Y,X,lt,gt,Lt,_t,At,Tt,Vt,Yt,J,Ut,te,le,Xe,De,ue,tn]}class M4 extends Lr{constructor(t){super(),Tr(this,t,A4,L4,Wn,{},null,[-1,-1])}}new M4({target:document.getElementById("app")});
