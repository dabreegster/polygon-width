var ZI=Object.defineProperty;var HI=(e,t,n)=>t in e?ZI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var ti=(e,t,n)=>(HI(e,typeof t!="symbol"?t+"":t,n),n);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const u of a)if(u.type==="childList")for(const p of u.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&r(p)}).observe(document,{childList:!0,subtree:!0});function n(a){const u={};return a.integrity&&(u.integrity=a.integrity),a.referrerPolicy&&(u.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?u.credentials="include":a.crossOrigin==="anonymous"?u.credentials="omit":u.credentials="same-origin",u}function r(a){if(a.ep)return;a.ep=!0;const u=n(a);fetch(a.href,u)}})();function Yr(){}function ac(e,t){for(const n in t)e[n]=t[n];return e}function Nb(e){return e()}function s1(){return Object.create(null)}function cs(e){e.forEach(Nb)}function M_(e){return typeof e=="function"}function Gn(e,t){return e!=e?t==t:e!==t||e&&typeof e=="object"||typeof e=="function"}function XI(e){return Object.keys(e).length===0}function Ob(e,...t){if(e==null){for(const r of t)r(void 0);return Yr}const n=e.subscribe(...t);return n.unsubscribe?()=>n.unsubscribe():n}function D_(e){let t;return Ob(e,n=>t=n)(),t}function Zn(e,t,n){e.$$.on_destroy.push(Ob(t,n))}function $i(e,t,n,r){if(e){const a=zb(e,t,n,r);return e[0](a)}}function zb(e,t,n,r){return e[1]&&r?ac(n.ctx.slice(),e[1](r(t))):n.ctx}function to(e,t,n,r){if(e[2]&&r){const a=e[2](r(n));if(t.dirty===void 0)return a;if(typeof a=="object"){const u=[],p=Math.max(t.dirty.length,a.length);for(let c=0;c<p;c+=1)u[c]=t.dirty[c]|a[c];return u}return t.dirty|a}return t.dirty}function eo(e,t,n,r,a,u){if(a){const p=zb(t,n,r,u);e.p(p,a)}}function no(e){if(e.ctx.length>32){const t=[],n=e.ctx.length/32;for(let r=0;r<n;r++)t[r]=-1;return t}return-1}function YI(e){const t={};for(const n in e)t[n]=!0;return t}function a1(e){return e??""}function Ls(e,t,n){return e.set(n),t}function KI(e){return e&&M_(e.destroy)?e.destroy:Yr}const JI=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function ne(e,t){e.appendChild(t)}function ke(e,t,n){e.insertBefore(t,n||null)}function Me(e){e.parentNode&&e.parentNode.removeChild(e)}function QI(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function Ee(e){return document.createElement(e)}function Vn(e){return document.createTextNode(e)}function $e(){return Vn(" ")}function Ua(){return Vn("")}function Or(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function Tn(e,t,n){n==null?e.removeAttribute(t):e.getAttribute(t)!==n&&e.setAttribute(t,n)}function tg(e){return e===""?null:+e}function $I(e){return Array.from(e.childNodes)}function Th(e,t){t=""+t,e.data!==t&&(e.data=t)}function Lh(e,t){e.value=t??""}function bf(e,t,n,r){n==null?e.style.removeProperty(t):e.style.setProperty(t,n,r?"important":"")}function l1(e,t,n){for(let r=0;r<e.options.length;r+=1){const a=e.options[r];if(a.__value===t){a.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function tE(e){const t=e.querySelector(":checked");return t&&t.__value}function u1(e,t,n){e.classList.toggle(t,!!n)}function eE(e,t,{bubbles:n=!1,cancelable:r=!1}={}){return new CustomEvent(e,{detail:t,bubbles:n,cancelable:r})}let Lf;function wf(e){Lf=e}function Zf(){if(!Lf)throw new Error("Function called outside component initialization");return Lf}function nE(e){Zf().$$.on_mount.push(e)}function oa(e){Zf().$$.on_destroy.push(e)}function eg(){const e=Zf();return(t,n,{cancelable:r=!1}={})=>{const a=e.$$.callbacks[t];if(a){const u=eE(t,n,{cancelable:r});return a.slice().forEach(p=>{p.call(e,u)}),!u.defaultPrevented}return!0}}function k_(e,t){return Zf().$$.context.set(e,t),t}function R_(e){return Zf().$$.context.get(e)}function xn(e,t){const n=e.$$.callbacks[t.type];n&&n.slice().forEach(r=>r.call(this,t))}const xh=[],li=[];let Ih=[];const Jy=[],Fb=Promise.resolve();let Qy=!1;function Bb(){Qy||(Qy=!0,Fb.then(Ub))}function Vb(){return Bb(),Fb}function Lm(e){Ih.push(e)}function $o(e){Jy.push(e)}const Ey=new Set;let fh=0;function Ub(){if(fh!==0)return;const e=Lf;do{try{for(;fh<xh.length;){const t=xh[fh];fh++,wf(t),rE(t.$$)}}catch(t){throw xh.length=0,fh=0,t}for(wf(null),xh.length=0,fh=0;li.length;)li.pop()();for(let t=0;t<Ih.length;t+=1){const n=Ih[t];Ey.has(n)||(Ey.add(n),n())}Ih.length=0}while(xh.length);for(;Jy.length;)Jy.pop()();Qy=!1,Ey.clear(),wf(e)}function rE(e){if(e.fragment!==null){e.update(),cs(e.before_update);const t=e.dirty;e.dirty=[-1],e.fragment&&e.fragment.p(e.ctx,t),e.after_update.forEach(Lm)}}function iE(e){const t=[],n=[];Ih.forEach(r=>e.indexOf(r)===-1?t.push(r):n.push(r)),n.forEach(r=>r()),Ih=t}const gm=new Set;let qu;function Bo(){qu={r:0,c:[],p:qu}}function Vo(){qu.r||cs(qu.c),qu=qu.p}function Yt(e,t){e&&e.i&&(gm.delete(e),e.i(t))}function ae(e,t,n,r){if(e&&e.o){if(gm.has(e))return;gm.add(e),qu.c.push(()=>{gm.delete(e),r&&(n&&e.d(1),r())}),e.o(t)}else r&&r()}function c1(e){return(e==null?void 0:e.length)!==void 0?e:Array.from(e)}function Jh(e,t){const n={},r={},a={$$scope:1};let u=e.length;for(;u--;){const p=e[u],c=t[u];if(c){for(const b in p)b in c||(r[b]=1);for(const b in c)a[b]||(n[b]=c[b],a[b]=1);e[u]=c}else for(const b in p)a[b]=1}for(const p in r)p in n||(n[p]=void 0);return n}function ts(e,t,n){const r=e.$$.props[t];r!==void 0&&(e.$$.bound[r]=n,n(e.$$.ctx[r]))}function pn(e){e&&e.c()}function sn(e,t,n){const{fragment:r,after_update:a}=e.$$;r&&r.m(t,n),Lm(()=>{const u=e.$$.on_mount.map(Nb).filter(M_);e.$$.on_destroy?e.$$.on_destroy.push(...u):cs(u),e.$$.on_mount=[]}),a.forEach(Lm)}function an(e,t){const n=e.$$;n.fragment!==null&&(iE(n.after_update),cs(n.on_destroy),n.fragment&&n.fragment.d(t),n.on_destroy=n.fragment=null,n.ctx=[])}function oE(e,t){e.$$.dirty[0]===-1&&(xh.push(e),Bb(),e.$$.dirty.fill(0)),e.$$.dirty[t/31|0]|=1<<t%31}function br(e,t,n,r,a,u,p=null,c=[-1]){const b=Lf;wf(e);const C=e.$$={fragment:null,ctx:[],props:u,update:Yr,not_equal:a,bound:s1(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(t.context||(b?b.$$.context:[])),callbacks:s1(),dirty:c,skip_bound:!1,root:t.target||b.$$.root};p&&p(C.root);let A=!1;if(C.ctx=n?n(e,t.props||{},(P,R,...et)=>{const X=et.length?et[0]:R;return C.ctx&&a(C.ctx[P],C.ctx[P]=X)&&(!C.skip_bound&&C.bound[P]&&C.bound[P](X),A&&oE(e,P)),R}):[],C.update(),A=!0,cs(C.before_update),C.fragment=r?r(C.ctx):!1,t.target){if(t.hydrate){const P=$I(t.target);C.fragment&&C.fragment.l(P),P.forEach(Me)}else C.fragment&&C.fragment.c();t.intro&&Yt(e.$$.fragment),sn(e,t.target,t.anchor),Ub()}wf(b)}class wr{constructor(){ti(this,"$$");ti(this,"$$set")}$destroy(){an(this,1),this.$destroy=Yr}$on(t,n){if(!M_(n))return Yr;const r=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return r.push(n),()=>{const a=r.indexOf(n);a!==-1&&r.splice(a,1)}}$set(t){this.$$set&&!XI(t)&&(this.$$.skip_bound=!0,this.$$set(t),this.$$.skip_bound=!1)}}const sE="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(sE);let Xr;const Gb=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&Gb.decode();let gf=null;function ym(){return(gf===null||gf.byteLength===0)&&(gf=new Uint8Array(Xr.memory.buffer)),gf}function yf(e,t){return e=e>>>0,Gb.decode(ym().subarray(e,e+t))}const pl=new Array(128).fill(void 0);pl.push(void 0,null,!0,!1);let Sf=pl.length;function cl(e){Sf===pl.length&&pl.push(pl.length+1);const t=Sf;return Sf=pl[t],pl[t]=e,t}function $n(e){return pl[e]}function aE(e){e<132||(pl[e]=Sf,Sf=e)}function qb(e){const t=$n(e);return aE(e),t}function Cy(e){return e==null}let _f=null;function lE(){return(_f===null||_f.byteLength===0)&&(_f=new Float64Array(Xr.memory.buffer)),_f}let vf=null;function $s(){return(vf===null||vf.byteLength===0)&&(vf=new Int32Array(Xr.memory.buffer)),vf}let Eh=0;const _m=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},uE=typeof _m.encodeInto=="function"?function(e,t){return _m.encodeInto(e,t)}:function(e,t){const n=_m.encode(e);return t.set(n),{read:e.length,written:n.length}};function vm(e,t,n){if(n===void 0){const c=_m.encode(e),b=t(c.length,1)>>>0;return ym().subarray(b,b+c.length).set(c),Eh=c.length,b}let r=e.length,a=t(r,1)>>>0;const u=ym();let p=0;for(;p<r;p++){const c=e.charCodeAt(p);if(c>127)break;u[a+p]=c}if(p!==r){p!==0&&(e=e.slice(p)),a=n(a,r,r=p+e.length*3,1)>>>0;const c=ym().subarray(a+p,a+r),b=uE(e,c);p+=b.written}return Eh=p,a}function $y(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const a=e.description;return a==null?"Symbol":`Symbol(${a})`}if(t=="function"){const a=e.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(e)){const a=e.length;let u="[";a>0&&(u+=$y(e[0]));for(let p=1;p<a;p++)u+=", "+$y(e[p]);return u+="]",u}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(n.length>1)r=n[1];else return toString.call(e);if(r=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:r}function cE(e,t){let n,r;try{const A=Xr.__wbindgen_add_to_stack_pointer(-16),P=vm(e,Xr.__wbindgen_malloc,Xr.__wbindgen_realloc),R=Eh;Xr.findWidths(A,P,R,cl(t));var a=$s()[A/4+0],u=$s()[A/4+1],p=$s()[A/4+2],c=$s()[A/4+3],b=a,C=u;if(c)throw b=0,C=0,qb(p);return n=b,r=C,yf(b,C)}finally{Xr.__wbindgen_add_to_stack_pointer(16),Xr.__wbindgen_free(n,r,1)}}async function hE(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function pE(){const e={};return e.wbg={},e.wbg.__wbindgen_error_new=function(t,n){const r=new Error(yf(t,n));return cl(r)},e.wbg.__wbindgen_string_new=function(t,n){const r=yf(t,n);return cl(r)},e.wbg.__wbindgen_boolean_get=function(t){const n=$n(t);return typeof n=="boolean"?n?1:0:2},e.wbg.__wbindgen_object_drop_ref=function(t){qb(t)},e.wbg.__wbindgen_is_object=function(t){const n=$n(t);return typeof n=="object"&&n!==null},e.wbg.__wbindgen_is_undefined=function(t){return $n(t)===void 0},e.wbg.__wbindgen_in=function(t,n){return $n(t)in $n(n)},e.wbg.__wbindgen_number_get=function(t,n){const r=$n(n),a=typeof r=="number"?r:void 0;lE()[t/8+1]=Cy(a)?0:a,$s()[t/4+0]=!Cy(a)},e.wbg.__wbindgen_jsval_loose_eq=function(t,n){return $n(t)==$n(n)},e.wbg.__wbindgen_string_get=function(t,n){const r=$n(n),a=typeof r=="string"?r:void 0;var u=Cy(a)?0:vm(a,Xr.__wbindgen_malloc,Xr.__wbindgen_realloc),p=Eh;$s()[t/4+1]=p,$s()[t/4+0]=u},e.wbg.__wbindgen_object_clone_ref=function(t){const n=$n(t);return cl(n)},e.wbg.__wbg_getwithrefkey_edc2c8960f0f1191=function(t,n){const r=$n(t)[$n(n)];return cl(r)},e.wbg.__wbg_debug_34c9290896ec9856=function(t){console.debug($n(t))},e.wbg.__wbg_error_e60eff06f24ab7a4=function(t){console.error($n(t))},e.wbg.__wbg_info_d7d58472d0bab115=function(t){console.info($n(t))},e.wbg.__wbg_log_a4530b4fe289336f=function(t){console.log($n(t))},e.wbg.__wbg_warn_f260f49434e45e62=function(t){console.warn($n(t))},e.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(t){let n;try{n=$n(t)instanceof ArrayBuffer}catch{n=!1}return n},e.wbg.__wbg_buffer_a448f833075b71ba=function(t){const n=$n(t).buffer;return cl(n)},e.wbg.__wbg_new_8f67e318f15d7254=function(t){const n=new Uint8Array($n(t));return cl(n)},e.wbg.__wbg_set_2357bf09366ee480=function(t,n,r){$n(t).set($n(n),r>>>0)},e.wbg.__wbg_length_1d25fa9e4ac21ce7=function(t){return $n(t).length},e.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(t){let n;try{n=$n(t)instanceof Uint8Array}catch{n=!1}return n},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return cl(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const r=$n(n).stack,a=vm(r,Xr.__wbindgen_malloc,Xr.__wbindgen_realloc),u=Eh;$s()[t/4+1]=u,$s()[t/4+0]=a},e.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let r,a;try{r=t,a=n,console.error(yf(t,n))}finally{Xr.__wbindgen_free(r,a,1)}},e.wbg.__wbindgen_debug_string=function(t,n){const r=$y($n(n)),a=vm(r,Xr.__wbindgen_malloc,Xr.__wbindgen_realloc),u=Eh;$s()[t/4+1]=u,$s()[t/4+0]=a},e.wbg.__wbindgen_throw=function(t,n){throw new Error(yf(t,n))},e.wbg.__wbindgen_memory=function(){const t=Xr.memory;return cl(t)},e}function fE(e,t){return Xr=e.exports,jb.__wbindgen_wasm_module=t,_f=null,vf=null,gf=null,Xr}async function jb(e){if(Xr!==void 0)return Xr;typeof e>"u"&&(e="/polygon-width/assets/backend_bg.wasm");const t=pE();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:r}=await hE(await e,t);return fE(n,r)}const dh=[];function Ty(e,t){return{subscribe:Ji(e,t).subscribe}}function Ji(e,t=Yr){let n;const r=new Set;function a(c){if(Gn(e,c)&&(e=c,n)){const b=!dh.length;for(const C of r)C[1](),dh.push(C,e);if(b){for(let C=0;C<dh.length;C+=2)dh[C][0](dh[C+1]);dh.length=0}}}function u(c){a(c(e))}function p(c,b=Yr){const C=[c,b];return r.add(C),r.size===1&&(n=t(a,u)||Yr),c(e),()=>{r.delete(C),r.size===0&&n&&(n(),n=null)}}return{set:a,update:u,subscribe:p}}const dE=e=>({}),h1=e=>({}),mE=e=>({}),p1=e=>({});function gE(e){let t,n,r,a;const u=e[1].left,p=$i(u,e,e[0],p1),c=e[1].main,b=$i(c,e,e[0],h1);return{c(){t=Ee("div"),p&&p.c(),n=$e(),r=Ee("div"),b&&b.c(),Tn(t,"class","left svelte-k43lgc"),Tn(r,"class","main svelte-k43lgc")},m(C,A){ke(C,t,A),p&&p.m(t,null),ke(C,n,A),ke(C,r,A),b&&b.m(r,null),a=!0},p(C,[A]){p&&p.p&&(!a||A&1)&&eo(p,u,C,C[0],a?to(u,C[0],A,mE):no(C[0]),p1),b&&b.p&&(!a||A&1)&&eo(b,c,C,C[0],a?to(c,C[0],A,dE):no(C[0]),h1)},i(C){a||(Yt(p,C),Yt(b,C),a=!0)},o(C){ae(p,C),ae(b,C),a=!1},d(C){C&&(Me(t),Me(n),Me(r)),p&&p.d(C),b&&b.d(C)}}}function yE(e,t,n){let{$$slots:r={},$$scope:a}=t;return e.$$set=u=>{"$$scope"in u&&n(0,a=u.$$scope)},[a,r]}class _E extends wr{constructor(t){super(),br(this,t,yE,gE,Gn,{})}}const vE=e=>({dialog:e&1}),f1=e=>({dialog:e[0]});function xE(e){let t,n,r,a,u;const p=e[4].default,c=$i(p,e,e[3],f1);return{c(){t=Ee("dialog"),n=Ee("article"),c&&c.c(),t.open=!0},m(b,C){ke(b,t,C),ne(t,n),c&&c.m(n,null),e[6](t),r=!0,a||(u=[Or(window,"click",e[1]),Or(window,"keydown",e[2]),Or(t,"close",e[5])],a=!0)},p(b,[C]){c&&c.p&&(!r||C&9)&&eo(c,p,b,b[3],r?to(p,b[3],C,vE):no(b[3]),f1)},i(b){r||(Yt(c,b),r=!0)},o(b){ae(c,b),r=!1},d(b){b&&Me(t),c&&c.d(b),e[6](null),a=!1,cs(u)}}}function bE(e,t,n){let{$$slots:r={},$$scope:a}=t,u;function p(A){u.open&&A.target==u&&u.close()}function c(A){(A.key=="Escape"||A.key=="Enter")&&(A.stopPropagation(),u.close())}function b(A){xn.call(this,e,A)}function C(A){li[A?"unshift":"push"](()=>{u=A,n(0,u)})}return e.$$set=A=>{"$$scope"in A&&n(3,a=A.$$scope)},[u,p,c,a,r,b,C]}class wE extends wr{constructor(t){super(),br(this,t,bE,xE,Gn,{})}}var Hf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function N_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function ng(e){if(e.__esModule)return e;var t=e.default;if(typeof t=="function"){var n=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach(function(r){var a=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,a.get?a:{enumerable:!0,get:function(){return e[r]}})}),n}var d1=Object.prototype.toString,Wb=function(t){var n=d1.call(t),r=n==="[object Arguments]";return r||(r=n!=="[object Array]"&&t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&d1.call(t.callee)==="[object Function]"),r},Ly,m1;function SE(){if(m1)return Ly;m1=1;var e;if(!Object.keys){var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=Wb,a=Object.prototype.propertyIsEnumerable,u=!a.call({toString:null},"toString"),p=a.call(function(){},"prototype"),c=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],b=function(R){var et=R.constructor;return et&&et.prototype===R},C={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},A=function(){if(typeof window>"u")return!1;for(var R in window)try{if(!C["$"+R]&&t.call(window,R)&&window[R]!==null&&typeof window[R]=="object")try{b(window[R])}catch{return!0}}catch{return!0}return!1}(),P=function(R){if(typeof window>"u"||!A)return b(R);try{return b(R)}catch{return!1}};e=function(et){var X=et!==null&&typeof et=="object",K=n.call(et)==="[object Function]",ot=r(et),gt=X&&n.call(et)==="[object String]",q=[];if(!X&&!K&&!ot)throw new TypeError("Object.keys called on a non-object");var W=p&&K;if(gt&&et.length>0&&!t.call(et,0))for(var at=0;at<et.length;++at)q.push(String(at));if(ot&&et.length>0)for(var dt=0;dt<et.length;++dt)q.push(String(dt));else for(var Pt in et)!(W&&Pt==="prototype")&&t.call(et,Pt)&&q.push(String(Pt));if(u)for(var Mt=P(et),Tt=0;Tt<c.length;++Tt)!(Mt&&c[Tt]==="constructor")&&t.call(et,c[Tt])&&q.push(c[Tt]);return q}}return Ly=e,Ly}var IE=Array.prototype.slice,EE=Wb,g1=Object.keys,xm=g1?function(t){return g1(t)}:SE(),y1=Object.keys;xm.shim=function(){if(Object.keys){var t=function(){var n=Object.keys(arguments);return n&&n.length===arguments.length}(1,2);t||(Object.keys=function(r){return EE(r)?y1(IE.call(r)):y1(r)})}else Object.keys=xm;return Object.keys||xm};var O_=xm,CE=Error,TE=EvalError,LE=RangeError,PE=ReferenceError,Zb=SyntaxError,pu=TypeError,AE=URIError,rg=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var t={},n=Symbol("test"),r=Object(n);if(typeof n=="string"||Object.prototype.toString.call(n)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var a=42;t[n]=a;for(n in t)return!1;if(typeof Object.keys=="function"&&Object.keys(t).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(t).length!==0)return!1;var u=Object.getOwnPropertySymbols(t);if(u.length!==1||u[0]!==n||!Object.prototype.propertyIsEnumerable.call(t,n))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var p=Object.getOwnPropertyDescriptor(t,n);if(p.value!==a||p.enumerable!==!0)return!1}return!0},_1=typeof Symbol<"u"&&Symbol,ME=rg,z_=function(){return typeof _1!="function"||typeof Symbol!="function"||typeof _1("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:ME()},Py={__proto__:null,foo:{}},DE=Object,kE=function(){return{__proto__:Py}.foo===Py.foo&&!(Py instanceof DE)},RE="Function.prototype.bind called on incompatible ",NE=Object.prototype.toString,OE=Math.max,zE="[object Function]",v1=function(t,n){for(var r=[],a=0;a<t.length;a+=1)r[a]=t[a];for(var u=0;u<n.length;u+=1)r[u+t.length]=n[u];return r},FE=function(t,n){for(var r=[],a=n||0,u=0;a<t.length;a+=1,u+=1)r[u]=t[a];return r},BE=function(e,t){for(var n="",r=0;r<e.length;r+=1)n+=e[r],r+1<e.length&&(n+=t);return n},VE=function(t){var n=this;if(typeof n!="function"||NE.apply(n)!==zE)throw new TypeError(RE+n);for(var r=FE(arguments,1),a,u=function(){if(this instanceof a){var A=n.apply(this,v1(r,arguments));return Object(A)===A?A:this}return n.apply(t,v1(r,arguments))},p=OE(0,n.length-r.length),c=[],b=0;b<p;b++)c[b]="$"+b;if(a=Function("binder","return function ("+BE(c,",")+"){ return binder.apply(this,arguments); }")(u),n.prototype){var C=function(){};C.prototype=n.prototype,a.prototype=new C,C.prototype=null}return a},UE=VE,F_=Function.prototype.bind||UE,GE=Function.prototype.call,qE=Object.prototype.hasOwnProperty,jE=F_,Hb=jE.call(GE,qE),In,WE=CE,ZE=TE,HE=LE,XE=PE,Ph=Zb,Ch=pu,YE=AE,Xb=Function,Ay=function(e){try{return Xb('"use strict"; return ('+e+").constructor;")()}catch{}},Wu=Object.getOwnPropertyDescriptor;if(Wu)try{Wu({},"")}catch{Wu=null}var My=function(){throw new Ch},KE=Wu?function(){try{return arguments.callee,My}catch{try{return Wu(arguments,"callee").get}catch{return My}}}():My,mh=z_(),JE=kE(),vi=Object.getPrototypeOf||(JE?function(e){return e.__proto__}:null),bh={},QE=typeof Uint8Array>"u"||!vi?In:vi(Uint8Array),Zu={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?In:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?In:ArrayBuffer,"%ArrayIteratorPrototype%":mh&&vi?vi([][Symbol.iterator]()):In,"%AsyncFromSyncIteratorPrototype%":In,"%AsyncFunction%":bh,"%AsyncGenerator%":bh,"%AsyncGeneratorFunction%":bh,"%AsyncIteratorPrototype%":bh,"%Atomics%":typeof Atomics>"u"?In:Atomics,"%BigInt%":typeof BigInt>"u"?In:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?In:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?In:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?In:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":WE,"%eval%":eval,"%EvalError%":ZE,"%Float32Array%":typeof Float32Array>"u"?In:Float32Array,"%Float64Array%":typeof Float64Array>"u"?In:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?In:FinalizationRegistry,"%Function%":Xb,"%GeneratorFunction%":bh,"%Int8Array%":typeof Int8Array>"u"?In:Int8Array,"%Int16Array%":typeof Int16Array>"u"?In:Int16Array,"%Int32Array%":typeof Int32Array>"u"?In:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":mh&&vi?vi(vi([][Symbol.iterator]())):In,"%JSON%":typeof JSON=="object"?JSON:In,"%Map%":typeof Map>"u"?In:Map,"%MapIteratorPrototype%":typeof Map>"u"||!mh||!vi?In:vi(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?In:Promise,"%Proxy%":typeof Proxy>"u"?In:Proxy,"%RangeError%":HE,"%ReferenceError%":XE,"%Reflect%":typeof Reflect>"u"?In:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?In:Set,"%SetIteratorPrototype%":typeof Set>"u"||!mh||!vi?In:vi(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?In:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":mh&&vi?vi(""[Symbol.iterator]()):In,"%Symbol%":mh?Symbol:In,"%SyntaxError%":Ph,"%ThrowTypeError%":KE,"%TypedArray%":QE,"%TypeError%":Ch,"%Uint8Array%":typeof Uint8Array>"u"?In:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?In:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?In:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?In:Uint32Array,"%URIError%":YE,"%WeakMap%":typeof WeakMap>"u"?In:WeakMap,"%WeakRef%":typeof WeakRef>"u"?In:WeakRef,"%WeakSet%":typeof WeakSet>"u"?In:WeakSet};if(vi)try{null.error}catch(e){var $E=vi(vi(e));Zu["%Error.prototype%"]=$E}var tC=function e(t){var n;if(t==="%AsyncFunction%")n=Ay("async function () {}");else if(t==="%GeneratorFunction%")n=Ay("function* () {}");else if(t==="%AsyncGeneratorFunction%")n=Ay("async function* () {}");else if(t==="%AsyncGenerator%"){var r=e("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if(t==="%AsyncIteratorPrototype%"){var a=e("%AsyncGenerator%");a&&vi&&(n=vi(a.prototype))}return Zu[t]=n,n},x1={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Xf=F_,Pm=Hb,eC=Xf.call(Function.call,Array.prototype.concat),nC=Xf.call(Function.apply,Array.prototype.splice),b1=Xf.call(Function.call,String.prototype.replace),Am=Xf.call(Function.call,String.prototype.slice),rC=Xf.call(Function.call,RegExp.prototype.exec),iC=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,oC=/\\(\\)?/g,sC=function(t){var n=Am(t,0,1),r=Am(t,-1);if(n==="%"&&r!=="%")throw new Ph("invalid intrinsic syntax, expected closing `%`");if(r==="%"&&n!=="%")throw new Ph("invalid intrinsic syntax, expected opening `%`");var a=[];return b1(t,iC,function(u,p,c,b){a[a.length]=c?b1(b,oC,"$1"):p||u}),a},aC=function(t,n){var r=t,a;if(Pm(x1,r)&&(a=x1[r],r="%"+a[0]+"%"),Pm(Zu,r)){var u=Zu[r];if(u===bh&&(u=tC(r)),typeof u>"u"&&!n)throw new Ch("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:a,name:r,value:u}}throw new Ph("intrinsic "+t+" does not exist!")},Ga=function(t,n){if(typeof t!="string"||t.length===0)throw new Ch("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof n!="boolean")throw new Ch('"allowMissing" argument must be a boolean');if(rC(/^%?[^%]*%?$/,t)===null)throw new Ph("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var r=sC(t),a=r.length>0?r[0]:"",u=aC("%"+a+"%",n),p=u.name,c=u.value,b=!1,C=u.alias;C&&(a=C[0],nC(r,eC([0,1],C)));for(var A=1,P=!0;A<r.length;A+=1){var R=r[A],et=Am(R,0,1),X=Am(R,-1);if((et==='"'||et==="'"||et==="`"||X==='"'||X==="'"||X==="`")&&et!==X)throw new Ph("property names with quotes must have matching quotes");if((R==="constructor"||!P)&&(b=!0),a+="."+R,p="%"+a+"%",Pm(Zu,p))c=Zu[p];else if(c!=null){if(!(R in c)){if(!n)throw new Ch("base intrinsic for "+t+" exists, but the property is not available.");return}if(Wu&&A+1>=r.length){var K=Wu(c,R);P=!!K,P&&"get"in K&&!("originalValue"in K.get)?c=K.get:c=c[R]}else P=Pm(c,R),c=c[R];P&&!b&&(Zu[p]=c)}}return c},Dy,w1;function B_(){if(w1)return Dy;w1=1;var e=Ga,t=e("%Object.defineProperty%",!0)||!1;if(t)try{t({},"a",{value:1})}catch{t=!1}return Dy=t,Dy}var lC=Ga,bm=lC("%Object.getOwnPropertyDescriptor%",!0);if(bm)try{bm([],"length")}catch{bm=null}var V_=bm,S1=B_(),uC=Zb,gh=pu,I1=V_,U_=function(t,n,r){if(!t||typeof t!="object"&&typeof t!="function")throw new gh("`obj` must be an object or a function`");if(typeof n!="string"&&typeof n!="symbol")throw new gh("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new gh("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new gh("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new gh("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new gh("`loose`, if provided, must be a boolean");var a=arguments.length>3?arguments[3]:null,u=arguments.length>4?arguments[4]:null,p=arguments.length>5?arguments[5]:null,c=arguments.length>6?arguments[6]:!1,b=!!I1&&I1(t,n);if(S1)S1(t,n,{configurable:p===null&&b?b.configurable:!p,enumerable:a===null&&b?b.enumerable:!a,value:r,writable:u===null&&b?b.writable:!u});else if(c||!a&&!u&&!p)t[n]=r;else throw new uC("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},t_=B_(),Yb=function(){return!!t_};Yb.hasArrayLengthDefineBug=function(){if(!t_)return null;try{return t_([],"length",{value:1}).length!==1}catch{return!0}};var G_=Yb,cC=O_,hC=typeof Symbol=="function"&&typeof Symbol("foo")=="symbol",pC=Object.prototype.toString,fC=Array.prototype.concat,E1=U_,dC=function(e){return typeof e=="function"&&pC.call(e)==="[object Function]"},Kb=G_(),mC=function(e,t,n,r){if(t in e){if(r===!0){if(e[t]===n)return}else if(!dC(r)||!r())return}Kb?E1(e,t,n,!0):E1(e,t,n)},Jb=function(e,t){var n=arguments.length>2?arguments[2]:{},r=cC(t);hC&&(r=fC.call(r,Object.getOwnPropertySymbols(t)));for(var a=0;a<r.length;a+=1)mC(e,r[a],t[r[a]],n[r[a]])};Jb.supportsDescriptors=!!Kb;var lc=Jb,Qb={exports:{}},gC=Ga,C1=U_,yC=G_(),T1=V_,L1=pu,_C=gC("%Math.floor%"),vC=function(t,n){if(typeof t!="function")throw new L1("`fn` is not a function");if(typeof n!="number"||n<0||n>4294967295||_C(n)!==n)throw new L1("`length` must be a positive 32-bit integer");var r=arguments.length>2&&!!arguments[2],a=!0,u=!0;if("length"in t&&T1){var p=T1(t,"length");p&&!p.configurable&&(a=!1),p&&!p.writable&&(u=!1)}return(a||u||!r)&&(yC?C1(t,"length",n,!0,!0):C1(t,"length",n)),t};(function(e){var t=F_,n=Ga,r=vC,a=pu,u=n("%Function.prototype.apply%"),p=n("%Function.prototype.call%"),c=n("%Reflect.apply%",!0)||t.call(p,u),b=B_(),C=n("%Math.max%");e.exports=function(R){if(typeof R!="function")throw new a("a function is required");var et=c(t,p,arguments);return r(et,1+C(0,R.length-(arguments.length-1)),!0)};var A=function(){return c(t,u,arguments)};b?b(e.exports,"apply",{value:A}):e.exports.apply=A})(Qb);var Qh=Qb.exports,$b=Ga,tw=Qh,xC=tw($b("String.prototype.indexOf")),Gs=function(t,n){var r=$b(t,!!n);return typeof r=="function"&&xC(t,".prototype.")>-1?tw(r):r},bC=O_,ew=rg(),nw=Gs,P1=Object,wC=nw("Array.prototype.push"),A1=nw("Object.prototype.propertyIsEnumerable"),SC=ew?Object.getOwnPropertySymbols:null,rw=function(t,n){if(t==null)throw new TypeError("target must be an object");var r=P1(t);if(arguments.length===1)return r;for(var a=1;a<arguments.length;++a){var u=P1(arguments[a]),p=bC(u),c=ew&&(Object.getOwnPropertySymbols||SC);if(c)for(var b=c(u),C=0;C<b.length;++C){var A=b[C];A1(u,A)&&wC(p,A)}for(var P=0;P<p.length;++P){var R=p[P];if(A1(u,R)){var et=u[R];r[R]=et}}}return r},ky=rw,IC=function(){if(!Object.assign)return!1;for(var e="abcdefghijklmnopqrst",t=e.split(""),n={},r=0;r<t.length;++r)n[t[r]]=t[r];var a=Object.assign({},n),u="";for(var p in a)u+=p;return e!==u},EC=function(){if(!Object.assign||!Object.preventExtensions)return!1;var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch{return e[1]==="y"}return!1},iw=function(){return!Object.assign||IC()||EC()?ky:Object.assign},CC=lc,TC=iw,LC=function(){var t=TC();return CC(Object,{assign:t},{assign:function(){return Object.assign!==t}}),t},PC=lc,AC=Qh,MC=rw,ow=iw,DC=LC,kC=AC.apply(ow()),sw=function(t,n){return kC(Object,arguments)};PC(sw,{getPolyfill:ow,implementation:MC,shim:DC});var RC=sw,Pf=function(){return typeof(function(){}).name=="string"},If=Object.getOwnPropertyDescriptor;if(If)try{If([],"length")}catch{If=null}Pf.functionsHaveConfigurableNames=function(){if(!Pf()||!If)return!1;var t=If(function(){},"name");return!!t&&!!t.configurable};var NC=Function.prototype.bind;Pf.boundFunctionsHaveNames=function(){return Pf()&&typeof NC=="function"&&(function(){}).bind().name!==""};var OC=Pf,M1=U_,zC=G_(),FC=OC.functionsHaveConfigurableNames(),BC=pu,VC=function(t,n){if(typeof t!="function")throw new BC("`fn` is not a function");var r=arguments.length>2&&!!arguments[2];return(!r||FC)&&(zC?M1(t,"name",n,!0,!0):M1(t,"name",n)),t},UC=VC,GC=pu,qC=Object,aw=UC(function(){if(this==null||this!==qC(this))throw new GC("RegExp.prototype.flags getter called on non-object");var t="";return this.hasIndices&&(t+="d"),this.global&&(t+="g"),this.ignoreCase&&(t+="i"),this.multiline&&(t+="m"),this.dotAll&&(t+="s"),this.unicode&&(t+="u"),this.unicodeSets&&(t+="v"),this.sticky&&(t+="y"),t},"get flags",!0),jC=aw,WC=lc.supportsDescriptors,ZC=Object.getOwnPropertyDescriptor,lw=function(){if(WC&&/a/mig.flags==="gim"){var t=ZC(RegExp.prototype,"flags");if(t&&typeof t.get=="function"&&typeof RegExp.prototype.dotAll=="boolean"&&typeof RegExp.prototype.hasIndices=="boolean"){var n="",r={};if(Object.defineProperty(r,"hasIndices",{get:function(){n+="d"}}),Object.defineProperty(r,"sticky",{get:function(){n+="y"}}),n==="dy")return t.get}}return jC},HC=lc.supportsDescriptors,XC=lw,YC=Object.getOwnPropertyDescriptor,KC=Object.defineProperty,JC=TypeError,D1=Object.getPrototypeOf,QC=/a/,$C=function(){if(!HC||!D1)throw new JC("RegExp.prototype.flags requires a true ES5 environment that supports property descriptors");var t=XC(),n=D1(QC),r=YC(n,"flags");return(!r||r.get!==t)&&KC(n,"flags",{configurable:!0,enumerable:!1,get:t}),t},tT=lc,eT=Qh,nT=aw,uw=lw,rT=$C,cw=eT(uw());tT(cw,{getPolyfill:uw,implementation:nT,shim:rT});var iT=cw,wm={exports:{}},oT=rg,uc=function(){return oT()&&!!Symbol.toStringTag},sT=uc(),aT=Gs,e_=aT("Object.prototype.toString"),ig=function(t){return sT&&t&&typeof t=="object"&&Symbol.toStringTag in t?!1:e_(t)==="[object Arguments]"},hw=function(t){return ig(t)?!0:t!==null&&typeof t=="object"&&typeof t.length=="number"&&t.length>=0&&e_(t)!=="[object Array]"&&e_(t.callee)==="[object Function]"},lT=function(){return ig(arguments)}();ig.isLegacyArguments=hw;var pw=lT?ig:hw;const uT={},cT=Object.freeze(Object.defineProperty({__proto__:null,default:uT},Symbol.toStringTag,{value:"Module"})),hT=ng(cT);var q_=typeof Map=="function"&&Map.prototype,Ry=Object.getOwnPropertyDescriptor&&q_?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Mm=q_&&Ry&&typeof Ry.get=="function"?Ry.get:null,k1=q_&&Map.prototype.forEach,j_=typeof Set=="function"&&Set.prototype,Ny=Object.getOwnPropertyDescriptor&&j_?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Dm=j_&&Ny&&typeof Ny.get=="function"?Ny.get:null,R1=j_&&Set.prototype.forEach,pT=typeof WeakMap=="function"&&WeakMap.prototype,Ef=pT?WeakMap.prototype.has:null,fT=typeof WeakSet=="function"&&WeakSet.prototype,Cf=fT?WeakSet.prototype.has:null,dT=typeof WeakRef=="function"&&WeakRef.prototype,N1=dT?WeakRef.prototype.deref:null,mT=Boolean.prototype.valueOf,gT=Object.prototype.toString,yT=Function.prototype.toString,_T=String.prototype.match,W_=String.prototype.slice,Ql=String.prototype.replace,vT=String.prototype.toUpperCase,O1=String.prototype.toLowerCase,fw=RegExp.prototype.test,z1=Array.prototype.concat,ka=Array.prototype.join,xT=Array.prototype.slice,F1=Math.floor,n_=typeof BigInt=="function"?BigInt.prototype.valueOf:null,Oy=Object.getOwnPropertySymbols,r_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Symbol.prototype.toString:null,Ah=typeof Symbol=="function"&&typeof Symbol.iterator=="object",ro=typeof Symbol=="function"&&Symbol.toStringTag&&(typeof Symbol.toStringTag===Ah||"symbol")?Symbol.toStringTag:null,dw=Object.prototype.propertyIsEnumerable,B1=(typeof Reflect=="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function V1(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||fw.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof e=="number"){var r=e<0?-F1(-e):F1(e);if(r!==e){var a=String(r),u=W_.call(t,a.length+1);return Ql.call(a,n,"$&_")+"."+Ql.call(Ql.call(u,/([0-9]{3})/g,"$&_"),/_$/,"")}}return Ql.call(t,n,"$&_")}var i_=hT,U1=i_.custom,G1=gw(U1)?U1:null,bT=function e(t,n,r,a){var u=n||{};if(Kl(u,"quoteStyle")&&u.quoteStyle!=="single"&&u.quoteStyle!=="double")throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Kl(u,"maxStringLength")&&(typeof u.maxStringLength=="number"?u.maxStringLength<0&&u.maxStringLength!==1/0:u.maxStringLength!==null))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var p=Kl(u,"customInspect")?u.customInspect:!0;if(typeof p!="boolean"&&p!=="symbol")throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Kl(u,"indent")&&u.indent!==null&&u.indent!=="	"&&!(parseInt(u.indent,10)===u.indent&&u.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Kl(u,"numericSeparator")&&typeof u.numericSeparator!="boolean")throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var c=u.numericSeparator;if(typeof t>"u")return"undefined";if(t===null)return"null";if(typeof t=="boolean")return t?"true":"false";if(typeof t=="string")return _w(t,u);if(typeof t=="number"){if(t===0)return 1/0/t>0?"0":"-0";var b=String(t);return c?V1(t,b):b}if(typeof t=="bigint"){var C=String(t)+"n";return c?V1(t,C):C}var A=typeof u.depth>"u"?5:u.depth;if(typeof r>"u"&&(r=0),r>=A&&A>0&&typeof t=="object")return o_(t)?"[Array]":"[Object]";var P=BT(u,r);if(typeof a>"u")a=[];else if(yw(a,t)>=0)return"[Circular]";function R($t,le,Ye){if(le&&(a=xT.call(a),a.push(le)),Ye){var Ie={depth:u.depth};return Kl(u,"quoteStyle")&&(Ie.quoteStyle=u.quoteStyle),e($t,Ie,r+1,a)}return e($t,u,r+1,a)}if(typeof t=="function"&&!q1(t)){var et=AT(t),X=pm(t,R);return"[Function"+(et?": "+et:" (anonymous)")+"]"+(X.length>0?" { "+ka.call(X,", ")+" }":"")}if(gw(t)){var K=Ah?Ql.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):r_.call(t);return typeof t=="object"&&!Ah?lf(K):K}if(OT(t)){for(var ot="<"+O1.call(String(t.nodeName)),gt=t.attributes||[],q=0;q<gt.length;q++)ot+=" "+gt[q].name+"="+mw(wT(gt[q].value),"double",u);return ot+=">",t.childNodes&&t.childNodes.length&&(ot+="..."),ot+="</"+O1.call(String(t.nodeName))+">",ot}if(o_(t)){if(t.length===0)return"[]";var W=pm(t,R);return P&&!FT(W)?"["+s_(W,P)+"]":"[ "+ka.call(W,", ")+" ]"}if(IT(t)){var at=pm(t,R);return!("cause"in Error.prototype)&&"cause"in t&&!dw.call(t,"cause")?"{ ["+String(t)+"] "+ka.call(z1.call("[cause]: "+R(t.cause),at),", ")+" }":at.length===0?"["+String(t)+"]":"{ ["+String(t)+"] "+ka.call(at,", ")+" }"}if(typeof t=="object"&&p){if(G1&&typeof t[G1]=="function"&&i_)return i_(t,{depth:A-r});if(p!=="symbol"&&typeof t.inspect=="function")return t.inspect()}if(MT(t)){var dt=[];return k1&&k1.call(t,function($t,le){dt.push(R(le,t,!0)+" => "+R($t,t))}),j1("Map",Mm.call(t),dt,P)}if(RT(t)){var Pt=[];return R1&&R1.call(t,function($t){Pt.push(R($t,t))}),j1("Set",Dm.call(t),Pt,P)}if(DT(t))return zy("WeakMap");if(NT(t))return zy("WeakSet");if(kT(t))return zy("WeakRef");if(CT(t))return lf(R(Number(t)));if(LT(t))return lf(R(n_.call(t)));if(TT(t))return lf(mT.call(t));if(ET(t))return lf(R(String(t)));if(typeof window<"u"&&t===window)return"{ [object Window] }";if(t===Hf)return"{ [object globalThis] }";if(!ST(t)&&!q1(t)){var Mt=pm(t,R),Tt=B1?B1(t)===Object.prototype:t instanceof Object||t.constructor===Object,Ut=t instanceof Object?"":"null prototype",qt=!Tt&&ro&&Object(t)===t&&ro in t?W_.call(fu(t),8,-1):Ut?"Object":"",Q=Tt||typeof t.constructor!="function"?"":t.constructor.name?t.constructor.name+" ":"",Et=Q+(qt||Ut?"["+ka.call(z1.call([],qt||[],Ut||[]),": ")+"] ":"");return Mt.length===0?Et+"{}":P?Et+"{"+s_(Mt,P)+"}":Et+"{ "+ka.call(Mt,", ")+" }"}return String(t)};function mw(e,t,n){var r=(n.quoteStyle||t)==="double"?'"':"'";return r+e+r}function wT(e){return Ql.call(String(e),/"/g,"&quot;")}function o_(e){return fu(e)==="[object Array]"&&(!ro||!(typeof e=="object"&&ro in e))}function ST(e){return fu(e)==="[object Date]"&&(!ro||!(typeof e=="object"&&ro in e))}function q1(e){return fu(e)==="[object RegExp]"&&(!ro||!(typeof e=="object"&&ro in e))}function IT(e){return fu(e)==="[object Error]"&&(!ro||!(typeof e=="object"&&ro in e))}function ET(e){return fu(e)==="[object String]"&&(!ro||!(typeof e=="object"&&ro in e))}function CT(e){return fu(e)==="[object Number]"&&(!ro||!(typeof e=="object"&&ro in e))}function TT(e){return fu(e)==="[object Boolean]"&&(!ro||!(typeof e=="object"&&ro in e))}function gw(e){if(Ah)return e&&typeof e=="object"&&e instanceof Symbol;if(typeof e=="symbol")return!0;if(!e||typeof e!="object"||!r_)return!1;try{return r_.call(e),!0}catch{}return!1}function LT(e){if(!e||typeof e!="object"||!n_)return!1;try{return n_.call(e),!0}catch{}return!1}var PT=Object.prototype.hasOwnProperty||function(e){return e in this};function Kl(e,t){return PT.call(e,t)}function fu(e){return gT.call(e)}function AT(e){if(e.name)return e.name;var t=_T.call(yT.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function yw(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1}function MT(e){if(!Mm||!e||typeof e!="object")return!1;try{Mm.call(e);try{Dm.call(e)}catch{return!0}return e instanceof Map}catch{}return!1}function DT(e){if(!Ef||!e||typeof e!="object")return!1;try{Ef.call(e,Ef);try{Cf.call(e,Cf)}catch{return!0}return e instanceof WeakMap}catch{}return!1}function kT(e){if(!N1||!e||typeof e!="object")return!1;try{return N1.call(e),!0}catch{}return!1}function RT(e){if(!Dm||!e||typeof e!="object")return!1;try{Dm.call(e);try{Mm.call(e)}catch{return!0}return e instanceof Set}catch{}return!1}function NT(e){if(!Cf||!e||typeof e!="object")return!1;try{Cf.call(e,Cf);try{Ef.call(e,Ef)}catch{return!0}return e instanceof WeakSet}catch{}return!1}function OT(e){return!e||typeof e!="object"?!1:typeof HTMLElement<"u"&&e instanceof HTMLElement?!0:typeof e.nodeName=="string"&&typeof e.getAttribute=="function"}function _w(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return _w(W_.call(e,0,t.maxStringLength),t)+r}var a=Ql.call(Ql.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,zT);return mw(a,"single",t)}function zT(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+vT.call(t.toString(16))}function lf(e){return"Object("+e+")"}function zy(e){return e+" { ? }"}function j1(e,t,n,r){var a=r?s_(n,r):ka.call(n,", ");return e+" ("+t+") {"+a+"}"}function FT(e){for(var t=0;t<e.length;t++)if(yw(e[t],`
`)>=0)return!1;return!0}function BT(e,t){var n;if(e.indent==="	")n="	";else if(typeof e.indent=="number"&&e.indent>0)n=ka.call(Array(e.indent+1)," ");else return null;return{base:n,prev:ka.call(Array(t+1),n)}}function s_(e,t){if(e.length===0)return"";var n=`
`+t.prev+t.base;return n+ka.call(e,","+n)+`
`+t.prev}function pm(e,t){var n=o_(e),r=[];if(n){r.length=e.length;for(var a=0;a<e.length;a++)r[a]=Kl(e,a)?t(e[a],e):""}var u=typeof Oy=="function"?Oy(e):[],p;if(Ah){p={};for(var c=0;c<u.length;c++)p["$"+u[c]]=u[c]}for(var b in e)Kl(e,b)&&(n&&String(Number(b))===b&&b<e.length||Ah&&p["$"+b]instanceof Symbol||(fw.call(/[^\w$]/,b)?r.push(t(b,e)+": "+t(e[b],e)):r.push(b+": "+t(e[b],e))));if(typeof Oy=="function")for(var C=0;C<u.length;C++)dw.call(e,u[C])&&r.push("["+t(u[C])+"]: "+t(e[u[C]],e));return r}var vw=Ga,$h=Gs,VT=bT,UT=pu,fm=vw("%WeakMap%",!0),dm=vw("%Map%",!0),GT=$h("WeakMap.prototype.get",!0),qT=$h("WeakMap.prototype.set",!0),jT=$h("WeakMap.prototype.has",!0),WT=$h("Map.prototype.get",!0),ZT=$h("Map.prototype.set",!0),HT=$h("Map.prototype.has",!0),Z_=function(e,t){for(var n=e,r;(r=n.next)!==null;n=r)if(r.key===t)return n.next=r.next,r.next=e.next,e.next=r,r},XT=function(e,t){var n=Z_(e,t);return n&&n.value},YT=function(e,t,n){var r=Z_(e,t);r?r.value=n:e.next={key:t,next:e.next,value:n}},KT=function(e,t){return!!Z_(e,t)},xw=function(){var t,n,r,a={assert:function(u){if(!a.has(u))throw new UT("Side channel does not contain "+VT(u))},get:function(u){if(fm&&u&&(typeof u=="object"||typeof u=="function")){if(t)return GT(t,u)}else if(dm){if(n)return WT(n,u)}else if(r)return XT(r,u)},has:function(u){if(fm&&u&&(typeof u=="object"||typeof u=="function")){if(t)return jT(t,u)}else if(dm){if(n)return HT(n,u)}else if(r)return KT(r,u);return!1},set:function(u,p){fm&&u&&(typeof u=="object"||typeof u=="function")?(t||(t=new fm),qT(t,u,p)):dm?(n||(n=new dm),ZT(n,u,p)):(r||(r={key:{},next:null}),YT(r,u,p))}};return a},JT=Hb,uf=xw(),ll=pu,H_={assert:function(e,t){if(!e||typeof e!="object"&&typeof e!="function")throw new ll("`O` is not an object");if(typeof t!="string")throw new ll("`slot` must be a string");if(uf.assert(e),!H_.has(e,t))throw new ll("`"+t+"` is not present on `O`")},get:function(e,t){if(!e||typeof e!="object"&&typeof e!="function")throw new ll("`O` is not an object");if(typeof t!="string")throw new ll("`slot` must be a string");var n=uf.get(e);return n&&n["$"+t]},has:function(e,t){if(!e||typeof e!="object"&&typeof e!="function")throw new ll("`O` is not an object");if(typeof t!="string")throw new ll("`slot` must be a string");var n=uf.get(e);return!!n&&JT(n,"$"+t)},set:function(e,t,n){if(!e||typeof e!="object"&&typeof e!="function")throw new ll("`O` is not an object");if(typeof t!="string")throw new ll("`slot` must be a string");var r=uf.get(e);r||(r={},uf.set(e,r)),r["$"+t]=n}};Object.freeze&&Object.freeze(H_);var QT=H_,cf=QT,$T=SyntaxError,W1=typeof StopIteration=="object"?StopIteration:null,tL=function(t){if(!W1)throw new $T("this environment lacks StopIteration");cf.set(t,"[[Done]]",!1);var n={next:function(){var a=cf.get(this,"[[Iterator]]"),u=cf.get(a,"[[Done]]");try{return{done:u,value:u?void 0:a.next()}}catch(p){if(cf.set(a,"[[Done]]",!0),p!==W1)throw p;return{done:!0,value:void 0}}}};return cf.set(n,"[[Iterator]]",t),n},eL={}.toString,bw=Array.isArray||function(e){return eL.call(e)=="[object Array]"},nL=String.prototype.valueOf,rL=function(t){try{return nL.call(t),!0}catch{return!1}},iL=Object.prototype.toString,oL="[object String]",sL=uc(),ww=function(t){return typeof t=="string"?!0:typeof t!="object"?!1:sL?rL(t):iL.call(t)===oL},X_=typeof Map=="function"&&Map.prototype?Map:null,aL=typeof Set=="function"&&Set.prototype?Set:null,km;X_||(km=function(t){return!1});var Sw=X_?Map.prototype.has:null,Z1=aL?Set.prototype.has:null;!km&&!Sw&&(km=function(t){return!1});var Iw=km||function(t){if(!t||typeof t!="object")return!1;try{if(Sw.call(t),Z1)try{Z1.call(t)}catch{return!0}return t instanceof X_}catch{}return!1},lL=typeof Map=="function"&&Map.prototype?Map:null,Y_=typeof Set=="function"&&Set.prototype?Set:null,Rm;Y_||(Rm=function(t){return!1});var H1=lL?Map.prototype.has:null,Ew=Y_?Set.prototype.has:null;!Rm&&!Ew&&(Rm=function(t){return!1});var Cw=Rm||function(t){if(!t||typeof t!="object")return!1;try{if(Ew.call(t),H1)try{H1.call(t)}catch{return!0}return t instanceof Y_}catch{}return!1},X1=pw,Y1=tL;if(z_()||rg()){var Fy=Symbol.iterator;wm.exports=function(t){if(t!=null&&typeof t[Fy]<"u")return t[Fy]();if(X1(t))return Array.prototype[Fy].call(t)}}else{var uL=bw,cL=ww,K1=Ga,hL=K1("%Map%",!0),pL=K1("%Set%",!0),Qs=Gs,J1=Qs("Array.prototype.push"),Q1=Qs("String.prototype.charCodeAt"),fL=Qs("String.prototype.slice"),dL=function(t,n){var r=t.length;if(n+1>=r)return n+1;var a=Q1(t,n);if(a<55296||a>56319)return n+1;var u=Q1(t,n+1);return u<56320||u>57343?n+1:n+2},By=function(t){var n=0;return{next:function(){var a=n>=t.length,u;return a||(u=t[n],n+=1),{done:a,value:u}}}},$1=function(t,n){if(uL(t)||X1(t))return By(t);if(cL(t)){var r=0;return{next:function(){var u=dL(t,r),p=fL(t,r,u);return r=u,{done:u>t.length,value:p}}}}if(n&&typeof t["_es6-shim iterator_"]<"u")return t["_es6-shim iterator_"]()};if(!hL&&!pL)wm.exports=function(t){if(t!=null)return $1(t,!0)};else{var mL=Iw,gL=Cw,tx=Qs("Map.prototype.forEach",!0),ex=Qs("Set.prototype.forEach",!0);if(typeof process>"u"||!process.versions||!process.versions.node)var nx=Qs("Map.prototype.iterator",!0),rx=Qs("Set.prototype.iterator",!0);var ix=Qs("Map.prototype.@@iterator",!0)||Qs("Map.prototype._es6-shim iterator_",!0),ox=Qs("Set.prototype.@@iterator",!0)||Qs("Set.prototype._es6-shim iterator_",!0),yL=function(t){if(mL(t)){if(nx)return Y1(nx(t));if(ix)return ix(t);if(tx){var n=[];return tx(t,function(a,u){J1(n,[u,a])}),By(n)}}if(gL(t)){if(rx)return Y1(rx(t));if(ox)return ox(t);if(ex){var r=[];return ex(t,function(a){J1(r,a)}),By(r)}}};wm.exports=function(t){return yL(t)||$1(t)}}}var _L=wm.exports,sx=function(e){return e!==e},Tw=function(t,n){return t===0&&n===0?1/t===1/n:!!(t===n||sx(t)&&sx(n))},vL=Tw,Lw=function(){return typeof Object.is=="function"?Object.is:vL},xL=Lw,bL=lc,wL=function(){var t=xL();return bL(Object,{is:t},{is:function(){return Object.is!==t}}),t},SL=lc,IL=Qh,EL=Tw,Pw=Lw,CL=wL,Aw=IL(Pw(),Object);SL(Aw,{getPolyfill:Pw,implementation:EL,shim:CL});var TL=Aw,LL=Qh,Mw=Gs,PL=Ga,a_=PL("%ArrayBuffer%",!0),Sm=Mw("ArrayBuffer.prototype.byteLength",!0),AL=Mw("Object.prototype.toString"),ax=!!a_&&!Sm&&new a_(0).slice,lx=!!ax&&LL(ax),Dw=Sm||lx?function(t){if(!t||typeof t!="object")return!1;try{return Sm?Sm(t):lx(t,0),!0}catch{return!1}}:a_?function(t){return AL(t)==="[object ArrayBuffer]"}:function(t){return!1},ML=Date.prototype.getDay,DL=function(t){try{return ML.call(t),!0}catch{return!1}},kL=Object.prototype.toString,RL="[object Date]",NL=uc(),OL=function(t){return typeof t!="object"||t===null?!1:NL?DL(t):kL.call(t)===RL},l_=Gs,kw=uc(),Rw,Nw,u_,c_;if(kw){Rw=l_("Object.prototype.hasOwnProperty"),Nw=l_("RegExp.prototype.exec"),u_={};var Vy=function(){throw u_};c_={toString:Vy,valueOf:Vy},typeof Symbol.toPrimitive=="symbol"&&(c_[Symbol.toPrimitive]=Vy)}var zL=l_("Object.prototype.toString"),FL=Object.getOwnPropertyDescriptor,BL="[object RegExp]",VL=kw?function(t){if(!t||typeof t!="object")return!1;var n=FL(t,"lastIndex"),r=n&&Rw(n,"value");if(!r)return!1;try{Nw(t,c_)}catch(a){return a===u_}}:function(t){return!t||typeof t!="object"&&typeof t!="function"?!1:zL(t)===BL},UL=Gs,ux=UL("SharedArrayBuffer.prototype.byteLength",!0),GL=ux?function(t){if(!t||typeof t!="object")return!1;try{return ux(t),!0}catch{return!1}}:function(t){return!1},qL=Number.prototype.toString,jL=function(t){try{return qL.call(t),!0}catch{return!1}},WL=Object.prototype.toString,ZL="[object Number]",HL=uc(),XL=function(t){return typeof t=="number"?!0:typeof t!="object"?!1:HL?jL(t):WL.call(t)===ZL},Ow=Gs,YL=Ow("Boolean.prototype.toString"),KL=Ow("Object.prototype.toString"),JL=function(t){try{return YL(t),!0}catch{return!1}},QL="[object Boolean]",$L=uc(),tP=function(t){return typeof t=="boolean"?!0:t===null||typeof t!="object"?!1:$L&&Symbol.toStringTag in t?JL(t):KL(t)===QL},h_={exports:{}},eP=Object.prototype.toString,nP=z_();if(nP){var rP=Symbol.prototype.toString,iP=/^Symbol\(.*\)$/,oP=function(t){return typeof t.valueOf()!="symbol"?!1:iP.test(rP.call(t))};h_.exports=function(t){if(typeof t=="symbol")return!0;if(eP.call(t)!=="[object Symbol]")return!1;try{return oP(t)}catch{return!1}}}else h_.exports=function(t){return!1};var sP=h_.exports,p_={exports:{}},cx=typeof BigInt<"u"&&BigInt,aP=function(){return typeof cx=="function"&&typeof BigInt=="function"&&typeof cx(42)=="bigint"&&typeof BigInt(42)=="bigint"},lP=aP();if(lP){var uP=BigInt.prototype.valueOf,cP=function(t){try{return uP.call(t),!0}catch{}return!1};p_.exports=function(t){return t===null||typeof t>"u"||typeof t=="boolean"||typeof t=="string"||typeof t=="number"||typeof t=="symbol"||typeof t=="function"?!1:typeof t=="bigint"?!0:cP(t)}}else p_.exports=function(t){return!1};var hP=p_.exports,pP=ww,fP=XL,dP=tP,mP=sP,gP=hP,yP=function(t){if(t==null||typeof t!="object"&&typeof t!="function")return null;if(pP(t))return"String";if(fP(t))return"Number";if(dP(t))return"Boolean";if(mP(t))return"Symbol";if(gP(t))return"BigInt"},Nm=typeof WeakMap=="function"&&WeakMap.prototype?WeakMap:null,hx=typeof WeakSet=="function"&&WeakSet.prototype?WeakSet:null,Om;Nm||(Om=function(t){return!1});var f_=Nm?Nm.prototype.has:null,Uy=hx?hx.prototype.has:null;!Om&&!f_&&(Om=function(t){return!1});var _P=Om||function(t){if(!t||typeof t!="object")return!1;try{if(f_.call(t,f_),Uy)try{Uy.call(t,Uy)}catch{return!0}return t instanceof Nm}catch{}return!1},d_={exports:{}},vP=Ga,zw=Gs,xP=vP("%WeakSet%",!0),Gy=zw("WeakSet.prototype.has",!0);if(Gy){var qy=zw("WeakMap.prototype.has",!0);d_.exports=function(t){if(!t||typeof t!="object")return!1;try{if(Gy(t,Gy),qy)try{qy(t,qy)}catch{return!0}return t instanceof xP}catch{}return!1}}else d_.exports=function(t){return!1};var bP=d_.exports,wP=Iw,SP=Cw,IP=_P,EP=bP,CP=function(t){if(t&&typeof t=="object"){if(wP(t))return"Map";if(SP(t))return"Set";if(IP(t))return"WeakMap";if(EP(t))return"WeakSet"}return!1},Fw=Function.prototype.toString,wh=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,m_,Im;if(typeof wh=="function"&&typeof Object.defineProperty=="function")try{m_=Object.defineProperty({},"length",{get:function(){throw Im}}),Im={},wh(function(){throw 42},null,m_)}catch(e){e!==Im&&(wh=null)}else wh=null;var TP=/^\s*class\b/,g_=function(t){try{var n=Fw.call(t);return TP.test(n)}catch{return!1}},jy=function(t){try{return g_(t)?!1:(Fw.call(t),!0)}catch{return!1}},Em=Object.prototype.toString,LP="[object Object]",PP="[object Function]",AP="[object GeneratorFunction]",MP="[object HTMLAllCollection]",DP="[object HTML document.all class]",kP="[object HTMLCollection]",RP=typeof Symbol=="function"&&!!Symbol.toStringTag,NP=!(0 in[,]),y_=function(){return!1};if(typeof document=="object"){var OP=document.all;Em.call(OP)===Em.call(document.all)&&(y_=function(t){if((NP||!t)&&(typeof t>"u"||typeof t=="object"))try{var n=Em.call(t);return(n===MP||n===DP||n===kP||n===LP)&&t("")==null}catch{}return!1})}var zP=wh?function(t){if(y_(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;try{wh(t,null,m_)}catch(n){if(n!==Im)return!1}return!g_(t)&&jy(t)}:function(t){if(y_(t))return!0;if(!t||typeof t!="function"&&typeof t!="object")return!1;if(RP)return jy(t);if(g_(t))return!1;var n=Em.call(t);return n!==PP&&n!==AP&&!/^\[object HTML/.test(n)?!1:jy(t)},FP=zP,BP=Object.prototype.toString,Bw=Object.prototype.hasOwnProperty,VP=function(t,n,r){for(var a=0,u=t.length;a<u;a++)Bw.call(t,a)&&(r==null?n(t[a],a,t):n.call(r,t[a],a,t))},UP=function(t,n,r){for(var a=0,u=t.length;a<u;a++)r==null?n(t.charAt(a),a,t):n.call(r,t.charAt(a),a,t)},GP=function(t,n,r){for(var a in t)Bw.call(t,a)&&(r==null?n(t[a],a,t):n.call(r,t[a],a,t))},qP=function(t,n,r){if(!FP(n))throw new TypeError("iterator must be a function");var a;arguments.length>=3&&(a=r),BP.call(t)==="[object Array]"?VP(t,n,a):typeof t=="string"?UP(t,n,a):GP(t,n,a)},jP=qP,WP=["Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"],Wy=WP,ZP=typeof globalThis>"u"?Hf:globalThis,HP=function(){for(var t=[],n=0;n<Wy.length;n++)typeof ZP[Wy[n]]=="function"&&(t[t.length]=Wy[n]);return t},zm=jP,XP=HP,px=Qh,K_=Gs,Cm=V_,YP=K_("Object.prototype.toString"),Vw=uc(),fx=typeof globalThis>"u"?Hf:globalThis,__=XP(),J_=K_("String.prototype.slice"),Zy=Object.getPrototypeOf,KP=K_("Array.prototype.indexOf",!0)||function(t,n){for(var r=0;r<t.length;r+=1)if(t[r]===n)return r;return-1},Fm={__proto__:null};Vw&&Cm&&Zy?zm(__,function(e){var t=new fx[e];if(Symbol.toStringTag in t){var n=Zy(t),r=Cm(n,Symbol.toStringTag);if(!r){var a=Zy(n);r=Cm(a,Symbol.toStringTag)}Fm["$"+e]=px(r.get)}}):zm(__,function(e){var t=new fx[e],n=t.slice||t.set;n&&(Fm["$"+e]=px(n))});var JP=function(t){var n=!1;return zm(Fm,function(r,a){if(!n)try{"$"+r(t)===a&&(n=J_(a,1))}catch{}}),n},QP=function(t){var n=!1;return zm(Fm,function(r,a){if(!n)try{r(t),n=J_(a,1)}catch{}}),n},$P=function(t){if(!t||typeof t!="object")return!1;if(!Vw){var n=J_(YP(t),8,-1);return KP(__,n)>-1?n:n!=="Object"?!1:QP(t)}return Cm?JP(t):null},tA=Gs,dx=tA("ArrayBuffer.prototype.byteLength",!0),eA=Dw,nA=function(t){return eA(t)?dx?dx(t):t.byteLength:NaN},Uw=RC,qa=Gs,mx=iT,rA=Ga,Mh=_L,iA=xw,gx=TL,yx=pw,_x=bw,vx=Dw,xx=OL,bx=VL,wx=GL,Sx=O_,Ix=yP,Ex=CP,Cx=$P,Tx=nA,Lx=qa("SharedArrayBuffer.prototype.byteLength",!0),Px=qa("Date.prototype.getTime"),Hy=Object.getPrototypeOf,Ax=qa("Object.prototype.toString"),Bm=rA("%Set%",!0),v_=qa("Map.prototype.has",!0),Vm=qa("Map.prototype.get",!0),Mx=qa("Map.prototype.size",!0),Um=qa("Set.prototype.add",!0),Gw=qa("Set.prototype.delete",!0),Gm=qa("Set.prototype.has",!0),Tm=qa("Set.prototype.size",!0);function Dx(e,t,n,r){for(var a=Mh(e),u;(u=a.next())&&!u.done;)if(na(t,u.value,n,r))return Gw(e,u.value),!0;return!1}function qw(e){if(typeof e>"u")return null;if(typeof e!="object")return typeof e=="symbol"?!1:typeof e=="string"||typeof e=="number"?+e==+e:!0}function oA(e,t,n,r,a,u){var p=qw(n);if(p!=null)return p;var c=Vm(t,p),b=Uw({},a,{strict:!1});return typeof c>"u"&&!v_(t,p)||!na(r,c,b,u)?!1:!v_(e,p)&&na(r,c,b,u)}function sA(e,t,n){var r=qw(n);return r??(Gm(t,r)&&!Gm(e,r))}function kx(e,t,n,r,a,u){for(var p=Mh(e),c,b;(c=p.next())&&!c.done;)if(b=c.value,na(n,b,a,u)&&na(r,Vm(t,b),a,u))return Gw(e,b),!0;return!1}function na(e,t,n,r){var a=n||{};if(a.strict?gx(e,t):e===t)return!0;var u=Ix(e),p=Ix(t);if(u!==p)return!1;if(!e||!t||typeof e!="object"&&typeof t!="object")return a.strict?gx(e,t):e==t;var c=r.has(e),b=r.has(t),C;if(c&&b){if(r.get(e)===r.get(t))return!0}else C={};return c||r.set(e,C),b||r.set(t,C),uA(e,t,a,r)}function Rx(e){return!e||typeof e!="object"||typeof e.length!="number"||typeof e.copy!="function"||typeof e.slice!="function"||e.length>0&&typeof e[0]!="number"?!1:!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}function aA(e,t,n,r){if(Tm(e)!==Tm(t))return!1;for(var a=Mh(e),u=Mh(t),p,c,b;(p=a.next())&&!p.done;)if(p.value&&typeof p.value=="object")b||(b=new Bm),Um(b,p.value);else if(!Gm(t,p.value)){if(n.strict||!sA(e,t,p.value))return!1;b||(b=new Bm),Um(b,p.value)}if(b){for(;(c=u.next())&&!c.done;)if(c.value&&typeof c.value=="object"){if(!Dx(b,c.value,n.strict,r))return!1}else if(!n.strict&&!Gm(e,c.value)&&!Dx(b,c.value,n.strict,r))return!1;return Tm(b)===0}return!0}function lA(e,t,n,r){if(Mx(e)!==Mx(t))return!1;for(var a=Mh(e),u=Mh(t),p,c,b,C,A,P;(p=a.next())&&!p.done;)if(C=p.value[0],A=p.value[1],C&&typeof C=="object")b||(b=new Bm),Um(b,C);else if(P=Vm(t,C),typeof P>"u"&&!v_(t,C)||!na(A,P,n,r)){if(n.strict||!oA(e,t,C,A,n,r))return!1;b||(b=new Bm),Um(b,C)}if(b){for(;(c=u.next())&&!c.done;)if(C=c.value[0],P=c.value[1],C&&typeof C=="object"){if(!kx(b,e,C,P,n,r))return!1}else if(!n.strict&&(!e.has(C)||!na(Vm(e,C),P,n,r))&&!kx(b,e,C,P,Uw({},n,{strict:!1}),r))return!1;return Tm(b)===0}return!0}function uA(e,t,n,r){var a,u;if(typeof e!=typeof t||e==null||t==null||Ax(e)!==Ax(t)||yx(e)!==yx(t))return!1;var p=_x(e),c=_x(t);if(p!==c)return!1;var b=e instanceof Error,C=t instanceof Error;if(b!==C||(b||C)&&(e.name!==t.name||e.message!==t.message))return!1;var A=bx(e),P=bx(t);if(A!==P||(A||P)&&(e.source!==t.source||mx(e)!==mx(t)))return!1;var R=xx(e),et=xx(t);if(R!==et||(R||et)&&Px(e)!==Px(t)||n.strict&&Hy&&Hy(e)!==Hy(t))return!1;var X=Cx(e),K=Cx(t);if(X!==K)return!1;if(X||K){if(e.length!==t.length)return!1;for(a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}var ot=Rx(e),gt=Rx(t);if(ot!==gt)return!1;if(ot||gt){if(e.length!==t.length)return!1;for(a=0;a<e.length;a++)if(e[a]!==t[a])return!1;return!0}var q=vx(e),W=vx(t);if(q!==W)return!1;if(q||W)return Tx(e)!==Tx(t)?!1:typeof Uint8Array=="function"&&na(new Uint8Array(e),new Uint8Array(t),n,r);var at=wx(e),dt=wx(t);if(at!==dt)return!1;if(at||dt)return Lx(e)!==Lx(t)?!1:typeof Uint8Array=="function"&&na(new Uint8Array(e),new Uint8Array(t),n,r);if(typeof e!=typeof t)return!1;var Pt=Sx(e),Mt=Sx(t);if(Pt.length!==Mt.length)return!1;for(Pt.sort(),Mt.sort(),a=Pt.length-1;a>=0;a--)if(Pt[a]!=Mt[a])return!1;for(a=Pt.length-1;a>=0;a--)if(u=Pt[a],!na(e[u],t[u],n,r))return!1;var Tt=Ex(e),Ut=Ex(t);return Tt!==Ut?!1:Tt==="Set"||Ut==="Set"?aA(e,t,n,r):Tt==="Map"?lA(e,t,n,r):!0}var cA=function(t,n,r){return na(t,n,r,iA())};const hA=N_(cA);var pA=Object.defineProperty,qn=(e,t)=>pA(e,"name",{value:t,configurable:!0}),fA=class{constructor(t){this.direction=!1,this.compareProperties=!0;var n,r,a;this.precision=10**-((n=t==null?void 0:t.precision)!=null?n:17),this.direction=(r=t==null?void 0:t.direction)!=null?r:!1,this.compareProperties=(a=t==null?void 0:t.compareProperties)!=null?a:!0}compare(t,n){if(t.type!==n.type||!xf(t,n))return!1;switch(t.type){case"Point":return this.compareCoord(t.coordinates,n.coordinates);case"LineString":return this.compareLine(t.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(t,n);case"GeometryCollection":return this.compareGeometryCollection(t,n);case"Feature":return this.compareFeature(t,n);case"FeatureCollection":return this.compareFeatureCollection(t,n);default:if(t.type.startsWith("Multi")){const r=x_(t),a=x_(n);return r.every(u=>a.some(p=>this.compare(u,p)))}}return!1}compareCoord(t,n){return t.length===n.length&&t.every((r,a)=>Math.abs(r-n[a])<this.precision)}compareLine(t,n,r=0,a=!1){if(!xf(t,n))return!1;const u=t;let p=n;if(a&&!this.compareCoord(u[0],p[0])){const b=this.fixStartIndex(p,u);if(b)p=b;else return!1}const c=this.compareCoord(u[r],p[r]);return this.direction||c?this.comparePath(u,p):this.compareCoord(u[r],p[p.length-(1+r)])?this.comparePath(u.slice().reverse(),p):!1}fixStartIndex(t,n){let r,a=-1;for(let u=0;u<t.length;u++)if(this.compareCoord(t[u],n[0])){a=u;break}return a>=0&&(r=[].concat(t.slice(a,t.length),t.slice(1,a+1))),r}comparePath(t,n){return t.every((r,a)=>this.compareCoord(r,n[a]))}comparePolygon(t,n){if(this.compareLine(t.coordinates[0],n.coordinates[0],1,!0)){const r=t.coordinates.slice(1,t.coordinates.length),a=n.coordinates.slice(1,n.coordinates.length);return r.every(u=>a.some(p=>this.compareLine(u,p,1,!0)))}return!1}compareGeometryCollection(t,n){return xf(t.geometries,n.geometries)&&this.compareBBox(t,n)&&t.geometries.every((r,a)=>this.compare(r,n.geometries[a]))}compareFeature(t,n){return t.id===n.id&&(this.compareProperties?hA(t.properties,n.properties):!0)&&this.compareBBox(t,n)&&this.compare(t.geometry,n.geometry)}compareFeatureCollection(t,n){return xf(t.features,n.features)&&this.compareBBox(t,n)&&t.features.every((r,a)=>this.compare(r,n.features[a]))}compareBBox(t,n){return!t.bbox&&!n.bbox||(t.bbox&&n.bbox?this.compareCoord(t.bbox,n.bbox):!1)}};qn(fA,"GeojsonEquality");function xf(e,t){return e.coordinates?e.coordinates.length===t.coordinates.length:e.length===t.length}qn(xf,"sameLength");function x_(e){return e.coordinates.map(t=>({type:e.type.replace("Multi",""),coordinates:t}))}qn(x_,"explode");var Qo=63710088e-1,jw={centimeters:Qo*100,centimetres:Qo*100,degrees:360/(2*Math.PI),feet:Qo*3.28084,inches:Qo*39.37,kilometers:Qo/1e3,kilometres:Qo/1e3,meters:Qo,metres:Qo,miles:Qo/1609.344,millimeters:Qo*1e3,millimetres:Qo*1e3,nauticalmiles:Qo/1852,radians:1,yards:Qo*1.0936},Nx={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Na(e,t,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}qn(Na,"feature");function dA(e,t,n={}){switch(e){case"Point":return hl(t).geometry;case"LineString":return fl(t).geometry;case"Polygon":return Q_(t).geometry;case"MultiPoint":return Zw(t).geometry;case"MultiLineString":return Ww(t).geometry;case"MultiPolygon":return Hw(t).geometry;default:throw new Error(e+" is invalid")}}qn(dA,"geometry");function hl(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!qm(e[0])||!qm(e[1]))throw new Error("coordinates must contain numbers");return Na({type:"Point",coordinates:e},t,n)}qn(hl,"point");function mA(e,t,n={}){return og(e.map(r=>hl(r,t)),n)}qn(mA,"points");function Q_(e,t,n={}){for(const a of e){if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(a[a.length-1].length!==a[0].length)throw new Error("First and last Position are not equivalent.");for(let u=0;u<a[a.length-1].length;u++)if(a[a.length-1][u]!==a[0][u])throw new Error("First and last Position are not equivalent.")}return Na({type:"Polygon",coordinates:e},t,n)}qn(Q_,"polygon");function gA(e,t,n={}){return og(e.map(r=>Q_(r,t)),n)}qn(gA,"polygons");function fl(e,t,n={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return Na({type:"LineString",coordinates:e},t,n)}qn(fl,"lineString");function yA(e,t,n={}){return og(e.map(r=>fl(r,t)),n)}qn(yA,"lineStrings");function og(e,t={}){const n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}qn(og,"featureCollection");function Ww(e,t,n={}){return Na({type:"MultiLineString",coordinates:e},t,n)}qn(Ww,"multiLineString");function Zw(e,t,n={}){return Na({type:"MultiPoint",coordinates:e},t,n)}qn(Zw,"multiPoint");function Hw(e,t,n={}){return Na({type:"MultiPolygon",coordinates:e},t,n)}qn(Hw,"multiPolygon");function _A(e,t,n={}){return Na({type:"GeometryCollection",geometries:e},t,n)}qn(_A,"geometryCollection");function vA(e,t=0){if(t&&!(t>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,t||0);return Math.round(e*n)/n}qn(vA,"round");function Xw(e,t="kilometers"){const n=jw[t];if(!n)throw new Error(t+" units is invalid");return e*n}qn(Xw,"radiansToLength");function $_(e,t="kilometers"){const n=jw[t];if(!n)throw new Error(t+" units is invalid");return e/n}qn($_,"lengthToRadians");function xA(e,t){return Yw($_(e,t))}qn(xA,"lengthToDegrees");function bA(e){let t=e%360;return t<0&&(t+=360),t}qn(bA,"bearingToAzimuth");function Yw(e){return e%(2*Math.PI)*180/Math.PI}qn(Yw,"radiansToDegrees");function wA(e){return e%360*Math.PI/180}qn(wA,"degreesToRadians");function SA(e,t="kilometers",n="kilometers"){if(!(e>=0))throw new Error("length must be a positive number");return Xw($_(e,t),n)}qn(SA,"convertLength");function IA(e,t="meters",n="kilometers"){if(!(e>=0))throw new Error("area must be a positive number");const r=Nx[t];if(!r)throw new Error("invalid original units");const a=Nx[n];if(!a)throw new Error("invalid final units");return e/r*a}qn(IA,"convertArea");function qm(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}qn(qm,"isNumber");function t0(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}qn(t0,"isObject");function EA(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(t=>{if(!qm(t))throw new Error("bbox must only contain numbers")})}qn(EA,"validateBBox");function CA(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}qn(CA,"validateId");var TA=Object.defineProperty,Vi=(e,t)=>TA(e,"name",{value:t,configurable:!0});function tp(e,t,n){if(e!==null)for(var r,a,u,p,c,b,C,A=0,P=0,R,et=e.type,X=et==="FeatureCollection",K=et==="Feature",ot=X?e.features.length:1,gt=0;gt<ot;gt++){C=X?e.features[gt].geometry:K?e.geometry:e,R=C?C.type==="GeometryCollection":!1,c=R?C.geometries.length:1;for(var q=0;q<c;q++){var W=0,at=0;if(p=R?C.geometries[q]:C,p!==null){b=p.coordinates;var dt=p.type;switch(A=n&&(dt==="Polygon"||dt==="MultiPolygon")?1:0,dt){case null:break;case"Point":if(t(b,P,gt,W,at)===!1)return!1;P++,W++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],P,gt,W,at)===!1)return!1;P++,dt==="MultiPoint"&&W++}dt==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],P,gt,W,at)===!1)return!1;P++}dt==="MultiLineString"&&W++,dt==="Polygon"&&at++}dt==="Polygon"&&W++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(at=0,a=0;a<b[r].length;a++){for(u=0;u<b[r][a].length-A;u++){if(t(b[r][a][u],P,gt,W,at)===!1)return!1;P++}at++}W++}break;case"GeometryCollection":for(r=0;r<p.geometries.length;r++)if(tp(p.geometries[r],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}Vi(tp,"coordEach");function LA(e,t,n,r){var a=n;return tp(e,function(u,p,c,b,C){p===0&&n===void 0?a=u:a=t(a,u,p,c,b,C)},r),a}Vi(LA,"coordReduce");function Kw(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&t(e.features[n].properties,n)!==!1;n++);break;case"Feature":t(e.properties,0);break}}Vi(Kw,"propEach");function PA(e,t,n){var r=n;return Kw(e,function(a,u){u===0&&n===void 0?r=a:r=t(r,a,u)}),r}Vi(PA,"propReduce");function Jw(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}Vi(Jw,"featureEach");function AA(e,t,n){var r=n;return Jw(e,function(a,u){u===0&&n===void 0?r=a:r=t(r,a,u)}),r}Vi(AA,"featureReduce");function MA(e){var t=[];return tp(e,function(n){t.push(n)}),t}Vi(MA,"coordAll");function e0(e,t){var n,r,a,u,p,c,b,C,A,P,R=0,et=e.type==="FeatureCollection",X=e.type==="Feature",K=et?e.features.length:1;for(n=0;n<K;n++){for(c=et?e.features[n].geometry:X?e.geometry:e,C=et?e.features[n].properties:X?e.properties:{},A=et?e.features[n].bbox:X?e.bbox:void 0,P=et?e.features[n].id:X?e.id:void 0,b=c?c.type==="GeometryCollection":!1,p=b?c.geometries.length:1,a=0;a<p;a++){if(u=b?c.geometries[a]:c,u===null){if(t(null,R,C,A,P)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,R,C,A,P)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<u.geometries.length;r++)if(t(u.geometries[r],R,C,A,P)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}Vi(e0,"geomEach");function DA(e,t,n){var r=n;return e0(e,function(a,u,p,c,b){u===0&&n===void 0?r=a:r=t(r,a,u,p,c,b)}),r}Vi(DA,"geomReduce");function sg(e,t){e0(e,function(n,r,a,u,p){var c=n===null?null:n.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return t(Na(n,a,{bbox:u,id:p}),r,0)===!1?!1:void 0}var b;switch(c){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var C=0;C<n.coordinates.length;C++){var A=n.coordinates[C],P={type:b,coordinates:A};if(t(Na(P,a),r,C)===!1)return!1}})}Vi(sg,"flattenEach");function kA(e,t,n){var r=n;return sg(e,function(a,u,p){u===0&&p===0&&n===void 0?r=a:r=t(r,a,u,p)}),r}Vi(kA,"flattenReduce");function Qw(e,t){sg(e,function(n,r,a){var u=0;if(n.geometry){var p=n.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var c,b=0,C=0,A=0;if(tp(n,function(P,R,et,X,K){if(c===void 0||r>b||X>C||K>A){c=P,b=r,C=X,A=K,u=0;return}var ot=fl([c,P],n.properties);if(t(ot,r,a,K,u)===!1)return!1;u++,c=P})===!1)return!1}}})}Vi(Qw,"segmentEach");function RA(e,t,n){var r=n,a=!1;return Qw(e,function(u,p,c,b,C){a===!1&&n===void 0?r=u:r=t(r,u,p,c,b,C),a=!0}),r}Vi(RA,"segmentReduce");function $w(e,t){if(!e)throw new Error("geojson is required");sg(e,function(n,r,a){if(n.geometry!==null){var u=n.geometry.type,p=n.geometry.coordinates;switch(u){case"LineString":if(t(n,r,a,0,0)===!1)return!1;break;case"Polygon":for(var c=0;c<p.length;c++)if(t(fl(p[c],n.properties),r,a,c)===!1)return!1;break}}})}Vi($w,"lineEach");function NA(e,t,n){var r=n;return $w(e,function(a,u,p,c){u===0&&n===void 0?r=a:r=t(r,a,u,p,c)}),r}Vi(NA,"lineReduce");function OA(e,t){if(t=t||{},!t0(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,a=t.geometryIndex||0,u=t.segmentIndex||0,p=t.properties,c;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),p=p||e.features[n].properties,c=e.features[n].geometry;break;case"Feature":p=p||e.properties,c=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":c=e;break;default:throw new Error("geojson is invalid")}if(c===null)return null;var b=c.coordinates;switch(c.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=b.length+u-1),fl([b[u],b[u+1]],p,t);case"Polygon":return a<0&&(a=b.length+a),u<0&&(u=b[a].length+u-1),fl([b[a][u],b[a][u+1]],p,t);case"MultiLineString":return r<0&&(r=b.length+r),u<0&&(u=b[r].length+u-1),fl([b[r][u],b[r][u+1]],p,t);case"MultiPolygon":return r<0&&(r=b.length+r),a<0&&(a=b[r].length+a),u<0&&(u=b[r][a].length-u-1),fl([b[r][a][u],b[r][a][u+1]],p,t)}throw new Error("geojson is invalid")}Vi(OA,"findSegment");function zA(e,t){if(t=t||{},!t0(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,a=t.geometryIndex||0,u=t.coordIndex||0,p=t.properties,c;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),p=p||e.features[n].properties,c=e.features[n].geometry;break;case"Feature":p=p||e.properties,c=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":c=e;break;default:throw new Error("geojson is invalid")}if(c===null)return null;var b=c.coordinates;switch(c.type){case"Point":return hl(b,p,t);case"MultiPoint":return r<0&&(r=b.length+r),hl(b[r],p,t);case"LineString":return u<0&&(u=b.length+u),hl(b[u],p,t);case"Polygon":return a<0&&(a=b.length+a),u<0&&(u=b[a].length+u),hl(b[a][u],p,t);case"MultiLineString":return r<0&&(r=b.length+r),u<0&&(u=b[r].length+u),hl(b[r][u],p,t);case"MultiPolygon":return r<0&&(r=b.length+r),a<0&&(a=b[r].length+a),u<0&&(u=b[r][a].length-u),hl(b[r][a][u],p,t)}throw new Error("geojson is invalid")}Vi(zA,"findPoint");var FA=Object.defineProperty,BA=(e,t)=>FA(e,"name",{value:t,configurable:!0});function n0(e,t={}){if(e.bbox!=null&&t.recompute!==!0)return e.bbox;const n=[1/0,1/0,-1/0,-1/0];return tp(e,r=>{n[0]>r[0]&&(n[0]=r[0]),n[1]>r[1]&&(n[1]=r[1]),n[2]<r[0]&&(n[2]=r[0]),n[3]<r[1]&&(n[3]=r[1])}),n}BA(n0,"bbox");var t2=n0;const VA=Object.freeze(Object.defineProperty({__proto__:null,bbox:n0,default:t2},Symbol.toStringTag,{value:"Module"}));var e2={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.3/LICENSE.txt
 */(function(e,t){(function(n,r){e.exports=r()})(Hf,function(){var n={},r={};function a(p,c,b){if(r[p]=b,p==="index"){var C="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",A={};return r.shared(A),r.index(n,A),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([C],{type:"text/javascript"}))),n}}a("shared",["exports"],function(p){function c(s,i,l,f){return new(l||(l=Promise))(function(g,v){function x(L){try{E(f.next(L))}catch(D){v(D)}}function w(L){try{E(f.throw(L))}catch(D){v(D)}}function E(L){var D;L.done?g(L.value):(D=L.value,D instanceof l?D:new l(function(k){k(D)})).then(x,w)}E((f=f.apply(s,i||[])).next())})}function b(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}typeof SuppressedError=="function"&&SuppressedError;var C=A;function A(s,i){this.x=s,this.y=i}A.prototype={clone:function(){return new A(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,i){return this.clone()._rotateAround(s,i)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var i=s.x-this.x,l=s.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,i){return Math.atan2(this.x*i-this.y*s,this.x*s+this.y*i)},_matMult:function(s){var i=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=i,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var i=Math.cos(s),l=Math.sin(s),f=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=f,this},_rotateAround:function(s,i){var l=Math.cos(s),f=Math.sin(s),g=i.y+f*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-f*(this.y-i.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},A.convert=function(s){return s instanceof A?s:Array.isArray(s)?new A(s[0],s[1]):s};var P=b(C),R=et;function et(s,i,l,f){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=f}et.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,f=0;f<8;f++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<i)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=g/v}var x=0,w=1;for(l=s,f=0;f<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<i));f++)s>g?x=l:w=l,l=.5*(w-x)+x;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var X=b(R);let K,ot;function gt(){return K==null&&(K=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),K}function q(){if(ot==null&&(ot=!1,gt())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let f=0;f<5*5;f++){const g=4*f;i.fillStyle=`rgb(${g},${g+1},${g+2})`,i.fillRect(f%5,Math.floor(f/5),1,1)}const l=i.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&l[f]!==f){ot=!0;break}}}return ot||!1}function W(s,i,l,f){const g=new X(s,i,l,f);return function(v){return g.solve(v)}}const at=W(.25,.1,.25,1);function dt(s,i,l){return Math.min(l,Math.max(i,s))}function Pt(s,i,l){const f=l-i,g=((s-i)%f+f)%f+i;return g===i?l:g}function Mt(s,...i){for(const l of i)for(const f in l)s[f]=l[f];return s}let Tt=1;function Ut(s,i,l){const f={};for(const g in s)f[g]=i.call(l||this,s[g],g,s);return f}function qt(s,i,l){const f={};for(const g in s)i.call(l||this,s[g],g,s)&&(f[g]=s[g]);return f}function Q(s){return Array.isArray(s)?s.map(Q):typeof s=="object"&&s?Ut(s,Q):s}const Et={};function $t(s){Et[s]||(typeof console<"u"&&console.warn(s),Et[s]=!0)}function le(s,i,l){return(l.y-s.y)*(i.x-s.x)>(i.y-s.y)*(l.x-s.x)}function Ye(s){let i=0;for(let l,f,g=0,v=s.length,x=v-1;g<v;x=g++)l=s[g],f=s[x],i+=(f.x-l.x)*(l.y+f.y);return i}function Ie(s){return typeof WorkerGlobalScope<"u"&&s!==void 0&&s instanceof WorkerGlobalScope}let ue=null;function je(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const gn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function nn(s,i,l,f,g){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const v=new VideoFrame(s,{timestamp:0});try{const x=v==null?void 0:v.format;if(!x||!x.startsWith("BGR")&&!x.startsWith("RGB"))throw new Error(`Unrecognized format ${x}`);const w=x.startsWith("BGR"),E=new Uint8ClampedArray(f*g*4);if(yield v.copyTo(E,function(L,D,k,F,V){const G=4*Math.max(-D,0),H=(Math.max(0,k)-k)*F*4+G,nt=4*F,lt=Math.max(0,D),xt=Math.max(0,k);return{rect:{x:lt,y:xt,width:Math.min(L.width,D+F)-lt,height:Math.min(L.height,k+V)-xt},layout:[{offset:H,stride:nt}]}}(s,i,l,f,g)),w)for(let L=0;L<E.length;L+=4){const D=E[L];E[L]=E[L+2],E[L+2]=D}return E}finally{v.close()}})}let Ze,pe;const Re="AbortError";function dn(){return new Error(Re)}const rn={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function He(s){return rn.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))]}const mn="global-dispatcher";class Dn extends Error{constructor(i,l,f,g){super(`AJAXError: ${l} (${i}): ${f}`),this.status=i,this.statusText=l,this.url=f,this.body=g}}const kn=()=>Ie(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,ve=function(s,i){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){const f=He(s.url);if(f)return f(s,i);if(Ie(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,targetMapId:mn},i)}if(!(/^file:/.test(l=s.url)||/^file:/.test(kn())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,g){return c(this,void 0,void 0,function*(){const v=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:kn(),signal:g.signal});f.type==="json"&&v.headers.set("Accept","application/json");const x=yield fetch(v);if(!x.ok){const L=yield x.blob();throw new Dn(x.status,x.statusText,f.url,L)}let w;w=f.type==="arrayBuffer"||f.type==="image"?x.arrayBuffer():f.type==="json"?x.json():x.text();const E=yield w;if(g.signal.aborted)throw dn();return{data:E,cacheControl:x.headers.get("Cache-Control"),expires:x.headers.get("Expires")}})}(s,i);if(Ie(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:s,mustQueue:!0,targetMapId:mn},i)}var l;return function(f,g){return new Promise((v,x)=>{const w=new XMLHttpRequest;w.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(w.responseType="arraybuffer");for(const E in f.headers)w.setRequestHeader(E,f.headers[E]);f.type==="json"&&(w.responseType="text",w.setRequestHeader("Accept","application/json")),w.withCredentials=f.credentials==="include",w.onerror=()=>{x(new Error(w.statusText))},w.onload=()=>{if(!g.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let E=w.response;if(f.type==="json")try{E=JSON.parse(w.response)}catch(L){return void x(L)}v({data:E,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const E=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});x(new Dn(w.status,w.statusText,f.url,E))}},g.signal.addEventListener("abort",()=>{w.abort(),x(dn())}),w.send(f.body)})}(s,i)};function yn(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const i=new URL(s),l=window.location;return i.protocol===l.protocol&&i.host===l.host}function Xn(s,i,l){l[s]&&l[s].indexOf(i)!==-1||(l[s]=l[s]||[],l[s].push(i))}function Y(s,i,l){if(l&&l[s]){const f=l[s].indexOf(i);f!==-1&&l[s].splice(f,1)}}class yt{constructor(i,l={}){Mt(this,l),this.type=i}}class Ce extends yt{constructor(i,l={}){super("error",Mt({error:i},l))}}class Ke{on(i,l){return this._listeners=this._listeners||{},Xn(i,l,this._listeners),this}off(i,l){return Y(i,l,this._listeners),Y(i,l,this._oneTimeListeners),this}once(i,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},Xn(i,l,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,l){typeof i=="string"&&(i=new yt(i,l||{}));const f=i.type;if(this.listens(f)){i.target=this;const g=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const w of g)w.call(this,i);const v=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const w of v)Y(f,w,this._oneTimeListeners),w.call(this,i);const x=this._eventedParent;x&&(Mt(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(i))}else i instanceof Ce&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,l){return this._eventedParent=i,this._eventedParentData=l,this}}var Lt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const nr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function qo(s,i){const l={};for(const f in s)f!=="ref"&&(l[f]=s[f]);return nr.forEach(f=>{f in i&&(l[f]=i[f])}),l}function tn(s,i){if(Array.isArray(s)){if(!Array.isArray(i)||s.length!==i.length)return!1;for(let l=0;l<s.length;l++)if(!tn(s[l],i[l]))return!1;return!0}if(typeof s=="object"&&s!==null&&i!==null){if(typeof i!="object"||Object.keys(s).length!==Object.keys(i).length)return!1;for(const l in s)if(!tn(s[l],i[l]))return!1;return!0}return s===i}function zr(s,i){s.push(i)}function Cl(s,i,l){zr(l,{command:"addSource",args:[s,i[s]]})}function Tl(s,i,l){zr(i,{command:"removeSource",args:[s]}),l[s]=!0}function Ll(s,i,l,f){Tl(s,l,f),Cl(s,i,l)}function Pl(s,i,l){let f;for(f in s[l])if(Object.prototype.hasOwnProperty.call(s[l],f)&&f!=="data"&&!tn(s[l][f],i[l][f]))return!1;for(f in i[l])if(Object.prototype.hasOwnProperty.call(i[l],f)&&f!=="data"&&!tn(s[l][f],i[l][f]))return!1;return!0}function ga(s,i,l,f,g,v){s=s||{},i=i||{};for(const x in s)Object.prototype.hasOwnProperty.call(s,x)&&(tn(s[x],i[x])||l.push({command:v,args:[f,x,i[x],g]}));for(const x in i)Object.prototype.hasOwnProperty.call(i,x)&&!Object.prototype.hasOwnProperty.call(s,x)&&(tn(s[x],i[x])||l.push({command:v,args:[f,x,i[x],g]}))}function mc(s){return s.id}function Za(s,i){return s[i.id]=i,s}class Zt{constructor(i,l,f,g){this.message=(i?`${i}: `:"")+f,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function fs(s,...i){for(const l of i)for(const f in l)s[f]=l[f];return s}class lo extends Error{constructor(i,l){super(l),this.message=l,this.key=i}}class gu{constructor(i,l=[]){this.parent=i,this.bindings={};for(const[f,g]of l)this.bindings[f]=g}concat(i){return new gu(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const di={kind:"null"},te={kind:"number"},We={kind:"string"},Ue={kind:"boolean"},Pr={kind:"color"},ds={kind:"object"},Oe={kind:"value"},Ha={kind:"collator"},Fr={kind:"formatted"},rt={kind:"padding"},z={kind:"resolvedImage"},B={kind:"variableAnchorOffsetCollection"};function j(s,i){return{kind:"array",itemType:s,N:i}}function J(s){if(s.kind==="array"){const i=J(s.itemType);return typeof s.N=="number"?`array<${i}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${i}>`}return s.kind}const pt=[di,te,We,Ue,Pr,Fr,ds,j(Oe),rt,z,B];function ft(s,i){if(i.kind==="error")return null;if(s.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!ft(s.itemType,i.itemType))&&(typeof s.N!="number"||s.N===i.N))return null}else{if(s.kind===i.kind)return null;if(s.kind==="value"){for(const l of pt)if(!ft(l,i))return null}}return`Expected ${J(s)} but found ${J(i)} instead.`}function vt(s,i){return i.some(l=>l.kind===s.kind)}function ct(s,i){return i.some(l=>l==="null"?s===null:l==="array"?Array.isArray(s):l==="object"?s&&!Array.isArray(s)&&typeof s=="object":l===typeof s)}function wt(s,i){return s.kind==="array"&&i.kind==="array"?s.itemType.kind===i.itemType.kind&&typeof s.N=="number":s.kind===i.kind}const Ft=.96422,Nt=.82521,Ot=4/29,ge=6/29,be=3*ge*ge,ze=ge*ge*ge,Ae=Math.PI/180,un=180/Math.PI;function Rn(s){return(s%=360)<0&&(s+=360),s}function Yn([s,i,l,f]){let g,v;const x=Ge((.2225045*(s=Ar(s))+.7168786*(i=Ar(i))+.0606169*(l=Ar(l)))/1);s===i&&i===l?g=v=x:(g=Ge((.4360747*s+.3850649*i+.1430804*l)/Ft),v=Ge((.0139322*s+.0971045*i+.7141733*l)/Nt));const w=116*x-16;return[w<0?0:w,500*(g-x),200*(x-v),f]}function Ar(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Ge(s){return s>ze?Math.pow(s,1/3):s/be+Ot}function ur([s,i,l,f]){let g=(s+16)/116,v=isNaN(i)?g:g+i/500,x=isNaN(l)?g:g-l/200;return g=1*Li(g),v=Ft*Li(v),x=Nt*Li(x),[Br(3.1338561*v-1.6168667*g-.4906146*x),Br(-.9787684*v+1.9161415*g+.033454*x),Br(.0719453*v-.2289914*g+1.4052427*x),f]}function Br(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function Li(s){return s>ge?s*s*s:be*(s-Ot)}function Ui(s){return parseInt(s.padEnd(2,s),16)/255}function $r(s,i){return ms(i?s/100:s,0,1)}function ms(s,i,l){return Math.min(Math.max(i,s),l)}function ad(s){return!s.some(Number.isNaN)}const xg={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Pn{constructor(i,l,f,g=1,v=!0){this.r=i,this.g=l,this.b=f,this.a=g,v||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[i,l,f,g]))}static parse(i){if(i instanceof Pn)return i;if(typeof i!="string")return;const l=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=xg[f];if(g){const[x,w,E]=g;return[x/255,w/255,E/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const x=f.length<6?1:2;let w=1;return[Ui(f.slice(w,w+=x)),Ui(f.slice(w,w+=x)),Ui(f.slice(w,w+=x)),Ui(f.slice(w,w+x)||"ff")]}if(f.startsWith("rgb")){const x=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[w,E,L,D,k,F,V,G,H,nt,lt,xt]=x,ut=[D||" ",V||" ",nt].join("");if(ut==="  "||ut==="  /"||ut===",,"||ut===",,,"){const mt=[L,F,H].join(""),Rt=mt==="%%%"?100:mt===""?255:0;if(Rt){const zt=[ms(+E/Rt,0,1),ms(+k/Rt,0,1),ms(+G/Rt,0,1),lt?$r(+lt,xt):1];if(ad(zt))return zt}}return}}const v=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[x,w,E,L,D,k,F,V,G]=v,H=[E||" ",D||" ",F].join("");if(H==="  "||H==="  /"||H===",,"||H===",,,"){const nt=[+w,ms(+L,0,100),ms(+k,0,100),V?$r(+V,G):1];if(ad(nt))return function([lt,xt,ut,mt]){function Rt(zt){const oe=(zt+lt/30)%12,fe=xt*Math.min(ut,1-ut);return ut-fe*Math.max(-1,Math.min(oe-3,9-oe,1))}return lt=Rn(lt),xt/=100,ut/=100,[Rt(0),Rt(8),Rt(4),mt]}(nt)}}}(i);return l?new Pn(...l,!1):void 0}get rgb(){const{r:i,g:l,b:f,a:g}=this,v=g||1/0;return this.overwriteGetter("rgb",[i/v,l/v,f/v,g])}get hcl(){return this.overwriteGetter("hcl",function(i){const[l,f,g,v]=Yn(i),x=Math.sqrt(f*f+g*g);return[Math.round(1e4*x)?Rn(Math.atan2(g,f)*un):NaN,x,l,v]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Yn(this.rgb))}overwriteGetter(i,l){return Object.defineProperty(this,i,{value:l}),l}toString(){const[i,l,f,g]=this.rgb;return`rgba(${[i,l,f].map(v=>Math.round(255*v)).join(",")},${g})`}}Pn.black=new Pn(0,0,0,1),Pn.white=new Pn(1,1,1,1),Pn.transparent=new Pn(0,0,0,0),Pn.red=new Pn(1,0,0,1);class ap{constructor(i,l,f){this.sensitivity=i?l?"variant":"case":l?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,l){return this.collator.compare(i,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class lp{constructor(i,l,f,g,v){this.text=i,this.image=l,this.scale=f,this.fontStack=g,this.textColor=v}}class uo{constructor(i){this.sections=i}static fromString(i){return new uo([new lp(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof uo?i:uo.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class Gi{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Gi)return i;if(typeof i=="number")return new Gi([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const l of i)if(typeof l!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Gi(i)}}toString(){return JSON.stringify(this.values)}}const yu=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class To{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof To)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let l=0;l<i.length;l+=2){const f=i[l],g=i[l+1];if(typeof f!="string"||!yu.has(f)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new To(i)}}toString(){return JSON.stringify(this.values)}}class Lo{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new Lo({name:i,available:!1}):null}}function Al(s,i,l,f){return typeof s=="number"&&s>=0&&s<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof l=="number"&&l>=0&&l<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[s,i,l,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[s,i,l,f]:[s,i,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function gc(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Pn||s instanceof ap||s instanceof uo||s instanceof Gi||s instanceof To||s instanceof Lo)return!0;if(Array.isArray(s)){for(const i of s)if(!gc(i))return!1;return!0}if(typeof s=="object"){for(const i in s)if(!gc(s[i]))return!1;return!0}return!1}function Mr(s){if(s===null)return di;if(typeof s=="string")return We;if(typeof s=="boolean")return Ue;if(typeof s=="number")return te;if(s instanceof Pn)return Pr;if(s instanceof ap)return Ha;if(s instanceof uo)return Fr;if(s instanceof Gi)return rt;if(s instanceof To)return B;if(s instanceof Lo)return z;if(Array.isArray(s)){const i=s.length;let l;for(const f of s){const g=Mr(f);if(l){if(l===g)continue;l=Oe;break}l=g}return j(l||Oe,i)}return ds}function _u(s){const i=typeof s;return s===null?"":i==="string"||i==="number"||i==="boolean"?String(s):s instanceof Pn||s instanceof uo||s instanceof Gi||s instanceof To||s instanceof Lo?s.toString():JSON.stringify(s)}class ya{constructor(i,l){this.type=i,this.value=l}static parse(i,l){if(i.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!gc(i[1]))return l.error("invalid value");const f=i[1];let g=Mr(f);const v=l.expectedType;return g.kind!=="array"||g.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(g=v),new ya(g,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class rr{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const yc={string:We,number:te,boolean:Ue,object:ds};class co{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");let f,g=1;const v=i[0];if(v==="array"){let w,E;if(i.length>2){const L=i[1];if(typeof L!="string"||!(L in yc)||L==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);w=yc[L],g++}else w=Oe;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return l.error('The length argument to "array" must be a positive integer literal',2);E=i[2],g++}f=j(w,E)}else{if(!yc[v])throw new Error(`Types doesn't contain name = ${v}`);f=yc[v]}const x=[];for(;g<i.length;g++){const w=l.parse(i[g],g,Oe);if(!w)return null;x.push(w)}return new co(f,x)}evaluate(i){for(let l=0;l<this.args.length;l++){const f=this.args[l].evaluate(i);if(!ft(this.type,Mr(f)))return f;if(l===this.args.length-1)throw new rr(`Expected value to be of type ${J(this.type)}, but found ${J(Mr(f))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const _c={"to-boolean":Ue,"to-color":Pr,"to-number":te,"to-string":We};class gs{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const f=i[0];if(!_c[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&i.length!==2)return l.error("Expected one argument.");const g=_c[f],v=[];for(let x=1;x<i.length;x++){const w=l.parse(i[x],x,Oe);if(!w)return null;v.push(w)}return new gs(g,v)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let l,f;for(const g of this.args){if(l=g.evaluate(i),f=null,l instanceof Pn)return l;if(typeof l=="string"){const v=i.parseColor(l);if(v)return v}else if(Array.isArray(l)&&(f=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:Al(l[0],l[1],l[2],l[3]),!f))return new Pn(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new rr(f||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const f of this.args){l=f.evaluate(i);const g=Gi.parse(l);if(g)return g}throw new rr(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const f of this.args){l=f.evaluate(i);const g=To.parse(l);if(g)return g}throw new rr(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const f of this.args){if(l=f.evaluate(i),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new rr(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return uo.fromString(_u(this.args[0].evaluate(i)));case"resolvedImage":return Lo.fromString(_u(this.args[0].evaluate(i)));default:return _u(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const vu=["Unknown","Point","LineString","Polygon"];class An{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?vu[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let l=this._parseColorCache[i];return l||(l=this._parseColorCache[i]=Pn.parse(i)),l}}class vc{constructor(i,l,f=[],g,v=new gu,x=[]){this.registry=i,this.path=f,this.key=f.map(w=>`[${w}]`).join(""),this.scope=v,this.errors=x,this.expectedType=g,this._isConstant=l}parse(i,l,f,g,v={}){return l?this.concat(l,f,g)._parse(i,v):this._parse(i,v)}_parse(i,l){function f(g,v,x){return x==="assert"?new co(v,[g]):x==="coerce"?new gs(v,[g]):g}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=i[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const v=this.registry[g];if(v){let x=v.parse(i,this);if(!x)return null;if(this.expectedType){const w=this.expectedType,E=x.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||E.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||E.kind!=="value"&&E.kind!=="string")if(w.kind!=="padding"||E.kind!=="value"&&E.kind!=="number"&&E.kind!=="array")if(w.kind!=="variableAnchorOffsetCollection"||E.kind!=="value"&&E.kind!=="array"){if(this.checkSubtype(w,E))return null}else x=f(x,w,l.typeAnnotation||"coerce");else x=f(x,w,l.typeAnnotation||"coerce");else x=f(x,w,l.typeAnnotation||"coerce");else x=f(x,w,l.typeAnnotation||"assert")}if(!(x instanceof ya)&&x.type.kind!=="resolvedImage"&&this._isConstant(x)){const w=new An;try{x=new ya(x.type,x.evaluate(w))}catch(E){return this.error(E.message),null}}return x}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,l,f){const g=typeof i=="number"?this.path.concat(i):this.path,v=f?this.scope.concat(f):this.scope;return new vc(this.registry,this._isConstant,g,l||null,v,this.errors)}error(i,...l){const f=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new lo(f,i))}checkSubtype(i,l){const f=ft(i,l);return f&&this.error(f),f}}class Ml{constructor(i,l,f){this.type=Ha,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=l}static parse(i,l){if(i.length!==2)return l.error("Expected one argument.");const f=i[1];if(typeof f!="object"||Array.isArray(f))return l.error("Collator options argument must be an object.");const g=l.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Ue);if(!g)return null;const v=l.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Ue);if(!v)return null;let x=null;return f.locale&&(x=l.parse(f.locale,1,We),!x)?null:new Ml(g,v,x)}evaluate(i){return new ap(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const _a=8192;function xc(s,i){s[0]=Math.min(s[0],i[0]),s[1]=Math.min(s[1],i[1]),s[2]=Math.max(s[2],i[0]),s[3]=Math.max(s[3],i[1])}function xu(s,i){return!(s[0]<=i[0]||s[2]>=i[2]||s[1]<=i[1]||s[3]>=i[3])}function bg(s,i){const l=(180+s[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,i.z);return[Math.round(l*g*_a),Math.round(f*g*_a)]}function ld(s,i,l){const f=s[0]-i[0],g=s[1]-i[1],v=s[0]-l[0],x=s[1]-l[1];return f*x-v*g==0&&f*v<=0&&g*x<=0}function bc(s,i){let l=!1;for(let x=0,w=i.length;x<w;x++){const E=i[x];for(let L=0,D=E.length;L<D-1;L++){if(ld(s,E[L],E[L+1]))return!1;(g=E[L])[1]>(f=s)[1]!=(v=E[L+1])[1]>f[1]&&f[0]<(v[0]-g[0])*(f[1]-g[1])/(v[1]-g[1])+g[0]&&(l=!l)}}var f,g,v;return l}function wg(s,i){for(let l=0;l<i.length;l++)if(bc(s,i[l]))return!0;return!1}function ud(s,i,l,f){const g=f[0]-l[0],v=f[1]-l[1],x=(s[0]-l[0])*v-g*(s[1]-l[1]),w=(i[0]-l[0])*v-g*(i[1]-l[1]);return x>0&&w<0||x<0&&w>0}function Sg(s,i,l){for(const L of l)for(let D=0;D<L.length-1;++D)if((w=[(x=L[D+1])[0]-(v=L[D])[0],x[1]-v[1]])[0]*(E=[(g=i)[0]-(f=s)[0],g[1]-f[1]])[1]-w[1]*E[0]!=0&&ud(f,g,v,x)&&ud(v,x,f,g))return!0;var f,g,v,x,w,E;return!1}function cd(s,i){for(let l=0;l<s.length;++l)if(!bc(s[l],i))return!1;for(let l=0;l<s.length-1;++l)if(Sg(s[l],s[l+1],i))return!1;return!0}function hd(s,i){for(let l=0;l<i.length;l++)if(cd(s,i[l]))return!0;return!1}function wc(s,i,l){const f=[];for(let g=0;g<s.length;g++){const v=[];for(let x=0;x<s[g].length;x++){const w=bg(s[g][x],l);xc(i,w),v.push(w)}f.push(v)}return f}function pd(s,i,l){const f=[];for(let g=0;g<s.length;g++){const v=wc(s[g],i,l);f.push(v)}return f}function fd(s,i,l,f){if(s[0]<l[0]||s[0]>l[2]){const g=.5*f;let v=s[0]-l[0]>g?-f:l[0]-s[0]>g?f:0;v===0&&(v=s[0]-l[2]>g?-f:l[2]-s[0]>g?f:0),s[0]+=v}xc(i,s)}function Sc(s,i,l,f){const g=Math.pow(2,f.z)*_a,v=[f.x*_a,f.y*_a],x=[];for(const w of s)for(const E of w){const L=[E.x+v[0],E.y+v[1]];fd(L,i,l,g),x.push(L)}return x}function dd(s,i,l,f){const g=Math.pow(2,f.z)*_a,v=[f.x*_a,f.y*_a],x=[];for(const E of s){const L=[];for(const D of E){const k=[D.x+v[0],D.y+v[1]];xc(i,k),L.push(k)}x.push(L)}if(i[2]-i[0]<=g/2){(w=i)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const E of x)for(const L of E)fd(L,i,l,g)}var w;return x}class Xa{constructor(i,l){this.type=Ue,this.geojson=i,this.geometries=l}static parse(i,l){if(i.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(gc(i[1])){const f=i[1];if(f.type==="FeatureCollection"){const g=[];for(const v of f.features){const{type:x,coordinates:w}=v.geometry;x==="Polygon"&&g.push(w),x==="MultiPolygon"&&g.push(...w)}if(g.length)return new Xa(f,{type:"MultiPolygon",coordinates:g})}else if(f.type==="Feature"){const g=f.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Xa(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Xa(f,f)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(l,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(f.type==="Polygon"){const w=wc(f.coordinates,v,x),E=Sc(l.geometry(),g,v,x);if(!xu(g,v))return!1;for(const L of E)if(!bc(L,w))return!1}if(f.type==="MultiPolygon"){const w=pd(f.coordinates,v,x),E=Sc(l.geometry(),g,v,x);if(!xu(g,v))return!1;for(const L of E)if(!wg(L,w))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(l,f){const g=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],x=l.canonicalID();if(f.type==="Polygon"){const w=wc(f.coordinates,v,x),E=dd(l.geometry(),g,v,x);if(!xu(g,v))return!1;for(const L of E)if(!cd(L,w))return!1}if(f.type==="MultiPolygon"){const w=pd(f.coordinates,v,x),E=dd(l.geometry(),g,v,x);if(!xu(g,v))return!1;for(const L of E)if(!hd(L,w))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ic{constructor(i,l){this.type=l.type,this.name=i,this.boundExpression=l}static parse(i,l){if(i.length!==2||typeof i[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const f=i[1];return l.scope.has(f)?new Ic(f,l.scope.get(f)):l.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class ho{constructor(i,l,f,g){this.name=i,this.type=l,this._evaluate=f,this.args=g}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,l){const f=i[0],g=ho.definitions[f];if(!g)return l.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const v=Array.isArray(g)?g[0]:g.type,x=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,w=x.filter(([L])=>!Array.isArray(L)||L.length===i.length-1);let E=null;for(const[L,D]of w){E=new vc(l.registry,bu,l.path,null,l.scope);const k=[];let F=!1;for(let V=1;V<i.length;V++){const G=i[V],H=Array.isArray(L)?L[V-1]:L.type,nt=E.parse(G,1+k.length,H);if(!nt){F=!0;break}k.push(nt)}if(!F)if(Array.isArray(L)&&L.length!==k.length)E.error(`Expected ${L.length} arguments, but found ${k.length} instead.`);else{for(let V=0;V<k.length;V++){const G=Array.isArray(L)?L[V]:L.type,H=k[V];E.concat(V+1).checkSubtype(G,H.type)}if(E.errors.length===0)return new ho(f,v,D,k)}}if(w.length===1)l.errors.push(...E.errors);else{const L=(w.length?w:x).map(([k])=>{return F=k,Array.isArray(F)?`(${F.map(J).join(", ")})`:`(${J(F.type)}...)`;var F}).join(" | "),D=[];for(let k=1;k<i.length;k++){const F=l.parse(i[k],1+D.length);if(!F)return null;D.push(J(F.type))}l.error(`Expected arguments of type ${L}, but found (${D.join(", ")}) instead.`)}return null}static register(i,l){ho.definitions=l;for(const f in l)i[f]=ho}}function bu(s){if(s instanceof Ic)return bu(s.boundExpression);if(s instanceof ho&&s.name==="error"||s instanceof Ml||s instanceof Xa)return!1;const i=s instanceof gs||s instanceof co;let l=!0;return s.eachChild(f=>{l=i?l&&bu(f):l&&f instanceof ya}),!!l&&Ec(s)&&Su(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ec(s){if(s instanceof ho&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Xa)return!1;let i=!0;return s.eachChild(l=>{i&&!Ec(l)&&(i=!1)}),i}function wu(s){if(s instanceof ho&&s.name==="feature-state")return!1;let i=!0;return s.eachChild(l=>{i&&!wu(l)&&(i=!1)}),i}function Su(s,i){if(s instanceof ho&&i.indexOf(s.name)>=0)return!1;let l=!0;return s.eachChild(f=>{l&&!Su(f,i)&&(l=!1)}),l}function Iu(s,i){const l=s.length-1;let f,g,v=0,x=l,w=0;for(;v<=x;)if(w=Math.floor((v+x)/2),f=s[w],g=s[w+1],f<=i){if(w===l||i<g)return w;v=w+1}else{if(!(f>i))throw new rr("Input is not a number.");x=w-1}return 0}class Eu{constructor(i,l,f){this.type=i,this.input=l,this.labels=[],this.outputs=[];for(const[g,v]of f)this.labels.push(g),this.outputs.push(v)}static parse(i,l){if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");const f=l.parse(i[1],1,te);if(!f)return null;const g=[];let v=null;l.expectedType&&l.expectedType.kind!=="value"&&(v=l.expectedType);for(let x=1;x<i.length;x+=2){const w=x===1?-1/0:i[x],E=i[x+1],L=x,D=x+1;if(typeof w!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(g.length&&g[g.length-1][0]>=w)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const k=l.parse(E,D,v);if(!k)return null;v=v||k.type,g.push([w,k])}return new Eu(v,f,g)}evaluate(i){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return f[0].evaluate(i);const v=l.length;return g>=l[v-1]?f[v-1].evaluate(i):f[Iu(l,g)].evaluate(i)}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Ig(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var Eg=md;function md(s,i,l,f){this.cx=3*s,this.bx=3*(l-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=i,this.p2x=l,this.p2y=f}md.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,i){if(i===void 0&&(i=1e-6),s<0)return 0;if(s>1)return 1;for(var l=s,f=0;f<8;f++){var g=this.sampleCurveX(l)-s;if(Math.abs(g)<i)return l;var v=this.sampleCurveDerivativeX(l);if(Math.abs(v)<1e-6)break;l-=g/v}var x=0,w=1;for(l=s,f=0;f<20&&(g=this.sampleCurveX(l),!(Math.abs(g-s)<i));f++)s>g?x=l:w=l,l=.5*(w-x)+x;return l},solve:function(s,i){return this.sampleCurveY(this.solveCurveX(s,i))}};var Cg=Ig(Eg);function Ya(s,i,l){return s+l*(i-s)}function Cc(s,i,l){return s.map((f,g)=>Ya(f,i[g],l))}const Pi={number:Ya,color:function(s,i,l,f="rgb"){switch(f){case"rgb":{const[g,v,x,w]=Cc(s.rgb,i.rgb,l);return new Pn(g,v,x,w,!1)}case"hcl":{const[g,v,x,w]=s.hcl,[E,L,D,k]=i.hcl;let F,V;if(isNaN(g)||isNaN(E))isNaN(g)?isNaN(E)?F=NaN:(F=E,x!==1&&x!==0||(V=L)):(F=g,D!==1&&D!==0||(V=v));else{let xt=E-g;E>g&&xt>180?xt-=360:E<g&&g-E>180&&(xt+=360),F=g+l*xt}const[G,H,nt,lt]=function([xt,ut,mt,Rt]){return xt=isNaN(xt)?0:xt*Ae,ur([mt,Math.cos(xt)*ut,Math.sin(xt)*ut,Rt])}([F,V??Ya(v,L,l),Ya(x,D,l),Ya(w,k,l)]);return new Pn(G,H,nt,lt,!1)}case"lab":{const[g,v,x,w]=ur(Cc(s.lab,i.lab,l));return new Pn(g,v,x,w,!1)}}},array:Cc,padding:function(s,i,l){return new Gi(Cc(s.values,i.values,l))},variableAnchorOffsetCollection:function(s,i,l){const f=s.values,g=i.values;if(f.length!==g.length)throw new rr(`Cannot interpolate values of different length. from: ${s.toString()}, to: ${i.toString()}`);const v=[];for(let x=0;x<f.length;x+=2){if(f[x]!==g[x])throw new rr(`Cannot interpolate values containing mismatched anchors. from[${x}]: ${f[x]}, to[${x}]: ${g[x]}`);v.push(f[x]);const[w,E]=f[x+1],[L,D]=g[x+1];v.push([Ya(w,L,l),Ya(E,D,l)])}return new To(v)}};class mi{constructor(i,l,f,g,v){this.type=i,this.operator=l,this.interpolation=f,this.input=g,this.labels=[],this.outputs=[];for(const[x,w]of v)this.labels.push(x),this.outputs.push(w)}static interpolationFactor(i,l,f,g){let v=0;if(i.name==="exponential")v=Sn(l,i.base,f,g);else if(i.name==="linear")v=Sn(l,1,f,g);else if(i.name==="cubic-bezier"){const x=i.controlPoints;v=new Cg(x[0],x[1],x[2],x[3]).solve(Sn(l,1,f,g))}return v}static parse(i,l){let[f,g,v,...x]=i;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const L=g[1];if(typeof L!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:L}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const L=g.slice(1);if(L.length!==4||L.some(D=>typeof D!="number"||D<0||D>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}}if(i.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(v=l.parse(v,2,te),!v)return null;const w=[];let E=null;f==="interpolate-hcl"||f==="interpolate-lab"?E=Pr:l.expectedType&&l.expectedType.kind!=="value"&&(E=l.expectedType);for(let L=0;L<x.length;L+=2){const D=x[L],k=x[L+1],F=L+3,V=L+4;if(typeof D!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(w.length&&w[w.length-1][0]>=D)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const G=l.parse(k,V,E);if(!G)return null;E=E||G.type,w.push([D,G])}return wt(E,te)||wt(E,Pr)||wt(E,rt)||wt(E,B)||wt(E,j(te))?new mi(E,f,g,v,w):l.error(`Type ${J(E)} is not interpolatable.`)}evaluate(i){const l=this.labels,f=this.outputs;if(l.length===1)return f[0].evaluate(i);const g=this.input.evaluate(i);if(g<=l[0])return f[0].evaluate(i);const v=l.length;if(g>=l[v-1])return f[v-1].evaluate(i);const x=Iu(l,g),w=mi.interpolationFactor(this.interpolation,g,l[x],l[x+1]),E=f[x].evaluate(i),L=f[x+1].evaluate(i);switch(this.operator){case"interpolate":return Pi[this.type.kind](E,L,w);case"interpolate-hcl":return Pi.color(E,L,w,"hcl");case"interpolate-lab":return Pi.color(E,L,w,"lab")}}eachChild(i){i(this.input);for(const l of this.outputs)i(l)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Sn(s,i,l,f){const g=f-l,v=s-l;return g===0?0:i===1?v/g:(Math.pow(i,v)-1)/(Math.pow(i,g)-1)}class Tc{constructor(i,l){this.type=i,this.args=l}static parse(i,l){if(i.length<2)return l.error("Expectected at least one argument.");let f=null;const g=l.expectedType;g&&g.kind!=="value"&&(f=g);const v=[];for(const w of i.slice(1)){const E=l.parse(w,1+v.length,f,void 0,{typeAnnotation:"omit"});if(!E)return null;f=f||E.type,v.push(E)}if(!f)throw new Error("No output type");const x=g&&v.some(w=>ft(g,w.type));return new Tc(x?Oe:f,v)}evaluate(i){let l,f=null,g=0;for(const v of this.args)if(g++,f=v.evaluate(i),f&&f instanceof Lo&&!f.available&&(l||(l=f.name),f=null,g===this.args.length&&(f=l)),f!==null)break;return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class Lc{constructor(i,l){this.type=l.type,this.bindings=[].concat(i),this.result=l}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const l of this.bindings)i(l[1]);i(this.result)}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let v=1;v<i.length-1;v+=2){const x=i[v];if(typeof x!="string")return l.error(`Expected string, but found ${typeof x} instead.`,v);if(/[^a-zA-Z0-9_]/.test(x))return l.error("Variable names must contain only alphanumeric characters or '_'.",v);const w=l.parse(i[v+1],v+1);if(!w)return null;f.push([x,w])}const g=l.parse(i[i.length-1],i.length-1,l.expectedType,f);return g?new Lc(f,g):null}outputDefined(){return this.result.outputDefined()}}class up{constructor(i,l,f){this.type=i,this.index=l,this.input=f}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,te),g=l.parse(i[2],2,j(l.expectedType||Oe));return f&&g?new up(g.type.itemType,f,g):null}evaluate(i){const l=this.index.evaluate(i),f=this.input.evaluate(i);if(l<0)throw new rr(`Array index out of bounds: ${l} < 0.`);if(l>=f.length)throw new rr(`Array index out of bounds: ${l} > ${f.length-1}.`);if(l!==Math.floor(l))throw new rr(`Array index must be an integer, but found ${l} instead.`);return f[l]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class cp{constructor(i,l){this.type=Ue,this.needle=i,this.haystack=l}static parse(i,l){if(i.length!==3)return l.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,Oe),g=l.parse(i[2],2,Oe);return f&&g?vt(f.type,[Ue,We,te,di,Oe])?new cp(f,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(f.type)} instead`):null}evaluate(i){const l=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!f)return!1;if(!ct(l,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${J(Mr(l))} instead.`);if(!ct(f,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${J(Mr(f))} instead.`);return f.indexOf(l)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class Pc{constructor(i,l,f){this.type=te,this.needle=i,this.haystack=l,this.fromIndex=f}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,Oe),g=l.parse(i[2],2,Oe);if(!f||!g)return null;if(!vt(f.type,[Ue,We,te,di,Oe]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${J(f.type)} instead`);if(i.length===4){const v=l.parse(i[3],3,te);return v?new Pc(f,g,v):null}return new Pc(f,g)}evaluate(i){const l=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!ct(l,["boolean","string","number","null"]))throw new rr(`Expected first argument to be of type boolean, string, number or null, but found ${J(Mr(l))} instead.`);if(!ct(f,["string","array"]))throw new rr(`Expected second argument to be of type array or string, but found ${J(Mr(f))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(i);return f.indexOf(l,g)}return f.indexOf(l)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class hp{constructor(i,l,f,g,v,x){this.inputType=i,this.type=l,this.input=f,this.cases=g,this.outputs=v,this.otherwise=x}static parse(i,l){if(i.length<5)return l.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return l.error("Expected an even number of arguments.");let f,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const v={},x=[];for(let L=2;L<i.length-1;L+=2){let D=i[L];const k=i[L+1];Array.isArray(D)||(D=[D]);const F=l.concat(L);if(D.length===0)return F.error("Expected at least one branch label.");for(const G of D){if(typeof G!="number"&&typeof G!="string")return F.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return F.error("Numeric branch labels must be integer values.");if(f){if(F.checkSubtype(f,Mr(G)))return null}else f=Mr(G);if(v[String(G)]!==void 0)return F.error("Branch labels must be unique.");v[String(G)]=x.length}const V=l.parse(k,L,g);if(!V)return null;g=g||V.type,x.push(V)}const w=l.parse(i[1],1,Oe);if(!w)return null;const E=l.parse(i[i.length-1],i.length-1,g);return E?w.type.kind!=="value"&&l.concat(1).checkSubtype(f,w.type)?null:new hp(f,g,w,v,x,E):null}evaluate(i){const l=this.input.evaluate(i);return(Mr(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class pp{constructor(i,l,f){this.type=i,this.branches=l,this.otherwise=f}static parse(i,l){if(i.length<4)return l.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return l.error("Expected an odd number of arguments.");let f;l.expectedType&&l.expectedType.kind!=="value"&&(f=l.expectedType);const g=[];for(let x=1;x<i.length-1;x+=2){const w=l.parse(i[x],x,Ue);if(!w)return null;const E=l.parse(i[x+1],x+1,f);if(!E)return null;g.push([w,E]),f=f||E.type}const v=l.parse(i[i.length-1],i.length-1,f);if(!v)return null;if(!f)throw new Error("Can't infer output type");return new pp(f,g,v)}evaluate(i){for(const[l,f]of this.branches)if(l.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[l,f]of this.branches)i(l),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Ac{constructor(i,l,f,g){this.type=i,this.input=l,this.beginIndex=f,this.endIndex=g}static parse(i,l){if(i.length<=2||i.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=l.parse(i[1],1,Oe),g=l.parse(i[2],2,te);if(!f||!g)return null;if(!vt(f.type,[j(Oe),We,Oe]))return l.error(`Expected first argument to be of type array or string, but found ${J(f.type)} instead`);if(i.length===4){const v=l.parse(i[3],3,te);return v?new Ac(f.type,f,g,v):null}return new Ac(f.type,f,g)}evaluate(i){const l=this.input.evaluate(i),f=this.beginIndex.evaluate(i);if(!ct(l,["string","array"]))throw new rr(`Expected first argument to be of type array or string, but found ${J(Mr(l))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(i);return l.slice(f,g)}return l.slice(f)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function gd(s,i){return s==="=="||s==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function yd(s,i,l,f){return f.compare(i,l)===0}function Dl(s,i,l){const f=s!=="=="&&s!=="!=";return class n2{constructor(v,x,w){this.type=Ue,this.lhs=v,this.rhs=x,this.collator=w,this.hasUntypedArgument=v.type.kind==="value"||x.type.kind==="value"}static parse(v,x){if(v.length!==3&&v.length!==4)return x.error("Expected two or three arguments.");const w=v[0];let E=x.parse(v[1],1,Oe);if(!E)return null;if(!gd(w,E.type))return x.concat(1).error(`"${w}" comparisons are not supported for type '${J(E.type)}'.`);let L=x.parse(v[2],2,Oe);if(!L)return null;if(!gd(w,L.type))return x.concat(2).error(`"${w}" comparisons are not supported for type '${J(L.type)}'.`);if(E.type.kind!==L.type.kind&&E.type.kind!=="value"&&L.type.kind!=="value")return x.error(`Cannot compare types '${J(E.type)}' and '${J(L.type)}'.`);f&&(E.type.kind==="value"&&L.type.kind!=="value"?E=new co(L.type,[E]):E.type.kind!=="value"&&L.type.kind==="value"&&(L=new co(E.type,[L])));let D=null;if(v.length===4){if(E.type.kind!=="string"&&L.type.kind!=="string"&&E.type.kind!=="value"&&L.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(D=x.parse(v[3],3,Ha),!D)return null}return new n2(E,L,D)}evaluate(v){const x=this.lhs.evaluate(v),w=this.rhs.evaluate(v);if(f&&this.hasUntypedArgument){const E=Mr(x),L=Mr(w);if(E.kind!==L.kind||E.kind!=="string"&&E.kind!=="number")throw new rr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${E.kind}, ${L.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const E=Mr(x),L=Mr(w);if(E.kind!=="string"||L.kind!=="string")return i(v,x,w)}return this.collator?l(v,x,w,this.collator.evaluate(v)):i(v,x,w)}eachChild(v){v(this.lhs),v(this.rhs),this.collator&&v(this.collator)}outputDefined(){return!0}}}const Tg=Dl("==",function(s,i,l){return i===l},yd),Lg=Dl("!=",function(s,i,l){return i!==l},function(s,i,l,f){return!yd(0,i,l,f)}),Pg=Dl("<",function(s,i,l){return i<l},function(s,i,l,f){return f.compare(i,l)<0}),Ag=Dl(">",function(s,i,l){return i>l},function(s,i,l,f){return f.compare(i,l)>0}),Mg=Dl("<=",function(s,i,l){return i<=l},function(s,i,l,f){return f.compare(i,l)<=0}),Dg=Dl(">=",function(s,i,l){return i>=l},function(s,i,l,f){return f.compare(i,l)>=0});class fp{constructor(i,l,f,g,v){this.type=We,this.number=i,this.locale=l,this.currency=f,this.minFractionDigits=g,this.maxFractionDigits=v}static parse(i,l){if(i.length!==3)return l.error("Expected two arguments.");const f=l.parse(i[1],1,te);if(!f)return null;const g=i[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let v=null;if(g.locale&&(v=l.parse(g.locale,1,We),!v))return null;let x=null;if(g.currency&&(x=l.parse(g.currency,1,We),!x))return null;let w=null;if(g["min-fraction-digits"]&&(w=l.parse(g["min-fraction-digits"],1,te),!w))return null;let E=null;return g["max-fraction-digits"]&&(E=l.parse(g["max-fraction-digits"],1,te),!E)?null:new fp(f,v,x,w,E)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class Mc{constructor(i){this.type=Fr,this.sections=i}static parse(i,l){if(i.length<2)return l.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&typeof f=="object")return l.error("First argument must be an image or text section.");const g=[];let v=!1;for(let x=1;x<=i.length-1;++x){const w=i[x];if(v&&typeof w=="object"&&!Array.isArray(w)){v=!1;let E=null;if(w["font-scale"]&&(E=l.parse(w["font-scale"],1,te),!E))return null;let L=null;if(w["text-font"]&&(L=l.parse(w["text-font"],1,j(We)),!L))return null;let D=null;if(w["text-color"]&&(D=l.parse(w["text-color"],1,Pr),!D))return null;const k=g[g.length-1];k.scale=E,k.font=L,k.textColor=D}else{const E=l.parse(i[x],1,Oe);if(!E)return null;const L=E.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,g.push({content:E,scale:null,font:null,textColor:null})}}return new Mc(g)}evaluate(i){return new uo(this.sections.map(l=>{const f=l.content.evaluate(i);return Mr(f)===z?new lp("",f,null,null,null):new lp(_u(f),null,l.scale?l.scale.evaluate(i):null,l.font?l.font.evaluate(i).join(","):null,l.textColor?l.textColor.evaluate(i):null)}))}eachChild(i){for(const l of this.sections)i(l.content),l.scale&&i(l.scale),l.font&&i(l.font),l.textColor&&i(l.textColor)}outputDefined(){return!1}}class dp{constructor(i){this.type=z,this.input=i}static parse(i,l){if(i.length!==2)return l.error("Expected two arguments.");const f=l.parse(i[1],1,We);return f?new dp(f):l.error("No image name provided.")}evaluate(i){const l=this.input.evaluate(i),f=Lo.fromString(l);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(l)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}}class mp{constructor(i){this.type=te,this.input=i}static parse(i,l){if(i.length!==2)return l.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=l.parse(i[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${J(f.type)} instead.`):new mp(f):null}evaluate(i){const l=this.input.evaluate(i);if(typeof l=="string"||Array.isArray(l))return l.length;throw new rr(`Expected value to be of type string or array, but found ${J(Mr(l))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const kl={"==":Tg,"!=":Lg,">":Ag,"<":Pg,">=":Dg,"<=":Mg,array:co,at:up,boolean:co,case:pp,coalesce:Tc,collator:Ml,format:Mc,image:dp,in:cp,"index-of":Pc,interpolate:mi,"interpolate-hcl":mi,"interpolate-lab":mi,length:mp,let:Lc,literal:ya,match:hp,number:co,"number-format":fp,object:co,slice:Ac,step:Eu,string:co,"to-boolean":gs,"to-color":gs,"to-number":gs,"to-string":gs,var:Ic,within:Xa};function _d(s,[i,l,f,g]){i=i.evaluate(s),l=l.evaluate(s),f=f.evaluate(s);const v=g?g.evaluate(s):1,x=Al(i,l,f,v);if(x)throw new rr(x);return new Pn(i/255,l/255,f/255,v,!1)}function vd(s,i){return s in i}function gp(s,i){const l=i[s];return l===void 0?null:l}function Ka(s){return{type:s}}function xd(s){return{result:"success",value:s}}function Rl(s){return{result:"error",value:s}}function Nl(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function bd(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function yp(s){return!!s.expression&&s.expression.interpolated}function _n(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function Dc(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function kg(s){return s}function wd(s,i){const l=i.type==="color",f=s.stops&&typeof s.stops[0][0]=="object",g=f||!(f||s.property!==void 0),v=s.type||(yp(i)?"exponential":"interval");if(l||i.type==="padding"){const D=l?Pn.parse:Gi.parse;(s=fs({},s)).stops&&(s.stops=s.stops.map(k=>[k[0],D(k[1])])),s.default=D(s.default?s.default:i.default)}if(s.colorSpace&&(x=s.colorSpace)!=="rgb"&&x!=="hcl"&&x!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var x;let w,E,L;if(v==="exponential")w=cn;else if(v==="interval")w=Rg;else if(v==="categorical"){w=Sr,E=Object.create(null);for(const D of s.stops)E[D[0]]=D[1];L=typeof s.stops[0][0]}else{if(v!=="identity")throw new Error(`Unknown function type "${v}"`);w=_p}if(f){const D={},k=[];for(let G=0;G<s.stops.length;G++){const H=s.stops[G],nt=H[0].zoom;D[nt]===void 0&&(D[nt]={zoom:nt,type:s.type,property:s.property,default:s.default,stops:[]},k.push(nt)),D[nt].stops.push([H[0].value,H[1]])}const F=[];for(const G of k)F.push([D[G].zoom,wd(D[G],i)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:mi.interpolationFactor.bind(void 0,V),zoomStops:F.map(G=>G[0]),evaluate:({zoom:G},H)=>cn({stops:F,base:s.base},i,G).evaluate(G,H)}}if(g){const D=v==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:mi.interpolationFactor.bind(void 0,D),zoomStops:s.stops.map(k=>k[0]),evaluate:({zoom:k})=>w(s,i,k,E,L)}}return{kind:"source",evaluate(D,k){const F=k&&k.properties?k.properties[s.property]:void 0;return F===void 0?Cu(s.default,i.default):w(s,i,F,E,L)}}}function Cu(s,i,l){return s!==void 0?s:i!==void 0?i:l!==void 0?l:void 0}function Sr(s,i,l,f,g){return Cu(typeof l===g?f[l]:void 0,s.default,i.default)}function Rg(s,i,l){if(_n(l)!=="number")return Cu(s.default,i.default);const f=s.stops.length;if(f===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[f-1][0])return s.stops[f-1][1];const g=Iu(s.stops.map(v=>v[0]),l);return s.stops[g][1]}function cn(s,i,l){const f=s.base!==void 0?s.base:1;if(_n(l)!=="number")return Cu(s.default,i.default);const g=s.stops.length;if(g===1||l<=s.stops[0][0])return s.stops[0][1];if(l>=s.stops[g-1][0])return s.stops[g-1][1];const v=Iu(s.stops.map(D=>D[0]),l),x=function(D,k,F,V){const G=V-F,H=D-F;return G===0?0:k===1?H/G:(Math.pow(k,H)-1)/(Math.pow(k,G)-1)}(l,f,s.stops[v][0],s.stops[v+1][0]),w=s.stops[v][1],E=s.stops[v+1][1],L=Pi[i.type]||kg;return typeof w.evaluate=="function"?{evaluate(...D){const k=w.evaluate.apply(void 0,D),F=E.evaluate.apply(void 0,D);if(k!==void 0&&F!==void 0)return L(k,F,x,s.colorSpace)}}:L(w,E,x,s.colorSpace)}function _p(s,i,l){switch(i.type){case"color":l=Pn.parse(l);break;case"formatted":l=uo.fromString(l.toString());break;case"resolvedImage":l=Lo.fromString(l.toString());break;case"padding":l=Gi.parse(l);break;default:_n(l)===i.type||i.type==="enum"&&i.values[l]||(l=void 0)}return Cu(l,s.default,i.default)}ho.register(kl,{error:[{kind:"error"},[We],(s,[i])=>{throw new rr(i.evaluate(s))}],typeof:[We,[Oe],(s,[i])=>J(Mr(i.evaluate(s)))],"to-rgba":[j(te,4),[Pr],(s,[i])=>{const[l,f,g,v]=i.evaluate(s).rgb;return[255*l,255*f,255*g,v]}],rgb:[Pr,[te,te,te],_d],rgba:[Pr,[te,te,te,te],_d],has:{type:Ue,overloads:[[[We],(s,[i])=>vd(i.evaluate(s),s.properties())],[[We,ds],(s,[i,l])=>vd(i.evaluate(s),l.evaluate(s))]]},get:{type:Oe,overloads:[[[We],(s,[i])=>gp(i.evaluate(s),s.properties())],[[We,ds],(s,[i,l])=>gp(i.evaluate(s),l.evaluate(s))]]},"feature-state":[Oe,[We],(s,[i])=>gp(i.evaluate(s),s.featureState||{})],properties:[ds,[],s=>s.properties()],"geometry-type":[We,[],s=>s.geometryType()],id:[Oe,[],s=>s.id()],zoom:[te,[],s=>s.globals.zoom],"heatmap-density":[te,[],s=>s.globals.heatmapDensity||0],"line-progress":[te,[],s=>s.globals.lineProgress||0],accumulated:[Oe,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[te,Ka(te),(s,i)=>{let l=0;for(const f of i)l+=f.evaluate(s);return l}],"*":[te,Ka(te),(s,i)=>{let l=1;for(const f of i)l*=f.evaluate(s);return l}],"-":{type:te,overloads:[[[te,te],(s,[i,l])=>i.evaluate(s)-l.evaluate(s)],[[te],(s,[i])=>-i.evaluate(s)]]},"/":[te,[te,te],(s,[i,l])=>i.evaluate(s)/l.evaluate(s)],"%":[te,[te,te],(s,[i,l])=>i.evaluate(s)%l.evaluate(s)],ln2:[te,[],()=>Math.LN2],pi:[te,[],()=>Math.PI],e:[te,[],()=>Math.E],"^":[te,[te,te],(s,[i,l])=>Math.pow(i.evaluate(s),l.evaluate(s))],sqrt:[te,[te],(s,[i])=>Math.sqrt(i.evaluate(s))],log10:[te,[te],(s,[i])=>Math.log(i.evaluate(s))/Math.LN10],ln:[te,[te],(s,[i])=>Math.log(i.evaluate(s))],log2:[te,[te],(s,[i])=>Math.log(i.evaluate(s))/Math.LN2],sin:[te,[te],(s,[i])=>Math.sin(i.evaluate(s))],cos:[te,[te],(s,[i])=>Math.cos(i.evaluate(s))],tan:[te,[te],(s,[i])=>Math.tan(i.evaluate(s))],asin:[te,[te],(s,[i])=>Math.asin(i.evaluate(s))],acos:[te,[te],(s,[i])=>Math.acos(i.evaluate(s))],atan:[te,[te],(s,[i])=>Math.atan(i.evaluate(s))],min:[te,Ka(te),(s,i)=>Math.min(...i.map(l=>l.evaluate(s)))],max:[te,Ka(te),(s,i)=>Math.max(...i.map(l=>l.evaluate(s)))],abs:[te,[te],(s,[i])=>Math.abs(i.evaluate(s))],round:[te,[te],(s,[i])=>{const l=i.evaluate(s);return l<0?-Math.round(-l):Math.round(l)}],floor:[te,[te],(s,[i])=>Math.floor(i.evaluate(s))],ceil:[te,[te],(s,[i])=>Math.ceil(i.evaluate(s))],"filter-==":[Ue,[We,Oe],(s,[i,l])=>s.properties()[i.value]===l.value],"filter-id-==":[Ue,[Oe],(s,[i])=>s.id()===i.value],"filter-type-==":[Ue,[We],(s,[i])=>s.geometryType()===i.value],"filter-<":[Ue,[We,Oe],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f<g}],"filter-id-<":[Ue,[Oe],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l<f}],"filter->":[Ue,[We,Oe],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f>g}],"filter-id->":[Ue,[Oe],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l>f}],"filter-<=":[Ue,[We,Oe],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f<=g}],"filter-id-<=":[Ue,[Oe],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l<=f}],"filter->=":[Ue,[We,Oe],(s,[i,l])=>{const f=s.properties()[i.value],g=l.value;return typeof f==typeof g&&f>=g}],"filter-id->=":[Ue,[Oe],(s,[i])=>{const l=s.id(),f=i.value;return typeof l==typeof f&&l>=f}],"filter-has":[Ue,[Oe],(s,[i])=>i.value in s.properties()],"filter-has-id":[Ue,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Ue,[j(We)],(s,[i])=>i.value.indexOf(s.geometryType())>=0],"filter-id-in":[Ue,[j(Oe)],(s,[i])=>i.value.indexOf(s.id())>=0],"filter-in-small":[Ue,[We,j(Oe)],(s,[i,l])=>l.value.indexOf(s.properties()[i.value])>=0],"filter-in-large":[Ue,[We,j(Oe)],(s,[i,l])=>function(f,g,v,x){for(;v<=x;){const w=v+x>>1;if(g[w]===f)return!0;g[w]>f?x=w-1:v=w+1}return!1}(s.properties()[i.value],l.value,0,l.value.length-1)],all:{type:Ue,overloads:[[[Ue,Ue],(s,[i,l])=>i.evaluate(s)&&l.evaluate(s)],[Ka(Ue),(s,i)=>{for(const l of i)if(!l.evaluate(s))return!1;return!0}]]},any:{type:Ue,overloads:[[[Ue,Ue],(s,[i,l])=>i.evaluate(s)||l.evaluate(s)],[Ka(Ue),(s,i)=>{for(const l of i)if(l.evaluate(s))return!0;return!1}]]},"!":[Ue,[Ue],(s,[i])=>!i.evaluate(s)],"is-supported-script":[Ue,[We],(s,[i])=>{const l=s.globals&&s.globals.isSupportedScript;return!l||l(i.evaluate(s))}],upcase:[We,[We],(s,[i])=>i.evaluate(s).toUpperCase()],downcase:[We,[We],(s,[i])=>i.evaluate(s).toLowerCase()],concat:[We,Ka(Oe),(s,i)=>i.map(l=>_u(l.evaluate(s))).join("")],"resolved-locale":[We,[Ha],(s,[i])=>i.evaluate(s).resolvedLocale()]});class jn{constructor(i,l){var f;this.expression=i,this._warningHistory={},this._evaluator=new An,this._defaultValue=l?(f=l).type==="color"&&Dc(f.default)?new Pn(0,0,0,0):f.type==="color"?Pn.parse(f.default)||null:f.type==="padding"?Gi.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?To.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(i,l,f,g,v,x){return this._evaluator.globals=i,this._evaluator.feature=l,this._evaluator.featureState=f,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x,this.expression.evaluate(this._evaluator)}evaluate(i,l,f,g,v,x){this._evaluator.globals=i,this._evaluator.feature=l||null,this._evaluator.featureState=f||null,this._evaluator.canonical=g,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=x||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new rr(`Expected value to be one of ${Object.keys(this._enumValues).map(E=>JSON.stringify(E)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Bn(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in kl}function Ja(s,i){const l=new vc(kl,bu,[],i?function(g){const v={color:Pr,string:We,number:te,enum:We,boolean:Ue,formatted:Fr,padding:rt,resolvedImage:z,variableAnchorOffsetCollection:B};return g.type==="array"?j(v[g.value]||Oe,g.length):v[g.type]}(i):void 0),f=l.parse(s,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?xd(new jn(f,i)):Rl(l.errors)}class kc{constructor(i,l){this.kind=i,this._styleExpression=l,this.isStateDependent=i!=="constant"&&!wu(l.expression)}evaluateWithoutErrorHandling(i,l,f,g,v,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,f,g,v,x)}evaluate(i,l,f,g,v,x){return this._styleExpression.evaluate(i,l,f,g,v,x)}}class vp{constructor(i,l,f,g){this.kind=i,this.zoomStops=f,this._styleExpression=l,this.isStateDependent=i!=="camera"&&!wu(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(i,l,f,g,v,x){return this._styleExpression.evaluateWithoutErrorHandling(i,l,f,g,v,x)}evaluate(i,l,f,g,v,x){return this._styleExpression.evaluate(i,l,f,g,v,x)}interpolationFactor(i,l,f){return this.interpolationType?mi.interpolationFactor(this.interpolationType,i,l,f):0}}function Sd(s,i){const l=Ja(s,i);if(l.result==="error")return l;const f=l.value.expression,g=Ec(f);if(!g&&!Nl(i))return Rl([new lo("","data expressions not supported")]);const v=Su(f,["zoom"]);if(!v&&!bd(i))return Rl([new lo("","zoom expressions not supported")]);const x=Nc(f);return x||v?x instanceof lo?Rl([x]):x instanceof mi&&!yp(i)?Rl([new lo("",'"interpolate" expressions cannot be used with this property')]):xd(x?new vp(g?"camera":"composite",l.value,x.labels,x instanceof mi?x.interpolation:void 0):new kc(g?"constant":"source",l.value)):Rl([new lo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Rc{constructor(i,l){this._parameters=i,this._specification=l,fs(this,wd(this._parameters,this._specification))}static deserialize(i){return new Rc(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function Nc(s){let i=null;if(s instanceof Lc)i=Nc(s.result);else if(s instanceof Tc){for(const l of s.args)if(i=Nc(l),i)break}else(s instanceof Eu||s instanceof mi)&&s.input instanceof ho&&s.input.name==="zoom"&&(i=s);return i instanceof lo||s.eachChild(l=>{const f=Nc(l);f instanceof lo?i=f:!i&&f?i=new lo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new lo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function Oc(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const i of s.slice(1))if(!Oc(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const Id={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function zc(s){if(s==null)return{filter:()=>!0,needGeometry:!1};Oc(s)||(s=Bc(s));const i=Ja(s,Id);if(i.result==="error")throw new Error(i.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,f,g)=>i.value.evaluate(l,f,{},g),needGeometry:Fc(s)}}function Ed(s,i){return s<i?-1:s>i?1:0}function Fc(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let i=1;i<s.length;i++)if(Fc(s[i]))return!0;return!1}function Bc(s){if(!s)return!0;const i=s[0];return s.length<=1?i!=="any":i==="=="?xp(s[1],s[2],"=="):i==="!="?Vc(xp(s[1],s[2],"==")):i==="<"||i===">"||i==="<="||i===">="?xp(s[1],s[2],i):i==="any"?(l=s.slice(1),["any"].concat(l.map(Bc))):i==="all"?["all"].concat(s.slice(1).map(Bc)):i==="none"?["all"].concat(s.slice(1).map(Bc).map(Vc)):i==="in"?Cd(s[1],s.slice(2)):i==="!in"?Vc(Cd(s[1],s.slice(2))):i==="has"?Td(s[1]):i==="!has"?Vc(Td(s[1])):i!=="within"||s;var l}function xp(s,i,l){switch(s){case"$type":return[`filter-type-${l}`,i];case"$id":return[`filter-id-${l}`,i];default:return[`filter-${l}`,s,i]}}function Cd(s,i){if(i.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(l=>typeof l!=typeof i[0])?["filter-in-large",s,["literal",i.sort(Ed)]]:["filter-in-small",s,["literal",i]]}}function Td(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Vc(s){return["!",s]}function bp(s){const i=typeof s;if(i==="number"||i==="boolean"||i==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const v of s)g+=`${bp(v)},`;return`${g}]`}const l=Object.keys(s).sort();let f="{";for(let g=0;g<l.length;g++)f+=`${JSON.stringify(l[g])}:${bp(s[l[g]])},`;return`${f}}`}function Ng(s){let i="";for(const l of nr)i+=`/${bp(s[l])}`;return i}function Ld(s){const i=s.value;return i?[new Zt(s.key,i,"constants have been deprecated as of v8")]:[]}function cr(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function va(s){if(Array.isArray(s))return s.map(va);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const i={};for(const l in s)i[l]=va(s[l]);return i}return cr(s)}function Ai(s){const i=s.key,l=s.value,f=s.valueSpec||{},g=s.objectElementValidators||{},v=s.style,x=s.styleSpec,w=s.validateSpec;let E=[];const L=_n(l);if(L!=="object")return[new Zt(i,l,`object expected, ${L} found`)];for(const D in l){const k=D.split(".")[0],F=f[k]||f["*"];let V;if(g[k])V=g[k];else if(f[k])V=w;else if(g["*"])V=g["*"];else{if(!f["*"]){E.push(new Zt(i,l[D],`unknown property "${D}"`));continue}V=w}E=E.concat(V({key:(i&&`${i}.`)+D,value:l[D],valueSpec:F,style:v,styleSpec:x,object:l,objectKey:D,validateSpec:w},l))}for(const D in f)g[D]||f[D].required&&f[D].default===void 0&&l[D]===void 0&&E.push(new Zt(i,l,`missing required property "${D}"`));return E}function wp(s){const i=s.value,l=s.valueSpec,f=s.style,g=s.styleSpec,v=s.key,x=s.arrayElementValidator||s.validateSpec;if(_n(i)!=="array")return[new Zt(v,i,`array expected, ${_n(i)} found`)];if(l.length&&i.length!==l.length)return[new Zt(v,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new Zt(v,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let w={type:l.value,values:l.values};g.$version<7&&(w.function=l.function),_n(l.value)==="object"&&(w=l.value);let E=[];for(let L=0;L<i.length;L++)E=E.concat(x({array:i,arrayIndex:L,value:i[L],valueSpec:w,validateSpec:s.validateSpec,style:f,styleSpec:g,key:`${v}[${L}]`}));return E}function Uc(s){const i=s.key,l=s.value,f=s.valueSpec;let g=_n(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new Zt(i,l,`number expected, ${g} found`)]:"minimum"in f&&l<f.minimum?[new Zt(i,l,`${l} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&l>f.maximum?[new Zt(i,l,`${l} is greater than the maximum value ${f.maximum}`)]:[]}function Pd(s){const i=s.valueSpec,l=cr(s.value.type);let f,g,v,x={};const w=l!=="categorical"&&s.value.property===void 0,E=!w,L=_n(s.value.stops)==="array"&&_n(s.value.stops[0])==="array"&&_n(s.value.stops[0][0])==="object",D=Ai({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(V){if(l==="identity")return[new Zt(V.key,V.value,'identity function may not have a "stops" property')];let G=[];const H=V.value;return G=G.concat(wp({key:V.key,value:H,valueSpec:V.valueSpec,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:k})),_n(H)==="array"&&H.length===0&&G.push(new Zt(V.key,H,"array must have at least one stop")),G},default:function(V){return V.validateSpec({key:V.key,value:V.value,valueSpec:i,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec})}}});return l==="identity"&&w&&D.push(new Zt(s.key,s.value,'missing required property "property"')),l==="identity"||s.value.stops||D.push(new Zt(s.key,s.value,'missing required property "stops"')),l==="exponential"&&s.valueSpec.expression&&!yp(s.valueSpec)&&D.push(new Zt(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(E&&!Nl(s.valueSpec)?D.push(new Zt(s.key,s.value,"property functions not supported")):w&&!bd(s.valueSpec)&&D.push(new Zt(s.key,s.value,"zoom functions not supported"))),l!=="categorical"&&!L||s.value.property!==void 0||D.push(new Zt(s.key,s.value,'"property" property is required')),D;function k(V){let G=[];const H=V.value,nt=V.key;if(_n(H)!=="array")return[new Zt(nt,H,`array expected, ${_n(H)} found`)];if(H.length!==2)return[new Zt(nt,H,`array length 2 expected, length ${H.length} found`)];if(L){if(_n(H[0])!=="object")return[new Zt(nt,H,`object expected, ${_n(H[0])} found`)];if(H[0].zoom===void 0)return[new Zt(nt,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new Zt(nt,H,"object stop key must have value")];if(v&&v>cr(H[0].zoom))return[new Zt(nt,H[0].zoom,"stop zoom values must appear in ascending order")];cr(H[0].zoom)!==v&&(v=cr(H[0].zoom),g=void 0,x={}),G=G.concat(Ai({key:`${nt}[0]`,value:H[0],valueSpec:{zoom:{}},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Uc,value:F}}))}else G=G.concat(F({key:`${nt}[0]`,value:H[0],valueSpec:{},validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec},H));return Bn(va(H[1]))?G.concat([new Zt(`${nt}[1]`,H[1],"expressions are not allowed in function stops.")]):G.concat(V.validateSpec({key:`${nt}[1]`,value:H[1],valueSpec:i,validateSpec:V.validateSpec,style:V.style,styleSpec:V.styleSpec}))}function F(V,G){const H=_n(V.value),nt=cr(V.value),lt=V.value!==null?V.value:G;if(f){if(H!==f)return[new Zt(V.key,lt,`${H} stop domain type must match previous stop domain type ${f}`)]}else f=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new Zt(V.key,lt,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&l!=="categorical"){let xt=`number expected, ${H} found`;return Nl(i)&&l===void 0&&(xt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Zt(V.key,lt,xt)]}return l!=="categorical"||H!=="number"||isFinite(nt)&&Math.floor(nt)===nt?l!=="categorical"&&H==="number"&&g!==void 0&&nt<g?[new Zt(V.key,lt,"stop domain values must appear in ascending order")]:(g=nt,l==="categorical"&&nt in x?[new Zt(V.key,lt,"stop domain values must be unique")]:(x[nt]=!0,[])):[new Zt(V.key,lt,`integer expected, found ${nt}`)]}}function xa(s){const i=(s.expressionContext==="property"?Sd:Ja)(va(s.value),s.valueSpec);if(i.result==="error")return i.value.map(f=>new Zt(`${s.key}${f.key}`,s.value,f.message));const l=i.value.expression||i.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!l.outputDefined())return[new Zt(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!wu(l))return[new Zt(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!wu(l))return[new Zt(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Su(l,["zoom","feature-state"]))return[new Zt(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!Ec(l))return[new Zt(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ba(s){const i=s.key,l=s.value,f=s.valueSpec,g=[];return Array.isArray(f.values)?f.values.indexOf(cr(l))===-1&&g.push(new Zt(i,l,`expected one of [${f.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(f.values).indexOf(cr(l))===-1&&g.push(new Zt(i,l,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function Ol(s){return Oc(va(s.value))?xa(fs({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Sp(s)}function Sp(s){const i=s.value,l=s.key;if(_n(i)!=="array")return[new Zt(l,i,`array expected, ${_n(i)} found`)];const f=s.styleSpec;let g,v=[];if(i.length<1)return[new Zt(l,i,"filter array must have at least 1 element")];switch(v=v.concat(ba({key:`${l}[0]`,value:i[0],valueSpec:f.filter_operator,style:s.style,styleSpec:s.styleSpec})),cr(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&cr(i[1])==="$type"&&v.push(new Zt(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&v.push(new Zt(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(g=_n(i[1]),g!=="string"&&v.push(new Zt(`${l}[1]`,i[1],`string expected, ${g} found`)));for(let x=2;x<i.length;x++)g=_n(i[x]),cr(i[1])==="$type"?v=v.concat(ba({key:`${l}[${x}]`,value:i[x],valueSpec:f.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&v.push(new Zt(`${l}[${x}]`,i[x],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let x=1;x<i.length;x++)v=v.concat(Sp({key:`${l}[${x}]`,value:i[x],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=_n(i[1]),i.length!==2?v.push(new Zt(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="string"&&v.push(new Zt(`${l}[1]`,i[1],`string expected, ${g} found`));break;case"within":g=_n(i[1]),i.length!==2?v.push(new Zt(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):g!=="object"&&v.push(new Zt(`${l}[1]`,i[1],`object expected, ${g} found`))}return v}function Gc(s,i){const l=s.key,f=s.validateSpec,g=s.style,v=s.styleSpec,x=s.value,w=s.objectKey,E=v[`${i}_${s.layerType}`];if(!E)return[];const L=w.match(/^(.*)-transition$/);if(i==="paint"&&L&&E[L[1]]&&E[L[1]].transition)return f({key:l,value:x,valueSpec:v.transition,style:g,styleSpec:v});const D=s.valueSpec||E[w];if(!D)return[new Zt(l,x,`unknown property "${w}"`)];let k;if(_n(x)==="string"&&Nl(D)&&!D.tokens&&(k=/^{([^}]+)}$/.exec(x)))return[new Zt(l,x,`"${w}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(k[1])} }\`.`)];const F=[];return s.layerType==="symbol"&&(w==="text-field"&&g&&!g.glyphs&&F.push(new Zt(l,x,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Dc(va(x))&&cr(x.type)==="identity"&&F.push(new Zt(l,x,'"text-font" does not support identity functions'))),F.concat(f({key:s.key,value:x,valueSpec:D,style:g,styleSpec:v,expressionContext:"property",propertyType:i,propertyKey:w}))}function Ip(s){return Gc(s,"paint")}function Ep(s){return Gc(s,"layout")}function Tu(s){let i=[];const l=s.value,f=s.key,g=s.style,v=s.styleSpec;l.type||l.ref||i.push(new Zt(f,l,'either "type" or "ref" is required'));let x=cr(l.type);const w=cr(l.ref);if(l.id){const E=cr(l.id);for(let L=0;L<s.arrayIndex;L++){const D=g.layers[L];cr(D.id)===E&&i.push(new Zt(f,l.id,`duplicate layer id "${l.id}", previously used at line ${D.id.__line__}`))}}if("ref"in l){let E;["type","source","source-layer","filter","layout"].forEach(L=>{L in l&&i.push(new Zt(f,l[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{cr(L.id)===w&&(E=L)}),E?E.ref?i.push(new Zt(f,l.ref,"ref cannot reference another ref layer")):x=cr(E.type):i.push(new Zt(f,l.ref,`ref layer "${w}" not found`))}else if(x!=="background")if(l.source){const E=g.sources&&g.sources[l.source],L=E&&cr(E.type);E?L==="vector"&&x==="raster"?i.push(new Zt(f,l.source,`layer "${l.id}" requires a raster source`)):L!=="raster-dem"&&x==="hillshade"?i.push(new Zt(f,l.source,`layer "${l.id}" requires a raster-dem source`)):L==="raster"&&x!=="raster"?i.push(new Zt(f,l.source,`layer "${l.id}" requires a vector source`)):L!=="vector"||l["source-layer"]?L==="raster-dem"&&x!=="hillshade"?i.push(new Zt(f,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):x!=="line"||!l.paint||!l.paint["line-gradient"]||L==="geojson"&&E.lineMetrics||i.push(new Zt(f,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new Zt(f,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new Zt(f,l.source,`source "${l.source}" not found`))}else i.push(new Zt(f,l,'missing required property "source"'));return i=i.concat(Ai({key:f,value:l,valueSpec:v.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${f}.type`,value:l.type,valueSpec:v.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:l,objectKey:"type"}),filter:Ol,layout:E=>Ai({layer:l,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":L=>Ep(fs({layerType:x},L))}}),paint:E=>Ai({layer:l,key:E.key,value:E.value,style:E.style,styleSpec:E.styleSpec,validateSpec:E.validateSpec,objectElementValidators:{"*":L=>Ip(fs({layerType:x},L))}})}})),i}function Qa(s){const i=s.value,l=s.key,f=_n(i);return f!=="string"?[new Zt(l,i,`string expected, ${f} found`)]:[]}const Ad={promoteId:function({key:s,value:i}){if(_n(i)==="string")return Qa({key:s,value:i});{const l=[];for(const f in i)l.push(...Qa({key:`${s}.${f}`,value:i[f]}));return l}}};function Md(s){const i=s.value,l=s.key,f=s.styleSpec,g=s.style,v=s.validateSpec;if(!i.type)return[new Zt(l,i,'"type" is required')];const x=cr(i.type);let w;switch(x){case"vector":case"raster":return w=Ai({key:l,value:i,valueSpec:f[`source_${x.replace("-","_")}`],style:s.style,styleSpec:f,objectElementValidators:Ad,validateSpec:v}),w;case"raster-dem":return w=function(E){var L;const D=(L=E.sourceName)!==null&&L!==void 0?L:"",k=E.value,F=E.styleSpec,V=F.source_raster_dem,G=E.style;let H=[];const nt=_n(k);if(k===void 0)return H;if(nt!=="object")return H.push(new Zt("source_raster_dem",k,`object expected, ${nt} found`)),H;const lt=cr(k.encoding)==="custom",xt=["redFactor","greenFactor","blueFactor","baseShift"],ut=E.value.encoding?`"${E.value.encoding}"`:"Default";for(const mt in k)!lt&&xt.includes(mt)?H.push(new Zt(mt,k[mt],`In "${D}": "${mt}" is only valid when "encoding" is set to "custom". ${ut} encoding found`)):V[mt]?H=H.concat(E.validateSpec({key:mt,value:k[mt],valueSpec:V[mt],validateSpec:E.validateSpec,style:G,styleSpec:F})):H.push(new Zt(mt,k[mt],`unknown property "${mt}"`));return H}({sourceName:l,value:i,style:s.style,styleSpec:f,validateSpec:v}),w;case"geojson":if(w=Ai({key:l,value:i,valueSpec:f.source_geojson,style:g,styleSpec:f,validateSpec:v,objectElementValidators:Ad}),i.cluster)for(const E in i.clusterProperties){const[L,D]=i.clusterProperties[E],k=typeof L=="string"?[L,["accumulated"],["get",E]]:L;w.push(...xa({key:`${l}.${E}.map`,value:D,validateSpec:v,expressionContext:"cluster-map"})),w.push(...xa({key:`${l}.${E}.reduce`,value:k,validateSpec:v,expressionContext:"cluster-reduce"}))}return w;case"video":return Ai({key:l,value:i,valueSpec:f.source_video,style:g,validateSpec:v,styleSpec:f});case"image":return Ai({key:l,value:i,valueSpec:f.source_image,style:g,validateSpec:v,styleSpec:f});case"canvas":return[new Zt(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ba({key:`${l}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:v,styleSpec:f})}}function Dd(s){const i=s.value,l=s.styleSpec,f=l.light,g=s.style;let v=[];const x=_n(i);if(i===void 0)return v;if(x!=="object")return v=v.concat([new Zt("light",i,`object expected, ${x} found`)]),v;for(const w in i){const E=w.match(/^(.*)-transition$/);v=v.concat(E&&f[E[1]]&&f[E[1]].transition?s.validateSpec({key:w,value:i[w],valueSpec:l.transition,validateSpec:s.validateSpec,style:g,styleSpec:l}):f[w]?s.validateSpec({key:w,value:i[w],valueSpec:f[w],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new Zt(w,i[w],`unknown property "${w}"`)])}return v}function kd(s){const i=s.value,l=s.styleSpec,f=l.sky,g=s.style,v=_n(i);if(i===void 0)return[];if(v!=="object")return[new Zt("sky",i,`object expected, ${v} found`)];let x=[];for(const w in i)x=x.concat(f[w]?ys({key:w,value:i[w],valueSpec:f[w],style:g,styleSpec:l}):[new Zt(w,i[w],`unknown property "${w}"`)]);return x}function Lu(s){const i=s.value,l=s.styleSpec,f=l.terrain,g=s.style;let v=[];const x=_n(i);if(i===void 0)return v;if(x!=="object")return v=v.concat([new Zt("terrain",i,`object expected, ${x} found`)]),v;for(const w in i)v=v.concat(f[w]?s.validateSpec({key:w,value:i[w],valueSpec:f[w],validateSpec:s.validateSpec,style:g,styleSpec:l}):[new Zt(w,i[w],`unknown property "${w}"`)]);return v}function Pu(s){let i=[];const l=s.value,f=s.key;if(Array.isArray(l)){const g=[],v=[];for(const x in l)l[x].id&&g.includes(l[x].id)&&i.push(new Zt(f,l,`all the sprites' ids must be unique, but ${l[x].id} is duplicated`)),g.push(l[x].id),l[x].url&&v.includes(l[x].url)&&i.push(new Zt(f,l,`all the sprites' URLs must be unique, but ${l[x].url} is duplicated`)),v.push(l[x].url),i=i.concat(Ai({key:`${f}[${x}]`,value:l[x],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return i}return Qa({key:f,value:l})}const qi={"*":()=>[],array:wp,boolean:function(s){const i=s.value,l=s.key,f=_n(i);return f!=="boolean"?[new Zt(l,i,`boolean expected, ${f} found`)]:[]},number:Uc,color:function(s){const i=s.key,l=s.value,f=_n(l);return f!=="string"?[new Zt(i,l,`color expected, ${f} found`)]:Pn.parse(String(l))?[]:[new Zt(i,l,`color expected, "${l}" found`)]},constants:Ld,enum:ba,filter:Ol,function:Pd,layer:Tu,object:Ai,source:Md,light:Dd,sky:kd,terrain:Lu,string:Qa,formatted:function(s){return Qa(s).length===0?[]:xa(s)},resolvedImage:function(s){return Qa(s).length===0?[]:xa(s)},padding:function(s){const i=s.key,l=s.value;if(_n(l)==="array"){if(l.length<1||l.length>4)return[new Zt(i,l,`padding requires 1 to 4 values; ${l.length} values found`)];const f={type:"number"};let g=[];for(let v=0;v<l.length;v++)g=g.concat(s.validateSpec({key:`${i}[${v}]`,value:l[v],validateSpec:s.validateSpec,valueSpec:f}));return g}return Uc({key:i,value:l,valueSpec:{}})},variableAnchorOffsetCollection:function(s){const i=s.key,l=s.value,f=_n(l),g=s.styleSpec;if(f!=="array"||l.length<1||l.length%2!=0)return[new Zt(i,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let v=[];for(let x=0;x<l.length;x+=2)v=v.concat(ba({key:`${i}[${x}]`,value:l[x],valueSpec:g.layout_symbol["text-anchor"]})),v=v.concat(wp({key:`${i}[${x+1}]`,value:l[x+1],valueSpec:{length:2,value:"number"},validateSpec:s.validateSpec,style:s.style,styleSpec:g}));return v},sprite:Pu};function ys(s){const i=s.value,l=s.valueSpec,f=s.styleSpec;return s.validateSpec=ys,l.expression&&Dc(cr(i))?Pd(s):l.expression&&Bn(va(i))?xa(s):l.type&&qi[l.type]?qi[l.type](s):Ai(fs({},s,{valueSpec:l.type?f[l.type]:l}))}function Cp(s){const i=s.value,l=s.key,f=Qa(s);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new Zt(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new Zt(l,i,'"glyphs" url must include a "{range}" token'))),f}function jo(s,i=Lt){let l=[];return l=l.concat(ys({key:"",value:s,valueSpec:i.$root,styleSpec:i,style:s,validateSpec:ys,objectElementValidators:{glyphs:Cp,"*":()=>[]}})),s.constants&&(l=l.concat(Ld({key:"constants",value:s.constants,style:s,styleSpec:i,validateSpec:ys}))),zl(l)}function _s(s){return function(i){return s({...i,validateSpec:ys})}}function zl(s){return[].concat(s).sort((i,l)=>i.line-l.line)}function Wo(s){return function(...i){return zl(s.apply(this,i))}}jo.source=Wo(_s(Md)),jo.sprite=Wo(_s(Pu)),jo.glyphs=Wo(_s(Cp)),jo.light=Wo(_s(Dd)),jo.sky=Wo(_s(kd)),jo.terrain=Wo(_s(Lu)),jo.layer=Wo(_s(Tu)),jo.filter=Wo(_s(Ol)),jo.paintProperty=Wo(_s(Ip)),jo.layoutProperty=Wo(_s(Ep));const $a=jo,Og=$a.light,Tp=$a.paintProperty,zg=$a.layoutProperty;function Fl(s,i){let l=!1;if(i&&i.length)for(const f of i)s.fire(new Ce(new Error(f.message))),l=!0;return l}class Au{constructor(i,l,f){const g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(l=x[1])+2*(f=x[2]);for(let E=0;E<this.d*this.d;E++){const L=x[3+E],D=x[3+E+1];g.push(L===D?null:x.subarray(L,D))}const w=x[3+g.length+1];this.keys=x.subarray(x[3+g.length],w),this.bboxes=x.subarray(w),this.insert=this._insertReadonly}else{this.d=l+2*f;for(let x=0;x<this.d*this.d;x++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=f,this.scale=l/i,this.uid=0;const v=f/l*i;this.min=-v,this.max=i+v}insert(i,l,f,g,v){this._forEachCell(l,f,g,v,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(f),this.bboxes.push(g),this.bboxes.push(v)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,l,f,g,v,x){this.cells[v].push(x)}query(i,l,f,g,v){const x=this.min,w=this.max;if(i<=x&&l<=x&&w<=f&&w<=g&&!v)return Array.prototype.slice.call(this.keys);{const E=[];return this._forEachCell(i,l,f,g,this._queryCell,E,{},v),E}}_queryCell(i,l,f,g,v,x,w,E){const L=this.cells[v];if(L!==null){const D=this.keys,k=this.bboxes;for(let F=0;F<L.length;F++){const V=L[F];if(w[V]===void 0){const G=4*V;(E?E(k[G+0],k[G+1],k[G+2],k[G+3]):i<=k[G+2]&&l<=k[G+3]&&f>=k[G+0]&&g>=k[G+1])?(w[V]=!0,x.push(D[V])):w[V]=!1}}}}_forEachCell(i,l,f,g,v,x,w,E){const L=this._convertToCellCoord(i),D=this._convertToCellCoord(l),k=this._convertToCellCoord(f),F=this._convertToCellCoord(g);for(let V=L;V<=k;V++)for(let G=D;G<=F;G++){const H=this.d*G+V;if((!E||E(this._convertFromCellCoord(V),this._convertFromCellCoord(G),this._convertFromCellCoord(V+1),this._convertFromCellCoord(G+1)))&&v.call(this,i,l,f,g,H,x,w,E))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,l=3+this.cells.length+1+1;let f=0;for(let x=0;x<this.cells.length;x++)f+=this.cells[x].length;const g=new Int32Array(l+f+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let v=l;for(let x=0;x<i.length;x++){const w=i[x];g[3+x]=v,g.set(w,v),v+=w.length}return g[3+i.length]=v,g.set(this.keys,v),v+=this.keys.length,g[3+i.length+1]=v,g.set(this.bboxes,v),v+=this.bboxes.length,g.buffer}static serialize(i,l){const f=i.toArrayBuffer();return l&&l.push(f),{buffer:f}}static deserialize(i){return new Au(i.buffer)}}const vs={};function ce(s,i,l={}){if(vs[s])throw new Error(`${s} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:s,writeable:!1}),vs[s]={klass:i,omit:l.omit||[],shallow:l.shallow||[]}}ce("Object",Object),ce("TransferableGridIndex",Au),ce("Color",Pn),ce("Error",Error),ce("AJAXError",Dn),ce("ResolvedImage",Lo),ce("StylePropertyFunction",Rc),ce("StyleExpression",jn,{omit:["_evaluator"]}),ce("ZoomDependentExpression",vp),ce("ZoomConstantExpression",kc),ce("CompoundExpression",ho,{omit:["_evaluate"]});for(const s in kl)kl[s]._classRegistryKey||ce(`Expression_${s}`,kl[s]);function qc(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Bl(s,i){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error)return s;if(qc(s)||je(s))return i&&i.push(s),s;if(ArrayBuffer.isView(s)){const l=s;return i&&i.push(l.buffer),l}if(s instanceof ImageData)return i&&i.push(s.data.buffer),s;if(Array.isArray(s)){const l=[];for(const f of s)l.push(Bl(f,i));return l}if(typeof s=="object"){const l=s.constructor,f=l._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${l.name}`);if(!vs[f])throw new Error(`${f} is not registered.`);const g=l.serialize?l.serialize(s,i):{};if(l.serialize){if(i&&g===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const v in s){if(!s.hasOwnProperty(v)||vs[f].omit.indexOf(v)>=0)continue;const x=s[v];g[v]=vs[f].shallow.indexOf(v)>=0?x:Bl(x,i)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(g.$name=f),g}throw new Error("can't serialize object of type "+typeof s)}function Vl(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||s instanceof Error||qc(s)||je(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Vl);if(typeof s=="object"){const i=s.$name||"Object";if(!vs[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:l}=vs[i];if(!l)throw new Error(`can't deserialize unregistered class ${i}`);if(l.deserialize)return l.deserialize(s);const f=Object.create(l.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const v=s[g];f[g]=vs[i].shallow.indexOf(g)>=0?v:Vl(v)}return f}throw new Error("can't deserialize object of type "+typeof s)}class Rd{constructor(){this.first=!0}update(i,l){const f=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=l),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=f,!0))}}const re={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function Ul(s){for(const i of s)if(jc(i.charCodeAt(0)))return!0;return!1}function Nd(s){for(const i of s)if(!Od(i.charCodeAt(0)))return!1;return!0}function Od(s){return!(re.Arabic(s)||re["Arabic Supplement"](s)||re["Arabic Extended-A"](s)||re["Arabic Presentation Forms-A"](s)||re["Arabic Presentation Forms-B"](s))}function jc(s){return!(s!==746&&s!==747&&(s<4352||!(re["Bopomofo Extended"](s)||re.Bopomofo(s)||re["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||re["CJK Compatibility Ideographs"](s)||re["CJK Compatibility"](s)||re["CJK Radicals Supplement"](s)||re["CJK Strokes"](s)||!(!re["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||re["CJK Unified Ideographs Extension A"](s)||re["CJK Unified Ideographs"](s)||re["Enclosed CJK Letters and Months"](s)||re["Hangul Compatibility Jamo"](s)||re["Hangul Jamo Extended-A"](s)||re["Hangul Jamo Extended-B"](s)||re["Hangul Jamo"](s)||re["Hangul Syllables"](s)||re.Hiragana(s)||re["Ideographic Description Characters"](s)||re.Kanbun(s)||re["Kangxi Radicals"](s)||re["Katakana Phonetic Extensions"](s)||re.Katakana(s)&&s!==12540||!(!re["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!re["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||re["Unified Canadian Aboriginal Syllabics"](s)||re["Unified Canadian Aboriginal Syllabics Extended"](s)||re["Vertical Forms"](s)||re["Yijing Hexagram Symbols"](s)||re["Yi Syllables"](s)||re["Yi Radicals"](s))))}function Lp(s){return!(jc(s)||function(i){return!!(re["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||re["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||re["Letterlike Symbols"](i)||re["Number Forms"](i)||re["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||re["Control Pictures"](i)&&i!==9251||re["Optical Character Recognition"](i)||re["Enclosed Alphanumerics"](i)||re["Geometric Shapes"](i)||re["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||re["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||re["CJK Symbols and Punctuation"](i)||re.Katakana(i)||re["Private Use Area"](i)||re["CJK Compatibility Forms"](i)||re["Small Form Variants"](i)||re["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(s))}function Wc(s){return s>=1424&&s<=2303||re["Arabic Presentation Forms-A"](s)||re["Arabic Presentation Forms-B"](s)}function zd(s,i){return!(!i&&Wc(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||re.Khmer(s))}function Fg(s){for(const i of s)if(Wc(i.charCodeAt(0)))return!0;return!1}const wa=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(s){this.pluginStatus=s.pluginStatus,this.pluginURL=s.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(s){this.applyArabicShaping=s.applyArabicShaping,this.processBidirectionalText=s.processBidirectionalText,this.processStyledBidirectionalText=s.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class Kn{constructor(i,l){this.zoom=i,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Rd,this.transition={})}isSupportedScript(i){return function(l,f){for(const g of l)if(!zd(g.charCodeAt(0),f))return!1;return!0}(i,wa.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,l=i-Math.floor(i),f=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*l}}}class Mu{constructor(i,l){this.property=i,this.value=l,this.expression=function(f,g){if(Dc(f))return new Rc(f,g);if(Bn(f)){const v=Sd(f,g);if(v.result==="error")throw new Error(v.value.map(x=>`${x.key}: ${x.message}`).join(", "));return v.value}{let v=f;return g.type==="color"&&typeof f=="string"?v=Pn.parse(f):g.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(v=To.parse(f)):v=Gi.parse(f),{kind:"constant",evaluate:()=>v}}}(l===void 0?i.specification.default:l,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,l,f){return this.property.possiblyEvaluate(this,i,l,f)}}class Zc{constructor(i){this.property=i,this.value=new Mu(i,void 0)}transitioned(i,l){return new Fd(this.property,this.value,l,Mt({},i.transition,this.transition),i.now)}untransitioned(){return new Fd(this.property,this.value,null,{},0)}}class Pp{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Q(this._values[i].value.value)}setValue(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Zc(this._values[i].property)),this._values[i].value=new Mu(this._values[i].property,l===null?void 0:Q(l))}getTransition(i){return Q(this._values[i].transition)}setTransition(i,l){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new Zc(this._values[i].property)),this._values[i].transition=Q(l)||void 0}serialize(){const i={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(i[l]=f);const g=this.getTransition(l);g!==void 0&&(i[`${l}-transition`]=g)}return i}transitioned(i,l){const f=new Bd(this._properties);for(const g of Object.keys(this._values))f._values[g]=this._values[g].transitioned(i,l._values[g]);return f}untransitioned(){const i=new Bd(this._properties);for(const l of Object.keys(this._values))i._values[l]=this._values[l].untransitioned();return i}}class Fd{constructor(i,l,f,g,v){this.property=i,this.value=l,this.begin=v+g.delay||0,this.end=this.begin+g.duration||0,i.specification.transition&&(g.delay||g.duration)&&(this.prior=f)}possiblyEvaluate(i,l,f){const g=i.now||0,v=this.value.possiblyEvaluate(i,l,f),x=this.prior;if(x){if(g>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(g<this.begin)return x.possiblyEvaluate(i,l,f);{const w=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(i,l,f),v,function(E){if(E<=0)return 0;if(E>=1)return 1;const L=E*E,D=L*E;return 4*(E<.5?D:3*(E-L)+D-.75)}(w))}}return v}}class Bd{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,l,f){const g=new Du(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(i,l,f);return g}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class Vd{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return Q(this._values[i].value)}setValue(i,l){this._values[i]=new Mu(this._values[i].property,l===null?void 0:Q(l))}serialize(){const i={};for(const l of Object.keys(this._values)){const f=this.getValue(l);f!==void 0&&(i[l]=f)}return i}possiblyEvaluate(i,l,f){const g=new Du(this._properties);for(const v of Object.keys(this._values))g._values[v]=this._values[v].possiblyEvaluate(i,l,f);return g}}class Zo{constructor(i,l,f){this.property=i,this.value=l,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,l,f,g){return this.property.evaluate(this.value,this.parameters,i,l,f,g)}}class Du{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class me{constructor(i){this.specification=i}possiblyEvaluate(i,l){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(l)}interpolate(i,l,f){const g=Pi[this.specification.type];return g?g(i,l,f):i}}class we{constructor(i,l){this.specification=i,this.overrides=l}possiblyEvaluate(i,l,f,g){return new Zo(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(l,null,{},f,g)}:i.expression,l)}interpolate(i,l,f){if(i.value.kind!=="constant"||l.value.kind!=="constant")return i;if(i.value.value===void 0||l.value.value===void 0)return new Zo(this,{kind:"constant",value:void 0},i.parameters);const g=Pi[this.specification.type];if(g){const v=g(i.value.value,l.value.value,f);return new Zo(this,{kind:"constant",value:v},i.parameters)}return i}evaluate(i,l,f,g,v,x){return i.kind==="constant"?i.value:i.evaluate(l,f,g,v,x)}}class Hc extends we{possiblyEvaluate(i,l,f,g){if(i.value===void 0)return new Zo(this,{kind:"constant",value:void 0},l);if(i.expression.kind==="constant"){const v=i.expression.evaluate(l,null,{},f,g),x=i.property.specification.type==="resolvedImage"&&typeof v!="string"?v.name:v,w=this._calculate(x,x,x,l);return new Zo(this,{kind:"constant",value:w},l)}if(i.expression.kind==="camera"){const v=this._calculate(i.expression.evaluate({zoom:l.zoom-1}),i.expression.evaluate({zoom:l.zoom}),i.expression.evaluate({zoom:l.zoom+1}),l);return new Zo(this,{kind:"constant",value:v},l)}return new Zo(this,i.expression,l)}evaluate(i,l,f,g,v,x){if(i.kind==="source"){const w=i.evaluate(l,f,g,v,x);return this._calculate(w,w,w,l)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(l.zoom)-1},f,g),i.evaluate({zoom:Math.floor(l.zoom)},f,g),i.evaluate({zoom:Math.floor(l.zoom)+1},f,g),l):i.value}_calculate(i,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:f,to:l}}interpolate(i){return i}}class ku{constructor(i){this.specification=i}possiblyEvaluate(i,l,f,g){if(i.value!==void 0){if(i.expression.kind==="constant"){const v=i.expression.evaluate(l,null,{},f,g);return this._calculate(v,v,v,l)}return this._calculate(i.expression.evaluate(new Kn(Math.floor(l.zoom-1),l)),i.expression.evaluate(new Kn(Math.floor(l.zoom),l)),i.expression.evaluate(new Kn(Math.floor(l.zoom+1),l)),l)}}_calculate(i,l,f,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:i,to:l}:{from:f,to:l}}interpolate(i){return i}}class Ap{constructor(i){this.specification=i}possiblyEvaluate(i,l,f,g){return!!i.expression.evaluate(l,null,{},f,g)}interpolate(){return!1}}class ji{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in i){const f=i[l];f.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new Mu(f,void 0),v=this.defaultTransitionablePropertyValues[l]=new Zc(f);this.defaultTransitioningPropertyValues[l]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}ce("DataDrivenProperty",we),ce("DataConstantProperty",me),ce("CrossFadedDataDrivenProperty",Hc),ce("CrossFadedProperty",ku),ce("ColorRampProperty",Ap);const Mp="-transition";class Ho extends Ke{constructor(i,l){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),l.layout&&(this._unevaluatedLayout=new Vd(l.layout)),l.paint)){this._transitionablePaint=new Pp(l.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Du(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,l,f={}){l!=null&&this._validate(zg,`layers.${this.id}.layout.${i}`,i,l,f)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,l):this.visibility=l)}getPaintProperty(i){return i.endsWith(Mp)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,l,f={}){if(l!=null&&this._validate(Tp,`layers.${this.id}.paint.${i}`,i,l,f))return!1;if(i.endsWith(Mp))return this._transitionablePaint.setTransition(i.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[i],v=g.property.specification["property-type"]==="cross-faded-data-driven",x=g.value.isDataDriven(),w=g.value;this._transitionablePaint.setValue(i,l),this._handleSpecialPaintPropertyUpdate(i);const E=this._transitionablePaint._values[i].value;return E.isDataDriven()||x||v||this._handleOverridablePaintPropertyUpdate(i,w,E)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,l,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,l){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,l)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),qt(i,(l,f)=>!(l===void 0||f==="layout"&&!Object.keys(l).length||f==="paint"&&!Object.keys(l).length))}_validate(i,l,f,g,v={}){return(!v||v.validate!==!1)&&Fl(this,i.call($a,{key:l,layerType:this.type,objectKey:f,value:g,styleSpec:Lt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const l=this.paint.get(i);if(l instanceof Zo&&Nl(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const Ud={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ru{constructor(i,l){this._structArray=i,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class hr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,l){return i._trim(),l&&(i.isTransferred=!0,l.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const l=Object.create(this.prototype);return l.arrayBuffer=i.arrayBuffer,l.length=i.length,l.capacity=i.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Ir(s,i=1){let l=0,f=0;return{members:s.map(g=>{const v=Ud[g.type].BYTES_PER_ELEMENT,x=l=Gd(l,Math.max(i,v)),w=g.components||1;return f=Math.max(f,v),l+=v*w,{name:g.name,type:g.type,components:w,offset:x}}),size:Gd(l,Math.max(f,i)),alignment:i}}function Gd(s,i){return Math.ceil(s/i)*i}class Nu extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const g=2*i;return this.int16[g+0]=l,this.int16[g+1]=f,i}}Nu.prototype.bytesPerElement=4,ce("StructArrayLayout2i4",Nu);class Zs extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const v=3*i;return this.int16[v+0]=l,this.int16[v+1]=f,this.int16[v+2]=g,i}}Zs.prototype.bytesPerElement=6,ce("StructArrayLayout3i6",Zs);class Dp extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,f,g)}emplace(i,l,f,g,v){const x=4*i;return this.int16[x+0]=l,this.int16[x+1]=f,this.int16[x+2]=g,this.int16[x+3]=v,i}}Dp.prototype.bytesPerElement=8,ce("StructArrayLayout4i8",Dp);class kp extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,f,g,v,x)}emplace(i,l,f,g,v,x,w){const E=6*i;return this.int16[E+0]=l,this.int16[E+1]=f,this.int16[E+2]=g,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=w,i}}kp.prototype.bytesPerElement=12,ce("StructArrayLayout2i4i12",kp);class Rp extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,f,g,v,x)}emplace(i,l,f,g,v,x,w){const E=4*i,L=8*i;return this.int16[E+0]=l,this.int16[E+1]=f,this.uint8[L+4]=g,this.uint8[L+5]=v,this.uint8[L+6]=x,this.uint8[L+7]=w,i}}Rp.prototype.bytesPerElement=8,ce("StructArrayLayout2i4ub8",Rp);class Ou extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const g=2*i;return this.float32[g+0]=l,this.float32[g+1]=f,i}}Ou.prototype.bytesPerElement=8,ce("StructArrayLayout2f8",Ou);class Xc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,v,x,w,E,L,D){const k=this.length;return this.resize(k+1),this.emplace(k,i,l,f,g,v,x,w,E,L,D)}emplace(i,l,f,g,v,x,w,E,L,D,k){const F=10*i;return this.uint16[F+0]=l,this.uint16[F+1]=f,this.uint16[F+2]=g,this.uint16[F+3]=v,this.uint16[F+4]=x,this.uint16[F+5]=w,this.uint16[F+6]=E,this.uint16[F+7]=L,this.uint16[F+8]=D,this.uint16[F+9]=k,i}}Xc.prototype.bytesPerElement=20,ce("StructArrayLayout10ui20",Xc);class Np extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,v,x,w,E,L,D,k,F){const V=this.length;return this.resize(V+1),this.emplace(V,i,l,f,g,v,x,w,E,L,D,k,F)}emplace(i,l,f,g,v,x,w,E,L,D,k,F,V){const G=12*i;return this.int16[G+0]=l,this.int16[G+1]=f,this.int16[G+2]=g,this.int16[G+3]=v,this.uint16[G+4]=x,this.uint16[G+5]=w,this.uint16[G+6]=E,this.uint16[G+7]=L,this.int16[G+8]=D,this.int16[G+9]=k,this.int16[G+10]=F,this.int16[G+11]=V,i}}Np.prototype.bytesPerElement=24,ce("StructArrayLayout4i4ui4i24",Np);class Op extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const v=3*i;return this.float32[v+0]=l,this.float32[v+1]=f,this.float32[v+2]=g,i}}Op.prototype.bytesPerElement=12,ce("StructArrayLayout3f12",Op);class Hs extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint32[1*i+0]=l,i}}Hs.prototype.bytesPerElement=4,ce("StructArrayLayout1ul4",Hs);class Yc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,v,x,w,E,L){const D=this.length;return this.resize(D+1),this.emplace(D,i,l,f,g,v,x,w,E,L)}emplace(i,l,f,g,v,x,w,E,L,D){const k=10*i,F=5*i;return this.int16[k+0]=l,this.int16[k+1]=f,this.int16[k+2]=g,this.int16[k+3]=v,this.int16[k+4]=x,this.int16[k+5]=w,this.uint32[F+3]=E,this.uint16[k+8]=L,this.uint16[k+9]=D,i}}Yc.prototype.bytesPerElement=20,ce("StructArrayLayout6i1ul2ui20",Yc);class zu extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,v,x){const w=this.length;return this.resize(w+1),this.emplace(w,i,l,f,g,v,x)}emplace(i,l,f,g,v,x,w){const E=6*i;return this.int16[E+0]=l,this.int16[E+1]=f,this.int16[E+2]=g,this.int16[E+3]=v,this.int16[E+4]=x,this.int16[E+5]=w,i}}zu.prototype.bytesPerElement=12,ce("StructArrayLayout2i2i2i12",zu);class Kc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,l,f,g,v){const x=this.length;return this.resize(x+1),this.emplace(x,i,l,f,g,v)}emplace(i,l,f,g,v,x){const w=4*i,E=8*i;return this.float32[w+0]=l,this.float32[w+1]=f,this.float32[w+2]=g,this.int16[E+6]=v,this.int16[E+7]=x,i}}Kc.prototype.bytesPerElement=16,ce("StructArrayLayout2f1f2i16",Kc);class Fu extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,f,g)}emplace(i,l,f,g,v){const x=12*i,w=3*i;return this.uint8[x+0]=l,this.uint8[x+1]=f,this.float32[w+1]=g,this.float32[w+2]=v,i}}Fu.prototype.bytesPerElement=12,ce("StructArrayLayout2ub2f12",Fu);class Jc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const v=3*i;return this.uint16[v+0]=l,this.uint16[v+1]=f,this.uint16[v+2]=g,i}}Jc.prototype.bytesPerElement=6,ce("StructArrayLayout3ui6",Jc);class Gl extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,g,v,x,w,E,L,D,k,F,V,G,H,nt,lt){const xt=this.length;return this.resize(xt+1),this.emplace(xt,i,l,f,g,v,x,w,E,L,D,k,F,V,G,H,nt,lt)}emplace(i,l,f,g,v,x,w,E,L,D,k,F,V,G,H,nt,lt,xt){const ut=24*i,mt=12*i,Rt=48*i;return this.int16[ut+0]=l,this.int16[ut+1]=f,this.uint16[ut+2]=g,this.uint16[ut+3]=v,this.uint32[mt+2]=x,this.uint32[mt+3]=w,this.uint32[mt+4]=E,this.uint16[ut+10]=L,this.uint16[ut+11]=D,this.uint16[ut+12]=k,this.float32[mt+7]=F,this.float32[mt+8]=V,this.uint8[Rt+36]=G,this.uint8[Rt+37]=H,this.uint8[Rt+38]=nt,this.uint32[mt+10]=lt,this.int16[ut+22]=xt,i}}Gl.prototype.bytesPerElement=48,ce("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Gl);class tl extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,g,v,x,w,E,L,D,k,F,V,G,H,nt,lt,xt,ut,mt,Rt,zt,oe,fe,ie,ee,Ht,he){const Jt=this.length;return this.resize(Jt+1),this.emplace(Jt,i,l,f,g,v,x,w,E,L,D,k,F,V,G,H,nt,lt,xt,ut,mt,Rt,zt,oe,fe,ie,ee,Ht,he)}emplace(i,l,f,g,v,x,w,E,L,D,k,F,V,G,H,nt,lt,xt,ut,mt,Rt,zt,oe,fe,ie,ee,Ht,he,Jt){const Gt=32*i,xe=16*i;return this.int16[Gt+0]=l,this.int16[Gt+1]=f,this.int16[Gt+2]=g,this.int16[Gt+3]=v,this.int16[Gt+4]=x,this.int16[Gt+5]=w,this.int16[Gt+6]=E,this.int16[Gt+7]=L,this.uint16[Gt+8]=D,this.uint16[Gt+9]=k,this.uint16[Gt+10]=F,this.uint16[Gt+11]=V,this.uint16[Gt+12]=G,this.uint16[Gt+13]=H,this.uint16[Gt+14]=nt,this.uint16[Gt+15]=lt,this.uint16[Gt+16]=xt,this.uint16[Gt+17]=ut,this.uint16[Gt+18]=mt,this.uint16[Gt+19]=Rt,this.uint16[Gt+20]=zt,this.uint16[Gt+21]=oe,this.uint16[Gt+22]=fe,this.uint32[xe+12]=ie,this.float32[xe+13]=ee,this.float32[xe+14]=Ht,this.uint16[Gt+30]=he,this.uint16[Gt+31]=Jt,i}}tl.prototype.bytesPerElement=64,ce("StructArrayLayout8i15ui1ul2f2ui64",tl);class Qc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.float32[1*i+0]=l,i}}Qc.prototype.bytesPerElement=4,ce("StructArrayLayout1f4",Qc);class $c extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const v=3*i;return this.uint16[6*i+0]=l,this.float32[v+1]=f,this.float32[v+2]=g,i}}$c.prototype.bytesPerElement=12,ce("StructArrayLayout1ui2f12",$c);class el extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l,f){const g=this.length;return this.resize(g+1),this.emplace(g,i,l,f)}emplace(i,l,f,g){const v=4*i;return this.uint32[2*i+0]=l,this.uint16[v+2]=f,this.uint16[v+3]=g,i}}el.prototype.bytesPerElement=8,ce("StructArrayLayout1ul2ui8",el);class zp extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,l){const f=this.length;return this.resize(f+1),this.emplace(f,i,l)}emplace(i,l,f){const g=2*i;return this.uint16[g+0]=l,this.uint16[g+1]=f,i}}zp.prototype.bytesPerElement=4,ce("StructArrayLayout2ui4",zp);class Fp extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const l=this.length;return this.resize(l+1),this.emplace(l,i)}emplace(i,l){return this.uint16[1*i+0]=l,i}}Fp.prototype.bytesPerElement=2,ce("StructArrayLayout1ui2",Fp);class th extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,l,f,g){const v=this.length;return this.resize(v+1),this.emplace(v,i,l,f,g)}emplace(i,l,f,g,v){const x=4*i;return this.float32[x+0]=l,this.float32[x+1]=f,this.float32[x+2]=g,this.float32[x+3]=v,i}}th.prototype.bytesPerElement=16,ce("StructArrayLayout4f16",th);class qd extends Ru{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new P(this.anchorPointX,this.anchorPointY)}}qd.prototype.size=20;class y extends Yc{get(i){return new qd(this,i)}}ce("CollisionBoxArray",y);class o extends Ru{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}o.prototype.size=48;class h extends Gl{get(i){return new o(this,i)}}ce("PlacedSymbolArray",h);class d extends Ru{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}d.prototype.size=64;class m extends tl{get(i){return new d(this,i)}}ce("SymbolInstanceArray",m);class _ extends Qc{getoffsetX(i){return this.float32[1*i+0]}}ce("GlyphOffsetArray",_);class S extends Zs{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}ce("SymbolLineVertexArray",S);class I extends Ru{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}I.prototype.size=12;class T extends $c{get(i){return new I(this,i)}}ce("TextAnchorOffsetArray",T);class M extends Ru{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}M.prototype.size=8;class N extends el{get(i){return new M(this,i)}}ce("FeatureIndexArray",N);class O extends Nu{}class U extends Nu{}class tt extends Nu{}class $ extends kp{}class it extends Rp{}class Z extends Ou{}class ht extends Xc{}class It extends Np{}class st extends Op{}class _t extends Hs{}class Ct extends zu{}class At extends Fu{}class kt extends Jc{}class Vt extends zp{}const Bt=Ir([{name:"a_pos",components:2,type:"Int16"}],4),{members:Wt}=Bt;class Xt{constructor(i=[]){this.segments=i}prepareSegment(i,l,f,g){let v=this.segments[this.segments.length-1];return i>Xt.MAX_VERTEX_ARRAY_LENGTH&&$t(`Max vertices per segment is ${Xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!v||v.vertexLength+i>Xt.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==g)&&(v={vertexOffset:l.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},g!==void 0&&(v.sortKey=g),this.segments.push(v)),v}get(){return this.segments}destroy(){for(const i of this.segments)for(const l in i.vaos)i.vaos[l].destroy()}static simpleSegment(i,l,f,g){return new Xt([{vertexOffset:i,primitiveOffset:l,vertexLength:f,primitiveLength:g,vaos:{},sortKey:0}])}}function Fe(s,i){return 256*(s=dt(Math.floor(s),0,255))+dt(Math.floor(i),0,255)}Xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ce("SegmentVector",Xt);const Kt=Ir([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Se={exports:{}},Be={exports:{}};Be.exports=function(s,i){var l,f,g,v,x,w,E,L;for(f=s.length-(l=3&s.length),g=i,x=3432918353,w=461845907,L=0;L<f;)E=255&s.charCodeAt(L)|(255&s.charCodeAt(++L))<<8|(255&s.charCodeAt(++L))<<16|(255&s.charCodeAt(++L))<<24,++L,g=27492+(65535&(v=5*(65535&(g=(g^=E=(65535&(E=(E=(65535&E)*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(v>>>16)&65535)<<16);switch(E=0,l){case 3:E^=(255&s.charCodeAt(L+2))<<16;case 2:E^=(255&s.charCodeAt(L+1))<<8;case 1:g^=E=(65535&(E=(E=(65535&(E^=255&s.charCodeAt(L)))*x+(((E>>>16)*x&65535)<<16)&4294967295)<<15|E>>>17))*w+(((E>>>16)*w&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var hn=Be.exports,Pe={exports:{}};Pe.exports=function(s,i){for(var l,f=s.length,g=i^f,v=0;f>=4;)l=1540483477*(65535&(l=255&s.charCodeAt(v)|(255&s.charCodeAt(++v))<<8|(255&s.charCodeAt(++v))<<16|(255&s.charCodeAt(++v))<<24))+((1540483477*(l>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),f-=4,++v;switch(f){case 3:g^=(255&s.charCodeAt(v+2))<<16;case 2:g^=(255&s.charCodeAt(v+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(v)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var qe=hn,Xe=Pe.exports;Se.exports=qe,Se.exports.murmur3=qe,Se.exports.murmur2=Xe;var pr=b(Se.exports);class Mn{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,l,f,g){this.ids.push(po(i)),this.positions.push(l,f,g)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=po(i);let f=0,g=this.ids.length-1;for(;f<g;){const x=f+g>>1;this.ids[x]>=l?g=x:f=x+1}const v=[];for(;this.ids[f]===l;)v.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return v}static serialize(i,l){const f=new Float64Array(i.ids),g=new Uint32Array(i.positions);return Vr(f,g,0,f.length-1),l&&l.push(f.buffer,g.buffer),{ids:f,positions:g}}static deserialize(i){const l=new Mn;return l.ids=i.ids,l.positions=i.positions,l.indexed=!0,l}}function po(s){const i=+s;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:pr(String(s))}function Vr(s,i,l,f){for(;l<f;){const g=s[l+f>>1];let v=l-1,x=f+1;for(;;){do v++;while(s[v]<g);do x--;while(s[x]>g);if(v>=x)break;ir(s,v,x),ir(i,3*v,3*x),ir(i,3*v+1,3*x+1),ir(i,3*v+2,3*x+2)}x-l<f-x?(Vr(s,i,l,x),l=x+1):(Vr(s,i,x+1,f),f=x)}}function ir(s,i,l){const f=s[i];s[i]=s[l],s[l]=f}ce("FeaturePositionMap",Mn);class Ur{constructor(i,l){this.gl=i.gl,this.location=l}}class fo extends Ur{constructor(i,l){super(i,l),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class xs extends Ur{constructor(i,l){super(i,l),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class Sa extends Ur{constructor(i,l){super(i,l),this.current=Pn.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Bu=new Float32Array(16);function Ia(s){return[Fe(255*s.r,255*s.g),Fe(255*s.b,255*s.a)]}class bs{constructor(i,l,f){this.value=i,this.uniformNames=l.map(g=>`u_${g}`),this.type=f}setUniform(i,l,f){i.set(f.constantOr(this.value))}getBinding(i,l,f){return this.type==="color"?new Sa(i,l):new fo(i,l)}}class Dr{constructor(i,l){this.uniformNames=l.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=i.tlbr}setUniform(i,l,f,g){const v=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&i.set(v)}getBinding(i,l,f){return f.substr(0,9)==="u_pattern"?new xs(i,l):new fo(i,l)}}class or{constructor(i,l,f,g){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=l.map(v=>({name:`a_${v}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(i,l,f,g,v){const x=this.paintVertexArray.length,w=this.expression.evaluate(new Kn(0),l,{},g,[],v);this.paintVertexArray.resize(i),this._setPaintValue(x,i,w)}updatePaintArray(i,l,f,g){const v=this.expression.evaluate({zoom:0},f,g);this._setPaintValue(i,l,v)}_setPaintValue(i,l,f){if(this.type==="color"){const g=Ia(f);for(let v=i;v<l;v++)this.paintVertexArray.emplace(v,g[0],g[1])}else{for(let g=i;g<l;g++)this.paintVertexArray.emplace(g,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Jn{constructor(i,l,f,g,v,x){this.expression=i,this.uniformNames=l.map(w=>`u_${w}_t`),this.type=f,this.useIntegerZoom=g,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=l.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(i,l,f,g,v){const x=this.expression.evaluate(new Kn(this.zoom),l,{},g,[],v),w=this.expression.evaluate(new Kn(this.zoom+1),l,{},g,[],v),E=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(E,i,x,w)}updatePaintArray(i,l,f,g){const v=this.expression.evaluate({zoom:this.zoom},f,g),x=this.expression.evaluate({zoom:this.zoom+1},f,g);this._setPaintValue(i,l,v,x)}_setPaintValue(i,l,f,g){if(this.type==="color"){const v=Ia(f),x=Ia(g);for(let w=i;w<l;w++)this.paintVertexArray.emplace(w,v[0],v[1],x[0],x[1])}else{for(let v=i;v<l;v++)this.paintVertexArray.emplace(v,f,g);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(g))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,l){const f=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=dt(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);i.set(g)}getBinding(i,l,f){return new fo(i,l)}}class Po{constructor(i,l,f,g,v,x){this.expression=i,this.type=l,this.useIntegerZoom=f,this.zoom=g,this.layerId=x,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v}populatePaintArray(i,l,f){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(g,i,l.patterns&&l.patterns[this.layerId],f)}updatePaintArray(i,l,f,g,v){this._setPaintValues(i,l,f.patterns&&f.patterns[this.layerId],v)}_setPaintValues(i,l,f,g){if(!g||!f)return;const{min:v,mid:x,max:w}=f,E=g[v],L=g[x],D=g[w];if(E&&L&&D)for(let k=i;k<l;k++)this.zoomInPaintVertexArray.emplace(k,L.tl[0],L.tl[1],L.br[0],L.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],L.pixelRatio,E.pixelRatio),this.zoomOutPaintVertexArray.emplace(k,L.tl[0],L.tl[1],L.br[0],L.br[1],D.tl[0],D.tl[1],D.br[0],D.br[1],L.pixelRatio,D.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,Kt.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,Kt.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class kr{constructor(i,l,f){this.binders={},this._buffers=[];const g=[];for(const v in i.paint._values){if(!f(v))continue;const x=i.paint.get(v);if(!(x instanceof Zo&&Nl(x.property.specification)))continue;const w=Ao(v,i.type),E=x.value,L=x.property.specification.type,D=x.property.useIntegerZoom,k=x.property.specification["property-type"],F=k==="cross-faded"||k==="cross-faded-data-driven";if(E.kind==="constant")this.binders[v]=F?new Dr(E.value,w):new bs(E.value,w,L),g.push(`/u_${v}`);else if(E.kind==="source"||F){const V=Rr(v,L,"source");this.binders[v]=F?new Po(E,L,D,l,V,i.id):new or(E,w,L,V),g.push(`/a_${v}`)}else{const V=Rr(v,L,"composite");this.binders[v]=new Jn(E,w,L,D,l,V),g.push(`/z_${v}`)}}this.cacheKey=g.sort().join("")}getMaxValue(i){const l=this.binders[i];return l instanceof or||l instanceof Jn?l.maxValue:0}populatePaintArrays(i,l,f,g,v){for(const x in this.binders){const w=this.binders[x];(w instanceof or||w instanceof Jn||w instanceof Po)&&w.populatePaintArray(i,l,f,g,v)}}setConstantPatternPositions(i,l){for(const f in this.binders){const g=this.binders[f];g instanceof Dr&&g.setConstantPatternPositions(i,l)}}updatePaintArrays(i,l,f,g,v){let x=!1;for(const w in i){const E=l.getPositions(w);for(const L of E){const D=f.feature(L.index);for(const k in this.binders){const F=this.binders[k];if((F instanceof or||F instanceof Jn||F instanceof Po)&&F.expression.isStateDependent===!0){const V=g.paint.get(k);F.expression=V.value,F.updatePaintArray(L.start,L.end,D,i[w],v),x=!0}}}}return x}defines(){const i=[];for(const l in this.binders){const f=this.binders[l];(f instanceof bs||f instanceof Dr)&&i.push(...f.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return i}getBinderAttributes(){const i=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof or||f instanceof Jn)for(let g=0;g<f.paintVertexAttributes.length;g++)i.push(f.paintVertexAttributes[g].name);else if(f instanceof Po)for(let g=0;g<Kt.members.length;g++)i.push(Kt.members[g].name)}return i}getBinderUniforms(){const i=[];for(const l in this.binders){const f=this.binders[l];if(f instanceof bs||f instanceof Dr||f instanceof Jn)for(const g of f.uniformNames)i.push(g)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,l){const f=[];for(const g in this.binders){const v=this.binders[g];if(v instanceof bs||v instanceof Dr||v instanceof Jn){for(const x of v.uniformNames)if(l[x]){const w=v.getBinding(i,l[x],x);f.push({name:x,property:g,binding:w})}}}return f}setUniforms(i,l,f,g){for(const{name:v,property:x,binding:w}of l)this.binders[x].setUniform(w,g,f.get(x),v)}updatePaintBuffers(i){this._buffers=[];for(const l in this.binders){const f=this.binders[l];if(i&&f instanceof Po){const g=i.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(f instanceof or||f instanceof Jn)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(i){for(const l in this.binders){const f=this.binders[l];(f instanceof or||f instanceof Jn||f instanceof Po)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const l=this.binders[i];(l instanceof or||l instanceof Jn||l instanceof Po)&&l.destroy()}}}class sr{constructor(i,l,f=()=>!0){this.programConfigurations={};for(const g of i)this.programConfigurations[g.id]=new kr(g,l,f);this.needsUpload=!1,this._featureMap=new Mn,this._bufferOffset=0}populatePaintArrays(i,l,f,g,v,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(i,l,g,v,x);l.id!==void 0&&this._featureMap.add(l.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,l,f,g){for(const v of f)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(i,this._featureMap,l,v,g)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function Ao(s,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${i}-`,"").replace(/-/g,"_")]}function Rr(s,i,l){const f={color:{source:Ou,composite:th},number:{source:Qc,composite:Ou}},g=function(v){return{"line-pattern":{source:ht,composite:ht},"fill-pattern":{source:ht,composite:ht},"fill-extrusion-pattern":{source:ht,composite:ht}}[v]}(s);return g&&g[l]||f[i][l]}ce("ConstantBinder",bs),ce("CrossFadedConstantBinder",Dr),ce("SourceExpressionBinder",or),ce("CrossFadedCompositeBinder",Po),ce("CompositeExpressionBinder",Jn),ce("ProgramConfiguration",kr,{omit:["_buffers"]}),ce("ProgramConfigurationSet",sr);const yr=8192,Bp=Math.pow(2,14)-1,jd=-Bp-1;function nl(s){const i=yr/s.extent,l=s.loadGeometry();for(let f=0;f<l.length;f++){const g=l[f];for(let v=0;v<g.length;v++){const x=g[v],w=Math.round(x.x*i),E=Math.round(x.y*i);x.x=dt(w,jd,Bp),x.y=dt(E,jd,Bp),(w<x.x||w>x.x+1||E<x.y||E>x.y+1)&&$t("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function rl(s,i){return{type:s.type,id:s.id,properties:s.properties,geometry:i?nl(s):[]}}function eh(s,i,l,f,g){s.emplaceBack(2*i+(f+1)/2,2*l+(g+1)/2)}class Ea{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new U,this.indexArray=new kt,this.segments=new Xt,this.programConfigurations=new sr(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){const g=this.layers[0],v=[];let x=null,w=!1;g.type==="circle"&&(x=g.layout.get("circle-sort-key"),w=!x.isConstant());for(const{feature:E,id:L,index:D,sourceLayerIndex:k}of i){const F=this.layers[0]._featureFilter.needGeometry,V=rl(E,F);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom),V,f))continue;const G=w?x.evaluate(V,{},f):void 0,H={id:L,properties:E.properties,type:E.type,sourceLayerIndex:k,index:D,geometry:F?V.geometry:nl(E),patterns:{},sortKey:G};v.push(H)}w&&v.sort((E,L)=>E.sortKey-L.sortKey);for(const E of v){const{geometry:L,index:D,sourceLayerIndex:k}=E,F=i[D].feature;this.addFeature(E,L,D,f),l.featureIndex.insert(F,L,D,k,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,Wt),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,l,f,g){for(const v of l)for(const x of v){const w=x.x,E=x.y;if(w<0||w>=yr||E<0||E>=yr)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),D=L.vertexLength;eh(this.layoutVertexArray,w,E,-1,-1),eh(this.layoutVertexArray,w,E,1,-1),eh(this.layoutVertexArray,w,E,1,1),eh(this.layoutVertexArray,w,E,-1,1),this.indexArray.emplaceBack(D,D+1,D+2),this.indexArray.emplaceBack(D,D+3,D+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},g)}}function Vp(s,i){for(let l=0;l<s.length;l++)if(rh(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(rh(s,i[l]))return!0;return!!nh(s,i)}function Wd(s,i,l){return!!rh(s,i)||!!Bg(i,s,l)}function Up(s,i){if(s.length===1)return D0(i,s[0]);for(let l=0;l<i.length;l++){const f=i[l];for(let g=0;g<f.length;g++)if(rh(s,f[g]))return!0}for(let l=0;l<s.length;l++)if(D0(i,s[l]))return!0;for(let l=0;l<i.length;l++)if(nh(s,i[l]))return!0;return!1}function Gp(s,i,l){if(s.length>1){if(nh(s,i))return!0;for(let f=0;f<i.length;f++)if(Bg(i[f],s,l))return!0}for(let f=0;f<s.length;f++)if(Bg(s[f],i,l))return!0;return!1}function nh(s,i){if(s.length===0||i.length===0)return!1;for(let l=0;l<s.length-1;l++){const f=s[l],g=s[l+1];for(let v=0;v<i.length-1;v++)if(qp(f,g,i[v],i[v+1]))return!0}return!1}function qp(s,i,l,f){return le(s,l,f)!==le(i,l,f)&&le(s,i,l)!==le(s,i,f)}function Bg(s,i,l){const f=l*l;if(i.length===1)return s.distSqr(i[0])<f;for(let g=1;g<i.length;g++)if(M0(s,i[g-1],i[g])<f)return!0;return!1}function M0(s,i,l){const f=i.distSqr(l);if(f===0)return s.distSqr(i);const g=((s.x-i.x)*(l.x-i.x)+(s.y-i.y)*(l.y-i.y))/f;return s.distSqr(g<0?i:g>1?l:l.sub(i)._mult(g)._add(i))}function D0(s,i){let l,f,g,v=!1;for(let x=0;x<s.length;x++){l=s[x];for(let w=0,E=l.length-1;w<l.length;E=w++)f=l[w],g=l[E],f.y>i.y!=g.y>i.y&&i.x<(g.x-f.x)*(i.y-f.y)/(g.y-f.y)+f.x&&(v=!v)}return v}function rh(s,i){let l=!1;for(let f=0,g=s.length-1;f<s.length;g=f++){const v=s[f],x=s[g];v.y>i.y!=x.y>i.y&&i.x<(x.x-v.x)*(i.y-v.y)/(x.y-v.y)+v.x&&(l=!l)}return l}function nS(s,i,l){const f=l[0],g=l[2];if(s.x<f.x&&i.x<f.x||s.x>g.x&&i.x>g.x||s.y<f.y&&i.y<f.y||s.y>g.y&&i.y>g.y)return!1;const v=le(s,i,l[0]);return v!==le(s,i,l[1])||v!==le(s,i,l[2])||v!==le(s,i,l[3])}function jp(s,i,l){const f=i.paint.get(s).value;return f.kind==="constant"?f.value:l.programConfigurations.get(i.id).getMaxValue(s)}function Zd(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Hd(s,i,l,f,g){if(!i[0]&&!i[1])return s;const v=P.convert(i)._mult(g);l==="viewport"&&v._rotate(-f);const x=[];for(let w=0;w<s.length;w++)x.push(s[w].sub(v));return x}let k0,R0;ce("CircleBucket",Ea,{omit:["layers"]});var rS={get paint(){return R0=R0||new ji({"circle-radius":new we(Lt.paint_circle["circle-radius"]),"circle-color":new we(Lt.paint_circle["circle-color"]),"circle-blur":new we(Lt.paint_circle["circle-blur"]),"circle-opacity":new we(Lt.paint_circle["circle-opacity"]),"circle-translate":new me(Lt.paint_circle["circle-translate"]),"circle-translate-anchor":new me(Lt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new me(Lt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new me(Lt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new we(Lt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new we(Lt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new we(Lt.paint_circle["circle-stroke-opacity"])})},get layout(){return k0=k0||new ji({"circle-sort-key":new we(Lt.layout_circle["circle-sort-key"])})}},Wi=1e-6,ih=typeof Float32Array<"u"?Float32Array:Array;function Vg(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function N0(s,i,l){var f=i[0],g=i[1],v=i[2],x=i[3],w=i[4],E=i[5],L=i[6],D=i[7],k=i[8],F=i[9],V=i[10],G=i[11],H=i[12],nt=i[13],lt=i[14],xt=i[15],ut=l[0],mt=l[1],Rt=l[2],zt=l[3];return s[0]=ut*f+mt*w+Rt*k+zt*H,s[1]=ut*g+mt*E+Rt*F+zt*nt,s[2]=ut*v+mt*L+Rt*V+zt*lt,s[3]=ut*x+mt*D+Rt*G+zt*xt,s[4]=(ut=l[4])*f+(mt=l[5])*w+(Rt=l[6])*k+(zt=l[7])*H,s[5]=ut*g+mt*E+Rt*F+zt*nt,s[6]=ut*v+mt*L+Rt*V+zt*lt,s[7]=ut*x+mt*D+Rt*G+zt*xt,s[8]=(ut=l[8])*f+(mt=l[9])*w+(Rt=l[10])*k+(zt=l[11])*H,s[9]=ut*g+mt*E+Rt*F+zt*nt,s[10]=ut*v+mt*L+Rt*V+zt*lt,s[11]=ut*x+mt*D+Rt*G+zt*xt,s[12]=(ut=l[12])*f+(mt=l[13])*w+(Rt=l[14])*k+(zt=l[15])*H,s[13]=ut*g+mt*E+Rt*F+zt*nt,s[14]=ut*v+mt*L+Rt*V+zt*lt,s[15]=ut*x+mt*D+Rt*G+zt*xt,s}Math.hypot||(Math.hypot=function(){for(var s=0,i=arguments.length;i--;)s+=arguments[i]*arguments[i];return Math.sqrt(s)});var Wp,iS=N0;function Xd(s,i,l){var f=i[0],g=i[1],v=i[2],x=i[3];return s[0]=l[0]*f+l[4]*g+l[8]*v+l[12]*x,s[1]=l[1]*f+l[5]*g+l[9]*v+l[13]*x,s[2]=l[2]*f+l[6]*g+l[10]*v+l[14]*x,s[3]=l[3]*f+l[7]*g+l[11]*v+l[15]*x,s}Wp=new ih(4),ih!=Float32Array&&(Wp[0]=0,Wp[1]=0,Wp[2]=0,Wp[3]=0);class oS extends Ho{constructor(i){super(i,rS)}createBucket(i){return new Ea(i)}queryRadius(i){const l=i;return jp("circle-radius",this,l)+jp("circle-stroke-width",this,l)+Zd(this.paint.get("circle-translate"))}queryIntersectsFeature(i,l,f,g,v,x,w,E){const L=Hd(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),x.angle,w),D=this.paint.get("circle-radius").evaluate(l,f)+this.paint.get("circle-stroke-width").evaluate(l,f),k=this.paint.get("circle-pitch-alignment")==="map",F=k?L:function(G,H){return G.map(nt=>O0(nt,H))}(L,E),V=k?D*w:D;for(const G of g)for(const H of G){const nt=k?H:O0(H,E);let lt=V;const xt=Xd([],[H.x,H.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?lt*=xt[3]/x.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(lt*=x.cameraToCenterDistance/xt[3]),Wd(F,nt,lt))return!0}return!1}}function O0(s,i){const l=Xd([],[s.x,s.y,0,1],i);return new P(l[0]/l[3],l[1]/l[3])}class z0 extends Ea{}let F0;ce("HeatmapBucket",z0,{omit:["layers"]});var sS={get paint(){return F0=F0||new ji({"heatmap-radius":new we(Lt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new we(Lt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new me(Lt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ap(Lt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new me(Lt.paint_heatmap["heatmap-opacity"])})}};function Ug(s,{width:i,height:l},f,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==i*l*f)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${i*l*f}`)}else g=new Uint8Array(i*l*f);return s.width=i,s.height=l,s.data=g,s}function B0(s,{width:i,height:l},f){if(i===s.width&&l===s.height)return;const g=Ug({},{width:i,height:l},f);Gg(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,i),height:Math.min(s.height,l)},f),s.width=i,s.height=l,s.data=g.data}function Gg(s,i,l,f,g,v){if(g.width===0||g.height===0)return i;if(g.width>s.width||g.height>s.height||l.x>s.width-g.width||l.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>i.width||g.height>i.height||f.x>i.width-g.width||f.y>i.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const x=s.data,w=i.data;if(x===w)throw new Error("srcData equals dstData, so image is already copied");for(let E=0;E<g.height;E++){const L=((l.y+E)*s.width+l.x)*v,D=((f.y+E)*i.width+f.x)*v;for(let k=0;k<g.width*v;k++)w[D+k]=x[L+k]}return i}class Zp{constructor(i,l){Ug(this,i,1,l)}resize(i){B0(this,i,1)}clone(){return new Zp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,f,g,v){Gg(i,l,f,g,v,1)}}class Xo{constructor(i,l){Ug(this,i,4,l)}resize(i){B0(this,i,4)}replace(i,l){l?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Xo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,l,f,g,v){Gg(i,l,f,g,v,4)}}function V0(s){const i={},l=s.resolution||256,f=s.clips?s.clips.length:1,g=s.image||new Xo({width:l,height:f});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const v=(x,w,E)=>{i[s.evaluationKey]=E;const L=s.expression.evaluate(i);g.data[x+w+0]=Math.floor(255*L.r/L.a),g.data[x+w+1]=Math.floor(255*L.g/L.a),g.data[x+w+2]=Math.floor(255*L.b/L.a),g.data[x+w+3]=Math.floor(255*L.a)};if(s.clips)for(let x=0,w=0;x<f;++x,w+=4*l)for(let E=0,L=0;E<l;E++,L+=4){const D=E/(l-1),{start:k,end:F}=s.clips[x];v(w,L,k*(1-D)+F*D)}else for(let x=0,w=0;x<l;x++,w+=4)v(0,w,x/(l-1));return g}ce("AlphaImage",Zp),ce("RGBAImage",Xo);class aS extends Ho{createBucket(i){return new z0(i)}constructor(i){super(i,sS),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=V0({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let U0;var lS={get paint(){return U0=U0||new ji({"hillshade-illumination-direction":new me(Lt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new me(Lt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new me(Lt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new me(Lt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new me(Lt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new me(Lt.paint_hillshade["hillshade-accent-color"])})}};class uS extends Ho{constructor(i){super(i,lS)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const cS=Ir([{name:"a_pos",components:2,type:"Int16"}],4),{members:hS}=cS;var qg={exports:{}};function Yd(s,i,l){l=l||2;var f,g,v,x,w,E,L,D=i&&i.length,k=D?i[0]*l:s.length,F=G0(s,0,k,l,!0),V=[];if(!F||F.next===F.prev)return V;if(D&&(F=function(H,nt,lt,xt){var ut,mt,Rt,zt=[];for(ut=0,mt=nt.length;ut<mt;ut++)(Rt=G0(H,nt[ut]*xt,ut<mt-1?nt[ut+1]*xt:H.length,xt,!1))===Rt.next&&(Rt.steiner=!0),zt.push(vS(Rt));for(zt.sort(gS),ut=0;ut<zt.length;ut++)lt=yS(zt[ut],lt);return lt}(s,i,F,l)),s.length>80*l){f=v=s[0],g=x=s[1];for(var G=l;G<k;G+=l)(w=s[G])<f&&(f=w),(E=s[G+1])<g&&(g=E),w>v&&(v=w),E>x&&(x=E);L=(L=Math.max(v-f,x-g))!==0?32767/L:0}return Hp(F,V,l,f,g,L,0),V}function G0(s,i,l,f,g){var v,x;if(g===Zg(s,i,l,f)>0)for(v=i;v<l;v+=f)x=W0(v,s[v],s[v+1],x);else for(v=l-f;v>=i;v-=f)x=W0(v,s[v],s[v+1],x);return x&&Kd(x,x.next)&&(Yp(x),x=x.next),x}function Vu(s,i){if(!s)return s;i||(i=s);var l,f=s;do if(l=!1,f.steiner||!Kd(f,f.next)&&Er(f.prev,f,f.next)!==0)f=f.next;else{if(Yp(f),(f=i=f.prev)===f.next)break;l=!0}while(l||f!==i);return i}function Hp(s,i,l,f,g,v,x){if(s){!x&&v&&function(D,k,F,V){var G=D;do G.z===0&&(G.z=jg(G.x,G.y,k,F,V)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next;while(G!==D);G.prevZ.nextZ=null,G.prevZ=null,function(H){var nt,lt,xt,ut,mt,Rt,zt,oe,fe=1;do{for(lt=H,H=null,mt=null,Rt=0;lt;){for(Rt++,xt=lt,zt=0,nt=0;nt<fe&&(zt++,xt=xt.nextZ);nt++);for(oe=fe;zt>0||oe>0&&xt;)zt!==0&&(oe===0||!xt||lt.z<=xt.z)?(ut=lt,lt=lt.nextZ,zt--):(ut=xt,xt=xt.nextZ,oe--),mt?mt.nextZ=ut:H=ut,ut.prevZ=mt,mt=ut;lt=xt}mt.nextZ=null,fe*=2}while(Rt>1)}(G)}(s,f,g,v);for(var w,E,L=s;s.prev!==s.next;)if(w=s.prev,E=s.next,v?fS(s,f,g,v):pS(s))i.push(w.i/l|0),i.push(s.i/l|0),i.push(E.i/l|0),Yp(s),s=E.next,L=E.next;else if((s=E)===L){x?x===1?Hp(s=dS(Vu(s),i,l),i,l,f,g,v,2):x===2&&mS(s,i,l,f,g,v):Hp(Vu(s),i,l,f,g,v,1);break}}}function pS(s){var i=s.prev,l=s,f=s.next;if(Er(i,l,f)>=0)return!1;for(var g=i.x,v=l.x,x=f.x,w=i.y,E=l.y,L=f.y,D=g<v?g<x?g:x:v<x?v:x,k=w<E?w<L?w:L:E<L?E:L,F=g>v?g>x?g:x:v>x?v:x,V=w>E?w>L?w:L:E>L?E:L,G=f.next;G!==i;){if(G.x>=D&&G.x<=F&&G.y>=k&&G.y<=V&&oh(g,w,v,E,x,L,G.x,G.y)&&Er(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function fS(s,i,l,f){var g=s.prev,v=s,x=s.next;if(Er(g,v,x)>=0)return!1;for(var w=g.x,E=v.x,L=x.x,D=g.y,k=v.y,F=x.y,V=w<E?w<L?w:L:E<L?E:L,G=D<k?D<F?D:F:k<F?k:F,H=w>E?w>L?w:L:E>L?E:L,nt=D>k?D>F?D:F:k>F?k:F,lt=jg(V,G,i,l,f),xt=jg(H,nt,i,l,f),ut=s.prevZ,mt=s.nextZ;ut&&ut.z>=lt&&mt&&mt.z<=xt;){if(ut.x>=V&&ut.x<=H&&ut.y>=G&&ut.y<=nt&&ut!==g&&ut!==x&&oh(w,D,E,k,L,F,ut.x,ut.y)&&Er(ut.prev,ut,ut.next)>=0||(ut=ut.prevZ,mt.x>=V&&mt.x<=H&&mt.y>=G&&mt.y<=nt&&mt!==g&&mt!==x&&oh(w,D,E,k,L,F,mt.x,mt.y)&&Er(mt.prev,mt,mt.next)>=0))return!1;mt=mt.nextZ}for(;ut&&ut.z>=lt;){if(ut.x>=V&&ut.x<=H&&ut.y>=G&&ut.y<=nt&&ut!==g&&ut!==x&&oh(w,D,E,k,L,F,ut.x,ut.y)&&Er(ut.prev,ut,ut.next)>=0)return!1;ut=ut.prevZ}for(;mt&&mt.z<=xt;){if(mt.x>=V&&mt.x<=H&&mt.y>=G&&mt.y<=nt&&mt!==g&&mt!==x&&oh(w,D,E,k,L,F,mt.x,mt.y)&&Er(mt.prev,mt,mt.next)>=0)return!1;mt=mt.nextZ}return!0}function dS(s,i,l){var f=s;do{var g=f.prev,v=f.next.next;!Kd(g,v)&&q0(g,f,f.next,v)&&Xp(g,v)&&Xp(v,g)&&(i.push(g.i/l|0),i.push(f.i/l|0),i.push(v.i/l|0),Yp(f),Yp(f.next),f=s=v),f=f.next}while(f!==s);return Vu(f)}function mS(s,i,l,f,g,v){var x=s;do{for(var w=x.next.next;w!==x.prev;){if(x.i!==w.i&&xS(x,w)){var E=j0(x,w);return x=Vu(x,x.next),E=Vu(E,E.next),Hp(x,i,l,f,g,v,0),void Hp(E,i,l,f,g,v,0)}w=w.next}x=x.next}while(x!==s)}function gS(s,i){return s.x-i.x}function yS(s,i){var l=function(g,v){var x,w=v,E=g.x,L=g.y,D=-1/0;do{if(L<=w.y&&L>=w.next.y&&w.next.y!==w.y){var k=w.x+(L-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(k<=E&&k>D&&(D=k,x=w.x<w.next.x?w:w.next,k===E))return x}w=w.next}while(w!==v);if(!x)return null;var F,V=x,G=x.x,H=x.y,nt=1/0;w=x;do E>=w.x&&w.x>=G&&E!==w.x&&oh(L<H?E:D,L,G,H,L<H?D:E,L,w.x,w.y)&&(F=Math.abs(L-w.y)/(E-w.x),Xp(w,g)&&(F<nt||F===nt&&(w.x>x.x||w.x===x.x&&_S(x,w)))&&(x=w,nt=F)),w=w.next;while(w!==V);return x}(s,i);if(!l)return i;var f=j0(l,s);return Vu(f,f.next),Vu(l,l.next)}function _S(s,i){return Er(s.prev,s,i.prev)<0&&Er(i.next,s,s.next)<0}function jg(s,i,l,f,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-l)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*g|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function vS(s){var i=s,l=s;do(i.x<l.x||i.x===l.x&&i.y<l.y)&&(l=i),i=i.next;while(i!==s);return l}function oh(s,i,l,f,g,v,x,w){return(g-x)*(i-w)>=(s-x)*(v-w)&&(s-x)*(f-w)>=(l-x)*(i-w)&&(l-x)*(v-w)>=(g-x)*(f-w)}function xS(s,i){return s.next.i!==i.i&&s.prev.i!==i.i&&!function(l,f){var g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==f.i&&g.next.i!==f.i&&q0(g,g.next,l,f))return!0;g=g.next}while(g!==l);return!1}(s,i)&&(Xp(s,i)&&Xp(i,s)&&function(l,f){var g=l,v=!1,x=(l.x+f.x)/2,w=(l.y+f.y)/2;do g.y>w!=g.next.y>w&&g.next.y!==g.y&&x<(g.next.x-g.x)*(w-g.y)/(g.next.y-g.y)+g.x&&(v=!v),g=g.next;while(g!==l);return v}(s,i)&&(Er(s.prev,s,i.prev)||Er(s,i.prev,i))||Kd(s,i)&&Er(s.prev,s,s.next)>0&&Er(i.prev,i,i.next)>0)}function Er(s,i,l){return(i.y-s.y)*(l.x-i.x)-(i.x-s.x)*(l.y-i.y)}function Kd(s,i){return s.x===i.x&&s.y===i.y}function q0(s,i,l,f){var g=Qd(Er(s,i,l)),v=Qd(Er(s,i,f)),x=Qd(Er(l,f,s)),w=Qd(Er(l,f,i));return g!==v&&x!==w||!(g!==0||!Jd(s,l,i))||!(v!==0||!Jd(s,f,i))||!(x!==0||!Jd(l,s,f))||!(w!==0||!Jd(l,i,f))}function Jd(s,i,l){return i.x<=Math.max(s.x,l.x)&&i.x>=Math.min(s.x,l.x)&&i.y<=Math.max(s.y,l.y)&&i.y>=Math.min(s.y,l.y)}function Qd(s){return s>0?1:s<0?-1:0}function Xp(s,i){return Er(s.prev,s,s.next)<0?Er(s,i,s.next)>=0&&Er(s,s.prev,i)>=0:Er(s,i,s.prev)<0||Er(s,s.next,i)<0}function j0(s,i){var l=new Wg(s.i,s.x,s.y),f=new Wg(i.i,i.x,i.y),g=s.next,v=i.prev;return s.next=i,i.prev=s,l.next=g,g.prev=l,f.next=l,l.prev=f,v.next=f,f.prev=v,f}function W0(s,i,l,f){var g=new Wg(s,i,l);return f?(g.next=f.next,g.prev=f,f.next.prev=g,f.next=g):(g.prev=g,g.next=g),g}function Yp(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Wg(s,i,l){this.i=s,this.x=i,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Zg(s,i,l,f){for(var g=0,v=i,x=l-f;v<l;v+=f)g+=(s[x]-s[v])*(s[v+1]+s[x+1]),x=v;return g}qg.exports=Yd,qg.exports.default=Yd,Yd.deviation=function(s,i,l,f){var g=i&&i.length,v=Math.abs(Zg(s,0,g?i[0]*l:s.length,l));if(g)for(var x=0,w=i.length;x<w;x++)v-=Math.abs(Zg(s,i[x]*l,x<w-1?i[x+1]*l:s.length,l));var E=0;for(x=0;x<f.length;x+=3){var L=f[x]*l,D=f[x+1]*l,k=f[x+2]*l;E+=Math.abs((s[L]-s[k])*(s[D+1]-s[L+1])-(s[L]-s[D])*(s[k+1]-s[L+1]))}return v===0&&E===0?0:Math.abs((E-v)/v)},Yd.flatten=function(s){for(var i=s[0][0].length,l={vertices:[],holes:[],dimensions:i},f=0,g=0;g<s.length;g++){for(var v=0;v<s[g].length;v++)for(var x=0;x<i;x++)l.vertices.push(s[g][v][x]);g>0&&l.holes.push(f+=s[g-1].length)}return l};var Z0=b(qg.exports);function bS(s,i,l,f,g){H0(s,i,l||0,f||s.length-1,g||wS)}function H0(s,i,l,f,g){for(;f>l;){if(f-l>600){var v=f-l+1,x=i-l+1,w=Math.log(v),E=.5*Math.exp(2*w/3),L=.5*Math.sqrt(w*E*(v-E)/v)*(x-v/2<0?-1:1);H0(s,i,Math.max(l,Math.floor(i-x*E/v+L)),Math.min(f,Math.floor(i+(v-x)*E/v+L)),g)}var D=s[i],k=l,F=f;for(Kp(s,l,i),g(s[f],D)>0&&Kp(s,l,f);k<F;){for(Kp(s,k,F),k++,F--;g(s[k],D)<0;)k++;for(;g(s[F],D)>0;)F--}g(s[l],D)===0?Kp(s,l,F):Kp(s,++F,f),F<=i&&(l=F+1),i<=F&&(f=F-1)}}function Kp(s,i,l){var f=s[i];s[i]=s[l],s[l]=f}function wS(s,i){return s<i?-1:s>i?1:0}function Hg(s,i){const l=s.length;if(l<=1)return[s];const f=[];let g,v;for(let x=0;x<l;x++){const w=Ye(s[x]);w!==0&&(s[x].area=Math.abs(w),v===void 0&&(v=w<0),v===w<0?(g&&f.push(g),g=[s[x]]):g.push(s[x]))}if(g&&f.push(g),i>1)for(let x=0;x<f.length;x++)f[x].length<=i||(bS(f[x],i,1,f[x].length-1,SS),f[x]=f[x].slice(0,i));return f}function SS(s,i){return i.area-s.area}function Xg(s,i,l){const f=l.patternDependencies;let g=!1;for(const v of i){const x=v.paint.get(`${s}-pattern`);x.isConstant()||(g=!0);const w=x.constantOr(null);w&&(g=!0,f[w.to]=!0,f[w.from]=!0)}return g}function Yg(s,i,l,f,g){const v=g.patternDependencies;for(const x of i){const w=x.paint.get(`${s}-pattern`).value;if(w.kind!=="constant"){let E=w.evaluate({zoom:f-1},l,{},g.availableImages),L=w.evaluate({zoom:f},l,{},g.availableImages),D=w.evaluate({zoom:f+1},l,{},g.availableImages);E=E&&E.name?E.name:E,L=L&&L.name?L.name:L,D=D&&D.name?D.name:D,v[E]=!0,v[L]=!0,v[D]=!0,l.patterns[x.id]={min:E,mid:L,max:D}}}return l}class Kg{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new tt,this.indexArray=new kt,this.indexArray2=new Vt,this.programConfigurations=new sr(i.layers,i.zoom),this.segments=new Xt,this.segments2=new Xt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.hasPattern=Xg("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),v=!g.isConstant(),x=[];for(const{feature:w,id:E,index:L,sourceLayerIndex:D}of i){const k=this.layers[0]._featureFilter.needGeometry,F=rl(w,k);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom),F,f))continue;const V=v?g.evaluate(F,{},f,l.availableImages):void 0,G={id:E,properties:w.properties,type:w.type,sourceLayerIndex:D,index:L,geometry:k?F.geometry:nl(w),patterns:{},sortKey:V};x.push(G)}v&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:L,sourceLayerIndex:D}=w;if(this.hasPattern){const k=Yg("fill",this.layers,w,this.zoom,l);this.patternFeatures.push(k)}else this.addFeature(w,E,L,f,{});l.featureIndex.insert(i[L].feature,E,L,D,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}addFeatures(i,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,hS),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,l,f,g,v){for(const x of Hg(l,500)){let w=0;for(const V of x)w+=V.length;const E=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),L=E.vertexLength,D=[],k=[];for(const V of x){if(V.length===0)continue;V!==x[0]&&k.push(D.length/2);const G=this.segments2.prepareSegment(V.length,this.layoutVertexArray,this.indexArray2),H=G.vertexLength;this.layoutVertexArray.emplaceBack(V[0].x,V[0].y),this.indexArray2.emplaceBack(H+V.length-1,H),D.push(V[0].x),D.push(V[0].y);for(let nt=1;nt<V.length;nt++)this.layoutVertexArray.emplaceBack(V[nt].x,V[nt].y),this.indexArray2.emplaceBack(H+nt-1,H+nt),D.push(V[nt].x),D.push(V[nt].y);G.vertexLength+=V.length,G.primitiveLength+=V.length}const F=Z0(D,k);for(let V=0;V<F.length;V+=3)this.indexArray.emplaceBack(L+F[V],L+F[V+1],L+F[V+2]);E.vertexLength+=w,E.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,v,g)}}let X0,Y0;ce("FillBucket",Kg,{omit:["layers","patternFeatures"]});var IS={get paint(){return Y0=Y0||new ji({"fill-antialias":new me(Lt.paint_fill["fill-antialias"]),"fill-opacity":new we(Lt.paint_fill["fill-opacity"]),"fill-color":new we(Lt.paint_fill["fill-color"]),"fill-outline-color":new we(Lt.paint_fill["fill-outline-color"]),"fill-translate":new me(Lt.paint_fill["fill-translate"]),"fill-translate-anchor":new me(Lt.paint_fill["fill-translate-anchor"]),"fill-pattern":new Hc(Lt.paint_fill["fill-pattern"])})},get layout(){return X0=X0||new ji({"fill-sort-key":new we(Lt.layout_fill["fill-sort-key"])})}};class ES extends Ho{constructor(i){super(i,IS)}recalculate(i,l){super.recalculate(i,l);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new Kg(i)}queryRadius(){return Zd(this.paint.get("fill-translate"))}queryIntersectsFeature(i,l,f,g,v,x,w){return Up(Hd(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),x.angle,w),g)}isTileClipped(){return!0}}const CS=Ir([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),TS=Ir([{name:"a_centroid",components:2,type:"Int16"}],4),{members:LS}=CS;var ql={},PS=C,K0=sh;function sh(s,i,l,f,g){this.properties={},this.extent=l,this.type=0,this._pbf=s,this._geometry=-1,this._keys=f,this._values=g,s.readFields(AS,this,i)}function AS(s,i,l){s==1?i.id=l.readVarint():s==2?function(f,g){for(var v=f.readVarint()+f.pos;f.pos<v;){var x=g._keys[f.readVarint()],w=g._values[f.readVarint()];g.properties[x]=w}}(l,i):s==3?i.type=l.readVarint():s==4&&(i._geometry=l.pos)}function MS(s){for(var i,l,f=0,g=0,v=s.length,x=v-1;g<v;x=g++)f+=((l=s[x]).x-(i=s[g]).x)*(i.y+l.y);return f}sh.types=["Unknown","Point","LineString","Polygon"],sh.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var i,l=s.readVarint()+s.pos,f=1,g=0,v=0,x=0,w=[];s.pos<l;){if(g<=0){var E=s.readVarint();f=7&E,g=E>>3}if(g--,f===1||f===2)v+=s.readSVarint(),x+=s.readSVarint(),f===1&&(i&&w.push(i),i=[]),i.push(new PS(v,x));else{if(f!==7)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&w.push(i),w},sh.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var i=s.readVarint()+s.pos,l=1,f=0,g=0,v=0,x=1/0,w=-1/0,E=1/0,L=-1/0;s.pos<i;){if(f<=0){var D=s.readVarint();l=7&D,f=D>>3}if(f--,l===1||l===2)(g+=s.readSVarint())<x&&(x=g),g>w&&(w=g),(v+=s.readSVarint())<E&&(E=v),v>L&&(L=v);else if(l!==7)throw new Error("unknown command "+l)}return[x,E,w,L]},sh.prototype.toGeoJSON=function(s,i,l){var f,g,v=this.extent*Math.pow(2,l),x=this.extent*s,w=this.extent*i,E=this.loadGeometry(),L=sh.types[this.type];function D(V){for(var G=0;G<V.length;G++){var H=V[G];V[G]=[360*(H.x+x)/v-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+w)/v)*Math.PI/180))-90]}}switch(this.type){case 1:var k=[];for(f=0;f<E.length;f++)k[f]=E[f][0];D(E=k);break;case 2:for(f=0;f<E.length;f++)D(E[f]);break;case 3:for(E=function(V){var G=V.length;if(G<=1)return[V];for(var H,nt,lt=[],xt=0;xt<G;xt++){var ut=MS(V[xt]);ut!==0&&(nt===void 0&&(nt=ut<0),nt===ut<0?(H&&lt.push(H),H=[V[xt]]):H.push(V[xt]))}return H&&lt.push(H),lt}(E),f=0;f<E.length;f++)for(g=0;g<E[f].length;g++)D(E[f][g])}E.length===1?E=E[0]:L="Multi"+L;var F={type:"Feature",geometry:{type:L,coordinates:E},properties:this.properties};return"id"in this&&(F.id=this.id),F};var DS=K0,J0=Q0;function Q0(s,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(kS,this,i),this.length=this._features.length}function kS(s,i,l){s===15?i.version=l.readVarint():s===1?i.name=l.readString():s===5?i.extent=l.readVarint():s===2?i._features.push(l.pos):s===3?i._keys.push(l.readString()):s===4&&i._values.push(function(f){for(var g=null,v=f.readVarint()+f.pos;f.pos<v;){var x=f.readVarint()>>3;g=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return g}(l))}Q0.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var i=this._pbf.readVarint()+this._pbf.pos;return new DS(this._pbf,i,this.extent,this._keys,this._values)};var RS=J0;function NS(s,i,l){if(s===3){var f=new RS(l,l.readVarint()+l.pos);f.length&&(i[f.name]=f)}}ql.VectorTile=function(s,i){this.layers=s.readFields(NS,{},i)},ql.VectorTileFeature=K0,ql.VectorTileLayer=J0;const OS=ql.VectorTileFeature.types,Jg=Math.pow(2,13);function Jp(s,i,l,f,g,v,x,w){s.emplaceBack(i,l,2*Math.floor(f*Jg)+x,g*Jg*2,v*Jg*2,Math.round(w))}class Qg{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new $,this.centroidVertexArray=new O,this.indexArray=new kt,this.programConfigurations=new sr(i.layers,i.zoom),this.segments=new Xt,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.features=[],this.hasPattern=Xg("fill-extrusion",this.layers,l);for(const{feature:g,id:v,index:x,sourceLayerIndex:w}of i){const E=this.layers[0]._featureFilter.needGeometry,L=rl(g,E);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom),L,f))continue;const D={id:v,sourceLayerIndex:w,index:x,geometry:E?L.geometry:nl(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(Yg("fill-extrusion",this.layers,D,this.zoom,l)):this.addFeature(D,D.geometry,x,f,{}),l.featureIndex.insert(g,D.geometry,x,w,this.index,!0)}}addFeatures(i,l,f){for(const g of this.features){const{geometry:v}=g;this.addFeature(g,v,g.index,l,f)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,LS),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,TS.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,l,f,g,v){const x={x:0,y:0,vertexCount:0};for(const w of Hg(l,500)){let E=0;for(const G of w)E+=G.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const G of w){if(G.length===0||FS(G))continue;let H=0;for(let nt=0;nt<G.length;nt++){const lt=G[nt];if(nt>=1){const xt=G[nt-1];if(!zS(lt,xt)){L.vertexLength+4>Xt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ut=lt.sub(xt)._perp()._unit(),mt=xt.dist(lt);H+mt>32768&&(H=0),Jp(this.layoutVertexArray,lt.x,lt.y,ut.x,ut.y,0,0,H),Jp(this.layoutVertexArray,lt.x,lt.y,ut.x,ut.y,0,1,H),x.x+=2*lt.x,x.y+=2*lt.y,x.vertexCount+=2,H+=mt,Jp(this.layoutVertexArray,xt.x,xt.y,ut.x,ut.y,0,0,H),Jp(this.layoutVertexArray,xt.x,xt.y,ut.x,ut.y,0,1,H),x.x+=2*xt.x,x.y+=2*xt.y,x.vertexCount+=2;const Rt=L.vertexLength;this.indexArray.emplaceBack(Rt,Rt+2,Rt+1),this.indexArray.emplaceBack(Rt+1,Rt+2,Rt+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+E>Xt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray)),OS[i.type]!=="Polygon")continue;const D=[],k=[],F=L.vertexLength;for(const G of w)if(G.length!==0){G!==w[0]&&k.push(D.length/2);for(let H=0;H<G.length;H++){const nt=G[H];Jp(this.layoutVertexArray,nt.x,nt.y,0,0,1,1,0),x.x+=nt.x,x.y+=nt.y,x.vertexCount+=1,D.push(nt.x),D.push(nt.y)}}const V=Z0(D,k);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(F+V[G],F+V[G+2],F+V[G+1]);L.primitiveLength+=V.length/3,L.vertexLength+=E}for(let w=0;w<x.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(x.x/x.vertexCount),Math.floor(x.y/x.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,v,g)}}function zS(s,i){return s.x===i.x&&(s.x<0||s.x>yr)||s.y===i.y&&(s.y<0||s.y>yr)}function FS(s){return s.every(i=>i.x<0)||s.every(i=>i.x>yr)||s.every(i=>i.y<0)||s.every(i=>i.y>yr)}let $0;ce("FillExtrusionBucket",Qg,{omit:["layers","features"]});var BS={get paint(){return $0=$0||new ji({"fill-extrusion-opacity":new me(Lt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new we(Lt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new me(Lt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new me(Lt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Hc(Lt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new we(Lt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new we(Lt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new me(Lt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class VS extends Ho{constructor(i){super(i,BS)}createBucket(i){return new Qg(i)}queryRadius(){return Zd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,l,f,g,v,x,w,E){const L=Hd(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),x.angle,w),D=this.paint.get("fill-extrusion-height").evaluate(l,f),k=this.paint.get("fill-extrusion-base").evaluate(l,f),F=function(G,H,nt,lt){const xt=[];for(const ut of G){const mt=[ut.x,ut.y,0,1];Xd(mt,mt,H),xt.push(new P(mt[0]/mt[3],mt[1]/mt[3]))}return xt}(L,E),V=function(G,H,nt,lt){const xt=[],ut=[],mt=lt[8]*H,Rt=lt[9]*H,zt=lt[10]*H,oe=lt[11]*H,fe=lt[8]*nt,ie=lt[9]*nt,ee=lt[10]*nt,Ht=lt[11]*nt;for(const he of G){const Jt=[],Gt=[];for(const xe of he){const de=xe.x,Je=xe.y,Wn=lt[0]*de+lt[4]*Je+lt[12],Qn=lt[1]*de+lt[5]*Je+lt[13],qr=lt[2]*de+lt[6]*Je+lt[14],Mo=lt[3]*de+lt[7]*Je+lt[15],Zi=qr+zt,Nr=Mo+oe,ai=Wn+fe,yi=Qn+ie,Hi=qr+ee,Xi=Mo+Ht,jr=new P((Wn+mt)/Nr,(Qn+Rt)/Nr);jr.z=Zi/Nr,Jt.push(jr);const Wr=new P(ai/Xi,yi/Xi);Wr.z=Hi/Xi,Gt.push(Wr)}xt.push(Jt),ut.push(Gt)}return[xt,ut]}(g,k,D,E);return function(G,H,nt){let lt=1/0;Up(nt,H)&&(lt=tv(nt,H[0]));for(let xt=0;xt<H.length;xt++){const ut=H[xt],mt=G[xt];for(let Rt=0;Rt<ut.length-1;Rt++){const zt=ut[Rt],oe=[zt,ut[Rt+1],mt[Rt+1],mt[Rt],zt];Vp(nt,oe)&&(lt=Math.min(lt,tv(nt,oe)))}}return lt!==1/0&&lt}(V[0],V[1],F)}}function Qp(s,i){return s.x*i.x+s.y*i.y}function tv(s,i){if(s.length===1){let l=0;const f=i[l++];let g;for(;!g||f.equals(g);)if(g=i[l++],!g)return 1/0;for(;l<i.length;l++){const v=i[l],x=s[0],w=g.sub(f),E=v.sub(f),L=x.sub(f),D=Qp(w,w),k=Qp(w,E),F=Qp(E,E),V=Qp(L,w),G=Qp(L,E),H=D*F-k*k,nt=(F*V-k*G)/H,lt=(D*G-k*V)/H,xt=f.z*(1-nt-lt)+g.z*nt+v.z*lt;if(isFinite(xt))return xt}return 1/0}{let l=1/0;for(const f of i)l=Math.min(l,f.z);return l}}const US=Ir([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:GS}=US,qS=Ir([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:jS}=qS,WS=ql.VectorTileFeature.types,ZS=Math.cos(Math.PI/180*37.5),ev=Math.pow(2,14)/.5;class $g{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(l=>l.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new it,this.layoutVertexArray2=new Z,this.indexArray=new kt,this.programConfigurations=new sr(i.layers,i.zoom),this.segments=new Xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(i,l,f){this.hasPattern=Xg("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),v=!g.isConstant(),x=[];for(const{feature:w,id:E,index:L,sourceLayerIndex:D}of i){const k=this.layers[0]._featureFilter.needGeometry,F=rl(w,k);if(!this.layers[0]._featureFilter.filter(new Kn(this.zoom),F,f))continue;const V=v?g.evaluate(F,{},f):void 0,G={id:E,properties:w.properties,type:w.type,sourceLayerIndex:D,index:L,geometry:k?F.geometry:nl(w),patterns:{},sortKey:V};x.push(G)}v&&x.sort((w,E)=>w.sortKey-E.sortKey);for(const w of x){const{geometry:E,index:L,sourceLayerIndex:D}=w;if(this.hasPattern){const k=Yg("line",this.layers,w,this.zoom,l);this.patternFeatures.push(k)}else this.addFeature(w,E,L,f,{});l.featureIndex.insert(i[L].feature,E,L,D,this.index)}}update(i,l,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,l,this.stateDependentLayers,f)}addFeatures(i,l,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,jS)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,GS),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,l,f,g,v){const x=this.layers[0].layout,w=x.get("line-join").evaluate(i,{}),E=x.get("line-cap"),L=x.get("line-miter-limit"),D=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const k of l)this.addLine(k,i,w,E,L,D);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,v,g)}addLine(i,l,f,g,v,x){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let lt=0;lt<i.length-1;lt++)this.totalDistance+=i[lt].dist(i[lt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=WS[l.type]==="Polygon";let E=i.length;for(;E>=2&&i[E-1].equals(i[E-2]);)E--;let L=0;for(;L<E-1&&i[L].equals(i[L+1]);)L++;if(E<(w?3:2))return;f==="bevel"&&(v=1.05);const D=this.overscaling<=16?15*yr/(512*this.overscaling):0,k=this.segments.prepareSegment(10*E,this.layoutVertexArray,this.indexArray);let F,V,G,H,nt;this.e1=this.e2=-1,w&&(F=i[E-2],nt=i[L].sub(F)._unit()._perp());for(let lt=L;lt<E;lt++){if(G=lt===E-1?w?i[L+1]:void 0:i[lt+1],G&&i[lt].equals(G))continue;nt&&(H=nt),F&&(V=F),F=i[lt],nt=G?G.sub(F)._unit()._perp():H,H=H||nt;let xt=H.add(nt);xt.x===0&&xt.y===0||xt._unit();const ut=H.x*nt.x+H.y*nt.y,mt=xt.x*nt.x+xt.y*nt.y,Rt=mt!==0?1/mt:1/0,zt=2*Math.sqrt(2-2*mt),oe=mt<ZS&&V&&G,fe=H.x*nt.y-H.y*nt.x>0;if(oe&&lt>L){const Ht=F.dist(V);if(Ht>2*D){const he=F.sub(F.sub(V)._mult(D/Ht)._round());this.updateDistance(V,he),this.addCurrentVertex(he,H,0,0,k),V=he}}const ie=V&&G;let ee=ie?f:w?"butt":g;if(ie&&ee==="round"&&(Rt<x?ee="miter":Rt<=2&&(ee="fakeround")),ee==="miter"&&Rt>v&&(ee="bevel"),ee==="bevel"&&(Rt>2&&(ee="flipbevel"),Rt<v&&(ee="miter")),V&&this.updateDistance(V,F),ee==="miter")xt._mult(Rt),this.addCurrentVertex(F,xt,0,0,k);else if(ee==="flipbevel"){if(Rt>100)xt=nt.mult(-1);else{const Ht=Rt*H.add(nt).mag()/H.sub(nt).mag();xt._perp()._mult(Ht*(fe?-1:1))}this.addCurrentVertex(F,xt,0,0,k),this.addCurrentVertex(F,xt.mult(-1),0,0,k)}else if(ee==="bevel"||ee==="fakeround"){const Ht=-Math.sqrt(Rt*Rt-1),he=fe?Ht:0,Jt=fe?0:Ht;if(V&&this.addCurrentVertex(F,H,he,Jt,k),ee==="fakeround"){const Gt=Math.round(180*zt/Math.PI/20);for(let xe=1;xe<Gt;xe++){let de=xe/Gt;if(de!==.5){const Wn=de-.5;de+=de*Wn*(de-1)*((1.0904+ut*(ut*(3.55645-1.43519*ut)-3.2452))*Wn*Wn+(.848013+ut*(.215638*ut-1.06021)))}const Je=nt.sub(H)._mult(de)._add(H)._unit()._mult(fe?-1:1);this.addHalfVertex(F,Je.x,Je.y,!1,fe,0,k)}}G&&this.addCurrentVertex(F,nt,-he,-Jt,k)}else if(ee==="butt")this.addCurrentVertex(F,xt,0,0,k);else if(ee==="square"){const Ht=V?1:-1;this.addCurrentVertex(F,xt,Ht,Ht,k)}else ee==="round"&&(V&&(this.addCurrentVertex(F,H,0,0,k),this.addCurrentVertex(F,H,1,1,k,!0)),G&&(this.addCurrentVertex(F,nt,-1,-1,k,!0),this.addCurrentVertex(F,nt,0,0,k)));if(oe&&lt<E-1){const Ht=F.dist(G);if(Ht>2*D){const he=F.add(G.sub(F)._mult(D/Ht)._round());this.updateDistance(F,he),this.addCurrentVertex(he,nt,0,0,k),F=he}}}}addCurrentVertex(i,l,f,g,v,x=!1){const w=l.y*g-l.x,E=-l.y-l.x*g;this.addHalfVertex(i,l.x+l.y*f,l.y-l.x*f,x,!1,f,v),this.addHalfVertex(i,w,E,x,!0,-g,v),this.distance>ev/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,l,f,g,v,x))}addHalfVertex({x:i,y:l},f,g,v,x,w,E){const L=.5*(this.lineClips?this.scaledDistance*(ev-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(v?1:0),(l<<1)+(x?1:0),Math.round(63*f)+128,Math.round(63*g)+128,1+(w===0?0:w<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const D=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),E.primitiveLength++),x?this.e2=D:this.e1=D}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,l){this.distance+=i.dist(l),this.updateScaledDistance()}}let nv,rv;ce("LineBucket",$g,{omit:["layers","patternFeatures"]});var iv={get paint(){return rv=rv||new ji({"line-opacity":new we(Lt.paint_line["line-opacity"]),"line-color":new we(Lt.paint_line["line-color"]),"line-translate":new me(Lt.paint_line["line-translate"]),"line-translate-anchor":new me(Lt.paint_line["line-translate-anchor"]),"line-width":new we(Lt.paint_line["line-width"]),"line-gap-width":new we(Lt.paint_line["line-gap-width"]),"line-offset":new we(Lt.paint_line["line-offset"]),"line-blur":new we(Lt.paint_line["line-blur"]),"line-dasharray":new ku(Lt.paint_line["line-dasharray"]),"line-pattern":new Hc(Lt.paint_line["line-pattern"]),"line-gradient":new Ap(Lt.paint_line["line-gradient"])})},get layout(){return nv=nv||new ji({"line-cap":new me(Lt.layout_line["line-cap"]),"line-join":new we(Lt.layout_line["line-join"]),"line-miter-limit":new me(Lt.layout_line["line-miter-limit"]),"line-round-limit":new me(Lt.layout_line["line-round-limit"]),"line-sort-key":new we(Lt.layout_line["line-sort-key"])})}};class HS extends we{possiblyEvaluate(i,l){return l=new Kn(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(i,l)}evaluate(i,l,f,g){return l=Mt({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(i,l,f,g)}}let $d;class XS extends Ho{constructor(i){super(i,iv),this.gradientVersion=0,$d||($d=new HS(iv.paint.properties["line-width"].specification),$d.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof Eu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,l){super.recalculate(i,l),this.paint._values["line-floorwidth"]=$d.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new $g(i)}queryRadius(i){const l=i,f=ov(jp("line-width",this,l),jp("line-gap-width",this,l)),g=jp("line-offset",this,l);return f/2+Math.abs(g)+Zd(this.paint.get("line-translate"))}queryIntersectsFeature(i,l,f,g,v,x,w){const E=Hd(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),x.angle,w),L=w/2*ov(this.paint.get("line-width").evaluate(l,f),this.paint.get("line-gap-width").evaluate(l,f)),D=this.paint.get("line-offset").evaluate(l,f);return D&&(g=function(k,F){const V=[];for(let G=0;G<k.length;G++){const H=k[G],nt=[];for(let lt=0;lt<H.length;lt++){const xt=H[lt-1],ut=H[lt],mt=H[lt+1],Rt=lt===0?new P(0,0):ut.sub(xt)._unit()._perp(),zt=lt===H.length-1?new P(0,0):mt.sub(ut)._unit()._perp(),oe=Rt._add(zt)._unit(),fe=oe.x*zt.x+oe.y*zt.y;fe!==0&&oe._mult(1/fe),nt.push(oe._mult(F)._add(ut))}V.push(nt)}return V}(g,D*w)),function(k,F,V){for(let G=0;G<F.length;G++){const H=F[G];if(k.length>=3){for(let nt=0;nt<H.length;nt++)if(rh(k,H[nt]))return!0}if(Gp(k,H,V))return!0}return!1}(E,g,L)}isTileClipped(){return!0}}function ov(s,i){return i>0?i+2*s:s}const YS=Ir([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),KS=Ir([{name:"a_projected_pos",components:3,type:"Float32"}],4);Ir([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const JS=Ir([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Ir([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const sv=Ir([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),QS=Ir([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $S(s,i,l){return s.sections.forEach(f=>{f.text=function(g,v,x){const w=v.layout.get("text-transform").evaluate(x,{});return w==="uppercase"?g=g.toLocaleUpperCase():w==="lowercase"&&(g=g.toLocaleLowerCase()),wa.applyArabicShaping&&(g=wa.applyArabicShaping(g)),g}(f.text,i,l)}),s}Ir([{name:"triangle",components:3,type:"Uint16"}]),Ir([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ir([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Ir([{type:"Float32",name:"offsetX"}]),Ir([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Ir([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const $p={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Gr=24,av=Nn,lv=function(s,i,l,f,g){var v,x,w=8*g-f-1,E=(1<<w)-1,L=E>>1,D=-7,k=l?g-1:0,F=l?-1:1,V=s[i+k];for(k+=F,v=V&(1<<-D)-1,V>>=-D,D+=w;D>0;v=256*v+s[i+k],k+=F,D-=8);for(x=v&(1<<-D)-1,v>>=-D,D+=f;D>0;x=256*x+s[i+k],k+=F,D-=8);if(v===0)v=1-L;else{if(v===E)return x?NaN:1/0*(V?-1:1);x+=Math.pow(2,f),v-=L}return(V?-1:1)*x*Math.pow(2,v-f)},uv=function(s,i,l,f,g,v){var x,w,E,L=8*v-g-1,D=(1<<L)-1,k=D>>1,F=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,V=f?0:v-1,G=f?1:-1,H=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(w=isNaN(i)?1:0,x=D):(x=Math.floor(Math.log(i)/Math.LN2),i*(E=Math.pow(2,-x))<1&&(x--,E*=2),(i+=x+k>=1?F/E:F*Math.pow(2,1-k))*E>=2&&(x++,E/=2),x+k>=D?(w=0,x=D):x+k>=1?(w=(i*E-1)*Math.pow(2,g),x+=k):(w=i*Math.pow(2,k-1)*Math.pow(2,g),x=0));g>=8;s[l+V]=255&w,V+=G,w/=256,g-=8);for(x=x<<g|w,L+=g;L>0;s[l+V]=255&x,V+=G,x/=256,L-=8);s[l+V-G]|=128*H};function Nn(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}Nn.Varint=0,Nn.Fixed64=1,Nn.Bytes=2,Nn.Fixed32=5;var ty=4294967296,cv=1/ty,hv=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function il(s){return s.type===Nn.Bytes?s.readVarint()+s.pos:s.pos+1}function ah(s,i,l){return l?4294967296*i+(s>>>0):4294967296*(i>>>0)+(s>>>0)}function pv(s,i,l){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));l.realloc(f);for(var g=l.pos-1;g>=s;g--)l.buf[g+f]=l.buf[g]}function tI(s,i){for(var l=0;l<s.length;l++)i.writeVarint(s[l])}function eI(s,i){for(var l=0;l<s.length;l++)i.writeSVarint(s[l])}function nI(s,i){for(var l=0;l<s.length;l++)i.writeFloat(s[l])}function rI(s,i){for(var l=0;l<s.length;l++)i.writeDouble(s[l])}function iI(s,i){for(var l=0;l<s.length;l++)i.writeBoolean(s[l])}function oI(s,i){for(var l=0;l<s.length;l++)i.writeFixed32(s[l])}function sI(s,i){for(var l=0;l<s.length;l++)i.writeSFixed32(s[l])}function aI(s,i){for(var l=0;l<s.length;l++)i.writeFixed64(s[l])}function lI(s,i){for(var l=0;l<s.length;l++)i.writeSFixed64(s[l])}function tm(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+16777216*s[i+3]}function lh(s,i,l){s[l]=i,s[l+1]=i>>>8,s[l+2]=i>>>16,s[l+3]=i>>>24}function fv(s,i){return(s[i]|s[i+1]<<8|s[i+2]<<16)+(s[i+3]<<24)}Nn.prototype={destroy:function(){this.buf=null},readFields:function(s,i,l){for(l=l||this.length;this.pos<l;){var f=this.readVarint(),g=f>>3,v=this.pos;this.type=7&f,s(g,i,this),this.pos===v&&this.skip(f)}return i},readMessage:function(s,i){return this.readFields(s,i,this.readVarint()+this.pos)},readFixed32:function(){var s=tm(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=fv(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=tm(this.buf,this.pos)+tm(this.buf,this.pos+4)*ty;return this.pos+=8,s},readSFixed64:function(){var s=tm(this.buf,this.pos)+fv(this.buf,this.pos+4)*ty;return this.pos+=8,s},readFloat:function(){var s=lv(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=lv(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var i,l,f=this.buf;return i=127&(l=f[this.pos++]),l<128?i:(i|=(127&(l=f[this.pos++]))<<7,l<128?i:(i|=(127&(l=f[this.pos++]))<<14,l<128?i:(i|=(127&(l=f[this.pos++]))<<21,l<128?i:function(g,v,x){var w,E,L=x.buf;if(w=(112&(E=L[x.pos++]))>>4,E<128||(w|=(127&(E=L[x.pos++]))<<3,E<128)||(w|=(127&(E=L[x.pos++]))<<10,E<128)||(w|=(127&(E=L[x.pos++]))<<17,E<128)||(w|=(127&(E=L[x.pos++]))<<24,E<128)||(w|=(1&(E=L[x.pos++]))<<31,E<128))return ah(g,w,v);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(l=f[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,i=this.pos;return this.pos=s,s-i>=12&&hv?function(l,f,g){return hv.decode(l.subarray(f,g))}(this.buf,i,s):function(l,f,g){for(var v="",x=f;x<g;){var w,E,L,D=l[x],k=null,F=D>239?4:D>223?3:D>191?2:1;if(x+F>g)break;F===1?D<128&&(k=D):F===2?(192&(w=l[x+1]))==128&&(k=(31&D)<<6|63&w)<=127&&(k=null):F===3?(E=l[x+2],(192&(w=l[x+1]))==128&&(192&E)==128&&((k=(15&D)<<12|(63&w)<<6|63&E)<=2047||k>=55296&&k<=57343)&&(k=null)):F===4&&(E=l[x+2],L=l[x+3],(192&(w=l[x+1]))==128&&(192&E)==128&&(192&L)==128&&((k=(15&D)<<18|(63&w)<<12|(63&E)<<6|63&L)<=65535||k>=1114112)&&(k=null)),k===null?(k=65533,F=1):k>65535&&(k-=65536,v+=String.fromCharCode(k>>>10&1023|55296),k=56320|1023&k),v+=String.fromCharCode(k),x+=F}return v}(this.buf,i,s)},readBytes:function(){var s=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,s);return this.pos=s,i},readPackedVarint:function(s,i){if(this.type!==Nn.Bytes)return s.push(this.readVarint(i));var l=il(this);for(s=s||[];this.pos<l;)s.push(this.readVarint(i));return s},readPackedSVarint:function(s){if(this.type!==Nn.Bytes)return s.push(this.readSVarint());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==Nn.Bytes)return s.push(this.readBoolean());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==Nn.Bytes)return s.push(this.readFloat());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==Nn.Bytes)return s.push(this.readDouble());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==Nn.Bytes)return s.push(this.readFixed32());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==Nn.Bytes)return s.push(this.readSFixed32());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==Nn.Bytes)return s.push(this.readFixed64());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==Nn.Bytes)return s.push(this.readSFixed64());var i=il(this);for(s=s||[];this.pos<i;)s.push(this.readSFixed64());return s},skip:function(s){var i=7&s;if(i===Nn.Varint)for(;this.buf[this.pos++]>127;);else if(i===Nn.Bytes)this.pos=this.readVarint()+this.pos;else if(i===Nn.Fixed32)this.pos+=4;else{if(i!==Nn.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(s,i){this.writeVarint(s<<3|i)},realloc:function(s){for(var i=this.length||16;i<this.pos+s;)i*=2;if(i!==this.length){var l=new Uint8Array(i);l.set(this.buf),this.buf=l,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),lh(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),lh(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),lh(this.buf,-1&s,this.pos),lh(this.buf,Math.floor(s*cv),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),lh(this.buf,-1&s,this.pos),lh(this.buf,Math.floor(s*cv),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(i,l){var f,g;if(i>=0?(f=i%4294967296|0,g=i/4294967296|0):(g=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,g=g+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(v,x,w){w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,v>>>=7,w.buf[w.pos++]=127&v|128,w.buf[w.pos]=127&(v>>>=7)}(f,0,l),function(v,x){var w=(7&v)<<4;x.buf[x.pos++]|=w|((v>>>=3)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v|((v>>>=7)?128:0),v&&(x.buf[x.pos++]=127&v)))))}(g,l)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var i=this.pos;this.pos=function(f,g,v){for(var x,w,E=0;E<g.length;E++){if((x=g.charCodeAt(E))>55295&&x<57344){if(!w){x>56319||E+1===g.length?(f[v++]=239,f[v++]=191,f[v++]=189):w=x;continue}if(x<56320){f[v++]=239,f[v++]=191,f[v++]=189,w=x;continue}x=w-55296<<10|x-56320|65536,w=null}else w&&(f[v++]=239,f[v++]=191,f[v++]=189,w=null);x<128?f[v++]=x:(x<2048?f[v++]=x>>6|192:(x<65536?f[v++]=x>>12|224:(f[v++]=x>>18|240,f[v++]=x>>12&63|128),f[v++]=x>>6&63|128),f[v++]=63&x|128)}return v}(this.buf,s,this.pos);var l=this.pos-i;l>=128&&pv(i,l,this),this.pos=i-1,this.writeVarint(l),this.pos+=l},writeFloat:function(s){this.realloc(4),uv(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),uv(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var i=s.length;this.writeVarint(i),this.realloc(i);for(var l=0;l<i;l++)this.buf[this.pos++]=s[l]},writeRawMessage:function(s,i){this.pos++;var l=this.pos;s(i,this);var f=this.pos-l;f>=128&&pv(l,f,this),this.pos=l-1,this.writeVarint(f),this.pos+=f},writeMessage:function(s,i,l){this.writeTag(s,Nn.Bytes),this.writeRawMessage(i,l)},writePackedVarint:function(s,i){i.length&&this.writeMessage(s,tI,i)},writePackedSVarint:function(s,i){i.length&&this.writeMessage(s,eI,i)},writePackedBoolean:function(s,i){i.length&&this.writeMessage(s,iI,i)},writePackedFloat:function(s,i){i.length&&this.writeMessage(s,nI,i)},writePackedDouble:function(s,i){i.length&&this.writeMessage(s,rI,i)},writePackedFixed32:function(s,i){i.length&&this.writeMessage(s,oI,i)},writePackedSFixed32:function(s,i){i.length&&this.writeMessage(s,sI,i)},writePackedFixed64:function(s,i){i.length&&this.writeMessage(s,aI,i)},writePackedSFixed64:function(s,i){i.length&&this.writeMessage(s,lI,i)},writeBytesField:function(s,i){this.writeTag(s,Nn.Bytes),this.writeBytes(i)},writeFixed32Field:function(s,i){this.writeTag(s,Nn.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(s,i){this.writeTag(s,Nn.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(s,i){this.writeTag(s,Nn.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(s,i){this.writeTag(s,Nn.Fixed64),this.writeSFixed64(i)},writeVarintField:function(s,i){this.writeTag(s,Nn.Varint),this.writeVarint(i)},writeSVarintField:function(s,i){this.writeTag(s,Nn.Varint),this.writeSVarint(i)},writeStringField:function(s,i){this.writeTag(s,Nn.Bytes),this.writeString(i)},writeFloatField:function(s,i){this.writeTag(s,Nn.Fixed32),this.writeFloat(i)},writeDoubleField:function(s,i){this.writeTag(s,Nn.Fixed64),this.writeDouble(i)},writeBooleanField:function(s,i){this.writeVarintField(s,!!i)}};var ey=b(av);const ny=3;function uI(s,i,l){s===1&&l.readMessage(cI,i)}function cI(s,i,l){if(s===3){const{id:f,bitmap:g,width:v,height:x,left:w,top:E,advance:L}=l.readMessage(hI,{});i.push({id:f,bitmap:new Zp({width:v+2*ny,height:x+2*ny},g),metrics:{width:v,height:x,left:w,top:E,advance:L}})}}function hI(s,i,l){s===1?i.id=l.readVarint():s===2?i.bitmap=l.readBytes():s===3?i.width=l.readVarint():s===4?i.height=l.readVarint():s===5?i.left=l.readSVarint():s===6?i.top=l.readSVarint():s===7&&(i.advance=l.readVarint())}const dv=ny;function mv(s){let i=0,l=0;for(const x of s)i+=x.w*x.h,l=Math.max(l,x.w);s.sort((x,w)=>w.h-x.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),l),h:1/0}];let g=0,v=0;for(const x of s)for(let w=f.length-1;w>=0;w--){const E=f[w];if(!(x.w>E.w||x.h>E.h)){if(x.x=E.x,x.y=E.y,v=Math.max(v,x.y+x.h),g=Math.max(g,x.x+x.w),x.w===E.w&&x.h===E.h){const L=f.pop();w<f.length&&(f[w]=L)}else x.h===E.h?(E.x+=x.w,E.w-=x.w):x.w===E.w?(E.y+=x.h,E.h-=x.h):(f.push({x:E.x+x.w,y:E.y,w:E.w-x.w,h:x.h}),E.y+=x.h,E.h-=x.h);break}}return{w:g,h:v,fill:i/(g*v)||0}}const mo=1;class ry{constructor(i,{pixelRatio:l,version:f,stretchX:g,stretchY:v,content:x}){this.paddedRect=i,this.pixelRatio=l,this.stretchX=g,this.stretchY=v,this.content=x,this.version=f}get tl(){return[this.paddedRect.x+mo,this.paddedRect.y+mo]}get br(){return[this.paddedRect.x+this.paddedRect.w-mo,this.paddedRect.y+this.paddedRect.h-mo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*mo)/this.pixelRatio,(this.paddedRect.h-2*mo)/this.pixelRatio]}}class gv{constructor(i,l){const f={},g={};this.haveRenderCallbacks=[];const v=[];this.addImages(i,f,v),this.addImages(l,g,v);const{w:x,h:w}=mv(v),E=new Xo({width:x||1,height:w||1});for(const L in i){const D=i[L],k=f[L].paddedRect;Xo.copy(D.data,E,{x:0,y:0},{x:k.x+mo,y:k.y+mo},D.data)}for(const L in l){const D=l[L],k=g[L].paddedRect,F=k.x+mo,V=k.y+mo,G=D.data.width,H=D.data.height;Xo.copy(D.data,E,{x:0,y:0},{x:F,y:V},D.data),Xo.copy(D.data,E,{x:0,y:H-1},{x:F,y:V-1},{width:G,height:1}),Xo.copy(D.data,E,{x:0,y:0},{x:F,y:V+H},{width:G,height:1}),Xo.copy(D.data,E,{x:G-1,y:0},{x:F-1,y:V},{width:1,height:H}),Xo.copy(D.data,E,{x:0,y:0},{x:F+G,y:V},{width:1,height:H})}this.image=E,this.iconPositions=f,this.patternPositions=g}addImages(i,l,f){for(const g in i){const v=i[g],x={x:0,y:0,w:v.data.width+2*mo,h:v.data.height+2*mo};f.push(x),l[g]=new ry(x,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(i,l){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),l),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),l)}patchUpdatedImage(i,l,f){if(!i||!l||i.version===l.version)return;i.version=l.version;const[g,v]=i.tl;f.update(l.data,void 0,{x:g,y:v})}}var jl;ce("ImagePosition",ry),ce("ImageAtlas",gv),p.ah=void 0,(jl=p.ah||(p.ah={}))[jl.none=0]="none",jl[jl.horizontal=1]="horizontal",jl[jl.vertical=2]="vertical",jl[jl.horizontalOnly=3]="horizontalOnly";const tf=-17;class ef{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,l){const f=new ef;return f.scale=i||1,f.fontStack=l,f}static forImage(i){const l=new ef;return l.imageName=i,l}}class uh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,l){const f=new uh;for(let g=0;g<i.sections.length;g++){const v=i.sections[g];v.image?f.addImageSection(v):f.addTextSection(v,l)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let l="";for(let f=0;f<i.length;f++){const g=i.charCodeAt(f+1)||null,v=i.charCodeAt(f-1)||null;l+=g&&Lp(g)&&!$p[i[f+1]]||v&&Lp(v)&&!$p[i[f-1]]||!$p[i[f]]?i[f]:$p[i[f]]}return l}(this.text)}trim(){let i=0;for(let f=0;f<this.text.length&&nm[this.text.charCodeAt(f)];f++)i++;let l=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&nm[this.text.charCodeAt(f)];f--)l--;this.text=this.text.substring(i,l),this.sectionIndex=this.sectionIndex.slice(i,l)}substring(i,l){const f=new uh;return f.text=this.text.substring(i,l),f.sectionIndex=this.sectionIndex.slice(i,l),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,l)=>Math.max(i,this.sections[l].scale),0)}addTextSection(i,l){this.text+=i.text,this.sections.push(ef.forText(i.scale,i.fontStack||l));const f=this.sections.length-1;for(let g=0;g<i.text.length;++g)this.sectionIndex.push(f)}addImageSection(i){const l=i.image?i.image.name:"";if(l.length===0)return void $t("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(ef.forImage(l)),this.sectionIndex.push(this.sections.length-1)):$t("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function em(s,i,l,f,g,v,x,w,E,L,D,k,F,V,G,H){const nt=uh.fromFeature(s,g);let lt;k===p.ah.vertical&&nt.verticalizePunctuation();const{processBidirectionalText:xt,processStyledBidirectionalText:ut}=wa;if(xt&&nt.sections.length===1){lt=[];const zt=xt(nt.toString(),iy(nt,L,v,i,f,V,G));for(const oe of zt){const fe=new uh;fe.text=oe,fe.sections=nt.sections;for(let ie=0;ie<oe.length;ie++)fe.sectionIndex.push(0);lt.push(fe)}}else if(ut){lt=[];const zt=ut(nt.text,nt.sectionIndex,iy(nt,L,v,i,f,V,G));for(const oe of zt){const fe=new uh;fe.text=oe[0],fe.sectionIndex=oe[1],fe.sections=nt.sections,lt.push(fe)}}else lt=function(zt,oe){const fe=[],ie=zt.text;let ee=0;for(const Ht of oe)fe.push(zt.substring(ee,Ht)),ee=Ht;return ee<ie.length&&fe.push(zt.substring(ee,ie.length)),fe}(nt,iy(nt,L,v,i,f,V,G));const mt=[],Rt={positionedLines:mt,text:nt.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:k,iconsInText:!1,verticalizable:!1};return function(zt,oe,fe,ie,ee,Ht,he,Jt,Gt,xe,de,Je){let Wn=0,Qn=tf,qr=0,Mo=0;const Zi=Jt==="right"?1:Jt==="left"?0:.5;let Nr=0;for(const jr of ee){jr.trim();const Wr=jr.getMaxScale(),Mi=(Wr-1)*Gr,Yi={positionedGlyphs:[],lineOffset:0};zt.positionedLines[Nr]=Yi;const Di=Yi.positionedGlyphs;let go=0;if(!jr.length()){Qn+=Ht,++Nr;continue}for(let Zr=0;Zr<jr.length();Zr++){const on=jr.getSection(Zr),ki=jr.getSectionIndex(Zr),_i=jr.getCharCode(Zr);let Hr=0,ws=null,Xs=null,Ys=null,ol=Gr;const Ss=!(Gt===p.ah.horizontal||!de&&!jc(_i)||de&&(nm[_i]||(ai=_i,re.Arabic(ai)||re["Arabic Supplement"](ai)||re["Arabic Extended-A"](ai)||re["Arabic Presentation Forms-A"](ai)||re["Arabic Presentation Forms-B"](ai))));if(on.imageName){const Ko=ie[on.imageName];if(!Ko)continue;Ys=on.imageName,zt.iconsInText=zt.iconsInText||!0,Xs=Ko.paddedRect;const _o=Ko.displaySize;on.scale=on.scale*Gr/Je,ws={width:_o[0],height:_o[1],left:mo,top:-dv,advance:Ss?_o[1]:_o[0]},Hr=Mi+(Gr-_o[1]*on.scale),ol=ws.advance;const sl=Ss?_o[0]*on.scale-Gr*Wr:_o[1]*on.scale-Gr*Wr;sl>0&&sl>go&&(go=sl)}else{const Ko=fe[on.fontStack],_o=Ko&&Ko[_i];if(_o&&_o.rect)Xs=_o.rect,ws=_o.metrics;else{const sl=oe[on.fontStack],af=sl&&sl[_i];if(!af)continue;ws=af.metrics}Hr=(Wr-on.scale)*Gr}Ss?(zt.verticalizable=!0,Di.push({glyph:_i,imageName:Ys,x:Wn,y:Qn+Hr,vertical:Ss,scale:on.scale,fontStack:on.fontStack,sectionIndex:ki,metrics:ws,rect:Xs}),Wn+=ol*on.scale+xe):(Di.push({glyph:_i,imageName:Ys,x:Wn,y:Qn+Hr,vertical:Ss,scale:on.scale,fontStack:on.fontStack,sectionIndex:ki,metrics:ws,rect:Xs}),Wn+=ws.advance*on.scale+xe)}Di.length!==0&&(qr=Math.max(Wn-xe,qr),dI(Di,0,Di.length-1,Zi,go)),Wn=0;const yo=Ht*Wr+go;Yi.lineOffset=Math.max(go,Mi),Qn+=yo,Mo=Math.max(yo,Mo),++Nr}var ai;const yi=Qn-tf,{horizontalAlign:Hi,verticalAlign:Xi}=oy(he);(function(jr,Wr,Mi,Yi,Di,go,yo,Zr,on){const ki=(Wr-Mi)*Di;let _i=0;_i=go!==yo?-Zr*Yi-tf:(-Yi*on+.5)*yo;for(const Hr of jr)for(const ws of Hr.positionedGlyphs)ws.x+=ki,ws.y+=_i})(zt.positionedLines,Zi,Hi,Xi,qr,Mo,Ht,yi,ee.length),zt.top+=-Xi*yi,zt.bottom=zt.top+yi,zt.left+=-Hi*qr,zt.right=zt.left+qr}(Rt,i,l,f,lt,x,w,E,k,L,F,H),!function(zt){for(const oe of zt)if(oe.positionedGlyphs.length!==0)return!1;return!0}(mt)&&Rt}const nm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},pI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function yv(s,i,l,f,g,v){if(i.imageName){const x=f[i.imageName];return x?x.displaySize[0]*i.scale*Gr/v+g:0}{const x=l[i.fontStack],w=x&&x[s];return w?w.metrics.advance*i.scale+g:0}}function _v(s,i,l,f){const g=Math.pow(s-i,2);return f?s<i?g/2:2*g:g+Math.abs(l)*l}function fI(s,i,l){let f=0;return s===10&&(f-=1e4),l&&(f+=150),s!==40&&s!==65288||(f+=50),i!==41&&i!==65289||(f+=50),f}function vv(s,i,l,f,g,v){let x=null,w=_v(i,l,g,v);for(const E of f){const L=_v(i-E.x,l,g,v)+E.badness;L<=w&&(x=E,w=L)}return{index:s,x:i,priorBreak:x,badness:w}}function xv(s){return s?xv(s.priorBreak).concat(s.index):[]}function iy(s,i,l,f,g,v,x){if(v!=="point")return[];if(!s)return[];const w=[],E=function(F,V,G,H,nt,lt){let xt=0;for(let ut=0;ut<F.length();ut++){const mt=F.getSection(ut);xt+=yv(F.getCharCode(ut),mt,H,nt,V,lt)}return xt/Math.max(1,Math.ceil(xt/G))}(s,i,l,f,g,x),L=s.text.indexOf("​")>=0;let D=0;for(let F=0;F<s.length();F++){const V=s.getSection(F),G=s.getCharCode(F);if(nm[G]||(D+=yv(G,V,f,g,i,x)),F<s.length()-1){const H=!((k=G)<11904||!(re["Bopomofo Extended"](k)||re.Bopomofo(k)||re["CJK Compatibility Forms"](k)||re["CJK Compatibility Ideographs"](k)||re["CJK Compatibility"](k)||re["CJK Radicals Supplement"](k)||re["CJK Strokes"](k)||re["CJK Symbols and Punctuation"](k)||re["CJK Unified Ideographs Extension A"](k)||re["CJK Unified Ideographs"](k)||re["Enclosed CJK Letters and Months"](k)||re["Halfwidth and Fullwidth Forms"](k)||re.Hiragana(k)||re["Ideographic Description Characters"](k)||re["Kangxi Radicals"](k)||re["Katakana Phonetic Extensions"](k)||re.Katakana(k)||re["Vertical Forms"](k)||re["Yi Radicals"](k)||re["Yi Syllables"](k)));(pI[G]||H||V.imageName)&&w.push(vv(F+1,D,E,w,fI(G,s.getCharCode(F+1),H&&L),!1))}}var k;return xv(vv(s.length(),D,E,w,0,!0))}function oy(s){let i=.5,l=.5;switch(s){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:i,verticalAlign:l}}function dI(s,i,l,f,g){if(!f&&!g)return;const v=s[l],x=(s[l].x+v.metrics.advance*v.scale)*f;for(let w=i;w<=l;w++)s[w].x-=x,s[w].y+=g}function mI(s,i,l){const{horizontalAlign:f,verticalAlign:g}=oy(l),v=i[0]-s.displaySize[0]*f,x=i[1]-s.displaySize[1]*g;return{image:s,top:x,bottom:x+s.displaySize[1],left:v,right:v+s.displaySize[0]}}function bv(s,i,l,f,g,v){const x=s.image;let w;if(x.content){const nt=x.content,lt=x.pixelRatio||1;w=[nt[0]/lt,nt[1]/lt,x.displaySize[0]-nt[2]/lt,x.displaySize[1]-nt[3]/lt]}const E=i.left*v,L=i.right*v;let D,k,F,V;l==="width"||l==="both"?(V=g[0]+E-f[3],k=g[0]+L+f[1]):(V=g[0]+(E+L-x.displaySize[0])/2,k=V+x.displaySize[0]);const G=i.top*v,H=i.bottom*v;return l==="height"||l==="both"?(D=g[1]+G-f[0],F=g[1]+H+f[2]):(D=g[1]+(G+H-x.displaySize[1])/2,F=D+x.displaySize[1]),{image:x,top:D,right:k,bottom:F,left:V,collisionPadding:w}}const nf=255,Ca=128,Wl=nf*Ca;function wv(s,i){const{expression:l}=i;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new Kn(s+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:g}=l;let v=0;for(;v<f.length&&f[v]<=s;)v++;v=Math.max(0,v-1);let x=v;for(;x<f.length&&f[x]<s+1;)x++;x=Math.min(f.length-1,x);const w=f[v],E=f[x];return l.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:E,interpolationType:g}:{kind:"camera",minZoom:w,maxZoom:E,minSize:l.evaluate(new Kn(w)),maxSize:l.evaluate(new Kn(E)),interpolationType:g}}}function sy(s,i,l){let f="never";const g=s.get(i);return g?f=g:s.get(l)&&(f="always"),f}const gI=ql.VectorTileFeature.types,yI=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function rm(s,i,l,f,g,v,x,w,E,L,D,k,F){const V=w?Math.min(Wl,Math.round(w[0])):0,G=w?Math.min(Wl,Math.round(w[1])):0;s.emplaceBack(i,l,Math.round(32*f),Math.round(32*g),v,x,(V<<1)+(E?1:0),G,16*L,16*D,256*k,256*F)}function ay(s,i,l){s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l),s.emplaceBack(i.x,i.y,l)}function _I(s){for(const i of s.sections)if(Fg(i.text))return!0;return!1}class ly{constructor(i){this.layoutVertexArray=new It,this.indexArray=new kt,this.programConfigurations=i,this.segments=new Xt,this.dynamicLayoutVertexArray=new st,this.opacityVertexArray=new _t,this.hasVisibleVertices=!1,this.placedSymbolArray=new h}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,l,f,g){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,YS.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,KS.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,yI,!0),this.opacityVertexBuffer.itemSize=1),(f||g)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}ce("SymbolBuffers",ly);class uy{constructor(i,l,f){this.layoutVertexArray=new i,this.layoutAttributes=l,this.indexArray=new f,this.segments=new Xt,this.collisionVertexArray=new At}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,JS.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}ce("CollisionBuffers",uy);class ch{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(x=>x.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Vg([]),this.placementViewportMatrix=Vg([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wv(this.zoom,l["text-size"]),this.iconSizeData=wv(this.zoom,l["icon-size"]);const f=this.layers[0].layout,g=f.get("symbol-sort-key"),v=f.get("symbol-z-order");this.canOverlap=sy(f,"text-overlap","text-allow-overlap")!=="never"||sy(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(x=>p.ah[x])),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=i.sourceID}createArrays(){this.text=new ly(new sr(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new ly(new sr(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new _,this.lineVertexArray=new S,this.symbolInstances=new m,this.textAnchorOffsets=new T}calculateGlyphDependencies(i,l,f,g,v){for(let x=0;x<i.length;x++)if(l[i.charCodeAt(x)]=!0,(f||g)&&v){const w=$p[i.charAt(x)];w&&(l[w.charCodeAt(0)]=!0)}}populate(i,l,f){const g=this.layers[0],v=g.layout,x=v.get("text-font"),w=v.get("text-field"),E=v.get("icon-image"),L=(w.value.kind!=="constant"||w.value.value instanceof uo&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(x.value.kind!=="constant"||x.value.value.length>0),D=E.value.kind!=="constant"||!!E.value.value||Object.keys(E.parameters).length>0,k=v.get("symbol-sort-key");if(this.features=[],!L&&!D)return;const F=l.iconDependencies,V=l.glyphDependencies,G=l.availableImages,H=new Kn(this.zoom);for(const{feature:nt,id:lt,index:xt,sourceLayerIndex:ut}of i){const mt=g._featureFilter.needGeometry,Rt=rl(nt,mt);if(!g._featureFilter.filter(H,Rt,f))continue;let zt,oe;if(mt||(Rt.geometry=nl(nt)),L){const ie=g.getValueAndResolveTokens("text-field",Rt,f,G),ee=uo.factory(ie),Ht=this.hasRTLText=this.hasRTLText||_I(ee);(!Ht||wa.getRTLTextPluginStatus()==="unavailable"||Ht&&wa.isParsed())&&(zt=$S(ee,g,Rt))}if(D){const ie=g.getValueAndResolveTokens("icon-image",Rt,f,G);oe=ie instanceof Lo?ie:Lo.fromString(ie)}if(!zt&&!oe)continue;const fe=this.sortFeaturesByKey?k.evaluate(Rt,{},f):void 0;if(this.features.push({id:lt,text:zt,icon:oe,index:xt,sourceLayerIndex:ut,geometry:Rt.geometry,properties:nt.properties,type:gI[nt.type],sortKey:fe}),oe&&(F[oe.name]=!0),zt){const ie=x.evaluate(Rt,{},f).join(","),ee=v.get("text-rotation-alignment")!=="viewport"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(p.ah.vertical)>=0;for(const Ht of zt.sections)if(Ht.image)F[Ht.image.name]=!0;else{const he=Ul(zt.toString()),Jt=Ht.fontStack||ie,Gt=V[Jt]=V[Jt]||{};this.calculateGlyphDependencies(Ht.text,Gt,ee,this.allowVerticalPlacement,he)}}}v.get("symbol-placement")==="line"&&(this.features=function(nt){const lt={},xt={},ut=[];let mt=0;function Rt(ie){ut.push(nt[ie]),mt++}function zt(ie,ee,Ht){const he=xt[ie];return delete xt[ie],xt[ee]=he,ut[he].geometry[0].pop(),ut[he].geometry[0]=ut[he].geometry[0].concat(Ht[0]),he}function oe(ie,ee,Ht){const he=lt[ee];return delete lt[ee],lt[ie]=he,ut[he].geometry[0].shift(),ut[he].geometry[0]=Ht[0].concat(ut[he].geometry[0]),he}function fe(ie,ee,Ht){const he=Ht?ee[0][ee[0].length-1]:ee[0][0];return`${ie}:${he.x}:${he.y}`}for(let ie=0;ie<nt.length;ie++){const ee=nt[ie],Ht=ee.geometry,he=ee.text?ee.text.toString():null;if(!he){Rt(ie);continue}const Jt=fe(he,Ht),Gt=fe(he,Ht,!0);if(Jt in xt&&Gt in lt&&xt[Jt]!==lt[Gt]){const xe=oe(Jt,Gt,Ht),de=zt(Jt,Gt,ut[xe].geometry);delete lt[Jt],delete xt[Gt],xt[fe(he,ut[de].geometry,!0)]=de,ut[xe].geometry=null}else Jt in xt?zt(Jt,Gt,Ht):Gt in lt?oe(Jt,Gt,Ht):(Rt(ie),lt[Jt]=mt-1,xt[Gt]=mt-1)}return ut.filter(ie=>ie.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((nt,lt)=>nt.sortKey-lt.sortKey)}update(i,l,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,l,this.layers,f),this.icon.programConfigurations.updatePaintArrays(i,l,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,l){const f=this.lineVertexArray.length;if(i.segment!==void 0){let g=i.dist(l[i.segment+1]),v=i.dist(l[i.segment]);const x={};for(let w=i.segment+1;w<l.length;w++)x[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:g},w<l.length-1&&(g+=l[w+1].dist(l[w]));for(let w=i.segment||0;w>=0;w--)x[w]={x:l[w].x,y:l[w].y,tileUnitDistanceFromAnchor:v},w>0&&(v+=l[w-1].dist(l[w]));for(let w=0;w<l.length;w++){const E=x[w];this.lineVertexArray.emplaceBack(E.x,E.y,E.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,l,f,g,v,x,w,E,L,D,k,F){const V=i.indexArray,G=i.layoutVertexArray,H=i.segments.prepareSegment(4*l.length,G,V,this.canOverlap?x.sortKey:void 0),nt=this.glyphOffsetArray.length,lt=H.vertexLength,xt=this.allowVerticalPlacement&&w===p.ah.vertical?Math.PI/2:0,ut=x.text&&x.text.sections;for(let mt=0;mt<l.length;mt++){const{tl:Rt,tr:zt,bl:oe,br:fe,tex:ie,pixelOffsetTL:ee,pixelOffsetBR:Ht,minFontScaleX:he,minFontScaleY:Jt,glyphOffset:Gt,isSDF:xe,sectionIndex:de}=l[mt],Je=H.vertexLength,Wn=Gt[1];rm(G,E.x,E.y,Rt.x,Wn+Rt.y,ie.x,ie.y,f,xe,ee.x,ee.y,he,Jt),rm(G,E.x,E.y,zt.x,Wn+zt.y,ie.x+ie.w,ie.y,f,xe,Ht.x,ee.y,he,Jt),rm(G,E.x,E.y,oe.x,Wn+oe.y,ie.x,ie.y+ie.h,f,xe,ee.x,Ht.y,he,Jt),rm(G,E.x,E.y,fe.x,Wn+fe.y,ie.x+ie.w,ie.y+ie.h,f,xe,Ht.x,Ht.y,he,Jt),ay(i.dynamicLayoutVertexArray,E,xt),V.emplaceBack(Je,Je+1,Je+2),V.emplaceBack(Je+1,Je+2,Je+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Gt[0]),mt!==l.length-1&&de===l[mt+1].sectionIndex||i.programConfigurations.populatePaintArrays(G.length,x,x.index,{},F,ut&&ut[de])}i.placedSymbolArray.emplaceBack(E.x,E.y,nt,this.glyphOffsetArray.length-nt,lt,L,D,E.segment,f?f[0]:0,f?f[1]:0,g[0],g[1],w,0,!1,0,k)}_addCollisionDebugVertex(i,l,f,g,v,x){return l.emplaceBack(0,0),i.emplaceBack(f.x,f.y,g,v,Math.round(x.x),Math.round(x.y))}addCollisionDebugVertices(i,l,f,g,v,x,w){const E=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),L=E.vertexLength,D=v.layoutVertexArray,k=v.collisionVertexArray,F=w.anchorX,V=w.anchorY;this._addCollisionDebugVertex(D,k,x,F,V,new P(i,l)),this._addCollisionDebugVertex(D,k,x,F,V,new P(f,l)),this._addCollisionDebugVertex(D,k,x,F,V,new P(f,g)),this._addCollisionDebugVertex(D,k,x,F,V,new P(i,g)),E.vertexLength+=4;const G=v.indexArray;G.emplaceBack(L,L+1),G.emplaceBack(L+1,L+2),G.emplaceBack(L+2,L+3),G.emplaceBack(L+3,L),E.primitiveLength+=4}addDebugCollisionBoxes(i,l,f,g){for(let v=i;v<l;v++){const x=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(x.x1,x.y1,x.x2,x.y2,g?this.textCollisionBox:this.iconCollisionBox,x.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new uy(Ct,sv.members,Vt),this.iconCollisionBox=new uy(Ct,sv.members,Vt);for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(i,l,f,g,v,x,w,E,L){const D={};for(let k=l;k<f;k++){const F=i.get(k);D.textBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},D.textFeatureIndex=F.featureIndex;break}for(let k=g;k<v;k++){const F=i.get(k);D.verticalTextBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},D.verticalTextFeatureIndex=F.featureIndex;break}for(let k=x;k<w;k++){const F=i.get(k);D.iconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},D.iconFeatureIndex=F.featureIndex;break}for(let k=E;k<L;k++){const F=i.get(k);D.verticalIconBox={x1:F.x1,y1:F.y1,x2:F.x2,y2:F.y2,anchorPointX:F.anchorPointX,anchorPointY:F.anchorPointY},D.verticalIconFeatureIndex=F.featureIndex;break}return D}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const f=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,l){const f=i.placedSymbolArray.get(l),g=f.vertexStartIndex+4*f.numGlyphs;for(let v=f.vertexStartIndex;v<g;v+=4)i.indexArray.emplaceBack(v,v+1,v+2),i.indexArray.emplaceBack(v+1,v+2,v+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(i),f=Math.cos(i),g=[],v=[],x=[];for(let w=0;w<this.symbolInstances.length;++w){x.push(w);const E=this.symbolInstances.get(w);g.push(0|Math.round(l*E.anchorX+f*E.anchorY)),v.push(E.featureIndex)}return x.sort((w,E)=>g[w]-g[E]||v[E]-v[w]),x}addToSortKeyRanges(i,l){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===l?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const f=this.symbolInstances.get(l);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((g,v,x)=>{g>=0&&x.indexOf(g)===v&&this.addIndicesForPlacedSymbol(this.text,g)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let Sv,Iv;ce("SymbolBucket",ch,{omit:["layers","collisionBoxArray","features","compareText"]}),ch.MAX_GLYPHS=65535,ch.addDynamicAttributes=ay;var cy={get paint(){return Iv=Iv||new ji({"icon-opacity":new we(Lt.paint_symbol["icon-opacity"]),"icon-color":new we(Lt.paint_symbol["icon-color"]),"icon-halo-color":new we(Lt.paint_symbol["icon-halo-color"]),"icon-halo-width":new we(Lt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new we(Lt.paint_symbol["icon-halo-blur"]),"icon-translate":new me(Lt.paint_symbol["icon-translate"]),"icon-translate-anchor":new me(Lt.paint_symbol["icon-translate-anchor"]),"text-opacity":new we(Lt.paint_symbol["text-opacity"]),"text-color":new we(Lt.paint_symbol["text-color"],{runtimeType:Pr,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new we(Lt.paint_symbol["text-halo-color"]),"text-halo-width":new we(Lt.paint_symbol["text-halo-width"]),"text-halo-blur":new we(Lt.paint_symbol["text-halo-blur"]),"text-translate":new me(Lt.paint_symbol["text-translate"]),"text-translate-anchor":new me(Lt.paint_symbol["text-translate-anchor"])})},get layout(){return Sv=Sv||new ji({"symbol-placement":new me(Lt.layout_symbol["symbol-placement"]),"symbol-spacing":new me(Lt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new me(Lt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new we(Lt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new me(Lt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new me(Lt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new me(Lt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new me(Lt.layout_symbol["icon-ignore-placement"]),"icon-optional":new me(Lt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new me(Lt.layout_symbol["icon-rotation-alignment"]),"icon-size":new we(Lt.layout_symbol["icon-size"]),"icon-text-fit":new me(Lt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new me(Lt.layout_symbol["icon-text-fit-padding"]),"icon-image":new we(Lt.layout_symbol["icon-image"]),"icon-rotate":new we(Lt.layout_symbol["icon-rotate"]),"icon-padding":new we(Lt.layout_symbol["icon-padding"]),"icon-keep-upright":new me(Lt.layout_symbol["icon-keep-upright"]),"icon-offset":new we(Lt.layout_symbol["icon-offset"]),"icon-anchor":new we(Lt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new me(Lt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new me(Lt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new me(Lt.layout_symbol["text-rotation-alignment"]),"text-field":new we(Lt.layout_symbol["text-field"]),"text-font":new we(Lt.layout_symbol["text-font"]),"text-size":new we(Lt.layout_symbol["text-size"]),"text-max-width":new we(Lt.layout_symbol["text-max-width"]),"text-line-height":new me(Lt.layout_symbol["text-line-height"]),"text-letter-spacing":new we(Lt.layout_symbol["text-letter-spacing"]),"text-justify":new we(Lt.layout_symbol["text-justify"]),"text-radial-offset":new we(Lt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new me(Lt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new we(Lt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new we(Lt.layout_symbol["text-anchor"]),"text-max-angle":new me(Lt.layout_symbol["text-max-angle"]),"text-writing-mode":new me(Lt.layout_symbol["text-writing-mode"]),"text-rotate":new we(Lt.layout_symbol["text-rotate"]),"text-padding":new me(Lt.layout_symbol["text-padding"]),"text-keep-upright":new me(Lt.layout_symbol["text-keep-upright"]),"text-transform":new we(Lt.layout_symbol["text-transform"]),"text-offset":new we(Lt.layout_symbol["text-offset"]),"text-allow-overlap":new me(Lt.layout_symbol["text-allow-overlap"]),"text-overlap":new me(Lt.layout_symbol["text-overlap"]),"text-ignore-placement":new me(Lt.layout_symbol["text-ignore-placement"]),"text-optional":new me(Lt.layout_symbol["text-optional"])})}};class Ev{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:di,this.defaultValue=i}evaluate(i){if(i.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(i.formattedSection))return l.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ce("FormatSectionOverride",Ev,{omit:["defaultValue"]});class im extends Ho{constructor(i){super(i,cy)}recalculate(i,l){if(super.recalculate(i,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const g=[];for(const v of f)g.indexOf(v)<0&&g.push(v);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,l,f,g){const v=this.layout.get(i).evaluate(l,{},f,g),x=this._unevaluatedLayout._values[i];return x.isDataDriven()||Bn(x.value)||!v?v:function(w,E){return E.replace(/{([^{}]+)}/g,(L,D)=>w&&D in w?String(w[D]):"")}(l.properties,v)}createBucket(i){return new ch(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of cy.paint.overridableProperties){if(!im.hasPaintOverride(this.layout,i))continue;const l=this.paint.get(i),f=new Ev(l),g=new jn(f,l.property.specification);let v=null;v=l.value.kind==="constant"||l.value.kind==="source"?new kc("source",g):new vp("composite",g,l.value.zoomStops),this.paint._values[i]=new Zo(l.property,v,l.parameters)}}_handleOverridablePaintPropertyUpdate(i,l,f){return!(!this.layout||l.isDataDriven()||f.isDataDriven())&&im.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,l){const f=i.get("text-field"),g=cy.paint.properties[l];let v=!1;const x=w=>{for(const E of w)if(g.overrides&&g.overrides.hasOverride(E))return void(v=!0)};if(f.value.kind==="constant"&&f.value.value instanceof uo)x(f.value.value.sections);else if(f.value.kind==="source"){const w=L=>{v||(L instanceof ya&&Mr(L.value)===Fr?x(L.value.sections):L instanceof Mc?x(L.sections):L.eachChild(w))},E=f.value;E._styleExpression&&w(E._styleExpression.expression)}return v}}let Cv;var vI={get paint(){return Cv=Cv||new ji({"background-color":new me(Lt.paint_background["background-color"]),"background-pattern":new ku(Lt.paint_background["background-pattern"]),"background-opacity":new me(Lt.paint_background["background-opacity"])})}};class xI extends Ho{constructor(i){super(i,vI)}}let Tv;var bI={get paint(){return Tv=Tv||new ji({"raster-opacity":new me(Lt.paint_raster["raster-opacity"]),"raster-hue-rotate":new me(Lt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new me(Lt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new me(Lt.paint_raster["raster-brightness-max"]),"raster-saturation":new me(Lt.paint_raster["raster-saturation"]),"raster-contrast":new me(Lt.paint_raster["raster-contrast"]),"raster-resampling":new me(Lt.paint_raster["raster-resampling"]),"raster-fade-duration":new me(Lt.paint_raster["raster-fade-duration"])})}};class wI extends Ho{constructor(i){super(i,bI)}}class SI extends Ho{constructor(i){super(i,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class II{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const hy=63710088e-1;class Zl{constructor(i,l){if(isNaN(i)||isNaN(l))throw new Error(`Invalid LngLat object: (${i}, ${l})`);if(this.lng=+i,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Zl(Pt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const l=Math.PI/180,f=this.lat*l,g=i.lat*l,v=Math.sin(f)*Math.sin(g)+Math.cos(f)*Math.cos(g)*Math.cos((i.lng-this.lng)*l);return hy*Math.acos(Math.min(v,1))}static convert(i){if(i instanceof Zl)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Zl(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Zl(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Lv=2*Math.PI*hy;function Pv(s){return Lv*Math.cos(s*Math.PI/180)}function Av(s){return(180+s)/360}function Mv(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function Dv(s,i){return s/Pv(i)}function py(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class om{constructor(i,l,f=0){this.x=+i,this.y=+l,this.z=+f}static fromLngLat(i,l=0){const f=Zl.convert(i);return new om(Av(f.lng),Mv(f.lat),Dv(l,f.lat))}toLngLat(){return new Zl(360*this.x-180,py(this.y))}toAltitude(){return this.z*Pv(py(this.y))}meterInMercatorCoordinateUnits(){return 1/Lv*(i=py(this.y),1/Math.cos(i*Math.PI/180));var i}}function kv(s,i,l){var f=2*Math.PI*6378137/256/Math.pow(2,l);return[s*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class fy{constructor(i,l,f){if(i<0||i>25||f<0||f>=Math.pow(2,i)||l<0||l>=Math.pow(2,i))throw new Error(`x=${l}, y=${f}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=l,this.y=f,this.key=rf(0,i,i,l,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,l,f){const g=(x=this.y,w=this.z,E=kv(256*(v=this.x),256*(x=Math.pow(2,w)-x-1),w),L=kv(256*(v+1),256*(x+1),w),E[0]+","+E[1]+","+L[0]+","+L[1]);var v,x,w,E,L;const D=function(k,F,V){let G,H="";for(let nt=k;nt>0;nt--)G=1<<nt-1,H+=(F&G?1:0)+(V&G?2:0);return H}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,D).replace(/{bbox-epsg-3857}/g,g)}isChildOf(i){const l=this.z-i.z;return l>0&&i.x===this.x>>l&&i.y===this.y>>l}getTilePoint(i){const l=Math.pow(2,this.z);return new P((i.x*l-this.x)*yr,(i.y*l-this.y)*yr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Rv{constructor(i,l){this.wrap=i,this.canonical=l,this.key=rf(i,l.z,l.z,l.x,l.y)}}class Yo{constructor(i,l,f,g,v){if(i<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${f}`);this.overscaledZ=i,this.wrap=l,this.canonical=new fy(f,+g,+v),this.key=rf(l,i,f,g,v)}clone(){return new Yo(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-i;return i>this.canonical.z?new Yo(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yo(i,this.wrap,i,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(i,l){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-i;return i>this.canonical.z?rf(this.wrap*+l,i,this.canonical.z,this.canonical.x,this.canonical.y):rf(this.wrap*+l,i,i,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const l=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>l&&i.canonical.y===this.canonical.y>>l}children(i){if(this.overscaledZ>=i)return[new Yo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,f=2*this.canonical.x,g=2*this.canonical.y;return[new Yo(l,this.wrap,l,f,g),new Yo(l,this.wrap,l,f+1,g),new Yo(l,this.wrap,l,f,g+1),new Yo(l,this.wrap,l,f+1,g+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new Yo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new Yo(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Rv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new om(i.x-this.wrap,i.y))}}function rf(s,i,l,f,g){(s*=2)<0&&(s=-1*s-1);const v=1<<l;return(v*v*s+v*g+f).toString(36)+l.toString(36)+i.toString(36)}ce("CanonicalTileID",fy),ce("OverscaledTileID",Yo,{omit:["posMatrix"]});class Nv{constructor(i,l,f,g=1,v=1,x=1,w=0){if(this.uid=i,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void $t(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const E=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=v,this.blueFactor=x,this.baseShift=w;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let L=0;L<E;L++)this.data[this._idx(-1,L)]=this.data[this._idx(0,L)],this.data[this._idx(E,L)]=this.data[this._idx(E-1,L)],this.data[this._idx(L,-1)]=this.data[this._idx(L,0)],this.data[this._idx(L,E)]=this.data[this._idx(L,E-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(E,-1)]=this.data[this._idx(E-1,0)],this.data[this._idx(-1,E)]=this.data[this._idx(0,E-1)],this.data[this._idx(E,E)]=this.data[this._idx(E-1,E-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let L=0;L<E;L++)for(let D=0;D<E;D++){const k=this.get(L,D);k>this.max&&(this.max=k),k<this.min&&(this.min=k)}}get(i,l){const f=new Uint8Array(this.data.buffer),g=4*this._idx(i,l);return this.unpack(f[g],f[g+1],f[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,l){if(i<-1||i>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(i+1)}unpack(i,l,f){return i*this.redFactor+l*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new Xo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,l,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,v=l*this.dim+this.dim,x=f*this.dim,w=f*this.dim+this.dim;switch(l){case-1:g=v-1;break;case 1:v=g+1}switch(f){case-1:x=w-1;break;case 1:w=x+1}const E=-l*this.dim,L=-f*this.dim;for(let D=x;D<w;D++)for(let k=g;k<v;k++)this.data[this._idx(k,D)]=i.data[this._idx(k+E,D+L)]}}ce("DEMData",Nv);class Ov{constructor(i){this._stringToNumber={},this._numberToString=[];for(let l=0;l<i.length;l++){const f=i[l];this._stringToNumber[f]=l,this._numberToString[l]=f}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class zv{constructor(i,l,f,g,v){this.type="Feature",this._vectorTileFeature=i,i._z=l,i._x=f,i._y=g,this.properties=i.properties,this.id=v}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(i[l]=this[l]);return i}}class Fv{constructor(i,l){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Au(yr,16,0),this.grid3D=new Au(yr,16,0),this.featureIndexArray=new N,this.promoteId=l}insert(i,l,f,g,v,x){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,g,v);const E=x?this.grid3D:this.grid;for(let L=0;L<l.length;L++){const D=l[L],k=[1/0,1/0,-1/0,-1/0];for(let F=0;F<D.length;F++){const V=D[F];k[0]=Math.min(k[0],V.x),k[1]=Math.min(k[1],V.y),k[2]=Math.max(k[2],V.x),k[3]=Math.max(k[3],V.y)}k[0]<yr&&k[1]<yr&&k[2]>=0&&k[3]>=0&&E.insert(w,k[0],k[1],k[2],k[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ql.VectorTile(new ey(this.rawTileData)).layers,this.sourceLayerCoder=new Ov(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,l,f,g){this.loadVTLayers();const v=i.params||{},x=yr/i.tileSize/i.scale,w=zc(v.filter),E=i.queryGeometry,L=i.queryPadding*x,D=Vv(E),k=this.grid.query(D.minX-L,D.minY-L,D.maxX+L,D.maxY+L),F=Vv(i.cameraQueryGeometry),V=this.grid3D.query(F.minX-L,F.minY-L,F.maxX+L,F.maxY+L,(nt,lt,xt,ut)=>function(mt,Rt,zt,oe,fe){for(const ee of mt)if(Rt<=ee.x&&zt<=ee.y&&oe>=ee.x&&fe>=ee.y)return!0;const ie=[new P(Rt,zt),new P(Rt,fe),new P(oe,fe),new P(oe,zt)];if(mt.length>2){for(const ee of ie)if(rh(mt,ee))return!0}for(let ee=0;ee<mt.length-1;ee++)if(nS(mt[ee],mt[ee+1],ie))return!0;return!1}(i.cameraQueryGeometry,nt-L,lt-L,xt+L,ut+L));for(const nt of V)k.push(nt);k.sort(EI);const G={};let H;for(let nt=0;nt<k.length;nt++){const lt=k[nt];if(lt===H)continue;H=lt;const xt=this.featureIndexArray.get(lt);let ut=null;this.loadMatchingFeature(G,xt.bucketIndex,xt.sourceLayerIndex,xt.featureIndex,w,v.layers,v.availableImages,l,f,g,(mt,Rt,zt)=>(ut||(ut=nl(mt)),Rt.queryIntersectsFeature(E,mt,zt,ut,this.z,i.transform,x,i.pixelPosMatrix)))}return G}loadMatchingFeature(i,l,f,g,v,x,w,E,L,D,k){const F=this.bucketLayerIDs[l];if(x&&!function(nt,lt){for(let xt=0;xt<nt.length;xt++)if(lt.indexOf(nt[xt])>=0)return!0;return!1}(x,F))return;const V=this.sourceLayerCoder.decode(f),G=this.vtLayers[V].feature(g);if(v.needGeometry){const nt=rl(G,!0);if(!v.filter(new Kn(this.tileID.overscaledZ),nt,this.tileID.canonical))return}else if(!v.filter(new Kn(this.tileID.overscaledZ),G))return;const H=this.getId(G,V);for(let nt=0;nt<F.length;nt++){const lt=F[nt];if(x&&x.indexOf(lt)<0)continue;const xt=E[lt];if(!xt)continue;let ut={};H&&D&&(ut=D.getState(xt.sourceLayer||"_geojsonTileLayer",H));const mt=Mt({},L[lt]);mt.paint=Bv(mt.paint,xt.paint,G,ut,w),mt.layout=Bv(mt.layout,xt.layout,G,ut,w);const Rt=!k||k(G,xt,ut);if(!Rt)continue;const zt=new zv(G,this.z,this.x,this.y,H);zt.layer=mt;let oe=i[lt];oe===void 0&&(oe=i[lt]=[]),oe.push({featureIndex:g,feature:zt,intersectionZ:Rt})}}lookupSymbolFeatures(i,l,f,g,v,x,w,E){const L={};this.loadVTLayers();const D=zc(v);for(const k of i)this.loadMatchingFeature(L,f,g,k,D,x,w,E,l);return L}hasLayer(i){for(const l of this.bucketLayerIDs)for(const f of l)if(i===f)return!0;return!1}getId(i,l){let f=i.id;return this.promoteId&&(f=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof f=="boolean"&&(f=Number(f))),f}}function Bv(s,i,l,f,g){return Ut(s,(v,x)=>{const w=i instanceof Du?i.get(x):null;return w&&w.evaluate?w.evaluate(l,f,g):w})}function Vv(s){let i=1/0,l=1/0,f=-1/0,g=-1/0;for(const v of s)i=Math.min(i,v.x),l=Math.min(l,v.y),f=Math.max(f,v.x),g=Math.max(g,v.y);return{minX:i,minY:l,maxX:f,maxY:g}}function EI(s,i){return i-s}function Uv(s,i,l,f,g){const v=[];for(let x=0;x<s.length;x++){const w=s[x];let E;for(let L=0;L<w.length-1;L++){let D=w[L],k=w[L+1];D.x<i&&k.x<i||(D.x<i?D=new P(i,D.y+(i-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x<i&&(k=new P(i,D.y+(i-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y<l&&k.y<l||(D.y<l?D=new P(D.x+(l-D.y)/(k.y-D.y)*(k.x-D.x),l)._round():k.y<l&&(k=new P(D.x+(l-D.y)/(k.y-D.y)*(k.x-D.x),l)._round()),D.x>=f&&k.x>=f||(D.x>=f?D=new P(f,D.y+(f-D.x)/(k.x-D.x)*(k.y-D.y))._round():k.x>=f&&(k=new P(f,D.y+(f-D.x)/(k.x-D.x)*(k.y-D.y))._round()),D.y>=g&&k.y>=g||(D.y>=g?D=new P(D.x+(g-D.y)/(k.y-D.y)*(k.x-D.x),g)._round():k.y>=g&&(k=new P(D.x+(g-D.y)/(k.y-D.y)*(k.x-D.x),g)._round()),E&&D.equals(E[E.length-1])||(E=[D],v.push(E)),E.push(k)))))}}return v}ce("FeatureIndex",Fv,{omit:["rawTileData","sourceLayerCoder"]});class Hl extends P{constructor(i,l,f,g){super(i,l),this.angle=f,g!==void 0&&(this.segment=g)}clone(){return new Hl(this.x,this.y,this.angle,this.segment)}}function Gv(s,i,l,f,g){if(i.segment===void 0||l===0)return!0;let v=i,x=i.segment+1,w=0;for(;w>-l/2;){if(x--,x<0)return!1;w-=s[x].dist(v),v=s[x]}w+=s[x].dist(s[x+1]),x++;const E=[];let L=0;for(;w<l/2;){const D=s[x],k=s[x+1];if(!k)return!1;let F=s[x-1].angleTo(D)-D.angleTo(k);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:w,angleDelta:F}),L+=F;w-E[0].distance>f;)L-=E.shift().angleDelta;if(L>g)return!1;x++,w+=D.dist(k)}return!0}function qv(s){let i=0;for(let l=0;l<s.length-1;l++)i+=s[l].dist(s[l+1]);return i}function jv(s,i,l){return s?.6*i*l:0}function Wv(s,i){return Math.max(s?s.right-s.left:0,i?i.right-i.left:0)}function CI(s,i,l,f,g,v){const x=jv(l,g,v),w=Wv(l,f)*v;let E=0;const L=qv(s)/2;for(let D=0;D<s.length-1;D++){const k=s[D],F=s[D+1],V=k.dist(F);if(E+V>L){const G=(L-E)/V,H=Pi.number(k.x,F.x,G),nt=Pi.number(k.y,F.y,G),lt=new Hl(H,nt,F.angleTo(k),D);return lt._round(),!x||Gv(s,lt,w,x,i)?lt:void 0}E+=V}}function TI(s,i,l,f,g,v,x,w,E){const L=jv(f,v,x),D=Wv(f,g),k=D*x,F=s[0].x===0||s[0].x===E||s[0].y===0||s[0].y===E;return i-k<i/4&&(i=k+i/4),Zv(s,F?i/2*w%i:(D/2+2*v)*x*w%i,i,L,l,k,F,!1,E)}function Zv(s,i,l,f,g,v,x,w,E){const L=v/2,D=qv(s);let k=0,F=i-l,V=[];for(let G=0;G<s.length-1;G++){const H=s[G],nt=s[G+1],lt=H.dist(nt),xt=nt.angleTo(H);for(;F+l<k+lt;){F+=l;const ut=(F-k)/lt,mt=Pi.number(H.x,nt.x,ut),Rt=Pi.number(H.y,nt.y,ut);if(mt>=0&&mt<E&&Rt>=0&&Rt<E&&F-L>=0&&F+L<=D){const zt=new Hl(mt,Rt,xt,G);zt._round(),f&&!Gv(s,zt,v,f,g)||V.push(zt)}}k+=lt}return w||V.length||x||(V=Zv(s,k/2,l,f,g,v,x,!0,E)),V}ce("Anchor",Hl);const hh=mo;function Hv(s,i,l,f){const g=[],v=s.image,x=v.pixelRatio,w=v.paddedRect.w-2*hh,E=v.paddedRect.h-2*hh,L=s.right-s.left,D=s.bottom-s.top,k=v.stretchX||[[0,w]],F=v.stretchY||[[0,E]],V=(Ht,he)=>Ht+he[1]-he[0],G=k.reduce(V,0),H=F.reduce(V,0),nt=w-G,lt=E-H;let xt=0,ut=G,mt=0,Rt=H,zt=0,oe=nt,fe=0,ie=lt;if(v.content&&f){const Ht=v.content;xt=sm(k,0,Ht[0]),mt=sm(F,0,Ht[1]),ut=sm(k,Ht[0],Ht[2]),Rt=sm(F,Ht[1],Ht[3]),zt=Ht[0]-xt,fe=Ht[1]-mt,oe=Ht[2]-Ht[0]-ut,ie=Ht[3]-Ht[1]-Rt}const ee=(Ht,he,Jt,Gt)=>{const xe=am(Ht.stretch-xt,ut,L,s.left),de=lm(Ht.fixed-zt,oe,Ht.stretch,G),Je=am(he.stretch-mt,Rt,D,s.top),Wn=lm(he.fixed-fe,ie,he.stretch,H),Qn=am(Jt.stretch-xt,ut,L,s.left),qr=lm(Jt.fixed-zt,oe,Jt.stretch,G),Mo=am(Gt.stretch-mt,Rt,D,s.top),Zi=lm(Gt.fixed-fe,ie,Gt.stretch,H),Nr=new P(xe,Je),ai=new P(Qn,Je),yi=new P(Qn,Mo),Hi=new P(xe,Mo),Xi=new P(de/x,Wn/x),jr=new P(qr/x,Zi/x),Wr=i*Math.PI/180;if(Wr){const Di=Math.sin(Wr),go=Math.cos(Wr),yo=[go,-Di,Di,go];Nr._matMult(yo),ai._matMult(yo),Hi._matMult(yo),yi._matMult(yo)}const Mi=Ht.stretch+Ht.fixed,Yi=he.stretch+he.fixed;return{tl:Nr,tr:ai,bl:Hi,br:yi,tex:{x:v.paddedRect.x+hh+Mi,y:v.paddedRect.y+hh+Yi,w:Jt.stretch+Jt.fixed-Mi,h:Gt.stretch+Gt.fixed-Yi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Xi,pixelOffsetBR:jr,minFontScaleX:oe/x/L,minFontScaleY:ie/x/D,isSDF:l}};if(f&&(v.stretchX||v.stretchY)){const Ht=Xv(k,nt,G),he=Xv(F,lt,H);for(let Jt=0;Jt<Ht.length-1;Jt++){const Gt=Ht[Jt],xe=Ht[Jt+1];for(let de=0;de<he.length-1;de++)g.push(ee(Gt,he[de],xe,he[de+1]))}}else g.push(ee({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:E+1}));return g}function sm(s,i,l){let f=0;for(const g of s)f+=Math.max(i,Math.min(l,g[1]))-Math.max(i,Math.min(l,g[0]));return f}function Xv(s,i,l){const f=[{fixed:-hh,stretch:0}];for(const[g,v]of s){const x=f[f.length-1];f.push({fixed:g-x.stretch,stretch:x.stretch}),f.push({fixed:g-x.stretch,stretch:x.stretch+(v-g)})}return f.push({fixed:i+hh,stretch:l}),f}function am(s,i,l,f){return s/i*l+f}function lm(s,i,l,f){return s-i*l/f}class um{constructor(i,l,f,g,v,x,w,E,L,D){if(this.boxStartIndex=i.length,L){let k=x.top,F=x.bottom;const V=x.collisionPadding;V&&(k-=V[1],F+=V[3]);let G=F-k;G>0&&(G=Math.max(10,G),this.circleDiameter=G)}else{let k=x.top*w-E[0],F=x.bottom*w+E[2],V=x.left*w-E[3],G=x.right*w+E[1];const H=x.collisionPadding;if(H&&(V-=H[0]*w,k-=H[1]*w,G+=H[2]*w,F+=H[3]*w),D){const nt=new P(V,k),lt=new P(G,k),xt=new P(V,F),ut=new P(G,F),mt=D*Math.PI/180;nt._rotate(mt),lt._rotate(mt),xt._rotate(mt),ut._rotate(mt),V=Math.min(nt.x,lt.x,xt.x,ut.x),G=Math.max(nt.x,lt.x,xt.x,ut.x),k=Math.min(nt.y,lt.y,xt.y,ut.y),F=Math.max(nt.y,lt.y,xt.y,ut.y)}i.emplaceBack(l.x,l.y,V,k,G,F,f,g,v)}this.boxEndIndex=i.length}}class LI{constructor(i=[],l=PI){if(this.data=i,this.length=this.data.length,this.compare=l,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:l,compare:f}=this,g=l[i];for(;i>0;){const v=i-1>>1,x=l[v];if(f(g,x)>=0)break;l[i]=x,i=v}l[i]=g}_down(i){const{data:l,compare:f}=this,g=this.length>>1,v=l[i];for(;i<g;){let x=1+(i<<1),w=l[x];const E=x+1;if(E<this.length&&f(l[E],w)<0&&(x=E,w=l[E]),f(w,v)>=0)break;l[i]=w,i=x}l[i]=v}}function PI(s,i){return s<i?-1:s>i?1:0}function AI(s,i=1,l=!1){let f=1/0,g=1/0,v=-1/0,x=-1/0;const w=s[0];for(let V=0;V<w.length;V++){const G=w[V];(!V||G.x<f)&&(f=G.x),(!V||G.y<g)&&(g=G.y),(!V||G.x>v)&&(v=G.x),(!V||G.y>x)&&(x=G.y)}const E=Math.min(v-f,x-g);let L=E/2;const D=new LI([],MI);if(E===0)return new P(f,g);for(let V=f;V<v;V+=E)for(let G=g;G<x;G+=E)D.push(new ph(V+L,G+L,L,s));let k=function(V){let G=0,H=0,nt=0;const lt=V[0];for(let xt=0,ut=lt.length,mt=ut-1;xt<ut;mt=xt++){const Rt=lt[xt],zt=lt[mt],oe=Rt.x*zt.y-zt.x*Rt.y;H+=(Rt.x+zt.x)*oe,nt+=(Rt.y+zt.y)*oe,G+=3*oe}return new ph(H/G,nt/G,0,V)}(s),F=D.length;for(;D.length;){const V=D.pop();(V.d>k.d||!k.d)&&(k=V,l&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,F)),V.max-k.d<=i||(L=V.h/2,D.push(new ph(V.p.x-L,V.p.y-L,L,s)),D.push(new ph(V.p.x+L,V.p.y-L,L,s)),D.push(new ph(V.p.x-L,V.p.y+L,L,s)),D.push(new ph(V.p.x+L,V.p.y+L,L,s)),F+=4)}return l&&(console.log(`num probes: ${F}`),console.log(`best distance: ${k.d}`)),k.p}function MI(s,i){return i.max-s.max}function ph(s,i,l,f){this.p=new P(s,i),this.h=l,this.d=function(g,v){let x=!1,w=1/0;for(let E=0;E<v.length;E++){const L=v[E];for(let D=0,k=L.length,F=k-1;D<k;F=D++){const V=L[D],G=L[F];V.y>g.y!=G.y>g.y&&g.x<(G.x-V.x)*(g.y-V.y)/(G.y-V.y)+V.x&&(x=!x),w=Math.min(w,M0(g,V,G))}}return(x?1:-1)*Math.sqrt(w)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var gi;p.ap=void 0,(gi=p.ap||(p.ap={}))[gi.center=1]="center",gi[gi.left=2]="left",gi[gi.right=3]="right",gi[gi.top=4]="top",gi[gi.bottom=5]="bottom",gi[gi["top-left"]=6]="top-left",gi[gi["top-right"]=7]="top-right",gi[gi["bottom-left"]=8]="bottom-left",gi[gi["bottom-right"]=9]="bottom-right";const Xl=7,dy=Number.POSITIVE_INFINITY;function Yv(s,i){return i[1]!==dy?function(l,f,g){let v=0,x=0;switch(f=Math.abs(f),g=Math.abs(g),l){case"top-right":case"top-left":case"top":x=g-Xl;break;case"bottom-right":case"bottom-left":case"bottom":x=-g+Xl}switch(l){case"top-right":case"bottom-right":case"right":v=-f;break;case"top-left":case"bottom-left":case"left":v=f}return[v,x]}(s,i[0],i[1]):function(l,f){let g=0,v=0;f<0&&(f=0);const x=f/Math.SQRT2;switch(l){case"top-right":case"top-left":v=x-Xl;break;case"bottom-right":case"bottom-left":v=-x+Xl;break;case"bottom":v=-f+Xl;break;case"top":v=f-Xl}switch(l){case"top-right":case"bottom-right":g=-x;break;case"top-left":case"bottom-left":g=x;break;case"left":g=f;break;case"right":g=-f}return[g,v]}(s,i[0])}function Kv(s,i,l){var f;const g=s.layout,v=(f=g.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(i,{},l);if(v){const w=v.values,E=[];for(let L=0;L<w.length;L+=2){const D=E[L]=w[L],k=w[L+1].map(F=>F*Gr);D.startsWith("top")?k[1]-=Xl:D.startsWith("bottom")&&(k[1]+=Xl),E[L+1]=k}return new To(E)}const x=g.get("text-variable-anchor");if(x){let w;w=s._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(i,{},l)*Gr,dy]:g.get("text-offset").evaluate(i,{},l).map(L=>L*Gr);const E=[];for(const L of x)E.push(L,Yv(L,w));return new To(E)}return null}function my(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function DI(s,i,l,f,g,v,x,w,E,L,D){let k=v.textMaxSize.evaluate(i,{});k===void 0&&(k=x);const F=s.layers[0].layout,V=F.get("icon-offset").evaluate(i,{},D),G=Qv(l.horizontal),H=x/24,nt=s.tilePixelRatio*H,lt=s.tilePixelRatio*k/24,xt=s.tilePixelRatio*w,ut=s.tilePixelRatio*F.get("symbol-spacing"),mt=F.get("text-padding")*s.tilePixelRatio,Rt=function(Gt,xe,de,Je=1){const Wn=Gt.get("icon-padding").evaluate(xe,{},de),Qn=Wn&&Wn.values;return[Qn[0]*Je,Qn[1]*Je,Qn[2]*Je,Qn[3]*Je]}(F,i,D,s.tilePixelRatio),zt=F.get("text-max-angle")/180*Math.PI,oe=F.get("text-rotation-alignment")!=="viewport"&&F.get("symbol-placement")!=="point",fe=F.get("icon-rotation-alignment")==="map"&&F.get("symbol-placement")!=="point",ie=F.get("symbol-placement"),ee=ut/2,Ht=F.get("icon-text-fit");let he;f&&Ht!=="none"&&(s.allowVerticalPlacement&&l.vertical&&(he=bv(f,l.vertical,Ht,F.get("icon-text-fit-padding"),V,H)),G&&(f=bv(f,G,Ht,F.get("icon-text-fit-padding"),V,H)));const Jt=(Gt,xe)=>{xe.x<0||xe.x>=yr||xe.y<0||xe.y>=yr||function(de,Je,Wn,Qn,qr,Mo,Zi,Nr,ai,yi,Hi,Xi,jr,Wr,Mi,Yi,Di,go,yo,Zr,on,ki,_i,Hr,ws){const Xs=de.addToLineVertexArray(Je,Wn);let Ys,ol,Ss,Ko,_o=0,sl=0,af=0,n1=0,Sy=-1,Iy=-1;const al={};let r1=pr("");if(de.allowVerticalPlacement&&Qn.vertical){const Ri=Nr.layout.get("text-rotate").evaluate(on,{},Hr)+90;Ss=new um(ai,Je,yi,Hi,Xi,Qn.vertical,jr,Wr,Mi,Ri),Zi&&(Ko=new um(ai,Je,yi,Hi,Xi,Zi,Di,go,Mi,Ri))}if(qr){const Ri=Nr.layout.get("icon-rotate").evaluate(on,{}),Jo=Nr.layout.get("icon-text-fit")!=="none",Uu=Hv(qr,Ri,_i,Jo),Js=Zi?Hv(Zi,Ri,_i,Jo):void 0;ol=new um(ai,Je,yi,Hi,Xi,qr,Di,go,!1,Ri),_o=4*Uu.length;const Gu=de.iconSizeData;let Ta=null;Gu.kind==="source"?(Ta=[Ca*Nr.layout.get("icon-size").evaluate(on,{})],Ta[0]>Wl&&$t(`${de.layerIds[0]}: Value for "icon-size" is >= ${nf}. Reduce your "icon-size".`)):Gu.kind==="composite"&&(Ta=[Ca*ki.compositeIconSizes[0].evaluate(on,{},Hr),Ca*ki.compositeIconSizes[1].evaluate(on,{},Hr)],(Ta[0]>Wl||Ta[1]>Wl)&&$t(`${de.layerIds[0]}: Value for "icon-size" is >= ${nf}. Reduce your "icon-size".`)),de.addSymbols(de.icon,Uu,Ta,Zr,yo,on,p.ah.none,Je,Xs.lineStartIndex,Xs.lineLength,-1,Hr),Sy=de.icon.placedSymbolArray.length-1,Js&&(sl=4*Js.length,de.addSymbols(de.icon,Js,Ta,Zr,yo,on,p.ah.vertical,Je,Xs.lineStartIndex,Xs.lineLength,-1,Hr),Iy=de.icon.placedSymbolArray.length-1)}const i1=Object.keys(Qn.horizontal);for(const Ri of i1){const Jo=Qn.horizontal[Ri];if(!Ys){r1=pr(Jo.text);const Js=Nr.layout.get("text-rotate").evaluate(on,{},Hr);Ys=new um(ai,Je,yi,Hi,Xi,Jo,jr,Wr,Mi,Js)}const Uu=Jo.positionedLines.length===1;if(af+=Jv(de,Je,Jo,Mo,Nr,Mi,on,Yi,Xs,Qn.vertical?p.ah.horizontal:p.ah.horizontalOnly,Uu?i1:[Ri],al,Sy,ki,Hr),Uu)break}Qn.vertical&&(n1+=Jv(de,Je,Qn.vertical,Mo,Nr,Mi,on,Yi,Xs,p.ah.vertical,["vertical"],al,Iy,ki,Hr));const NI=Ys?Ys.boxStartIndex:de.collisionBoxArray.length,OI=Ys?Ys.boxEndIndex:de.collisionBoxArray.length,zI=Ss?Ss.boxStartIndex:de.collisionBoxArray.length,FI=Ss?Ss.boxEndIndex:de.collisionBoxArray.length,BI=ol?ol.boxStartIndex:de.collisionBoxArray.length,VI=ol?ol.boxEndIndex:de.collisionBoxArray.length,UI=Ko?Ko.boxStartIndex:de.collisionBoxArray.length,GI=Ko?Ko.boxEndIndex:de.collisionBoxArray.length;let Ks=-1;const hm=(Ri,Jo)=>Ri&&Ri.circleDiameter?Math.max(Ri.circleDiameter,Jo):Jo;Ks=hm(Ys,Ks),Ks=hm(Ss,Ks),Ks=hm(ol,Ks),Ks=hm(Ko,Ks);const o1=Ks>-1?1:0;o1&&(Ks*=ws/Gr),de.glyphOffsetArray.length>=ch.MAX_GLYPHS&&$t("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),on.sortKey!==void 0&&de.addToSortKeyRanges(de.symbolInstances.length,on.sortKey);const qI=Kv(Nr,on,Hr),[jI,WI]=function(Ri,Jo){const Uu=Ri.length,Js=Jo==null?void 0:Jo.values;if((Js==null?void 0:Js.length)>0)for(let Gu=0;Gu<Js.length;Gu+=2){const Ta=Js[Gu+1];Ri.emplaceBack(p.ap[Js[Gu]],Ta[0],Ta[1])}return[Uu,Ri.length]}(de.textAnchorOffsets,qI);de.symbolInstances.emplaceBack(Je.x,Je.y,al.right>=0?al.right:-1,al.center>=0?al.center:-1,al.left>=0?al.left:-1,al.vertical||-1,Sy,Iy,r1,NI,OI,zI,FI,BI,VI,UI,GI,yi,af,n1,_o,sl,o1,0,jr,Ks,jI,WI)}(s,xe,Gt,l,f,g,he,s.layers[0],s.collisionBoxArray,i.index,i.sourceLayerIndex,s.index,nt,[mt,mt,mt,mt],oe,E,xt,Rt,fe,V,i,v,L,D,x)};if(ie==="line")for(const Gt of Uv(i.geometry,0,0,yr,yr)){const xe=TI(Gt,ut,zt,l.vertical||G,f,24,lt,s.overscaling,yr);for(const de of xe)G&&kI(s,G.text,ee,de)||Jt(Gt,de)}else if(ie==="line-center"){for(const Gt of i.geometry)if(Gt.length>1){const xe=CI(Gt,zt,l.vertical||G,f,24,lt);xe&&Jt(Gt,xe)}}else if(i.type==="Polygon")for(const Gt of Hg(i.geometry,0)){const xe=AI(Gt,16);Jt(Gt[0],new Hl(xe.x,xe.y,0))}else if(i.type==="LineString")for(const Gt of i.geometry)Jt(Gt,new Hl(Gt[0].x,Gt[0].y,0));else if(i.type==="Point")for(const Gt of i.geometry)for(const xe of Gt)Jt([xe],new Hl(xe.x,xe.y,0))}function Jv(s,i,l,f,g,v,x,w,E,L,D,k,F,V,G){const H=function(xt,ut,mt,Rt,zt,oe,fe,ie){const ee=Rt.layout.get("text-rotate").evaluate(oe,{})*Math.PI/180,Ht=[];for(const he of ut.positionedLines)for(const Jt of he.positionedGlyphs){if(!Jt.rect)continue;const Gt=Jt.rect||{};let xe=dv+1,de=!0,Je=1,Wn=0;const Qn=(zt||ie)&&Jt.vertical,qr=Jt.metrics.advance*Jt.scale/2;if(ie&&ut.verticalizable&&(Wn=he.lineOffset/2-(Jt.imageName?-(Gr-Jt.metrics.width*Jt.scale)/2:(Jt.scale-1)*Gr)),Jt.imageName){const Zr=fe[Jt.imageName];de=Zr.sdf,Je=Zr.pixelRatio,xe=mo/Je}const Mo=zt?[Jt.x+qr,Jt.y]:[0,0];let Zi=zt?[0,0]:[Jt.x+qr+mt[0],Jt.y+mt[1]-Wn],Nr=[0,0];Qn&&(Nr=Zi,Zi=[0,0]);const ai=Jt.metrics.isDoubleResolution?2:1,yi=(Jt.metrics.left-xe)*Jt.scale-qr+Zi[0],Hi=(-Jt.metrics.top-xe)*Jt.scale+Zi[1],Xi=yi+Gt.w/ai*Jt.scale/Je,jr=Hi+Gt.h/ai*Jt.scale/Je,Wr=new P(yi,Hi),Mi=new P(Xi,Hi),Yi=new P(yi,jr),Di=new P(Xi,jr);if(Qn){const Zr=new P(-qr,qr-tf),on=-Math.PI/2,ki=Gr/2-qr,_i=new P(5-tf-ki,-(Jt.imageName?ki:0)),Hr=new P(...Nr);Wr._rotateAround(on,Zr)._add(_i)._add(Hr),Mi._rotateAround(on,Zr)._add(_i)._add(Hr),Yi._rotateAround(on,Zr)._add(_i)._add(Hr),Di._rotateAround(on,Zr)._add(_i)._add(Hr)}if(ee){const Zr=Math.sin(ee),on=Math.cos(ee),ki=[on,-Zr,Zr,on];Wr._matMult(ki),Mi._matMult(ki),Yi._matMult(ki),Di._matMult(ki)}const go=new P(0,0),yo=new P(0,0);Ht.push({tl:Wr,tr:Mi,bl:Yi,br:Di,tex:Gt,writingMode:ut.writingMode,glyphOffset:Mo,sectionIndex:Jt.sectionIndex,isSDF:de,pixelOffsetTL:go,pixelOffsetBR:yo,minFontScaleX:0,minFontScaleY:0})}return Ht}(0,l,w,g,v,x,f,s.allowVerticalPlacement),nt=s.textSizeData;let lt=null;nt.kind==="source"?(lt=[Ca*g.layout.get("text-size").evaluate(x,{})],lt[0]>Wl&&$t(`${s.layerIds[0]}: Value for "text-size" is >= ${nf}. Reduce your "text-size".`)):nt.kind==="composite"&&(lt=[Ca*V.compositeTextSizes[0].evaluate(x,{},G),Ca*V.compositeTextSizes[1].evaluate(x,{},G)],(lt[0]>Wl||lt[1]>Wl)&&$t(`${s.layerIds[0]}: Value for "text-size" is >= ${nf}. Reduce your "text-size".`)),s.addSymbols(s.text,H,lt,w,v,x,L,i,E.lineStartIndex,E.lineLength,F,G);for(const xt of D)k[xt]=s.text.placedSymbolArray.length-1;return 4*H.length}function Qv(s){for(const i in s)return s[i];return null}function kI(s,i,l,f){const g=s.compareText;if(i in g){const v=g[i];for(let x=v.length-1;x>=0;x--)if(f.dist(v[x])<l)return!0}else g[i]=[];return g[i].push(f),!1}const $v=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gy{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,f]=new Uint8Array(i,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=f>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const v=$v[15&f];if(!v)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(i,2,1),[w]=new Uint32Array(i,4,1);return new gy(w,x,v,i)}constructor(i,l=64,f=Float64Array,g){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=f,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const v=$v.indexOf(this.ArrayType),x=2*i*this.ArrayType.BYTES_PER_ELEMENT,w=i*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-w%8)%8;if(v<0)throw new Error(`Unexpected typed array class: ${f}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+E,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+x+w+E),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+w+E,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+v]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=i)}add(i,l){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=i,this.coords[this._pos++]=l,f}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return yy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,l,f,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:x,nodeSize:w}=this,E=[0,v.length-1,0],L=[];for(;E.length;){const D=E.pop()||0,k=E.pop()||0,F=E.pop()||0;if(k-F<=w){for(let nt=F;nt<=k;nt++){const lt=x[2*nt],xt=x[2*nt+1];lt>=i&&lt<=f&&xt>=l&&xt<=g&&L.push(v[nt])}continue}const V=F+k>>1,G=x[2*V],H=x[2*V+1];G>=i&&G<=f&&H>=l&&H<=g&&L.push(v[V]),(D===0?i<=G:l<=H)&&(E.push(F),E.push(V-1),E.push(1-D)),(D===0?f>=G:g>=H)&&(E.push(V+1),E.push(k),E.push(1-D))}return L}within(i,l,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:v,nodeSize:x}=this,w=[0,g.length-1,0],E=[],L=f*f;for(;w.length;){const D=w.pop()||0,k=w.pop()||0,F=w.pop()||0;if(k-F<=x){for(let nt=F;nt<=k;nt++)e1(v[2*nt],v[2*nt+1],i,l)<=L&&E.push(g[nt]);continue}const V=F+k>>1,G=v[2*V],H=v[2*V+1];e1(G,H,i,l)<=L&&E.push(g[V]),(D===0?i-f<=G:l-f<=H)&&(w.push(F),w.push(V-1),w.push(1-D)),(D===0?i+f>=G:l+f>=H)&&(w.push(V+1),w.push(k),w.push(1-D))}return E}}function yy(s,i,l,f,g,v){if(g-f<=l)return;const x=f+g>>1;t1(s,i,x,f,g,v),yy(s,i,l,f,x-1,1-v),yy(s,i,l,x+1,g,1-v)}function t1(s,i,l,f,g,v){for(;g>f;){if(g-f>600){const L=g-f+1,D=l-f+1,k=Math.log(L),F=.5*Math.exp(2*k/3),V=.5*Math.sqrt(k*F*(L-F)/L)*(D-L/2<0?-1:1);t1(s,i,l,Math.max(f,Math.floor(l-D*F/L+V)),Math.min(g,Math.floor(l+(L-D)*F/L+V)),v)}const x=i[2*l+v];let w=f,E=g;for(of(s,i,f,l),i[2*g+v]>x&&of(s,i,f,g);w<E;){for(of(s,i,w,E),w++,E--;i[2*w+v]<x;)w++;for(;i[2*E+v]>x;)E--}i[2*f+v]===x?of(s,i,f,E):(E++,of(s,i,E,g)),E<=l&&(f=E+1),l<=E&&(g=E-1)}}function of(s,i,l,f){_y(s,l,f),_y(i,2*l,2*f),_y(i,2*l+1,2*f+1)}function _y(s,i,l){const f=s[i];s[i]=s[l],s[l]=f}function e1(s,i,l,f){const g=s-l,v=i-f;return g*g+v*v}var vy;p.bd=void 0,(vy=p.bd||(p.bd={})).create="create",vy.load="load",vy.fullLoad="fullLoad";let cm=null,sf=[];const xy=1e3/60,by="loadTime",wy="fullLoadTime",RI={mark(s){performance.mark(s)},frame(s){const i=s;cm!=null&&sf.push(i-cm),cm=i},clearMetrics(){cm=null,sf=[],performance.clearMeasures(by),performance.clearMeasures(wy);for(const s in p.bd)performance.clearMarks(p.bd[s])},getPerformanceMetrics(){performance.measure(by,p.bd.create,p.bd.load),performance.measure(wy,p.bd.create,p.bd.fullLoad);const s=performance.getEntriesByName(by)[0].duration,i=performance.getEntriesByName(wy)[0].duration,l=sf.length,f=1/(sf.reduce((v,x)=>v+x,0)/l/1e3),g=sf.filter(v=>v>xy).reduce((v,x)=>v+(x-xy)/xy,0);return{loadTime:s,fullLoadTime:i,fps:f,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};p.$=Xt,p.A=ih,p.B=function(s){if(ue==null){const i=s.navigator?s.navigator.userAgent:null;ue=!!s.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return ue},p.C=class{constructor(s,i){this.target=s,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new II(()=>this.process()),this.subscription=function(l,f,g,v){return l.addEventListener(f,g,!1),{unsubscribe:()=>{l.removeEventListener(f,g,!1)}}}(this.target,"message",l=>this.receive(l)),this.globalScope=Ie(self)?s:window}registerMessageHandler(s,i){this.messageHandlers[s]=i}sendAsync(s,i){return new Promise((l,f)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:l,reject:f},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const w={id:g,type:"<cancel>",origin:location.origin,targetMapId:s.targetMapId,sourceMapId:this.mapId};this.target.postMessage(w)},{once:!0});const v=[],x=Object.assign(Object.assign({},s),{id:g,sourceMapId:this.mapId,origin:location.origin,data:Bl(s.data,v)});this.target.postMessage(x,{transfer:v})})}receive(s){const i=s.data,l=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[l];const f=this.abortControllers[l];return delete this.abortControllers[l],void(f&&f.abort())}if(Ie(self)||i.mustQueue)return this.tasks[l]=i,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,i)}}process(){if(this.taskQueue.length===0)return;const s=this.taskQueue.shift(),i=this.tasks[s];delete this.tasks[s],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(s,i)}processTask(s,i){return c(this,void 0,void 0,function*(){if(i.type==="<response>"){const g=this.resolveRejects[s];return delete this.resolveRejects[s],g?void(i.error?g.reject(Vl(i.error)):g.resolve(Vl(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(s,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=Vl(i.data),f=new AbortController;this.abortControllers[s]=f;try{const g=yield this.messageHandlers[i.type](i.sourceMapId,l,f);this.completeTask(s,null,g)}catch(g){this.completeTask(s,g)}})}completeTask(s,i,l){const f=[];delete this.abortControllers[s];const g={id:s,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Bl(i):null,data:Bl(l,f)};this.target.postMessage(g,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},p.D=me,p.E=Ke,p.F=function(){var s=new ih(16);return ih!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},p.G=mn,p.H=function(s,i,l){var f,g,v,x,w,E,L,D,k,F,V,G,H=l[0],nt=l[1],lt=l[2];return i===s?(s[12]=i[0]*H+i[4]*nt+i[8]*lt+i[12],s[13]=i[1]*H+i[5]*nt+i[9]*lt+i[13],s[14]=i[2]*H+i[6]*nt+i[10]*lt+i[14],s[15]=i[3]*H+i[7]*nt+i[11]*lt+i[15]):(g=i[1],v=i[2],x=i[3],w=i[4],E=i[5],L=i[6],D=i[7],k=i[8],F=i[9],V=i[10],G=i[11],s[0]=f=i[0],s[1]=g,s[2]=v,s[3]=x,s[4]=w,s[5]=E,s[6]=L,s[7]=D,s[8]=k,s[9]=F,s[10]=V,s[11]=G,s[12]=f*H+w*nt+k*lt+i[12],s[13]=g*H+E*nt+F*lt+i[13],s[14]=v*H+L*nt+V*lt+i[14],s[15]=x*H+D*nt+G*lt+i[15]),s},p.I=ry,p.J=function(s,i,l){var f=l[0],g=l[1],v=l[2];return s[0]=i[0]*f,s[1]=i[1]*f,s[2]=i[2]*f,s[3]=i[3]*f,s[4]=i[4]*g,s[5]=i[5]*g,s[6]=i[6]*g,s[7]=i[7]*g,s[8]=i[8]*v,s[9]=i[9]*v,s[10]=i[10]*v,s[11]=i[11]*v,s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},p.K=N0,p.L=function(s,i){const l={};for(let f=0;f<i.length;f++){const g=i[f];g in s&&(l[g]=s[g])}return l},p.M=Zl,p.N=Av,p.O=Mv,p.P=P,p.Q=Yo,p.R=Xo,p.S=gt,p.T=Pp,p.U=q,p.V=nn,p.W=yr,p.X=Ir,p.Y=om,p.Z=class extends Dp{},p._=c,p.a=rn,p.a$=function(s,i,l){return s[0]=i[0]*l[0],s[1]=i[1]*l[1],s[2]=i[2]*l[2],s[3]=i[3]*l[3],s},p.a0=fy,p.a1=Zt,p.a2=s=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(l=>{i.onloadstart=()=>{l(i)};for(const f of s){const g=window.document.createElement("source");yn(f)||(i.crossOrigin="Anonymous"),g.src=f,i.appendChild(g)}})},p.a3=function(){return Tt++},p.a4=y,p.a5=ch,p.a6=zc,p.a7=rl,p.a8=Kn,p.a9=zv,p.aA=Q,p.aB=function(s,i){if(!s)return[{command:"setStyle",args:[i]}];let l=[];try{if(!tn(s.version,i.version))return[{command:"setStyle",args:[i]}];tn(s.center,i.center)||l.push({command:"setCenter",args:[i.center]}),tn(s.zoom,i.zoom)||l.push({command:"setZoom",args:[i.zoom]}),tn(s.bearing,i.bearing)||l.push({command:"setBearing",args:[i.bearing]}),tn(s.pitch,i.pitch)||l.push({command:"setPitch",args:[i.pitch]}),tn(s.sprite,i.sprite)||l.push({command:"setSprite",args:[i.sprite]}),tn(s.glyphs,i.glyphs)||l.push({command:"setGlyphs",args:[i.glyphs]}),tn(s.transition,i.transition)||l.push({command:"setTransition",args:[i.transition]}),tn(s.light,i.light)||l.push({command:"setLight",args:[i.light]}),tn(s.terrain,i.terrain)||l.push({command:"setTerrain",args:[i.terrain]}),tn(s.sky,i.sky)||l.push({command:"setSky",args:[i.sky]});const f={},g=[];(function(x,w,E,L){let D;for(D in w=w||{},x=x||{})Object.prototype.hasOwnProperty.call(x,D)&&(Object.prototype.hasOwnProperty.call(w,D)||Tl(D,E,L));for(D in w)Object.prototype.hasOwnProperty.call(w,D)&&(Object.prototype.hasOwnProperty.call(x,D)?tn(x[D],w[D])||(x[D].type==="geojson"&&w[D].type==="geojson"&&Pl(x,w,D)?zr(E,{command:"setGeoJSONSourceData",args:[D,w[D].data]}):Ll(D,w,E,L)):Cl(D,w,E))})(s.sources,i.sources,g,f);const v=[];s.layers&&s.layers.forEach(x=>{"source"in x&&f[x.source]?l.push({command:"removeLayer",args:[x.id]}):v.push(x)}),l=l.concat(g),function(x,w,E){w=w||[];const L=(x=x||[]).map(mc),D=w.map(mc),k=x.reduce(Za,{}),F=w.reduce(Za,{}),V=L.slice(),G=Object.create(null);let H,nt,lt,xt,ut;for(let mt=0,Rt=0;mt<L.length;mt++)H=L[mt],Object.prototype.hasOwnProperty.call(F,H)?Rt++:(zr(E,{command:"removeLayer",args:[H]}),V.splice(V.indexOf(H,Rt),1));for(let mt=0,Rt=0;mt<D.length;mt++)H=D[D.length-1-mt],V[V.length-1-mt]!==H&&(Object.prototype.hasOwnProperty.call(k,H)?(zr(E,{command:"removeLayer",args:[H]}),V.splice(V.lastIndexOf(H,V.length-Rt),1)):Rt++,xt=V[V.length-mt],zr(E,{command:"addLayer",args:[F[H],xt]}),V.splice(V.length-mt,0,H),G[H]=!0);for(let mt=0;mt<D.length;mt++)if(H=D[mt],nt=k[H],lt=F[H],!G[H]&&!tn(nt,lt))if(tn(nt.source,lt.source)&&tn(nt["source-layer"],lt["source-layer"])&&tn(nt.type,lt.type)){for(ut in ga(nt.layout,lt.layout,E,H,null,"setLayoutProperty"),ga(nt.paint,lt.paint,E,H,null,"setPaintProperty"),tn(nt.filter,lt.filter)||zr(E,{command:"setFilter",args:[H,lt.filter]}),tn(nt.minzoom,lt.minzoom)&&tn(nt.maxzoom,lt.maxzoom)||zr(E,{command:"setLayerZoomRange",args:[H,lt.minzoom,lt.maxzoom]}),nt)Object.prototype.hasOwnProperty.call(nt,ut)&&ut!=="layout"&&ut!=="paint"&&ut!=="filter"&&ut!=="metadata"&&ut!=="minzoom"&&ut!=="maxzoom"&&(ut.indexOf("paint.")===0?ga(nt[ut],lt[ut],E,H,ut.slice(6),"setPaintProperty"):tn(nt[ut],lt[ut])||zr(E,{command:"setLayerProperty",args:[H,ut,lt[ut]]}));for(ut in lt)Object.prototype.hasOwnProperty.call(lt,ut)&&!Object.prototype.hasOwnProperty.call(nt,ut)&&ut!=="layout"&&ut!=="paint"&&ut!=="filter"&&ut!=="metadata"&&ut!=="minzoom"&&ut!=="maxzoom"&&(ut.indexOf("paint.")===0?ga(nt[ut],lt[ut],E,H,ut.slice(6),"setPaintProperty"):tn(nt[ut],lt[ut])||zr(E,{command:"setLayerProperty",args:[H,ut,lt[ut]]}))}else zr(E,{command:"removeLayer",args:[H]}),xt=V[V.lastIndexOf(H)+1],zr(E,{command:"addLayer",args:[lt,xt]})}(v,i.layers,l)}catch(f){console.warn("Unable to compute style diff:",f),l=[{command:"setStyle",args:[i]}]}return l},p.aC=function(s){const i=[],l=s.id;return l===void 0&&i.push({message:`layers.${l}: missing required property "id"`}),s.render===void 0&&i.push({message:`layers.${l}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&i.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),i},p.aD=function s(i,l){if(Array.isArray(i)){if(!Array.isArray(l)||i.length!==l.length)return!1;for(let f=0;f<i.length;f++)if(!s(i[f],l[f]))return!1;return!0}if(typeof i=="object"&&i!==null&&l!==null){if(typeof l!="object"||Object.keys(i).length!==Object.keys(l).length)return!1;for(const f in i)if(!s(i[f],l[f]))return!1;return!0}return i===l},p.aE=Ut,p.aF=qt,p.aG=class extends Ur{constructor(s,i){super(s,i),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},p.aH=fo,p.aI=class extends Ur{constructor(s,i){super(s,i),this.current=Bu}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let i=1;i<16;i++)if(s[i]!==this.current[i]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},p.aJ=xs,p.aK=class extends Ur{constructor(s,i){super(s,i),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},p.aL=class extends Ur{constructor(s,i){super(s,i),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},p.aM=Sa,p.aN=function(s,i,l,f,g,v,x){var w=1/(i-l),E=1/(f-g),L=1/(v-x);return s[0]=-2*w,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*E,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*L,s[11]=0,s[12]=(i+l)*w,s[13]=(g+f)*E,s[14]=(x+v)*L,s[15]=1,s},p.aO=Pn,p.aP=iS,p.aQ=class extends Kc{},p.aR=QS,p.aS=class extends Jc{},p.aT=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},p.aU=V0,p.aV=O,p.aW=class extends Fp{},p.aX=kt,p.aY=function(s,i){return s[0]===i[0]&&s[1]===i[1]&&s[2]===i[2]&&s[3]===i[3]&&s[4]===i[4]&&s[5]===i[5]&&s[6]===i[6]&&s[7]===i[7]&&s[8]===i[8]&&s[9]===i[9]&&s[10]===i[10]&&s[11]===i[11]&&s[12]===i[12]&&s[13]===i[13]&&s[14]===i[14]&&s[15]===i[15]},p.aZ=function(s,i){var l=s[0],f=s[1],g=s[2],v=s[3],x=s[4],w=s[5],E=s[6],L=s[7],D=s[8],k=s[9],F=s[10],V=s[11],G=s[12],H=s[13],nt=s[14],lt=s[15],xt=i[0],ut=i[1],mt=i[2],Rt=i[3],zt=i[4],oe=i[5],fe=i[6],ie=i[7],ee=i[8],Ht=i[9],he=i[10],Jt=i[11],Gt=i[12],xe=i[13],de=i[14],Je=i[15];return Math.abs(l-xt)<=Wi*Math.max(1,Math.abs(l),Math.abs(xt))&&Math.abs(f-ut)<=Wi*Math.max(1,Math.abs(f),Math.abs(ut))&&Math.abs(g-mt)<=Wi*Math.max(1,Math.abs(g),Math.abs(mt))&&Math.abs(v-Rt)<=Wi*Math.max(1,Math.abs(v),Math.abs(Rt))&&Math.abs(x-zt)<=Wi*Math.max(1,Math.abs(x),Math.abs(zt))&&Math.abs(w-oe)<=Wi*Math.max(1,Math.abs(w),Math.abs(oe))&&Math.abs(E-fe)<=Wi*Math.max(1,Math.abs(E),Math.abs(fe))&&Math.abs(L-ie)<=Wi*Math.max(1,Math.abs(L),Math.abs(ie))&&Math.abs(D-ee)<=Wi*Math.max(1,Math.abs(D),Math.abs(ee))&&Math.abs(k-Ht)<=Wi*Math.max(1,Math.abs(k),Math.abs(Ht))&&Math.abs(F-he)<=Wi*Math.max(1,Math.abs(F),Math.abs(he))&&Math.abs(V-Jt)<=Wi*Math.max(1,Math.abs(V),Math.abs(Jt))&&Math.abs(G-Gt)<=Wi*Math.max(1,Math.abs(G),Math.abs(Gt))&&Math.abs(H-xe)<=Wi*Math.max(1,Math.abs(H),Math.abs(xe))&&Math.abs(nt-de)<=Wi*Math.max(1,Math.abs(nt),Math.abs(de))&&Math.abs(lt-Je)<=Wi*Math.max(1,Math.abs(lt),Math.abs(Je))},p.a_=function(s,i){return s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[4]=i[4],s[5]=i[5],s[6]=i[6],s[7]=i[7],s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15],s},p.aa=function(s){const i={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,f,g,v)=>{const x=g||v;return i[f]=!x||x.toLowerCase(),""}),i["max-age"]){const l=parseInt(i["max-age"],10);isNaN(l)?delete i["max-age"]:i["max-age"]=l}return i},p.ab=function(s,i){const l=[];for(const f in s)f in i||l.push(f);return l},p.ac=dt,p.ad=function(s,i,l){var f=Math.sin(l),g=Math.cos(l),v=i[0],x=i[1],w=i[2],E=i[3],L=i[4],D=i[5],k=i[6],F=i[7];return i!==s&&(s[8]=i[8],s[9]=i[9],s[10]=i[10],s[11]=i[11],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[0]=v*g+L*f,s[1]=x*g+D*f,s[2]=w*g+k*f,s[3]=E*g+F*f,s[4]=L*g-v*f,s[5]=D*g-x*f,s[6]=k*g-w*f,s[7]=F*g-E*f,s},p.ae=function(s){var i=new ih(16);return i[0]=s[0],i[1]=s[1],i[2]=s[2],i[3]=s[3],i[4]=s[4],i[5]=s[5],i[6]=s[6],i[7]=s[7],i[8]=s[8],i[9]=s[9],i[10]=s[10],i[11]=s[11],i[12]=s[12],i[13]=s[13],i[14]=s[14],i[15]=s[15],i},p.af=Xd,p.ag=function(s,i){let l=0,f=0;if(s.kind==="constant")f=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:v,maxZoom:x}=s,w=g?dt(mi.interpolationFactor(g,i,v,x),0,1):0;s.kind==="camera"?f=Pi.number(s.minSize,s.maxSize,w):l=w}return{uSizeT:l,uSize:f}},p.ai=function(s,{uSize:i,uSizeT:l},{lowerSize:f,upperSize:g}){return s.kind==="source"?f/Ca:s.kind==="composite"?Pi.number(f/Ca,g/Ca,l):i},p.aj=ay,p.ak=function(s,i,l,f){const g=i.y-s.y,v=i.x-s.x,x=f.y-l.y,w=f.x-l.x,E=x*v-w*g;if(E===0)return null;const L=(w*(s.y-l.y)-x*(s.x-l.x))/E;return new P(s.x+L*v,s.y+L*g)},p.al=Uv,p.am=Vp,p.an=Vg,p.ao=Gr,p.aq=sy,p.ar=function(s,i){var l=i[0],f=i[1],g=i[2],v=i[3],x=i[4],w=i[5],E=i[6],L=i[7],D=i[8],k=i[9],F=i[10],V=i[11],G=i[12],H=i[13],nt=i[14],lt=i[15],xt=l*w-f*x,ut=l*E-g*x,mt=l*L-v*x,Rt=f*E-g*w,zt=f*L-v*w,oe=g*L-v*E,fe=D*H-k*G,ie=D*nt-F*G,ee=D*lt-V*G,Ht=k*nt-F*H,he=k*lt-V*H,Jt=F*lt-V*nt,Gt=xt*Jt-ut*he+mt*Ht+Rt*ee-zt*ie+oe*fe;return Gt?(s[0]=(w*Jt-E*he+L*Ht)*(Gt=1/Gt),s[1]=(g*he-f*Jt-v*Ht)*Gt,s[2]=(H*oe-nt*zt+lt*Rt)*Gt,s[3]=(F*zt-k*oe-V*Rt)*Gt,s[4]=(E*ee-x*Jt-L*ie)*Gt,s[5]=(l*Jt-g*ee+v*ie)*Gt,s[6]=(nt*mt-G*oe-lt*ut)*Gt,s[7]=(D*oe-F*mt+V*ut)*Gt,s[8]=(x*he-w*ee+L*fe)*Gt,s[9]=(f*ee-l*he-v*fe)*Gt,s[10]=(G*zt-H*mt+lt*xt)*Gt,s[11]=(k*mt-D*zt-V*xt)*Gt,s[12]=(w*ie-x*Ht-E*fe)*Gt,s[13]=(l*Ht-f*ie+g*fe)*Gt,s[14]=(H*ut-G*Rt-nt*xt)*Gt,s[15]=(D*Rt-k*ut+F*xt)*Gt,s):null},p.as=my,p.at=oy,p.au=gy,p.av=function(){const s={},i=Lt.$version;for(const l in Lt.$root){const f=Lt.$root[l];if(f.required){let g=null;g=l==="version"?i:f.type==="array"?[]:{},g!=null&&(s[l]=g)}}return s},p.aw=Rd,p.ax=kn,p.ay=function(s){s=s.slice();const i=Object.create(null);for(let l=0;l<s.length;l++)i[s[l].id]=s[l];for(let l=0;l<s.length;l++)"ref"in s[l]&&(s[l]=qo(s[l],i[s[l].ref]));return s},p.az=function(s){if(s.type==="custom")return new SI(s);switch(s.type){case"background":return new xI(s);case"circle":return new oS(s);case"fill":return new ES(s);case"fill-extrusion":return new VS(s);case"heatmap":return new aS(s);case"hillshade":return new uS(s);case"line":return new XS(s);case"raster":return new wI(s);case"symbol":return new im(s)}},p.b=je,p.b0=function(s,i){return s[0]*i[0]+s[1]*i[1]+s[2]*i[2]+s[3]*i[3]},p.b1=Pt,p.b2=Rv,p.b3=Dv,p.b4=function(s,i,l,f,g){var v,x=1/Math.tan(i/2);return s[0]=x/l,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=x,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+f)*(v=1/(f-g)),s[14]=2*g*f*v):(s[10]=-1,s[14]=-2*f),s},p.b5=function(s,i,l){var f=Math.sin(l),g=Math.cos(l),v=i[4],x=i[5],w=i[6],E=i[7],L=i[8],D=i[9],k=i[10],F=i[11];return i!==s&&(s[0]=i[0],s[1]=i[1],s[2]=i[2],s[3]=i[3],s[12]=i[12],s[13]=i[13],s[14]=i[14],s[15]=i[15]),s[4]=v*g+L*f,s[5]=x*g+D*f,s[6]=w*g+k*f,s[7]=E*g+F*f,s[8]=L*g-v*f,s[9]=D*g-x*f,s[10]=k*g-w*f,s[11]=F*g-E*f,s},p.b6=W,p.b7=at,p.b8=function(s){return s*Math.PI/180},p.b9=function(s,i){return s[0]=i[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=i[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=i[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},p.bA=wa,p.ba=class extends Zs{},p.bb=hy,p.bc=RI,p.be=Dn,p.bf=function(s,i){rn.REGISTERED_PROTOCOLS[s]=i},p.bg=function(s){delete rn.REGISTERED_PROTOCOLS[s]},p.bh=function(s,i){const l={};for(let g=0;g<s.length;g++){const v=i&&i[s[g].id]||Ng(s[g]);i&&(i[s[g].id]=v);let x=l[v];x||(x=l[v]=[]),x.push(s[g])}const f=[];for(const g in l)f.push(l[g]);return f},p.bi=ce,p.bj=Ov,p.bk=Fv,p.bl=gv,p.bm=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=yr/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const i=s.bucket.layers[0],l=i.layout,f=i._unevaluatedLayout._values,g={layoutIconSize:f["icon-size"].possiblyEvaluate(new Kn(s.bucket.zoom+1),s.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new Kn(s.bucket.zoom+1),s.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new Kn(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:D}=s.bucket.textSizeData;g.compositeTextSizes=[f["text-size"].possiblyEvaluate(new Kn(L),s.canonical),f["text-size"].possiblyEvaluate(new Kn(D),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:D}=s.bucket.iconSizeData;g.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new Kn(L),s.canonical),f["icon-size"].possiblyEvaluate(new Kn(D),s.canonical)]}const v=l.get("text-line-height")*Gr,x=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",w=l.get("text-keep-upright"),E=l.get("text-size");for(const L of s.bucket.features){const D=l.get("text-font").evaluate(L,{},s.canonical).join(","),k=E.evaluate(L,{},s.canonical),F=g.layoutTextSize.evaluate(L,{},s.canonical),V=g.layoutIconSize.evaluate(L,{},s.canonical),G={horizontal:{},vertical:void 0},H=L.text;let nt,lt=[0,0];if(H){const mt=H.toString(),Rt=l.get("text-letter-spacing").evaluate(L,{},s.canonical)*Gr,zt=Nd(mt)?Rt:0,oe=l.get("text-anchor").evaluate(L,{},s.canonical),fe=Kv(i,L,s.canonical);if(!fe){const Jt=l.get("text-radial-offset").evaluate(L,{},s.canonical);lt=Jt?Yv(oe,[Jt*Gr,dy]):l.get("text-offset").evaluate(L,{},s.canonical).map(Gt=>Gt*Gr)}let ie=x?"center":l.get("text-justify").evaluate(L,{},s.canonical);const ee=l.get("symbol-placement"),Ht=ee==="point"?l.get("text-max-width").evaluate(L,{},s.canonical)*Gr:0,he=()=>{s.bucket.allowVerticalPlacement&&Ul(mt)&&(G.vertical=em(H,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,oe,"left",zt,lt,p.ah.vertical,!0,ee,F,k))};if(!x&&fe){const Jt=new Set;if(ie==="auto")for(let xe=0;xe<fe.values.length;xe+=2)Jt.add(my(fe.values[xe]));else Jt.add(ie);let Gt=!1;for(const xe of Jt)if(!G.horizontal[xe])if(Gt)G.horizontal[xe]=G.horizontal[0];else{const de=em(H,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,"center",xe,zt,lt,p.ah.horizontal,!1,ee,F,k);de&&(G.horizontal[xe]=de,Gt=de.positionedLines.length===1)}he()}else{ie==="auto"&&(ie=my(oe));const Jt=em(H,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,oe,ie,zt,lt,p.ah.horizontal,!1,ee,F,k);Jt&&(G.horizontal[ie]=Jt),he(),Ul(mt)&&x&&w&&(G.vertical=em(H,s.glyphMap,s.glyphPositions,s.imagePositions,D,Ht,v,oe,ie,zt,lt,p.ah.vertical,!1,ee,F,k))}}let xt=!1;if(L.icon&&L.icon.name){const mt=s.imageMap[L.icon.name];mt&&(nt=mI(s.imagePositions[L.icon.name],l.get("icon-offset").evaluate(L,{},s.canonical),l.get("icon-anchor").evaluate(L,{},s.canonical)),xt=!!mt.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=xt:s.bucket.sdfIcons!==xt&&$t("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(mt.pixelRatio!==s.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const ut=Qv(G.horizontal)||G.vertical;s.bucket.iconsInText=!!ut&&ut.iconsInText,(ut||nt)&&DI(s.bucket,L,G,nt,s.imageMap,g,F,V,lt,xt,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},p.bn=$g,p.bo=Kg,p.bp=Qg,p.bq=ql,p.br=ey,p.bs=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},p.bt=function(s,i,l,f,g){return c(this,void 0,void 0,function*(){if(q())try{return yield nn(s,i,l,f,g)}catch{}return function(v,x,w,E,L){const D=v.width,k=v.height;Ze&&pe||(Ze=new OffscreenCanvas(D,k),pe=Ze.getContext("2d",{willReadFrequently:!0})),Ze.width=D,Ze.height=k,pe.drawImage(v,0,0,D,k);const F=pe.getImageData(x,w,E,L);return pe.clearRect(0,0,D,k),F.data}(s,i,l,f,g)})},p.bu=Nv,p.bv=b,p.bw=C,p.bx=av,p.by=Ja,p.bz=function(s){return s.message===Re},p.c=dn,p.d=s=>c(void 0,void 0,void 0,function*(){if(s.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(s)],{type:"image/png"});try{return createImageBitmap(i)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),p.e=Mt,p.f=s=>new Promise((i,l)=>{const f=new Image;f.onload=()=>{i(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=gn})},f.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(s)],{type:"image/png"});f.src=s.byteLength?URL.createObjectURL(g):gn}),p.g=He,p.h=(s,i)=>ve(Mt(s,{type:"json"}),i),p.i=Ie,p.j=Ce,p.k=yt,p.l=(s,i)=>ve(Mt(s,{type:"arrayBuffer"}),i),p.m=ve,p.n=function(s){return new ey(s).readFields(uI,[])},p.o=Zp,p.p=mv,p.q=ji,p.r=Og,p.s=yn,p.t=Fl,p.u=re,p.v=Lt,p.w=$t,p.x=$a,p.y=function([s,i,l]){return i+=90,i*=Math.PI/180,l*=Math.PI/180,{x:s*Math.cos(i)*Math.sin(l),y:s*Math.sin(i)*Math.sin(l),z:s*Math.cos(l)}},p.z=Pi}),a("worker",["./shared"],function(p){class c{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,B){for(const J of z){this._layerConfigs[J.id]=J;const pt=this._layers[J.id]=p.az(J);pt._featureFilter=p.a6(pt.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of B)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const j=p.bh(Object.values(this._layerConfigs),this.keyCache);for(const J of j){const pt=J.map(Nt=>this._layers[Nt.id]),ft=pt[0];if(ft.visibility==="none")continue;const vt=ft.source||"";let ct=this.familiesBySource[vt];ct||(ct=this.familiesBySource[vt]={});const wt=ft.sourceLayer||"_geojsonTileLayer";let Ft=ct[wt];Ft||(Ft=ct[wt]=[]),Ft.push(pt)}}}class b{constructor(z){const B={},j=[];for(const vt in z){const ct=z[vt],wt=B[vt]={};for(const Ft in ct){const Nt=ct[+Ft];if(!Nt||Nt.bitmap.width===0||Nt.bitmap.height===0)continue;const Ot={x:0,y:0,w:Nt.bitmap.width+2,h:Nt.bitmap.height+2};j.push(Ot),wt[Ft]={rect:Ot,metrics:Nt.metrics}}}const{w:J,h:pt}=p.p(j),ft=new p.o({width:J||1,height:pt||1});for(const vt in z){const ct=z[vt];for(const wt in ct){const Ft=ct[+wt];if(!Ft||Ft.bitmap.width===0||Ft.bitmap.height===0)continue;const Nt=B[vt][wt].rect;p.o.copy(Ft.bitmap,ft,{x:0,y:0},{x:Nt.x+1,y:Nt.y+1},Ft.bitmap)}}this.image=ft,this.positions=B}}p.bi("GlyphAtlas",b);class C{constructor(z){this.tileID=new p.Q(z.tileID.overscaledZ,z.tileID.wrap,z.tileID.canonical.z,z.tileID.canonical.x,z.tileID.canonical.y),this.uid=z.uid,this.zoom=z.zoom,this.pixelRatio=z.pixelRatio,this.tileSize=z.tileSize,this.source=z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=z.showCollisionBoxes,this.collectResourceTiming=!!z.collectResourceTiming,this.returnDependencies=!!z.returnDependencies,this.promoteId=z.promoteId,this.inFlightDependencies=[]}parse(z,B,j,J){return p._(this,void 0,void 0,function*(){this.status="parsing",this.data=z,this.collisionBoxArray=new p.a4;const pt=new p.bj(Object.keys(z.layers).sort()),ft=new p.bk(this.tileID,this.promoteId);ft.bucketLayerIDs=[];const vt={},ct={featureIndex:ft,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},wt=B.familiesBySource[this.source];for(const Ge in wt){const ur=z.layers[Ge];if(!ur)continue;ur.version===1&&p.w(`Vector tile source "${this.source}" layer "${Ge}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Br=pt.encode(Ge),Li=[];for(let Ui=0;Ui<ur.length;Ui++){const $r=ur.feature(Ui),ms=ft.getId($r,Ge);Li.push({feature:$r,id:ms,index:Ui,sourceLayerIndex:Br})}for(const Ui of wt[Ge]){const $r=Ui[0];$r.source!==this.source&&p.w(`layer.source = ${$r.source} does not equal this.source = ${this.source}`),$r.minzoom&&this.zoom<Math.floor($r.minzoom)||$r.maxzoom&&this.zoom>=$r.maxzoom||$r.visibility!=="none"&&(A(Ui,this.zoom,j),(vt[$r.id]=$r.createBucket({index:ft.bucketLayerIDs.length,layers:Ui,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Br,sourceID:this.source})).populate(Li,ct,this.tileID.canonical),ft.bucketLayerIDs.push(Ui.map(ms=>ms.id)))}}const Ft=p.aE(ct.glyphDependencies,Ge=>Object.keys(Ge).map(Number));this.inFlightDependencies.forEach(Ge=>Ge==null?void 0:Ge.abort()),this.inFlightDependencies=[];let Nt=Promise.resolve({});if(Object.keys(Ft).length){const Ge=new AbortController;this.inFlightDependencies.push(Ge),Nt=J.sendAsync({type:"GG",data:{stacks:Ft,source:this.source,tileID:this.tileID,type:"glyphs"}},Ge)}const Ot=Object.keys(ct.iconDependencies);let ge=Promise.resolve({});if(Ot.length){const Ge=new AbortController;this.inFlightDependencies.push(Ge),ge=J.sendAsync({type:"GI",data:{icons:Ot,source:this.source,tileID:this.tileID,type:"icons"}},Ge)}const be=Object.keys(ct.patternDependencies);let ze=Promise.resolve({});if(be.length){const Ge=new AbortController;this.inFlightDependencies.push(Ge),ze=J.sendAsync({type:"GI",data:{icons:be,source:this.source,tileID:this.tileID,type:"patterns"}},Ge)}const[Ae,un,Rn]=yield Promise.all([Nt,ge,ze]),Yn=new b(Ae),Ar=new p.bl(un,Rn);for(const Ge in vt){const ur=vt[Ge];ur instanceof p.a5?(A(ur.layers,this.zoom,j),p.bm({bucket:ur,glyphMap:Ae,glyphPositions:Yn.positions,imageMap:un,imagePositions:Ar.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):ur.hasPattern&&(ur instanceof p.bn||ur instanceof p.bo||ur instanceof p.bp)&&(A(ur.layers,this.zoom,j),ur.addFeatures(ct,this.tileID.canonical,Ar.patternPositions))}return this.status="done",{buckets:Object.values(vt).filter(Ge=>!Ge.isEmpty()),featureIndex:ft,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Yn.image,imageAtlas:Ar,glyphMap:this.returnDependencies?Ae:null,iconMap:this.returnDependencies?un:null,glyphPositions:this.returnDependencies?Yn.positions:null}})}}function A(rt,z,B){const j=new p.a8(z);for(const J of rt)J.recalculate(j,B)}class P{constructor(z,B,j){this.actor=z,this.layerIndex=B,this.availableImages=j,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(z,B){return p._(this,void 0,void 0,function*(){const j=yield p.l(z.request,B);try{return{vectorTile:new p.bq.VectorTile(new p.br(j.data)),rawData:j.data,cacheControl:j.cacheControl,expires:j.expires}}catch(J){const pt=new Uint8Array(j.data);let ft=`Unable to parse the tile at ${z.request.url}, `;throw ft+=pt[0]===31&&pt[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${J.messge}`,new Error(ft)}})}loadTile(z){return p._(this,void 0,void 0,function*(){const B=z.uid,j=!!(z&&z.request&&z.request.collectResourceTiming)&&new p.bs(z.request),J=new C(z);this.loading[B]=J;const pt=new AbortController;J.abort=pt;try{const ft=yield this.loadVectorTile(z,pt);if(delete this.loading[B],!ft)return null;const vt=ft.rawData,ct={};ft.expires&&(ct.expires=ft.expires),ft.cacheControl&&(ct.cacheControl=ft.cacheControl);const wt={};if(j){const Nt=j.finish();Nt&&(wt.resourceTiming=JSON.parse(JSON.stringify(Nt)))}J.vectorTile=ft.vectorTile;const Ft=J.parse(ft.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[B]=J,this.fetching[B]={rawTileData:vt,cacheControl:ct,resourceTiming:wt};try{const Nt=yield Ft;return p.e({rawTileData:vt.slice(0)},Nt,ct,wt)}finally{delete this.fetching[B]}}catch(ft){throw delete this.loading[B],J.status="done",this.loaded[B]=J,ft}})}reloadTile(z){return p._(this,void 0,void 0,function*(){const B=z.uid;if(!this.loaded||!this.loaded[B])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const j=this.loaded[B];if(j.showCollisionBoxes=z.showCollisionBoxes,j.status==="parsing"){const J=yield j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor);let pt;if(this.fetching[B]){const{rawTileData:ft,cacheControl:vt,resourceTiming:ct}=this.fetching[B];delete this.fetching[B],pt=p.e({rawTileData:ft.slice(0)},J,vt,ct)}else pt=J;return pt}if(j.status==="done"&&j.vectorTile)return j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(z){return p._(this,void 0,void 0,function*(){const B=this.loading,j=z.uid;B&&B[j]&&B[j].abort&&(B[j].abort.abort(),delete B[j])})}removeTile(z){return p._(this,void 0,void 0,function*(){this.loaded&&this.loaded[z.uid]&&delete this.loaded[z.uid]})}}class R{constructor(){this.loaded={}}loadTile(z){return p._(this,void 0,void 0,function*(){const{uid:B,encoding:j,rawImageData:J,redFactor:pt,greenFactor:ft,blueFactor:vt,baseShift:ct}=z,wt=J.width+2,Ft=J.height+2,Nt=p.b(J)?new p.R({width:wt,height:Ft},yield p.bt(J,-1,-1,wt,Ft)):J,Ot=new p.bu(B,Nt,j,pt,ft,vt,ct);return this.loaded=this.loaded||{},this.loaded[B]=Ot,Ot})}removeTile(z){const B=this.loaded,j=z.uid;B&&B[j]&&delete B[j]}}function et(rt,z){if(rt.length!==0){X(rt[0],z);for(var B=1;B<rt.length;B++)X(rt[B],!z)}}function X(rt,z){for(var B=0,j=0,J=0,pt=rt.length,ft=pt-1;J<pt;ft=J++){var vt=(rt[J][0]-rt[ft][0])*(rt[ft][1]+rt[J][1]),ct=B+vt;j+=Math.abs(B)>=Math.abs(vt)?B-ct+vt:vt-ct+B,B=ct}B+j>=0!=!!z&&rt.reverse()}var K=p.bv(function rt(z,B){var j,J=z&&z.type;if(J==="FeatureCollection")for(j=0;j<z.features.length;j++)rt(z.features[j],B);else if(J==="GeometryCollection")for(j=0;j<z.geometries.length;j++)rt(z.geometries[j],B);else if(J==="Feature")rt(z.geometry,B);else if(J==="Polygon")et(z.coordinates,B);else if(J==="MultiPolygon")for(j=0;j<z.coordinates.length;j++)et(z.coordinates[j],B);return z});const ot=p.bq.VectorTileFeature.prototype.toGeoJSON;var gt={exports:{}},q=p.bw,W=p.bq.VectorTileFeature,at=dt;function dt(rt,z){this.options=z||{},this.features=rt,this.length=rt.length}function Pt(rt,z){this.id=typeof rt.id=="number"?rt.id:void 0,this.type=rt.type,this.rawGeometry=rt.type===1?[rt.geometry]:rt.geometry,this.properties=rt.tags,this.extent=z||4096}dt.prototype.feature=function(rt){return new Pt(this.features[rt],this.options.extent)},Pt.prototype.loadGeometry=function(){var rt=this.rawGeometry;this.geometry=[];for(var z=0;z<rt.length;z++){for(var B=rt[z],j=[],J=0;J<B.length;J++)j.push(new q(B[J][0],B[J][1]));this.geometry.push(j)}return this.geometry},Pt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var rt=this.geometry,z=1/0,B=-1/0,j=1/0,J=-1/0,pt=0;pt<rt.length;pt++)for(var ft=rt[pt],vt=0;vt<ft.length;vt++){var ct=ft[vt];z=Math.min(z,ct.x),B=Math.max(B,ct.x),j=Math.min(j,ct.y),J=Math.max(J,ct.y)}return[z,j,B,J]},Pt.prototype.toGeoJSON=W.prototype.toGeoJSON;var Mt=p.bx,Tt=at;function Ut(rt){var z=new Mt;return function(B,j){for(var J in B.layers)j.writeMessage(3,qt,B.layers[J])}(rt,z),z.finish()}function qt(rt,z){var B;z.writeVarintField(15,rt.version||1),z.writeStringField(1,rt.name||""),z.writeVarintField(5,rt.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<rt.length;B++)j.feature=rt.feature(B),z.writeMessage(2,Q,j);var J=j.keys;for(B=0;B<J.length;B++)z.writeStringField(3,J[B]);var pt=j.values;for(B=0;B<pt.length;B++)z.writeMessage(4,Ie,pt[B])}function Q(rt,z){var B=rt.feature;B.id!==void 0&&z.writeVarintField(1,B.id),z.writeMessage(2,Et,rt),z.writeVarintField(3,B.type),z.writeMessage(4,Ye,B)}function Et(rt,z){var B=rt.feature,j=rt.keys,J=rt.values,pt=rt.keycache,ft=rt.valuecache;for(var vt in B.properties){var ct=B.properties[vt],wt=pt[vt];if(ct!==null){wt===void 0&&(j.push(vt),pt[vt]=wt=j.length-1),z.writeVarint(wt);var Ft=typeof ct;Ft!=="string"&&Ft!=="boolean"&&Ft!=="number"&&(ct=JSON.stringify(ct));var Nt=Ft+":"+ct,Ot=ft[Nt];Ot===void 0&&(J.push(ct),ft[Nt]=Ot=J.length-1),z.writeVarint(Ot)}}}function $t(rt,z){return(z<<3)+(7&rt)}function le(rt){return rt<<1^rt>>31}function Ye(rt,z){for(var B=rt.loadGeometry(),j=rt.type,J=0,pt=0,ft=B.length,vt=0;vt<ft;vt++){var ct=B[vt],wt=1;j===1&&(wt=ct.length),z.writeVarint($t(1,wt));for(var Ft=j===3?ct.length-1:ct.length,Nt=0;Nt<Ft;Nt++){Nt===1&&j!==1&&z.writeVarint($t(2,Ft-1));var Ot=ct[Nt].x-J,ge=ct[Nt].y-pt;z.writeVarint(le(Ot)),z.writeVarint(le(ge)),J+=Ot,pt+=ge}j===3&&z.writeVarint($t(7,1))}}function Ie(rt,z){var B=typeof rt;B==="string"?z.writeStringField(1,rt):B==="boolean"?z.writeBooleanField(7,rt):B==="number"&&(rt%1!=0?z.writeDoubleField(3,rt):rt<0?z.writeSVarintField(6,rt):z.writeVarintField(5,rt))}gt.exports=Ut,gt.exports.fromVectorTileJs=Ut,gt.exports.fromGeojsonVt=function(rt,z){z=z||{};var B={};for(var j in rt)B[j]=new Tt(rt[j].features,z),B[j].name=j,B[j].version=z.version,B[j].extent=z.extent;return Ut({layers:B})},gt.exports.GeoJSONWrapper=Tt;var ue=p.bv(gt.exports);const je={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:rt=>rt},gn=Math.fround||(nn=new Float32Array(1),rt=>(nn[0]=+rt,nn[0]));var nn;const Ze=3,pe=5,Re=6;class dn{constructor(z){this.options=Object.assign(Object.create(je),z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(z){const{log:B,minZoom:j,maxZoom:J}=this.options;B&&console.time("total time");const pt=`prepare ${z.length} points`;B&&console.time(pt),this.points=z;const ft=[];for(let ct=0;ct<z.length;ct++){const wt=z[ct];if(!wt.geometry)continue;const[Ft,Nt]=wt.geometry.coordinates,Ot=gn(mn(Ft)),ge=gn(Dn(Nt));ft.push(Ot,ge,1/0,ct,-1,1),this.options.reduce&&ft.push(0)}let vt=this.trees[J+1]=this._createTree(ft);B&&console.timeEnd(pt);for(let ct=J;ct>=j;ct--){const wt=+Date.now();vt=this.trees[ct]=this._createTree(this._cluster(vt,ct)),B&&console.log("z%d: %d clusters in %dms",ct,vt.numItems,+Date.now()-wt)}return B&&console.timeEnd("total time"),this}getClusters(z,B){let j=((z[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,z[1]));let pt=z[2]===180?180:((z[2]+180)%360+360)%360-180;const ft=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)j=-180,pt=180;else if(j>pt){const Nt=this.getClusters([j,J,180,ft],B),Ot=this.getClusters([-180,J,pt,ft],B);return Nt.concat(Ot)}const vt=this.trees[this._limitZoom(B)],ct=vt.range(mn(j),Dn(ft),mn(pt),Dn(J)),wt=vt.data,Ft=[];for(const Nt of ct){const Ot=this.stride*Nt;Ft.push(wt[Ot+pe]>1?rn(wt,Ot,this.clusterProps):this.points[wt[Ot+Ze]])}return Ft}getChildren(z){const B=this._getOriginId(z),j=this._getOriginZoom(z),J="No cluster with the specified id.",pt=this.trees[j];if(!pt)throw new Error(J);const ft=pt.data;if(B*this.stride>=ft.length)throw new Error(J);const vt=this.options.radius/(this.options.extent*Math.pow(2,j-1)),ct=pt.within(ft[B*this.stride],ft[B*this.stride+1],vt),wt=[];for(const Ft of ct){const Nt=Ft*this.stride;ft[Nt+4]===z&&wt.push(ft[Nt+pe]>1?rn(ft,Nt,this.clusterProps):this.points[ft[Nt+Ze]])}if(wt.length===0)throw new Error(J);return wt}getLeaves(z,B,j){const J=[];return this._appendLeaves(J,z,B=B||10,j=j||0,0),J}getTile(z,B,j){const J=this.trees[this._limitZoom(z)],pt=Math.pow(2,z),{extent:ft,radius:vt}=this.options,ct=vt/ft,wt=(j-ct)/pt,Ft=(j+1+ct)/pt,Nt={features:[]};return this._addTileFeatures(J.range((B-ct)/pt,wt,(B+1+ct)/pt,Ft),J.data,B,j,pt,Nt),B===0&&this._addTileFeatures(J.range(1-ct/pt,wt,1,Ft),J.data,pt,j,pt,Nt),B===pt-1&&this._addTileFeatures(J.range(0,wt,ct/pt,Ft),J.data,-1,j,pt,Nt),Nt.features.length?Nt:null}getClusterExpansionZoom(z){let B=this._getOriginZoom(z)-1;for(;B<=this.options.maxZoom;){const j=this.getChildren(z);if(B++,j.length!==1)break;z=j[0].properties.cluster_id}return B}_appendLeaves(z,B,j,J,pt){const ft=this.getChildren(B);for(const vt of ft){const ct=vt.properties;if(ct&&ct.cluster?pt+ct.point_count<=J?pt+=ct.point_count:pt=this._appendLeaves(z,ct.cluster_id,j,J,pt):pt<J?pt++:z.push(vt),z.length===j)break}return pt}_createTree(z){const B=new p.au(z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<z.length;j+=this.stride)B.add(z[j],z[j+1]);return B.finish(),B.data=z,B}_addTileFeatures(z,B,j,J,pt,ft){for(const vt of z){const ct=vt*this.stride,wt=B[ct+pe]>1;let Ft,Nt,Ot;if(wt)Ft=He(B,ct,this.clusterProps),Nt=B[ct],Ot=B[ct+1];else{const ze=this.points[B[ct+Ze]];Ft=ze.properties;const[Ae,un]=ze.geometry.coordinates;Nt=mn(Ae),Ot=Dn(un)}const ge={type:1,geometry:[[Math.round(this.options.extent*(Nt*pt-j)),Math.round(this.options.extent*(Ot*pt-J))]],tags:Ft};let be;be=wt||this.options.generateId?B[ct+Ze]:this.points[B[ct+Ze]].id,be!==void 0&&(ge.id=be),ft.features.push(ge)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,B){const{radius:j,extent:J,reduce:pt,minPoints:ft}=this.options,vt=j/(J*Math.pow(2,B)),ct=z.data,wt=[],Ft=this.stride;for(let Nt=0;Nt<ct.length;Nt+=Ft){if(ct[Nt+2]<=B)continue;ct[Nt+2]=B;const Ot=ct[Nt],ge=ct[Nt+1],be=z.within(ct[Nt],ct[Nt+1],vt),ze=ct[Nt+pe];let Ae=ze;for(const un of be){const Rn=un*Ft;ct[Rn+2]>B&&(Ae+=ct[Rn+pe])}if(Ae>ze&&Ae>=ft){let un,Rn=Ot*ze,Yn=ge*ze,Ar=-1;const Ge=((Nt/Ft|0)<<5)+(B+1)+this.points.length;for(const ur of be){const Br=ur*Ft;if(ct[Br+2]<=B)continue;ct[Br+2]=B;const Li=ct[Br+pe];Rn+=ct[Br]*Li,Yn+=ct[Br+1]*Li,ct[Br+4]=Ge,pt&&(un||(un=this._map(ct,Nt,!0),Ar=this.clusterProps.length,this.clusterProps.push(un)),pt(un,this._map(ct,Br)))}ct[Nt+4]=Ge,wt.push(Rn/Ae,Yn/Ae,1/0,Ge,-1,Ae),pt&&wt.push(Ar)}else{for(let un=0;un<Ft;un++)wt.push(ct[Nt+un]);if(Ae>1)for(const un of be){const Rn=un*Ft;if(!(ct[Rn+2]<=B)){ct[Rn+2]=B;for(let Yn=0;Yn<Ft;Yn++)wt.push(ct[Rn+Yn])}}}}return wt}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,B,j){if(z[B+pe]>1){const ft=this.clusterProps[z[B+Re]];return j?Object.assign({},ft):ft}const J=this.points[z[B+Ze]].properties,pt=this.options.map(J);return j&&pt===J?Object.assign({},pt):pt}}function rn(rt,z,B){return{type:"Feature",id:rt[z+Ze],properties:He(rt,z,B),geometry:{type:"Point",coordinates:[(j=rt[z],360*(j-.5)),kn(rt[z+1])]}};var j}function He(rt,z,B){const j=rt[z+pe],J=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,pt=rt[z+Re],ft=pt===-1?{}:Object.assign({},B[pt]);return Object.assign(ft,{cluster:!0,cluster_id:rt[z+Ze],point_count:j,point_count_abbreviated:J})}function mn(rt){return rt/360+.5}function Dn(rt){const z=Math.sin(rt*Math.PI/180),B=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return B<0?0:B>1?1:B}function kn(rt){const z=(180-360*rt)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function ve(rt,z,B,j){for(var J,pt=j,ft=B-z>>1,vt=B-z,ct=rt[z],wt=rt[z+1],Ft=rt[B],Nt=rt[B+1],Ot=z+3;Ot<B;Ot+=3){var ge=yn(rt[Ot],rt[Ot+1],ct,wt,Ft,Nt);if(ge>pt)J=Ot,pt=ge;else if(ge===pt){var be=Math.abs(Ot-ft);be<vt&&(J=Ot,vt=be)}}pt>j&&(J-z>3&&ve(rt,z,J,j),rt[J+2]=pt,B-J>3&&ve(rt,J,B,j))}function yn(rt,z,B,j,J,pt){var ft=J-B,vt=pt-j;if(ft!==0||vt!==0){var ct=((rt-B)*ft+(z-j)*vt)/(ft*ft+vt*vt);ct>1?(B=J,j=pt):ct>0&&(B+=ft*ct,j+=vt*ct)}return(ft=rt-B)*ft+(vt=z-j)*vt}function Xn(rt,z,B,j){var J={id:rt===void 0?null:rt,type:z,geometry:B,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pt){var ft=pt.geometry,vt=pt.type;if(vt==="Point"||vt==="MultiPoint"||vt==="LineString")Y(pt,ft);else if(vt==="Polygon"||vt==="MultiLineString")for(var ct=0;ct<ft.length;ct++)Y(pt,ft[ct]);else if(vt==="MultiPolygon")for(ct=0;ct<ft.length;ct++)for(var wt=0;wt<ft[ct].length;wt++)Y(pt,ft[ct][wt])}(J),J}function Y(rt,z){for(var B=0;B<z.length;B+=3)rt.minX=Math.min(rt.minX,z[B]),rt.minY=Math.min(rt.minY,z[B+1]),rt.maxX=Math.max(rt.maxX,z[B]),rt.maxY=Math.max(rt.maxY,z[B+1])}function yt(rt,z,B,j){if(z.geometry){var J=z.geometry.coordinates,pt=z.geometry.type,ft=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),vt=[],ct=z.id;if(B.promoteId?ct=z.properties[B.promoteId]:B.generateId&&(ct=j||0),pt==="Point")Ce(J,vt);else if(pt==="MultiPoint")for(var wt=0;wt<J.length;wt++)Ce(J[wt],vt);else if(pt==="LineString")Ke(J,vt,ft,!1);else if(pt==="MultiLineString"){if(B.lineMetrics){for(wt=0;wt<J.length;wt++)Ke(J[wt],vt=[],ft,!1),rt.push(Xn(ct,"LineString",vt,z.properties));return}Lt(J,vt,ft,!1)}else if(pt==="Polygon")Lt(J,vt,ft,!0);else{if(pt!=="MultiPolygon"){if(pt==="GeometryCollection"){for(wt=0;wt<z.geometry.geometries.length;wt++)yt(rt,{id:ct,geometry:z.geometry.geometries[wt],properties:z.properties},B,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(wt=0;wt<J.length;wt++){var Ft=[];Lt(J[wt],Ft,ft,!0),vt.push(Ft)}}rt.push(Xn(ct,pt,vt,z.properties))}}function Ce(rt,z){z.push(nr(rt[0])),z.push(qo(rt[1])),z.push(0)}function Ke(rt,z,B,j){for(var J,pt,ft=0,vt=0;vt<rt.length;vt++){var ct=nr(rt[vt][0]),wt=qo(rt[vt][1]);z.push(ct),z.push(wt),z.push(0),vt>0&&(ft+=j?(J*wt-ct*pt)/2:Math.sqrt(Math.pow(ct-J,2)+Math.pow(wt-pt,2))),J=ct,pt=wt}var Ft=z.length-3;z[2]=1,ve(z,0,Ft,B),z[Ft+2]=1,z.size=Math.abs(ft),z.start=0,z.end=z.size}function Lt(rt,z,B,j){for(var J=0;J<rt.length;J++){var pt=[];Ke(rt[J],pt,B,j),z.push(pt)}}function nr(rt){return rt/360+.5}function qo(rt){var z=Math.sin(rt*Math.PI/180),B=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return B<0?0:B>1?1:B}function tn(rt,z,B,j,J,pt,ft,vt){if(j/=z,pt>=(B/=z)&&ft<j)return rt;if(ft<B||pt>=j)return null;for(var ct=[],wt=0;wt<rt.length;wt++){var Ft=rt[wt],Nt=Ft.geometry,Ot=Ft.type,ge=J===0?Ft.minX:Ft.minY,be=J===0?Ft.maxX:Ft.maxY;if(ge>=B&&be<j)ct.push(Ft);else if(!(be<B||ge>=j)){var ze=[];if(Ot==="Point"||Ot==="MultiPoint")zr(Nt,ze,B,j,J);else if(Ot==="LineString")Cl(Nt,ze,B,j,J,!1,vt.lineMetrics);else if(Ot==="MultiLineString")Ll(Nt,ze,B,j,J,!1);else if(Ot==="Polygon")Ll(Nt,ze,B,j,J,!0);else if(Ot==="MultiPolygon")for(var Ae=0;Ae<Nt.length;Ae++){var un=[];Ll(Nt[Ae],un,B,j,J,!0),un.length&&ze.push(un)}if(ze.length){if(vt.lineMetrics&&Ot==="LineString"){for(Ae=0;Ae<ze.length;Ae++)ct.push(Xn(Ft.id,Ot,ze[Ae],Ft.tags));continue}Ot!=="LineString"&&Ot!=="MultiLineString"||(ze.length===1?(Ot="LineString",ze=ze[0]):Ot="MultiLineString"),Ot!=="Point"&&Ot!=="MultiPoint"||(Ot=ze.length===3?"Point":"MultiPoint"),ct.push(Xn(Ft.id,Ot,ze,Ft.tags))}}}return ct.length?ct:null}function zr(rt,z,B,j,J){for(var pt=0;pt<rt.length;pt+=3){var ft=rt[pt+J];ft>=B&&ft<=j&&(z.push(rt[pt]),z.push(rt[pt+1]),z.push(rt[pt+2]))}}function Cl(rt,z,B,j,J,pt,ft){for(var vt,ct,wt=Tl(rt),Ft=J===0?ga:mc,Nt=rt.start,Ot=0;Ot<rt.length-3;Ot+=3){var ge=rt[Ot],be=rt[Ot+1],ze=rt[Ot+2],Ae=rt[Ot+3],un=rt[Ot+4],Rn=J===0?ge:be,Yn=J===0?Ae:un,Ar=!1;ft&&(vt=Math.sqrt(Math.pow(ge-Ae,2)+Math.pow(be-un,2))),Rn<B?Yn>B&&(ct=Ft(wt,ge,be,Ae,un,B),ft&&(wt.start=Nt+vt*ct)):Rn>j?Yn<j&&(ct=Ft(wt,ge,be,Ae,un,j),ft&&(wt.start=Nt+vt*ct)):Pl(wt,ge,be,ze),Yn<B&&Rn>=B&&(ct=Ft(wt,ge,be,Ae,un,B),Ar=!0),Yn>j&&Rn<=j&&(ct=Ft(wt,ge,be,Ae,un,j),Ar=!0),!pt&&Ar&&(ft&&(wt.end=Nt+vt*ct),z.push(wt),wt=Tl(rt)),ft&&(Nt+=vt)}var Ge=rt.length-3;ge=rt[Ge],be=rt[Ge+1],ze=rt[Ge+2],(Rn=J===0?ge:be)>=B&&Rn<=j&&Pl(wt,ge,be,ze),Ge=wt.length-3,pt&&Ge>=3&&(wt[Ge]!==wt[0]||wt[Ge+1]!==wt[1])&&Pl(wt,wt[0],wt[1],wt[2]),wt.length&&z.push(wt)}function Tl(rt){var z=[];return z.size=rt.size,z.start=rt.start,z.end=rt.end,z}function Ll(rt,z,B,j,J,pt){for(var ft=0;ft<rt.length;ft++)Cl(rt[ft],z,B,j,J,pt,!1)}function Pl(rt,z,B,j){rt.push(z),rt.push(B),rt.push(j)}function ga(rt,z,B,j,J,pt){var ft=(pt-z)/(j-z);return rt.push(pt),rt.push(B+(J-B)*ft),rt.push(1),ft}function mc(rt,z,B,j,J,pt){var ft=(pt-B)/(J-B);return rt.push(z+(j-z)*ft),rt.push(pt),rt.push(1),ft}function Za(rt,z){for(var B=[],j=0;j<rt.length;j++){var J,pt=rt[j],ft=pt.type;if(ft==="Point"||ft==="MultiPoint"||ft==="LineString")J=Zt(pt.geometry,z);else if(ft==="MultiLineString"||ft==="Polygon"){J=[];for(var vt=0;vt<pt.geometry.length;vt++)J.push(Zt(pt.geometry[vt],z))}else if(ft==="MultiPolygon")for(J=[],vt=0;vt<pt.geometry.length;vt++){for(var ct=[],wt=0;wt<pt.geometry[vt].length;wt++)ct.push(Zt(pt.geometry[vt][wt],z));J.push(ct)}B.push(Xn(pt.id,ft,J,pt.tags))}return B}function Zt(rt,z){var B=[];B.size=rt.size,rt.start!==void 0&&(B.start=rt.start,B.end=rt.end);for(var j=0;j<rt.length;j+=3)B.push(rt[j]+z,rt[j+1],rt[j+2]);return B}function fs(rt,z){if(rt.transformed)return rt;var B,j,J,pt=1<<rt.z,ft=rt.x,vt=rt.y;for(B=0;B<rt.features.length;B++){var ct=rt.features[B],wt=ct.geometry,Ft=ct.type;if(ct.geometry=[],Ft===1)for(j=0;j<wt.length;j+=2)ct.geometry.push(lo(wt[j],wt[j+1],z,pt,ft,vt));else for(j=0;j<wt.length;j++){var Nt=[];for(J=0;J<wt[j].length;J+=2)Nt.push(lo(wt[j][J],wt[j][J+1],z,pt,ft,vt));ct.geometry.push(Nt)}}return rt.transformed=!0,rt}function lo(rt,z,B,j,J,pt){return[Math.round(B*(rt*j-J)),Math.round(B*(z*j-pt))]}function gu(rt,z,B,j,J){for(var pt=z===J.maxZoom?0:J.tolerance/((1<<z)*J.extent),ft={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:j,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},vt=0;vt<rt.length;vt++){ft.numFeatures++,di(ft,rt[vt],pt,J);var ct=rt[vt].minX,wt=rt[vt].minY,Ft=rt[vt].maxX,Nt=rt[vt].maxY;ct<ft.minX&&(ft.minX=ct),wt<ft.minY&&(ft.minY=wt),Ft>ft.maxX&&(ft.maxX=Ft),Nt>ft.maxY&&(ft.maxY=Nt)}return ft}function di(rt,z,B,j){var J=z.geometry,pt=z.type,ft=[];if(pt==="Point"||pt==="MultiPoint")for(var vt=0;vt<J.length;vt+=3)ft.push(J[vt]),ft.push(J[vt+1]),rt.numPoints++,rt.numSimplified++;else if(pt==="LineString")te(ft,J,rt,B,!1,!1);else if(pt==="MultiLineString"||pt==="Polygon")for(vt=0;vt<J.length;vt++)te(ft,J[vt],rt,B,pt==="Polygon",vt===0);else if(pt==="MultiPolygon")for(var ct=0;ct<J.length;ct++){var wt=J[ct];for(vt=0;vt<wt.length;vt++)te(ft,wt[vt],rt,B,!0,vt===0)}if(ft.length){var Ft=z.tags||null;if(pt==="LineString"&&j.lineMetrics){for(var Nt in Ft={},z.tags)Ft[Nt]=z.tags[Nt];Ft.mapbox_clip_start=J.start/J.size,Ft.mapbox_clip_end=J.end/J.size}var Ot={geometry:ft,type:pt==="Polygon"||pt==="MultiPolygon"?3:pt==="LineString"||pt==="MultiLineString"?2:1,tags:Ft};z.id!==null&&(Ot.id=z.id),rt.features.push(Ot)}}function te(rt,z,B,j,J,pt){var ft=j*j;if(j>0&&z.size<(J?ft:j))B.numPoints+=z.length/3;else{for(var vt=[],ct=0;ct<z.length;ct+=3)(j===0||z[ct+2]>ft)&&(B.numSimplified++,vt.push(z[ct]),vt.push(z[ct+1])),B.numPoints++;J&&function(wt,Ft){for(var Nt=0,Ot=0,ge=wt.length,be=ge-2;Ot<ge;be=Ot,Ot+=2)Nt+=(wt[Ot]-wt[be])*(wt[Ot+1]+wt[be+1]);if(Nt>0===Ft)for(Ot=0,ge=wt.length;Ot<ge/2;Ot+=2){var ze=wt[Ot],Ae=wt[Ot+1];wt[Ot]=wt[ge-2-Ot],wt[Ot+1]=wt[ge-1-Ot],wt[ge-2-Ot]=ze,wt[ge-1-Ot]=Ae}}(vt,pt),rt.push(vt)}}function We(rt,z){var B=(z=this.options=function(J,pt){for(var ft in pt)J[ft]=pt[ft];return J}(Object.create(this.options),z)).debug;if(B&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(J,pt){var ft=[];if(J.type==="FeatureCollection")for(var vt=0;vt<J.features.length;vt++)yt(ft,J.features[vt],pt,vt);else yt(ft,J.type==="Feature"?J:{geometry:J},pt);return ft}(rt,z);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(J,pt){var ft=pt.buffer/pt.extent,vt=J,ct=tn(J,1,-1-ft,ft,0,-1,2,pt),wt=tn(J,1,1-ft,2+ft,0,-1,2,pt);return(ct||wt)&&(vt=tn(J,1,-ft,1+ft,0,-1,2,pt)||[],ct&&(vt=Za(ct,1).concat(vt)),wt&&(vt=vt.concat(Za(wt,-1)))),vt}(j,z),j.length&&this.splitTile(j,0,0,0),B&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ue(rt,z,B){return 32*((1<<rt)*B+z)+rt}function Pr(rt,z){return z?rt.properties[z]:rt.id}function ds(rt,z){if(rt==null)return!0;if(rt.type==="Feature")return Pr(rt,z)!=null;if(rt.type==="FeatureCollection"){const B=new Set;for(const j of rt.features){const J=Pr(j,z);if(J==null||B.has(J))return!1;B.add(J)}return!0}return!1}function Oe(rt,z){const B=new Map;if(rt!=null)if(rt.type==="Feature")B.set(Pr(rt,z),rt);else for(const j of rt.features)B.set(Pr(j,z),j);return B}We.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},We.prototype.splitTile=function(rt,z,B,j,J,pt,ft){for(var vt=[rt,z,B,j],ct=this.options,wt=ct.debug;vt.length;){j=vt.pop(),B=vt.pop(),z=vt.pop(),rt=vt.pop();var Ft=1<<z,Nt=Ue(z,B,j),Ot=this.tiles[Nt];if(!Ot&&(wt>1&&console.time("creation"),Ot=this.tiles[Nt]=gu(rt,z,B,j,ct),this.tileCoords.push({z,x:B,y:j}),wt)){wt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,B,j,Ot.numFeatures,Ot.numPoints,Ot.numSimplified),console.timeEnd("creation"));var ge="z"+z;this.stats[ge]=(this.stats[ge]||0)+1,this.total++}if(Ot.source=rt,J){if(z===ct.maxZoom||z===J)continue;var be=1<<J-z;if(B!==Math.floor(pt/be)||j!==Math.floor(ft/be))continue}else if(z===ct.indexMaxZoom||Ot.numPoints<=ct.indexMaxPoints)continue;if(Ot.source=null,rt.length!==0){wt>1&&console.time("clipping");var ze,Ae,un,Rn,Yn,Ar,Ge=.5*ct.buffer/ct.extent,ur=.5-Ge,Br=.5+Ge,Li=1+Ge;ze=Ae=un=Rn=null,Yn=tn(rt,Ft,B-Ge,B+Br,0,Ot.minX,Ot.maxX,ct),Ar=tn(rt,Ft,B+ur,B+Li,0,Ot.minX,Ot.maxX,ct),rt=null,Yn&&(ze=tn(Yn,Ft,j-Ge,j+Br,1,Ot.minY,Ot.maxY,ct),Ae=tn(Yn,Ft,j+ur,j+Li,1,Ot.minY,Ot.maxY,ct),Yn=null),Ar&&(un=tn(Ar,Ft,j-Ge,j+Br,1,Ot.minY,Ot.maxY,ct),Rn=tn(Ar,Ft,j+ur,j+Li,1,Ot.minY,Ot.maxY,ct),Ar=null),wt>1&&console.timeEnd("clipping"),vt.push(ze||[],z+1,2*B,2*j),vt.push(Ae||[],z+1,2*B,2*j+1),vt.push(un||[],z+1,2*B+1,2*j),vt.push(Rn||[],z+1,2*B+1,2*j+1)}}},We.prototype.getTile=function(rt,z,B){var j=this.options,J=j.extent,pt=j.debug;if(rt<0||rt>24)return null;var ft=1<<rt,vt=Ue(rt,z=(z%ft+ft)%ft,B);if(this.tiles[vt])return fs(this.tiles[vt],J);pt>1&&console.log("drilling down to z%d-%d-%d",rt,z,B);for(var ct,wt=rt,Ft=z,Nt=B;!ct&&wt>0;)wt--,Ft=Math.floor(Ft/2),Nt=Math.floor(Nt/2),ct=this.tiles[Ue(wt,Ft,Nt)];return ct&&ct.source?(pt>1&&console.log("found parent tile z%d-%d-%d",wt,Ft,Nt),pt>1&&console.time("drilling down"),this.splitTile(ct.source,wt,Ft,Nt,rt,z,B),pt>1&&console.timeEnd("drilling down"),this.tiles[vt]?fs(this.tiles[vt],J):null):null};class Ha extends P{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(z,B){return p._(this,void 0,void 0,function*(){const j=z.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const J=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!J)return null;const pt=new class{constructor(vt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=p.W,this.length=vt.length,this._features=vt}feature(vt){return new class{constructor(ct){this._feature=ct,this.extent=p.W,this.type=ct.type,this.properties=ct.tags,"id"in ct&&!isNaN(ct.id)&&(this.id=parseInt(ct.id,10))}loadGeometry(){if(this._feature.type===1){const ct=[];for(const wt of this._feature.geometry)ct.push([new p.P(wt[0],wt[1])]);return ct}{const ct=[];for(const wt of this._feature.geometry){const Ft=[];for(const Nt of wt)Ft.push(new p.P(Nt[0],Nt[1]));ct.push(Ft)}return ct}}toGeoJSON(ct,wt,Ft){return ot.call(this,ct,wt,Ft)}}(this._features[vt])}}(J.features);let ft=ue(pt);return ft.byteOffset===0&&ft.byteLength===ft.buffer.byteLength||(ft=new Uint8Array(ft)),{vectorTile:pt,rawData:ft.buffer}})}loadData(z){return p._(this,void 0,void 0,function*(){var B;(B=this._pendingRequest)===null||B===void 0||B.abort();const j=!!(z&&z.request&&z.request.collectResourceTiming)&&new p.bs(z.request);this._pendingRequest=new AbortController;try{let J=yield this.loadGeoJSON(z,this._pendingRequest);if(delete this._pendingRequest,typeof J!="object")throw new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`);if(K(J,!0),z.filter){const ft=p.by(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ft.result==="error")throw new Error(ft.value.map(ct=>`${ct.key}: ${ct.message}`).join(", "));J={type:"FeatureCollection",features:J.features.filter(ct=>ft.value.evaluate({zoom:0},ct))}}this._geoJSONIndex=z.cluster?new dn(function({superclusterOptions:ft,clusterProperties:vt}){if(!vt||!ft)return ft;const ct={},wt={},Ft={accumulated:null,zoom:0},Nt={properties:null},Ot=Object.keys(vt);for(const ge of Ot){const[be,ze]=vt[ge],Ae=p.by(ze),un=p.by(typeof be=="string"?[be,["accumulated"],["get",ge]]:be);ct[ge]=Ae.value,wt[ge]=un.value}return ft.map=ge=>{Nt.properties=ge;const be={};for(const ze of Ot)be[ze]=ct[ze].evaluate(Ft,Nt);return be},ft.reduce=(ge,be)=>{Nt.properties=be;for(const ze of Ot)Ft.accumulated=ge[ze],ge[ze]=wt[ze].evaluate(Ft,Nt)},ft}(z)).load(J.features):function(ft,vt){return new We(ft,vt)}(J,z.geojsonVtOptions),this.loaded={};const pt={};if(j){const ft=j.finish();ft&&(pt.resourceTiming={},pt.resourceTiming[z.source]=JSON.parse(JSON.stringify(ft)))}return pt}catch(J){if(delete this._pendingRequest,p.bz(J))return{abandoned:!0};throw J}})}reloadTile(z){const B=this.loaded;return B&&B[z.uid]?super.reloadTile(z):this.loadTile(z)}loadGeoJSON(z,B){return p._(this,void 0,void 0,function*(){const{promoteId:j}=z;if(z.request){const J=yield p.h(z.request,B);return this._dataUpdateable=ds(J.data,j)?Oe(J.data,j):void 0,J.data}if(typeof z.data=="string")try{const J=JSON.parse(z.data);return this._dataUpdateable=ds(J,j)?Oe(J,j):void 0,J}catch{throw new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`)}if(!z.dataDiff)throw new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${z.source}`);return function(J,pt,ft){var vt,ct,wt,Ft;if(pt.removeAll&&J.clear(),pt.remove)for(const Nt of pt.remove)J.delete(Nt);if(pt.add)for(const Nt of pt.add){const Ot=Pr(Nt,ft);Ot!=null&&J.set(Ot,Nt)}if(pt.update)for(const Nt of pt.update){let Ot=J.get(Nt.id);if(Ot==null)continue;const ge=!Nt.removeAllProperties&&(((vt=Nt.removeProperties)===null||vt===void 0?void 0:vt.length)>0||((ct=Nt.addOrUpdateProperties)===null||ct===void 0?void 0:ct.length)>0);if((Nt.newGeometry||Nt.removeAllProperties||ge)&&(Ot=Object.assign({},Ot),J.set(Nt.id,Ot),ge&&(Ot.properties=Object.assign({},Ot.properties))),Nt.newGeometry&&(Ot.geometry=Nt.newGeometry),Nt.removeAllProperties)Ot.properties={};else if(((wt=Nt.removeProperties)===null||wt===void 0?void 0:wt.length)>0)for(const be of Nt.removeProperties)Object.prototype.hasOwnProperty.call(Ot.properties,be)&&delete Ot.properties[be];if(((Ft=Nt.addOrUpdateProperties)===null||Ft===void 0?void 0:Ft.length)>0)for(const{key:be,value:ze}of Nt.addOrUpdateProperties)Ot.properties[be]=ze}}(this._dataUpdateable,z.dataDiff,j),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(z){return p._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(z){return this._geoJSONIndex.getClusterExpansionZoom(z.clusterId)}getClusterChildren(z){return this._geoJSONIndex.getChildren(z.clusterId)}getClusterLeaves(z){return this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset)}}class Fr{constructor(z){this.self=z,this.actor=new p.C(z),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(B,j)=>{if(this.externalWorkerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.externalWorkerSourceTypes[B]=j},this.self.addProtocol=p.bf,this.self.removeProtocol=p.bg,this.self.registerRTLTextPlugin=B=>{if(p.bA.isParsed())throw new Error("RTL text plugin already registered.");p.bA.setMethods(B)},this.actor.registerMessageHandler("LDT",(B,j)=>this._getDEMWorkerSource(B,j.source).loadTile(j)),this.actor.registerMessageHandler("RDT",(B,j)=>p._(this,void 0,void 0,function*(){this._getDEMWorkerSource(B,j.source).removeTile(j)})),this.actor.registerMessageHandler("GCEZ",(B,j)=>p._(this,void 0,void 0,function*(){return this._getWorkerSource(B,j.type,j.source).getClusterExpansionZoom(j)})),this.actor.registerMessageHandler("GCC",(B,j)=>p._(this,void 0,void 0,function*(){return this._getWorkerSource(B,j.type,j.source).getClusterChildren(j)})),this.actor.registerMessageHandler("GCL",(B,j)=>p._(this,void 0,void 0,function*(){return this._getWorkerSource(B,j.type,j.source).getClusterLeaves(j)})),this.actor.registerMessageHandler("LD",(B,j)=>this._getWorkerSource(B,j.type,j.source).loadData(j)),this.actor.registerMessageHandler("LT",(B,j)=>this._getWorkerSource(B,j.type,j.source).loadTile(j)),this.actor.registerMessageHandler("RT",(B,j)=>this._getWorkerSource(B,j.type,j.source).reloadTile(j)),this.actor.registerMessageHandler("AT",(B,j)=>this._getWorkerSource(B,j.type,j.source).abortTile(j)),this.actor.registerMessageHandler("RMT",(B,j)=>this._getWorkerSource(B,j.type,j.source).removeTile(j)),this.actor.registerMessageHandler("RS",(B,j)=>p._(this,void 0,void 0,function*(){if(!this.workerSources[B]||!this.workerSources[B][j.type]||!this.workerSources[B][j.type][j.source])return;const J=this.workerSources[B][j.type][j.source];delete this.workerSources[B][j.type][j.source],J.removeSource!==void 0&&J.removeSource(j)})),this.actor.registerMessageHandler("RM",B=>p._(this,void 0,void 0,function*(){delete this.layerIndexes[B],delete this.availableImages[B],delete this.workerSources[B],delete this.demWorkerSources[B]})),this.actor.registerMessageHandler("SR",(B,j)=>p._(this,void 0,void 0,function*(){this.referrer=j})),this.actor.registerMessageHandler("SRPS",(B,j)=>this._syncRTLPluginState(B,j)),this.actor.registerMessageHandler("IS",(B,j)=>p._(this,void 0,void 0,function*(){this.self.importScripts(j)})),this.actor.registerMessageHandler("SI",(B,j)=>this._setImages(B,j)),this.actor.registerMessageHandler("UL",(B,j)=>p._(this,void 0,void 0,function*(){this._getLayerIndex(B).update(j.layers,j.removedIds)})),this.actor.registerMessageHandler("SL",(B,j)=>p._(this,void 0,void 0,function*(){this._getLayerIndex(B).replace(j)}))}_setImages(z,B){return p._(this,void 0,void 0,function*(){this.availableImages[z]=B;for(const j in this.workerSources[z]){const J=this.workerSources[z][j];for(const pt in J)J[pt].availableImages=B}})}_syncRTLPluginState(z,B){return p._(this,void 0,void 0,function*(){if(p.bA.isParsed())return p.bA.getState();if(B.pluginStatus!=="loading")return p.bA.setState(B),B;const j=B.pluginURL;if(this.self.importScripts(j),p.bA.isParsed()){const J={pluginStatus:"loaded",pluginURL:j};return p.bA.setState(J),J}throw p.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${j}`)})}_getAvailableImages(z){let B=this.availableImages[z];return B||(B=[]),B}_getLayerIndex(z){let B=this.layerIndexes[z];return B||(B=this.layerIndexes[z]=new c),B}_getWorkerSource(z,B,j){if(this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][B]||(this.workerSources[z][B]={}),!this.workerSources[z][B][j]){const J={sendAsync:(pt,ft)=>(pt.targetMapId=z,this.actor.sendAsync(pt,ft))};switch(B){case"vector":this.workerSources[z][B][j]=new P(J,this._getLayerIndex(z),this._getAvailableImages(z));break;case"geojson":this.workerSources[z][B][j]=new Ha(J,this._getLayerIndex(z),this._getAvailableImages(z));break;default:this.workerSources[z][B][j]=new this.externalWorkerSourceTypes[B](J,this._getLayerIndex(z),this._getAvailableImages(z))}}return this.workerSources[z][B][j]}_getDEMWorkerSource(z,B){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][B]||(this.demWorkerSources[z][B]=new R),this.demWorkerSources[z][B]}}return p.i(self)&&(self.worker=new Fr(self)),Fr}),a("index",["exports","./shared"],function(p,c){var b="4.1.3";let C,A;const P={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((o,h)=>{const d=requestAnimationFrame(o);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(d),h(c.c())})}),getImageData(y,o=0){return this.getImageCanvasContext(y).getImageData(-o,-o,y.width+2*o,y.height+2*o)},getImageCanvasContext(y){const o=window.document.createElement("canvas"),h=o.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return o.width=y.width,o.height=y.height,h.drawImage(y,0,0,y.width,y.height),h},resolveURL:y=>(C||(C=document.createElement("a")),C.href=y,C.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(A==null&&(A=matchMedia("(prefers-reduced-motion: reduce)")),A.matches)}};class R{static testProp(o){if(!R.docStyle)return o[0];for(let h=0;h<o.length;h++)if(o[h]in R.docStyle)return o[h];return o[0]}static create(o,h,d){const m=window.document.createElement(o);return h!==void 0&&(m.className=h),d&&d.appendChild(m),m}static createNS(o,h){return window.document.createElementNS(o,h)}static disableDrag(){R.docStyle&&R.selectProp&&(R.userSelect=R.docStyle[R.selectProp],R.docStyle[R.selectProp]="none")}static enableDrag(){R.docStyle&&R.selectProp&&(R.docStyle[R.selectProp]=R.userSelect)}static setTransform(o,h){o.style[R.transformProp]=h}static addEventListener(o,h,d,m={}){o.addEventListener(h,d,"passive"in m?m:m.capture)}static removeEventListener(o,h,d,m={}){o.removeEventListener(h,d,"passive"in m?m:m.capture)}static suppressClickInternal(o){o.preventDefault(),o.stopPropagation(),window.removeEventListener("click",R.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",R.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",R.suppressClickInternal,!0)},0)}static getScale(o){const h=o.getBoundingClientRect();return{x:h.width/o.offsetWidth||1,y:h.height/o.offsetHeight||1,boundingClientRect:h}}static getPoint(o,h,d){const m=h.boundingClientRect;return new c.P((d.clientX-m.left)/h.x-o.clientLeft,(d.clientY-m.top)/h.y-o.clientTop)}static mousePos(o,h){const d=R.getScale(o);return R.getPoint(o,d,h)}static touchPos(o,h){const d=[],m=R.getScale(o);for(let _=0;_<h.length;_++)d.push(R.getPoint(o,m,h[_]));return d}static mouseButton(o){return o.button}static remove(o){o.parentNode&&o.parentNode.removeChild(o)}}R.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,R.selectProp=R.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),R.transformProp=R.testProp(["transform","WebkitTransform"]);const et={supported:!1,testSupport:function(y){!ot&&K&&(gt?q(y):X=y)}};let X,K,ot=!1,gt=!1;function q(y){const o=y.createTexture();y.bindTexture(y.TEXTURE_2D,o);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,K),y.isContextLost())return;et.supported=!0}catch{}y.deleteTexture(o),ot=!0}var W;typeof document<"u"&&(K=document.createElement("img"),K.onload=function(){X&&q(X),X=null,gt=!0},K.onerror=function(){ot=!0,X=null},K.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let o,h,d,m;y.resetRequestQueue=()=>{o=[],h=0,d=0,m={}},y.addThrottleControl=T=>{const M=d++;return m[M]=T,M},y.removeThrottleControl=T=>{delete m[T],S()},y.getImage=(T,M,N=!0)=>new Promise((O,U)=>{et.supported&&(T.headers||(T.headers={}),T.headers.accept="image/webp,*/*"),c.e(T,{type:"image"}),o.push({abortController:M,requestParameters:T,supportImageRefresh:N,state:"queued",onError:tt=>{U(tt)},onSuccess:tt=>{O(tt)}}),S()});const _=T=>c._(this,void 0,void 0,function*(){T.state="running";const{requestParameters:M,supportImageRefresh:N,onError:O,onSuccess:U,abortController:tt}=T,$=N===!1&&!c.i(self)&&!c.g(M.url)&&(!M.headers||Object.keys(M.headers).reduce((ht,It)=>ht&&It==="accept",!0));h++;const it=$?I(M,tt):c.m(M,tt);try{const ht=yield it;delete T.abortController,T.state="completed",ht.data instanceof HTMLImageElement||c.b(ht.data)?U(ht):ht.data&&U({data:yield(Z=ht.data,typeof createImageBitmap=="function"?c.d(Z):c.f(Z)),cacheControl:ht.cacheControl,expires:ht.expires})}catch(ht){delete T.abortController,O(ht)}finally{h--,S()}var Z}),S=()=>{const T=(()=>{for(const M of Object.keys(m))if(m[M]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let M=h;M<T&&o.length>0;M++){const N=o.shift();N.abortController.signal.aborted?M--:_(N)}},I=(T,M)=>new Promise((N,O)=>{const U=new Image,tt=T.url,$=T.credentials;$&&$==="include"?U.crossOrigin="use-credentials":($&&$==="same-origin"||!c.s(tt))&&(U.crossOrigin="anonymous"),M.signal.addEventListener("abort",()=>{U.src="",O(c.c())}),U.fetchPriority="high",U.onload=()=>{U.onerror=U.onload=null,N({data:U})},U.onerror=()=>{U.onerror=U.onload=null,M.signal.aborted||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},U.src=tt})}(W||(W={})),W.resetRequestQueue();class at{constructor(o){this._transformRequestFn=o}transformRequest(o,h){return this._transformRequestFn&&this._transformRequestFn(o,h)||{url:o}}normalizeSpriteURL(o,h,d){const m=function(_){const S=_.match(dt);if(!S)throw new Error(`Unable to parse URL "${_}"`);return{protocol:S[1],authority:S[2],path:S[3]||"/",params:S[4]?S[4].split("&"):[]}}(o);return m.path+=`${h}${d}`,function(_){const S=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${S}`}(m)}setTransformRequest(o){this._transformRequestFn=o}}const dt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Pt(y){var o=new c.A(3);return o[0]=y[0],o[1]=y[1],o[2]=y[2],o}var Mt,Tt=function(y,o,h){return y[0]=o[0]-h[0],y[1]=o[1]-h[1],y[2]=o[2]-h[2],y};Mt=new c.A(3),c.A!=Float32Array&&(Mt[0]=0,Mt[1]=0,Mt[2]=0);var Ut=function(y){var o=y[0],h=y[1];return o*o+h*h};function qt(y){const o=[];if(typeof y=="string")o.push({id:"default",url:y});else if(y&&y.length>0){const h=[];for(const{id:d,url:m}of y){const _=`${d}${m}`;h.indexOf(_)===-1&&(h.push(_),o.push({id:d,url:m}))}}return o}(function(){var y=new c.A(2);c.A!=Float32Array&&(y[0]=0,y[1]=0)})();class Q{constructor(o,h,d,m){this.context=o,this.format=d,this.texture=o.gl.createTexture(),this.update(h,m)}update(o,h,d){const{width:m,height:_}=o,S=!(this.size&&this.size[0]===m&&this.size[1]===_||d),{context:I}=this,{gl:T}=I;if(this.useMipmap=!!(h&&h.useMipmap),T.bindTexture(T.TEXTURE_2D,this.texture),I.pixelStoreUnpackFlipY.set(!1),I.pixelStoreUnpack.set(1),I.pixelStoreUnpackPremultiplyAlpha.set(this.format===T.RGBA&&(!h||h.premultiply!==!1)),S)this.size=[m,_],o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||c.b(o)?T.texImage2D(T.TEXTURE_2D,0,this.format,this.format,T.UNSIGNED_BYTE,o):T.texImage2D(T.TEXTURE_2D,0,this.format,m,_,0,this.format,T.UNSIGNED_BYTE,o.data);else{const{x:M,y:N}=d||{x:0,y:0};o instanceof HTMLImageElement||o instanceof HTMLCanvasElement||o instanceof HTMLVideoElement||o instanceof ImageData||c.b(o)?T.texSubImage2D(T.TEXTURE_2D,0,M,N,T.RGBA,T.UNSIGNED_BYTE,o):T.texSubImage2D(T.TEXTURE_2D,0,M,N,m,_,T.RGBA,T.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&T.generateMipmap(T.TEXTURE_2D)}bind(o,h,d){const{context:m}=this,{gl:_}=m;_.bindTexture(_.TEXTURE_2D,this.texture),d!==_.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(d=_.LINEAR),o!==this.filter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,o),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,d||o),this.filter=o),h!==this.wrap&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,h),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,h),this.wrap=h)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:o}=this.context;o.deleteTexture(this.texture),this.texture=null}}function Et(y){const{userImage:o}=y;return!!(o&&o.render&&o.render())&&(y.data.replace(new Uint8Array(o.data.buffer)),!0)}class $t extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(o){if(this.loaded!==o&&(this.loaded=o,o)){for(const{ids:h,promiseResolve:d}of this.requestors)d(this._getImagesForIds(h));this.requestors=[]}}getImage(o){const h=this.images[o];if(h&&!h.data&&h.spriteData){const d=h.spriteData;h.data=new c.R({width:d.width,height:d.height},d.context.getImageData(d.x,d.y,d.width,d.height).data),h.spriteData=null}return h}addImage(o,h){if(this.images[o])throw new Error(`Image id ${o} already exist, use updateImage instead`);this._validate(o,h)&&(this.images[o]=h)}_validate(o,h){let d=!0;const m=h.data||h.spriteData;return this._validateStretch(h.stretchX,m&&m.width)||(this.fire(new c.j(new Error(`Image "${o}" has invalid "stretchX" value`))),d=!1),this._validateStretch(h.stretchY,m&&m.height)||(this.fire(new c.j(new Error(`Image "${o}" has invalid "stretchY" value`))),d=!1),this._validateContent(h.content,h)||(this.fire(new c.j(new Error(`Image "${o}" has invalid "content" value`))),d=!1),d}_validateStretch(o,h){if(!o)return!0;let d=0;for(const m of o){if(m[0]<d||m[1]<m[0]||h<m[1])return!1;d=m[1]}return!0}_validateContent(o,h){if(!o)return!0;if(o.length!==4)return!1;const d=h.spriteData,m=d&&d.width||h.data.width,_=d&&d.height||h.data.height;return!(o[0]<0||m<o[0]||o[1]<0||_<o[1]||o[2]<0||m<o[2]||o[3]<0||_<o[3]||o[2]<o[0]||o[3]<o[1])}updateImage(o,h,d=!0){const m=this.getImage(o);if(d&&(m.data.width!==h.data.width||m.data.height!==h.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${h.data.width}x${h.data.height}).`);h.version=m.version+1,this.images[o]=h,this.updatedImages[o]=!0}removeImage(o){const h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(o){return new Promise((h,d)=>{let m=!0;if(!this.isLoaded())for(const _ of o)this.images[_]||(m=!1);this.isLoaded()||m?h(this._getImagesForIds(o)):this.requestors.push({ids:o,promiseResolve:h})})}_getImagesForIds(o){const h={};for(const d of o){let m=this.getImage(d);m||(this.fire(new c.k("styleimagemissing",{id:d})),m=this.getImage(d)),m?h[d]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:c.w(`Image "${d}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return h}getPixelSize(){const{width:o,height:h}=this.atlasImage;return{width:o,height:h}}getPattern(o){const h=this.patterns[o],d=this.getImage(o);if(!d)return null;if(h&&h.position.version===d.version)return h.position;if(h)h.position.version=d.version;else{const m={w:d.data.width+2,h:d.data.height+2,x:0,y:0},_=new c.I(m,d);this.patterns[o]={bin:m,position:_}}return this._updatePatternAtlas(),this.patterns[o].position}bind(o){const h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Q(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)}_updatePatternAtlas(){const o=[];for(const _ in this.patterns)o.push(this.patterns[_].bin);const{w:h,h:d}=c.p(o),m=this.atlasImage;m.resize({width:h||1,height:d||1});for(const _ in this.patterns){const{bin:S}=this.patterns[_],I=S.x+1,T=S.y+1,M=this.getImage(_).data,N=M.width,O=M.height;c.R.copy(M,m,{x:0,y:0},{x:I,y:T},{width:N,height:O}),c.R.copy(M,m,{x:0,y:O-1},{x:I,y:T-1},{width:N,height:1}),c.R.copy(M,m,{x:0,y:0},{x:I,y:T+O},{width:N,height:1}),c.R.copy(M,m,{x:N-1,y:0},{x:I-1,y:T},{width:1,height:O}),c.R.copy(M,m,{x:0,y:0},{x:I+N,y:T},{width:1,height:O})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(o){for(const h of o){if(this.callbackDispatchedThisFrame[h])continue;this.callbackDispatchedThisFrame[h]=!0;const d=this.getImage(h);d||c.w(`Image with ID: "${h}" was not found`),Et(d)&&this.updateImage(h,d)}}}const le=1e20;function Ye(y,o,h,d,m,_,S,I,T){for(let M=o;M<o+d;M++)Ie(y,h*_+M,_,m,S,I,T);for(let M=h;M<h+m;M++)Ie(y,M*_+o,1,d,S,I,T)}function Ie(y,o,h,d,m,_,S){_[0]=0,S[0]=-le,S[1]=le,m[0]=y[o];for(let I=1,T=0,M=0;I<d;I++){m[I]=y[o+I*h];const N=I*I;do{const O=_[T];M=(m[I]-m[O]+N-O*O)/(I-O)/2}while(M<=S[T]&&--T>-1);T++,_[T]=I,S[T]=M,S[T+1]=le}for(let I=0,T=0;I<d;I++){for(;S[T+1]<I;)T++;const M=_[T],N=I-M;y[o+I*h]=m[M]+N*N}}class ue{constructor(o,h){this.requestManager=o,this.localIdeographFontFamily=h,this.entries={}}setURL(o){this.url=o}getGlyphs(o){return c._(this,void 0,void 0,function*(){const h=[];for(const _ in o)for(const S of o[_])h.push(this._getAndCacheGlyphsPromise(_,S));const d=yield Promise.all(h),m={};for(const{stack:_,id:S,glyph:I}of d)m[_]||(m[_]={}),m[_][S]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics};return m})}_getAndCacheGlyphsPromise(o,h){return c._(this,void 0,void 0,function*(){let d=this.entries[o];d||(d=this.entries[o]={glyphs:{},requests:{},ranges:{}});let m=d.glyphs[h];if(m!==void 0)return{stack:o,id:h,glyph:m};if(m=this._tinySDF(d,o,h),m)return d.glyphs[h]=m,{stack:o,id:h,glyph:m};const _=Math.floor(h/256);if(256*_>65535)throw new Error("glyphs > 65535 not supported");if(d.ranges[_])return{stack:o,id:h,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!d.requests[_]){const I=ue.loadGlyphRange(o,_,this.url,this.requestManager);d.requests[_]=I}const S=yield d.requests[_];for(const I in S)this._doesCharSupportLocalGlyph(+I)||(d.glyphs[+I]=S[+I]);return d.ranges[_]=!0,{stack:o,id:h,glyph:S[h]||null}})}_doesCharSupportLocalGlyph(o){return!!this.localIdeographFontFamily&&(c.u["CJK Unified Ideographs"](o)||c.u["Hangul Syllables"](o)||c.u.Hiragana(o)||c.u.Katakana(o))}_tinySDF(o,h,d){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(d))return;let _=o.tinySDF;if(!_){let I="400";/bold/i.test(h)?I="900":/medium/i.test(h)?I="500":/light/i.test(h)&&(I="200"),_=o.tinySDF=new ue.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:I})}const S=_.draw(String.fromCharCode(d));return{id:d,bitmap:new c.o({width:S.width||60,height:S.height||60},S.data),metrics:{width:S.glyphWidth/2||24,height:S.glyphHeight/2||24,left:S.glyphLeft/2+.5||0,top:S.glyphTop/2-27.5||-8,advance:S.glyphAdvance/2||24,isDoubleResolution:!0}}}}ue.loadGlyphRange=function(y,o,h,d){return c._(this,void 0,void 0,function*(){const m=256*o,_=m+255,S=d.transformRequest(h.replace("{fontstack}",y).replace("{range}",`${m}-${_}`),"Glyphs"),I=yield c.l(S,new AbortController);if(!I||!I.data)throw new Error(`Could not load glyph range. range: ${o}, ${m}-${_}`);const T={};for(const M of c.n(I.data))T[M.id]=M;return T})},ue.TinySDF=class{constructor({fontSize:y=24,buffer:o=3,radius:h=8,cutoff:d=.25,fontFamily:m="sans-serif",fontWeight:_="normal",fontStyle:S="normal"}={}){this.buffer=o,this.cutoff=d,this.radius=h;const I=this.size=y+4*o,T=this._createCanvas(I),M=this.ctx=T.getContext("2d",{willReadFrequently:!0});M.font=`${S} ${_} ${y}px ${m}`,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(I*I),this.gridInner=new Float64Array(I*I),this.f=new Float64Array(I),this.z=new Float64Array(I+1),this.v=new Uint16Array(I)}_createCanvas(y){const o=document.createElement("canvas");return o.width=o.height=y,o}draw(y){const{width:o,actualBoundingBoxAscent:h,actualBoundingBoxDescent:d,actualBoundingBoxLeft:m,actualBoundingBoxRight:_}=this.ctx.measureText(y),S=Math.ceil(h),I=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-m))),T=Math.min(this.size-this.buffer,S+Math.ceil(d)),M=I+2*this.buffer,N=T+2*this.buffer,O=Math.max(M*N,0),U=new Uint8ClampedArray(O),tt={data:U,width:M,height:N,glyphWidth:I,glyphHeight:T,glyphTop:S,glyphLeft:0,glyphAdvance:o};if(I===0||T===0)return tt;const{ctx:$,buffer:it,gridInner:Z,gridOuter:ht}=this;$.clearRect(it,it,I,T),$.fillText(y,it,it+S);const It=$.getImageData(it,it,I,T);ht.fill(le,0,O),Z.fill(0,0,O);for(let st=0;st<T;st++)for(let _t=0;_t<I;_t++){const Ct=It.data[4*(st*I+_t)+3]/255;if(Ct===0)continue;const At=(st+it)*M+_t+it;if(Ct===1)ht[At]=0,Z[At]=le;else{const kt=.5-Ct;ht[At]=kt>0?kt*kt:0,Z[At]=kt<0?kt*kt:0}}Ye(ht,0,0,M,N,M,this.f,this.v,this.z),Ye(Z,it,it,I,T,M,this.f,this.v,this.z);for(let st=0;st<O;st++){const _t=Math.sqrt(ht[st])-Math.sqrt(Z[st]);U[st]=Math.round(255-255*(_t/this.radius+this.cutoff))}return tt}};class je{constructor(){this.specification=c.v.light.position}possiblyEvaluate(o,h){return c.y(o.expression.evaluate(h))}interpolate(o,h,d){return{x:c.z.number(o.x,h.x,d),y:c.z.number(o.y,h.y,d),z:c.z.number(o.z,h.z,d)}}}let gn;class nn extends c.E{constructor(o){super(),gn=gn||new c.q({anchor:new c.D(c.v.light.anchor),position:new je,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(gn),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(o,h={}){if(!this._validate(c.r,o,h))for(const d in o){const m=o[d];d.endsWith("-transition")?this._transitionable.setTransition(d.slice(0,-11),m):this._transitionable.setValue(d,m)}}updateTransitions(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(o){this.properties=this._transitioning.possiblyEvaluate(o)}_validate(o,h,d){return(!d||d.validate!==!1)&&c.t(this,o.call(c.x,{value:h,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}class Ze{constructor(o,h){this.width=o,this.height=h,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(o,h){const d=o.join(",")+String(h);return this.dashEntry[d]||(this.dashEntry[d]=this.addDash(o,h)),this.dashEntry[d]}getDashRanges(o,h,d){const m=[];let _=o.length%2==1?-o[o.length-1]*d:0,S=o[0]*d,I=!0;m.push({left:_,right:S,isDash:I,zeroLength:o[0]===0});let T=o[0];for(let M=1;M<o.length;M++){I=!I;const N=o[M];_=T*d,T+=N,S=T*d,m.push({left:_,right:S,isDash:I,zeroLength:N===0})}return m}addRoundDash(o,h,d){const m=h/2;for(let _=-d;_<=d;_++){const S=this.width*(this.nextRow+d+_);let I=0,T=o[I];for(let M=0;M<this.width;M++){M/T.right>1&&(T=o[++I]);const N=Math.abs(M-T.left),O=Math.abs(M-T.right),U=Math.min(N,O);let tt;const $=_/d*(m+1);if(T.isDash){const it=m-Math.abs($);tt=Math.sqrt(U*U+it*it)}else tt=m-Math.sqrt(U*U+$*$);this.data[S+M]=Math.max(0,Math.min(255,tt+128))}}}addRegularDash(o){for(let I=o.length-1;I>=0;--I){const T=o[I],M=o[I+1];T.zeroLength?o.splice(I,1):M&&M.isDash===T.isDash&&(M.left=T.left,o.splice(I,1))}const h=o[0],d=o[o.length-1];h.isDash===d.isDash&&(h.left=d.left-this.width,d.right=h.right+this.width);const m=this.width*this.nextRow;let _=0,S=o[_];for(let I=0;I<this.width;I++){I/S.right>1&&(S=o[++_]);const T=Math.abs(I-S.left),M=Math.abs(I-S.right),N=Math.min(T,M);this.data[m+I]=Math.max(0,Math.min(255,(S.isDash?N:-N)+128))}}addDash(o,h){const d=h?7:0,m=2*d+1;if(this.nextRow+m>this.height)return c.w("LineAtlas out of space"),null;let _=0;for(let I=0;I<o.length;I++)_+=o[I];if(_!==0){const I=this.width/_,T=this.getDashRanges(o,this.width,I);h?this.addRoundDash(T,I,d):this.addRegularDash(T)}const S={y:(this.nextRow+d+.5)/this.height,height:2*d/this.height,width:_};return this.nextRow+=m,this.dirty=!0,S}bind(o){const h=o.gl;this.texture?(h.bindTexture(h.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,h.texSubImage2D(h.TEXTURE_2D,0,0,0,this.width,this.height,h.ALPHA,h.UNSIGNED_BYTE,this.data))):(this.texture=h.createTexture(),h.bindTexture(h.TEXTURE_2D,this.texture),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.REPEAT),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,h.LINEAR),h.texImage2D(h.TEXTURE_2D,0,h.ALPHA,this.width,this.height,0,h.ALPHA,h.UNSIGNED_BYTE,this.data))}}const pe="maplibre_preloaded_worker_pool";class Re{constructor(){this.active={}}acquire(o){if(!this.workers)for(this.workers=[];this.workers.length<Re.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[o]=!0,this.workers.slice()}release(o){delete this.active[o],this.numActive()===0&&(this.workers.forEach(h=>{h.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[pe]}numActive(){return Object.keys(this.active).length}}const dn=Math.floor(P.hardwareConcurrency/2);let rn,He;function mn(){return rn||(rn=new Re),rn}Re.workerCount=c.B(globalThis)?Math.max(Math.min(dn,3),1):1;class Dn{constructor(o,h){this.workerPool=o,this.actors=[],this.currentActor=0,this.id=h;const d=this.workerPool.acquire(h);for(let m=0;m<d.length;m++){const _=new c.C(d[m],h);_.name=`Worker ${m}`,this.actors.push(_)}if(!this.actors.length)throw new Error("No actors found")}broadcast(o,h){const d=[];for(const m of this.actors)d.push(m.sendAsync({type:o,data:h}));return Promise.all(d)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(o=!0){this.actors.forEach(h=>{h.remove()}),this.actors=[],o&&this.workerPool.release(this.id)}registerMessageHandler(o,h){for(const d of this.actors)d.registerMessageHandler(o,h)}}function kn(){return He||(He=new Dn(mn(),c.G),He.registerMessageHandler("GR",(y,o,h)=>c.m(o,h))),He}function ve(y,o){const h=c.F();return c.H(h,h,[1,1,0]),c.J(h,h,[.5*y.width,.5*y.height,1]),c.K(h,h,y.calculatePosMatrix(o.toUnwrapped()))}function yn(y,o,h,d,m,_){const S=function(O,U,tt){if(O)for(const $ of O){const it=U[$];if(it&&it.source===tt&&it.type==="fill-extrusion")return!0}else for(const $ in U){const it=U[$];if(it.source===tt&&it.type==="fill-extrusion")return!0}return!1}(m&&m.layers,o,y.id),I=_.maxPitchScaleFactor(),T=y.tilesIn(d,I,S);T.sort(Xn);const M=[];for(const O of T)M.push({wrappedTileID:O.tileID.wrapped().key,queryResults:O.tile.queryRenderedFeatures(o,h,y._state,O.queryGeometry,O.cameraQueryGeometry,O.scale,m,_,I,ve(y.transform,O.tileID))});const N=function(O){const U={},tt={};for(const $ of O){const it=$.queryResults,Z=$.wrappedTileID,ht=tt[Z]=tt[Z]||{};for(const It in it){const st=it[It],_t=ht[It]=ht[It]||{},Ct=U[It]=U[It]||[];for(const At of st)_t[At.featureIndex]||(_t[At.featureIndex]=!0,Ct.push(At))}}return U}(M);for(const O in N)N[O].forEach(U=>{const tt=U.feature,$=y.getFeatureState(tt.layer["source-layer"],tt.id);tt.source=tt.layer.source,tt.layer["source-layer"]&&(tt.sourceLayer=tt.layer["source-layer"]),tt.state=$});return N}function Xn(y,o){const h=y.tileID,d=o.tileID;return h.overscaledZ-d.overscaledZ||h.canonical.y-d.canonical.y||h.wrap-d.wrap||h.canonical.x-d.canonical.x}function Y(y,o,h){return c._(this,void 0,void 0,function*(){let d=y;if(y.url?d=(yield c.h(o.transformRequest(y.url,"Source"),h)).data:yield P.frameAsync(h),!d)return null;const m=c.L(c.e(d,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in d&&d.vector_layers&&(m.vectorLayerIds=d.vector_layers.map(_=>_.id)),m})}class yt{constructor(o,h){o&&(h?this.setSouthWest(o).setNorthEast(h):Array.isArray(o)&&(o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1])))}setNorthEast(o){return this._ne=o instanceof c.M?new c.M(o.lng,o.lat):c.M.convert(o),this}setSouthWest(o){return this._sw=o instanceof c.M?new c.M(o.lng,o.lat):c.M.convert(o),this}extend(o){const h=this._sw,d=this._ne;let m,_;if(o instanceof c.M)m=o,_=o;else{if(!(o instanceof yt))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(yt.convert(o)):this.extend(c.M.convert(o)):o&&("lng"in o||"lon"in o)&&"lat"in o?this.extend(c.M.convert(o)):this;if(m=o._sw,_=o._ne,!m||!_)return this}return h||d?(h.lng=Math.min(m.lng,h.lng),h.lat=Math.min(m.lat,h.lat),d.lng=Math.max(_.lng,d.lng),d.lat=Math.max(_.lat,d.lat)):(this._sw=new c.M(m.lng,m.lat),this._ne=new c.M(_.lng,_.lat)),this}getCenter(){return new c.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.M(this.getWest(),this.getNorth())}getSouthEast(){return new c.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(o){const{lng:h,lat:d}=c.M.convert(o);let m=this._sw.lng<=h&&h<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=h&&h>=this._ne.lng),this._sw.lat<=d&&d<=this._ne.lat&&m}static convert(o){return o instanceof yt?o:o&&new yt(o)}static fromLngLat(o,h=0){const d=360*h/40075017,m=d/Math.cos(Math.PI/180*o.lat);return new yt(new c.M(o.lng-m,o.lat-d),new c.M(o.lng+m,o.lat+d))}}class Ce{constructor(o,h,d){this.bounds=yt.convert(this.validateBounds(o)),this.minzoom=h||0,this.maxzoom=d||24}validateBounds(o){return Array.isArray(o)&&o.length===4?[Math.max(-180,o[0]),Math.max(-90,o[1]),Math.min(180,o[2]),Math.min(90,o[3])]:[-180,-90,180,90]}contains(o){const h=Math.pow(2,o.z),d=Math.floor(c.N(this.bounds.getWest())*h),m=Math.floor(c.O(this.bounds.getNorth())*h),_=Math.ceil(c.N(this.bounds.getEast())*h),S=Math.ceil(c.O(this.bounds.getSouth())*h);return o.x>=d&&o.x<_&&o.y>=m&&o.y<S}}class Ke extends c.E{constructor(o,h,d,m){if(super(),this.id=o,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.L(h,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Y(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),o&&(c.e(this,o),o.bounds&&(this.tileBounds=new Ce(o.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new c.j(o))}})}loaded(){return this._loaded}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}onAdd(o){this.map=o,this.load()}setSourceProperty(o){this._tileJSONRequest&&this._tileJSONRequest.abort(),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(o){return c._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d={request:this.map._requestManager.transformRequest(h,"Tile"),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};d.request.collectResourceTiming=this._collectResourceTiming;let m="RT";if(o.actor&&o.state!=="expired"){if(o.state==="loading")return new Promise((_,S)=>{o.reloadPromise={resolve:_,reject:S}})}else o.actor=this.dispatcher.getActor(),m="LT";o.abortController=new AbortController;try{const _=yield o.actor.sendAsync({type:m,data:d},o.abortController);if(delete o.abortController,o.aborted)return;this._afterTileLoadWorkerResponse(o,_)}catch(_){if(delete o.abortController,o.aborted)return;if(_&&_.status!==404)throw _;this._afterTileLoadWorkerResponse(o,null)}})}_afterTileLoadWorkerResponse(o,h){if(h&&h.resourceTiming&&(o.resourceTiming=h.resourceTiming),h&&this.map._refreshExpiredTiles&&o.setExpiryData(h),o.loadVectorData(h,this.map.painter),o.reloadPromise){const d=o.reloadPromise;o.reloadPromise=null,this.loadTile(o).then(d.resolve).catch(d.reject)}}abortTile(o){return c._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.actor&&(yield o.actor.sendAsync({type:"AT",data:{uid:o.uid,type:this.type,source:this.id}}))})}unloadTile(o){return c._(this,void 0,void 0,function*(){o.unloadVectorData(),o.actor&&(yield o.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Lt extends c.E{constructor(o,h,d,m){super(),this.id=o,this.dispatcher=d,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},h),c.e(this,c.L(h,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const o=yield Y(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,o&&(c.e(this,o),o.bounds&&(this.tileBounds=new Ce(o.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(o){this._tileJSONRequest=null,this.fire(new c.j(o))}})}loaded(){return this._loaded}onAdd(o){this.map=o,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(o){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),o(),this.load()}setTiles(o){return this.setSourceProperty(()=>{this._options.tiles=o}),this}setUrl(o){return this.setSourceProperty(()=>{this.url=o,this._options.url=o}),this}serialize(){return c.e({},this._options)}hasTile(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)}loadTile(o){return c._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);o.abortController=new AbortController;try{const d=yield W.getImage(this.map._requestManager.transformRequest(h,"Tile"),o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(d&&d.data){this.map._refreshExpiredTiles&&d.cacheControl&&d.expires&&o.setExpiryData({cacheControl:d.cacheControl,expires:d.expires});const m=this.map.painter.context,_=m.gl,S=d.data;o.texture=this.map.painter.getTileTexture(S.width),o.texture?o.texture.update(S,{useMipmap:!0}):(o.texture=new Q(m,S,_.RGBA,{useMipmap:!0}),o.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE,_.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&_.texParameterf(_.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),o.state="loaded"}}catch(d){if(delete o.abortController,o.aborted)o.state="unloaded";else if(d)throw o.state="errored",d}})}abortTile(o){return c._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController)})}unloadTile(o){return c._(this,void 0,void 0,function*(){o.texture&&this.map.painter.saveTileTexture(o.texture)})}hasTransition(){return!1}}class nr extends Lt{constructor(o,h,d,m){super(o,h,d,m),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox",this.redFactor=h.redFactor,this.greenFactor=h.greenFactor,this.blueFactor=h.blueFactor,this.baseShift=h.baseShift}loadTile(o){return c._(this,void 0,void 0,function*(){const h=o.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),d=this.map._requestManager.transformRequest(h,"Tile");o.neighboringTiles=this._getNeighboringTiles(o.tileID),o.abortController=new AbortController;try{const m=yield W.getImage(d,o.abortController,this.map._refreshExpiredTiles);if(delete o.abortController,o.aborted)return void(o.state="unloaded");if(m&&m.data){const _=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&o.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const S=c.b(_)&&c.S()?_:yield this.readImageNow(_),I={type:this.type,uid:o.uid,source:this.id,rawImageData:S,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!o.actor||o.state==="expired"){o.actor=this.dispatcher.getActor();const T=yield o.actor.sendAsync({type:"LDT",data:I});o.dem=T,o.needsHillshadePrepare=!0,o.needsTerrainPrepare=!0,o.state="loaded"}}}catch(m){if(delete o.abortController,o.aborted)o.state="unloaded";else if(m)throw o.state="errored",m}})}readImageNow(o){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.U()){const h=o.width+2,d=o.height+2;try{return new c.R({width:h,height:d},yield c.V(o,-1,-1,h,d))}catch{}}return P.getImageData(o,1)})}_getNeighboringTiles(o){const h=o.canonical,d=Math.pow(2,h.z),m=(h.x-1+d)%d,_=h.x===0?o.wrap-1:o.wrap,S=(h.x+1+d)%d,I=h.x+1===d?o.wrap+1:o.wrap,T={};return T[new c.Q(o.overscaledZ,_,h.z,m,h.y).key]={backfilled:!1},T[new c.Q(o.overscaledZ,I,h.z,S,h.y).key]={backfilled:!1},h.y>0&&(T[new c.Q(o.overscaledZ,_,h.z,m,h.y-1).key]={backfilled:!1},T[new c.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},T[new c.Q(o.overscaledZ,I,h.z,S,h.y-1).key]={backfilled:!1}),h.y+1<d&&(T[new c.Q(o.overscaledZ,_,h.z,m,h.y+1).key]={backfilled:!1},T[new c.Q(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},T[new c.Q(o.overscaledZ,I,h.z,S,h.y+1).key]={backfilled:!1}),T}unloadTile(o){return c._(this,void 0,void 0,function*(){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&(yield o.actor.sendAsync({type:"RDT",data:{type:this.type,uid:o.uid,source:this.id}}))})}}class qo extends c.E{constructor(o,h,d,m){super(),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=d.getActor(),this.setEventedParent(m),this._data=h.data,this._options=c.e({},h),this._collectResourceTiming=h.collectResourceTiming,h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;const _=c.W/this.tileSize;this.workerOptions=c.e({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*_,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*_,extent:c.W,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?h.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:c.W,radius:(h.clusterRadius||50)*_,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(o){this.map=o,this.load()}setData(o){return this._data=o,this._updateWorkerData(),this}updateData(o){return this._updateWorkerData(o),this}setClusterOptions(o){return this.workerOptions.cluster=o.cluster,o&&(o.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=o.clusterRadius),o.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=o.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(o){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:o,source:this.id}})}getClusterChildren(o){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:o,source:this.id}})}getClusterLeaves(o,h,d){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:o,limit:h,offset:d}})}_updateWorkerData(o){return c._(this,void 0,void 0,function*(){const h=c.e({type:this.type},this.workerOptions);o?h.dataDiff=o:typeof this._data=="string"?(h.request=this.map._requestManager.transformRequest(P.resolveURL(this._data),"Source"),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const d=yield this.actor.sendAsync({type:"LD",data:h});if(this._pendingLoads--,this._removed||d.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let m=null;d.resourceTiming&&d.resourceTiming[this.id]&&(m=d.resourceTiming[this.id].slice(0));const _={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&c.e(_,{resourceTiming:m}),this.fire(new c.k("data",Object.assign(Object.assign({},_),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},_),{sourceDataType:"content"})))}catch(d){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(d))}})}loaded(){return this._pendingLoads===0}loadTile(o){return c._(this,void 0,void 0,function*(){const h=o.actor?"RT":"LT";o.actor=this.actor;const d={type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};o.abortController=new AbortController;const m=yield this.actor.sendAsync({type:h,data:d},o.abortController);delete o.abortController,o.unloadVectorData(),o.aborted||o.loadVectorData(m,this.map.painter,h==="RT")})}abortTile(o){return c._(this,void 0,void 0,function*(){o.abortController&&(o.abortController.abort(),delete o.abortController),o.aborted=!0})}unloadTile(o){return c._(this,void 0,void 0,function*(){o.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:o.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var tn=c.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class zr extends c.E{constructor(o,h,d,m){super(),this.id=o,this.dispatcher=d,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=h}load(o){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const h=yield W.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,h&&h.data&&(this.image=h.data,o&&(this.coordinates=o),this._finishLoading())}catch(h){this._request=null,this._loaded=!0,this.fire(new c.j(h))}})}loaded(){return this._loaded}updateImage(o){return o.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=o.url,this.load(o.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(o){this.map=o,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(o){this.coordinates=o;const h=o.map(c.Y.fromLngLat);this.tileID=function(m){let _=1/0,S=1/0,I=-1/0,T=-1/0;for(const U of m)_=Math.min(_,U.x),S=Math.min(S,U.y),I=Math.max(I,U.x),T=Math.max(T,U.y);const M=Math.max(I-_,T-S),N=Math.max(0,Math.floor(-Math.log(M)/Math.LN2)),O=Math.pow(2,N);return new c.a0(N,Math.floor((_+I)/2*O),Math.floor((S+T)/2*O))}(h),this.minzoom=this.maxzoom=this.tileID.z;const d=h.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new c.Z,this._boundsArray.emplaceBack(d[0].x,d[0].y,0,0),this._boundsArray.emplaceBack(d[1].x,d[1].y,c.W,0),this._boundsArray.emplaceBack(d[3].x,d[3].y,0,c.W),this._boundsArray.emplaceBack(d[2].x,d[2].y,c.W,c.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=c.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Q(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let d=!1;for(const m in this.tiles){const _=this.tiles[m];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,d=!0)}d&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(o){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={}):o.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Cl extends zr{constructor(o,h,d,m){super(o,h,d,m),this.roundZoom=!0,this.type="video",this.options=h}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const o=this.options;this.urls=[];for(const h of o.urls)this.urls.push(this.map._requestManager.transformRequest(h,"Source").url);try{const h=yield c.a2(this.urls);if(this._loaded=!0,!h)return;this.video=h,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(h){this.fire(new c.j(h))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(o){if(this.video){const h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new c.j(new c.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${h.start(0)} and ${h.end(0)}-second mark.`))):this.video.currentTime=o}}getVideo(){return this.video}onAdd(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const o=this.map.painter.context,h=o.gl;this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=c.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new Q(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE));let d=!1;for(const m in this.tiles){const _=this.tiles[m];_.state!=="loaded"&&(_.state="loaded",_.texture=this.texture,d=!0)}d&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Tl extends zr{constructor(o,h,d,m){super(o,h,d,m),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(S=>typeof S!="number"))||this.fire(new c.j(new c.a1(`sources.${o}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a1(`sources.${o}`,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new c.j(new c.a1(`sources.${o}`,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a1(`sources.${o}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a1(`sources.${o}`,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const h=this.map.painter.context,d=h.gl;this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,tn.members)),this.boundsSegments||(this.boundsSegments=c.$.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Q(h,this.canvas,d.RGBA,{premultiply:!0});let m=!1;for(const _ in this.tiles){const S=this.tiles[_];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,m=!0)}m&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const o of[this.canvas.width,this.canvas.height])if(isNaN(o)||o<=0)return!0;return!1}}const Ll={},Pl=y=>{switch(y){case"geojson":return qo;case"image":return zr;case"raster":return Lt;case"raster-dem":return nr;case"vector":return Ke;case"video":return Cl;case"canvas":return Tl}return Ll[y]},ga="RTLPluginLoaded";class mc extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=kn()}_syncState(o){return this.status=o,this.dispatcher.broadcast("SRPS",{pluginStatus:o,pluginURL:this.url}).catch(h=>{throw this.status="error",h})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(o){return c._(this,arguments,void 0,function*(h,d=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=P.resolveURL(h),!this.url)throw new Error(`requested url ${h} is invalid`);if(this.status==="unavailable"){if(!d)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(ga))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Za=null;function Zt(){return Za||(Za=new mc),Za}class fs{constructor(o,h){this.timeAdded=0,this.fadeEndTime=0,this.tileID=o,this.uid=c.a3(),this.uses=0,this.tileSize=h,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(o){const h=o+this.timeAdded;h<this.fadeEndTime||(this.fadeEndTime=h)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(o){this.demTexture&&o.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(o,h,d){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(m,_){const S={};if(!_)return S;for(const I of m){const T=I.layerIds.map(M=>_.getLayer(M)).filter(Boolean);if(T.length!==0){I.layers=T,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(M=>T.filter(N=>N.id===M)[0]));for(const M of T)S[M.id]=I}}return S}(o.buckets,h.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const _=this.buckets[m];if(_ instanceof c.a5){if(this.hasSymbolBuckets=!0,!d)break;_.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const _=this.buckets[m];if(_ instanceof c.a5&&_.hasRTLText){this.hasRTLText=!0,Zt().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const _=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,h.style.getLayer(m).queryRadius(_))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new c.a4}unloadVectorData(){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(o){return this.buckets[o.id]}upload(o){for(const d in this.buckets){const m=this.buckets[d];m.uploadPending()&&m.upload(o)}const h=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Q(o,this.imageAtlas.image,h.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Q(o,this.glyphAtlasImage,h.ALPHA),this.glyphAtlasImage=null)}prepare(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)}queryRenderedFeatures(o,h,d,m,_,S,I,T,M,N){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:_,scale:S,tileSize:this.tileSize,pixelPosMatrix:N,transform:T,params:I,queryPadding:this.queryPadding*M},o,h,d):{}}querySourceFeatures(o,h){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const m=d.loadVTLayers(),_=h&&h.sourceLayer?h.sourceLayer:"",S=m._geojsonTileLayer||m[_];if(!S)return;const I=c.a6(h&&h.filter),{z:T,x:M,y:N}=this.tileID.canonical,O={z:T,x:M,y:N};for(let U=0;U<S.length;U++){const tt=S.feature(U);if(I.needGeometry){const Z=c.a7(tt,!0);if(!I.filter(new c.a8(this.tileID.overscaledZ),Z,this.tileID.canonical))continue}else if(!I.filter(new c.a8(this.tileID.overscaledZ),tt))continue;const $=d.getId(tt,_),it=new c.a9(tt,T,M,N,$);it.tile=O,o.push(it)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(o){const h=this.expirationTime;if(o.cacheControl){const d=c.aa(o.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){const d=Date.now();let m=!1;if(this.expirationTime>d)m=!1;else if(h)if(this.expirationTime<h)m=!0;else{const _=this.expirationTime-h;_?this.expirationTime=d+Math.max(_,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(o,h){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(o).length===0)return;const d=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!h.style.hasLayer(m))continue;const _=this.buckets[m],S=_.layers[0].sourceLayer||"_geojsonTileLayer",I=d[S],T=o[S];if(!I||!T||Object.keys(T).length===0)continue;_.update(T,I,this.imageAtlas&&this.imageAtlas.patternPositions||{});const M=h&&h.style&&h.style.getLayer(m);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<P.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(o){this.symbolFadeHoldUntil=P.now()+o}setDependencies(o,h){const d={};for(const m of h)d[m]=!0;this.dependencies[o]=d}hasDependency(o,h){for(const d of o){const m=this.dependencies[d];if(m){for(const _ of h)if(m[_])return!0}}return!1}}class lo{constructor(o,h){this.max=o,this.onRemove=h,this.reset()}reset(){for(const o in this.data)for(const h of this.data[o])h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value);return this.data={},this.order=[],this}add(o,h,d){const m=o.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const _={value:h,timeout:void 0};if(d!==void 0&&(_.timeout=setTimeout(()=>{this.remove(o,_)},d)),this.data[m].push(_),this.order.push(m),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(o){return o.wrapped().key in this.data}getAndRemove(o){return this.has(o)?this._getAndRemoveByKey(o.wrapped().key):null}_getAndRemoveByKey(o){const h=this.data[o].shift();return h.timeout&&clearTimeout(h.timeout),this.data[o].length===0&&delete this.data[o],this.order.splice(this.order.indexOf(o),1),h.value}getByKey(o){const h=this.data[o];return h?h[0].value:null}get(o){return this.has(o)?this.data[o.wrapped().key][0].value:null}remove(o,h){if(!this.has(o))return this;const d=o.wrapped().key,m=h===void 0?0:this.data[d].indexOf(h),_=this.data[d][m];return this.data[d].splice(m,1),_.timeout&&clearTimeout(_.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(_.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(o){for(this.max=o;this.order.length>this.max;){const h=this._getAndRemoveByKey(this.order[0]);h&&this.onRemove(h)}return this}filter(o){const h=[];for(const d in this.data)for(const m of this.data[d])o(m.value)||h.push(m);for(const d of h)this.remove(d.value.tileID,d)}}class gu{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(o,h,d){const m=String(h);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},c.e(this.stateChanges[o][m],d),this.deletedStates[o]===null){this.deletedStates[o]={};for(const _ in this.state[o])_!==m&&(this.deletedStates[o][_]=null)}else if(this.deletedStates[o]&&this.deletedStates[o][m]===null){this.deletedStates[o][m]={};for(const _ in this.state[o][m])d[_]||(this.deletedStates[o][m][_]=null)}else for(const _ in d)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][_]===null&&delete this.deletedStates[o][m][_]}removeFeatureState(o,h,d){if(this.deletedStates[o]===null)return;const m=String(h);if(this.deletedStates[o]=this.deletedStates[o]||{},d&&h!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][d]=null);else if(h!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(d in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][d]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}getState(o,h){const d=String(h),m=c.e({},(this.state[o]||{})[d],(this.stateChanges[o]||{})[d]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){const _=this.deletedStates[o][h];if(_===null)return{};for(const S in _)delete m[S]}return m}initializeTileState(o,h){o.setFeatureState(this.state,h)}coalesceChanges(o,h){const d={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const _={};for(const S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),c.e(this.state[m][S],this.stateChanges[m][S]),_[S]=this.state[m][S];d[m]=_}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const _={};if(this.deletedStates[m]===null)for(const S in this.state[m])_[S]={},this.state[m][S]={};else for(const S in this.deletedStates[m]){if(this.deletedStates[m][S]===null)this.state[m][S]={};else for(const I of Object.keys(this.deletedStates[m][S]))delete this.state[m][S][I];_[S]=this.state[m][S]}d[m]=d[m]||{},c.e(d[m],_)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const m in o)o[m].setFeatureState(d,h)}}class di extends c.E{constructor(o,h,d){super(),this.id=o,this.dispatcher=d,this.on("data",m=>this._dataHandler(m)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,_,S,I)=>{const T=new(Pl(_.type))(m,_,S,I);if(T.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${T.id}`);return T})(o,h,d,this),this._tiles={},this._cache=new lo(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new gu,this._didEmitContent=!1,this._updated=!1}onAdd(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._maxTileCacheZoomLevels=o?o._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(o)}onRemove(o){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(o)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const o in this._tiles){const h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(o,h,d){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(o),this._tileLoaded(o,h,d)}catch(m){o.state="errored",m.status!==404?this._source.fire(new c.j(m,{tile:o})):this.update(this.transform,this.terrain)}})}_unloadTile(o){this._source.unloadTile&&this._source.unloadTile(o)}_abortTile(o){this._source.abortTile&&this._source.abortTile(o),this._source.fire(new c.k("dataabort",{tile:o,coord:o.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(o){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const h in this._tiles){const d=this._tiles[h];d.upload(o),d.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(o=>o.tileID).sort(te).map(o=>o.key)}getRenderableIds(o){const h=[];for(const d in this._tiles)this._isIdRenderable(d,o)&&h.push(this._tiles[d]);return o?h.sort((d,m)=>{const _=d.tileID,S=m.tileID,I=new c.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),T=new c.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-S.overscaledZ||T.y-I.y||T.x-I.x}).map(d=>d.tileID.key):h.map(d=>d.tileID).sort(te).map(d=>d.key)}hasRenderableParent(o){const h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)}_isIdRenderable(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const o in this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")}}_reloadTile(o,h){return c._(this,void 0,void 0,function*(){const d=this._tiles[o];d&&(d.state!=="loading"&&(d.state=h),yield this._loadTile(d,o,h))})}_tileLoaded(o,h,d){o.timeAdded=P.now(),d==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),o.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:o,coord:o.tileID}))}_backfillDEM(o){const h=this.getRenderableIds();for(let m=0;m<h.length;m++){const _=h[m];if(o.neighboringTiles&&o.neighboringTiles[_]){const S=this.getTileByID(_);d(o,S),d(S,o)}}function d(m,_){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let S=_.tileID.canonical.x-m.tileID.canonical.x;const I=_.tileID.canonical.y-m.tileID.canonical.y,T=Math.pow(2,m.tileID.canonical.z),M=_.tileID.key;S===0&&I===0||Math.abs(I)>1||(Math.abs(S)>1&&(Math.abs(S+T)===1?S+=T:Math.abs(S-T)===1&&(S-=T)),_.dem&&m.dem&&(m.dem.backfillBorder(_.dem,S,I),m.neighboringTiles&&m.neighboringTiles[M]&&(m.neighboringTiles[M].backfilled=!0)))}}getTile(o){return this.getTileByID(o.key)}getTileByID(o){return this._tiles[o]}_retainLoadedChildren(o,h,d,m){for(const _ in this._tiles){let S=this._tiles[_];if(m[_]||!S.hasData()||S.tileID.overscaledZ<=h||S.tileID.overscaledZ>d)continue;let I=S.tileID;for(;S&&S.tileID.overscaledZ>h+1;){const M=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[M.key],S&&S.hasData()&&(I=M)}let T=I;for(;T.overscaledZ>h;)if(T=T.scaledTo(T.overscaledZ-1),o[T.key]){m[I.key]=I;break}}}findLoadedParent(o,h){if(o.key in this._loadedParentTiles){const d=this._loadedParentTiles[o.key];return d&&d.tileID.overscaledZ>=h?d:null}for(let d=o.overscaledZ-1;d>=h;d--){const m=o.scaledTo(d),_=this._getLoadedTile(m);if(_)return _}}_getLoadedTile(o){const h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)}updateCacheSize(o){const h=Math.ceil(o.width/this._source.tileSize)+1,d=Math.ceil(o.height/this._source.tileSize)+1,m=Math.floor(h*d*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),_=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(_)}handleWrapJump(o){const h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){const d={};for(const m in this._tiles){const _=this._tiles[m];_.tileID=_.tileID.unwrapTo(_.tileID.wrap+h),d[_.tileID.key]=_}this._tiles=d;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(o,h){if(!this._sourceLoaded||this._paused)return;let d;this.transform=o,this.terrain=h,this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?d=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(N=>new c.Q(N.canonical.z,N.wrap,N.canonical.z,N.canonical.x,N.canonical.y)):(d=o.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:h}),this._source.hasTile&&(d=d.filter(N=>this._source.hasTile(N)))):d=[];const m=o.coveringZoomLevel(this._source),_=Math.max(m-di.maxOverzooming,this._source.minzoom),S=Math.max(m+di.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const N={};for(const O of d)if(O.canonical.z>this._source.minzoom){const U=O.scaledTo(O.canonical.z-1);N[U.key]=U;const tt=O.scaledTo(Math.max(this._source.minzoom,Math.min(O.canonical.z,5)));N[tt.key]=tt}d=d.concat(Object.values(N))}const I=d.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,I&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const T=this._updateRetainedTiles(d,m);if(We(this._source.type)){const N={},O={},U=Object.keys(T),tt=P.now();for(const $ of U){const it=T[$],Z=this._tiles[$];if(!Z||Z.fadeEndTime!==0&&Z.fadeEndTime<=tt)continue;const ht=this.findLoadedParent(it,_);ht&&(this._addTile(ht.tileID),N[ht.tileID.key]=ht.tileID),O[$]=it}this._retainLoadedChildren(O,m,S,T);for(const $ in N)T[$]||(this._coveredTiles[$]=!0,T[$]=N[$]);if(h){const $={},it={};for(const Z of d)this._tiles[Z.key].hasData()?$[Z.key]=Z:it[Z.key]=Z;for(const Z in it){const ht=it[Z].children(this._source.maxzoom);this._tiles[ht[0].key]&&this._tiles[ht[1].key]&&this._tiles[ht[2].key]&&this._tiles[ht[3].key]&&($[ht[0].key]=T[ht[0].key]=ht[0],$[ht[1].key]=T[ht[1].key]=ht[1],$[ht[2].key]=T[ht[2].key]=ht[2],$[ht[3].key]=T[ht[3].key]=ht[3],delete it[Z])}for(const Z in it){const ht=this.findLoadedParent(it[Z],this._source.minzoom);if(ht){$[ht.tileID.key]=T[ht.tileID.key]=ht.tileID;for(const It in $)$[It].isChildOf(ht.tileID)&&delete $[It]}}for(const Z in this._tiles)$[Z]||(this._coveredTiles[Z]=!0)}}for(const N in T)this._tiles[N].clearFadeHold();const M=c.ab(this._tiles,T);for(const N of M){const O=this._tiles[N];O.hasSymbolBuckets&&!O.holdingForFade()?O.setHoldDuration(this.map._fadeDuration):O.hasSymbolBuckets&&!O.symbolFadeFinished()||this._removeTile(N)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)}_updateRetainedTiles(o,h){const d={},m={},_=Math.max(h-di.maxOverzooming,this._source.minzoom),S=Math.max(h+di.maxUnderzooming,this._source.minzoom),I={};for(const T of o){const M=this._addTile(T);d[T.key]=T,M.hasData()||h<this._source.maxzoom&&(I[T.key]=T)}this._retainLoadedChildren(I,h,S,d);for(const T of o){let M=this._tiles[T.key];if(M.hasData())continue;if(h+1>this._source.maxzoom){const O=T.children(this._source.maxzoom)[0],U=this.getTile(O);if(U&&U.hasData()){d[O.key]=O;continue}}else{const O=T.children(this._source.maxzoom);if(d[O[0].key]&&d[O[1].key]&&d[O[2].key]&&d[O[3].key])continue}let N=M.wasRequested();for(let O=T.overscaledZ-1;O>=_;--O){const U=T.scaledTo(O);if(m[U.key])break;if(m[U.key]=!0,M=this.getTile(U),!M&&N&&(M=this._addTile(U)),M){const tt=M.hasData();if((N||tt)&&(d[U.key]=U),N=M.wasRequested(),tt)break}}}return d}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const o in this._tiles){const h=[];let d,m=this._tiles[o].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){d=this._loadedParentTiles[m.key];break}h.push(m.key);const _=m.scaledTo(m.overscaledZ-1);if(d=this._getLoadedTile(_),d)break;m=_}for(const _ of h)this._loadedParentTiles[_]=d}}_addTile(o){let h=this._tiles[o.key];if(h)return h;h=this._cache.getAndRemove(o),h&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));const d=h;return h||(h=new fs(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,o.key,h.state)),h.uses++,this._tiles[o.key]=h,d||this._source.fire(new c.k("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h}_setTileReloadTimer(o,h){o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);const d=h.getExpiryTimeout();d&&(this._timers[o]=setTimeout(()=>{this._reloadTile(o,"expired"),delete this._timers[o]},d))}_removeTile(o){const h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))}_dataHandler(o){const h=o.sourceDataType;o.dataType==="source"&&h==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&o.dataType==="source"&&h==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const o in this._tiles)this._removeTile(o);this._cache.reset()}tilesIn(o,h,d){const m=[],_=this.transform;if(!_)return m;const S=d?_.getCameraQueryGeometry(o):o,I=o.map($=>_.pointCoordinate($,this.terrain)),T=S.map($=>_.pointCoordinate($,this.terrain)),M=this.getIds();let N=1/0,O=1/0,U=-1/0,tt=-1/0;for(const $ of T)N=Math.min(N,$.x),O=Math.min(O,$.y),U=Math.max(U,$.x),tt=Math.max(tt,$.y);for(let $=0;$<M.length;$++){const it=this._tiles[M[$]];if(it.holdingForFade())continue;const Z=it.tileID,ht=Math.pow(2,_.zoom-it.tileID.overscaledZ),It=h*it.queryPadding*c.W/it.tileSize/ht,st=[Z.getTilePoint(new c.Y(N,O)),Z.getTilePoint(new c.Y(U,tt))];if(st[0].x-It<c.W&&st[0].y-It<c.W&&st[1].x+It>=0&&st[1].y+It>=0){const _t=I.map(At=>Z.getTilePoint(At)),Ct=T.map(At=>Z.getTilePoint(At));m.push({tile:it,tileID:Z,queryGeometry:_t,cameraQueryGeometry:Ct,scale:ht})}}return m}getVisibleCoordinates(o){const h=this.getRenderableIds(o).map(d=>this._tiles[d].tileID);for(const d of h)d.posMatrix=this.transform.calculatePosMatrix(d.toUnwrapped());return h}hasTransition(){if(this._source.hasTransition())return!0;if(We(this._source.type)){const o=P.now();for(const h in this._tiles)if(this._tiles[h].fadeEndTime>=o)return!0}return!1}setFeatureState(o,h,d){this._state.updateState(o=o||"_geojsonTileLayer",h,d)}removeFeatureState(o,h,d){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,d)}getFeatureState(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)}setDependencies(o,h,d){const m=this._tiles[o];m&&m.setDependencies(h,d)}reloadTilesForDependencies(o,h){for(const d in this._tiles)this._tiles[d].hasDependency(o,h)&&this._reloadTile(d,"reloading");this._cache.filter(d=>!d.hasDependency(o,h))}}function te(y,o){const h=Math.abs(2*y.wrap)-+(y.wrap<0),d=Math.abs(2*o.wrap)-+(o.wrap<0);return y.overscaledZ-o.overscaledZ||d-h||o.canonical.y-y.canonical.y||o.canonical.x-y.canonical.x}function We(y){return y==="raster"||y==="image"||y==="video"}di.maxOverzooming=10,di.maxUnderzooming=3;class Ue{constructor(o,h){this.reset(o,h)}reset(o,h){this.points=o||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(h||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(o){if(this.points.length===1)return this.points[0];o=c.ac(o,0,1);let h=1,d=this._distances[h];const m=o*this.paddedLength+this.padding;for(;d<m&&h<this._distances.length;)d=this._distances[++h];const _=h-1,S=this._distances[_],I=d-S,T=I>0?(m-S)/I:0;return this.points[_].mult(1-T).add(this.points[h].mult(T))}}function Pr(y,o){let h=!0;return y==="always"||y!=="never"&&o!=="never"||(h=!1),h}class ds{constructor(o,h,d){const m=this.boxCells=[],_=this.circleCells=[];this.xCellCount=Math.ceil(o/d),this.yCellCount=Math.ceil(h/d);for(let S=0;S<this.xCellCount*this.yCellCount;S++)m.push([]),_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=o,this.height=h,this.xScale=this.xCellCount/o,this.yScale=this.yCellCount/h,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(o,h,d,m,_){this._forEachCell(h,d,m,_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(o),this.bboxes.push(h),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(_)}insertCircle(o,h,d,m){this._forEachCell(h-m,d-m,h+m,d+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(o),this.circles.push(h),this.circles.push(d),this.circles.push(m)}_insertBoxCell(o,h,d,m,_,S){this.boxCells[_].push(S)}_insertCircleCell(o,h,d,m,_,S){this.circleCells[_].push(S)}_query(o,h,d,m,_,S,I){if(d<0||o>this.width||m<0||h>this.height)return[];const T=[];if(o<=0&&h<=0&&this.width<=d&&this.height<=m){if(_)return[{key:null,x1:o,y1:h,x2:d,y2:m}];for(let M=0;M<this.boxKeys.length;M++)T.push({key:this.boxKeys[M],x1:this.bboxes[4*M],y1:this.bboxes[4*M+1],x2:this.bboxes[4*M+2],y2:this.bboxes[4*M+3]});for(let M=0;M<this.circleKeys.length;M++){const N=this.circles[3*M],O=this.circles[3*M+1],U=this.circles[3*M+2];T.push({key:this.circleKeys[M],x1:N-U,y1:O-U,x2:N+U,y2:O+U})}}else this._forEachCell(o,h,d,m,this._queryCell,T,{hitTest:_,overlapMode:S,seenUids:{box:{},circle:{}}},I);return T}query(o,h,d,m){return this._query(o,h,d,m,!1,null)}hitTest(o,h,d,m,_,S){return this._query(o,h,d,m,!0,_,S).length>0}hitTestCircle(o,h,d,m,_){const S=o-d,I=o+d,T=h-d,M=h+d;if(I<0||S>this.width||M<0||T>this.height)return!1;const N=[];return this._forEachCell(S,T,I,M,this._queryCellCircle,N,{hitTest:!0,overlapMode:m,circle:{x:o,y:h,radius:d},seenUids:{box:{},circle:{}}},_),N.length>0}_queryCell(o,h,d,m,_,S,I,T){const{seenUids:M,hitTest:N,overlapMode:O}=I,U=this.boxCells[_];if(U!==null){const $=this.bboxes;for(const it of U)if(!M.box[it]){M.box[it]=!0;const Z=4*it,ht=this.boxKeys[it];if(o<=$[Z+2]&&h<=$[Z+3]&&d>=$[Z+0]&&m>=$[Z+1]&&(!T||T(ht))&&(!N||!Pr(O,ht.overlapMode))&&(S.push({key:ht,x1:$[Z],y1:$[Z+1],x2:$[Z+2],y2:$[Z+3]}),N))return!0}}const tt=this.circleCells[_];if(tt!==null){const $=this.circles;for(const it of tt)if(!M.circle[it]){M.circle[it]=!0;const Z=3*it,ht=this.circleKeys[it];if(this._circleAndRectCollide($[Z],$[Z+1],$[Z+2],o,h,d,m)&&(!T||T(ht))&&(!N||!Pr(O,ht.overlapMode))){const It=$[Z],st=$[Z+1],_t=$[Z+2];if(S.push({key:ht,x1:It-_t,y1:st-_t,x2:It+_t,y2:st+_t}),N)return!0}}}return!1}_queryCellCircle(o,h,d,m,_,S,I,T){const{circle:M,seenUids:N,overlapMode:O}=I,U=this.boxCells[_];if(U!==null){const $=this.bboxes;for(const it of U)if(!N.box[it]){N.box[it]=!0;const Z=4*it,ht=this.boxKeys[it];if(this._circleAndRectCollide(M.x,M.y,M.radius,$[Z+0],$[Z+1],$[Z+2],$[Z+3])&&(!T||T(ht))&&!Pr(O,ht.overlapMode))return S.push(!0),!0}}const tt=this.circleCells[_];if(tt!==null){const $=this.circles;for(const it of tt)if(!N.circle[it]){N.circle[it]=!0;const Z=3*it,ht=this.circleKeys[it];if(this._circlesCollide($[Z],$[Z+1],$[Z+2],M.x,M.y,M.radius)&&(!T||T(ht))&&!Pr(O,ht.overlapMode))return S.push(!0),!0}}}_forEachCell(o,h,d,m,_,S,I,T){const M=this._convertToXCellCoord(o),N=this._convertToYCellCoord(h),O=this._convertToXCellCoord(d),U=this._convertToYCellCoord(m);for(let tt=M;tt<=O;tt++)for(let $=N;$<=U;$++)if(_.call(this,o,h,d,m,this.xCellCount*$+tt,S,I,T))return}_convertToXCellCoord(o){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(o*this.xScale)))}_convertToYCellCoord(o){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(o*this.yScale)))}_circlesCollide(o,h,d,m,_,S){const I=m-o,T=_-h,M=d+S;return M*M>I*I+T*T}_circleAndRectCollide(o,h,d,m,_,S,I){const T=(S-m)/2,M=Math.abs(o-(m+T));if(M>T+d)return!1;const N=(I-_)/2,O=Math.abs(h-(_+N));if(O>N+d)return!1;if(M<=T||O<=N)return!0;const U=M-T,tt=O-N;return U*U+tt*tt<=d*d}}function Oe(y,o,h,d,m){const _=c.F();return o?(c.J(_,_,[1/m,1/m,1]),h||c.ad(_,_,d.angle)):c.K(_,d.labelPlaneMatrix,y),_}function Ha(y,o,h,d,m){if(o){const _=c.ae(y);return c.J(_,_,[m,m,1]),h||c.ad(_,_,-d.angle),_}return d.glCoordMatrix}function Fr(y,o,h){let d;h?(d=[y.x,y.y,h(y.x,y.y),1],c.af(d,d,o)):(d=[y.x,y.y,0,1],ge(d,d,o));const m=d[3];return{point:new c.P(d[0]/m,d[1]/m),signedDistanceFromCamera:m}}function rt(y,o){return .5+y/o*.5}function z(y,o){const h=y[0]/y[3],d=y[1]/y[3];return h>=-o[0]&&h<=o[0]&&d>=-o[1]&&d<=o[1]}function B(y,o,h,d,m,_,S,I,T,M){const N=d?y.textSizeData:y.iconSizeData,O=c.ag(N,h.transform.zoom),U=[256/h.width*2+1,256/h.height*2+1],tt=d?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;tt.clear();const $=y.lineVertexArray,it=d?y.text.placedSymbolArray:y.icon.placedSymbolArray,Z=h.transform.width/h.transform.height;let ht=!1;for(let It=0;It<it.length;It++){const st=it.get(It);if(st.hidden||st.writingMode===c.ah.vertical&&!ht){Ot(st.numGlyphs,tt);continue}let _t;if(ht=!1,M?(_t=[st.anchorX,st.anchorY,M(st.anchorX,st.anchorY),1],c.af(_t,_t,o)):(_t=[st.anchorX,st.anchorY,0,1],ge(_t,_t,o)),!z(_t,U)){Ot(st.numGlyphs,tt);continue}const Ct=rt(h.transform.cameraToCenterDistance,_t[3]),At=c.ai(N,O,st),kt=S?At/Ct:At*Ct,Vt=new c.P(st.anchorX,st.anchorY),Bt=Fr(Vt,m,M).point,Wt={projections:{},offsets:{}},Xt=pt(st,kt,!1,I,o,m,_,y.glyphOffsetArray,$,tt,Bt,Vt,Wt,Z,T,M);ht=Xt.useVertical,(Xt.notEnoughRoom||ht||Xt.needsFlipping&&pt(st,kt,!0,I,o,m,_,y.glyphOffsetArray,$,tt,Bt,Vt,Wt,Z,T,M).notEnoughRoom)&&Ot(st.numGlyphs,tt)}d?y.text.dynamicLayoutVertexBuffer.updateData(tt):y.icon.dynamicLayoutVertexBuffer.updateData(tt)}function j(y,o,h,d,m,_,S,I,T,M,N,O,U){const tt=I.glyphStartIndex+I.numGlyphs,$=I.lineStartIndex,it=I.lineStartIndex+I.lineLength,Z=o.getoffsetX(I.glyphStartIndex),ht=o.getoffsetX(tt-1),It=Ft(y*Z,h,d,m,_,S,I.segment,$,it,T,M,N,O,U);if(!It)return null;const st=Ft(y*ht,h,d,m,_,S,I.segment,$,it,T,M,N,O,U);return st?{first:It,last:st}:null}function J(y,o,h,d){return y===c.ah.horizontal&&Math.abs(h.y-o.y)>Math.abs(h.x-o.x)*d?{useVertical:!0}:(y===c.ah.vertical?o.y<h.y:o.x>h.x)?{needsFlipping:!0}:null}function pt(y,o,h,d,m,_,S,I,T,M,N,O,U,tt,$,it){const Z=o/24,ht=y.lineOffsetX*Z,It=y.lineOffsetY*Z;let st;if(y.numGlyphs>1){const _t=y.glyphStartIndex+y.numGlyphs,Ct=y.lineStartIndex,At=y.lineStartIndex+y.lineLength,kt=j(Z,I,ht,It,h,N,O,y,T,_,U,$,it);if(!kt)return{notEnoughRoom:!0};const Vt=Fr(kt.first.point,S,it).point,Bt=Fr(kt.last.point,S,it).point;if(d&&!h){const Wt=J(y.writingMode,Vt,Bt,tt);if(Wt)return Wt}st=[kt.first];for(let Wt=y.glyphStartIndex+1;Wt<_t-1;Wt++)st.push(Ft(Z*I.getoffsetX(Wt),ht,It,h,N,O,y.segment,Ct,At,T,_,U,$,it));st.push(kt.last)}else{if(d&&!h){const Ct=Fr(O,m,it).point,At=y.lineStartIndex+y.segment+1,kt=new c.P(T.getx(At),T.gety(At)),Vt=Fr(kt,m,it),Bt=Vt.signedDistanceFromCamera>0?Vt.point:ft(O,kt,Ct,1,m,it),Wt=J(y.writingMode,Ct,Bt,tt);if(Wt)return Wt}const _t=Ft(Z*I.getoffsetX(y.glyphStartIndex),ht,It,h,N,O,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,T,_,U,$,it);if(!_t)return{notEnoughRoom:!0};st=[_t]}for(const _t of st)c.aj(M,_t.point,_t.angle);return{}}function ft(y,o,h,d,m,_){const S=Fr(y.add(y.sub(o)._unit()),m,_).point,I=h.sub(S);return h.add(I._mult(d/I.mag()))}function vt(y,o){const{projectionCache:h,lineVertexArray:d,labelPlaneMatrix:m,tileAnchorPoint:_,distanceFromAnchor:S,getElevation:I,previousVertex:T,direction:M,absOffsetX:N}=o;if(h.projections[y])return h.projections[y];const O=new c.P(d.getx(y),d.gety(y)),U=Fr(O,m,I);if(U.signedDistanceFromCamera>0)return h.projections[y]=U.point,U.point;const tt=y-M;return ft(S===0?_:new c.P(d.getx(tt),d.gety(tt)),O,T,N-S+1,m,I)}function ct(y,o,h){return y._unit()._perp()._mult(o*h)}function wt(y,o,h,d,m,_,S,I){const{projectionCache:T,direction:M}=I;if(T.offsets[y])return T.offsets[y];const N=h.add(o);if(y+M<d||y+M>=m)return T.offsets[y]=N,N;const O=vt(y+M,I),U=ct(O.sub(h),S,M),tt=h.add(U),$=O.add(U);return T.offsets[y]=c.ak(_,N,tt,$)||N,T.offsets[y]}function Ft(y,o,h,d,m,_,S,I,T,M,N,O,U,tt){const $=d?y-o:y+o;let it=$>0?1:-1,Z=0;d&&(it*=-1,Z=Math.PI),it<0&&(Z+=Math.PI);let ht,It,st=it>0?I+S:I+S+1,_t=m,Ct=m,At=0,kt=0;const Vt=Math.abs($),Bt=[];let Wt;for(;At+kt<=Vt;){if(st+=it,st<I||st>=T)return null;At+=kt,Ct=_t,It=ht;const Kt={projectionCache:O,lineVertexArray:M,labelPlaneMatrix:N,tileAnchorPoint:_,distanceFromAnchor:At,getElevation:tt,previousVertex:Ct,direction:it,absOffsetX:Vt};if(_t=vt(st,Kt),h===0)Bt.push(Ct),Wt=_t.sub(Ct);else{let Se;const Be=_t.sub(Ct);Se=Be.mag()===0?ct(vt(st+it,Kt).sub(_t),h,it):ct(Be,h,it),It||(It=Ct.add(Se)),ht=wt(st,Se,_t,I,T,It,h,Kt),Bt.push(It),Wt=ht.sub(It)}kt=Wt.mag()}const Xt=Wt._mult((Vt-At)/kt)._add(It||Ct),Fe=Z+Math.atan2(_t.y-Ct.y,_t.x-Ct.x);return Bt.push(Xt),{point:Xt,angle:U?Fe:0,path:Bt}}const Nt=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ot(y,o){for(let h=0;h<y;h++){const d=o.length;o.resize(d+4),o.float32.set(Nt,3*d)}}function ge(y,o,h){const d=o[0],m=o[1];return y[0]=h[0]*d+h[4]*m+h[12],y[1]=h[1]*d+h[5]*m+h[13],y[3]=h[3]*d+h[7]*m+h[15],y}const be=100;class ze{constructor(o,h=new ds(o.width+200,o.height+200,25),d=new ds(o.width+200,o.height+200,25)){this.transform=o,this.grid=h,this.ignoredGrid=d,this.pitchfactor=Math.cos(o._pitch)*o.cameraToCenterDistance,this.screenRightBoundary=o.width+be,this.screenBottomBoundary=o.height+be,this.gridRightBoundary=o.width+200,this.gridBottomBoundary=o.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(o,h,d,m,_,S){const I=this.projectAndGetPerspectiveRatio(m,o.anchorPointX,o.anchorPointY,S),T=d*I.perspectiveRatio,M=o.x1*T+I.point.x,N=o.y1*T+I.point.y,O=o.x2*T+I.point.x,U=o.y2*T+I.point.y;return!this.isInsideGrid(M,N,O,U)||h!=="always"&&this.grid.hitTest(M,N,O,U,h,_)||I.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[M,N,O,U],offscreen:this.isOffscreen(M,N,O,U)}}placeCollisionCircles(o,h,d,m,_,S,I,T,M,N,O,U,tt,$){const it=[],Z=new c.P(h.anchorX,h.anchorY),ht=Fr(Z,S,$),It=rt(this.transform.cameraToCenterDistance,ht.signedDistanceFromCamera),st=(N?_/It:_*It)/c.ao,_t=Fr(Z,I,$).point,Ct=j(st,m,h.lineOffsetX*st,h.lineOffsetY*st,!1,_t,Z,h,d,I,{projections:{},offsets:{}},!1,$);let At=!1,kt=!1,Vt=!0;if(Ct){const Bt=.5*U*It+tt,Wt=new c.P(-100,-100),Xt=new c.P(this.screenRightBoundary,this.screenBottomBoundary),Fe=new Ue,Kt=Ct.first,Se=Ct.last;let Be=[];for(let qe=Kt.path.length-1;qe>=1;qe--)Be.push(Kt.path[qe]);for(let qe=1;qe<Se.path.length;qe++)Be.push(Se.path[qe]);const hn=2.5*Bt;if(T){const qe=Be.map(Xe=>Fr(Xe,T,$));Be=qe.some(Xe=>Xe.signedDistanceFromCamera<=0)?[]:qe.map(Xe=>Xe.point)}let Pe=[];if(Be.length>0){const qe=Be[0].clone(),Xe=Be[0].clone();for(let pr=1;pr<Be.length;pr++)qe.x=Math.min(qe.x,Be[pr].x),qe.y=Math.min(qe.y,Be[pr].y),Xe.x=Math.max(Xe.x,Be[pr].x),Xe.y=Math.max(Xe.y,Be[pr].y);Pe=qe.x>=Wt.x&&Xe.x<=Xt.x&&qe.y>=Wt.y&&Xe.y<=Xt.y?[Be]:Xe.x<Wt.x||qe.x>Xt.x||Xe.y<Wt.y||qe.y>Xt.y?[]:c.al([Be],Wt.x,Wt.y,Xt.x,Xt.y)}for(const qe of Pe){Fe.reset(qe,.25*Bt);let Xe=0;Xe=Fe.length<=.5*Bt?1:Math.ceil(Fe.paddedLength/hn)+1;for(let pr=0;pr<Xe;pr++){const Mn=pr/Math.max(Xe-1,1),po=Fe.lerp(Mn),Vr=po.x+be,ir=po.y+be;it.push(Vr,ir,Bt,0);const Ur=Vr-Bt,fo=ir-Bt,xs=Vr+Bt,Sa=ir+Bt;if(Vt=Vt&&this.isOffscreen(Ur,fo,xs,Sa),kt=kt||this.isInsideGrid(Ur,fo,xs,Sa),o!=="always"&&this.grid.hitTestCircle(Vr,ir,Bt,o,O)&&(At=!0,!M))return{circles:[],offscreen:!1,collisionDetected:At}}}}return{circles:!M&&At||!kt||It<this.perspectiveRatioCutoff?[]:it,offscreen:Vt,collisionDetected:At}}queryRenderedSymbols(o){if(o.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const h=[];let d=1/0,m=1/0,_=-1/0,S=-1/0;for(const N of o){const O=new c.P(N.x+be,N.y+be);d=Math.min(d,O.x),m=Math.min(m,O.y),_=Math.max(_,O.x),S=Math.max(S,O.y),h.push(O)}const I=this.grid.query(d,m,_,S).concat(this.ignoredGrid.query(d,m,_,S)),T={},M={};for(const N of I){const O=N.key;if(T[O.bucketInstanceId]===void 0&&(T[O.bucketInstanceId]={}),T[O.bucketInstanceId][O.featureIndex])continue;const U=[new c.P(N.x1,N.y1),new c.P(N.x2,N.y1),new c.P(N.x2,N.y2),new c.P(N.x1,N.y2)];c.am(h,U)&&(T[O.bucketInstanceId][O.featureIndex]=!0,M[O.bucketInstanceId]===void 0&&(M[O.bucketInstanceId]=[]),M[O.bucketInstanceId].push(O.featureIndex))}return M}insertCollisionBox(o,h,d,m,_,S){(d?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:_,collisionGroupID:S,overlapMode:h},o[0],o[1],o[2],o[3])}insertCollisionCircles(o,h,d,m,_,S){const I=d?this.ignoredGrid:this.grid,T={bucketInstanceId:m,featureIndex:_,collisionGroupID:S,overlapMode:h};for(let M=0;M<o.length;M+=4)I.insertCircle(T,o[M],o[M+1],o[M+2])}projectAndGetPerspectiveRatio(o,h,d,m){let _;return m?(_=[h,d,m(h,d),1],c.af(_,_,o)):(_=[h,d,0,1],ge(_,_,o)),{point:new c.P((_[0]/_[3]+1)/2*this.transform.width+be,(-_[1]/_[3]+1)/2*this.transform.height+be),perspectiveRatio:.5+this.transform.cameraToCenterDistance/_[3]*.5}}isOffscreen(o,h,d,m){return d<be||o>=this.screenRightBoundary||m<be||h>this.screenBottomBoundary}isInsideGrid(o,h,d,m){return d>=0&&o<this.gridRightBoundary&&m>=0&&h<this.gridBottomBoundary}getViewportMatrix(){const o=c.an([]);return c.H(o,o,[-100,-100,0]),o}}function Ae(y,o,h){return o*(c.W/(y.tileSize*Math.pow(2,h-y.tileID.overscaledZ)))}class un{constructor(o,h,d,m){this.opacity=o?Math.max(0,Math.min(1,o.opacity+(o.placed?h:-h))):m&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class Rn{constructor(o,h,d,m,_){this.text=new un(o?o.text:null,h,d,_),this.icon=new un(o?o.icon:null,h,m,_)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Yn{constructor(o,h,d){this.text=o,this.icon=h,this.skipFade=d}}class Ar{constructor(){this.invProjMatrix=c.F(),this.viewportMatrix=c.F(),this.circles=[]}}class Ge{constructor(o,h,d,m,_){this.bucketInstanceId=o,this.featureIndex=h,this.sourceLayerIndex=d,this.bucketIndex=m,this.tileID=_}}class ur{constructor(o){this.crossSourceCollisions=o,this.maxGroupID=0,this.collisionGroups={}}get(o){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[o]){const h=++this.maxGroupID;this.collisionGroups[o]={ID:h,predicate:d=>d.collisionGroupID===h}}return this.collisionGroups[o]}}function Br(y,o,h,d,m){const{horizontalAlign:_,verticalAlign:S}=c.at(y);return new c.P(-(_-.5)*o+d[0]*m,-(S-.5)*h+d[1]*m)}function Li(y,o,h,d,m,_){const{x1:S,x2:I,y1:T,y2:M,anchorPointX:N,anchorPointY:O}=y,U=new c.P(o,h);return d&&U._rotate(m?_:-_),{x1:S+U.x,y1:T+U.y,x2:I+U.x,y2:M+U.y,anchorPointX:N,anchorPointY:O}}class Ui{constructor(o,h,d,m,_){this.transform=o.clone(),this.terrain=h,this.collisionIndex=new ze(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=d,this.retainedQueryData={},this.collisionGroups=new ur(m),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(o,h,d,m){const _=d.getBucket(h),S=d.latestFeatureIndex;if(!_||!S||h.id!==_.layerIds[0])return;const I=d.collisionBoxArray,T=_.layers[0].layout,M=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),N=d.tileSize/c.W,O=this.transform.calculatePosMatrix(d.tileID.toUnwrapped()),U=T.get("text-pitch-alignment")==="map",tt=T.get("text-rotation-alignment")==="map",$=Ae(d,1,this.transform.zoom),it=Oe(O,U,tt,this.transform,$);let Z=null;if(U){const It=Ha(O,U,tt,this.transform,$);Z=c.K([],this.transform.labelPlaneMatrix,It)}this.retainedQueryData[_.bucketInstanceId]=new Ge(_.bucketInstanceId,S,_.sourceLayerIndex,_.index,d.tileID);const ht={bucket:_,layout:T,posMatrix:O,textLabelPlaneMatrix:it,labelToScreenMatrix:Z,scale:M,textPixelRatio:N,holdingForFade:d.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:c.ag(_.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(_.sourceID)};if(m)for(const It of _.sortKeyRanges){const{sortKey:st,symbolInstanceStart:_t,symbolInstanceEnd:Ct}=It;o.push({sortKey:st,symbolInstanceStart:_t,symbolInstanceEnd:Ct,parameters:ht})}else o.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:ht})}attemptAnchorPlacement(o,h,d,m,_,S,I,T,M,N,O,U,tt,$,it,Z){const ht=c.ap[o.textAnchor],It=[o.textOffset0,o.textOffset1],st=Br(ht,d,m,It,_),_t=this.collisionIndex.placeCollisionBox(Li(h,st.x,st.y,S,I,this.transform.angle),O,T,M,N.predicate,Z);if((!it||this.collisionIndex.placeCollisionBox(Li(it,st.x,st.y,S,I,this.transform.angle),O,T,M,N.predicate,Z).box.length!==0)&&_t.box.length>0){let Ct;if(this.prevPlacement&&this.prevPlacement.variableOffsets[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID]&&this.prevPlacement.placements[U.crossTileID].text&&(Ct=this.prevPlacement.variableOffsets[U.crossTileID].anchor),U.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[U.crossTileID]={textOffset:It,width:d,height:m,anchor:ht,textBoxScale:_,prevAnchor:Ct},this.markUsedJustification(tt,ht,U,$),tt.allowVerticalPlacement&&(this.markUsedOrientation(tt,$,U),this.placedOrientations[U.crossTileID]=$),{shift:st,placedGlyphBoxes:_t}}}placeLayerBucketPart(o,h,d){const{bucket:m,layout:_,posMatrix:S,textLabelPlaneMatrix:I,labelToScreenMatrix:T,textPixelRatio:M,holdingForFade:N,collisionBoxArray:O,partiallyEvaluatedTextSize:U,collisionGroup:tt}=o.parameters,$=_.get("text-optional"),it=_.get("icon-optional"),Z=c.aq(_,"text-overlap","text-allow-overlap"),ht=Z==="always",It=c.aq(_,"icon-overlap","icon-allow-overlap"),st=It==="always",_t=_.get("text-rotation-alignment")==="map",Ct=_.get("text-pitch-alignment")==="map",At=_.get("icon-text-fit")!=="none",kt=_.get("symbol-z-order")==="viewport-y",Vt=ht&&(st||!m.hasIconData()||it),Bt=st&&(ht||!m.hasTextData()||$);!m.collisionArrays&&O&&m.deserializeCollisionBoxes(O);const Wt=this.retainedQueryData[m.bucketInstanceId].tileID,Xt=this.terrain?(Kt,Se)=>this.terrain.getElevation(Wt,Kt,Se):null,Fe=(Kt,Se)=>{var Be,hn;if(h[Kt.crossTileID])return;if(N)return void(this.placements[Kt.crossTileID]=new Yn(!1,!1,!1));let Pe=!1,qe=!1,Xe=!0,pr=null,Mn={box:null,offscreen:null},po={box:null,offscreen:null},Vr=null,ir=null,Ur=null,fo=0,xs=0,Sa=0;Se.textFeatureIndex?fo=Se.textFeatureIndex:Kt.useRuntimeCollisionCircles&&(fo=Kt.featureIndex),Se.verticalTextFeatureIndex&&(xs=Se.verticalTextFeatureIndex);const Bu=Se.textBox;if(Bu){const Dr=kr=>{let sr=c.ah.horizontal;if(m.allowVerticalPlacement&&!kr&&this.prevPlacement){const Ao=this.prevPlacement.placedOrientations[Kt.crossTileID];Ao&&(this.placedOrientations[Kt.crossTileID]=Ao,sr=Ao,this.markUsedOrientation(m,sr,Kt))}return sr},or=(kr,sr)=>{if(m.allowVerticalPlacement&&Kt.numVerticalGlyphVertices>0&&Se.verticalTextBox){for(const Ao of m.writingModes)if(Ao===c.ah.vertical?(Mn=sr(),po=Mn):Mn=kr(),Mn&&Mn.box&&Mn.box.length)break}else Mn=kr()},Jn=Kt.textAnchorOffsetStartIndex,Po=Kt.textAnchorOffsetEndIndex;if(Po===Jn){const kr=(sr,Ao)=>{const Rr=this.collisionIndex.placeCollisionBox(sr,Z,M,S,tt.predicate,Xt);return Rr&&Rr.box&&Rr.box.length&&(this.markUsedOrientation(m,Ao,Kt),this.placedOrientations[Kt.crossTileID]=Ao),Rr};or(()=>kr(Bu,c.ah.horizontal),()=>{const sr=Se.verticalTextBox;return m.allowVerticalPlacement&&Kt.numVerticalGlyphVertices>0&&sr?kr(sr,c.ah.vertical):{box:null,offscreen:null}}),Dr(Mn&&Mn.box&&Mn.box.length)}else{let kr=c.ap[(hn=(Be=this.prevPlacement)===null||Be===void 0?void 0:Be.variableOffsets[Kt.crossTileID])===null||hn===void 0?void 0:hn.anchor];const sr=(Rr,yr,Bp)=>{const jd=Rr.x2-Rr.x1,nl=Rr.y2-Rr.y1,rl=Kt.textBoxScale,eh=At&&It==="never"?yr:null;let Ea={box:[],offscreen:!1},Vp=Z==="never"?1:2,Wd="never";kr&&Vp++;for(let Up=0;Up<Vp;Up++){for(let Gp=Jn;Gp<Po;Gp++){const nh=m.textAnchorOffsets.get(Gp);if(kr&&nh.textAnchor!==kr)continue;const qp=this.attemptAnchorPlacement(nh,Rr,jd,nl,rl,_t,Ct,M,S,tt,Wd,Kt,m,Bp,eh,Xt);if(qp&&(Ea=qp.placedGlyphBoxes,Ea&&Ea.box&&Ea.box.length))return Pe=!0,pr=qp.shift,Ea}kr?kr=null:Wd=Z}return Ea};or(()=>sr(Bu,Se.iconBox,c.ah.horizontal),()=>{const Rr=Se.verticalTextBox;return m.allowVerticalPlacement&&!(Mn&&Mn.box&&Mn.box.length)&&Kt.numVerticalGlyphVertices>0&&Rr?sr(Rr,Se.verticalIconBox,c.ah.vertical):{box:null,offscreen:null}}),Mn&&(Pe=Mn.box,Xe=Mn.offscreen);const Ao=Dr(Mn&&Mn.box);if(!Pe&&this.prevPlacement){const Rr=this.prevPlacement.variableOffsets[Kt.crossTileID];Rr&&(this.variableOffsets[Kt.crossTileID]=Rr,this.markUsedJustification(m,Rr.anchor,Kt,Ao))}}}if(Vr=Mn,Pe=Vr&&Vr.box&&Vr.box.length>0,Xe=Vr&&Vr.offscreen,Kt.useRuntimeCollisionCircles){const Dr=m.text.placedSymbolArray.get(Kt.centerJustifiedTextSymbolIndex),or=c.ai(m.textSizeData,U,Dr),Jn=_.get("text-padding");ir=this.collisionIndex.placeCollisionCircles(Z,Dr,m.lineVertexArray,m.glyphOffsetArray,or,S,I,T,d,Ct,tt.predicate,Kt.collisionCircleDiameter,Jn,Xt),ir.circles.length&&ir.collisionDetected&&!d&&c.w("Collisions detected, but collision boxes are not shown"),Pe=ht||ir.circles.length>0&&!ir.collisionDetected,Xe=Xe&&ir.offscreen}if(Se.iconFeatureIndex&&(Sa=Se.iconFeatureIndex),Se.iconBox){const Dr=or=>{const Jn=At&&pr?Li(or,pr.x,pr.y,_t,Ct,this.transform.angle):or;return this.collisionIndex.placeCollisionBox(Jn,It,M,S,tt.predicate,Xt)};po&&po.box&&po.box.length&&Se.verticalIconBox?(Ur=Dr(Se.verticalIconBox),qe=Ur.box.length>0):(Ur=Dr(Se.iconBox),qe=Ur.box.length>0),Xe=Xe&&Ur.offscreen}const Ia=$||Kt.numHorizontalGlyphVertices===0&&Kt.numVerticalGlyphVertices===0,bs=it||Kt.numIconVertices===0;if(Ia||bs?bs?Ia||(qe=qe&&Pe):Pe=qe&&Pe:qe=Pe=qe&&Pe,Pe&&Vr&&Vr.box&&this.collisionIndex.insertCollisionBox(Vr.box,Z,_.get("text-ignore-placement"),m.bucketInstanceId,po&&po.box&&xs?xs:fo,tt.ID),qe&&Ur&&this.collisionIndex.insertCollisionBox(Ur.box,It,_.get("icon-ignore-placement"),m.bucketInstanceId,Sa,tt.ID),ir&&(Pe&&this.collisionIndex.insertCollisionCircles(ir.circles,Z,_.get("text-ignore-placement"),m.bucketInstanceId,fo,tt.ID),d)){const Dr=m.bucketInstanceId;let or=this.collisionCircleArrays[Dr];or===void 0&&(or=this.collisionCircleArrays[Dr]=new Ar);for(let Jn=0;Jn<ir.circles.length;Jn+=4)or.circles.push(ir.circles[Jn+0]),or.circles.push(ir.circles[Jn+1]),or.circles.push(ir.circles[Jn+2]),or.circles.push(ir.collisionDetected?1:0)}if(Kt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Kt.crossTileID]=new Yn(Pe||Vt,qe||Bt,Xe||m.justReloaded),h[Kt.crossTileID]=!0};if(kt){if(o.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Kt=m.getSortedSymbolIndexes(this.transform.angle);for(let Se=Kt.length-1;Se>=0;--Se){const Be=Kt[Se];Fe(m.symbolInstances.get(Be),m.collisionArrays[Be])}}else for(let Kt=o.symbolInstanceStart;Kt<o.symbolInstanceEnd;Kt++)Fe(m.symbolInstances.get(Kt),m.collisionArrays[Kt]);if(d&&m.bucketInstanceId in this.collisionCircleArrays){const Kt=this.collisionCircleArrays[m.bucketInstanceId];c.ar(Kt.invProjMatrix,S),Kt.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(o,h,d,m){let _;_=m===c.ah.vertical?d.verticalPlacedTextSymbolIndex:{left:d.leftJustifiedTextSymbolIndex,center:d.centerJustifiedTextSymbolIndex,right:d.rightJustifiedTextSymbolIndex}[c.as(h)];const S=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex,d.verticalPlacedTextSymbolIndex];for(const I of S)I>=0&&(o.text.placedSymbolArray.get(I).crossTileID=_>=0&&I!==_?0:d.crossTileID)}markUsedOrientation(o,h,d){const m=h===c.ah.horizontal||h===c.ah.horizontalOnly?h:0,_=h===c.ah.vertical?h:0,S=[d.leftJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.rightJustifiedTextSymbolIndex];for(const I of S)o.text.placedSymbolArray.get(I).placedOrientation=m;d.verticalPlacedTextSymbolIndex&&(o.text.placedSymbolArray.get(d.verticalPlacedTextSymbolIndex).placedOrientation=_)}commit(o){this.commitTime=o,this.zoomAtLastRecencyCheck=this.transform.zoom;const h=this.prevPlacement;let d=!1;this.prevZoomAdjustment=h?h.zoomAdjustment(this.transform.zoom):0;const m=h?h.symbolFadeChange(o):1,_=h?h.opacities:{},S=h?h.variableOffsets:{},I=h?h.placedOrientations:{};for(const T in this.placements){const M=this.placements[T],N=_[T];N?(this.opacities[T]=new Rn(N,m,M.text,M.icon),d=d||M.text!==N.text.placed||M.icon!==N.icon.placed):(this.opacities[T]=new Rn(null,m,M.text,M.icon,M.skipFade),d=d||M.text||M.icon)}for(const T in _){const M=_[T];if(!this.opacities[T]){const N=new Rn(M,m,!1,!1);N.isHidden()||(this.opacities[T]=N,d=d||M.text.placed||M.icon.placed)}}for(const T in S)this.variableOffsets[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.variableOffsets[T]=S[T]);for(const T in I)this.placedOrientations[T]||!this.opacities[T]||this.opacities[T].isHidden()||(this.placedOrientations[T]=I[T]);if(h&&h.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");d?this.lastPlacementChangeTime=o:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=h?h.lastPlacementChangeTime:o)}updateLayerOpacities(o,h){const d={};for(const m of h){const _=m.getBucket(o);_&&m.latestFeatureIndex&&o.id===_.layerIds[0]&&this.updateBucketOpacities(_,d,m.collisionBoxArray)}}updateBucketOpacities(o,h,d){o.hasTextData()&&(o.text.opacityVertexArray.clear(),o.text.hasVisibleVertices=!1),o.hasIconData()&&(o.icon.opacityVertexArray.clear(),o.icon.hasVisibleVertices=!1),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexArray.clear(),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexArray.clear();const m=o.layers[0],_=m.layout,S=new Rn(null,0,!1,!1,!0),I=_.get("text-allow-overlap"),T=_.get("icon-allow-overlap"),M=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),N=_.get("text-rotation-alignment")==="map",O=_.get("text-pitch-alignment")==="map",U=_.get("icon-text-fit")!=="none",tt=new Rn(null,0,I&&(T||!o.hasIconData()||_.get("icon-optional")),T&&(I||!o.hasTextData()||_.get("text-optional")),!0);!o.collisionArrays&&d&&(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData())&&o.deserializeCollisionBoxes(d);const $=(it,Z,ht)=>{for(let It=0;It<Z/4;It++)it.opacityVertexArray.emplaceBack(ht);it.hasVisibleVertices=it.hasVisibleVertices||ht!==yu};for(let it=0;it<o.symbolInstances.length;it++){const Z=o.symbolInstances.get(it),{numHorizontalGlyphVertices:ht,numVerticalGlyphVertices:It,crossTileID:st}=Z;let _t=this.opacities[st];h[st]?_t=S:_t||(_t=tt,this.opacities[st]=_t),h[st]=!0;const Ct=Z.numIconVertices>0,At=this.placedOrientations[Z.crossTileID],kt=At===c.ah.vertical,Vt=At===c.ah.horizontal||At===c.ah.horizontalOnly;if(ht>0||It>0){const Bt=Gi(_t.text);$(o.text,ht,kt?yu:Bt),$(o.text,It,Vt?yu:Bt);const Wt=_t.text.isHidden();[Z.rightJustifiedTextSymbolIndex,Z.centerJustifiedTextSymbolIndex,Z.leftJustifiedTextSymbolIndex].forEach(Kt=>{Kt>=0&&(o.text.placedSymbolArray.get(Kt).hidden=Wt||kt?1:0)}),Z.verticalPlacedTextSymbolIndex>=0&&(o.text.placedSymbolArray.get(Z.verticalPlacedTextSymbolIndex).hidden=Wt||Vt?1:0);const Xt=this.variableOffsets[Z.crossTileID];Xt&&this.markUsedJustification(o,Xt.anchor,Z,At);const Fe=this.placedOrientations[Z.crossTileID];Fe&&(this.markUsedJustification(o,"left",Z,Fe),this.markUsedOrientation(o,Fe,Z))}if(Ct){const Bt=Gi(_t.icon),Wt=!(U&&Z.verticalPlacedIconSymbolIndex&&kt);Z.placedIconSymbolIndex>=0&&($(o.icon,Z.numIconVertices,Wt?Bt:yu),o.icon.placedSymbolArray.get(Z.placedIconSymbolIndex).hidden=_t.icon.isHidden()),Z.verticalPlacedIconSymbolIndex>=0&&($(o.icon,Z.numVerticalIconVertices,Wt?yu:Bt),o.icon.placedSymbolArray.get(Z.verticalPlacedIconSymbolIndex).hidden=_t.icon.isHidden())}if(o.hasIconCollisionBoxData()||o.hasTextCollisionBoxData()){const Bt=o.collisionArrays[it];if(Bt){let Wt=new c.P(0,0);if(Bt.textBox||Bt.verticalTextBox){let Fe=!0;if(M){const Kt=this.variableOffsets[st];Kt?(Wt=Br(Kt.anchor,Kt.width,Kt.height,Kt.textOffset,Kt.textBoxScale),N&&Wt._rotate(O?this.transform.angle:-this.transform.angle)):Fe=!1}Bt.textBox&&$r(o.textCollisionBox.collisionVertexArray,_t.text.placed,!Fe||kt,Wt.x,Wt.y),Bt.verticalTextBox&&$r(o.textCollisionBox.collisionVertexArray,_t.text.placed,!Fe||Vt,Wt.x,Wt.y)}const Xt=!!(!Vt&&Bt.verticalIconBox);Bt.iconBox&&$r(o.iconCollisionBox.collisionVertexArray,_t.icon.placed,Xt,U?Wt.x:0,U?Wt.y:0),Bt.verticalIconBox&&$r(o.iconCollisionBox.collisionVertexArray,_t.icon.placed,!Xt,U?Wt.x:0,U?Wt.y:0)}}}if(o.sortFeatures(this.transform.angle),this.retainedQueryData[o.bucketInstanceId]&&(this.retainedQueryData[o.bucketInstanceId].featureSortOrder=o.featureSortOrder),o.hasTextData()&&o.text.opacityVertexBuffer&&o.text.opacityVertexBuffer.updateData(o.text.opacityVertexArray),o.hasIconData()&&o.icon.opacityVertexBuffer&&o.icon.opacityVertexBuffer.updateData(o.icon.opacityVertexArray),o.hasIconCollisionBoxData()&&o.iconCollisionBox.collisionVertexBuffer&&o.iconCollisionBox.collisionVertexBuffer.updateData(o.iconCollisionBox.collisionVertexArray),o.hasTextCollisionBoxData()&&o.textCollisionBox.collisionVertexBuffer&&o.textCollisionBox.collisionVertexBuffer.updateData(o.textCollisionBox.collisionVertexArray),o.text.opacityVertexArray.length!==o.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${o.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${o.text.layoutVertexArray.length}) / 4`);if(o.icon.opacityVertexArray.length!==o.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${o.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${o.icon.layoutVertexArray.length}) / 4`);if(o.bucketInstanceId in this.collisionCircleArrays){const it=this.collisionCircleArrays[o.bucketInstanceId];o.placementInvProjMatrix=it.invProjMatrix,o.placementViewportMatrix=it.viewportMatrix,o.collisionCircleArray=it.circles,delete this.collisionCircleArrays[o.bucketInstanceId]}}symbolFadeChange(o){return this.fadeDuration===0?1:(o-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(o){return Math.max(0,(this.transform.zoom-o)/1.5)}hasTransitions(o){return this.stale||o-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(o,h){const d=this.zoomAtLastRecencyCheck===h?1-this.zoomAdjustment(h):1;return this.zoomAtLastRecencyCheck=h,this.commitTime+this.fadeDuration*d>o}setStale(){this.stale=!0}}function $r(y,o,h,d,m){y.emplaceBack(o?1:0,h?1:0,d||0,m||0),y.emplaceBack(o?1:0,h?1:0,d||0,m||0),y.emplaceBack(o?1:0,h?1:0,d||0,m||0),y.emplaceBack(o?1:0,h?1:0,d||0,m||0)}const ms=Math.pow(2,25),ad=Math.pow(2,24),xg=Math.pow(2,17),Pn=Math.pow(2,16),ap=Math.pow(2,9),lp=Math.pow(2,8),uo=Math.pow(2,1);function Gi(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const o=y.placed?1:0,h=Math.floor(127*y.opacity);return h*ms+o*ad+h*xg+o*Pn+h*ap+o*lp+h*uo+o}const yu=0;class To{constructor(o){this._sortAcrossTiles=o.layout.get("symbol-z-order")!=="viewport-y"&&!o.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(o,h,d,m,_){const S=this._bucketParts;for(;this._currentTileIndex<o.length;)if(h.getBucketParts(S,m,o[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((I,T)=>I.sortKey-T.sortKey));this._currentPartIndex<S.length;)if(h.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,d),this._currentPartIndex++,_())return!0;return!1}}class Lo{constructor(o,h,d,m,_,S,I,T){this.placement=new Ui(o,h,S,I,T),this._currentPlacementIndex=d.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(o,h,d){const m=P.now(),_=()=>!this._forceFullPlacement&&P.now()-m>2;for(;this._currentPlacementIndex>=0;){const S=h[o[this._currentPlacementIndex]],I=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=I)&&(!S.maxzoom||S.maxzoom>I)){if(this._inProgressLayer||(this._inProgressLayer=new To(S)),this._inProgressLayer.continuePlacement(d[S.source],this.placement,this._showCollisionBoxes,S,_))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(o){return this.placement.commit(o),this.placement}}const Al=512/c.W/2;class gc{constructor(o,h,d){this.tileID=o,this.bucketInstanceId=d,this._symbolsByKey={};const m=new Map;for(let _=0;_<h.length;_++){const S=h.get(_),I=S.key,T=m.get(I);T?T.push(S):m.set(I,[S])}for(const[_,S]of m){const I={positions:S.map(T=>({x:Math.floor(T.anchorX*Al),y:Math.floor(T.anchorY*Al)})),crossTileIDs:S.map(T=>T.crossTileID)};if(I.positions.length>128){const T=new c.au(I.positions.length,16,Uint16Array);for(const{x:M,y:N}of I.positions)T.add(M,N);T.finish(),delete I.positions,I.index=T}this._symbolsByKey[_]=I}}getScaledCoordinates(o,h){const{x:d,y:m,z:_}=this.tileID.canonical,{x:S,y:I,z:T}=h.canonical,M=Al/Math.pow(2,T-_),N=(I*c.W+o.anchorY)*M,O=m*c.W*Al;return{x:Math.floor((S*c.W+o.anchorX)*M-d*c.W*Al),y:Math.floor(N-O)}}findMatches(o,h,d){const m=this.tileID.canonical.z<h.canonical.z?1:Math.pow(2,this.tileID.canonical.z-h.canonical.z);for(let _=0;_<o.length;_++){const S=o.get(_);if(S.crossTileID)continue;const I=this._symbolsByKey[S.key];if(!I)continue;const T=this.getScaledCoordinates(S,h);if(I.index){const M=I.index.range(T.x-m,T.y-m,T.x+m,T.y+m).sort();for(const N of M){const O=I.crossTileIDs[N];if(!d[O]){d[O]=!0,S.crossTileID=O;break}}}else if(I.positions)for(let M=0;M<I.positions.length;M++){const N=I.positions[M],O=I.crossTileIDs[M];if(Math.abs(N.x-T.x)<=m&&Math.abs(N.y-T.y)<=m&&!d[O]){d[O]=!0,S.crossTileID=O;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:o})=>o)}}class Mr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class _u{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(o){const h=Math.round((o-this.lng)/360);if(h!==0)for(const d in this.indexes){const m=this.indexes[d],_={};for(const S in m){const I=m[S];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+h),_[I.tileID.key]=I}this.indexes[d]=_}this.lng=o}addBucket(o,h,d){if(this.indexes[o.overscaledZ]&&this.indexes[o.overscaledZ][o.key]){if(this.indexes[o.overscaledZ][o.key].bucketInstanceId===h.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(o.overscaledZ,this.indexes[o.overscaledZ][o.key])}for(let _=0;_<h.symbolInstances.length;_++)h.symbolInstances.get(_).crossTileID=0;this.usedCrossTileIDs[o.overscaledZ]||(this.usedCrossTileIDs[o.overscaledZ]={});const m=this.usedCrossTileIDs[o.overscaledZ];for(const _ in this.indexes){const S=this.indexes[_];if(Number(_)>o.overscaledZ)for(const I in S){const T=S[I];T.tileID.isChildOf(o)&&T.findMatches(h.symbolInstances,o,m)}else{const I=S[o.scaledTo(Number(_)).key];I&&I.findMatches(h.symbolInstances,o,m)}}for(let _=0;_<h.symbolInstances.length;_++){const S=h.symbolInstances.get(_);S.crossTileID||(S.crossTileID=d.generate(),m[S.crossTileID]=!0)}return this.indexes[o.overscaledZ]===void 0&&(this.indexes[o.overscaledZ]={}),this.indexes[o.overscaledZ][o.key]=new gc(o,h.symbolInstances,h.bucketInstanceId),!0}removeBucketCrossTileIDs(o,h){for(const d of h.getCrossTileIDsLists())for(const m of d)delete this.usedCrossTileIDs[o][m]}removeStaleBuckets(o){let h=!1;for(const d in this.indexes){const m=this.indexes[d];for(const _ in m)o[m[_].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,m[_]),delete m[_],h=!0)}return h}}class ya{constructor(){this.layerIndexes={},this.crossTileIDs=new Mr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(o,h,d){let m=this.layerIndexes[o.id];m===void 0&&(m=this.layerIndexes[o.id]=new _u);let _=!1;const S={};m.handleWrapJump(d);for(const I of h){const T=I.getBucket(o);T&&o.id===T.layerIds[0]&&(T.bucketInstanceId||(T.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(I.tileID,T,this.crossTileIDs)&&(_=!0),S[T.bucketInstanceId]=!0)}return m.removeStaleBuckets(S)&&(_=!0),_}pruneUnusedLayers(o){const h={};o.forEach(d=>{h[d]=!0});for(const d in this.layerIndexes)h[d]||delete this.layerIndexes[d]}}const rr=(y,o)=>c.t(y,o&&o.filter(h=>h.identifier!=="source.canvas")),yc=c.av();class co extends c.E{constructor(o,h={}){super(),this._rtlPluginLoaded=()=>{for(const d in this.sourceCaches){const m=this.sourceCaches[d].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[d].reload()}},this.map=o,this.dispatcher=new Dn(mn(),o._getMapId()),this.dispatcher.registerMessageHandler("GG",(d,m)=>this.getGlyphs(d,m)),this.dispatcher.registerMessageHandler("GI",(d,m)=>this.getImages(d,m)),this.imageManager=new $t,this.imageManager.setEventedParent(this),this.glyphManager=new ue(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ze(256,512),this.crossTileSymbolIndex=new ya,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",c.ax()),Zt().on(ga,this._rtlPluginLoaded),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const m=this.sourceCaches[d.sourceId];if(!m)return;const _=m.getSource();if(_&&_.vectorLayerIds)for(const S in this._layers){const I=this._layers[S];I.source===_.id&&this._validateLayer(I)}})}loadURL(o,h={},d){this.fire(new c.k("dataloading",{dataType:"style"})),h.validate=typeof h.validate!="boolean"||h.validate;const m=this.map._requestManager.transformRequest(o,"Style");this._loadStyleRequest=new AbortController,c.h(m,this._loadStyleRequest).then(_=>{this._loadStyleRequest=null,this._load(_.data,h,d)}).catch(_=>{this._loadStyleRequest=null,_&&this.fire(new c.j(_))})}loadJSON(o,h={},d){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,P.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,h.validate=h.validate!==!1,this._load(o,h,d)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(yc,{validate:!1})}_load(o,h,d){var m;const _=h.transformStyle?h.transformStyle(d,o):o;if(!h.validate||!rr(this,c.x(_))){this._loaded=!0,this.stylesheet=_;for(const S in _.sources)this.addSource(S,_.sources[S],{validate:!1});_.sprite?this._loadSprite(_.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(_.glyphs),this._createLayers(),this.light=new nn(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const o=c.ay(this.stylesheet.layers);this.dispatcher.broadcast("SL",o),this._order=o.map(h=>h.id),this._layers={},this._serializedLayers=null;for(const h of o){const d=c.az(h);d.setEventedParent(this,{layer:{id:h.id}}),this._layers[h.id]=d}}_loadSprite(o,h=!1,d=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(_,S,I,T){return c._(this,void 0,void 0,function*(){const M=qt(_),N=I>1?"@2x":"",O={},U={};for(const{id:tt,url:$}of M){const it=S.transformRequest(S.normalizeSpriteURL($,N,".json"),"SpriteJSON");O[tt]=c.h(it,T);const Z=S.transformRequest(S.normalizeSpriteURL($,N,".png"),"SpriteImage");U[tt]=W.getImage(Z,T)}return yield Promise.all([...Object.values(O),...Object.values(U)]),function(tt,$){return c._(this,void 0,void 0,function*(){const it={};for(const Z in tt){it[Z]={};const ht=P.getImageCanvasContext((yield $[Z]).data),It=(yield tt[Z]).data;for(const st in It){const{width:_t,height:Ct,x:At,y:kt,sdf:Vt,pixelRatio:Bt,stretchX:Wt,stretchY:Xt,content:Fe}=It[st];it[Z][st]={data:null,pixelRatio:Bt,sdf:Vt,stretchX:Wt,stretchY:Xt,content:Fe,spriteData:{width:_t,height:Ct,x:At,y:kt,context:ht}}}}return it})}(O,U)})}(o,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(_=>{if(this._spriteRequest=null,_)for(const S in _){this._spritesImagesIds[S]=[];const I=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(T=>!(T in _)):[];for(const T of I)this.imageManager.removeImage(T),this._changedImages[T]=!0;for(const T in _[S]){const M=S==="default"?T:`${S}:${T}`;this._spritesImagesIds[S].push(M),M in this.imageManager.images?this.imageManager.updateImage(M,_[S][T],!1):this.imageManager.addImage(M,_[S][T]),h&&(this._changedImages[M]=!0)}}}).catch(_=>{this._spriteRequest=null,m=_,this.fire(new c.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),h&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),d&&d(m)})}_unloadSprite(){for(const o of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(o),this._changedImages[o]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(o){const h=this.sourceCaches[o.source];if(!h)return;const d=o.sourceLayer;if(!d)return;const m=h.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(d)===-1)&&this.fire(new c.j(new Error(`Source layer "${d}" does not exist on source "${m.id}" as specified by style layer "${o.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(o){const h=this._serializedAllLayers();if(!o||o.length===0)return Object.values(h);const d=[];for(const m of o)h[m]&&d.push(h[m]);return d}_serializedAllLayers(){let o=this._serializedLayers;if(o)return o;o=this._serializedLayers={};const h=Object.keys(this._layers);for(const d of h){const m=this._layers[d];m.type!=="custom"&&(o[d]=m.serialize())}return o}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(const o in this._layers)if(this._layers[o].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(o){if(!this._loaded)return;const h=this._changed;if(h){const m=Object.keys(this._updatedLayers),_=Object.keys(this._removedLayers);(m.length||_.length)&&this._updateWorkerLayers(m,_);for(const S in this._updatedSources){const I=this._updatedSources[S];if(I==="reload")this._reloadSource(S);else{if(I!=="clear")throw new Error(`Invalid action ${I}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}const d={};for(const m in this.sourceCaches){const _=this.sourceCaches[m];d[m]=_.used,_.used=!1}for(const m of this._order){const _=this._layers[m];_.recalculate(o,this._availableImages),!_.isHidden(o.zoom)&&_.source&&(this.sourceCaches[_.source].used=!0)}for(const m in d){const _=this.sourceCaches[m];!!d[m]!=!!_.used&&_.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const o=Object.keys(this._changedImages);if(o.length){for(const h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const o in this.sourceCaches)this.sourceCaches[o].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(o,h){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(o),removedIds:h})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(o,h={}){var d;this._checkLoaded();const m=this.serialize();if(o=h.transformStyle?h.transformStyle(m,o):o,((d=h.validate)===null||d===void 0||d)&&rr(this,c.x(o)))return!1;(o=c.aA(o)).layers=c.ay(o.layers);const _=c.aB(m,o),S=this._getOperationsToPerform(_);if(S.unimplemented.length>0)throw new Error(`Unimplemented: ${S.unimplemented.join(", ")}.`);if(S.operations.length===0)return!1;for(const I of S.operations)I();return this.stylesheet=o,this._serializedLayers=null,!0}_getOperationsToPerform(o){const h=[],d=[];for(const m of o)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":h.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":h.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":h.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":h.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":h.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":h.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":h.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":h.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":h.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":h.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":h.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":h.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":h.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":h.push(()=>{});break;default:d.push(m.command)}return{operations:h,unimplemented:d}}addImage(o,h){if(this.getImage(o))return this.fire(new c.j(new Error(`An image named "${o}" already exists.`)));this.imageManager.addImage(o,h),this._afterImageUpdated(o)}updateImage(o,h){this.imageManager.updateImage(o,h)}getImage(o){return this.imageManager.getImage(o)}removeImage(o){if(!this.getImage(o))return this.fire(new c.j(new Error(`An image named "${o}" does not exist.`)));this.imageManager.removeImage(o),this._afterImageUpdated(o)}_afterImageUpdated(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(o,h,d={}){if(this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error(`Source "${o}" already exists.`);if(!h.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(h).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(c.x.source,`sources.${o}`,h,null,d))return;this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);const m=this.sourceCaches[o]=new di(o,h,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:o})),m.onAdd(this.map),this._changed=!0}removeSource(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===o)return this.fire(new c.j(new Error(`Source "${o}" cannot be removed while layer "${d}" is using it.`)));const h=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],h.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),h.setEventedParent(null),h.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(o,h){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error(`There is no source with this ID=${o}`);const d=this.sourceCaches[o].getSource();if(d.type!=="geojson")throw new Error(`geojsonSource.type is ${d.type}, which is !== 'geojson`);d.setData(h),this._changed=!0}getSource(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()}addLayer(o,h,d={}){this._checkLoaded();const m=o.id;if(this.getLayer(m))return void this.fire(new c.j(new Error(`Layer "${m}" already exists on this map.`)));let _;if(o.type==="custom"){if(rr(this,c.aC(o)))return;_=c.az(o)}else{if("source"in o&&typeof o.source=="object"&&(this.addSource(m,o.source),o=c.aA(o),o=c.e(o,{source:m})),this._validate(c.x.layer,`layers.${m}`,o,{arrayIndex:-1},d))return;_=c.az(o),this._validateLayer(_),_.setEventedParent(this,{layer:{id:m}})}const S=h?this._order.indexOf(h):this._order.length;if(h&&S===-1)this.fire(new c.j(new Error(`Cannot add layer "${m}" before non-existing layer "${h}".`)));else{if(this._order.splice(S,0,m),this._layerOrderChanged=!0,this._layers[m]=_,this._removedLayers[m]&&_.source&&_.type!=="custom"){const I=this._removedLayers[m];delete this._removedLayers[m],I.type!==_.type?this._updatedSources[_.source]="clear":(this._updatedSources[_.source]="reload",this.sourceCaches[_.source].pause())}this._updateLayer(_),_.onAdd&&_.onAdd(this.map)}}moveLayer(o,h){if(this._checkLoaded(),this._changed=!0,!this._layers[o])return void this.fire(new c.j(new Error(`The layer '${o}' does not exist in the map's style and cannot be moved.`)));if(o===h)return;const d=this._order.indexOf(o);this._order.splice(d,1);const m=h?this._order.indexOf(h):this._order.length;h&&m===-1?this.fire(new c.j(new Error(`Cannot move layer "${o}" before non-existing layer "${h}".`))):(this._order.splice(m,0,o),this._layerOrderChanged=!0)}removeLayer(o){this._checkLoaded();const h=this._layers[o];if(!h)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${o}".`)));h.setEventedParent(null);const d=this._order.indexOf(o);this._order.splice(d,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],this._serializedLayers&&delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}getLayer(o){return this._layers[o]}getLayersOrder(){return[...this._order]}hasLayer(o){return o in this._layers}setLayerZoomRange(o,h,d){this._checkLoaded();const m=this.getLayer(o);m?m.minzoom===h&&m.maxzoom===d||(h!=null&&(m.minzoom=h),d!=null&&(m.maxzoom=d),this._updateLayer(m)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${o}".`)))}setFilter(o,h,d={}){this._checkLoaded();const m=this.getLayer(o);if(m){if(!c.aD(m.filter,h))return h==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(c.x.filter,`layers.${m.id}.filter`,h,null,d)||(m.filter=c.aA(h),this._updateLayer(m)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${o}".`)))}getFilter(o){return c.aA(this.getLayer(o).filter)}setLayoutProperty(o,h,d,m={}){this._checkLoaded();const _=this.getLayer(o);_?c.aD(_.getLayoutProperty(h),d)||(_.setLayoutProperty(h,d,m),this._updateLayer(_)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${o}".`)))}getLayoutProperty(o,h){const d=this.getLayer(o);if(d)return d.getLayoutProperty(h);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${o}".`)))}setPaintProperty(o,h,d,m={}){this._checkLoaded();const _=this.getLayer(o);_?c.aD(_.getPaintProperty(h),d)||(_.setPaintProperty(h,d,m)&&this._updateLayer(_),this._changed=!0,this._updatedPaintProps[o]=!0,this._serializedLayers=null):this.fire(new c.j(new Error(`Cannot style non-existing layer "${o}".`)))}getPaintProperty(o,h){return this.getLayer(o).getPaintProperty(h)}setFeatureState(o,h){this._checkLoaded();const d=o.source,m=o.sourceLayer,_=this.sourceCaches[d];if(_===void 0)return void this.fire(new c.j(new Error(`The source '${d}' does not exist in the map's style.`)));const S=_.getSource().type;S==="geojson"&&m?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||m?(o.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),_.setFeatureState(m,o.id,h)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(o,h){this._checkLoaded();const d=o.source,m=this.sourceCaches[d];if(m===void 0)return void this.fire(new c.j(new Error(`The source '${d}' does not exist in the map's style.`)));const _=m.getSource().type,S=_==="vector"?o.sourceLayer:void 0;_!=="vector"||S?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(S,o.id,h):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(o){this._checkLoaded();const h=o.source,d=o.sourceLayer,m=this.sourceCaches[h];if(m!==void 0)return m.getSource().type!=="vector"||d?(o.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(d,o.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${h}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const o=c.aE(this.sourceCaches,_=>_.serialize()),h=this._serializeByIds(this._order),d=this.map.getTerrain()||void 0,m=this.stylesheet;return c.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:o,layers:h,terrain:d},_=>_!==void 0)}_updateLayer(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(o){const h=S=>this._layers[S].type==="fill-extrusion",d={},m=[];for(let S=this._order.length-1;S>=0;S--){const I=this._order[S];if(h(I)){d[I]=S;for(const T of o){const M=T[I];if(M)for(const N of M)m.push(N)}}}m.sort((S,I)=>I.intersectionZ-S.intersectionZ);const _=[];for(let S=this._order.length-1;S>=0;S--){const I=this._order[S];if(h(I))for(let T=m.length-1;T>=0;T--){const M=m[T].feature;if(d[M.layer.id]<S)break;_.push(M),m.pop()}else for(const T of o){const M=T[I];if(M)for(const N of M)_.push(N.feature)}}return _}queryRenderedFeatures(o,h,d){h&&h.filter&&this._validate(c.x.filter,"queryRenderedFeatures.filter",h.filter,null,h);const m={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const I of h.layers){const T=this._layers[I];if(!T)return this.fire(new c.j(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];m[T.source]=!0}}const _=[];h.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const I in this.sourceCaches)h.layers&&!m[I]||_.push(yn(this.sourceCaches[I],this._layers,S,o,h,d));return this.placement&&_.push(function(I,T,M,N,O,U,tt){const $={},it=U.queryRenderedSymbols(N),Z=[];for(const ht of Object.keys(it).map(Number))Z.push(tt[ht]);Z.sort(Xn);for(const ht of Z){const It=ht.featureIndex.lookupSymbolFeatures(it[ht.bucketInstanceId],T,ht.bucketIndex,ht.sourceLayerIndex,O.filter,O.layers,O.availableImages,I);for(const st in It){const _t=$[st]=$[st]||[],Ct=It[st];Ct.sort((At,kt)=>{const Vt=ht.featureSortOrder;if(Vt){const Bt=Vt.indexOf(At.featureIndex);return Vt.indexOf(kt.featureIndex)-Bt}return kt.featureIndex-At.featureIndex});for(const At of Ct)_t.push(At)}}for(const ht in $)$[ht].forEach(It=>{const st=It.feature,_t=M[I[ht].source].getFeatureState(st.layer["source-layer"],st.id);st.source=st.layer.source,st.layer["source-layer"]&&(st.sourceLayer=st.layer["source-layer"]),st.state=_t});return $}(this._layers,S,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(_)}querySourceFeatures(o,h){h&&h.filter&&this._validate(c.x.filter,"querySourceFeatures.filter",h.filter,null,h);const d=this.sourceCaches[o];return d?function(m,_){const S=m.getRenderableIds().map(M=>m.getTileByID(M)),I=[],T={};for(let M=0;M<S.length;M++){const N=S[M],O=N.tileID.canonical.key;T[O]||(T[O]=!0,N.querySourceFeatures(I,_))}return I}(d,h):[]}getLight(){return this.light.getLight()}setLight(o,h={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const S in o)if(!c.aD(o[S],d[S])){m=!0;break}if(!m)return;const _={now:P.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(_)}_validate(o,h,d,m,_={}){return(!_||_.validate!==!1)&&rr(this,o.call(c.x,c.e({key:h,style:this.serialize(),value:d,styleSpec:c.v},m)))}_remove(o=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Zt().off(ga,this._rtlPluginLoaded);for(const h in this._layers)this._layers[h].setEventedParent(null);for(const h in this.sourceCaches){const d=this.sourceCaches[h];d.setEventedParent(null),d.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),o&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(o)}_clearSource(o){this.sourceCaches[o].clearTiles()}_reloadSource(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()}_updateSources(o){for(const h in this.sourceCaches)this.sourceCaches[h].update(o,this.map.terrain)}_generateCollisionBoxes(){for(const o in this.sourceCaches)this._reloadSource(o)}_updatePlacement(o,h,d,m,_=!1){let S=!1,I=!1;const T={};for(const M of this._order){const N=this._layers[M];if(N.type!=="symbol")continue;if(!T[N.source]){const U=this.sourceCaches[N.source];T[N.source]=U.getRenderableIds(!0).map(tt=>U.getTileByID(tt)).sort((tt,$)=>$.tileID.overscaledZ-tt.tileID.overscaledZ||(tt.tileID.isLessThan($.tileID)?-1:1))}const O=this.crossTileSymbolIndex.addLayer(N,T[N.source],o.center.lng);S=S||O}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((_=_||this._layerOrderChanged||d===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(P.now(),o.zoom))&&(this.pauseablePlacement=new Lo(o,this.map.terrain,this._order,_,h,d,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,T),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(P.now()),I=!0),S&&this.pauseablePlacement.placement.setStale()),I||S)for(const M of this._order){const N=this._layers[M];N.type==="symbol"&&this.placement.updateLayerOpacities(N,T[N.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(P.now())}_releaseSymbolFadeTiles(){for(const o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()}getImages(o,h){return c._(this,void 0,void 0,function*(){const d=yield this.imageManager.getImages(h.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,h.icons),d})}getGlyphs(o,h){return c._(this,void 0,void 0,function*(){const d=yield this.glyphManager.getGlyphs(h.stacks),m=this.sourceCaches[h.source];return m&&m.setDependencies(h.tileID.key,h.type,[""]),d})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(o,h={}){this._checkLoaded(),o&&this._validate(c.x.glyphs,"glyphs",o,null,h)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=o,this.glyphManager.entries={},this.glyphManager.setURL(o))}addSprite(o,h,d={},m){this._checkLoaded();const _=[{id:o,url:h}],S=[...qt(this.stylesheet.sprite),..._];this._validate(c.x.sprite,"sprite",S,null,d)||(this.stylesheet.sprite=S,this._loadSprite(_,!0,m))}removeSprite(o){this._checkLoaded();const h=qt(this.stylesheet.sprite);if(h.find(d=>d.id===o)){if(this._spritesImagesIds[o])for(const d of this._spritesImagesIds[o])this.imageManager.removeImage(d),this._changedImages[d]=!0;h.splice(h.findIndex(d=>d.id===o),1),this.stylesheet.sprite=h.length>0?h:void 0,delete this._spritesImagesIds[o],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${o}" doesn't exists on this map.`)))}getSprite(){return qt(this.stylesheet.sprite)}setSprite(o,h={},d){this._checkLoaded(),o&&this._validate(c.x.sprite,"sprite",o,null,h)||(this.stylesheet.sprite=o,o?this._loadSprite(o,!0,d):(this._unloadSprite(),d&&d(null)))}}var _c=c.X([{name:"a_pos",type:"Int16",components:2}]),gs="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const vu={prelude:An(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:An(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:An(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:An(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:An("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:An(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:An(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:An("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:An("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:An("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:An(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:An(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:An(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:An(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:An(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:An(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:An(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:An(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:An(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:An(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:An(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:An(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:An(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:An(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:An(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:An(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:An("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",gs),terrainDepth:An("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",gs),terrainCoords:An("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",gs)};function An(y,o){const h=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,d=o.match(/attribute ([\w]+) ([\w]+)/g),m=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),_=o.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=_?_.concat(m):m,I={};return{fragmentSource:y=y.replace(h,(T,M,N,O,U)=>(I[U]=!0,M==="define"?`
#ifndef HAS_UNIFORM_u_${U}
varying ${N} ${O} ${U};
#else
uniform ${N} ${O} u_${U};
#endif
`:`
#ifdef HAS_UNIFORM_u_${U}
    ${N} ${O} ${U} = u_${U};
#endif
`)),vertexSource:o=o.replace(h,(T,M,N,O,U)=>{const tt=O==="float"?"vec2":"vec4",$=U.match(/color/)?"color":tt;return I[U]?M==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${N} ${tt} a_${U};
varying ${N} ${O} ${U};
#else
uniform ${N} ${O} u_${U};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = a_${U};
#else
    ${N} ${O} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${U} = unpack_mix_${$}(a_${U}, u_${U}_t);
#else
    ${N} ${O} ${U} = u_${U};
#endif
`:M==="define"?`
#ifndef HAS_UNIFORM_u_${U}
uniform lowp float u_${U}_t;
attribute ${N} ${tt} a_${U};
#else
uniform ${N} ${O} u_${U};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${U}
    ${N} ${O} ${U} = a_${U};
#else
    ${N} ${O} ${U} = u_${U};
#endif
`:`
#ifndef HAS_UNIFORM_u_${U}
    ${N} ${O} ${U} = unpack_mix_${$}(a_${U}, u_${U}_t);
#else
    ${N} ${O} ${U} = u_${U};
#endif
`}),staticAttributes:d,staticUniforms:S}}class vc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(o,h,d,m,_,S,I,T,M){this.context=o;let N=this.boundPaintVertexBuffers.length!==m.length;for(let O=0;!N&&O<m.length;O++)this.boundPaintVertexBuffers[O]!==m[O]&&(N=!0);!this.vao||this.boundProgram!==h||this.boundLayoutVertexBuffer!==d||N||this.boundIndexBuffer!==_||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==I||this.boundDynamicVertexBuffer2!==T||this.boundDynamicVertexBuffer3!==M?this.freshBind(h,d,m,_,S,I,T,M):(o.bindVertexArray.set(this.vao),I&&I.bind(),_&&_.dynamicDraw&&_.bind(),T&&T.bind(),M&&M.bind())}freshBind(o,h,d,m,_,S,I,T){const M=o.numAttributes,N=this.context,O=N.gl;this.vao&&this.destroy(),this.vao=N.createVertexArray(),N.bindVertexArray.set(this.vao),this.boundProgram=o,this.boundLayoutVertexBuffer=h,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=m,this.boundVertexOffset=_,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=I,this.boundDynamicVertexBuffer3=T,h.enableAttributes(O,o);for(const U of d)U.enableAttributes(O,o);S&&S.enableAttributes(O,o),I&&I.enableAttributes(O,o),T&&T.enableAttributes(O,o),h.bind(),h.setVertexAttribPointers(O,o,_);for(const U of d)U.bind(),U.setVertexAttribPointers(O,o,_);S&&(S.bind(),S.setVertexAttribPointers(O,o,_)),m&&m.bind(),I&&(I.bind(),I.setVertexAttribPointers(O,o,_)),T&&(T.bind(),T.setVertexAttribPointers(O,o,_)),N.currentNumAttributes=M}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function Ml(y){const o=[];for(let h=0;h<y.length;h++){if(y[h]===null)continue;const d=y[h].split(" ");o.push(d.pop())}return o}class _a{constructor(o,h,d,m,_,S){const I=o.gl;this.program=I.createProgram();const T=Ml(h.staticAttributes),M=d?d.getBinderAttributes():[],N=T.concat(M),O=vu.prelude.staticUniforms?Ml(vu.prelude.staticUniforms):[],U=h.staticUniforms?Ml(h.staticUniforms):[],tt=d?d.getBinderUniforms():[],$=O.concat(U).concat(tt),it=[];for(const At of $)it.indexOf(At)<0&&it.push(At);const Z=d?d.defines():[];_&&Z.push("#define OVERDRAW_INSPECTOR;"),S&&Z.push("#define TERRAIN3D;");const ht=Z.concat(vu.prelude.fragmentSource,h.fragmentSource).join(`
`),It=Z.concat(vu.prelude.vertexSource,h.vertexSource).join(`
`),st=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(st,ht),I.compileShader(st),!I.getShaderParameter(st,I.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${I.getShaderInfoLog(st)}`);I.attachShader(this.program,st);const _t=I.createShader(I.VERTEX_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);if(I.shaderSource(_t,It),I.compileShader(_t),!I.getShaderParameter(_t,I.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${I.getShaderInfoLog(_t)}`);I.attachShader(this.program,_t),this.attributes={};const Ct={};this.numAttributes=N.length;for(let At=0;At<this.numAttributes;At++)N[At]&&(I.bindAttribLocation(this.program,At,N[At]),this.attributes[N[At]]=At);if(I.linkProgram(this.program),!I.getProgramParameter(this.program,I.LINK_STATUS))throw new Error(`Program failed to link: ${I.getProgramInfoLog(this.program)}`);I.deleteShader(_t),I.deleteShader(st);for(let At=0;At<it.length;At++){const kt=it[At];if(kt&&!Ct[kt]){const Vt=I.getUniformLocation(this.program,kt);Vt&&(Ct[kt]=Vt)}}this.fixedUniforms=m(o,Ct),this.terrainUniforms=((At,kt)=>({u_depth:new c.aG(At,kt.u_depth),u_terrain:new c.aG(At,kt.u_terrain),u_terrain_dim:new c.aH(At,kt.u_terrain_dim),u_terrain_matrix:new c.aI(At,kt.u_terrain_matrix),u_terrain_unpack:new c.aJ(At,kt.u_terrain_unpack),u_terrain_exaggeration:new c.aH(At,kt.u_terrain_exaggeration)}))(o,Ct),this.binderUniforms=d?d.getUniforms(o,Ct):[]}draw(o,h,d,m,_,S,I,T,M,N,O,U,tt,$,it,Z,ht,It){const st=o.gl;if(this.failedToCreate)return;if(o.program.set(this.program),o.setDepthMode(d),o.setStencilMode(m),o.setColorMode(_),o.setCullFace(S),T){o.activeTexture.set(st.TEXTURE2),st.bindTexture(st.TEXTURE_2D,T.depthTexture),o.activeTexture.set(st.TEXTURE3),st.bindTexture(st.TEXTURE_2D,T.texture);for(const Ct in this.terrainUniforms)this.terrainUniforms[Ct].set(T[Ct])}for(const Ct in this.fixedUniforms)this.fixedUniforms[Ct].set(I[Ct]);it&&it.setUniforms(o,this.binderUniforms,tt,{zoom:$});let _t=0;switch(h){case st.LINES:_t=2;break;case st.TRIANGLES:_t=3;break;case st.LINE_STRIP:_t=1}for(const Ct of U.get()){const At=Ct.vaos||(Ct.vaos={});(At[M]||(At[M]=new vc)).bind(o,this,N,it?it.getPaintVertexBuffers():[],O,Ct.vertexOffset,Z,ht,It),st.drawElements(h,Ct.primitiveLength*_t,st.UNSIGNED_SHORT,Ct.primitiveOffset*_t*2)}}}function xc(y,o,h){const d=1/Ae(h,1,o.transform.tileZoom),m=Math.pow(2,h.tileID.overscaledZ),_=h.tileSize*Math.pow(2,o.transform.tileZoom)/m,S=_*(h.tileID.canonical.x+h.tileID.wrap*m),I=_*h.tileID.canonical.y;return{u_image:0,u_texsize:h.imageAtlasTexture.size,u_scale:[d,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[S>>16,I>>16],u_pixel_coord_lower:[65535&S,65535&I]}}const xu=(y,o,h,d)=>{const m=o.style.light,_=m.properties.get("position"),S=[_.x,_.y,_.z],I=function(){var M=new c.A(9);return c.A!=Float32Array&&(M[1]=0,M[2]=0,M[3]=0,M[5]=0,M[6]=0,M[7]=0),M[0]=1,M[4]=1,M[8]=1,M}();m.properties.get("anchor")==="viewport"&&function(M,N){var O=Math.sin(N),U=Math.cos(N);M[0]=U,M[1]=O,M[2]=0,M[3]=-O,M[4]=U,M[5]=0,M[6]=0,M[7]=0,M[8]=1}(I,-o.transform.angle),function(M,N,O){var U=N[0],tt=N[1],$=N[2];M[0]=U*O[0]+tt*O[3]+$*O[6],M[1]=U*O[1]+tt*O[4]+$*O[7],M[2]=U*O[2]+tt*O[5]+$*O[8]}(S,S,I);const T=m.properties.get("color");return{u_matrix:y,u_lightpos:S,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[T.r,T.g,T.b],u_vertical_gradient:+h,u_opacity:d}},bg=(y,o,h,d,m,_,S)=>c.e(xu(y,o,h,d),xc(_,o,S),{u_height_factor:-Math.pow(2,m.overscaledZ)/S.tileSize/8}),ld=y=>({u_matrix:y}),bc=(y,o,h,d)=>c.e(ld(y),xc(h,o,d)),wg=(y,o)=>({u_matrix:y,u_world:o}),ud=(y,o,h,d,m)=>c.e(bc(y,o,h,d),{u_world:m}),Sg=(y,o,h,d)=>{const m=y.transform;let _,S;if(d.paint.get("circle-pitch-alignment")==="map"){const I=Ae(h,1,m.zoom);_=!0,S=[I,I]}else _=!1,S=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(d.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(o.posMatrix,h,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_pitch_with_map:+_,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:S}},cd=(y,o,h)=>{const d=Ae(h,1,o.zoom),m=Math.pow(2,o.zoom-h.tileID.overscaledZ),_=h.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:o.cameraToCenterDistance,u_pixels_to_tile_units:d,u_extrude_scale:[o.pixelsToGLUnits[0]/(d*m),o.pixelsToGLUnits[1]/(d*m)],u_overscale_factor:_}},hd=(y,o,h=1)=>({u_matrix:y,u_color:o,u_overlay:0,u_overlay_scale:h}),wc=y=>({u_matrix:y}),pd=(y,o,h,d)=>({u_matrix:y,u_extrude_scale:Ae(o,1,h),u_intensity:d});function fd(y,o){const h=Math.pow(2,o.canonical.z),d=o.canonical.y;return[new c.Y(0,d/h).toLngLat().lat,new c.Y(0,(d+1)/h).toLngLat().lat]}const Sc=(y,o,h,d)=>{const m=y.transform;return{u_matrix:bu(y,o,h,d),u_ratio:1/Ae(o,1,m.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},dd=(y,o,h,d,m)=>c.e(Sc(y,o,h,m),{u_image:0,u_image_height:d}),Xa=(y,o,h,d,m)=>{const _=y.transform,S=ho(o,_);return{u_matrix:bu(y,o,h,m),u_texsize:o.imageAtlasTexture.size,u_ratio:1/Ae(o,1,_.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[S,d.fromScale,d.toScale],u_fade:d.t,u_units_to_pixels:[1/_.pixelsToGLUnits[0],1/_.pixelsToGLUnits[1]]}},Ic=(y,o,h,d,m,_)=>{const S=y.lineAtlas,I=ho(o,y.transform),T=h.layout.get("line-cap")==="round",M=S.getDash(d.from,T),N=S.getDash(d.to,T),O=M.width*m.fromScale,U=N.width*m.toScale;return c.e(Sc(y,o,h,_),{u_patternscale_a:[I/O,-M.height/2],u_patternscale_b:[I/U,-N.height/2],u_sdfgamma:S.width/(256*Math.min(O,U)*y.pixelRatio)/2,u_image:0,u_tex_y_a:M.y,u_tex_y_b:N.y,u_mix:m.t})};function ho(y,o){return 1/Ae(y,1,o.tileZoom)}function bu(y,o,h,d){return y.translatePosMatrix(d?d.posMatrix:o.tileID.posMatrix,o,h.paint.get("line-translate"),h.paint.get("line-translate-anchor"))}const Ec=(y,o,h,d,m)=>{return{u_matrix:y,u_tl_parent:o,u_scale_parent:h,u_buffer_scale:1,u_fade_t:d.mix,u_opacity:d.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(S=m.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(_=m.paint.get("raster-contrast"),_>0?1/(1-_):1+_),u_spin_weights:wu(m.paint.get("raster-hue-rotate"))};var _,S};function wu(y){y*=Math.PI/180;const o=Math.sin(y),h=Math.cos(y);return[(2*h+1)/3,(-Math.sqrt(3)*o-h+1)/3,(Math.sqrt(3)*o-h+1)/3]}const Su=(y,o,h,d,m,_,S,I,T,M)=>{const N=m.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:o?o.uSizeT:0,u_size:o?o.uSize:0,u_camera_to_center_distance:N.cameraToCenterDistance,u_pitch:N.pitch/360*2*Math.PI,u_rotate_symbol:+h,u_aspect_ratio:N.width/N.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:_,u_label_plane_matrix:S,u_coord_matrix:I,u_is_text:+T,u_pitch_with_map:+d,u_texsize:M,u_texture:0}},Iu=(y,o,h,d,m,_,S,I,T,M,N)=>{const O=m.transform;return c.e(Su(y,o,h,d,m,_,S,I,T,M),{u_gamma_scale:d?Math.cos(O._pitch)*O.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+N})},Eu=(y,o,h,d,m,_,S,I,T,M)=>c.e(Iu(y,o,h,d,m,_,S,I,!0,T,!0),{u_texsize_icon:M,u_texture_icon:1}),Ig=(y,o,h)=>({u_matrix:y,u_opacity:o,u_color:h}),Eg=(y,o,h,d,m,_)=>c.e(function(S,I,T,M){const N=T.imageManager.getPattern(S.from.toString()),O=T.imageManager.getPattern(S.to.toString()),{width:U,height:tt}=T.imageManager.getPixelSize(),$=Math.pow(2,M.tileID.overscaledZ),it=M.tileSize*Math.pow(2,T.transform.tileZoom)/$,Z=it*(M.tileID.canonical.x+M.tileID.wrap*$),ht=it*M.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:N.tl,u_pattern_br_a:N.br,u_pattern_tl_b:O.tl,u_pattern_br_b:O.br,u_texsize:[U,tt],u_mix:I.t,u_pattern_size_a:N.displaySize,u_pattern_size_b:O.displaySize,u_scale_a:I.fromScale,u_scale_b:I.toScale,u_tile_units_to_pixels:1/Ae(M,1,T.transform.tileZoom),u_pixel_coord_upper:[Z>>16,ht>>16],u_pixel_coord_lower:[65535&Z,65535&ht]}}(d,_,h,m),{u_matrix:y,u_opacity:o}),md={fillExtrusion:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_lightpos:new c.aK(y,o.u_lightpos),u_lightintensity:new c.aH(y,o.u_lightintensity),u_lightcolor:new c.aK(y,o.u_lightcolor),u_vertical_gradient:new c.aH(y,o.u_vertical_gradient),u_opacity:new c.aH(y,o.u_opacity)}),fillExtrusionPattern:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_lightpos:new c.aK(y,o.u_lightpos),u_lightintensity:new c.aH(y,o.u_lightintensity),u_lightcolor:new c.aK(y,o.u_lightcolor),u_vertical_gradient:new c.aH(y,o.u_vertical_gradient),u_height_factor:new c.aH(y,o.u_height_factor),u_image:new c.aG(y,o.u_image),u_texsize:new c.aL(y,o.u_texsize),u_pixel_coord_upper:new c.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new c.aL(y,o.u_pixel_coord_lower),u_scale:new c.aK(y,o.u_scale),u_fade:new c.aH(y,o.u_fade),u_opacity:new c.aH(y,o.u_opacity)}),fill:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix)}),fillPattern:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_image:new c.aG(y,o.u_image),u_texsize:new c.aL(y,o.u_texsize),u_pixel_coord_upper:new c.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new c.aL(y,o.u_pixel_coord_lower),u_scale:new c.aK(y,o.u_scale),u_fade:new c.aH(y,o.u_fade)}),fillOutline:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_world:new c.aL(y,o.u_world)}),fillOutlinePattern:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_world:new c.aL(y,o.u_world),u_image:new c.aG(y,o.u_image),u_texsize:new c.aL(y,o.u_texsize),u_pixel_coord_upper:new c.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new c.aL(y,o.u_pixel_coord_lower),u_scale:new c.aK(y,o.u_scale),u_fade:new c.aH(y,o.u_fade)}),circle:(y,o)=>({u_camera_to_center_distance:new c.aH(y,o.u_camera_to_center_distance),u_scale_with_map:new c.aG(y,o.u_scale_with_map),u_pitch_with_map:new c.aG(y,o.u_pitch_with_map),u_extrude_scale:new c.aL(y,o.u_extrude_scale),u_device_pixel_ratio:new c.aH(y,o.u_device_pixel_ratio),u_matrix:new c.aI(y,o.u_matrix)}),collisionBox:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_camera_to_center_distance:new c.aH(y,o.u_camera_to_center_distance),u_pixels_to_tile_units:new c.aH(y,o.u_pixels_to_tile_units),u_extrude_scale:new c.aL(y,o.u_extrude_scale),u_overscale_factor:new c.aH(y,o.u_overscale_factor)}),collisionCircle:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_inv_matrix:new c.aI(y,o.u_inv_matrix),u_camera_to_center_distance:new c.aH(y,o.u_camera_to_center_distance),u_viewport_size:new c.aL(y,o.u_viewport_size)}),debug:(y,o)=>({u_color:new c.aM(y,o.u_color),u_matrix:new c.aI(y,o.u_matrix),u_overlay:new c.aG(y,o.u_overlay),u_overlay_scale:new c.aH(y,o.u_overlay_scale)}),clippingMask:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix)}),heatmap:(y,o)=>({u_extrude_scale:new c.aH(y,o.u_extrude_scale),u_intensity:new c.aH(y,o.u_intensity),u_matrix:new c.aI(y,o.u_matrix)}),heatmapTexture:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_world:new c.aL(y,o.u_world),u_image:new c.aG(y,o.u_image),u_color_ramp:new c.aG(y,o.u_color_ramp),u_opacity:new c.aH(y,o.u_opacity)}),hillshade:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_image:new c.aG(y,o.u_image),u_latrange:new c.aL(y,o.u_latrange),u_light:new c.aL(y,o.u_light),u_shadow:new c.aM(y,o.u_shadow),u_highlight:new c.aM(y,o.u_highlight),u_accent:new c.aM(y,o.u_accent)}),hillshadePrepare:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_image:new c.aG(y,o.u_image),u_dimension:new c.aL(y,o.u_dimension),u_zoom:new c.aH(y,o.u_zoom),u_unpack:new c.aJ(y,o.u_unpack)}),line:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_ratio:new c.aH(y,o.u_ratio),u_device_pixel_ratio:new c.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new c.aL(y,o.u_units_to_pixels)}),lineGradient:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_ratio:new c.aH(y,o.u_ratio),u_device_pixel_ratio:new c.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new c.aL(y,o.u_units_to_pixels),u_image:new c.aG(y,o.u_image),u_image_height:new c.aH(y,o.u_image_height)}),linePattern:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_texsize:new c.aL(y,o.u_texsize),u_ratio:new c.aH(y,o.u_ratio),u_device_pixel_ratio:new c.aH(y,o.u_device_pixel_ratio),u_image:new c.aG(y,o.u_image),u_units_to_pixels:new c.aL(y,o.u_units_to_pixels),u_scale:new c.aK(y,o.u_scale),u_fade:new c.aH(y,o.u_fade)}),lineSDF:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_ratio:new c.aH(y,o.u_ratio),u_device_pixel_ratio:new c.aH(y,o.u_device_pixel_ratio),u_units_to_pixels:new c.aL(y,o.u_units_to_pixels),u_patternscale_a:new c.aL(y,o.u_patternscale_a),u_patternscale_b:new c.aL(y,o.u_patternscale_b),u_sdfgamma:new c.aH(y,o.u_sdfgamma),u_image:new c.aG(y,o.u_image),u_tex_y_a:new c.aH(y,o.u_tex_y_a),u_tex_y_b:new c.aH(y,o.u_tex_y_b),u_mix:new c.aH(y,o.u_mix)}),raster:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_tl_parent:new c.aL(y,o.u_tl_parent),u_scale_parent:new c.aH(y,o.u_scale_parent),u_buffer_scale:new c.aH(y,o.u_buffer_scale),u_fade_t:new c.aH(y,o.u_fade_t),u_opacity:new c.aH(y,o.u_opacity),u_image0:new c.aG(y,o.u_image0),u_image1:new c.aG(y,o.u_image1),u_brightness_low:new c.aH(y,o.u_brightness_low),u_brightness_high:new c.aH(y,o.u_brightness_high),u_saturation_factor:new c.aH(y,o.u_saturation_factor),u_contrast_factor:new c.aH(y,o.u_contrast_factor),u_spin_weights:new c.aK(y,o.u_spin_weights)}),symbolIcon:(y,o)=>({u_is_size_zoom_constant:new c.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aG(y,o.u_is_size_feature_constant),u_size_t:new c.aH(y,o.u_size_t),u_size:new c.aH(y,o.u_size),u_camera_to_center_distance:new c.aH(y,o.u_camera_to_center_distance),u_pitch:new c.aH(y,o.u_pitch),u_rotate_symbol:new c.aG(y,o.u_rotate_symbol),u_aspect_ratio:new c.aH(y,o.u_aspect_ratio),u_fade_change:new c.aH(y,o.u_fade_change),u_matrix:new c.aI(y,o.u_matrix),u_label_plane_matrix:new c.aI(y,o.u_label_plane_matrix),u_coord_matrix:new c.aI(y,o.u_coord_matrix),u_is_text:new c.aG(y,o.u_is_text),u_pitch_with_map:new c.aG(y,o.u_pitch_with_map),u_texsize:new c.aL(y,o.u_texsize),u_texture:new c.aG(y,o.u_texture)}),symbolSDF:(y,o)=>({u_is_size_zoom_constant:new c.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aG(y,o.u_is_size_feature_constant),u_size_t:new c.aH(y,o.u_size_t),u_size:new c.aH(y,o.u_size),u_camera_to_center_distance:new c.aH(y,o.u_camera_to_center_distance),u_pitch:new c.aH(y,o.u_pitch),u_rotate_symbol:new c.aG(y,o.u_rotate_symbol),u_aspect_ratio:new c.aH(y,o.u_aspect_ratio),u_fade_change:new c.aH(y,o.u_fade_change),u_matrix:new c.aI(y,o.u_matrix),u_label_plane_matrix:new c.aI(y,o.u_label_plane_matrix),u_coord_matrix:new c.aI(y,o.u_coord_matrix),u_is_text:new c.aG(y,o.u_is_text),u_pitch_with_map:new c.aG(y,o.u_pitch_with_map),u_texsize:new c.aL(y,o.u_texsize),u_texture:new c.aG(y,o.u_texture),u_gamma_scale:new c.aH(y,o.u_gamma_scale),u_device_pixel_ratio:new c.aH(y,o.u_device_pixel_ratio),u_is_halo:new c.aG(y,o.u_is_halo)}),symbolTextAndIcon:(y,o)=>({u_is_size_zoom_constant:new c.aG(y,o.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aG(y,o.u_is_size_feature_constant),u_size_t:new c.aH(y,o.u_size_t),u_size:new c.aH(y,o.u_size),u_camera_to_center_distance:new c.aH(y,o.u_camera_to_center_distance),u_pitch:new c.aH(y,o.u_pitch),u_rotate_symbol:new c.aG(y,o.u_rotate_symbol),u_aspect_ratio:new c.aH(y,o.u_aspect_ratio),u_fade_change:new c.aH(y,o.u_fade_change),u_matrix:new c.aI(y,o.u_matrix),u_label_plane_matrix:new c.aI(y,o.u_label_plane_matrix),u_coord_matrix:new c.aI(y,o.u_coord_matrix),u_is_text:new c.aG(y,o.u_is_text),u_pitch_with_map:new c.aG(y,o.u_pitch_with_map),u_texsize:new c.aL(y,o.u_texsize),u_texsize_icon:new c.aL(y,o.u_texsize_icon),u_texture:new c.aG(y,o.u_texture),u_texture_icon:new c.aG(y,o.u_texture_icon),u_gamma_scale:new c.aH(y,o.u_gamma_scale),u_device_pixel_ratio:new c.aH(y,o.u_device_pixel_ratio),u_is_halo:new c.aG(y,o.u_is_halo)}),background:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_opacity:new c.aH(y,o.u_opacity),u_color:new c.aM(y,o.u_color)}),backgroundPattern:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_opacity:new c.aH(y,o.u_opacity),u_image:new c.aG(y,o.u_image),u_pattern_tl_a:new c.aL(y,o.u_pattern_tl_a),u_pattern_br_a:new c.aL(y,o.u_pattern_br_a),u_pattern_tl_b:new c.aL(y,o.u_pattern_tl_b),u_pattern_br_b:new c.aL(y,o.u_pattern_br_b),u_texsize:new c.aL(y,o.u_texsize),u_mix:new c.aH(y,o.u_mix),u_pattern_size_a:new c.aL(y,o.u_pattern_size_a),u_pattern_size_b:new c.aL(y,o.u_pattern_size_b),u_scale_a:new c.aH(y,o.u_scale_a),u_scale_b:new c.aH(y,o.u_scale_b),u_pixel_coord_upper:new c.aL(y,o.u_pixel_coord_upper),u_pixel_coord_lower:new c.aL(y,o.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aH(y,o.u_tile_units_to_pixels)}),terrain:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_texture:new c.aG(y,o.u_texture),u_ele_delta:new c.aH(y,o.u_ele_delta)}),terrainDepth:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_ele_delta:new c.aH(y,o.u_ele_delta)}),terrainCoords:(y,o)=>({u_matrix:new c.aI(y,o.u_matrix),u_texture:new c.aG(y,o.u_texture),u_terrain_coords_id:new c.aH(y,o.u_terrain_coords_id),u_ele_delta:new c.aH(y,o.u_ele_delta)})};class Cg{constructor(o,h,d){this.context=o;const m=o.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),o.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(o){const h=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),h.bufferSubData(h.ELEMENT_ARRAY_BUFFER,0,o.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ya={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Cc{constructor(o,h,d,m){this.length=h.length,this.attributes=d,this.itemSize=h.bytesPerElement,this.dynamicDraw=m,this.context=o;const _=o.gl;this.buffer=_.createBuffer(),o.bindVertexBuffer.set(this.buffer),_.bufferData(_.ARRAY_BUFFER,h.arrayBuffer,this.dynamicDraw?_.DYNAMIC_DRAW:_.STATIC_DRAW),this.dynamicDraw||delete h.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(o){if(o.length!==this.length)throw new Error(`Length of new data is ${o.length}, which doesn't match current length of ${this.length}`);const h=this.context.gl;this.bind(),h.bufferSubData(h.ARRAY_BUFFER,0,o.arrayBuffer)}enableAttributes(o,h){for(let d=0;d<this.attributes.length;d++){const m=h.attributes[this.attributes[d].name];m!==void 0&&o.enableVertexAttribArray(m)}}setVertexAttribPointers(o,h,d){for(let m=0;m<this.attributes.length;m++){const _=this.attributes[m],S=h.attributes[_.name];S!==void 0&&o.vertexAttribPointer(S,_.components,o[Ya[_.type]],!1,this.itemSize,_.offset+this.itemSize*(d||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Pi=new WeakMap;function mi(y){var o;if(Pi.has(y))return Pi.get(y);{const h=(o=y.getParameter(y.VERSION))===null||o===void 0?void 0:o.startsWith("WebGL 2.0");return Pi.set(y,h),h}}class Sn{constructor(o){this.gl=o.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(o){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Tc extends Sn{getDefault(){return c.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Lc extends Sn{getDefault(){return 1}set(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)}}class up extends Sn{getDefault(){return 0}set(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)}}class cp extends Sn{getDefault(){return[!0,!0,!0,!0]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class Pc extends Sn{getDefault(){return!0}set(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)}}class hp extends Sn{getDefault(){return 255}set(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)}}class pp extends Sn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(o){const h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)}}class Ac extends Sn{getDefault(){const o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)}}class gd extends Sn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}}class yd extends Sn{getDefault(){return[0,1]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)}}class Dl extends Sn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}}class Tg extends Sn{getDefault(){return this.gl.LESS}set(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)}}class Lg extends Sn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}}class Pg extends Sn{getDefault(){const o=this.gl;return[o.ONE,o.ZERO]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)}}class Ag extends Sn{getDefault(){return c.aO.transparent}set(o){const h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)}}class Mg extends Sn{getDefault(){return this.gl.FUNC_ADD}set(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)}}class Dg extends Sn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}}class fp extends Sn{getDefault(){return this.gl.BACK}set(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)}}class Mc extends Sn{getDefault(){return this.gl.CCW}set(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)}}class dp extends Sn{getDefault(){return null}set(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)}}class mp extends Sn{getDefault(){return this.gl.TEXTURE0}set(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)}}class kl extends Sn{getDefault(){const o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]}set(o){const h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)}}class _d extends Sn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}}class vd extends Sn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class gp extends Sn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}}class Ka extends Sn{getDefault(){return null}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class xd extends Sn{getDefault(){return null}set(o){const h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1}}class Rl extends Sn{getDefault(){return null}set(o){var h;if(o===this.current&&!this.dirty)return;const d=this.gl;mi(d)?d.bindVertexArray(o):(h=d.getExtension("OES_vertex_array_object"))===null||h===void 0||h.bindVertexArrayOES(o),this.current=o,this.dirty=!1}}class Nl extends Sn{getDefault(){return 4}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}}class bd extends Sn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}}class yp extends Sn{getDefault(){return!1}set(o){if(o===this.current&&!this.dirty)return;const h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}}class _n extends Sn{constructor(o,h){super(o),this.context=o,this.parent=h}getDefault(){return null}}class Dc extends _n{setDirty(){this.dirty=!0}set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}}class kg extends _n{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class wd extends _n{set(o){if(o===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_STENCIL_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}}class Cu{constructor(o,h,d,m,_){this.context=o,this.width=h,this.height=d;const S=o.gl,I=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new Dc(o,I),m)this.depthAttachment=_?new wd(o,I):new kg(o,I);else if(_)throw new Error("Stencil cannot be set without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const o=this.context.gl,h=this.colorAttachment.get();if(h&&o.deleteTexture(h),this.depthAttachment){const d=this.depthAttachment.get();d&&o.deleteRenderbuffer(d)}o.deleteFramebuffer(this.framebuffer)}}class Sr{constructor(o,h,d){this.blendFunction=o,this.blendColor=h,this.mask=d}}Sr.Replace=[1,0],Sr.disabled=new Sr(Sr.Replace,c.aO.transparent,[!1,!1,!1,!1]),Sr.unblended=new Sr(Sr.Replace,c.aO.transparent,[!0,!0,!0,!0]),Sr.alphaBlended=new Sr([1,771],c.aO.transparent,[!0,!0,!0,!0]);class Rg{constructor(o){var h,d;if(this.gl=o,this.clearColor=new Tc(this),this.clearDepth=new Lc(this),this.clearStencil=new up(this),this.colorMask=new cp(this),this.depthMask=new Pc(this),this.stencilMask=new hp(this),this.stencilFunc=new pp(this),this.stencilOp=new Ac(this),this.stencilTest=new gd(this),this.depthRange=new yd(this),this.depthTest=new Dl(this),this.depthFunc=new Tg(this),this.blend=new Lg(this),this.blendFunc=new Pg(this),this.blendColor=new Ag(this),this.blendEquation=new Mg(this),this.cullFace=new Dg(this),this.cullFaceSide=new fp(this),this.frontFace=new Mc(this),this.program=new dp(this),this.activeTexture=new mp(this),this.viewport=new kl(this),this.bindFramebuffer=new _d(this),this.bindRenderbuffer=new vd(this),this.bindTexture=new gp(this),this.bindVertexBuffer=new Ka(this),this.bindElementBuffer=new xd(this),this.bindVertexArray=new Rl(this),this.pixelStoreUnpack=new Nl(this),this.pixelStoreUnpackPremultiplyAlpha=new bd(this),this.pixelStoreUnpackFlipY=new yp(this),this.extTextureFilterAnisotropic=o.getExtension("EXT_texture_filter_anisotropic")||o.getExtension("MOZ_EXT_texture_filter_anisotropic")||o.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=o.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=o.getParameter(o.MAX_TEXTURE_SIZE),mi(o)){this.HALF_FLOAT=o.HALF_FLOAT;const m=o.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(h=o.RGBA16F)!==null&&h!==void 0?h:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(d=o.RGB16F)!==null&&d!==void 0?d:m==null?void 0:m.RGB16F_EXT,o.getExtension("EXT_color_buffer_float")}else{o.getExtension("EXT_color_buffer_half_float"),o.getExtension("OES_texture_half_float_linear");const m=o.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(o,h){return new Cg(this,o,h)}createVertexBuffer(o,h,d){return new Cc(this,o,h,d)}createRenderbuffer(o,h,d){const m=this.gl,_=m.createRenderbuffer();return this.bindRenderbuffer.set(_),m.renderbufferStorage(m.RENDERBUFFER,o,h,d),this.bindRenderbuffer.set(null),_}createFramebuffer(o,h,d,m){return new Cu(this,o,h,d,m)}clear({color:o,depth:h,stencil:d}){const m=this.gl;let _=0;o&&(_|=m.COLOR_BUFFER_BIT,this.clearColor.set(o),this.colorMask.set([!0,!0,!0,!0])),h!==void 0&&(_|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(h),this.depthMask.set(!0)),d!==void 0&&(_|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),m.clear(_)}setCullFace(o){o.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(o.mode),this.frontFace.set(o.frontFace))}setDepthMode(o){o.func!==this.gl.ALWAYS||o.mask?(this.depthTest.set(!0),this.depthFunc.set(o.func),this.depthMask.set(o.mask),this.depthRange.set(o.range)):this.depthTest.set(!1)}setStencilMode(o){o.test.func!==this.gl.ALWAYS||o.mask?(this.stencilTest.set(!0),this.stencilMask.set(o.mask),this.stencilOp.set([o.fail,o.depthFail,o.pass]),this.stencilFunc.set({func:o.test.func,ref:o.ref,mask:o.test.mask})):this.stencilTest.set(!1)}setColorMode(o){c.aD(o.blendFunction,Sr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(o.blendFunction),this.blendColor.set(o.blendColor)),this.colorMask.set(o.mask)}createVertexArray(){var o;return mi(this.gl)?this.gl.createVertexArray():(o=this.gl.getExtension("OES_vertex_array_object"))===null||o===void 0?void 0:o.createVertexArrayOES()}deleteVertexArray(o){var h;return mi(this.gl)?this.gl.deleteVertexArray(o):(h=this.gl.getExtension("OES_vertex_array_object"))===null||h===void 0?void 0:h.deleteVertexArrayOES(o)}unbindVAO(){this.bindVertexArray.set(null)}}class cn{constructor(o,h,d){this.func=o,this.mask=h,this.range=d}}cn.ReadOnly=!1,cn.ReadWrite=!0,cn.disabled=new cn(519,cn.ReadOnly,[0,1]);const _p=7680;class jn{constructor(o,h,d,m,_,S){this.test=o,this.ref=h,this.mask=d,this.fail=m,this.depthFail=_,this.pass=S}}jn.disabled=new jn({func:519,mask:0},0,0,_p,_p,_p);class Bn{constructor(o,h,d){this.enable=o,this.mode=h,this.frontFace=d}}let Ja;function kc(y,o,h,d,m,_,S){const I=y.context,T=I.gl,M=y.useProgram("collisionBox"),N=[];let O=0,U=0;for(let st=0;st<d.length;st++){const _t=d[st],Ct=o.getTile(_t),At=Ct.getBucket(h);if(!At)continue;let kt=_t.posMatrix;m[0]===0&&m[1]===0||(kt=y.translatePosMatrix(_t.posMatrix,Ct,m,_));const Vt=S?At.textCollisionBox:At.iconCollisionBox,Bt=At.collisionCircleArray;if(Bt.length>0){const Wt=c.F(),Xt=kt;c.aP(Wt,At.placementInvProjMatrix,y.transform.glCoordMatrix),c.aP(Wt,Wt,At.placementViewportMatrix),N.push({circleArray:Bt,circleOffset:U,transform:Xt,invTransform:Wt,coord:_t}),O+=Bt.length/4,U=O}Vt&&M.draw(I,T.LINES,cn.disabled,jn.disabled,y.colorModeForRenderPass(),Bn.disabled,cd(kt,y.transform,Ct),y.style.map.terrain&&y.style.map.terrain.getTerrainData(_t),h.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,null,y.transform.zoom,null,null,Vt.collisionVertexBuffer)}if(!S||!N.length)return;const tt=y.useProgram("collisionCircle"),$=new c.aQ;$.resize(4*O),$._trim();let it=0;for(const st of N)for(let _t=0;_t<st.circleArray.length/4;_t++){const Ct=4*_t,At=st.circleArray[Ct+0],kt=st.circleArray[Ct+1],Vt=st.circleArray[Ct+2],Bt=st.circleArray[Ct+3];$.emplace(it++,At,kt,Vt,Bt,0),$.emplace(it++,At,kt,Vt,Bt,1),$.emplace(it++,At,kt,Vt,Bt,2),$.emplace(it++,At,kt,Vt,Bt,3)}(!Ja||Ja.length<2*O)&&(Ja=function(st){const _t=2*st,Ct=new c.aS;Ct.resize(_t),Ct._trim();for(let At=0;At<_t;At++){const kt=6*At;Ct.uint16[kt+0]=4*At+0,Ct.uint16[kt+1]=4*At+1,Ct.uint16[kt+2]=4*At+2,Ct.uint16[kt+3]=4*At+2,Ct.uint16[kt+4]=4*At+3,Ct.uint16[kt+5]=4*At+0}return Ct}(O));const Z=I.createIndexBuffer(Ja,!0),ht=I.createVertexBuffer($,c.aR.members,!0);for(const st of N){const _t={u_matrix:st.transform,u_inv_matrix:st.invTransform,u_camera_to_center_distance:(It=y.transform).cameraToCenterDistance,u_viewport_size:[It.width,It.height]};tt.draw(I,T.TRIANGLES,cn.disabled,jn.disabled,y.colorModeForRenderPass(),Bn.disabled,_t,y.style.map.terrain&&y.style.map.terrain.getTerrainData(st.coord),h.id,ht,Z,c.$.simpleSegment(0,2*st.circleOffset,st.circleArray.length,st.circleArray.length/2),null,y.transform.zoom,null,null,null)}var It;ht.destroy(),Z.destroy()}Bn.disabled=new Bn(!1,1029,2305),Bn.backCCW=new Bn(!0,1029,2305);const vp=c.an(new Float32Array(16));function Sd(y,o,h,d,m,_){const{horizontalAlign:S,verticalAlign:I}=c.at(y);return new c.P((-(S-.5)*o/m+d[0])*_,(-(I-.5)*h/m+d[1])*_)}function Rc(y,o,h,d,m,_,S,I,T,M,N){const O=y.text.placedSymbolArray,U=y.text.dynamicLayoutVertexArray,tt=y.icon.dynamicLayoutVertexArray,$={};U.clear();for(let it=0;it<O.length;it++){const Z=O.get(it),ht=Z.hidden||!Z.crossTileID||y.allowVerticalPlacement&&!Z.placedOrientation?null:d[Z.crossTileID];if(ht){const It=new c.P(Z.anchorX,Z.anchorY),st=Fr(It,h?S:_,N),_t=rt(m.cameraToCenterDistance,st.signedDistanceFromCamera);let Ct=c.ai(y.textSizeData,T,Z)*_t/c.ao;h&&(Ct*=y.tilePixelRatio/I);const{width:At,height:kt,anchor:Vt,textOffset:Bt,textBoxScale:Wt}=ht,Xt=Sd(Vt,At,kt,Bt,Wt,Ct),Fe=h?Fr(It.add(Xt),_,N).point:st.point.add(o?Xt.rotate(-m.angle):Xt),Kt=y.allowVerticalPlacement&&Z.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let Se=0;Se<Z.numGlyphs;Se++)c.aj(U,Fe,Kt);M&&Z.associatedIconIndex>=0&&($[Z.associatedIconIndex]={shiftedAnchor:Fe,angle:Kt})}else Ot(Z.numGlyphs,U)}if(M){tt.clear();const it=y.icon.placedSymbolArray;for(let Z=0;Z<it.length;Z++){const ht=it.get(Z);if(ht.hidden)Ot(ht.numGlyphs,tt);else{const It=$[Z];if(It)for(let st=0;st<ht.numGlyphs;st++)c.aj(tt,It.shiftedAnchor,It.angle);else Ot(ht.numGlyphs,tt)}}y.icon.dynamicLayoutVertexBuffer.updateData(tt)}y.text.dynamicLayoutVertexBuffer.updateData(U)}function Nc(y,o,h){return h.iconsInText&&o?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function Oc(y,o,h,d,m,_,S,I,T,M,N,O){const U=y.context,tt=U.gl,$=y.transform,it=I==="map",Z=T==="map",ht=I!=="viewport"&&h.layout.get("symbol-placement")!=="point",It=it&&!Z&&!ht,st=!h.layout.get("symbol-sort-key").isConstant();let _t=!1;const Ct=y.depthModeForSublayer(0,cn.ReadOnly),At=h._unevaluatedLayout.hasValue("text-variable-anchor")||h._unevaluatedLayout.hasValue("text-variable-anchor-offset"),kt=[];for(const Vt of d){const Bt=o.getTile(Vt),Wt=Bt.getBucket(h);if(!Wt)continue;const Xt=m?Wt.text:Wt.icon;if(!Xt||!Xt.segments.get().length||!Xt.hasVisibleVertices)continue;const Fe=Xt.programConfigurations.get(h.id),Kt=m||Wt.sdfIcons,Se=m?Wt.textSizeData:Wt.iconSizeData,Be=Z||$.pitch!==0,hn=y.useProgram(Nc(Kt,m,Wt),Fe),Pe=c.ag(Se,$.zoom),qe=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Vt);let Xe,pr,Mn,po,Vr=[0,0],ir=null;if(m)pr=Bt.glyphAtlasTexture,Mn=tt.LINEAR,Xe=Bt.glyphAtlasTexture.size,Wt.iconsInText&&(Vr=Bt.imageAtlasTexture.size,ir=Bt.imageAtlasTexture,po=Be||y.options.rotating||y.options.zooming||Se.kind==="composite"||Se.kind==="camera"?tt.LINEAR:tt.NEAREST);else{const kr=h.layout.get("icon-size").constantOr(0)!==1||Wt.iconsNeedLinear;pr=Bt.imageAtlasTexture,Mn=Kt||y.options.rotating||y.options.zooming||kr||Be?tt.LINEAR:tt.NEAREST,Xe=Bt.imageAtlasTexture.size}const Ur=Ae(Bt,1,y.transform.zoom),fo=Oe(Vt.posMatrix,Z,it,y.transform,Ur),xs=Ha(Vt.posMatrix,Z,it,y.transform,Ur),Sa=At&&Wt.hasTextData(),Bu=h.layout.get("icon-text-fit")!=="none"&&Sa&&Wt.hasIconData();if(ht){const kr=y.style.map.terrain?(Ao,Rr)=>y.style.map.terrain.getElevation(Vt,Ao,Rr):null,sr=h.layout.get("text-rotation-alignment")==="map";B(Wt,Vt.posMatrix,y,m,fo,xs,Z,M,sr,kr)}const Ia=y.translatePosMatrix(Vt.posMatrix,Bt,_,S),bs=ht||m&&At||Bu?vp:fo,Dr=y.translatePosMatrix(xs,Bt,_,S,!0),or=Kt&&h.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Jn;Jn=Kt?Wt.iconsInText?Eu(Se.kind,Pe,It,Z,y,Ia,bs,Dr,Xe,Vr):Iu(Se.kind,Pe,It,Z,y,Ia,bs,Dr,m,Xe,!0):Su(Se.kind,Pe,It,Z,y,Ia,bs,Dr,m,Xe);const Po={program:hn,buffers:Xt,uniformValues:Jn,atlasTexture:pr,atlasTextureIcon:ir,atlasInterpolation:Mn,atlasInterpolationIcon:po,isSDF:Kt,hasHalo:or};if(st&&Wt.canOverlap){_t=!0;const kr=Xt.segments.get();for(const sr of kr)kt.push({segments:new c.$([sr]),sortKey:sr.sortKey,state:Po,terrainData:qe})}else kt.push({segments:Xt.segments,sortKey:0,state:Po,terrainData:qe})}_t&&kt.sort((Vt,Bt)=>Vt.sortKey-Bt.sortKey);for(const Vt of kt){const Bt=Vt.state;if(U.activeTexture.set(tt.TEXTURE0),Bt.atlasTexture.bind(Bt.atlasInterpolation,tt.CLAMP_TO_EDGE),Bt.atlasTextureIcon&&(U.activeTexture.set(tt.TEXTURE1),Bt.atlasTextureIcon&&Bt.atlasTextureIcon.bind(Bt.atlasInterpolationIcon,tt.CLAMP_TO_EDGE)),Bt.isSDF){const Wt=Bt.uniformValues;Bt.hasHalo&&(Wt.u_is_halo=1,Id(Bt.buffers,Vt.segments,h,y,Bt.program,Ct,N,O,Wt,Vt.terrainData)),Wt.u_is_halo=0}Id(Bt.buffers,Vt.segments,h,y,Bt.program,Ct,N,O,Bt.uniformValues,Vt.terrainData)}}function Id(y,o,h,d,m,_,S,I,T,M){const N=d.context;m.draw(N,N.gl.TRIANGLES,_,S,I,Bn.disabled,T,M,h.id,y.layoutVertexBuffer,y.indexBuffer,o,h.paint,d.transform.zoom,y.programConfigurations.get(h.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function zc(y,o,h,d,m){if(!h||!d||!d.imageAtlas)return;const _=d.imageAtlas.patternPositions;let S=_[h.to.toString()],I=_[h.from.toString()];if(!S&&I&&(S=I),!I&&S&&(I=S),!S||!I){const T=m.getPaintProperty(o);S=_[T],I=_[T]}S&&I&&y.setConstantPatternPositions(S,I)}function Ed(y,o,h,d,m,_,S){const I=y.context.gl,T="fill-pattern",M=h.paint.get(T),N=M&&M.constantOr(1),O=h.getCrossfadeParameters();let U,tt,$,it,Z;S?(tt=N&&!h.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",U=I.LINES):(tt=N?"fillPattern":"fill",U=I.TRIANGLES);const ht=M.constantOr(null);for(const It of d){const st=o.getTile(It);if(N&&!st.patternsLoaded())continue;const _t=st.getBucket(h);if(!_t)continue;const Ct=_t.programConfigurations.get(h.id),At=y.useProgram(tt,Ct),kt=y.style.map.terrain&&y.style.map.terrain.getTerrainData(It);N&&(y.context.activeTexture.set(I.TEXTURE0),st.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Ct.updatePaintBuffers(O)),zc(Ct,T,ht,st,h);const Vt=kt?It:null,Bt=y.translatePosMatrix(Vt?Vt.posMatrix:It.posMatrix,st,h.paint.get("fill-translate"),h.paint.get("fill-translate-anchor"));if(S){it=_t.indexBuffer2,Z=_t.segments2;const Wt=[I.drawingBufferWidth,I.drawingBufferHeight];$=tt==="fillOutlinePattern"&&N?ud(Bt,y,O,st,Wt):wg(Bt,Wt)}else it=_t.indexBuffer,Z=_t.segments,$=N?bc(Bt,y,O,st):ld(Bt);At.draw(y.context,U,m,y.stencilModeForClipping(It),_,Bn.disabled,$,kt,h.id,_t.layoutVertexBuffer,it,Z,h.paint,y.transform.zoom,Ct)}}function Fc(y,o,h,d,m,_,S){const I=y.context,T=I.gl,M="fill-extrusion-pattern",N=h.paint.get(M),O=N.constantOr(1),U=h.getCrossfadeParameters(),tt=h.paint.get("fill-extrusion-opacity"),$=N.constantOr(null);for(const it of d){const Z=o.getTile(it),ht=Z.getBucket(h);if(!ht)continue;const It=y.style.map.terrain&&y.style.map.terrain.getTerrainData(it),st=ht.programConfigurations.get(h.id),_t=y.useProgram(O?"fillExtrusionPattern":"fillExtrusion",st);O&&(y.context.activeTexture.set(T.TEXTURE0),Z.imageAtlasTexture.bind(T.LINEAR,T.CLAMP_TO_EDGE),st.updatePaintBuffers(U)),zc(st,M,$,Z,h);const Ct=y.translatePosMatrix(it.posMatrix,Z,h.paint.get("fill-extrusion-translate"),h.paint.get("fill-extrusion-translate-anchor")),At=h.paint.get("fill-extrusion-vertical-gradient"),kt=O?bg(Ct,y,At,tt,it,U,Z):xu(Ct,y,At,tt);_t.draw(I,I.gl.TRIANGLES,m,_,S,Bn.backCCW,kt,It,h.id,ht.layoutVertexBuffer,ht.indexBuffer,ht.segments,h.paint,y.transform.zoom,st,y.style.map.terrain&&ht.centroidVertexBuffer)}}function Bc(y,o,h,d,m,_,S){const I=y.context,T=I.gl,M=h.fbo;if(!M)return;const N=y.useProgram("hillshade"),O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(o);I.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,M.colorAttachment.get()),N.draw(I,T.TRIANGLES,m,_,S,Bn.disabled,((U,tt,$,it)=>{const Z=$.paint.get("hillshade-shadow-color"),ht=$.paint.get("hillshade-highlight-color"),It=$.paint.get("hillshade-accent-color");let st=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(st-=U.transform.angle);const _t=!U.options.moving;return{u_matrix:it?it.posMatrix:U.transform.calculatePosMatrix(tt.tileID.toUnwrapped(),_t),u_image:0,u_latrange:fd(0,tt.tileID),u_light:[$.paint.get("hillshade-exaggeration"),st],u_shadow:Z,u_highlight:ht,u_accent:It}})(y,h,d,O?o:null),O,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function xp(y,o,h,d,m,_){const S=y.context,I=S.gl,T=o.dem;if(T&&T.data){const M=T.dim,N=T.stride,O=T.getPixels();if(S.activeTexture.set(I.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),o.demTexture=o.demTexture||y.getTileTexture(N),o.demTexture){const tt=o.demTexture;tt.update(O,{premultiply:!1}),tt.bind(I.NEAREST,I.CLAMP_TO_EDGE)}else o.demTexture=new Q(S,O,I.RGBA,{premultiply:!1}),o.demTexture.bind(I.NEAREST,I.CLAMP_TO_EDGE);S.activeTexture.set(I.TEXTURE0);let U=o.fbo;if(!U){const tt=new Q(S,{width:M,height:M,data:null},I.RGBA);tt.bind(I.LINEAR,I.CLAMP_TO_EDGE),U=o.fbo=S.createFramebuffer(M,M,!0,!1),U.colorAttachment.set(tt.texture)}S.bindFramebuffer.set(U.framebuffer),S.viewport.set([0,0,M,M]),y.useProgram("hillshadePrepare").draw(S,I.TRIANGLES,d,m,_,Bn.disabled,((tt,$)=>{const it=$.stride,Z=c.F();return c.aN(Z,0,c.W,-c.W,0,0,1),c.H(Z,Z,[0,-c.W,0]),{u_matrix:Z,u_image:1,u_dimension:[it,it],u_zoom:tt.overscaledZ,u_unpack:$.getUnpackVector()}})(o.tileID,T),null,h.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),o.needsHillshadePrepare=!1}}function Cd(y,o,h,d,m,_){const S=d.paint.get("raster-fade-duration");if(!_&&S>0){const I=P.now(),T=(I-y.timeAdded)/S,M=o?(I-o.timeAdded)/S:-1,N=h.getSource(),O=m.coveringZoomLevel({tileSize:N.tileSize,roundZoom:N.roundZoom}),U=!o||Math.abs(o.tileID.overscaledZ-O)>Math.abs(y.tileID.overscaledZ-O),tt=U&&y.refreshedUponExpiration?1:c.ac(U?T:1-M,0,1);return y.refreshedUponExpiration&&T>=1&&(y.refreshedUponExpiration=!1),o?{opacity:1,mix:1-tt}:{opacity:tt,mix:0}}return{opacity:1,mix:0}}const Td=new c.aO(1,0,0,1),Vc=new c.aO(0,1,0,1),bp=new c.aO(0,0,1,1),Ng=new c.aO(1,0,1,1),Ld=new c.aO(0,1,1,1);function cr(y,o,h,d){Ai(y,0,o+h/2,y.transform.width,h,d)}function va(y,o,h,d){Ai(y,o-h/2,0,h,y.transform.height,d)}function Ai(y,o,h,d,m,_){const S=y.context,I=S.gl;I.enable(I.SCISSOR_TEST),I.scissor(o*y.pixelRatio,h*y.pixelRatio,d*y.pixelRatio,m*y.pixelRatio),S.clear({color:_}),I.disable(I.SCISSOR_TEST)}function wp(y,o,h){const d=y.context,m=d.gl,_=h.posMatrix,S=y.useProgram("debug"),I=cn.disabled,T=jn.disabled,M=y.colorModeForRenderPass(),N="$debug",O=y.style.map.terrain&&y.style.map.terrain.getTerrainData(h);d.activeTexture.set(m.TEXTURE0);const U=o.getTileByID(h.key).latestRawTileData,tt=Math.floor((U&&U.byteLength||0)/1024),$=o.getTile(h).tileSize,it=512/Math.min($,512)*(h.overscaledZ/y.transform.zoom)*.5;let Z=h.canonical.toString();h.overscaledZ!==h.canonical.z&&(Z+=` => ${h.overscaledZ}`),function(ht,It){ht.initDebugOverlayCanvas();const st=ht.debugOverlayCanvas,_t=ht.context.gl,Ct=ht.debugOverlayCanvas.getContext("2d");Ct.clearRect(0,0,st.width,st.height),Ct.shadowColor="white",Ct.shadowBlur=2,Ct.lineWidth=1.5,Ct.strokeStyle="white",Ct.textBaseline="top",Ct.font="bold 36px Open Sans, sans-serif",Ct.fillText(It,5,5),Ct.strokeText(It,5,5),ht.debugOverlayTexture.update(st),ht.debugOverlayTexture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE)}(y,`${Z} ${tt}kB`),S.draw(d,m.TRIANGLES,I,T,Sr.alphaBlended,Bn.disabled,hd(_,c.aO.transparent,it),null,N,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),S.draw(d,m.LINE_STRIP,I,T,M,Bn.disabled,hd(_,c.aO.red),O,N,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function Uc(y,o,h){const d=y.context,m=d.gl,_=y.colorModeForRenderPass(),S=new cn(m.LEQUAL,cn.ReadWrite,y.depthRangeFor3D),I=y.useProgram("terrain"),T=o.getTerrainMesh();d.bindFramebuffer.set(null),d.viewport.set([0,0,y.width,y.height]);for(const M of h){const N=y.renderToTexture.getTexture(M),O=o.getTerrainData(M.tileID);d.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,N.texture);const U={u_matrix:y.transform.calculatePosMatrix(M.tileID.toUnwrapped()),u_texture:0,u_ele_delta:o.getMeshFrameDelta(y.transform.zoom)};I.draw(d,m.TRIANGLES,S,jn.disabled,_,Bn.backCCW,U,O,"terrain",T.vertexBuffer,T.indexBuffer,T.segments)}}class Pd{constructor(o,h){this.context=new Rg(o),this.transform=h,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=di.maxUnderzooming+di.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ya}resize(o,h,d){if(this.width=Math.floor(o*d),this.height=Math.floor(h*d),this.pixelRatio=d,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const o=this.context,h=new c.aV;h.emplaceBack(0,0),h.emplaceBack(c.W,0),h.emplaceBack(0,c.W),h.emplaceBack(c.W,c.W),this.tileExtentBuffer=o.createVertexBuffer(h,_c.members),this.tileExtentSegments=c.$.simpleSegment(0,0,4,2);const d=new c.aV;d.emplaceBack(0,0),d.emplaceBack(c.W,0),d.emplaceBack(0,c.W),d.emplaceBack(c.W,c.W),this.debugBuffer=o.createVertexBuffer(d,_c.members),this.debugSegments=c.$.simpleSegment(0,0,4,5);const m=new c.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(c.W,0,c.W,0),m.emplaceBack(0,c.W,0,c.W),m.emplaceBack(c.W,c.W,c.W,c.W),this.rasterBoundsBuffer=o.createVertexBuffer(m,tn.members),this.rasterBoundsSegments=c.$.simpleSegment(0,0,4,2);const _=new c.aV;_.emplaceBack(0,0),_.emplaceBack(1,0),_.emplaceBack(0,1),_.emplaceBack(1,1),this.viewportBuffer=o.createVertexBuffer(_,_c.members),this.viewportSegments=c.$.simpleSegment(0,0,4,2);const S=new c.aW;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=o.createIndexBuffer(S);const I=new c.aX;I.emplaceBack(0,1,2),I.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=o.createIndexBuffer(I);const T=this.context.gl;this.stencilClearMode=new jn({func:T.ALWAYS,mask:0},0,255,T.ZERO,T.ZERO,T.ZERO)}clearStencil(){const o=this.context,h=o.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const d=c.F();c.aN(d,0,this.width,this.height,0,0,1),c.J(d,d,[h.drawingBufferWidth,h.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(o,h.TRIANGLES,cn.disabled,this.stencilClearMode,Sr.disabled,Bn.disabled,wc(d),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(o,h){if(this.currentStencilSource===o.source||!o.isTileClipped()||!h||!h.length)return;this.currentStencilSource=o.source;const d=this.context,m=d.gl;this.nextStencilID+h.length>256&&this.clearStencil(),d.setColorMode(Sr.disabled),d.setDepthMode(cn.disabled);const _=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of h){const I=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,T=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);_.draw(d,m.TRIANGLES,cn.disabled,new jn({func:m.ALWAYS,mask:0},I,255,m.KEEP,m.KEEP,m.REPLACE),Sr.disabled,Bn.disabled,wc(S.posMatrix),T,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const o=this.nextStencilID++,h=this.context.gl;return new jn({func:h.NOTEQUAL,mask:255},o,255,h.KEEP,h.KEEP,h.REPLACE)}stencilModeForClipping(o){const h=this.context.gl;return new jn({func:h.EQUAL,mask:255},this._tileClippingMaskIDs[o.key],0,h.KEEP,h.KEEP,h.REPLACE)}stencilConfigForOverlap(o){const h=this.context.gl,d=o.sort((S,I)=>I.overscaledZ-S.overscaledZ),m=d[d.length-1].overscaledZ,_=d[0].overscaledZ-m+1;if(_>1){this.currentStencilSource=void 0,this.nextStencilID+_>256&&this.clearStencil();const S={};for(let I=0;I<_;I++)S[I+m]=new jn({func:h.GEQUAL,mask:255},I+this.nextStencilID,255,h.KEEP,h.KEEP,h.REPLACE);return this.nextStencilID+=_,[S,d]}return[{[m]:jn.disabled},d]}colorModeForRenderPass(){const o=this.context.gl;return this._showOverdrawInspector?new Sr([o.CONSTANT_COLOR,o.ONE],new c.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Sr.unblended:Sr.alphaBlended}depthModeForSublayer(o,h,d){if(!this.opaquePassEnabledForLayer())return cn.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+o)*this.depthEpsilon;return new cn(d||this.context.gl.LEQUAL,h,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(o,h){this.style=o,this.options=h,this.lineAtlas=o.lineAtlas,this.imageManager=o.imageManager,this.glyphManager=o.glyphManager,this.symbolFadeChange=o.placement.symbolFadeChange(P.now()),this.imageManager.beginFrame();const d=this.style._order,m=this.style.sourceCaches,_={},S={},I={};for(const T in m){const M=m[T];M.used&&M.prepare(this.context),_[T]=M.getVisibleCoordinates(),S[T]=_[T].slice().reverse(),I[T]=M.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let T=0;T<d.length;T++)if(this.style._layers[d[T]].is3D()){this.opaquePassCutoff=T;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const T of d){const M=this.style._layers[T];if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;const N=S[M.source];(M.type==="custom"||N.length)&&this.renderLayer(this,m[M.source],M,N)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:h.showOverdrawInspector?c.aO.black:c.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=h.showOverdrawInspector,this.depthRangeFor3D=[0,1-(o._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=d.length-1;this.currentLayer>=0;this.currentLayer--){const T=this.style._layers[d[this.currentLayer]],M=m[T.source],N=_[T.source];this._renderTileClippingMasks(T,N),this.renderLayer(this,M,T,N)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<d.length;this.currentLayer++){const T=this.style._layers[d[this.currentLayer]],M=m[T.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(T))continue;const N=(T.type==="symbol"?I:S)[T.source];this._renderTileClippingMasks(T,_[T.source]),this.renderLayer(this,M,T,N)}if(this.options.showTileBoundaries){const T=function(M,N){let O=null;const U=Object.values(M._layers).flatMap(Z=>Z.source&&!Z.isHidden(N)?[M.sourceCaches[Z.source]]:[]),tt=U.filter(Z=>Z.getSource().type==="vector"),$=U.filter(Z=>Z.getSource().type!=="vector"),it=Z=>{(!O||O.getSource().maxzoom<Z.getSource().maxzoom)&&(O=Z)};return tt.forEach(Z=>it(Z)),O||$.forEach(Z=>it(Z)),O}(this.style,this.transform.zoom);T&&function(M,N,O){for(let U=0;U<O.length;U++)wp(M,N,O[U])}(this,T,T.getVisibleCoordinates())}this.options.showPadding&&function(T){const M=T.transform.padding;cr(T,T.transform.height-(M.top||0),3,Td),cr(T,M.bottom||0,3,Vc),va(T,M.left||0,3,bp),va(T,T.transform.width-(M.right||0),3,Ng);const N=T.transform.centerPoint;(function(O,U,tt,$){Ai(O,U-1,tt-10,2,20,$),Ai(O,U-10,tt-1,20,2,$)})(T,N.x,T.transform.height-N.y,Ld)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(o){if(!this.style||!this.style.map||!this.style.map.terrain)return;const h=this.terrainFacilitator.matrix,d=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=o?!c.aY(h,d):!c.aZ(h,d)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(c.a_(h,d),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(_,S){const I=_.context,T=I.gl,M=Sr.unblended,N=new cn(T.LEQUAL,cn.ReadWrite,[0,1]),O=S.getTerrainMesh(),U=S.sourceCache.getRenderableTiles(),tt=_.useProgram("terrainDepth");I.bindFramebuffer.set(S.getFramebuffer("depth").framebuffer),I.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),I.clear({color:c.aO.transparent,depth:1});for(const $ of U){const it=S.getTerrainData($.tileID),Z={u_matrix:_.transform.calculatePosMatrix($.tileID.toUnwrapped()),u_ele_delta:S.getMeshFrameDelta(_.transform.zoom)};tt.draw(I,T.TRIANGLES,N,jn.disabled,M,Bn.backCCW,Z,it,"terrain",O.vertexBuffer,O.indexBuffer,O.segments)}I.bindFramebuffer.set(null),I.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain),function(_,S){const I=_.context,T=I.gl,M=Sr.unblended,N=new cn(T.LEQUAL,cn.ReadWrite,[0,1]),O=S.getTerrainMesh(),U=S.getCoordsTexture(),tt=S.sourceCache.getRenderableTiles(),$=_.useProgram("terrainCoords");I.bindFramebuffer.set(S.getFramebuffer("coords").framebuffer),I.viewport.set([0,0,_.width/devicePixelRatio,_.height/devicePixelRatio]),I.clear({color:c.aO.transparent,depth:1}),S.coordsIndex=[];for(const it of tt){const Z=S.getTerrainData(it.tileID);I.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,U.texture);const ht={u_matrix:_.transform.calculatePosMatrix(it.tileID.toUnwrapped()),u_terrain_coords_id:(255-S.coordsIndex.length)/255,u_texture:0,u_ele_delta:S.getMeshFrameDelta(_.transform.zoom)};$.draw(I,T.TRIANGLES,N,jn.disabled,M,Bn.backCCW,ht,Z,"terrain",O.vertexBuffer,O.indexBuffer,O.segments),S.coordsIndex.push(it.tileID.key)}I.bindFramebuffer.set(null),I.viewport.set([0,0,_.width,_.height])}(this,this.style.map.terrain))}renderLayer(o,h,d,m){if(!d.isHidden(this.transform.zoom)&&(d.type==="background"||d.type==="custom"||(m||[]).length))switch(this.id=d.id,d.type){case"symbol":(function(_,S,I,T,M){if(_.renderPass!=="translucent")return;const N=jn.disabled,O=_.colorModeForRenderPass();(I._unevaluatedLayout.hasValue("text-variable-anchor")||I._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(U,tt,$,it,Z,ht,It){const st=tt.transform,_t=Z==="map",Ct=ht==="map";for(const At of U){const kt=it.getTile(At),Vt=kt.getBucket($);if(!Vt||!Vt.text||!Vt.text.segments.get().length)continue;const Bt=c.ag(Vt.textSizeData,st.zoom),Wt=Ae(kt,1,tt.transform.zoom),Xt=Oe(At.posMatrix,Ct,_t,tt.transform,Wt),Fe=$.layout.get("icon-text-fit")!=="none"&&Vt.hasIconData();if(Bt){const Kt=Math.pow(2,st.zoom-kt.tileID.overscaledZ);Rc(Vt,_t,Ct,It,st,Xt,At.posMatrix,Kt,Bt,Fe,tt.style.map.terrain?(Se,Be)=>tt.style.map.terrain.getElevation(At,Se,Be):null)}}}(T,_,I,S,I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),M),I.paint.get("icon-opacity").constantOr(1)!==0&&Oc(_,S,I,T,!1,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),I.layout.get("icon-rotation-alignment"),I.layout.get("icon-pitch-alignment"),I.layout.get("icon-keep-upright"),N,O),I.paint.get("text-opacity").constantOr(1)!==0&&Oc(_,S,I,T,!0,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),I.layout.get("text-rotation-alignment"),I.layout.get("text-pitch-alignment"),I.layout.get("text-keep-upright"),N,O),S.map.showCollisionBoxes&&(kc(_,S,I,T,I.paint.get("text-translate"),I.paint.get("text-translate-anchor"),!0),kc(_,S,I,T,I.paint.get("icon-translate"),I.paint.get("icon-translate-anchor"),!1))})(o,h,d,m,this.style.placement.variableOffsets);break;case"circle":(function(_,S,I,T){if(_.renderPass!=="translucent")return;const M=I.paint.get("circle-opacity"),N=I.paint.get("circle-stroke-width"),O=I.paint.get("circle-stroke-opacity"),U=!I.layout.get("circle-sort-key").isConstant();if(M.constantOr(1)===0&&(N.constantOr(1)===0||O.constantOr(1)===0))return;const tt=_.context,$=tt.gl,it=_.depthModeForSublayer(0,cn.ReadOnly),Z=jn.disabled,ht=_.colorModeForRenderPass(),It=[];for(let st=0;st<T.length;st++){const _t=T[st],Ct=S.getTile(_t),At=Ct.getBucket(I);if(!At)continue;const kt=At.programConfigurations.get(I.id),Vt=_.useProgram("circle",kt),Bt=At.layoutVertexBuffer,Wt=At.indexBuffer,Xt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(_t),Fe={programConfiguration:kt,program:Vt,layoutVertexBuffer:Bt,indexBuffer:Wt,uniformValues:Sg(_,_t,Ct,I),terrainData:Xt};if(U){const Kt=At.segments.get();for(const Se of Kt)It.push({segments:new c.$([Se]),sortKey:Se.sortKey,state:Fe})}else It.push({segments:At.segments,sortKey:0,state:Fe})}U&&It.sort((st,_t)=>st.sortKey-_t.sortKey);for(const st of It){const{programConfiguration:_t,program:Ct,layoutVertexBuffer:At,indexBuffer:kt,uniformValues:Vt,terrainData:Bt}=st.state;Ct.draw(tt,$.TRIANGLES,it,Z,ht,Bn.disabled,Vt,Bt,I.id,At,kt,st.segments,I.paint,_.transform.zoom,_t)}})(o,h,d,m);break;case"heatmap":(function(_,S,I,T){if(I.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const M=_.context,N=M.gl,O=jn.disabled,U=new Sr([N.ONE,N.ONE],c.aO.transparent,[!0,!0,!0,!0]);(function(tt,$,it){const Z=tt.gl;tt.activeTexture.set(Z.TEXTURE1),tt.viewport.set([0,0,$.width/4,$.height/4]);let ht=it.heatmapFbo;if(ht)Z.bindTexture(Z.TEXTURE_2D,ht.colorAttachment.get()),tt.bindFramebuffer.set(ht.framebuffer);else{const It=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,It),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),ht=it.heatmapFbo=tt.createFramebuffer($.width/4,$.height/4,!1,!1),function(st,_t,Ct,At){var kt,Vt;const Bt=st.gl,Wt=(kt=st.HALF_FLOAT)!==null&&kt!==void 0?kt:Bt.UNSIGNED_BYTE,Xt=(Vt=st.RGBA16F)!==null&&Vt!==void 0?Vt:Bt.RGBA;Bt.texImage2D(Bt.TEXTURE_2D,0,Xt,_t.width/4,_t.height/4,0,Bt.RGBA,Wt,null),At.colorAttachment.set(Ct)}(tt,$,It,ht)}})(M,_,I),M.clear({color:c.aO.transparent});for(let tt=0;tt<T.length;tt++){const $=T[tt];if(S.hasRenderableParent($))continue;const it=S.getTile($),Z=it.getBucket(I);if(!Z)continue;const ht=Z.programConfigurations.get(I.id),It=_.useProgram("heatmap",ht),{zoom:st}=_.transform;It.draw(M,N.TRIANGLES,cn.disabled,O,U,Bn.disabled,pd($.posMatrix,it,st,I.paint.get("heatmap-intensity")),null,I.id,Z.layoutVertexBuffer,Z.indexBuffer,Z.segments,I.paint,_.transform.zoom,ht)}M.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(M,N){const O=M.context,U=O.gl,tt=N.heatmapFbo;if(!tt)return;O.activeTexture.set(U.TEXTURE0),U.bindTexture(U.TEXTURE_2D,tt.colorAttachment.get()),O.activeTexture.set(U.TEXTURE1);let $=N.colorRampTexture;$||($=N.colorRampTexture=new Q(O,N.colorRamp,U.RGBA)),$.bind(U.LINEAR,U.CLAMP_TO_EDGE),M.useProgram("heatmapTexture").draw(O,U.TRIANGLES,cn.disabled,jn.disabled,M.colorModeForRenderPass(),Bn.disabled,((it,Z,ht,It)=>{const st=c.F();c.aN(st,0,it.width,it.height,0,0,1);const _t=it.context.gl;return{u_matrix:st,u_world:[_t.drawingBufferWidth,_t.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}})(M,N),null,N.id,M.viewportBuffer,M.quadTriangleIndexBuffer,M.viewportSegments,N.paint,M.transform.zoom)}(_,I))})(o,h,d,m);break;case"line":(function(_,S,I,T){if(_.renderPass!=="translucent")return;const M=I.paint.get("line-opacity"),N=I.paint.get("line-width");if(M.constantOr(1)===0||N.constantOr(1)===0)return;const O=_.depthModeForSublayer(0,cn.ReadOnly),U=_.colorModeForRenderPass(),tt=I.paint.get("line-dasharray"),$=I.paint.get("line-pattern"),it=$.constantOr(1),Z=I.paint.get("line-gradient"),ht=I.getCrossfadeParameters(),It=it?"linePattern":tt?"lineSDF":Z?"lineGradient":"line",st=_.context,_t=st.gl;let Ct=!0;for(const At of T){const kt=S.getTile(At);if(it&&!kt.patternsLoaded())continue;const Vt=kt.getBucket(I);if(!Vt)continue;const Bt=Vt.programConfigurations.get(I.id),Wt=_.context.program.get(),Xt=_.useProgram(It,Bt),Fe=Ct||Xt.program!==Wt,Kt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(At),Se=$.constantOr(null);if(Se&&kt.imageAtlas){const Pe=kt.imageAtlas,qe=Pe.patternPositions[Se.to.toString()],Xe=Pe.patternPositions[Se.from.toString()];qe&&Xe&&Bt.setConstantPatternPositions(qe,Xe)}const Be=Kt?At:null,hn=it?Xa(_,kt,I,ht,Be):tt?Ic(_,kt,I,tt,ht,Be):Z?dd(_,kt,I,Vt.lineClipsArray.length,Be):Sc(_,kt,I,Be);if(it)st.activeTexture.set(_t.TEXTURE0),kt.imageAtlasTexture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE),Bt.updatePaintBuffers(ht);else if(tt&&(Fe||_.lineAtlas.dirty))st.activeTexture.set(_t.TEXTURE0),_.lineAtlas.bind(st);else if(Z){const Pe=Vt.gradients[I.id];let qe=Pe.texture;if(I.gradientVersion!==Pe.version){let Xe=256;if(I.stepInterpolant){const pr=S.getSource().maxzoom,Mn=At.canonical.z===pr?Math.ceil(1<<_.transform.maxZoom-At.canonical.z):1;Xe=c.ac(c.aT(Vt.maxLineLength/c.W*1024*Mn),256,st.maxTextureSize)}Pe.gradient=c.aU({expression:I.gradientExpression(),evaluationKey:"lineProgress",resolution:Xe,image:Pe.gradient||void 0,clips:Vt.lineClipsArray}),Pe.texture?Pe.texture.update(Pe.gradient):Pe.texture=new Q(st,Pe.gradient,_t.RGBA),Pe.version=I.gradientVersion,qe=Pe.texture}st.activeTexture.set(_t.TEXTURE0),qe.bind(I.stepInterpolant?_t.NEAREST:_t.LINEAR,_t.CLAMP_TO_EDGE)}Xt.draw(st,_t.TRIANGLES,O,_.stencilModeForClipping(At),U,Bn.disabled,hn,Kt,I.id,Vt.layoutVertexBuffer,Vt.indexBuffer,Vt.segments,I.paint,_.transform.zoom,Bt,Vt.layoutVertexBuffer2),Ct=!1}})(o,h,d,m);break;case"fill":(function(_,S,I,T){const M=I.paint.get("fill-color"),N=I.paint.get("fill-opacity");if(N.constantOr(1)===0)return;const O=_.colorModeForRenderPass(),U=I.paint.get("fill-pattern"),tt=_.opaquePassEnabledForLayer()&&!U.constantOr(1)&&M.constantOr(c.aO.transparent).a===1&&N.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===tt){const $=_.depthModeForSublayer(1,_.renderPass==="opaque"?cn.ReadWrite:cn.ReadOnly);Ed(_,S,I,T,$,O,!1)}if(_.renderPass==="translucent"&&I.paint.get("fill-antialias")){const $=_.depthModeForSublayer(I.getPaintProperty("fill-outline-color")?2:0,cn.ReadOnly);Ed(_,S,I,T,$,O,!0)}})(o,h,d,m);break;case"fill-extrusion":(function(_,S,I,T){const M=I.paint.get("fill-extrusion-opacity");if(M!==0&&_.renderPass==="translucent"){const N=new cn(_.context.gl.LEQUAL,cn.ReadWrite,_.depthRangeFor3D);if(M!==1||I.paint.get("fill-extrusion-pattern").constantOr(1))Fc(_,S,I,T,N,jn.disabled,Sr.disabled),Fc(_,S,I,T,N,_.stencilModeFor3D(),_.colorModeForRenderPass());else{const O=_.colorModeForRenderPass();Fc(_,S,I,T,N,jn.disabled,O)}}})(o,h,d,m);break;case"hillshade":(function(_,S,I,T){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent")return;const M=_.context,N=_.depthModeForSublayer(0,cn.ReadOnly),O=_.colorModeForRenderPass(),[U,tt]=_.renderPass==="translucent"?_.stencilConfigForOverlap(T):[{},T];for(const $ of tt){const it=S.getTile($);it.needsHillshadePrepare!==void 0&&it.needsHillshadePrepare&&_.renderPass==="offscreen"?xp(_,it,I,N,jn.disabled,O):_.renderPass==="translucent"&&Bc(_,$,it,I,N,U[$.overscaledZ],O)}M.viewport.set([0,0,_.width,_.height])})(o,h,d,m);break;case"raster":(function(_,S,I,T){if(_.renderPass!=="translucent"||I.paint.get("raster-opacity")===0||!T.length)return;const M=_.context,N=M.gl,O=S.getSource(),U=_.useProgram("raster"),tt=_.colorModeForRenderPass(),[$,it]=O instanceof zr?[{},T]:_.stencilConfigForOverlap(T),Z=it[it.length-1].overscaledZ,ht=!_.options.moving;for(const It of it){const st=_.depthModeForSublayer(It.overscaledZ-Z,I.paint.get("raster-opacity")===1?cn.ReadWrite:cn.ReadOnly,N.LESS),_t=S.getTile(It);_t.registerFadeDuration(I.paint.get("raster-fade-duration"));const Ct=S.findLoadedParent(It,0),At=Cd(_t,Ct,S,I,_.transform,_.style.map.terrain);let kt,Vt;const Bt=I.paint.get("raster-resampling")==="nearest"?N.NEAREST:N.LINEAR;M.activeTexture.set(N.TEXTURE0),_t.texture.bind(Bt,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),M.activeTexture.set(N.TEXTURE1),Ct?(Ct.texture.bind(Bt,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST),kt=Math.pow(2,Ct.tileID.overscaledZ-_t.tileID.overscaledZ),Vt=[_t.tileID.canonical.x*kt%1,_t.tileID.canonical.y*kt%1]):_t.texture.bind(Bt,N.CLAMP_TO_EDGE,N.LINEAR_MIPMAP_NEAREST);const Wt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(It),Xt=Wt?It:null,Fe=Xt?Xt.posMatrix:_.transform.calculatePosMatrix(It.toUnwrapped(),ht),Kt=Ec(Fe,Vt||[0,0],kt||1,At,I);O instanceof zr?U.draw(M,N.TRIANGLES,st,jn.disabled,tt,Bn.disabled,Kt,Wt,I.id,O.boundsBuffer,_.quadTriangleIndexBuffer,O.boundsSegments):U.draw(M,N.TRIANGLES,st,$[It.overscaledZ],tt,Bn.disabled,Kt,Wt,I.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}})(o,h,d,m);break;case"background":(function(_,S,I,T){const M=I.paint.get("background-color"),N=I.paint.get("background-opacity");if(N===0)return;const O=_.context,U=O.gl,tt=_.transform,$=tt.tileSize,it=I.paint.get("background-pattern");if(_.isPatternMissing(it))return;const Z=!it&&M.a===1&&N===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==Z)return;const ht=jn.disabled,It=_.depthModeForSublayer(0,Z==="opaque"?cn.ReadWrite:cn.ReadOnly),st=_.colorModeForRenderPass(),_t=_.useProgram(it?"backgroundPattern":"background"),Ct=T||tt.coveringTiles({tileSize:$,terrain:_.style.map.terrain});it&&(O.activeTexture.set(U.TEXTURE0),_.imageManager.bind(_.context));const At=I.getCrossfadeParameters();for(const kt of Ct){const Vt=T?kt.posMatrix:_.transform.calculatePosMatrix(kt.toUnwrapped()),Bt=it?Eg(Vt,N,_,it,{tileID:kt,tileSize:$},At):Ig(Vt,N,M),Wt=_.style.map.terrain&&_.style.map.terrain.getTerrainData(kt);_t.draw(O,U.TRIANGLES,It,ht,st,Bn.disabled,Bt,Wt,I.id,_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}})(o,0,d,m);break;case"custom":(function(_,S,I){const T=_.context,M=I.implementation;if(_.renderPass==="offscreen"){const N=M.prerender;N&&(_.setCustomLayerDefaults(),T.setColorMode(_.colorModeForRenderPass()),N.call(M,T.gl,_.transform.customLayerMatrix()),T.setDirty(),_.setBaseState())}else if(_.renderPass==="translucent"){_.setCustomLayerDefaults(),T.setColorMode(_.colorModeForRenderPass()),T.setStencilMode(jn.disabled);const N=M.renderingMode==="3d"?new cn(_.context.gl.LEQUAL,cn.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,cn.ReadOnly);T.setDepthMode(N),M.render(T.gl,_.transform.customLayerMatrix()),T.setDirty(),_.setBaseState(),T.bindFramebuffer.set(null)}})(o,0,d)}}translatePosMatrix(o,h,d,m,_){if(!d[0]&&!d[1])return o;const S=_?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(S){const M=Math.sin(S),N=Math.cos(S);d=[d[0]*N-d[1]*M,d[0]*M+d[1]*N]}const I=[_?d[0]:Ae(h,d[0],this.transform.zoom),_?d[1]:Ae(h,d[1],this.transform.zoom),0],T=new Float32Array(16);return c.H(T,o,I),T}saveTileTexture(o){const h=this._tileTextures[o.size[0]];h?h.push(o):this._tileTextures[o.size[0]]=[o]}getTileTexture(o){const h=this._tileTextures[o];return h&&h.length>0?h.pop():null}isPatternMissing(o){if(!o)return!1;if(!o.from||!o.to)return!0;const h=this.imageManager.getPattern(o.from.toString()),d=this.imageManager.getPattern(o.to.toString());return!h||!d}useProgram(o,h){this.cache=this.cache||{};const d=o+(h?h.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[d]||(this.cache[d]=new _a(this.context,vu[o],h,md[o],this._showOverdrawInspector,this.style.map.terrain)),this.cache[d]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const o=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(o.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Q(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:o,drawingBufferHeight:h}=this.context.gl;return this.width!==o||this.height!==h}}class xa{constructor(o,h){this.points=o,this.planes=h}static fromInvProjectionMatrix(o,h,d){const m=Math.pow(2,d),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(I=>{const T=1/(I=c.af([],I,o))[3]/h*m;return c.a$(I,I,[T,T,1/I[3],T])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(I=>{const T=function(U,tt){var $=tt[0],it=tt[1],Z=tt[2],ht=$*$+it*it+Z*Z;return ht>0&&(ht=1/Math.sqrt(ht)),U[0]=tt[0]*ht,U[1]=tt[1]*ht,U[2]=tt[2]*ht,U}([],function(U,tt,$){var it=tt[0],Z=tt[1],ht=tt[2],It=$[0],st=$[1],_t=$[2];return U[0]=Z*_t-ht*st,U[1]=ht*It-it*_t,U[2]=it*st-Z*It,U}([],Tt([],_[I[0]],_[I[1]]),Tt([],_[I[2]],_[I[1]]))),M=-((N=T)[0]*(O=_[I[1]])[0]+N[1]*O[1]+N[2]*O[2]);var N,O;return T.concat(M)});return new xa(_,S)}}class ba{constructor(o,h){this.min=o,this.max=h,this.center=function(d,m,_){return d[0]=.5*m[0],d[1]=.5*m[1],d[2]=.5*m[2],d}([],function(d,m,_){return d[0]=m[0]+_[0],d[1]=m[1]+_[1],d[2]=m[2]+_[2],d}([],this.min,this.max))}quadrant(o){const h=[o%2==0,o<2],d=Pt(this.min),m=Pt(this.max);for(let _=0;_<h.length;_++)d[_]=h[_]?this.min[_]:this.center[_],m[_]=h[_]?this.center[_]:this.max[_];return m[2]=this.max[2],new ba(d,m)}distanceX(o){return Math.max(Math.min(this.max[0],o[0]),this.min[0])-o[0]}distanceY(o){return Math.max(Math.min(this.max[1],o[1]),this.min[1])-o[1]}intersects(o){const h=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let d=!0;for(let m=0;m<o.planes.length;m++){const _=o.planes[m];let S=0;for(let I=0;I<h.length;I++)c.b0(_,h[I])>=0&&S++;if(S===0)return 0;S!==h.length&&(d=!1)}if(d)return 2;for(let m=0;m<3;m++){let _=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let I=0;I<o.points.length;I++){const T=o.points[I][m]-this.min[m];_=Math.min(_,T),S=Math.max(S,T)}if(S<0||_>this.max[m]-this.min[m])return 0}return 1}}class Ol{constructor(o=0,h=0,d=0,m=0){if(isNaN(o)||o<0||isNaN(h)||h<0||isNaN(d)||d<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=o,this.bottom=h,this.left=d,this.right=m}interpolate(o,h,d){return h.top!=null&&o.top!=null&&(this.top=c.z.number(o.top,h.top,d)),h.bottom!=null&&o.bottom!=null&&(this.bottom=c.z.number(o.bottom,h.bottom,d)),h.left!=null&&o.left!=null&&(this.left=c.z.number(o.left,h.left,d)),h.right!=null&&o.right!=null&&(this.right=c.z.number(o.right,h.right,d)),this}getCenter(o,h){const d=c.ac((this.left+o-this.right)/2,0,o),m=c.ac((this.top+h-this.bottom)/2,0,h);return new c.P(d,m)}equals(o){return this.top===o.top&&this.bottom===o.bottom&&this.left===o.left&&this.right===o.right}clone(){return new Ol(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Sp=85.051129;class Gc{constructor(o,h,d,m,_){this.tileSize=512,this._renderWorldCopies=_===void 0||!!_,this._minZoom=o||0,this._maxZoom=h||22,this._minPitch=d??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ol,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const o=new Gc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return o.apply(this),o}apply(o){this.tileSize=o.tileSize,this.latRange=o.latRange,this.width=o.width,this.height=o.height,this._center=o._center,this._elevation=o._elevation,this.minElevationForCurrentTile=o.minElevationForCurrentTile,this.zoom=o.zoom,this.angle=o.angle,this._fov=o._fov,this._pitch=o._pitch,this._unmodified=o._unmodified,this._edgeInsets=o._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(o){this._minZoom!==o&&(this._minZoom=o,this.zoom=Math.max(this.zoom,o))}get maxZoom(){return this._maxZoom}set maxZoom(o){this._maxZoom!==o&&(this._maxZoom=o,this.zoom=Math.min(this.zoom,o))}get minPitch(){return this._minPitch}set minPitch(o){this._minPitch!==o&&(this._minPitch=o,this.pitch=Math.max(this.pitch,o))}get maxPitch(){return this._maxPitch}set maxPitch(o){this._maxPitch!==o&&(this._maxPitch=o,this.pitch=Math.min(this.pitch,o))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(o){o===void 0?o=!0:o===null&&(o=!1),this._renderWorldCopies=o}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(o){const h=-c.b1(o,-180,180)*Math.PI/180;this.angle!==h&&(this._unmodified=!1,this.angle=h,this._calcMatrices(),this.rotationMatrix=function(){var d=new c.A(4);return c.A!=Float32Array&&(d[1]=0,d[2]=0),d[0]=1,d[3]=1,d}(),function(d,m,_){var S=m[0],I=m[1],T=m[2],M=m[3],N=Math.sin(_),O=Math.cos(_);d[0]=S*O+T*N,d[1]=I*O+M*N,d[2]=S*-N+T*O,d[3]=I*-N+M*O}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(o){const h=c.ac(o,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==h&&(this._unmodified=!1,this._pitch=h,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(o){o=Math.max(.01,Math.min(60,o)),this._fov!==o&&(this._unmodified=!1,this._fov=o/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(o){const h=Math.min(Math.max(o,this.minZoom),this.maxZoom);this._zoom!==h&&(this._unmodified=!1,this._zoom=h,this.tileZoom=Math.max(0,Math.floor(h)),this.scale=this.zoomScale(h),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(o){o.lat===this._center.lat&&o.lng===this._center.lng||(this._unmodified=!1,this._center=o,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(o){o!==this._elevation&&(this._elevation=o,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(o){this._edgeInsets.equals(o)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,o,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(o){return this._edgeInsets.equals(o)}interpolatePadding(o,h,d){this._unmodified=!1,this._edgeInsets.interpolate(o,h,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(o){const h=(o.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/o.tileSize));return Math.max(0,h)}getVisibleUnwrappedCoordinates(o){const h=[new c.b2(0,o)];if(this._renderWorldCopies){const d=this.pointCoordinate(new c.P(0,0)),m=this.pointCoordinate(new c.P(this.width,0)),_=this.pointCoordinate(new c.P(this.width,this.height)),S=this.pointCoordinate(new c.P(0,this.height)),I=Math.floor(Math.min(d.x,m.x,_.x,S.x)),T=Math.floor(Math.max(d.x,m.x,_.x,S.x)),M=1;for(let N=I-M;N<=T+M;N++)N!==0&&h.push(new c.b2(N,o))}return h}coveringTiles(o){var h,d;let m=this.coveringZoomLevel(o);const _=m;if(o.minzoom!==void 0&&m<o.minzoom)return[];o.maxzoom!==void 0&&m>o.maxzoom&&(m=o.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),I=c.Y.fromLngLat(this.center),T=Math.pow(2,m),M=[T*S.x,T*S.y,0],N=[T*I.x,T*I.y,0],O=xa.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let U=o.minzoom||0;!o.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(U=m);const tt=o.terrain?2/Math.min(this.tileSize,o.tileSize)*this.tileSize:3,$=st=>({aabb:new ba([st*T,0,0],[(st+1)*T,T,0]),zoom:0,x:0,y:0,wrap:st,fullyVisible:!1}),it=[],Z=[],ht=m,It=o.reparseOverscaled?_:m;if(this._renderWorldCopies)for(let st=1;st<=3;st++)it.push($(-st)),it.push($(st));for(it.push($(0));it.length>0;){const st=it.pop(),_t=st.x,Ct=st.y;let At=st.fullyVisible;if(!At){const Xt=st.aabb.intersects(O);if(Xt===0)continue;At=Xt===2}const kt=o.terrain?M:N,Vt=st.aabb.distanceX(kt),Bt=st.aabb.distanceY(kt),Wt=Math.max(Math.abs(Vt),Math.abs(Bt));if(st.zoom===ht||Wt>tt+(1<<ht-st.zoom)-2&&st.zoom>=U){const Xt=ht-st.zoom,Fe=M[0]-.5-(_t<<Xt),Kt=M[1]-.5-(Ct<<Xt);Z.push({tileID:new c.Q(st.zoom===ht?It:st.zoom,st.wrap,st.zoom,_t,Ct),distanceSq:Ut([N[0]-.5-_t,N[1]-.5-Ct]),tileDistanceToCamera:Math.sqrt(Fe*Fe+Kt*Kt)})}else for(let Xt=0;Xt<4;Xt++){const Fe=(_t<<1)+Xt%2,Kt=(Ct<<1)+(Xt>>1),Se=st.zoom+1;let Be=st.aabb.quadrant(Xt);if(o.terrain){const hn=new c.Q(Se,st.wrap,Se,Fe,Kt),Pe=o.terrain.getMinMaxElevation(hn),qe=(h=Pe.minElevation)!==null&&h!==void 0?h:this.elevation,Xe=(d=Pe.maxElevation)!==null&&d!==void 0?d:this.elevation;Be=new ba([Be.min[0],Be.min[1],qe],[Be.max[0],Be.max[1],Xe])}it.push({aabb:Be,zoom:Se,x:Fe,y:Kt,wrap:st.wrap,fullyVisible:At})}}return Z.sort((st,_t)=>st.distanceSq-_t.distanceSq).map(st=>st.tileID)}resize(o,h){this.width=o,this.height=h,this.pixelsToGLUnits=[2/o,-2/h],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(o){return Math.pow(2,o)}scaleZoom(o){return Math.log(o)/Math.LN2}project(o){const h=c.ac(o.lat,-85.051129,Sp);return new c.P(c.N(o.lng)*this.worldSize,c.O(h)*this.worldSize)}unproject(o){return new c.Y(o.x/this.worldSize,o.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(o){const h=this.elevation,d=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,o),_=o.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-_))return;const S=d+h-_,I=Math.cos(this._pitch)*this.cameraToCenterDistance/S/c.b3(1,m.lat),T=this.scaleZoom(I/this.tileSize);this._elevation=_,this._center=m,this.zoom=T}setLocationAtPoint(o,h){const d=this.pointCoordinate(h),m=this.pointCoordinate(this.centerPoint),_=this.locationCoordinate(o),S=new c.Y(_.x-(d.x-m.x),_.y-(d.y-m.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(o,h){return h?this.coordinatePoint(this.locationCoordinate(o),h.getElevationForLngLatZoom(o,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(o))}pointLocation(o,h){return this.coordinateLocation(this.pointCoordinate(o,h))}locationCoordinate(o){return c.Y.fromLngLat(o)}coordinateLocation(o){return o&&o.toLngLat()}pointCoordinate(o,h){if(h){const U=h.pointCoordinate(o);if(U!=null)return U}const d=[o.x,o.y,0,1],m=[o.x,o.y,1,1];c.af(d,d,this.pixelMatrixInverse),c.af(m,m,this.pixelMatrixInverse);const _=d[3],S=m[3],I=d[1]/_,T=m[1]/S,M=d[2]/_,N=m[2]/S,O=M===N?0:(0-M)/(N-M);return new c.Y(c.z.number(d[0]/_,m[0]/S,O)/this.worldSize,c.z.number(I,T,O)/this.worldSize)}coordinatePoint(o,h=0,d=this.pixelMatrix){const m=[o.x*this.worldSize,o.y*this.worldSize,h,1];return c.af(m,m,d),new c.P(m[0]/m[3],m[1]/m[3])}getBounds(){const o=Math.max(0,this.height/2-this.getHorizon());return new yt().extend(this.pointLocation(new c.P(0,o))).extend(this.pointLocation(new c.P(this.width,o))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new yt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(o){o?(this.lngRange=[o.getWest(),o.getEast()],this.latRange=[o.getSouth(),o.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Sp])}calculatePosMatrix(o,h=!1){const d=o.key,m=h?this._alignedPosMatrixCache:this._posMatrixCache;if(m[d])return m[d];const _=o.canonical,S=this.worldSize/this.zoomScale(_.z),I=_.x+Math.pow(2,_.z)*o.wrap,T=c.an(new Float64Array(16));return c.H(T,T,[I*S,_.y*S,0]),c.J(T,T,[S/c.W,S/c.W,1]),c.K(T,h?this.alignedProjMatrix:this.projMatrix,T),m[d]=new Float32Array(T),m[d]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(o,h){h=c.ac(+h,this.minZoom,this.maxZoom);const d={center:new c.M(o.lng,o.lat),zoom:h};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const st=179.9999999999;m=[-st,st]}const _=this.tileSize*this.zoomScale(d.zoom);let S=0,I=_,T=0,M=_,N=0,O=0;const{x:U,y:tt}=this.size;if(this.latRange){const st=this.latRange;S=c.O(st[1])*_,I=c.O(st[0])*_,I-S<tt&&(N=tt/(I-S))}m&&(T=c.b1(c.N(m[0])*_,0,_),M=c.b1(c.N(m[1])*_,0,_),M<T&&(M+=_),M-T<U&&(O=U/(M-T)));const{x:$,y:it}=this.project.call({worldSize:_},o);let Z,ht;const It=Math.max(O||0,N||0);if(It){const st=new c.P(O?(M+T)/2:$,N?(I+S)/2:it);return d.center=this.unproject.call({worldSize:_},st).wrap(),d.zoom+=this.scaleZoom(It),d}if(this.latRange){const st=tt/2;it-st<S&&(ht=S+st),it+st>I&&(ht=I-st)}if(m){const st=(T+M)/2;let _t=$;this._renderWorldCopies&&(_t=c.b1($,st-_/2,st+_/2));const Ct=U/2;_t-Ct<T&&(Z=T+Ct),_t+Ct>M&&(Z=M-Ct)}if(Z!==void 0||ht!==void 0){const st=new c.P(Z??$,ht??it);d.center=this.unproject.call({worldSize:_},st).wrap()}return d}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const o=this._unmodified,{center:h,zoom:d}=this.getConstrained(this.center,this.zoom);this.center=h,this.zoom=d,this._unmodified=o,this._constraining=!1}_calcMatrices(){if(!this.height)return;const o=this.centerOffset,h=this.point.x,d=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b3(1,this.center.lat)*this.worldSize;let m=c.an(new Float64Array(16));c.J(m,m,[this.width/2,-this.height/2,1]),c.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=c.an(new Float64Array(16)),c.J(m,m,[1,-1,1]),c.H(m,m,[-1,-1,0]),c.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const _=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),S=Math.min(this.elevation,this.minElevationForCurrentTile),I=_-S*this._pixelPerMeter/Math.cos(this._pitch),T=S<0?I:_,M=Math.PI/2+this._pitch,N=this._fov*(.5+o.y/this.height),O=Math.sin(N)*T/Math.sin(c.ac(Math.PI-M-N,.01,Math.PI-.01)),U=this.getHorizon(),tt=2*Math.atan(U/this.cameraToCenterDistance)*(.5+o.y/(2*U)),$=Math.sin(tt)*T/Math.sin(c.ac(Math.PI-M-tt,.01,Math.PI-.01)),it=Math.min(O,$),Z=1.01*(Math.cos(Math.PI/2-this._pitch)*it+T),ht=this.height/50;m=new Float64Array(16),c.b4(m,this._fov,this.width/this.height,ht,Z),m[8]=2*-o.x/this.width,m[9]=2*o.y/this.height,c.J(m,m,[1,-1,1]),c.H(m,m,[0,0,-this.cameraToCenterDistance]),c.b5(m,m,this._pitch),c.ad(m,m,this.angle),c.H(m,m,[-h,-d,0]),this.mercatorMatrix=c.J([],m,[this.worldSize,this.worldSize,this.worldSize]),c.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.K(new Float64Array(16),this.labelPlaneMatrix,m),c.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=c.ar([],m),this.pixelMatrix3D=c.K(new Float64Array(16),this.labelPlaneMatrix,m);const It=this.width%2/2,st=this.height%2/2,_t=Math.cos(this.angle),Ct=Math.sin(this.angle),At=h-Math.round(h)+_t*It+Ct*st,kt=d-Math.round(d)+_t*st+Ct*It,Vt=new Float64Array(m);if(c.H(Vt,Vt,[At>.5?At-1:At,kt>.5?kt-1:kt,0]),this.alignedProjMatrix=Vt,m=c.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const o=this.pointCoordinate(new c.P(0,0)),h=[o.x*this.worldSize,o.y*this.worldSize,0,1];return c.af(h,h,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const o=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,o))}getCameraQueryGeometry(o){const h=this.getCameraPoint();if(o.length===1)return[o[0],h];{let d=h.x,m=h.y,_=h.x,S=h.y;for(const I of o)d=Math.min(d,I.x),m=Math.min(m,I.y),_=Math.max(_,I.x),S=Math.max(S,I.y);return[new c.P(d,m),new c.P(_,m),new c.P(_,S),new c.P(d,S),new c.P(d,m)]}}lngLatToCameraDepth(o,h){const d=this.locationCoordinate(o),m=[d.x*this.worldSize,d.y*this.worldSize,h,1];return c.af(m,m,this.projMatrix),m[2]/m[3]}}function Ip(y,o){let h,d=!1,m=null,_=null;const S=()=>{m=null,d&&(y.apply(_,h),m=setTimeout(S,o),d=!1)};return(...I)=>(d=!0,_=this,h=I,m||S(),m)}class Ep{constructor(o){this._getCurrentHash=()=>{const h=window.location.hash.replace("#","");if(this._hashName){let d;return h.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(d=m)}),(d&&d[1]||"").split("/")}return h.split("/")},this._onHashChange=()=>{const h=this._getCurrentHash();if(h.length>=3&&!h.some(d=>isNaN(d))){const d=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:d,pitch:+(h[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const h=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,h)}catch{}},this._updateHash=Ip(this._updateHashUnthrottled,300),this._hashName=o&&encodeURIComponent(o)}addTo(o){return this._map=o,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(o){const h=this._map.getCenter(),d=Math.round(100*this._map.getZoom())/100,m=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),_=Math.pow(10,m),S=Math.round(h.lng*_)/_,I=Math.round(h.lat*_)/_,T=this._map.getBearing(),M=this._map.getPitch();let N="";if(N+=o?`/${S}/${I}/${d}`:`${d}/${I}/${S}`,(T||M)&&(N+="/"+Math.round(10*T)/10),M&&(N+=`/${Math.round(M)}`),this._hashName){const O=this._hashName;let U=!1;const tt=window.location.hash.slice(1).split("&").map($=>{const it=$.split("=")[0];return it===O?(U=!0,`${it}=${N}`):$}).filter($=>$);return U||tt.push(`${O}=${N}`),`#${tt.join("&")}`}return`#${N}`}}const Tu={linearity:.3,easing:c.b6(0,0,.3,1)},Qa=c.e({deceleration:2500,maxSpeed:1400},Tu),Ad=c.e({deceleration:20,maxSpeed:1400},Tu),Md=c.e({deceleration:1e3,maxSpeed:360},Tu),Dd=c.e({deceleration:1e3,maxSpeed:90},Tu);class kd{constructor(o){this._map=o,this.clear()}clear(){this._inertiaBuffer=[]}record(o){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:P.now(),settings:o})}_drainInertiaBuffer(){const o=this._inertiaBuffer,h=P.now();for(;o.length>0&&h-o[0].time>160;)o.shift()}_onMoveEnd(o){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const h={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:_}of this._inertiaBuffer)h.zoom+=_.zoomDelta||0,h.bearing+=_.bearingDelta||0,h.pitch+=_.pitchDelta||0,_.panDelta&&h.pan._add(_.panDelta),_.around&&(h.around=_.around),_.pinchAround&&(h.pinchAround=_.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(h.pan.mag()){const _=Pu(h.pan.mag(),d,c.e({},Qa,o||{}));m.offset=h.pan.mult(_.amount/h.pan.mag()),m.center=this._map.transform.center,Lu(m,_)}if(h.zoom){const _=Pu(h.zoom,d,Ad);m.zoom=this._map.transform.zoom+_.amount,Lu(m,_)}if(h.bearing){const _=Pu(h.bearing,d,Md);m.bearing=this._map.transform.bearing+c.ac(_.amount,-179,179),Lu(m,_)}if(h.pitch){const _=Pu(h.pitch,d,Dd);m.pitch=this._map.transform.pitch+_.amount,Lu(m,_)}if(m.zoom||m.bearing){const _=h.pinchAround===void 0?h.around:h.pinchAround;m.around=_?this._map.unproject(_):this._map.getCenter()}return this.clear(),c.e(m,{noMoveStart:!0})}}function Lu(y,o){(!y.duration||y.duration<o.duration)&&(y.duration=o.duration,y.easing=o.easing)}function Pu(y,o,h){const{maxSpeed:d,linearity:m,deceleration:_}=h,S=c.ac(y*m/(o/1e3),-d,d),I=Math.abs(S)/(_*m);return{easing:h.easing,duration:1e3*I,amount:S*(I/2)}}class qi extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,d,m={}){const _=R.mousePos(h.getCanvas(),d),S=h.unproject(_);super(o,c.e({point:_,lngLat:S,originalEvent:d},m)),this._defaultPrevented=!1,this.target=h}}class ys extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,d){const m=o==="touchend"?d.changedTouches:d.touches,_=R.touchPos(h.getCanvasContainer(),m),S=_.map(T=>h.unproject(T)),I=_.reduce((T,M,N,O)=>T.add(M.div(O.length)),new c.P(0,0));super(o,{points:_,point:I,lngLats:S,lngLat:h.unproject(I),originalEvent:d}),this._defaultPrevented=!1}}class Cp extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(o,h,d){super(o,{originalEvent:d}),this._defaultPrevented=!1}}class jo{constructor(o,h){this._map=o,this._clickTolerance=h.clickTolerance}reset(){delete this._mousedownPos}wheel(o){return this._firePreventable(new Cp(o.type,this._map,o))}mousedown(o,h){return this._mousedownPos=h,this._firePreventable(new qi(o.type,this._map,o))}mouseup(o){this._map.fire(new qi(o.type,this._map,o))}click(o,h){this._mousedownPos&&this._mousedownPos.dist(h)>=this._clickTolerance||this._map.fire(new qi(o.type,this._map,o))}dblclick(o){return this._firePreventable(new qi(o.type,this._map,o))}mouseover(o){this._map.fire(new qi(o.type,this._map,o))}mouseout(o){this._map.fire(new qi(o.type,this._map,o))}touchstart(o){return this._firePreventable(new ys(o.type,this._map,o))}touchmove(o){this._map.fire(new ys(o.type,this._map,o))}touchend(o){this._map.fire(new ys(o.type,this._map,o))}touchcancel(o){this._map.fire(new ys(o.type,this._map,o))}_firePreventable(o){if(this._map.fire(o),o.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class _s{constructor(o){this._map=o}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(o){this._map.fire(new qi(o.type,this._map,o))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new qi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(o){this._delayContextMenu?this._contextMenuEvent=o:this._ignoreContextMenu||this._map.fire(new qi(o.type,this._map,o)),this._map.listens("contextmenu")&&o.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zl{constructor(o){this._map=o}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(o){return this.transform.pointLocation(c.P.convert(o),this._map.terrain)}}class Wo{constructor(o,h){this._map=o,this._tr=new zl(o),this._el=o.getCanvasContainer(),this._container=o.getContainer(),this._clickTolerance=h.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(o,h){this.isEnabled()&&o.shiftKey&&o.button===0&&(R.disableDrag(),this._startPos=this._lastPos=h,this._active=!0)}mousemoveWindow(o,h){if(!this._active)return;const d=h;if(this._lastPos.equals(d)||!this._box&&d.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=d,this._box||(this._box=R.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",o));const _=Math.min(m.x,d.x),S=Math.max(m.x,d.x),I=Math.min(m.y,d.y),T=Math.max(m.y,d.y);R.setTransform(this._box,`translate(${_}px,${I}px)`),this._box.style.width=S-_+"px",this._box.style.height=T-I+"px"}mouseupWindow(o,h){if(!this._active||o.button!==0)return;const d=this._startPos,m=h;if(this.reset(),R.suppressClick(),d.x!==m.x||d.y!==m.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:o})),{cameraAnimation:_=>_.fitScreenCoordinates(d,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",o)}keydown(o){this._active&&o.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",o))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(R.remove(this._box),this._box=null),R.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(o,h){return this._map.fire(new c.k(o,{originalEvent:h}))}}function $a(y,o){if(y.length!==o.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${o.length}`);const h={};for(let d=0;d<y.length;d++)h[y[d].identifier]=o[d];return h}class Og{constructor(o){this.reset(),this.numTouches=o.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(o,h,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=o.timeStamp),d.length===this.numTouches&&(this.centroid=function(m){const _=new c.P(0,0);for(const S of m)_._add(S);return _.div(m.length)}(h),this.touches=$a(d,h)))}touchmove(o,h,d){if(this.aborted||!this.centroid)return;const m=$a(d,h);for(const _ in this.touches){const S=m[_];(!S||S.dist(this.touches[_])>30)&&(this.aborted=!0)}}touchend(o,h,d){if((!this.centroid||o.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Tp{constructor(o){this.singleTap=new Og(o),this.numTaps=o.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(o,h,d){this.singleTap.touchstart(o,h,d)}touchmove(o,h,d){this.singleTap.touchmove(o,h,d)}touchend(o,h,d){const m=this.singleTap.touchend(o,h,d);if(m){const _=o.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(m)<30;if(_&&S||this.reset(),this.count++,this.lastTime=o.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class zg{constructor(o){this._tr=new zl(o),this._zoomIn=new Tp({numTouches:1,numTaps:2}),this._zoomOut=new Tp({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(o,h,d){this._zoomIn.touchstart(o,h,d),this._zoomOut.touchstart(o,h,d)}touchmove(o,h,d){this._zoomIn.touchmove(o,h,d),this._zoomOut.touchmove(o,h,d)}touchend(o,h,d){const m=this._zoomIn.touchend(o,h,d),_=this._zoomOut.touchend(o,h,d),S=this._tr;return m?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(m)},{originalEvent:o})}):_?(this._active=!0,o.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:I=>I.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(_)},{originalEvent:o})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fl{constructor(o){this._enabled=!!o.enable,this._moveStateManager=o.moveStateManager,this._clickTolerance=o.clickTolerance||1,this._moveFunction=o.move,this._activateOnStart=!!o.activateOnStart,o.assignEvents(this),this.reset()}reset(o){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(o)}_move(...o){const h=this._moveFunction(...o);if(h.bearingDelta||h.pitchDelta||h.around||h.panDelta)return this._active=!0,h}dragStart(o,h){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(o)&&(this._moveStateManager.startMove(o),this._lastPoint=h.length?h[0]:h,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(o,h){if(!this.isEnabled())return;const d=this._lastPoint;if(!d)return;if(o.preventDefault(),!this._moveStateManager.isValidMoveEvent(o))return void this.reset(o);const m=h.length?h[0]:h;return!this._moved&&m.dist(d)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(d,m))}dragEnd(o){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(o)&&(this._moved&&R.suppressClick(),this.reset(o))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Au={0:1,2:2};class vs{constructor(o){this._correctEvent=o.checkCorrectEvent}startMove(o){const h=R.mouseButton(o);this._eventButton=h}endMove(o){delete this._eventButton}isValidStartEvent(o){return this._correctEvent(o)}isValidMoveEvent(o){return!function(h,d){const m=Au[d];return h.buttons===void 0||(h.buttons&m)!==m}(o,this._eventButton)}isValidEndEvent(o){return R.mouseButton(o)===this._eventButton}}class ce{constructor(){this._firstTouch=void 0}_isOneFingerTouch(o){return o.targetTouches.length===1}_isSameTouchEvent(o){return o.targetTouches[0].identifier===this._firstTouch}startMove(o){this._firstTouch=o.targetTouches[0].identifier}endMove(o){delete this._firstTouch}isValidStartEvent(o){return this._isOneFingerTouch(o)}isValidMoveEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}isValidEndEvent(o){return this._isOneFingerTouch(o)&&this._isSameTouchEvent(o)}}const qc=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(o){o.preventDefault()}},Bl=({enable:y,clickTolerance:o,bearingDegreesPerPixelMoved:h=.8})=>{const d=new vs({checkCorrectEvent:m=>R.mouseButton(m)===0&&m.ctrlKey||R.mouseButton(m)===2});return new Fl({clickTolerance:o,move:(m,_)=>({bearingDelta:(_.x-m.x)*h}),moveStateManager:d,enable:y,assignEvents:qc})},Vl=({enable:y,clickTolerance:o,pitchDegreesPerPixelMoved:h=-.5})=>{const d=new vs({checkCorrectEvent:m=>R.mouseButton(m)===0&&m.ctrlKey||R.mouseButton(m)===2});return new Fl({clickTolerance:o,move:(m,_)=>({pitchDelta:(_.y-m.y)*h}),moveStateManager:d,enable:y,assignEvents:qc})};class Rd{constructor(o,h){this._clickTolerance=o.clickTolerance||1,this._map=h,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(o,h,d){return this._calculateTransform(o,h,d)}touchmove(o,h,d){if(this._active&&!(d.length<this.minTouchs()))return o.preventDefault(),this._calculateTransform(o,h,d)}touchend(o,h,d){this._calculateTransform(o,h,d),this._active&&d.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(o,h,d){d.length>0&&(this._active=!0);const m=$a(d,h),_=new c.P(0,0),S=new c.P(0,0);let I=0;for(const M in m){const N=m[M],O=this._touches[M];O&&(_._add(N),S._add(N.sub(O)),I++,m[M]=N)}if(this._touches=m,I<this.minTouchs()||!S.mag())return;const T=S.div(I);return this._sum._add(T),this._sum.mag()<this._clickTolerance?void 0:{around:_.div(I),panDelta:T}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class re{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(o,h,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([h[0],h[1]]))}touchmove(o,h,d){if(!this._firstTwoTouches)return;o.preventDefault();const[m,_]=this._firstTwoTouches,S=Ul(d,h,m),I=Ul(d,h,_);if(!S||!I)return;const T=this._aroundCenter?null:S.add(I).div(2);return this._move([S,I],T,o)}touchend(o,h,d){if(!this._firstTwoTouches)return;const[m,_]=this._firstTwoTouches,S=Ul(d,h,m),I=Ul(d,h,_);S&&I||(this._active&&R.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(o){this._enabled=!0,this._aroundCenter=!!o&&o.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ul(y,o,h){for(let d=0;d<y.length;d++)if(y[d].identifier===h)return o[d]}function Nd(y,o){return Math.log(y/o)/Math.LN2}class Od extends re{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(o){this._startDistance=this._distance=o[0].dist(o[1])}_move(o,h){const d=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(Nd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nd(this._distance,d),pinchAround:h}}}function jc(y,o){return 180*y.angleWith(o)/Math.PI}class Lp extends re{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])}_move(o,h,d){const m=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:jc(this._vector,m),pinchAround:h}}_isBelowThreshold(o){this._minDiameter=Math.min(this._minDiameter,o.mag());const h=25/(Math.PI*this._minDiameter)*360,d=jc(o,this._startVector);return Math.abs(d)<h}}function Wc(y){return Math.abs(y.y)>Math.abs(y.x)}class zd extends re{constructor(o){super(),this._currentTouchCount=0,this._map=o}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(o,h,d){super.touchstart(o,h,d),this._currentTouchCount=d.length}_start(o){this._lastPoints=o,Wc(o[0].sub(o[1]))&&(this._valid=!1)}_move(o,h,d){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=o[0].sub(this._lastPoints[0]),_=o[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,_,d.timeStamp),this._valid?(this._lastPoints=o,this._active=!0,{pitchDelta:(m.y+_.y)/2*-.5}):void 0}gestureBeginsVertically(o,h,d){if(this._valid!==void 0)return this._valid;const m=o.mag()>=2,_=h.mag()>=2;if(!m&&!_)return;if(!m||!_)return this._firstMove===void 0&&(this._firstMove=d),d-this._firstMove<100&&void 0;const S=o.y>0==h.y>0;return Wc(o)&&Wc(h)&&S}}const Fg={panStep:100,bearingStep:15,pitchStep:10};class wa{constructor(o){this._tr=new zl(o);const h=Fg;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(o){if(o.altKey||o.ctrlKey||o.metaKey)return;let h=0,d=0,m=0,_=0,S=0;switch(o.keyCode){case 61:case 107:case 171:case 187:h=1;break;case 189:case 109:case 173:h=-1;break;case 37:o.shiftKey?d=-1:(o.preventDefault(),_=-1);break;case 39:o.shiftKey?d=1:(o.preventDefault(),_=1);break;case 38:o.shiftKey?m=1:(o.preventDefault(),S=-1);break;case 40:o.shiftKey?m=-1:(o.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(d=0,m=0),{cameraAnimation:I=>{const T=this._tr;I.easeTo({duration:300,easeId:"keyboardHandler",easing:Kn,zoom:h?Math.round(T.zoom)+h*(o.shiftKey?2:1):T.zoom,bearing:T.bearing+d*this._bearingStep,pitch:T.pitch+m*this._pitchStep,offset:[-_*this._panStep,-S*this._panStep],center:T.center},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Kn(y){return y*(2-y)}const Mu=4.000244140625;class Zc{constructor(o,h){this._onTimeout=d=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(d)},this._map=o,this._tr=new zl(o),this._triggerRenderFrame=h,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(o){this._defaultZoomRate=o}setWheelZoomRate(o){this._wheelZoomRate=o}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(o){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!o&&o.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(o){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!o[this._map.cooperativeGestures._bypassKey])return;let h=o.deltaMode===WheelEvent.DOM_DELTA_LINE?40*o.deltaY:o.deltaY;const d=P.now(),m=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,h!==0&&h%Mu==0?this._type="wheel":h!==0&&Math.abs(h)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=h,this._timeout=setTimeout(this._onTimeout,40,o)):this._type||(this._type=Math.abs(m*h)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,h+=this._lastValue)),o.shiftKey&&h&&(h/=4),this._type&&(this._lastWheelEvent=o,this._delta-=h,this._active||this._start(o)),o.preventDefault()}_start(o){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const h=R.mousePos(this._map.getCanvas(),o),d=this._tr;this._around=h.y>d.transform.height/2-d.transform.getHorizon()?c.M.convert(this._aroundCenter?d.center:d.unproject(h)):c.M.convert(d.center),this._aroundPoint=d.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const o=this._tr.transform;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>Mu?this._wheelZoomRate:this._defaultZoomRate;let T=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&T!==0&&(T=1/T);const M=typeof this._targetZoom=="number"?o.zoomScale(this._targetZoom):o.scale;this._targetZoom=Math.min(o.maxZoom,Math.max(o.minZoom,o.scaleZoom(M*T))),this._type==="wheel"&&(this._startZoom=o.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const h=typeof this._targetZoom=="number"?this._targetZoom:o.zoom,d=this._startZoom,m=this._easing;let _,S=!1;if(this._type==="wheel"&&d&&m){const I=Math.min((P.now()-this._lastWheelEventTime)/200,1),T=m(I);_=c.z.number(d,h,T),I<1?this._frameId||(this._frameId=!0):S=!0}else _=h,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:_-o.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(o){let h=c.b7;if(this._prevEase){const d=this._prevEase,m=(P.now()-d.start)/d.duration,_=d.easing(m+.01)-d.easing(m),S=.27/Math.sqrt(_*_+1e-4)*.01,I=Math.sqrt(.0729-S*S);h=c.b6(S,I,.25,1)}return this._prevEase={start:P.now(),duration:o,easing:h},h}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Pp{constructor(o,h){this._clickZoom=o,this._tapZoom=h}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Fd{constructor(o){this._tr=new zl(o),this.reset()}reset(){this._active=!1}dblclick(o,h){return o.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:this._tr.zoom+(o.shiftKey?-1:1),around:this._tr.unproject(h)},{originalEvent:o})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Bd{constructor(){this._tap=new Tp({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(o,h,d){if(!this._swipePoint)if(this._tapTime){const m=h[0],_=o.timeStamp-this._tapTime<500,S=this._tapPoint.dist(m)<30;_&&S?d.length>0&&(this._swipePoint=m,this._swipeTouch=d[0].identifier):this.reset()}else this._tap.touchstart(o,h,d)}touchmove(o,h,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const m=h[0],_=m.y-this._swipePoint.y;return this._swipePoint=m,o.preventDefault(),this._active=!0,{zoomDelta:_/128}}}else this._tap.touchmove(o,h,d)}touchend(o,h,d){if(this._tapTime)this._swipePoint&&d.length===0&&this.reset();else{const m=this._tap.touchend(o,h,d);m&&(this._tapTime=o.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vd{constructor(o,h,d){this._el=o,this._mousePan=h,this._touchPan=d}enable(o){this._inertiaOptions=o||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zo{constructor(o,h,d){this._pitchWithRotate=o.pitchWithRotate,this._mouseRotate=h,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Du{constructor(o,h,d,m){this._el=o,this._touchZoom=h,this._touchRotate=d,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(o){this._touchZoom.enable(o),this._rotationDisabled||this._touchRotate.enable(o),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class me{constructor(o,h){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=o,this._options=h,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const o=this._map.getCanvasContainer();o.classList.add("maplibregl-cooperative-gestures"),this._container=R.create("div","maplibregl-cooperative-gesture-screen",o);let h=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(h=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const d=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=h,this._container.appendChild(m);const _=document.createElement("div");_.className="maplibregl-mobile-message",_.textContent=d,this._container.appendChild(_),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(R.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(o){this._onCooperativeGesture(o.touches.length===1)}wheel(o){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!o[this._bypassKey])}_onCooperativeGesture(o){this._enabled&&o&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const we=y=>y.zoom||y.drag||y.pitch||y.rotate;class Hc extends c.k{}function ku(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class Ap{constructor(o,h){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,_)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const S=m.type==="renderFrame"?void 0:m,I={needsRenderFrame:!1},T={},M={},N=m.touches,O=N?this._getMapTouches(N):void 0,U=O?R.touchPos(this._map.getCanvas(),O):R.mousePos(this._map.getCanvas(),m);for(const{handlerName:it,handler:Z,allowed:ht}of this._handlers){if(!Z.isEnabled())continue;let It;this._blockedByActive(M,ht,it)?Z.reset():Z[_||m.type]&&(It=Z[_||m.type](m,U,O),this.mergeHandlerResult(I,T,It,it,S),It&&It.needsRenderFrame&&this._triggerRenderFrame()),(It||Z.isActive())&&(M[it]=Z)}const tt={};for(const it in this._previousActiveHandlers)M[it]||(tt[it]=S);this._previousActiveHandlers=M,(Object.keys(tt).length||ku(I))&&(this._changes.push([I,T,tt]),this._triggerRenderFrame()),(Object.keys(M).length||ku(I))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:$}=I;$&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],$(this._map))},this._map=o,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new kd(o),this._bearingSnap=h.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(h);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,_,S]of this._listeners)R.addEventListener(m,_,m===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[o,h,d]of this._listeners)R.removeEventListener(o,h,o===document?this.handleWindowEvent:this.handleEvent,d)}_addDefaultHandlers(o){const h=this._map,d=h.getCanvasContainer();this._add("mapEvent",new jo(h,o));const m=h.boxZoom=new Wo(h,o);this._add("boxZoom",m),o.interactive&&o.boxZoom&&m.enable();const _=h.cooperativeGestures=new me(h,o.cooperativeGestures);this._add("cooperativeGestures",_),o.cooperativeGestures&&_.enable();const S=new zg(h),I=new Fd(h);h.doubleClickZoom=new Pp(I,S),this._add("tapZoom",S),this._add("clickZoom",I),o.interactive&&o.doubleClickZoom&&h.doubleClickZoom.enable();const T=new Bd;this._add("tapDragZoom",T);const M=h.touchPitch=new zd(h);this._add("touchPitch",M),o.interactive&&o.touchPitch&&h.touchPitch.enable(o.touchPitch);const N=Bl(o),O=Vl(o);h.dragRotate=new Zo(o,N,O),this._add("mouseRotate",N,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]),o.interactive&&o.dragRotate&&h.dragRotate.enable();const U=(({enable:It,clickTolerance:st})=>{const _t=new vs({checkCorrectEvent:Ct=>R.mouseButton(Ct)===0&&!Ct.ctrlKey});return new Fl({clickTolerance:st,move:(Ct,At)=>({around:At,panDelta:At.sub(Ct)}),activateOnStart:!0,moveStateManager:_t,enable:It,assignEvents:qc})})(o),tt=new Rd(o,h);h.dragPan=new Vd(d,U,tt),this._add("mousePan",U),this._add("touchPan",tt,["touchZoom","touchRotate"]),o.interactive&&o.dragPan&&h.dragPan.enable(o.dragPan);const $=new Lp,it=new Od;h.touchZoomRotate=new Du(d,it,$,T),this._add("touchRotate",$,["touchPan","touchZoom"]),this._add("touchZoom",it,["touchPan","touchRotate"]),o.interactive&&o.touchZoomRotate&&h.touchZoomRotate.enable(o.touchZoomRotate);const Z=h.scrollZoom=new Zc(h,()=>this._triggerRenderFrame());this._add("scrollZoom",Z,["mousePan"]),o.interactive&&o.scrollZoom&&h.scrollZoom.enable(o.scrollZoom);const ht=h.keyboard=new wa(h);this._add("keyboard",ht),o.interactive&&o.keyboard&&h.keyboard.enable(),this._add("blockableMapEvent",new _s(h))}_add(o,h,d){this._handlers.push({handlerName:o,handler:h,allowed:d}),this._handlersById[o]=h}stop(o){if(!this._updatingCamera){for(const{handler:h}of this._handlers)h.reset();this._inertia.clear(),this._fireEvents({},{},o),this._changes=[]}}isActive(){for(const{handler:o}of this._handlers)if(o.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!we(this._eventsInProgress)||this.isZooming()}_blockedByActive(o,h,d){for(const m in o)if(m!==d&&(!h||h.indexOf(m)<0))return!0;return!1}_getMapTouches(o){const h=[];for(const d of o)this._el.contains(d.target)&&h.push(d);return h}mergeHandlerResult(o,h,d,m,_){if(!d)return;c.e(o,d);const S={handlerName:m,originalEvent:d.originalEvent||_};d.zoomDelta!==void 0&&(h.zoom=S),d.panDelta!==void 0&&(h.drag=S),d.pitchDelta!==void 0&&(h.pitch=S),d.bearingDelta!==void 0&&(h.rotate=S)}_applyChanges(){const o={},h={},d={};for(const[m,_,S]of this._changes)m.panDelta&&(o.panDelta=(o.panDelta||new c.P(0,0))._add(m.panDelta)),m.zoomDelta&&(o.zoomDelta=(o.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(o.bearingDelta=(o.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(o.pitchDelta=(o.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(o.around=m.around),m.pinchAround!==void 0&&(o.pinchAround=m.pinchAround),m.noInertia&&(o.noInertia=m.noInertia),c.e(h,_),c.e(d,S);this._updateMapTransform(o,h,d),this._changes=[]}_updateMapTransform(o,h,d){const m=this._map,_=m._getTransformForUpdate(),S=m.terrain;if(!(ku(o)||S&&this._terrainMovement))return this._fireEvents(h,d,!0);let{panDelta:I,zoomDelta:T,bearingDelta:M,pitchDelta:N,around:O,pinchAround:U}=o;U!==void 0&&(O=U),m._stop(!0),O=O||m.transform.centerPoint;const tt=_.pointLocation(I?O.sub(I):O);M&&(_.bearing+=M),N&&(_.pitch+=N),T&&(_.zoom+=T),S?this._terrainMovement||!h.drag&&!h.zoom?h.drag&&this._terrainMovement?_.center=_.pointLocation(_.centerPoint.sub(I)):_.setLocationAtPoint(tt,O):(this._terrainMovement=!0,this._map._elevationFreeze=!0,_.setLocationAtPoint(tt,O),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,_.recalculateZoom(m.terrain)})):_.setLocationAtPoint(tt,O),m._applyUpdatedTransform(_),this._map._update(),o.noInertia||this._inertia.record(o),this._fireEvents(h,d,!0)}_fireEvents(o,h,d){const m=we(this._eventsInProgress),_=we(o),S={};for(const N in o){const{originalEvent:O}=o[N];this._eventsInProgress[N]||(S[`${N}start`]=O),this._eventsInProgress[N]=o[N]}!m&&_&&this._fireEvent("movestart",_.originalEvent);for(const N in S)this._fireEvent(N,S[N]);_&&this._fireEvent("move",_.originalEvent);for(const N in o){const{originalEvent:O}=o[N];this._fireEvent(N,O)}const I={};let T;for(const N in this._eventsInProgress){const{handlerName:O,originalEvent:U}=this._eventsInProgress[N];this._handlersById[O].isActive()||(delete this._eventsInProgress[N],T=h[O]||U,I[`${N}end`]=T)}for(const N in I)this._fireEvent(N,I[N]);const M=we(this._eventsInProgress);if(d&&(m||_)&&!M){this._updatingCamera=!0;const N=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),O=U=>U!==0&&-this._bearingSnap<U&&U<this._bearingSnap;!N||!N.essential&&P.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:T})),O(this._map.getBearing())&&this._map.resetNorth()):(O(N.bearing||this._map.getBearing())&&(N.bearing=0),N.freezeElevation=!0,this._map.easeTo(N,{originalEvent:T})),this._updatingCamera=!1}}_fireEvent(o,h){this._map.fire(new c.k(o,h?{originalEvent:h}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(o=>{delete this._frameId,this.handleEvent(new Hc("renderFrame",{timeStamp:o})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class ji extends c.E{constructor(o,h){super(),this._renderFrameCallback=()=>{const d=Math.min((P.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(d)),d<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.M(this.transform.center.lng,this.transform.center.lat)}setCenter(o,h){return this.jumpTo({center:o},h)}panBy(o,h,d){return o=c.P.convert(o).mult(-1),this.panTo(this.transform.center,c.e({offset:o},h),d)}panTo(o,h,d){return this.easeTo(c.e({center:o},h),d)}getZoom(){return this.transform.zoom}setZoom(o,h){return this.jumpTo({zoom:o},h),this}zoomTo(o,h,d){return this.easeTo(c.e({zoom:o},h),d)}zoomIn(o,h){return this.zoomTo(this.getZoom()+1,o,h),this}zoomOut(o,h){return this.zoomTo(this.getZoom()-1,o,h),this}getBearing(){return this.transform.bearing}setBearing(o,h){return this.jumpTo({bearing:o},h),this}getPadding(){return this.transform.padding}setPadding(o,h){return this.jumpTo({padding:o},h),this}rotateTo(o,h,d){return this.easeTo(c.e({bearing:o},h),d)}resetNorth(o,h){return this.rotateTo(0,c.e({duration:1e3},o),h),this}resetNorthPitch(o,h){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},o),h),this}snapToNorth(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this}getPitch(){return this.transform.pitch}setPitch(o,h){return this.jumpTo({pitch:o},h),this}cameraForBounds(o,h){o=yt.convert(o);const d=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),d,h)}_cameraForBoxAndBearing(o,h,d,m){const _={top:0,bottom:0,right:0,left:0};if(typeof(m=c.e({padding:_,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Xt=m.padding;m.padding={top:Xt,bottom:Xt,right:Xt,left:Xt}}m.padding=c.e(_,m.padding);const S=this.transform,I=S.padding,T=new yt(o,h),M=S.project(T.getNorthWest()),N=S.project(T.getNorthEast()),O=S.project(T.getSouthEast()),U=S.project(T.getSouthWest()),tt=c.b8(-d),$=M.rotate(tt),it=N.rotate(tt),Z=O.rotate(tt),ht=U.rotate(tt),It=new c.P(Math.max($.x,it.x,ht.x,Z.x),Math.max($.y,it.y,ht.y,Z.y)),st=new c.P(Math.min($.x,it.x,ht.x,Z.x),Math.min($.y,it.y,ht.y,Z.y)),_t=It.sub(st),Ct=(S.width-(I.left+I.right+m.padding.left+m.padding.right))/_t.x,At=(S.height-(I.top+I.bottom+m.padding.top+m.padding.bottom))/_t.y;if(At<0||Ct<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const kt=Math.min(S.scaleZoom(S.scale*Math.min(Ct,At)),m.maxZoom),Vt=c.P.convert(m.offset),Bt=new c.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(c.b8(d)),Wt=Vt.add(Bt).mult(S.scale/S.zoomScale(kt));return{center:S.unproject(M.add(O).div(2).sub(Wt)),zoom:kt,bearing:d}}fitBounds(o,h,d){return this._fitInternal(this.cameraForBounds(o,h),h,d)}fitScreenCoordinates(o,h,d,m,_){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(o)),this.transform.pointLocation(c.P.convert(h)),d,m),m,_)}_fitInternal(o,h,d){return o?(delete(h=c.e(o,h)).padding,h.linear?this.easeTo(h,d):this.flyTo(h,d)):this}jumpTo(o,h){this.stop();const d=this._getTransformForUpdate();let m=!1,_=!1,S=!1;return"zoom"in o&&d.zoom!==+o.zoom&&(m=!0,d.zoom=+o.zoom),o.center!==void 0&&(d.center=c.M.convert(o.center)),"bearing"in o&&d.bearing!==+o.bearing&&(_=!0,d.bearing=+o.bearing),"pitch"in o&&d.pitch!==+o.pitch&&(S=!0,d.pitch=+o.pitch),o.padding==null||d.isPaddingEqual(o.padding)||(d.padding=o.padding),this._applyUpdatedTransform(d),this.fire(new c.k("movestart",h)).fire(new c.k("move",h)),m&&this.fire(new c.k("zoomstart",h)).fire(new c.k("zoom",h)).fire(new c.k("zoomend",h)),_&&this.fire(new c.k("rotatestart",h)).fire(new c.k("rotate",h)).fire(new c.k("rotateend",h)),S&&this.fire(new c.k("pitchstart",h)).fire(new c.k("pitch",h)).fire(new c.k("pitchend",h)),this.fire(new c.k("moveend",h))}calculateCameraOptionsFromTo(o,h,d,m=0){const _=c.Y.fromLngLat(o,h),S=c.Y.fromLngLat(d,m),I=S.x-_.x,T=S.y-_.y,M=S.z-_.z,N=Math.hypot(I,T,M);if(N===0)throw new Error("Can't calculate camera options with same From and To");const O=Math.hypot(I,T),U=this.transform.scaleZoom(this.transform.cameraToCenterDistance/N/this.transform.tileSize),tt=180*Math.atan2(I,-T)/Math.PI;let $=180*Math.acos(O/N)/Math.PI;return $=M<0?90-$:90+$,{center:S.toLngLat(),zoom:U,pitch:$,bearing:tt}}easeTo(o,h){var d;this._stop(!1,o.easeId),((o=c.e({offset:[0,0],duration:500,easing:c.b7},o)).animate===!1||!o.essential&&P.prefersReducedMotion)&&(o.duration=0);const m=this._getTransformForUpdate(),_=this.getZoom(),S=this.getBearing(),I=this.getPitch(),T=this.getPadding(),M="bearing"in o?this._normalizeBearing(o.bearing,S):S,N="pitch"in o?+o.pitch:I,O="padding"in o?o.padding:m.padding,U=c.P.convert(o.offset);let tt=m.centerPoint.add(U);const $=m.pointLocation(tt),{center:it,zoom:Z}=m.getConstrained(c.M.convert(o.center||$),(d=o.zoom)!==null&&d!==void 0?d:_);this._normalizeCenter(it);const ht=m.project($),It=m.project(it).sub(ht),st=m.zoomScale(Z-_);let _t,Ct;o.around&&(_t=c.M.convert(o.around),Ct=m.locationPoint(_t));const At={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Z!==_,this._rotating=this._rotating||S!==M,this._pitching=this._pitching||N!==I,this._padding=!m.isPaddingEqual(O),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,At),this.terrain&&this._prepareElevation(it),this._ease(kt=>{if(this._zooming&&(m.zoom=c.z.number(_,Z,kt)),this._rotating&&(m.bearing=c.z.number(S,M,kt)),this._pitching&&(m.pitch=c.z.number(I,N,kt)),this._padding&&(m.interpolatePadding(T,O,kt),tt=m.centerPoint.add(U)),this.terrain&&!o.freezeElevation&&this._updateElevation(kt),_t)m.setLocationAtPoint(_t,Ct);else{const Vt=m.zoomScale(m.zoom-_),Bt=Z>_?Math.min(2,st):Math.max(.5,st),Wt=Math.pow(Bt,1-kt),Xt=m.unproject(ht.add(It.mult(kt*Wt)).mult(Vt));m.setLocationAtPoint(m.renderWorldCopies?Xt.wrap():Xt,tt)}this._applyUpdatedTransform(m),this._fireMoveEvents(h)},kt=>{this.terrain&&this._finalizeElevation(),this._afterEase(h,kt)},o),this}_prepareEase(o,h,d={}){this._moving=!0,h||d.moving||this.fire(new c.k("movestart",o)),this._zooming&&!d.zooming&&this.fire(new c.k("zoomstart",o)),this._rotating&&!d.rotating&&this.fire(new c.k("rotatestart",o)),this._pitching&&!d.pitching&&this.fire(new c.k("pitchstart",o))}_prepareElevation(o){this._elevationCenter=o,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(o,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(o){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const h=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(o<1&&h!==this._elevationTarget){const d=this._elevationTarget-this._elevationStart;this._elevationStart+=o*(d-(h-(d*o+this._elevationStart))/(1-o)),this._elevationTarget=h}this.transform.elevation=c.z.number(this._elevationStart,this._elevationTarget,o)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(o){if(!this.transformCameraUpdate)return;const h=o.clone(),{center:d,zoom:m,pitch:_,bearing:S,elevation:I}=this.transformCameraUpdate(h);d&&(h.center=d),m!==void 0&&(h.zoom=m),_!==void 0&&(h.pitch=_),S!==void 0&&(h.bearing=S),I!==void 0&&(h.elevation=I),this.transform.apply(h)}_fireMoveEvents(o){this.fire(new c.k("move",o)),this._zooming&&this.fire(new c.k("zoom",o)),this._rotating&&this.fire(new c.k("rotate",o)),this._pitching&&this.fire(new c.k("pitch",o))}_afterEase(o,h){if(this._easeId&&h&&this._easeId===h)return;delete this._easeId;const d=this._zooming,m=this._rotating,_=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new c.k("zoomend",o)),m&&this.fire(new c.k("rotateend",o)),_&&this.fire(new c.k("pitchend",o)),this.fire(new c.k("moveend",o))}flyTo(o,h){var d;if(!o.essential&&P.prefersReducedMotion){const hn=c.L(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(hn,h)}this.stop(),o=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b7},o);const m=this._getTransformForUpdate(),_=this.getZoom(),S=this.getBearing(),I=this.getPitch(),T=this.getPadding(),M="bearing"in o?this._normalizeBearing(o.bearing,S):S,N="pitch"in o?+o.pitch:I,O="padding"in o?o.padding:m.padding,U=c.P.convert(o.offset);let tt=m.centerPoint.add(U);const $=m.pointLocation(tt),{center:it,zoom:Z}=m.getConstrained(c.M.convert(o.center||$),(d=o.zoom)!==null&&d!==void 0?d:_);this._normalizeCenter(it);const ht=m.zoomScale(Z-_),It=m.project($),st=m.project(it).sub(It);let _t=o.curve;const Ct=Math.max(m.width,m.height),At=Ct/ht,kt=st.mag();if("minZoom"in o){const hn=c.ac(Math.min(o.minZoom,_,Z),m.minZoom,m.maxZoom),Pe=Ct/m.zoomScale(hn-_);_t=Math.sqrt(Pe/kt*2)}const Vt=_t*_t;function Bt(hn){const Pe=(At*At-Ct*Ct+(hn?-1:1)*Vt*Vt*kt*kt)/(2*(hn?At:Ct)*Vt*kt);return Math.log(Math.sqrt(Pe*Pe+1)-Pe)}function Wt(hn){return(Math.exp(hn)-Math.exp(-hn))/2}function Xt(hn){return(Math.exp(hn)+Math.exp(-hn))/2}const Fe=Bt(!1);let Kt=function(hn){return Xt(Fe)/Xt(Fe+_t*hn)},Se=function(hn){return Ct*((Xt(Fe)*(Wt(Pe=Fe+_t*hn)/Xt(Pe))-Wt(Fe))/Vt)/kt;var Pe},Be=(Bt(!0)-Fe)/_t;if(Math.abs(kt)<1e-6||!isFinite(Be)){if(Math.abs(Ct-At)<1e-6)return this.easeTo(o,h);const hn=At<Ct?-1:1;Be=Math.abs(Math.log(At/Ct))/_t,Se=function(){return 0},Kt=function(Pe){return Math.exp(hn*_t*Pe)}}return o.duration="duration"in o?+o.duration:1e3*Be/("screenSpeed"in o?+o.screenSpeed/_t:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=S!==M,this._pitching=N!==I,this._padding=!m.isPaddingEqual(O),this._prepareEase(h,!1),this.terrain&&this._prepareElevation(it),this._ease(hn=>{const Pe=hn*Be,qe=1/Kt(Pe);m.zoom=hn===1?Z:_+m.scaleZoom(qe),this._rotating&&(m.bearing=c.z.number(S,M,hn)),this._pitching&&(m.pitch=c.z.number(I,N,hn)),this._padding&&(m.interpolatePadding(T,O,hn),tt=m.centerPoint.add(U)),this.terrain&&!o.freezeElevation&&this._updateElevation(hn);const Xe=hn===1?it:m.unproject(It.add(st.mult(Se(Pe))).mult(qe));m.setLocationAtPoint(m.renderWorldCopies?Xe.wrap():Xe,tt),this._applyUpdatedTransform(m),this._fireMoveEvents(h)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(h)},o),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const d=this._onEaseEnd;delete this._onEaseEnd,d.call(this,h)}if(!o){const d=this.handlers;d&&d.stop(!1)}return this}_ease(o,h,d){d.animate===!1||d.duration===0?(o(1),h()):(this._easeStart=P.now(),this._easeOptions=d,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(o,h){o=c.b1(o,-180,180);const d=Math.abs(o-h);return Math.abs(o-360-h)<d&&(o-=360),Math.abs(o+360-h)<d&&(o+=360),o}_normalizeCenter(o){const h=this.transform;if(!h.renderWorldCopies||h.lngRange)return;const d=o.lng-h.center.lng;o.lng+=d>180?-360:d<-180?360:0}queryTerrainElevation(o){return this.terrain?this.terrain.getElevationForLngLatZoom(c.M.convert(o),this.transform.tileZoom)-this.transform.elevation:null}}const Mp={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Ho{constructor(o=Mp){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=h=>{!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"&&h.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=o}getDefaultPosition(){return"bottom-right"}onAdd(o){return this._map=o,this._compact=this.options.compact,this._container=R.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=R.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=R.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){R.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(o,h){const d=this._map._getUIString(`AttributionControl.${h}`);o.title=d,o.setAttribute("aria-label",d)}_updateAttributions(){if(!this._map.style)return;let o=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?o=o.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&o.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const h=this._map.style.sourceCaches;for(const m in h){const _=h[m];if(_.used||_.usedForTerrain){const S=_.getSource();S.attribution&&o.indexOf(S.attribution)<0&&o.push(S.attribution)}}o=o.filter(m=>String(m).trim()),o.sort((m,_)=>m.length-_.length),o=o.filter((m,_)=>{for(let S=_+1;S<o.length;S++)if(o[S].indexOf(m)>=0)return!1;return!0});const d=o.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,o.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Ud{constructor(o={}){this._updateCompact=()=>{const h=this._container.children;if(h.length){const d=h[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&d.classList.add("maplibregl-compact"):d.classList.remove("maplibregl-compact")}},this.options=o}getDefaultPosition(){return"bottom-left"}onAdd(o){this._map=o,this._compact=this.options&&this.options.compact,this._container=R.create("div","maplibregl-ctrl");const h=R.create("a","maplibregl-ctrl-logo");return h.target="_blank",h.rel="noopener nofollow",h.href="https://maplibre.org/",h.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),h.setAttribute("rel","noopener nofollow"),this._container.appendChild(h),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){R.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Ru{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(o){const h=++this._id;return this._queue.push({callback:o,id:h,cancelled:!1}),h}remove(o){const h=this._currentlyRunning,d=h?this._queue.concat(h):this._queue;for(const m of d)if(m.id===o)return void(m.cancelled=!0)}run(o=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const h=this._currentlyRunning=this._queue;this._queue=[];for(const d of h)if(!d.cancelled&&(d.callback(o),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var hr=c.X([{name:"a_pos3d",type:"Int16",components:3}]);class Ir extends c.E{constructor(o){super(),this.sourceCache=o,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,o.usedForTerrain=!0,o.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(o,h){this.sourceCache.update(o,h),this._renderableTilesKeys=[];const d={};for(const m of o.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:h}))d[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),c.aN(m.posMatrix,0,c.W,0,c.W,0,1),this._tiles[m.key]=new fs(m,this.tileSize));for(const m in this._tiles)d[m]||delete this._tiles[m]}freeRtt(o){for(const h in this._tiles){const d=this._tiles[h];(!o||d.tileID.equals(o)||d.tileID.isChildOf(o)||o.isChildOf(d.tileID))&&(d.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(o=>this.getTileByID(o))}getTileByID(o){return this._tiles[o]}getTerrainCoords(o){const h={};for(const d of this._renderableTilesKeys){const m=this._tiles[d].tileID;if(m.canonical.equals(o.canonical)){const _=o.clone();_.posMatrix=new Float64Array(16),c.aN(_.posMatrix,0,c.W,0,c.W,0,1),h[d]=_}else if(m.canonical.isChildOf(o.canonical)){const _=o.clone();_.posMatrix=new Float64Array(16);const S=m.canonical.z-o.canonical.z,I=m.canonical.x-(m.canonical.x>>S<<S),T=m.canonical.y-(m.canonical.y>>S<<S),M=c.W>>S;c.aN(_.posMatrix,0,M,0,M,0,1),c.H(_.posMatrix,_.posMatrix,[-I*M,-T*M,0]),h[d]=_}else if(o.canonical.isChildOf(m.canonical)){const _=o.clone();_.posMatrix=new Float64Array(16);const S=o.canonical.z-m.canonical.z,I=o.canonical.x-(o.canonical.x>>S<<S),T=o.canonical.y-(o.canonical.y>>S<<S),M=c.W>>S;c.aN(_.posMatrix,0,c.W,0,c.W,0,1),c.H(_.posMatrix,_.posMatrix,[I*M,T*M,0]),c.J(_.posMatrix,_.posMatrix,[1/2**S,1/2**S,0]),h[d]=_}}return h}getSourceTile(o,h){const d=this.sourceCache._source;let m=o.overscaledZ-this.deltaZoom;if(m>d.maxzoom&&(m=d.maxzoom),m<d.minzoom)return null;this._sourceTileCache[o.key]||(this._sourceTileCache[o.key]=o.scaledTo(m).key);let _=this.sourceCache.getTileByID(this._sourceTileCache[o.key]);if((!_||!_.dem)&&h)for(;m>=d.minzoom&&(!_||!_.dem);)_=this.sourceCache.getTileByID(o.scaledTo(m--).key);return _}tilesAfterTime(o=Date.now()){return Object.values(this._tiles).filter(h=>h.timeAdded>=o)}}class Gd{constructor(o,h,d){this.painter=o,this.sourceCache=new Ir(h),this.options=d,this.exaggeration=typeof d.exaggeration=="number"?d.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(o,h,d,m=c.W){var _;if(!(h>=0&&h<m&&d>=0&&d<m))return 0;const S=this.getTerrainData(o),I=(_=S.tile)===null||_===void 0?void 0:_.dem;if(!I)return 0;const T=function($,it,Z){var ht=it[0],It=it[1];return $[0]=Z[0]*ht+Z[4]*It+Z[12],$[1]=Z[1]*ht+Z[5]*It+Z[13],$}([],[h/m*c.W,d/m*c.W],S.u_terrain_matrix),M=[T[0]*I.dim,T[1]*I.dim],N=Math.floor(M[0]),O=Math.floor(M[1]),U=M[0]-N,tt=M[1]-O;return I.get(N,O)*(1-U)*(1-tt)+I.get(N+1,O)*U*(1-tt)+I.get(N,O+1)*(1-U)*tt+I.get(N+1,O+1)*U*tt}getElevationForLngLatZoom(o,h){const{tileID:d,mercatorX:m,mercatorY:_}=this._getOverscaledTileIDFromLngLatZoom(o,h);return this.getElevation(d,m%c.W,_%c.W,c.W)}getElevation(o,h,d,m=c.W){return this.getDEMElevation(o,h,d,m)*this.exaggeration}getTerrainData(o){if(!this._emptyDemTexture){const m=this.painter.context,_=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Q(m,_,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Q(m,new c.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const h=this.sourceCache.getSourceTile(o,!0);if(h&&h.dem&&(!h.demTexture||h.needsTerrainPrepare)){const m=this.painter.context;h.demTexture=this.painter.getTileTexture(h.dem.stride),h.demTexture?h.demTexture.update(h.dem.getPixels(),{premultiply:!1}):h.demTexture=new Q(m,h.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),h.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),h.needsTerrainPrepare=!1}const d=h&&h+h.tileID.key+o.key;if(d&&!this._demMatrixCache[d]){const m=this.sourceCache.sourceCache._source.maxzoom;let _=o.canonical.z-h.tileID.canonical.z;o.overscaledZ>o.canonical.z&&(o.canonical.z>=m?_=o.canonical.z-m:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=o.canonical.x-(o.canonical.x>>_<<_),I=o.canonical.y-(o.canonical.y>>_<<_),T=c.b9(new Float64Array(16),[1/(c.W<<_),1/(c.W<<_),0]);c.H(T,T,[S*c.W,I*c.W,0]),this._demMatrixCache[o.key]={matrix:T,coord:o}}return{u_depth:2,u_terrain:3,u_terrain_dim:h&&h.dem&&h.dem.dim||1,u_terrain_matrix:d?this._demMatrixCache[o.key].matrix:this._emptyDemMatrix,u_terrain_unpack:h&&h.dem&&h.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(h&&h.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:h}}getFramebuffer(o){const h=this.painter,d=h.width/devicePixelRatio,m=h.height/devicePixelRatio;return!this._fbo||this._fbo.width===d&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Q(h.context,{width:d,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Q(h.context,{width:d,height:m,data:null},h.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(h.context.gl.NEAREST,h.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=h.context.createFramebuffer(d,m,!0,!1),this._fbo.depthAttachment.set(h.context.createRenderbuffer(h.context.gl.DEPTH_COMPONENT16,d,m))),this._fbo.colorAttachment.set(o==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const o=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const h=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let _=0,S=0;_<this._coordsTextureSize;_++)for(let I=0;I<this._coordsTextureSize;I++,S+=4)h[S+0]=255&I,h[S+1]=255&_,h[S+2]=I>>8<<4|_>>8,h[S+3]=0;const d=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(h.buffer)),m=new Q(o,d,o.gl.RGBA,{premultiply:!1});return m.bind(o.gl.NEAREST,o.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(o){this.painter.maybeDrawDepthAndCoords(!0);const h=new Uint8Array(4),d=this.painter.context,m=d.gl,_=Math.round(o.x*this.painter.pixelRatio/devicePixelRatio),S=Math.round(o.y*this.painter.pixelRatio/devicePixelRatio),I=Math.round(this.painter.height/devicePixelRatio);d.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(_,I-S-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),d.bindFramebuffer.set(null);const T=h[0]+(h[2]>>4<<8),M=h[1]+((15&h[2])<<8),N=this.coordsIndex[255-h[3]],O=N&&this.sourceCache.getTileByID(N);if(!O)return null;const U=this._coordsTextureSize,tt=(1<<O.tileID.canonical.z)*U;return new c.Y((O.tileID.canonical.x*U+T)/tt+O.tileID.wrap,(O.tileID.canonical.y*U+M)/tt,this.getElevation(O.tileID,T,M,U))}depthAtPoint(o){const h=new Uint8Array(4),d=this.painter.context,m=d.gl;return d.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(o.x,this.painter.height/devicePixelRatio-o.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,h),d.bindFramebuffer.set(null),(h[0]/16777216+h[1]/65536+h[2]/256+h[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const o=this.painter.context,h=new c.ba,d=new c.aX,m=this.meshSize,_=c.W/m,S=m*m;for(let O=0;O<=m;O++)for(let U=0;U<=m;U++)h.emplaceBack(U*_,O*_,0);for(let O=0;O<S;O+=m+1)for(let U=0;U<m;U++)d.emplaceBack(U+O,m+U+O+1,m+U+O+2),d.emplaceBack(U+O,m+U+O+2,U+O+1);const I=h.length,T=I+2*(m+1);for(const O of[0,1])for(let U=0;U<=m;U++)for(const tt of[0,1])h.emplaceBack(U*_,O*c.W,tt);for(let O=0;O<2*m;O+=2)d.emplaceBack(T+O,T+O+1,T+O+3),d.emplaceBack(T+O,T+O+3,T+O+2),d.emplaceBack(I+O,I+O+3,I+O+1),d.emplaceBack(I+O,I+O+2,I+O+3);const M=h.length,N=M+2*(m+1);for(const O of[0,1])for(let U=0;U<=m;U++)for(const tt of[0,1])h.emplaceBack(O*c.W,U*_,tt);for(let O=0;O<2*m;O+=2)d.emplaceBack(M+O,M+O+1,M+O+3),d.emplaceBack(M+O,M+O+3,M+O+2),d.emplaceBack(N+O,N+O+3,N+O+1),d.emplaceBack(N+O,N+O+2,N+O+3);return this._mesh={indexBuffer:o.createIndexBuffer(d),vertexBuffer:o.createVertexBuffer(h,hr.members),segments:c.$.simpleSegment(0,0,h.length,d.length)},this._mesh}getMeshFrameDelta(o){return 2*Math.PI*c.bb/Math.pow(2,o)/5}getMinTileElevationForLngLatZoom(o,h){var d;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(o,h);return(d=this.getMinMaxElevation(m).minElevation)!==null&&d!==void 0?d:0}getMinMaxElevation(o){const h=this.getTerrainData(o).tile,d={minElevation:null,maxElevation:null};return h&&h.dem&&(d.minElevation=h.dem.min*this.exaggeration,d.maxElevation=h.dem.max*this.exaggeration),d}_getOverscaledTileIDFromLngLatZoom(o,h){const d=c.Y.fromLngLat(o.wrap()),m=(1<<h)*c.W,_=d.x*m,S=d.y*m,I=Math.floor(_/c.W),T=Math.floor(S/c.W);return{tileID:new c.Q(h,0,h,I,T),mercatorX:_,mercatorY:S}}}class Nu{constructor(o,h,d){this._context=o,this._size=h,this._tileSize=d,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const o of this._objects)o.texture.destroy(),o.fbo.destroy()}_createObject(o){const h=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),d=new Q(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return d.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),h.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),h.colorAttachment.set(d.texture),{id:o,fbo:h,texture:d,stamp:-1,inUse:!1}}getObjectForId(o){return this._objects[o]}useObject(o){o.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(h=>o.id!==h),this._recentlyUsed.push(o.id)}stampObject(o){o.stamp=++this._stamp}getOrCreateFreeObject(){for(const h of this._recentlyUsed)if(!this._objects[h].inUse)return this._objects[h];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const o=this._createObject(this._objects.length);return this._objects.push(o),o}freeObject(o){o.inUse=!1}freeAllObjects(){for(const o of this._objects)this.freeObject(o)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(o=>!o.inUse)===!1}}const Zs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Dp{constructor(o,h){this.painter=o,this.terrain=h,this.pool=new Nu(o.context,30,h.sourceCache.tileSize*h.qualityFactor)}destruct(){this.pool.destruct()}getTexture(o){return this.pool.getObjectForId(o.rtt[this._stacks.length-1].id).texture}prepareForRender(o,h){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=o._order.filter(d=>!o._layers[d].isHidden(h)),this._coordsDescendingInv={};for(const d in o.sourceCaches){this._coordsDescendingInv[d]={};const m=o.sourceCaches[d].getVisibleCoordinates();for(const _ of m){const S=this.terrain.sourceCache.getTerrainCoords(_);for(const I in S)this._coordsDescendingInv[d][I]||(this._coordsDescendingInv[d][I]=[]),this._coordsDescendingInv[d][I].push(S[I])}}this._coordsDescendingInvStr={};for(const d of o._order){const m=o._layers[d],_=m.source;if(Zs[m.type]&&!this._coordsDescendingInvStr[_]){this._coordsDescendingInvStr[_]={};for(const S in this._coordsDescendingInv[_])this._coordsDescendingInvStr[_][S]=this._coordsDescendingInv[_][S].map(I=>I.key).sort().join()}}for(const d of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const _=this._coordsDescendingInvStr[m][d.tileID.key];_&&_!==d.rttCoords[m]&&(d.rtt=[])}}renderLayer(o){if(o.isHidden(this.painter.transform.zoom))return!1;const h=o.type,d=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===o.id;if(Zs[h]&&(this._prevType&&Zs[this._prevType]||this._stacks.push([]),this._prevType=h,this._stacks[this._stacks.length-1].push(o.id),!m))return!0;if(Zs[this._prevType]||Zs[h]&&m){this._prevType=h;const _=this._stacks.length-1,S=this._stacks[_]||[];for(const I of this._renderableTiles){if(this.pool.isFull()&&(Uc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(I),I.rtt[_]){const M=this.pool.getObjectForId(I.rtt[_].id);if(M.stamp===I.rtt[_].stamp){this.pool.useObject(M);continue}}const T=this.pool.getOrCreateFreeObject();this.pool.useObject(T),this.pool.stampObject(T),I.rtt[_]={id:T.id,stamp:T.stamp},d.context.bindFramebuffer.set(T.fbo.framebuffer),d.context.clear({color:c.aO.transparent,stencil:0}),d.currentStencilSource=void 0;for(let M=0;M<S.length;M++){const N=d.style._layers[S[M]],O=N.source?this._coordsDescendingInv[N.source][I.tileID.key]:[I.tileID];d.context.viewport.set([0,0,T.fbo.width,T.fbo.height]),d._renderTileClippingMasks(N,O),d.renderLayer(d,d.style.sourceCaches[N.source],N,O),N.source&&(I.rttCoords[N.source]=this._coordsDescendingInvStr[N.source][I.tileID.key])}}return Uc(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),Zs[h]}return!1}}const kp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Rp=b,Ou={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Mp,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Xc=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Np={showCompass:!0,showZoom:!0,visualizePitch:!1};class Op{constructor(o,h,d=!1){this.mousedown=S=>{this.startMouse(c.e({},S,{ctrlKey:!0,preventDefault:()=>S.preventDefault()}),R.mousePos(this.element,S)),R.addEventListener(window,"mousemove",this.mousemove),R.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=S=>{this.moveMouse(S,R.mousePos(this.element,S))},this.mouseup=S=>{this.mouseRotate.dragEnd(S),this.mousePitch&&this.mousePitch.dragEnd(S),this.offTemp()},this.touchstart=S=>{S.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=R.touchPos(this.element,S.targetTouches)[0],this.startTouch(S,this._startPos),R.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.addEventListener(window,"touchend",this.touchend))},this.touchmove=S=>{S.targetTouches.length!==1?this.reset():(this._lastPos=R.touchPos(this.element,S.targetTouches)[0],this.moveTouch(S,this._lastPos))},this.touchend=S=>{S.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=o.dragRotate._mouseRotate.getClickTolerance(),_=o.dragRotate._mousePitch.getClickTolerance();this.element=h,this.mouseRotate=Bl({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:I,bearingDegreesPerPixelMoved:T=.8})=>{const M=new ce;return new Fl({clickTolerance:I,move:(N,O)=>({bearingDelta:(O.x-N.x)*T}),moveStateManager:M,enable:S,assignEvents:Xc})})({clickTolerance:m,enable:!0}),this.map=o,d&&(this.mousePitch=Vl({clickTolerance:_,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:I,pitchDegreesPerPixelMoved:T=-.5})=>{const M=new ce;return new Fl({clickTolerance:I,move:(N,O)=>({pitchDelta:(O.y-N.y)*T}),moveStateManager:M,enable:S,assignEvents:Xc})})({clickTolerance:_,enable:!0})),R.addEventListener(h,"mousedown",this.mousedown),R.addEventListener(h,"touchstart",this.touchstart,{passive:!1}),R.addEventListener(h,"touchcancel",this.reset)}startMouse(o,h){this.mouseRotate.dragStart(o,h),this.mousePitch&&this.mousePitch.dragStart(o,h),R.disableDrag()}startTouch(o,h){this.touchRotate.dragStart(o,h),this.touchPitch&&this.touchPitch.dragStart(o,h),R.disableDrag()}moveMouse(o,h){const d=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(o,h)||{};if(m&&d.setBearing(d.getBearing()+m),this.mousePitch){const{pitchDelta:_}=this.mousePitch.dragMove(o,h)||{};_&&d.setPitch(d.getPitch()+_)}}moveTouch(o,h){const d=this.map,{bearingDelta:m}=this.touchRotate.dragMove(o,h)||{};if(m&&d.setBearing(d.getBearing()+m),this.touchPitch){const{pitchDelta:_}=this.touchPitch.dragMove(o,h)||{};_&&d.setPitch(d.getPitch()+_)}}off(){const o=this.element;R.removeEventListener(o,"mousedown",this.mousedown),R.removeEventListener(o,"touchstart",this.touchstart,{passive:!1}),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend),R.removeEventListener(o,"touchcancel",this.reset),this.offTemp()}offTemp(){R.enableDrag(),R.removeEventListener(window,"mousemove",this.mousemove),R.removeEventListener(window,"mouseup",this.mouseup),R.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),R.removeEventListener(window,"touchend",this.touchend)}}let Hs;function Yc(y,o,h){const d=new c.M(y.lng,y.lat);if(y=new c.M(y.lng,y.lat),o){const m=new c.M(y.lng-360,y.lat),_=new c.M(y.lng+360,y.lat),S=h.locationPoint(y).distSqr(o);h.locationPoint(m).distSqr(o)<S?y=m:h.locationPoint(_).distSqr(o)<S&&(y=_)}for(;Math.abs(y.lng-h.center.lng)>180;){const m=h.locationPoint(y);if(m.x>=0&&m.y>=0&&m.x<=h.width&&m.y<=h.height)break;y.lng>h.center.lng?y.lng-=360:y.lng+=360}return y.lng!==d.lng&&h.locationPoint(y).y>h.height/2-h.getHorizon()?y:d}const zu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Kc(y,o,h){const d=y.classList;for(const m in zu)d.remove(`maplibregl-${h}-anchor-${m}`);d.add(`maplibregl-${h}-anchor-${o}`)}class Fu extends c.E{constructor(o){if(super(),this._onKeyPress=h=>{const d=h.code,m=h.charCode||h.keyCode;d!=="Space"&&d!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=h=>{const d=h.originalEvent.target,m=this._element;this._popup&&(d===m||m.contains(d))&&this.togglePopup()},this._update=h=>{var d;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((h==null?void 0:h.type)==="terrain"||(h==null?void 0:h.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Yc(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let _="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?_=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(_=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S=`rotateX(${this._map.getPitch()}deg)`),h&&h.type!=="moveend"||(this._pos=this._pos.round()),R.setTransform(this._element,`${zu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${S} ${_}`),P.frameAsync(new AbortController).then(()=>{this._updateOpacity(h&&h.type==="moveend")}).catch(()=>{})},this._onMove=h=>{if(!this._isDragging){const d=this._clickTolerance||this._map._clickTolerance;this._isDragging=h.point.dist(this._pointerdownPos)>=d}this._isDragging&&(this._pos=h.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=h=>{this._element.contains(h.originalEvent.target)&&(h.preventDefault(),this._positionDelta=h.point.sub(this._pos).add(this._offset),this._pointerdownPos=h.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(o==null?void 0:o.opacity,o==null?void 0:o.opacityWhenCovered),o&&o.element)this._element=o.element,this._offset=c.P.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=R.create("div"),this._element.setAttribute("aria-label","Map marker");const h=R.createNS("http://www.w3.org/2000/svg","svg"),d=41,m=27;h.setAttributeNS(null,"display","block"),h.setAttributeNS(null,"height",`${d}px`),h.setAttributeNS(null,"width",`${m}px`),h.setAttributeNS(null,"viewBox",`0 0 ${m} ${d}`);const _=R.createNS("http://www.w3.org/2000/svg","g");_.setAttributeNS(null,"stroke","none"),_.setAttributeNS(null,"stroke-width","1"),_.setAttributeNS(null,"fill","none"),_.setAttributeNS(null,"fill-rule","evenodd");const S=R.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const I=R.createNS("http://www.w3.org/2000/svg","g");I.setAttributeNS(null,"transform","translate(3.0, 29.0)"),I.setAttributeNS(null,"fill","#000000");const T=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ht of T){const It=R.createNS("http://www.w3.org/2000/svg","ellipse");It.setAttributeNS(null,"opacity","0.04"),It.setAttributeNS(null,"cx","10.5"),It.setAttributeNS(null,"cy","5.80029008"),It.setAttributeNS(null,"rx",ht.rx),It.setAttributeNS(null,"ry",ht.ry),I.appendChild(It)}const M=R.createNS("http://www.w3.org/2000/svg","g");M.setAttributeNS(null,"fill",this._color);const N=R.createNS("http://www.w3.org/2000/svg","path");N.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),M.appendChild(N);const O=R.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"opacity","0.25"),O.setAttributeNS(null,"fill","#000000");const U=R.createNS("http://www.w3.org/2000/svg","path");U.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),O.appendChild(U);const tt=R.createNS("http://www.w3.org/2000/svg","g");tt.setAttributeNS(null,"transform","translate(6.0, 7.0)"),tt.setAttributeNS(null,"fill","#FFFFFF");const $=R.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(8.0, 8.0)");const it=R.createNS("http://www.w3.org/2000/svg","circle");it.setAttributeNS(null,"fill","#000000"),it.setAttributeNS(null,"opacity","0.25"),it.setAttributeNS(null,"cx","5.5"),it.setAttributeNS(null,"cy","5.5"),it.setAttributeNS(null,"r","5.4999962");const Z=R.createNS("http://www.w3.org/2000/svg","circle");Z.setAttributeNS(null,"fill","#FFFFFF"),Z.setAttributeNS(null,"cx","5.5"),Z.setAttributeNS(null,"cy","5.5"),Z.setAttributeNS(null,"r","5.4999962"),$.appendChild(it),$.appendChild(Z),S.appendChild(I),S.appendChild(M),S.appendChild(O),S.appendChild(tt),S.appendChild($),h.appendChild(S),h.setAttributeNS(null,"height",d*this._scale+"px"),h.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(h),this._offset=c.P.convert(o&&o.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",h=>{h.preventDefault()}),this._element.addEventListener("mousedown",h=>{h.preventDefault()}),Kc(this._element,this._anchor,"marker"),o&&o.className)for(const h of o.className.split(" "))this._element.classList.add(h);this._popup=null}addTo(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),o.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),R.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(o){return this._lngLat=c.M.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){const m=Math.abs(13.5)/Math.SQRT2;o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=o,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const o=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:o?(o.isOpen()?o.remove():(o.setLngLat(this._lngLat),o.addTo(this._map)),this):this}_updateOpacity(o=!1){var h,d;if(!(!((h=this._map)===null||h===void 0)&&h.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(o)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,_=m.terrain.depthAtPoint(this._pos),S=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,S)-_<.006)return void(this._element.style.opacity=this._opacity);const I=-this._offset.y/m.transform._pixelPerMeter,T=Math.sin(m.getPitch()*Math.PI/180)*I,M=m.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),N=m.transform.lngLatToCameraDepth(this._lngLat,S+T)-M>.006;!((d=this._popup)===null||d===void 0)&&d.isOpen()&&N&&this._popup.remove(),this._element.style.opacity=N?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(o){return this._offset=c.P.convert(o),this._update(),this}addClassName(o){this._element.classList.add(o)}removeClassName(o){this._element.classList.remove(o)}toggleClassName(o){return this._element.classList.toggle(o)}setDraggable(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(o){return this._rotation=o||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(o){return this._rotationAlignment=o||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(o,h){return o===void 0&&h===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),o!==void 0&&(this._opacity=o),h!==void 0&&(this._opacityWhenCovered=h),this._map&&this._updateOpacity(!0),this}}const Jc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Gl=0,tl=!1;const Qc={maxWidth:100,unit:"metric"};function $c(y,o,h){const d=h&&h.maxWidth||100,m=y._container.clientHeight/2,_=y.unproject([0,m]),S=y.unproject([d,m]),I=_.distanceTo(S);if(h&&h.unit==="imperial"){const T=3.2808*I;T>5280?el(o,d,T/5280,y._getUIString("ScaleControl.Miles")):el(o,d,T,y._getUIString("ScaleControl.Feet"))}else h&&h.unit==="nautical"?el(o,d,I/1852,y._getUIString("ScaleControl.NauticalMiles")):I>=1e3?el(o,d,I/1e3,y._getUIString("ScaleControl.Kilometers")):el(o,d,I,y._getUIString("ScaleControl.Meters"))}function el(y,o,h,d){const m=function(_){const S=Math.pow(10,`${Math.floor(_)}`.length-1);let I=_/S;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:function(T){const M=Math.pow(10,Math.ceil(-Math.log(T)/Math.LN10));return Math.round(T*M)/M}(I),S*I}(h);y.style.width=o*(m/h)+"px",y.innerHTML=`${m}&nbsp;${d}`}const zp={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Fp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function th(y){if(y){if(typeof y=="number"){const o=Math.round(Math.abs(y)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,y),"top-left":new c.P(o,o),"top-right":new c.P(-o,o),bottom:new c.P(0,-y),"bottom-left":new c.P(o,-o),"bottom-right":new c.P(-o,-o),left:new c.P(y,0),right:new c.P(-y,0)}}if(y instanceof c.P||Array.isArray(y)){const o=c.P.convert(y);return{center:o,top:o,"top-left":o,"top-right":o,bottom:o,"bottom-left":o,"bottom-right":o,left:o,right:o}}return{center:c.P.convert(y.center||[0,0]),top:c.P.convert(y.top||[0,0]),"top-left":c.P.convert(y["top-left"]||[0,0]),"top-right":c.P.convert(y["top-right"]||[0,0]),bottom:c.P.convert(y.bottom||[0,0]),"bottom-left":c.P.convert(y["bottom-left"]||[0,0]),"bottom-right":c.P.convert(y["bottom-right"]||[0,0]),left:c.P.convert(y.left||[0,0]),right:c.P.convert(y.right||[0,0])}}return th(new c.P(0,0))}const qd=b;p.AJAXError=c.be,p.Evented=c.E,p.LngLat=c.M,p.MercatorCoordinate=c.Y,p.Point=c.P,p.addProtocol=c.bf,p.config=c.a,p.removeProtocol=c.bg,p.AttributionControl=Ho,p.BoxZoomHandler=Wo,p.CanvasSource=Tl,p.CooperativeGesturesHandler=me,p.DoubleClickZoomHandler=Pp,p.DragPanHandler=Vd,p.DragRotateHandler=Zo,p.EdgeInsets=Ol,p.FullscreenControl=class extends c.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var o;let h=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((o=h==null?void 0:h.shadowRoot)===null||o===void 0)&&o.fullscreenElement;)h=h.shadowRoot.fullscreenElement;h===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){R.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=R.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);R.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},p.GeoJSONSource=qo,p.GeolocateControl=class extends c.E{constructor(y){super(),this._onSuccess=o=>{if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",o)),this._finish()}},this._updateCamera=o=>{const h=new c.M(o.coords.longitude,o.coords.latitude),d=o.coords.accuracy,m=this._map.getBearing(),_=c.e({bearing:m},this.options.fitBoundsOptions),S=yt.fromLngLat(h,d);this._map.fitBounds(S,_,{geolocateSource:!0})},this._updateMarker=o=>{if(o){const h=new c.M(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=o=>{if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&tl)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",o)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=o=>{if(this._map){if(this._container.addEventListener("contextmenu",h=>h.preventDefault()),this._geolocateButton=R.create("button","maplibregl-ctrl-geolocate",this._container),R.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",o===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}else{const h=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=R.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Fu({element:this._dotElement}),this._circleElement=R.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",h=>{h.geolocateSource||this._watchState!=="ACTIVE_LOCK"||h.originalEvent&&h.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")))})}},this.options=c.e({},Jc,y)}onAdd(y){return this._map=y,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return c._(this,arguments,void 0,function*(o=!1){if(Hs!==void 0&&!o)return Hs;if(window.navigator.permissions===void 0)return Hs=!!window.navigator.geolocation,Hs;try{Hs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Hs=!!window.navigator.geolocation}return Hs})}().then(o=>this._setupUI(o)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),R.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Gl=0,tl=!1}_isOutOfMapMaxBounds(y){const o=this._map.getMaxBounds(),h=y.coords;return o&&(h.longitude<o.getWest()||h.longitude>o.getEast()||h.latitude<o.getSouth()||h.latitude>o.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),o=y.getSouthEast(),h=y.getNorthEast(),d=o.distanceTo(h),m=Math.ceil(this._accuracy/(d/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Gl--,tl=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Gl++,Gl>1?(y={maximumAge:6e5,timeout:0},tl=!0):(y=this.options.positionOptions,tl=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},p.Hash=Ep,p.ImageSource=zr,p.KeyboardHandler=wa,p.LngLatBounds=yt,p.LogoControl=Ud,p.Map=class extends ji{constructor(y){if(c.bc.mark(c.bd.create),(y=c.e({},Ou,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Gc(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=o=>{o.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:o}))},this._contextRestored=o=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:o}))},this._onMapScroll=o=>{if(o.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Ru,this._controls=[],this._mapId=c.a3(),this._locale=c.e({},kp,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=W.addThrottleControl(()=>this.isMoving()),this._requestManager=new at(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let o=!1;const h=Ip(d=>{this._trackResize&&!this._removed&&this.resize(d)._update()},50);this._resizeObserver=new ResizeObserver(d=>{o?h(d):o=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ap(this,y),this._hash=y.hash&&new Ep(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,c.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new Ho(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new Ud,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new c.k(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new c.k(`${o.dataType}dataloading`,o))}),this.on("dataabort",o=>{this.fire(new c.k("sourcedataabort",o))})}_getMapId(){return this._mapId}addControl(y,o){if(o===void 0&&(o=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const h=y.onAdd(this);this._controls.push(y);const d=this._controlPositions[o];return o.indexOf("bottom")!==-1?d.insertBefore(h,d.firstChild):d.appendChild(h),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const o=this._controls.indexOf(y);return o>-1&&this._controls.splice(o,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,o,h,d){return d==null&&this.terrain&&(d=this.terrain.getElevationForLngLatZoom(h,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,o,h,d)}resize(y){var o;const h=this._containerDimensions(),d=h[0],m=h[1],_=this._getClampedPixelRatio(d,m);if(this._resizeCanvas(d,m,_),this.painter.resize(d,m,_),this.painter.overLimit()){const I=this.painter.context.gl;this._maxCanvasSize=[I.drawingBufferWidth,I.drawingBufferHeight];const T=this._getClampedPixelRatio(d,m);this._resizeCanvas(d,m,T),this.painter.resize(d,m,T)}this.transform.resize(d,m),(o=this._requestedCameraState)===null||o===void 0||o.resize(d,m);const S=!this._moving;return S&&(this.stop(),this.fire(new c.k("movestart",y)).fire(new c.k("move",y))),this.fire(new c.k("resize",y)),S&&this.fire(new c.k("moveend",y)),this}_getClampedPixelRatio(y,o){const{0:h,1:d}=this._maxCanvasSize,m=this.getPixelRatio(),_=y*m,S=o*m;return Math.min(_>h?h/_:1,S>d?d/S:1)*m}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(yt.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(c.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(c.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,o,h){if(y==="mouseenter"||y==="mouseover"){let d=!1;return{layer:o,listener:h,delegates:{mousemove:_=>{const S=this.getLayer(o)?this.queryRenderedFeatures(_.point,{layers:[o]}):[];S.length?d||(d=!0,h.call(this,new qi(y,this,_.originalEvent,{features:S}))):d=!1},mouseout:()=>{d=!1}}}}if(y==="mouseleave"||y==="mouseout"){let d=!1;return{layer:o,listener:h,delegates:{mousemove:S=>{(this.getLayer(o)?this.queryRenderedFeatures(S.point,{layers:[o]}):[]).length?d=!0:d&&(d=!1,h.call(this,new qi(y,this,S.originalEvent)))},mouseout:S=>{d&&(d=!1,h.call(this,new qi(y,this,S.originalEvent)))}}}}{const d=m=>{const _=this.getLayer(o)?this.queryRenderedFeatures(m.point,{layers:[o]}):[];_.length&&(m.features=_,h.call(this,m),delete m.features)};return{layer:o,listener:h,delegates:{[y]:d}}}}on(y,o,h){if(h===void 0)return super.on(y,o);const d=this._createDelegatedListener(y,o,h);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(d);for(const m in d.delegates)this.on(m,d.delegates[m]);return this}once(y,o,h){if(h===void 0)return super.once(y,o);const d=this._createDelegatedListener(y,o,h);for(const m in d.delegates)this.once(m,d.delegates[m]);return this}off(y,o,h){return h===void 0?super.off(y,o):(this._delegatedListeners&&this._delegatedListeners[y]&&(d=>{const m=this._delegatedListeners[y];for(let _=0;_<m.length;_++){const S=m[_];if(S.layer===o&&S.listener===h){for(const I in S.delegates)this.off(I,S.delegates[I]);return m.splice(_,1),this}}})(),this)}queryRenderedFeatures(y,o){if(!this.style)return[];let h;const d=y instanceof c.P||Array.isArray(y),m=d?y:[[0,0],[this.transform.width,this.transform.height]];if(o=o||(d?{}:y)||{},m instanceof c.P||typeof m[0]=="number")h=[c.P.convert(m)];else{const _=c.P.convert(m[0]),S=c.P.convert(m[1]);h=[_,new c.P(S.x,_.y),S,new c.P(_.x,S.y),_]}return this.style.queryRenderedFeatures(h,o,this.transform)}querySourceFeatures(y,o){return this.style.querySourceFeatures(y,o)}setStyle(y,o){return(o=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},o)).diff!==!1&&o.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,o),this):(this._localIdeographFontFamily=o.localIdeographFontFamily,this._updateStyle(y,o))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const o=this._locale[y];if(o==null)throw new Error(`Missing UI string '${y}'`);return o}_updateStyle(y,o){if(o.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,o));const h=this.style&&o.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new co(this,o||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,o,h):this.style.loadJSON(y,o,h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new co(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,o){if(typeof y=="string"){const h=this._requestManager.transformRequest(y,"Style");c.h(h,new AbortController).then(d=>{this._updateDiff(d.data,o)}).catch(d=>{d&&this.fire(new c.j(d))})}else typeof y=="object"&&this._updateDiff(y,o)}_updateDiff(y,o){try{this.style.setState(y,o)&&this._update(!0)}catch(h){c.w(`Unable to perform style diff: ${h.message||h.error||h}.  Rebuilding the style from scratch.`),this._updateStyle(y,o)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(y,o){return this._lazyInitEmptyStyle(),this.style.addSource(y,o),this._update(!0)}isSourceLoaded(y){const o=this.style&&this.style.sourceCaches[y];if(o!==void 0)return o.loaded();this.fire(new c.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const o=this.style.sourceCaches[y.source];if(!o)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&o.reload();for(const h in this.style._layers){const d=this.style._layers[h];d.type==="hillshade"&&d.source===y.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Gd(this.painter,o,y),this.painter.renderToTexture=new Dp(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=h=>{h.dataType==="style"?this.terrain.sourceCache.freeRtt():h.dataType==="source"&&h.tile&&(h.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(h.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:y})),this}getTerrain(){var y,o;return(o=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&o!==void 0?o:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const o in y){const h=y[o]._tiles;for(const d in h){const m=h[d];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,o,h={}){const{pixelRatio:d=1,sdf:m=!1,stretchX:_,stretchY:S,content:I}=h;if(this._lazyInitEmptyStyle(),!(o instanceof HTMLImageElement||c.b(o))){if(o.width===void 0||o.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:T,height:M,data:N}=o,O=o;return this.style.addImage(y,{data:new c.R({width:T,height:M},new Uint8Array(N)),pixelRatio:d,stretchX:_,stretchY:S,content:I,sdf:m,version:0,userImage:O}),O.onAdd&&O.onAdd(this,y),this}}{const{width:T,height:M,data:N}=P.getImageData(o);this.style.addImage(y,{data:new c.R({width:T,height:M},N),pixelRatio:d,stretchX:_,stretchY:S,content:I,sdf:m,version:0})}}updateImage(y,o){const h=this.style.getImage(y);if(!h)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=o instanceof HTMLImageElement||c.b(o)?P.getImageData(o):o,{width:m,height:_,data:S}=d;if(m===void 0||_===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==h.data.width||_!==h.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const I=!(o instanceof HTMLImageElement||c.b(o));return h.data.replace(S,I),this.style.updateImage(y,h),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return W.getImage(this._requestManager.transformRequest(y,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,o){return this._lazyInitEmptyStyle(),this.style.addLayer(y,o),this._update(!0)}moveLayer(y,o){return this.style.moveLayer(y,o),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,o,h){return this.style.setLayerZoomRange(y,o,h),this._update(!0)}setFilter(y,o,h={}){return this.style.setFilter(y,o,h),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,o,h,d={}){return this.style.setPaintProperty(y,o,h,d),this._update(!0)}getPaintProperty(y,o){return this.style.getPaintProperty(y,o)}setLayoutProperty(y,o,h,d={}){return this.style.setLayoutProperty(y,o,h,d),this._update(!0)}getLayoutProperty(y,o){return this.style.getLayoutProperty(y,o)}setGlyphs(y,o={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,o),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,o,h={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,o,h,d=>{d||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,o={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,o,h=>{h||this._update(!0)}),this}setLight(y,o={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,o),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,o){return this.style.setFeatureState(y,o),this._update()}removeFeatureState(y,o){return this.style.removeFeatureState(y,o),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,o=0;return this._container&&(y=this._container.clientWidth||400,o=this._container.clientHeight||300),[y,o]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const o=this._canvasContainer=R.create("div","maplibregl-canvas-container",y);this._interactive&&o.classList.add("maplibregl-interactive"),this._canvas=R.create("canvas","maplibregl-canvas",o),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const h=this._containerDimensions(),d=this._getClampedPixelRatio(h[0],h[1]);this._resizeCanvas(h[0],h[1],d);const m=this._controlContainer=R.create("div","maplibregl-control-container",y),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(S=>{_[S]=R.create("div",`maplibregl-ctrl-${S} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,o,h){this._canvas.width=Math.floor(h*y),this._canvas.height=Math.floor(h*o),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${o}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let o=null;this._canvas.addEventListener("webglcontextcreationerror",d=>{o={requestedAttributes:y},d&&(o.statusMessage=d.statusMessage,o.type=d.type)},{once:!0});const h=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!h){const d="Failed to initialize WebGL";throw o?(o.message=d,new Error(JSON.stringify(o))):new Error(d)}this.painter=new Pd(h,this.transform),et.testSupport(h)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const o=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let h=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,_=P.now();this.style.zoomHistory.update(m,_);const S=new c.a8(m,{now:_,fadeDuration:o,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),I=S.crossFadingFactor();I===1&&I===this._crossFadingFactor||(h=!0,this._crossFadingFactor=I),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bc.mark(c.bd.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||h)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const d=this._sourcesDirty||this._styleDirty||this._placementDirty;return d||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,c.bc.mark(c.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const h of this._controls)h.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),W.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const o=this.painter.context.gl.getExtension("WEBGL_lose_context");o&&o.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),R.remove(this._canvasContainer),R.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bc.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,P.frameAsync(this._frameRequest).then(y=>{c.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Rp}getCameraTargetElevation(){return this.transform.elevation}},p.MapMouseEvent=qi,p.MapTouchEvent=ys,p.MapWheelEvent=Cp,p.Marker=Fu,p.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const o=this._map.getZoom(),h=o===this._map.getMaxZoom(),d=o===this._map.getMinZoom();this._zoomInButton.disabled=h,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",h.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())},this._rotateCompassArrow=()=>{const o=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=o},this._setButtonTitle=(o,h)=>{const d=this._map._getUIString(`NavigationControl.${h}`);o.title=d,o.setAttribute("aria-label",d)},this.options=c.e({},Np,y),this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",o=>o.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",o=>this._map.zoomIn({},{originalEvent:o})),R.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",o=>this._map.zoomOut({},{originalEvent:o})),R.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",o=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:o}):this._map.resetNorth({},{originalEvent:o})}),this._compassIcon=R.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Op(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){R.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,o){const h=R.create("button",y,this._container);return h.type="button",h.addEventListener("click",o),h}},p.Popup=class extends c.E{constructor(y){super(),this.remove=()=>(this._content&&R.remove(this._content),this._container&&(R.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=o=>{this._update(o.point)},this._onMouseMove=o=>{this._update(o.point)},this._onDrag=o=>{this._update(o.point)},this._update=o=>{var h;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=R.create("div","maplibregl-popup",this._map.getContainer()),this._tip=R.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const I of this.options.className.split(" "))this._container.classList.add(I);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Yc(this._lngLat,this._flatPos,this._map.transform):(h=this._lngLat)===null||h===void 0?void 0:h.wrap(),this._trackPointer&&!o)return;const d=this._flatPos=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&o?o:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const _=th(this.options.offset);if(!m){const I=this._container.offsetWidth,T=this._container.offsetHeight;let M;M=d.y+_.bottom.y<T?["top"]:d.y>this._map.transform.height-T?["bottom"]:[],d.x<I/2?M.push("left"):d.x>this._map.transform.width-I/2&&M.push("right"),m=M.length===0?"bottom":M.join("-")}let S=d.add(_[m]);this.options.subpixelPositioning||(S=S.round()),R.setTransform(this._container,`${zu[m]} translate(${S.x}px,${S.y}px)`),Kc(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(zp),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=c.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const o=document.createDocumentFragment(),h=document.createElement("body");let d;for(h.innerHTML=y;d=h.firstChild,d;)o.appendChild(d);return this.setDOMContent(o)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=R.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=R.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Fp);y&&y.focus()}},p.RasterDEMTileSource=nr,p.RasterTileSource=Lt,p.ScaleControl=class{constructor(y){this._onMove=()=>{$c(this._map,this._container,this.options)},this.setUnit=o=>{this.options.unit=o,$c(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Qc),y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){R.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},p.ScrollZoomHandler=Zc,p.Style=co,p.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=R.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=R.create("button","maplibregl-ctrl-terrain",this._container),R.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){R.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},p.TwoFingersTouchPitchHandler=zd,p.TwoFingersTouchRotateHandler=Lp,p.TwoFingersTouchZoomHandler=Od,p.TwoFingersTouchZoomRotateHandler=Du,p.VectorTileSource=Ke,p.VideoSource=Cl,p.addSourceType=(y,o)=>c._(void 0,void 0,void 0,function*(){if(Pl(y))throw new Error(`A source type called "${y}" already exists.`);((h,d)=>{Ll[h]=d})(y,o)}),p.clearPrewarmedResources=function(){const y=rn;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(pe),rn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},p.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},p.getRTLTextPluginStatus=function(){return Zt().getRTLTextPluginStatus()},p.getVersion=function(){return qd},p.getWorkerCount=function(){return Re.workerCount},p.getWorkerUrl=function(){return c.a.WORKER_URL},p.importScriptInWorkers=function(y){return kn().broadcast("IS",y)},p.prewarm=function(){mn().acquire(pe)},p.setMaxParallelImageRequests=function(y){c.a.MAX_PARALLEL_IMAGE_REQUESTS=y},p.setRTLTextPlugin=function(y,o){return Zt().setRTLTextPlugin(y,o)},p.setWorkerCount=function(y){Re.workerCount=y},p.setWorkerUrl=function(y){c.a.WORKER_URL=y}});var u=n;return u})})(e2);var UA=e2.exports;const ea=N_(UA),GA="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(GA);const qA=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],jA={decimalLatitude:40.123,decimalLongitude:-74.123},WA=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],ZA=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function HA(){const e=[];return qA.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...jA})}),[...e,...WA,...ZA]}const XA=HA();XA.map(e=>e.verbatimCoordinates);/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function YA(e,t){var n={label:0,sent:function(){if(u[0]&1)throw u[1];return u[1]},trys:[],ops:[]},r,a,u,p;return p={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(p[Symbol.iterator]=function(){return this}),p;function c(C){return function(A){return b([C,A])}}function b(C){if(r)throw new TypeError("Generator is already executing.");for(;n;)try{if(r=1,a&&(u=C[0]&2?a.return:C[0]?a.throw||((u=a.return)&&u.call(a),0):a.next)&&!(u=u.call(a,C[1])).done)return u;switch(a=0,u&&(C=[C[0]&2,u.value]),C[0]){case 0:case 1:u=C;break;case 4:return n.label++,{value:C[1],done:!1};case 5:n.label++,a=C[1],C=[0];continue;case 7:C=n.ops.pop(),n.trys.pop();continue;default:if(u=n.trys,!(u=u.length>0&&u[u.length-1])&&(C[0]===6||C[0]===2)){n=0;continue}if(C[0]===3&&(!u||C[1]>u[0]&&C[1]<u[3])){n.label=C[1];break}if(C[0]===6&&n.label<u[1]){n.label=u[1],u=C;break}if(u&&n.label<u[2]){n.label=u[2],n.ops.push(C);break}u[2]&&n.ops.pop(),n.trys.pop();continue}C=t.call(e,n)}catch(A){C=[6,A],a=0}finally{r=u=0}if(C[0]&5)throw C[1];return{value:C[0]?C[1]:void 0,done:!0}}}var nu=function(){function e(t,n){this.next=null,this.key=t,this.data=n,this.left=null,this.right=null}return e}();function KA(e,t){return e>t?1:e<t?-1:0}function Jl(e,t,n){for(var r=new nu(null,null),a=r,u=r;;){var p=n(e,t.key);if(p<0){if(t.left===null)break;if(n(e,t.left.key)<0){var c=t.left;if(t.left=c.right,c.right=t,t=c,t.left===null)break}u.left=t,u=t,t=t.left}else if(p>0){if(t.right===null)break;if(n(e,t.right.key)>0){var c=t.right;if(t.right=c.left,c.left=t,t=c,t.right===null)break}a.right=t,a=t,t=t.right}else break}return a.right=t.left,u.left=t.right,t.left=r.right,t.right=r.left,t}function Xy(e,t,n,r){var a=new nu(e,t);if(n===null)return a.left=a.right=null,a;n=Jl(e,n,r);var u=r(e,n.key);return u<0?(a.left=n.left,a.right=n,n.left=null):u>=0&&(a.right=n.right,a.left=n,n.right=null),a}function Ox(e,t,n){var r=null,a=null;if(t){t=Jl(e,t,n);var u=n(t.key,e);u===0?(r=t.left,a=t.right):u<0?(a=t.right,t.right=null,r=t):(r=t.left,t.left=null,a=t)}return{left:r,right:a}}function JA(e,t,n){return t===null?e:(e===null||(t=Jl(e.key,t,n),t.left=e),t)}function b_(e,t,n,r,a){if(e){r(""+t+(n?"└── ":"├── ")+a(e)+`
`);var u=t+(n?"    ":"│   ");e.left&&b_(e.left,u,!1,r,a),e.right&&b_(e.right,u,!0,r,a)}}var r0=function(){function e(t){t===void 0&&(t=KA),this._root=null,this._size=0,this._comparator=t}return e.prototype.insert=function(t,n){return this._size++,this._root=Xy(t,n,this._root,this._comparator)},e.prototype.add=function(t,n){var r=new nu(t,n);this._root===null&&(r.left=r.right=null,this._size++,this._root=r);var a=this._comparator,u=Jl(t,this._root,a),p=a(t,u.key);return p===0?this._root=u:(p<0?(r.left=u.left,r.right=u,u.left=null):p>0&&(r.right=u.right,r.left=u,u.right=null),this._size++,this._root=r),this._root},e.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},e.prototype._remove=function(t,n,r){var a;if(n===null)return null;n=Jl(t,n,r);var u=r(t,n.key);return u===0?(n.left===null?a=n.right:(a=Jl(t,n.left,r),a.right=n.right),this._size--,a):n},e.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Jl(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},e.prototype.findStatic=function(t){for(var n=this._root,r=this._comparator;n;){var a=r(t,n.key);if(a===0)return n;a<0?n=n.left:n=n.right}return null},e.prototype.find=function(t){return this._root&&(this._root=Jl(t,this._root,this._comparator),this._comparator(t,this._root.key)!==0)?null:this._root},e.prototype.contains=function(t){for(var n=this._root,r=this._comparator;n;){var a=r(t,n.key);if(a===0)return!0;a<0?n=n.left:n=n.right}return!1},e.prototype.forEach=function(t,n){for(var r=this._root,a=[],u=!1;!u;)r!==null?(a.push(r),r=r.left):a.length!==0?(r=a.pop(),t.call(n,r),r=r.right):u=!0;return this},e.prototype.range=function(t,n,r,a){for(var u=[],p=this._comparator,c=this._root,b;u.length!==0||c;)if(c)u.push(c),c=c.left;else{if(c=u.pop(),b=p(c.key,n),b>0)break;if(p(c.key,t)>=0&&r.call(a,c))return this;c=c.right}return this},e.prototype.keys=function(){var t=[];return this.forEach(function(n){var r=n.key;return t.push(r)}),t},e.prototype.values=function(){var t=[];return this.forEach(function(n){var r=n.data;return t.push(r)}),t},e.prototype.min=function(){return this._root?this.minNode(this._root).key:null},e.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},e.prototype.minNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.left;)t=t.left;return t},e.prototype.maxNode=function(t){if(t===void 0&&(t=this._root),t)for(;t.right;)t=t.right;return t},e.prototype.at=function(t){for(var n=this._root,r=!1,a=0,u=[];!r;)if(n)u.push(n),n=n.left;else if(u.length>0){if(n=u.pop(),a===t)return n;a++,n=n.right}else r=!0;return null},e.prototype.next=function(t){var n=this._root,r=null;if(t.right){for(r=t.right;r.left;)r=r.left;return r}for(var a=this._comparator;n;){var u=a(t.key,n.key);if(u===0)break;u<0?(r=n,n=n.left):n=n.right}return r},e.prototype.prev=function(t){var n=this._root,r=null;if(t.left!==null){for(r=t.left;r.right;)r=r.right;return r}for(var a=this._comparator;n;){var u=a(t.key,n.key);if(u===0)break;u<0?n=n.left:(r=n,n=n.right)}return r},e.prototype.clear=function(){return this._root=null,this._size=0,this},e.prototype.toList=function(){return $A(this._root)},e.prototype.load=function(t,n,r){n===void 0&&(n=[]),r===void 0&&(r=!1);var a=t.length,u=this._comparator;if(r&&I_(t,n,0,a-1,u),this._root===null)this._root=w_(t,n,0,a),this._size=a;else{var p=tM(this.toList(),QA(t,n),u);a=this._size+a,this._root=S_({head:p},0,a)}return this},e.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(e.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),e.prototype.toString=function(t){t===void 0&&(t=function(r){return String(r.key)});var n=[];return b_(this._root,"",!0,function(r){return n.push(r)},t),n.join("")},e.prototype.update=function(t,n,r){var a=this._comparator,u=Ox(t,this._root,a),p=u.left,c=u.right;a(t,n)<0?c=Xy(n,r,c,a):p=Xy(n,r,p,a),this._root=JA(p,c,a)},e.prototype.split=function(t){return Ox(t,this._root,this._comparator)},e.prototype[Symbol.iterator]=function(){var t,n,r;return YA(this,function(a){switch(a.label){case 0:t=this._root,n=[],r=!1,a.label=1;case 1:return r?[3,6]:t===null?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return n.length===0?[3,4]:(t=n.pop(),[4,t]);case 3:return a.sent(),t=t.right,[3,5];case 4:r=!0,a.label=5;case 5:return[3,1];case 6:return[2]}})},e}();function w_(e,t,n,r){var a=r-n;if(a>0){var u=n+Math.floor(a/2),p=e[u],c=t[u],b=new nu(p,c);return b.left=w_(e,t,n,u),b.right=w_(e,t,u+1,r),b}return null}function QA(e,t){for(var n=new nu(null,null),r=n,a=0;a<e.length;a++)r=r.next=new nu(e[a],t[a]);return r.next=null,n.next}function $A(e){for(var t=e,n=[],r=!1,a=new nu(null,null),u=a;!r;)t?(n.push(t),t=t.left):n.length>0?(t=u=u.next=n.pop(),t=t.right):r=!0;return u.next=null,a.next}function S_(e,t,n){var r=n-t;if(r>0){var a=t+Math.floor(r/2),u=S_(e,t,a),p=e.head;return p.left=u,e.head=e.head.next,p.right=S_(e,a+1,n),p}return null}function tM(e,t,n){for(var r=new nu(null,null),a=r,u=e,p=t;u!==null&&p!==null;)n(u.key,p.key)<0?(a.next=u,u=u.next):(a.next=p,p=p.next),a=a.next;return u!==null?a.next=u:p!==null&&(a.next=p),r.next}function I_(e,t,n,r,a){if(!(n>=r)){for(var u=e[n+r>>1],p=n-1,c=r+1;;){do p++;while(a(e[p],u)<0);do c--;while(a(e[c],u)>0);if(p>=c)break;var b=e[p];e[p]=e[c],e[c]=b,b=t[p],t[p]=t[c],t[c]=b}I_(e,t,n,c,a),I_(e,t,c+1,r,a)}}function qs(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zx(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function bo(e,t,n){return t&&zx(e.prototype,t),n&&zx(e,n),e}var hf=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},E_=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x,a=e.ll.y<t.ll.y?t.ll.y:e.ll.y,u=e.ur.y<t.ur.y?e.ur.y:t.ur.y;return{ll:{x:n,y:a},ur:{x:r,y:u}}},$l=Number.EPSILON;$l===void 0&&($l=Math.pow(2,-52));var eM=$l*$l,C_=function(e,t){if(-$l<e&&e<$l&&-$l<t&&t<$l)return 0;var n=e-t;return n*n<eM*e*t?0:e<t?-1:1},nM=function(){function e(){qs(this,e),this.reset()}return bo(e,[{key:"reset",value:function(){this.xRounder=new Fx,this.yRounder=new Fx}},{key:"round",value:function(t,n){return{x:this.xRounder.round(t),y:this.yRounder.round(n)}}}]),e}(),Fx=function(){function e(){qs(this,e),this.tree=new r0,this.round(0)}return bo(e,[{key:"round",value:function(t){var n=this.tree.add(t),r=this.tree.prev(n);if(r!==null&&C_(n.key,r.key)===0)return this.tree.remove(t),r.key;var a=this.tree.next(n);return a!==null&&C_(n.key,a.key)===0?(this.tree.remove(t),a.key):t}}]),e}(),Af=new nM,Tf=function(e,t){return e.x*t.y-e.y*t.x},r2=function(e,t){return e.x*t.x+e.y*t.y},Bx=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},a={x:n.x-e.x,y:n.y-e.y},u=Tf(r,a);return C_(u,0)},jm=function(e){return Math.sqrt(r2(e,e))},rM=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},a={x:n.x-e.x,y:n.y-e.y};return Tf(a,r)/jm(a)/jm(r)},iM=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},a={x:n.x-e.x,y:n.y-e.y};return r2(a,r)/jm(a)/jm(r)},Vx=function(e,t,n){return t.y===0?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},Ux=function(e,t,n){return t.x===0?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},oM=function(e,t,n,r){if(t.x===0)return Ux(n,r,e.x);if(r.x===0)return Ux(e,t,n.x);if(t.y===0)return Vx(n,r,e.y);if(r.y===0)return Vx(e,t,n.y);var a=Tf(t,r);if(a==0)return null;var u={x:n.x-e.x,y:n.y-e.y},p=Tf(u,t)/a,c=Tf(u,r)/a,b=e.x+c*t.x,C=n.x+p*r.x,A=e.y+c*t.y,P=n.y+p*r.y,R=(b+C)/2,et=(A+P)/2;return{x:R,y:et}},Ma=function(){bo(e,null,[{key:"compare",value:function(t,n){var r=e.comparePoints(t.point,n.point);return r!==0?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Wm.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,n){return t.x<n.x?-1:t.x>n.x?1:t.y<n.y?-1:t.y>n.y?1:0}}]);function e(t,n){qs(this,e),t.events===void 0?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}return bo(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var n=t.point.events,r=0,a=n.length;r<a;r++){var u=n[r];this.point.events.push(u),u.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,n=0;n<t;n++){var r=this.point.events[n];if(r.segment.consumedBy===void 0)for(var a=n+1;a<t;a++){var u=this.point.events[a];u.consumedBy===void 0&&r.otherSE.point.events===u.otherSE.point.events&&r.segment.consume(u.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],n=0,r=this.point.events.length;n<r;n++){var a=this.point.events[n];a!==this&&!a.segment.ringOut&&a.segment.isInResult()&&t.push(a)}return t}},{key:"getLeftmostComparator",value:function(t){var n=this,r=new Map,a=function(u){var p=u.otherSE;r.set(u,{sine:rM(n.point,t.point,p.point),cosine:iM(n.point,t.point,p.point)})};return function(u,p){r.has(u)||a(u),r.has(p)||a(p);var c=r.get(u),b=c.sine,C=c.cosine,A=r.get(p),P=A.sine,R=A.cosine;return b>=0&&P>=0?C<R?1:C>R?-1:0:b<0&&P<0?C<R?-1:C>R?1:0:P<b?-1:P>b?1:0}}}]),e}(),sM=0,Wm=function(){bo(e,null,[{key:"compare",value:function(t,n){var r=t.leftSE.point.x,a=n.leftSE.point.x,u=t.rightSE.point.x,p=n.rightSE.point.x;if(p<r)return 1;if(u<a)return-1;var c=t.leftSE.point.y,b=n.leftSE.point.y,C=t.rightSE.point.y,A=n.rightSE.point.y;if(r<a){if(b<c&&b<C)return 1;if(b>c&&b>C)return-1;var P=t.comparePoint(n.leftSE.point);if(P<0)return 1;if(P>0)return-1;var R=n.comparePoint(t.rightSE.point);return R!==0?R:-1}if(r>a){if(c<b&&c<A)return-1;if(c>b&&c>A)return 1;var et=n.comparePoint(t.leftSE.point);if(et!==0)return et;var X=t.comparePoint(n.rightSE.point);return X<0?1:X>0?-1:1}if(c<b)return-1;if(c>b)return 1;if(u<p){var K=n.comparePoint(t.rightSE.point);if(K!==0)return K}if(u>p){var ot=t.comparePoint(n.rightSE.point);if(ot<0)return 1;if(ot>0)return-1}if(u!==p){var gt=C-c,q=u-r,W=A-b,at=p-a;if(gt>q&&W<at)return 1;if(gt<q&&W>at)return-1}return u>p?1:u<p||C<A?-1:C>A?1:t.id<n.id?-1:t.id>n.id?1:0}}]);function e(t,n,r,a){qs(this,e),this.id=++sM,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=r,this.windings=a}return bo(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<n?t:n},ur:{x:this.rightSE.point.x,y:t>n?t:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var n=this.leftSE.point,r=this.rightSE.point,a=this.vector();if(n.x===r.x)return t.x===n.x?0:t.x<n.x?1:-1;var u=(t.y-n.y)/a.y,p=n.x+u*a.x;if(t.x===p)return 0;var c=(t.x-n.x)/a.x,b=n.y+c*a.y;return t.y===b?0:t.y<b?-1:1}},{key:"getIntersection",value:function(t){var n=this.bbox(),r=t.bbox(),a=E_(n,r);if(a===null)return null;var u=this.leftSE.point,p=this.rightSE.point,c=t.leftSE.point,b=t.rightSE.point,C=hf(n,c)&&this.comparePoint(c)===0,A=hf(r,u)&&t.comparePoint(u)===0,P=hf(n,b)&&this.comparePoint(b)===0,R=hf(r,p)&&t.comparePoint(p)===0;if(A&&C)return R&&!P?p:!R&&P?b:null;if(A)return P&&u.x===b.x&&u.y===b.y?null:u;if(C)return R&&p.x===c.x&&p.y===c.y?null:c;if(R&&P)return null;if(R)return p;if(P)return b;var et=oM(u,this.vector(),c,t.vector());return et===null||!hf(a,et)?null:Af.round(et.x,et.y)}},{key:"split",value:function(t){var n=[],r=t.events!==void 0,a=new Ma(t,!0),u=new Ma(t,!1),p=this.rightSE;this.replaceRightSE(u),n.push(u),n.push(a);var c=new e(a,p,this.rings.slice(),this.windings.slice());return Ma.comparePoints(c.leftSE.point,c.rightSE.point)>0&&c.swapEvents(),Ma.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(a.checkForConsuming(),u.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,r=this.windings.length;n<r;n++)this.windings[n]*=-1}},{key:"consume",value:function(t){for(var n=this,r=t;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var a=e.compare(n,r);if(a!==0){if(a>0){var u=n;n=r,r=u}if(n.prev===r){var p=n;n=r,r=p}for(var c=0,b=r.rings.length;c<b;c++){var C=r.rings[c],A=r.windings[c],P=n.rings.indexOf(C);P===-1?(n.rings.push(C),n.windings.push(A)):n.windings[P]+=A}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,r=this._afterState.windings,a=this._afterState.multiPolys,u=0,p=this.rings.length;u<p;u++){var c=this.rings[u],b=this.windings[u],C=n.indexOf(c);C===-1?(n.push(c),r.push(b)):r[C]+=b}for(var A=[],P=[],R=0,et=n.length;R<et;R++)if(r[R]!==0){var X=n[R],K=X.poly;if(P.indexOf(K)===-1)if(X.isExterior)A.push(K);else{P.indexOf(K)===-1&&P.push(K);var ot=A.indexOf(X.poly);ot!==-1&&A.splice(ot,1)}}for(var gt=0,q=A.length;gt<q;gt++){var W=A[gt].multiPoly;a.indexOf(W)===-1&&a.push(W)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var t=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(ju.type){case"union":{var r=t.length===0,a=n.length===0;this._isInResult=r!==a;break}case"intersection":{var u,p;t.length<n.length?(u=t.length,p=n.length):(u=n.length,p=t.length),this._isInResult=p===ju.numMultiPolys&&u<p;break}case"xor":{var c=Math.abs(t.length-n.length);this._isInResult=c%2===1;break}case"difference":{var b=function(C){return C.length===1&&C[0].isSubject};this._isInResult=b(t)!==b(n);break}default:throw new Error("Unrecognized operation type found ".concat(ju.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,r){var a,u,p,c=Ma.comparePoints(t,n);if(c<0)a=t,u=n,p=1;else if(c>0)a=n,u=t,p=-1;else throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));var b=new Ma(a,!0),C=new Ma(u,!1);return new e(b,C,[r],[p])}}]),e}(),Gx=function(){function e(t,n,r){if(qs(this,e),!Array.isArray(t)||t.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],typeof t[0][0]!="number"||typeof t[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=Af.round(t[0][0],t[0][1]);this.bbox={ll:{x:a.x,y:a.y},ur:{x:a.x,y:a.y}};for(var u=a,p=1,c=t.length;p<c;p++){if(typeof t[p][0]!="number"||typeof t[p][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var b=Af.round(t[p][0],t[p][1]);b.x===u.x&&b.y===u.y||(this.segments.push(Wm.fromRing(u,b,this)),b.x<this.bbox.ll.x&&(this.bbox.ll.x=b.x),b.y<this.bbox.ll.y&&(this.bbox.ll.y=b.y),b.x>this.bbox.ur.x&&(this.bbox.ur.x=b.x),b.y>this.bbox.ur.y&&(this.bbox.ur.y=b.y),u=b)}(a.x!==u.x||a.y!==u.y)&&this.segments.push(Wm.fromRing(u,a,this))}return bo(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,r=this.segments.length;n<r;n++){var a=this.segments[n];t.push(a.leftSE),t.push(a.rightSE)}return t}}]),e}(),aM=function(){function e(t,n){if(qs(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Gx(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,a=t.length;r<a;r++){var u=new Gx(t[r],this,!1);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.interiorRings.push(u)}this.multiPoly=n}return bo(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),n=0,r=this.interiorRings.length;n<r;n++)for(var a=this.interiorRings[n].getSweepEvents(),u=0,p=a.length;u<p;u++)t.push(a[u]);return t}}]),e}(),qx=function(){function e(t,n){if(qs(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof t[0][0][0]=="number"&&(t=[t])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,a=t.length;r<a;r++){var u=new aM(t[r],this);u.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=u.bbox.ll.x),u.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=u.bbox.ll.y),u.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=u.bbox.ur.x),u.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=u.bbox.ur.y),this.polys.push(u)}this.isSubject=n}return bo(e,[{key:"getSweepEvents",value:function(){for(var t=[],n=0,r=this.polys.length;n<r;n++)for(var a=this.polys[n].getSweepEvents(),u=0,p=a.length;u<p;u++)t.push(a[u]);return t}}]),e}(),lM=function(){bo(e,null,[{key:"factory",value:function(t){for(var n=[],r=0,a=t.length;r<a;r++){var u=t[r];if(!(!u.isInResult()||u.ringOut)){for(var p=null,c=u.leftSE,b=u.rightSE,C=[c],A=c.point,P=[];p=c,c=b,C.push(c),c.point!==A;)for(;;){var R=c.getAvailableLinkedEvents();if(R.length===0){var et=C[0].point,X=C[C.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(et.x,",")+" ".concat(et.y,"]. Last matching segment found ends at")+" [".concat(X.x,", ").concat(X.y,"]."))}if(R.length===1){b=R[0].otherSE;break}for(var K=null,ot=0,gt=P.length;ot<gt;ot++)if(P[ot].point===c.point){K=ot;break}if(K!==null){var q=P.splice(K)[0],W=C.splice(q.index);W.unshift(W[0].otherSE),n.push(new e(W.reverse()));continue}P.push({index:C.length,point:c.point});var at=c.getLeftmostComparator(p);b=R.sort(at)[0].otherSE;break}n.push(new e(C))}}return n}}]);function e(t){qs(this,e),this.events=t;for(var n=0,r=t.length;n<r;n++)t[n].segment.ringOut=this;this.poly=null}return bo(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,n=[t],r=1,a=this.events.length-1;r<a;r++){var u=this.events[r].point,p=this.events[r+1].point;Bx(u,t,p)!==0&&(n.push(u),t=u)}if(n.length===1)return null;var c=n[0],b=n[1];Bx(c,t,b)===0&&n.shift(),n.push(n[0]);for(var C=this.isExteriorRing()?1:-1,A=this.isExteriorRing()?0:n.length-1,P=this.isExteriorRing()?n.length:-1,R=[],et=A;et!=P;et+=C)R.push([n[et].x,n[et].y]);return R}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var t=this.enclosingRing();this._isExteriorRing=t?!t.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],n=1,r=this.events.length;n<r;n++){var a=this.events[n];Ma.compare(t,a)>0&&(t=a)}for(var u=t.segment.prevInResult(),p=u?u.prevInResult():null;;){if(!u)return null;if(!p)return u.ringOut;if(p.ringOut!==u.ringOut)return p.ringOut.enclosingRing()!==u.ringOut?u.ringOut:u.ringOut.enclosingRing();u=p.prevInResult(),p=u?u.prevInResult():null}}}]),e}(),jx=function(){function e(t){qs(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return bo(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(t[0]===null)return null;for(var n=0,r=this.interiorRings.length;n<r;n++){var a=this.interiorRings[n].getGeom();a!==null&&t.push(a)}return t}}]),e}(),uM=function(){function e(t){qs(this,e),this.rings=t,this.polys=this._composePolys(t)}return bo(e,[{key:"getGeom",value:function(){for(var t=[],n=0,r=this.polys.length;n<r;n++){var a=this.polys[n].getGeom();a!==null&&t.push(a)}return t}},{key:"_composePolys",value:function(t){for(var n=[],r=0,a=t.length;r<a;r++){var u=t[r];if(!u.poly)if(u.isExteriorRing())n.push(new jx(u));else{var p=u.enclosingRing();p.poly||n.push(new jx(p)),p.poly.addInterior(u)}}return n}}]),e}(),cM=function(){function e(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Wm.compare;qs(this,e),this.queue=t,this.tree=new r0(n),this.segments=[]}return bo(e,[{key:"process",value:function(t){var n=t.segment,r=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(n),r;var a=t.isLeft?this.tree.insert(n):this.tree.find(n);if(!a)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var u=a,p=a,c=void 0,b=void 0;c===void 0;)u=this.tree.prev(u),u===null?c=null:u.key.consumedBy===void 0&&(c=u.key);for(;b===void 0;)p=this.tree.next(p),p===null?b=null:p.key.consumedBy===void 0&&(b=p.key);if(t.isLeft){var C=null;if(c){var A=c.getIntersection(n);if(A!==null&&(n.isAnEndpoint(A)||(C=A),!c.isAnEndpoint(A)))for(var P=this._splitSafely(c,A),R=0,et=P.length;R<et;R++)r.push(P[R])}var X=null;if(b){var K=b.getIntersection(n);if(K!==null&&(n.isAnEndpoint(K)||(X=K),!b.isAnEndpoint(K)))for(var ot=this._splitSafely(b,K),gt=0,q=ot.length;gt<q;gt++)r.push(ot[gt])}if(C!==null||X!==null){var W=null;if(C===null)W=X;else if(X===null)W=C;else{var at=Ma.comparePoints(C,X);W=at<=0?C:X}this.queue.remove(n.rightSE),r.push(n.rightSE);for(var dt=n.split(W),Pt=0,Mt=dt.length;Pt<Mt;Pt++)r.push(dt[Pt])}r.length>0?(this.tree.remove(n),r.push(t)):(this.segments.push(n),n.prev=c)}else{if(c&&b){var Tt=c.getIntersection(b);if(Tt!==null){if(!c.isAnEndpoint(Tt))for(var Ut=this._splitSafely(c,Tt),qt=0,Q=Ut.length;qt<Q;qt++)r.push(Ut[qt]);if(!b.isAnEndpoint(Tt))for(var Et=this._splitSafely(b,Tt),$t=0,le=Et.length;$t<le;$t++)r.push(Et[$t])}}this.tree.remove(n)}return r}},{key:"_splitSafely",value:function(t,n){this.tree.remove(t);var r=t.rightSE;this.queue.remove(r);var a=t.split(n);return a.push(r),t.consumedBy===void 0&&this.tree.insert(t),a}}]),e}(),Wx=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,hM=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,pM=function(){function e(){qs(this,e)}return bo(e,[{key:"run",value:function(t,n,r){ju.type=t,Af.reset();for(var a=[new qx(n,!0)],u=0,p=r.length;u<p;u++)a.push(new qx(r[u],!1));if(ju.numMultiPolys=a.length,ju.type==="difference")for(var c=a[0],b=1;b<a.length;)E_(a[b].bbox,c.bbox)!==null?b++:a.splice(b,1);if(ju.type==="intersection"){for(var C=0,A=a.length;C<A;C++)for(var P=a[C],R=C+1,et=a.length;R<et;R++)if(E_(P.bbox,a[R].bbox)===null)return[]}for(var X=new r0(Ma.compare),K=0,ot=a.length;K<ot;K++)for(var gt=a[K].getSweepEvents(),q=0,W=gt.length;q<W;q++)if(X.insert(gt[q]),X.size>Wx)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var at=new cM(X),dt=X.size,Pt=X.pop();Pt;){var Mt=Pt.key;if(X.size===dt){var Tt=Mt.segment;throw new Error("Unable to pop() ".concat(Mt.isLeft?"left":"right"," SweepEvent ")+"[".concat(Mt.point.x,", ").concat(Mt.point.y,"] from segment #").concat(Tt.id," ")+"[".concat(Tt.leftSE.point.x,", ").concat(Tt.leftSE.point.y,"] -> ")+"[".concat(Tt.rightSE.point.x,", ").concat(Tt.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(X.size>Wx)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(at.segments.length>hM)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var Ut=at.process(Mt),qt=0,Q=Ut.length;qt<Q;qt++){var Et=Ut[qt];Et.consumedBy===void 0&&X.insert(Et)}dt=X.size,Pt=X.pop()}Af.reset();var $t=lM.factory(at.segments),le=new uM($t);return le.getGeom()}}]),e}(),ju=new pM;function i2(e,t,n){if(e!==null)for(var r,a,u,p,c,b,C,A=0,P=0,R,et=e.type,X=et==="FeatureCollection",K=et==="Feature",ot=X?e.features.length:1,gt=0;gt<ot;gt++){C=X?e.features[gt].geometry:K?e.geometry:e,R=C?C.type==="GeometryCollection":!1,c=R?C.geometries.length:1;for(var q=0;q<c;q++){var W=0,at=0;if(p=R?C.geometries[q]:C,p!==null){b=p.coordinates;var dt=p.type;switch(A=n&&(dt==="Polygon"||dt==="MultiPolygon")?1:0,dt){case null:break;case"Point":if(t(b,P,gt,W,at)===!1)return!1;P++,W++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],P,gt,W,at)===!1)return!1;P++,dt==="MultiPoint"&&W++}dt==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],P,gt,W,at)===!1)return!1;P++}dt==="MultiLineString"&&W++,dt==="Polygon"&&at++}dt==="Polygon"&&W++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(at=0,a=0;a<b[r].length;a++){for(u=0;u<b[r][a].length-A;u++){if(t(b[r][a][u],P,gt,W,at)===!1)return!1;P++}at++}W++}break;case"GeometryCollection":for(r=0;r<p.geometries.length;r++)if(i2(p.geometries[r],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Zx(e){var t=[1/0,1/0,-1/0,-1/0];return i2(e,function(n){t[0]>n[0]&&(t[0]=n[0]),t[1]>n[1]&&(t[1]=n[1]),t[2]<n[0]&&(t[2]=n[0]),t[3]<n[1]&&(t[3]=n[1])}),t}Zx.default=Zx;"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(e){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var t=Object(this),n=Math.max(Math.min(t.length,9007199254740991),0)||0,r=1 in arguments&&parseInt(Number(arguments[1]),10)||0;r=r<0?Math.max(n+r,0):Math.min(r,n);var a=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(a=a<0?Math.max(n+arguments[2],0):Math.min(a,n);r<a;)t[r]=e,++r;return t},writable:!0});Number.isFinite=Number.isFinite||function(e){return typeof e=="number"&&isFinite(e)};Number.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(e){return e!==e};Math.trunc=Math.trunc||function(e){return e<0?Math.ceil(e):Math.floor(e)};var Hu=function(){};Hu.prototype.interfaces_=function(){return[]};Hu.prototype.getClass=function(){return Hu};Hu.prototype.equalsWithTolerance=function(e,t,n){return Math.abs(e-t)<=n};var Hn=function(e){function t(n){e.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),De=function(){},o2={MAX_VALUE:{configurable:!0}};De.isNaN=function(e){return Number.isNaN(e)};De.doubleToLongBits=function(e){return e};De.longBitsToDouble=function(e){return e};De.isInfinite=function(e){return!Number.isFinite(e)};o2.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(De,o2);var Uo=function(){},ag=function(){},Dh=function(){};function Go(){}var bt=function e(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=e.NULL_ORDINATE;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=e.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},cc={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};bt.prototype.setOrdinate=function(e,t){switch(e){case bt.X:this.x=t;break;case bt.Y:this.y=t;break;case bt.Z:this.z=t;break;default:throw new Hn("Invalid ordinate index: "+e)}};bt.prototype.equals2D=function(){if(arguments.length===1){var e=arguments[0];return!(this.x!==e.x||this.y!==e.y)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return!(!Hu.equalsWithTolerance(this.x,t.x,n)||!Hu.equalsWithTolerance(this.y,t.y,n))}};bt.prototype.getOrdinate=function(e){switch(e){case bt.X:return this.x;case bt.Y:return this.y;case bt.Z:return this.z}throw new Hn("Invalid ordinate index: "+e)};bt.prototype.equals3D=function(e){return this.x===e.x&&this.y===e.y&&(this.z===e.z||De.isNaN(this.z))&&De.isNaN(e.z)};bt.prototype.equals=function(e){return e instanceof bt?this.equals2D(e):!1};bt.prototype.equalInZ=function(e,t){return Hu.equalsWithTolerance(this.z,e.z,t)};bt.prototype.compareTo=function(e){var t=e;return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0};bt.prototype.clone=function(){};bt.prototype.copy=function(){return new bt(this)};bt.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};bt.prototype.distance3D=function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return Math.sqrt(t*t+n*n+r*r)};bt.prototype.distance=function(e){var t=this.x-e.x,n=this.y-e.y;return Math.sqrt(t*t+n*n)};bt.prototype.hashCode=function(){var e=17;return e=37*e+bt.hashCode(this.x),e=37*e+bt.hashCode(this.y),e};bt.prototype.setCoordinate=function(e){this.x=e.x,this.y=e.y,this.z=e.z};bt.prototype.interfaces_=function(){return[Uo,ag,Go]};bt.prototype.getClass=function(){return bt};bt.hashCode=function(){if(arguments.length===1){var e=arguments[0],t=De.doubleToLongBits(e);return Math.trunc((t^t)>>>32)}};cc.DimensionalComparator.get=function(){return dl};cc.serialVersionUID.get=function(){return 6683108902428367e3};cc.NULL_ORDINATE.get=function(){return De.NaN};cc.X.get=function(){return 0};cc.Y.get=function(){return 1};cc.Z.get=function(){return 2};Object.defineProperties(bt,cc);var dl=function(e){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t!==2&&t!==3)throw new Hn("only 2 or 3 dimensions may be specified");this._dimensionsToTest=t}};dl.prototype.compare=function(e,t){var n=e,r=t,a=dl.compare(n.x,r.x);if(a!==0)return a;var u=dl.compare(n.y,r.y);if(u!==0)return u;if(this._dimensionsToTest<=2)return 0;var p=dl.compare(n.z,r.z);return p};dl.prototype.interfaces_=function(){return[Dh]};dl.prototype.getClass=function(){return dl};dl.compare=function(e,t){return e<t?-1:e>t?1:De.isNaN(e)?De.isNaN(t)?0:-1:De.isNaN(t)?1:0};var kh=function(){};kh.prototype.create=function(){};kh.prototype.interfaces_=function(){return[]};kh.prototype.getClass=function(){return kh};var St=function(){},Yf={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};St.prototype.interfaces_=function(){return[]};St.prototype.getClass=function(){return St};St.toLocationSymbol=function(e){switch(e){case St.EXTERIOR:return"e";case St.BOUNDARY:return"b";case St.INTERIOR:return"i";case St.NONE:return"-"}throw new Hn("Unknown location value: "+e)};Yf.INTERIOR.get=function(){return 0};Yf.BOUNDARY.get=function(){return 1};Yf.EXTERIOR.get=function(){return 2};Yf.NONE.get=function(){return-1};Object.defineProperties(St,Yf);var Le=function(e,t){return e.interfaces_&&e.interfaces_().indexOf(t)>-1},wo=function(){},s2={LOG_10:{configurable:!0}};wo.prototype.interfaces_=function(){return[]};wo.prototype.getClass=function(){return wo};wo.log10=function(e){var t=Math.log(e);return De.isInfinite(t)||De.isNaN(t)?t:t/wo.LOG_10};wo.min=function(e,t,n,r){var a=e;return t<a&&(a=t),n<a&&(a=n),r<a&&(a=r),a};wo.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1],n=arguments[2];return e<t?t:e>n?n:e}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var r=arguments[0],a=arguments[1],u=arguments[2];return r<a?a:r>u?u:r}};wo.wrap=function(e,t){return e<0?t- -e%t:e%t};wo.max=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2],r=e;return t>r&&(r=t),n>r&&(r=n),r}else if(arguments.length===4){var a=arguments[0],u=arguments[1],p=arguments[2],c=arguments[3],b=a;return u>b&&(b=u),p>b&&(b=p),c>b&&(b=c),b}};wo.average=function(e,t){return(e+t)/2};s2.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(wo,s2);var js=function(e){this.str=e};js.prototype.append=function(e){this.str+=e};js.prototype.setCharAt=function(e,t){this.str=this.str.substr(0,e)+t+this.str.substr(e+1)};js.prototype.toString=function(e){return this.str};var Ms=function(e){this.value=e};Ms.prototype.intValue=function(){return this.value};Ms.prototype.compareTo=function(e){return this.value<e?-1:this.value>e?1:0};Ms.isNaN=function(e){return Number.isNaN(e)};var Mf=function(){};Mf.isWhitespace=function(e){return e<=32&&e>=0||e===127};Mf.toUpperCase=function(e){return e.toUpperCase()};var Dt=function e(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var r=arguments[0];e.call(this,e.parse(r))}}else if(arguments.length===2){var a=arguments[0],u=arguments[1];this.init(a,u)}},hs={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Dt.prototype.le=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<=e._lo};Dt.prototype.extractSignificantDigits=function(e,t){var n=this.abs(),r=Dt.magnitude(n._hi),a=Dt.TEN.pow(r);n=n.divide(a),n.gt(Dt.TEN)?(n=n.divide(Dt.TEN),r+=1):n.lt(Dt.ONE)&&(n=n.multiply(Dt.TEN),r-=1);for(var u=r+1,p=new js,c=Dt.MAX_PRINT_DIGITS-1,b=0;b<=c;b++){e&&b===u&&p.append(".");var C=Math.trunc(n._hi);if(C<0)break;var A=!1,P=0;C>9?(A=!0,P="9"):P="0"+C,p.append(P),n=n.subtract(Dt.valueOf(C)).multiply(Dt.TEN),A&&n.selfAdd(Dt.TEN);var R=!0,et=Dt.magnitude(n._hi);if(et<0&&Math.abs(et)>=c-b&&(R=!1),!R)break}return t[0]=r,p.toString()};Dt.prototype.sqr=function(){return this.multiply(this)};Dt.prototype.doubleValue=function(){return this._hi+this._lo};Dt.prototype.subtract=function(){if(arguments[0]instanceof Dt){var e=arguments[0];return this.add(e.negate())}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.add(-t)}};Dt.prototype.equals=function(){if(arguments.length===1){var e=arguments[0];return this._hi===e._hi&&this._lo===e._lo}};Dt.prototype.isZero=function(){return this._hi===0&&this._lo===0};Dt.prototype.selfSubtract=function(){if(arguments[0]instanceof Dt){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e._hi,-e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}};Dt.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Dt.prototype.min=function(e){return this.le(e)?this:e};Dt.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var e=arguments[0];return this.selfDivide(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfDivide(t,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=null,u=null,p=null,c=null,b=null,C=null,A=null,P=null;return b=this._hi/n,C=Dt.SPLIT*b,a=C-b,P=Dt.SPLIT*n,a=C-a,u=b-a,p=P-n,A=b*n,p=P-p,c=n-p,P=a*p-A+a*c+u*p+u*c,C=(this._hi-A-P+this._lo-b*r)/n,P=b+C,this._hi=P,this._lo=b-P+C,this}};Dt.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Dt.prototype.divide=function(){if(arguments[0]instanceof Dt){var e=arguments[0],t=null,n=null,r=null,a=null,u=null,p=null,c=null,b=null;u=this._hi/e._hi,p=Dt.SPLIT*u,t=p-u,b=Dt.SPLIT*e._hi,t=p-t,n=u-t,r=b-e._hi,c=u*e._hi,r=b-r,a=e._hi-r,b=t*r-c+t*a+n*r+n*a,p=(this._hi-c-b+this._lo-u*e._lo)/e._hi,b=u+p;var C=b,A=u-b+p;return new Dt(C,A)}else if(typeof arguments[0]=="number"){var P=arguments[0];return De.isNaN(P)?Dt.createNaN():Dt.copy(this).selfDivide(P,0)}};Dt.prototype.ge=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>=e._lo};Dt.prototype.pow=function(e){if(e===0)return Dt.valueOf(1);var t=new Dt(this),n=Dt.valueOf(1),r=Math.abs(e);if(r>1)for(;r>0;)r%2===1&&n.selfMultiply(t),r/=2,r>0&&(t=t.sqr());else n=t;return e<0?n.reciprocal():n};Dt.prototype.ceil=function(){if(this.isNaN())return Dt.NaN;var e=Math.ceil(this._hi),t=0;return e===this._hi&&(t=Math.ceil(this._lo)),new Dt(e,t)};Dt.prototype.compareTo=function(e){var t=e;return this._hi<t._hi?-1:this._hi>t._hi?1:this._lo<t._lo?-1:this._lo>t._lo?1:0};Dt.prototype.rint=function(){if(this.isNaN())return this;var e=this.add(.5);return e.floor()};Dt.prototype.setValue=function(){if(arguments[0]instanceof Dt){var e=arguments[0];return this.init(e),this}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.init(t),this}};Dt.prototype.max=function(e){return this.ge(e)?this:e};Dt.prototype.sqrt=function(){if(this.isZero())return Dt.valueOf(0);if(this.isNegative())return Dt.NaN;var e=1/Math.sqrt(this._hi),t=this._hi*e,n=Dt.valueOf(t),r=this.subtract(n.sqr()),a=r._hi*(e*.5);return n.add(a)};Dt.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var e=arguments[0];return this.selfAdd(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0],n=null,r=null,a=null,u=null,p=null,c=null;return a=this._hi+t,p=a-this._hi,u=a-p,u=t-p+(this._hi-u),c=u+this._lo,n=a+c,r=c+(a-n),this._hi=n+r,this._lo=r+(n-this._hi),this}}else if(arguments.length===2){var b=arguments[0],C=arguments[1],A=null,P=null,R=null,et=null,X=null,K=null,ot=null,gt=null;X=this._hi+b,R=this._lo+C,ot=X-this._hi,gt=R-this._lo,K=X-ot,et=R-gt,K=b-ot+(this._hi-K),et=C-gt+(this._lo-et),ot=K+R,A=X+ot,P=ot+(X-A),ot=et+P;var q=A+ot,W=ot+(A-q);return this._hi=q,this._lo=W,this}};Dt.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var e=arguments[0];return this.selfMultiply(e._hi,e._lo)}else if(typeof arguments[0]=="number"){var t=arguments[0];return this.selfMultiply(t,0)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=null,u=null,p=null,c=null,b=null,C=null;b=Dt.SPLIT*this._hi,a=b-this._hi,C=Dt.SPLIT*n,a=b-a,u=this._hi-a,p=C-n,b=this._hi*n,p=C-p,c=n-p,C=a*p-b+a*c+u*p+u*c+(this._hi*r+this._lo*n);var A=b+C;a=b-A;var P=C+a;return this._hi=A,this._lo=P,this}};Dt.prototype.selfSqr=function(){return this.selfMultiply(this)};Dt.prototype.floor=function(){if(this.isNaN())return Dt.NaN;var e=Math.floor(this._hi),t=0;return e===this._hi&&(t=Math.floor(this._lo)),new Dt(e,t)};Dt.prototype.negate=function(){return this.isNaN()?this:new Dt(-this._hi,-this._lo)};Dt.prototype.clone=function(){};Dt.prototype.multiply=function(){if(arguments[0]instanceof Dt){var e=arguments[0];return e.isNaN()?Dt.createNaN():Dt.copy(this).selfMultiply(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return De.isNaN(t)?Dt.createNaN():Dt.copy(this).selfMultiply(t,0)}};Dt.prototype.isNaN=function(){return De.isNaN(this._hi)};Dt.prototype.intValue=function(){return Math.trunc(this._hi)};Dt.prototype.toString=function(){var e=Dt.magnitude(this._hi);return e>=-3&&e<=20?this.toStandardNotation():this.toSciNotation()};Dt.prototype.toStandardNotation=function(){var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),r=t[0]+1,a=n;if(n.charAt(0)===".")a="0"+n;else if(r<0)a="0."+Dt.stringOfChar("0",-r)+n;else if(n.indexOf(".")===-1){var u=r-n.length,p=Dt.stringOfChar("0",u);a=n+p+".0"}return this.isNegative()?"-"+a:a};Dt.prototype.reciprocal=function(){var e=null,t=null,n=null,r=null,a=null,u=null,p=null,c=null;a=1/this._hi,u=Dt.SPLIT*a,e=u-a,c=Dt.SPLIT*this._hi,e=u-e,t=a-e,n=c-this._hi,p=a*this._hi,n=c-n,r=this._hi-n,c=e*n-p+e*r+t*n+t*r,u=(1-p-c-a*this._lo)/this._hi;var b=a+u,C=a-b+u;return new Dt(b,C)};Dt.prototype.toSciNotation=function(){if(this.isZero())return Dt.SCI_NOT_ZERO;var e=this.getSpecialNumberString();if(e!==null)return e;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),r=Dt.SCI_NOT_EXPONENT_CHAR+t[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var a="";n.length>1&&(a=n.substring(1));var u=n.charAt(0)+"."+a;return this.isNegative()?"-"+u+r:u+r};Dt.prototype.abs=function(){return this.isNaN()?Dt.NaN:this.isNegative()?this.negate():new Dt(this)};Dt.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Dt.prototype.lt=function(e){return(this._hi<e._hi||this._hi===e._hi)&&this._lo<e._lo};Dt.prototype.add=function(){if(arguments[0]instanceof Dt){var e=arguments[0];return Dt.copy(this).selfAdd(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return Dt.copy(this).selfAdd(t)}};Dt.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this._hi=e,this._lo=0}else if(arguments[0]instanceof Dt){var t=arguments[0];this._hi=t._hi,this._lo=t._lo}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._hi=n,this._lo=r}};Dt.prototype.gt=function(e){return(this._hi>e._hi||this._hi===e._hi)&&this._lo>e._lo};Dt.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Dt.prototype.trunc=function(){return this.isNaN()?Dt.NaN:this.isPositive()?this.floor():this.ceil()};Dt.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Dt.prototype.interfaces_=function(){return[Go,Uo,ag]};Dt.prototype.getClass=function(){return Dt};Dt.sqr=function(e){return Dt.valueOf(e).selfMultiply(e)};Dt.valueOf=function(){if(typeof arguments[0]=="string"){var e=arguments[0];return Dt.parse(e)}else if(typeof arguments[0]=="number"){var t=arguments[0];return new Dt(t)}};Dt.sqrt=function(e){return Dt.valueOf(e).sqrt()};Dt.parse=function(e){for(var t=0,n=e.length;Mf.isWhitespace(e.charAt(t));)t++;var r=!1;if(t<n){var a=e.charAt(t);(a==="-"||a==="+")&&(t++,a==="-"&&(r=!0))}for(var u=new Dt,p=0,c=0,b=0;!(t>=n);){var C=e.charAt(t);if(t++,Mf.isDigit(C)){var A=C-"0";u.selfMultiply(Dt.TEN),u.selfAdd(A),p++;continue}if(C==="."){c=p;continue}if(C==="e"||C==="E"){var P=e.substring(t);try{b=Ms.parseInt(P)}catch(ot){throw ot instanceof Error?new Error("Invalid exponent "+P+" in string "+e):ot}finally{}break}throw new Error("Unexpected character '"+C+"' at position "+t+" in string "+e)}var R=u,et=p-c-b;if(et===0)R=u;else if(et>0){var X=Dt.TEN.pow(et);R=u.divide(X)}else if(et<0){var K=Dt.TEN.pow(-et);R=u.multiply(K)}return r?R.negate():R};Dt.createNaN=function(){return new Dt(De.NaN,De.NaN)};Dt.copy=function(e){return new Dt(e)};Dt.magnitude=function(e){var t=Math.abs(e),n=Math.log(t)/Math.log(10),r=Math.trunc(Math.floor(n)),a=Math.pow(10,r);return a*10<=t&&(r+=1),r};Dt.stringOfChar=function(e,t){for(var n=new js,r=0;r<t;r++)n.append(e);return n.toString()};hs.PI.get=function(){return new Dt(3.141592653589793,12246467991473532e-32)};hs.TWO_PI.get=function(){return new Dt(6.283185307179586,24492935982947064e-32)};hs.PI_2.get=function(){return new Dt(1.5707963267948966,6123233995736766e-32)};hs.E.get=function(){return new Dt(2.718281828459045,14456468917292502e-32)};hs.NaN.get=function(){return new Dt(De.NaN,De.NaN)};hs.EPS.get=function(){return 123259516440783e-46};hs.SPLIT.get=function(){return 134217729};hs.MAX_PRINT_DIGITS.get=function(){return 32};hs.TEN.get=function(){return Dt.valueOf(10)};hs.ONE.get=function(){return Dt.valueOf(1)};hs.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};hs.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Dt,hs);var Oi=function(){},a2={DP_SAFE_EPSILON:{configurable:!0}};Oi.prototype.interfaces_=function(){return[]};Oi.prototype.getClass=function(){return Oi};Oi.orientationIndex=function(e,t,n){var r=Oi.orientationIndexFilter(e,t,n);if(r<=1)return r;var a=Dt.valueOf(t.x).selfAdd(-e.x),u=Dt.valueOf(t.y).selfAdd(-e.y),p=Dt.valueOf(n.x).selfAdd(-t.x),c=Dt.valueOf(n.y).selfAdd(-t.y);return a.selfMultiply(c).selfSubtract(u.selfMultiply(p)).signum()};Oi.signOfDet2x2=function(e,t,n,r){var a=e.multiply(r).selfSubtract(t.multiply(n));return a.signum()};Oi.intersection=function(e,t,n,r){var a=Dt.valueOf(r.y).selfSubtract(n.y).selfMultiply(Dt.valueOf(t.x).selfSubtract(e.x)),u=Dt.valueOf(r.x).selfSubtract(n.x).selfMultiply(Dt.valueOf(t.y).selfSubtract(e.y)),p=a.subtract(u),c=Dt.valueOf(r.x).selfSubtract(n.x).selfMultiply(Dt.valueOf(e.y).selfSubtract(n.y)),b=Dt.valueOf(r.y).selfSubtract(n.y).selfMultiply(Dt.valueOf(e.x).selfSubtract(n.x)),C=c.subtract(b),A=C.selfDivide(p).doubleValue(),P=Dt.valueOf(e.x).selfAdd(Dt.valueOf(t.x).selfSubtract(e.x).selfMultiply(A)).doubleValue(),R=Dt.valueOf(t.x).selfSubtract(e.x).selfMultiply(Dt.valueOf(e.y).selfSubtract(n.y)),et=Dt.valueOf(t.y).selfSubtract(e.y).selfMultiply(Dt.valueOf(e.x).selfSubtract(n.x)),X=R.subtract(et),K=X.selfDivide(p).doubleValue(),ot=Dt.valueOf(n.y).selfAdd(Dt.valueOf(r.y).selfSubtract(n.y).selfMultiply(K)).doubleValue();return new bt(P,ot)};Oi.orientationIndexFilter=function(e,t,n){var r=null,a=(e.x-n.x)*(t.y-n.y),u=(e.y-n.y)*(t.x-n.x),p=a-u;if(a>0){if(u<=0)return Oi.signum(p);r=a+u}else if(a<0){if(u>=0)return Oi.signum(p);r=-a-u}else return Oi.signum(p);var c=Oi.DP_SAFE_EPSILON*r;return p>=c||-p>=c?Oi.signum(p):2};Oi.signum=function(e){return e>0?1:e<0?-1:0};a2.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(Oi,a2);var fn=function(){},Kf={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Kf.X.get=function(){return 0};Kf.Y.get=function(){return 1};Kf.Z.get=function(){return 2};Kf.M.get=function(){return 3};fn.prototype.setOrdinate=function(e,t,n){};fn.prototype.size=function(){};fn.prototype.getOrdinate=function(e,t){};fn.prototype.getCoordinate=function(){};fn.prototype.getCoordinateCopy=function(e){};fn.prototype.getDimension=function(){};fn.prototype.getX=function(e){};fn.prototype.clone=function(){};fn.prototype.expandEnvelope=function(e){};fn.prototype.copy=function(){};fn.prototype.getY=function(e){};fn.prototype.toCoordinateArray=function(){};fn.prototype.interfaces_=function(){return[ag]};fn.prototype.getClass=function(){return fn};Object.defineProperties(fn,Kf);var l2=function(){},ep=function(e){function t(){e.call(this,"Projective point not representable on the Cartesian plane.")}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(l2),ri=function(){};ri.arraycopy=function(e,t,n,r,a){for(var u=0,p=t;p<t+a;p++)n[r+u]=e[p],u++};ri.getProperty=function(e){return{"line.separator":`
`}[e]};var es=function e(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],r=arguments[1];this.x=n,this.y=r,this.w=1}else if(arguments[0]instanceof e&&arguments[1]instanceof e){var a=arguments[0],u=arguments[1];this.x=a.y*u.w-u.y*a.w,this.y=u.x*a.w-a.x*u.w,this.w=a.x*u.y-u.x*a.y}else if(arguments[0]instanceof bt&&arguments[1]instanceof bt){var p=arguments[0],c=arguments[1];this.x=p.y-c.y,this.y=c.x-p.x,this.w=p.x*c.y-c.x*p.y}}else if(arguments.length===3){var b=arguments[0],C=arguments[1],A=arguments[2];this.x=b,this.y=C,this.w=A}else if(arguments.length===4){var P=arguments[0],R=arguments[1],et=arguments[2],X=arguments[3],K=P.y-R.y,ot=R.x-P.x,gt=P.x*R.y-R.x*P.y,q=et.y-X.y,W=X.x-et.x,at=et.x*X.y-X.x*et.y;this.x=ot*at-W*gt,this.y=q*gt-K*at,this.w=K*W-q*ot}};es.prototype.getY=function(){var e=this.y/this.w;if(De.isNaN(e)||De.isInfinite(e))throw new ep;return e};es.prototype.getX=function(){var e=this.x/this.w;if(De.isNaN(e)||De.isInfinite(e))throw new ep;return e};es.prototype.getCoordinate=function(){var e=new bt;return e.x=this.getX(),e.y=this.getY(),e};es.prototype.interfaces_=function(){return[]};es.prototype.getClass=function(){return es};es.intersection=function(e,t,n,r){var a=e.y-t.y,u=t.x-e.x,p=e.x*t.y-t.x*e.y,c=n.y-r.y,b=r.x-n.x,C=n.x*r.y-r.x*n.y,A=u*C-b*p,P=c*p-a*C,R=a*b-c*u,et=A/R,X=P/R;if(De.isNaN(et)||De.isInfinite(et)||De.isNaN(X)||De.isInfinite(X))throw new ep;return new bt(et,X)};var ye=function e(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof bt){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof e){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.init(r.x,a.x,r.y,a.y)}else if(arguments.length===4){var u=arguments[0],p=arguments[1],c=arguments[2],b=arguments[3];this.init(u,p,c,b)}},u2={serialVersionUID:{configurable:!0}};ye.prototype.getArea=function(){return this.getWidth()*this.getHeight()};ye.prototype.equals=function(e){if(!(e instanceof ye))return!1;var t=e;return this.isNull()?t.isNull():this._maxx===t.getMaxX()&&this._maxy===t.getMaxY()&&this._minx===t.getMinX()&&this._miny===t.getMinY()};ye.prototype.intersection=function(e){if(this.isNull()||e.isNull()||!this.intersects(e))return new ye;var t=this._minx>e._minx?this._minx:e._minx,n=this._miny>e._miny?this._miny:e._miny,r=this._maxx<e._maxx?this._maxx:e._maxx,a=this._maxy<e._maxy?this._maxy:e._maxy;return new ye(t,r,n,a)};ye.prototype.isNull=function(){return this._maxx<this._minx};ye.prototype.getMaxX=function(){return this._maxx};ye.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof bt){var e=arguments[0];return this.covers(e.x,e.y)}else if(arguments[0]instanceof ye){var t=arguments[0];return this.isNull()||t.isNull()?!1:t.getMinX()>=this._minx&&t.getMaxX()<=this._maxx&&t.getMinY()>=this._miny&&t.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&r>=this._miny&&r<=this._maxy}};ye.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof ye){var e=arguments[0];return this.isNull()||e.isNull()?!1:!(e._minx>this._maxx||e._maxx<this._minx||e._miny>this._maxy||e._maxy<this._miny)}else if(arguments[0]instanceof bt){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||r>this._maxy||r<this._miny)}};ye.prototype.getMinY=function(){return this._miny};ye.prototype.getMinX=function(){return this._minx};ye.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof bt){var e=arguments[0];this.expandToInclude(e.x,e.y)}else if(arguments[0]instanceof ye){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this._minx=t.getMinX(),this._maxx=t.getMaxX(),this._miny=t.getMinY(),this._maxy=t.getMaxY()):(t._minx<this._minx&&(this._minx=t._minx),t._maxx>this._maxx&&(this._maxx=t._maxx),t._miny<this._miny&&(this._miny=t._miny),t._maxy>this._maxy&&(this._maxy=t._maxy))}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=r,this._maxy=r):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),r<this._miny&&(this._miny=r),r>this._maxy&&(this._maxy=r))}};ye.prototype.minExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e<t?e:t};ye.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};ye.prototype.compareTo=function(e){var t=e;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this._minx<t._minx?-1:this._minx>t._minx?1:this._miny<t._miny?-1:this._miny>t._miny?1:this._maxx<t._maxx?-1:this._maxx>t._maxx?1:this._maxy<t._maxy?-1:this._maxy>t._maxy?1:0};ye.prototype.translate=function(e,t){if(this.isNull())return null;this.init(this.getMinX()+e,this.getMaxX()+e,this.getMinY()+t,this.getMaxY()+t)};ye.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};ye.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};ye.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};ye.prototype.maxExtent=function(){if(this.isNull())return 0;var e=this.getWidth(),t=this.getHeight();return e>t?e:t};ye.prototype.expandBy=function(){if(arguments.length===1){var e=arguments[0];this.expandBy(e,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=t,this._maxx+=t,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};ye.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof ye){var e=arguments[0];return this.covers(e)}else if(arguments[0]instanceof bt){var t=arguments[0];return this.covers(t)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.covers(n,r)}};ye.prototype.centre=function(){return this.isNull()?null:new bt((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};ye.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof bt){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof ye){var t=arguments[0];this._minx=t._minx,this._maxx=t._maxx,this._miny=t._miny,this._maxy=t._maxy}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.init(n.x,r.x,n.y,r.y)}else if(arguments.length===4){var a=arguments[0],u=arguments[1],p=arguments[2],c=arguments[3];a<u?(this._minx=a,this._maxx=u):(this._minx=u,this._maxx=a),p<c?(this._miny=p,this._maxy=c):(this._miny=c,this._maxy=p)}};ye.prototype.getMaxY=function(){return this._maxy};ye.prototype.distance=function(e){if(this.intersects(e))return 0;var t=0;this._maxx<e._minx?t=e._minx-this._maxx:this._minx>e._maxx&&(t=this._minx-e._maxx);var n=0;return this._maxy<e._miny?n=e._miny-this._maxy:this._miny>e._maxy&&(n=this._miny-e._maxy),t===0?n:n===0?t:Math.sqrt(t*t+n*n)};ye.prototype.hashCode=function(){var e=17;return e=37*e+bt.hashCode(this._minx),e=37*e+bt.hashCode(this._maxx),e=37*e+bt.hashCode(this._miny),e=37*e+bt.hashCode(this._maxy),e};ye.prototype.interfaces_=function(){return[Uo,Go]};ye.prototype.getClass=function(){return ye};ye.intersects=function(){if(arguments.length===3){var e=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(e.x<t.x?e.x:t.x)&&n.x<=(e.x>t.x?e.x:t.x)&&n.y>=(e.y<t.y?e.y:t.y)&&n.y<=(e.y>t.y?e.y:t.y)}else if(arguments.length===4){var r=arguments[0],a=arguments[1],u=arguments[2],p=arguments[3],c=Math.min(u.x,p.x),b=Math.max(u.x,p.x),C=Math.min(r.x,a.x),A=Math.max(r.x,a.x);return!(C>b||A<c||(c=Math.min(u.y,p.y),b=Math.max(u.y,p.y),C=Math.min(r.y,a.y),A=Math.max(r.y,a.y),C>b)||A<c)}};u2.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(ye,u2);var Is={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},lg=function(e){this.geometryFactory=e||new en};lg.prototype.read=function(e){var t,n,r;e=e.replace(/[\n\r]/g," ");var a=Is.typeStr.exec(e);if(e.search("EMPTY")!==-1&&(a=Is.emptyTypeStr.exec(e),a[2]=void 0),a&&(n=a[1].toLowerCase(),r=a[2],Sh[n]&&(t=Sh[n].apply(this,[r]))),t===void 0)throw new Error("Could not parse WKT "+e);return t};lg.prototype.write=function(e){return this.extractGeometry(e)};lg.prototype.extractGeometry=function(e){var t=e.getGeometryType().toLowerCase();if(!Aa[t])return null;var n=t.toUpperCase(),r;return e.isEmpty()?r=n+" EMPTY":r=n+"("+Aa[t].apply(this,[e])+")",r};var Aa={coordinate:function(e){return e.x+" "+e.y},point:function(e){return Aa.coordinate.call(this,e._coordinates._coordinates[0])},multipoint:function(e){for(var t=this,n=[],r=0,a=e._geometries.length;r<a;++r)n.push("("+Aa.point.apply(t,[e._geometries[r]])+")");return n.join(",")},linestring:function(e){for(var t=this,n=[],r=0,a=e._points._coordinates.length;r<a;++r)n.push(Aa.coordinate.apply(t,[e._points._coordinates[r]]));return n.join(",")},linearring:function(e){for(var t=this,n=[],r=0,a=e._points._coordinates.length;r<a;++r)n.push(Aa.coordinate.apply(t,[e._points._coordinates[r]]));return n.join(",")},multilinestring:function(e){for(var t=this,n=[],r=0,a=e._geometries.length;r<a;++r)n.push("("+Aa.linestring.apply(t,[e._geometries[r]])+")");return n.join(",")},polygon:function(e){var t=this,n=[];n.push("("+Aa.linestring.apply(this,[e._shell])+")");for(var r=0,a=e._holes.length;r<a;++r)n.push("("+Aa.linestring.apply(t,[e._holes[r]])+")");return n.join(",")},multipolygon:function(e){for(var t=this,n=[],r=0,a=e._geometries.length;r<a;++r)n.push("("+Aa.polygon.apply(t,[e._geometries[r]])+")");return n.join(",")},geometrycollection:function(e){for(var t=this,n=[],r=0,a=e._geometries.length;r<a;++r)n.push(t.extractGeometry(e._geometries[r]));return n.join(",")}},Sh={point:function(e){if(e===void 0)return this.geometryFactory.createPoint();var t=e.trim().split(Is.spaces);return this.geometryFactory.createPoint(new bt(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPoint();for(var n,r=e.trim().split(","),a=[],u=0,p=r.length;u<p;++u)n=r[u].replace(Is.trimParens,"$1"),a.push(Sh.point.apply(t,[n]));return this.geometryFactory.createMultiPoint(a)},linestring:function(e){if(e===void 0)return this.geometryFactory.createLineString();for(var t=e.trim().split(","),n=[],r,a=0,u=t.length;a<u;++a)r=t[a].trim().split(Is.spaces),n.push(new bt(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLineString(n)},linearring:function(e){if(e===void 0)return this.geometryFactory.createLinearRing();for(var t=e.trim().split(","),n=[],r,a=0,u=t.length;a<u;++a)r=t[a].trim().split(Is.spaces),n.push(new bt(Number.parseFloat(r[0]),Number.parseFloat(r[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiLineString();for(var n,r=e.trim().split(Is.parenComma),a=[],u=0,p=r.length;u<p;++u)n=r[u].replace(Is.trimParens,"$1"),a.push(Sh.linestring.apply(t,[n]));return this.geometryFactory.createMultiLineString(a)},polygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createPolygon();for(var n,r,a,u=e.trim().split(Is.parenComma),p,c=[],b=0,C=u.length;b<C;++b)n=u[b].replace(Is.trimParens,"$1"),r=Sh.linestring.apply(t,[n]),a=t.geometryFactory.createLinearRing(r._points),b===0?p=a:c.push(a);return this.geometryFactory.createPolygon(p,c)},multipolygon:function(e){var t=this;if(e===void 0)return this.geometryFactory.createMultiPolygon();for(var n,r=e.trim().split(Is.doubleParenComma),a=[],u=0,p=r.length;u<p;++u)n=r[u].replace(Is.trimParens,"$1"),a.push(Sh.polygon.apply(t,[n]));return this.geometryFactory.createMultiPolygon(a)},geometrycollection:function(e){var t=this;if(e===void 0)return this.geometryFactory.createGeometryCollection();e=e.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=e.trim().split("|"),r=[],a=0,u=n.length;a<u;++a)r.push(t.read(n[a]));return this.geometryFactory.createGeometryCollection(r)}},rs=function(e){this.parser=new lg(e)};rs.prototype.write=function(e){return this.parser.write(e)};rs.toLineString=function(e,t){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+e.x+" "+e.y+", "+t.x+" "+t.y+" )"};var Oa=function(e){function t(n){e.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new e().stack}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(Error),Zm=function(e){function t(){if(e.call(this),arguments.length===0)e.call(this);else if(arguments.length===1){var n=arguments[0];e.call(this,n)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Oa),Ve=function(){};Ve.prototype.interfaces_=function(){return[]};Ve.prototype.getClass=function(){return Ve};Ve.shouldNeverReachHere=function(){if(arguments.length===0)Ve.shouldNeverReachHere(null);else if(arguments.length===1){var e=arguments[0];throw new Zm("Should never reach here"+(e!==null?": "+e:""))}};Ve.isTrue=function(){var e,t;if(arguments.length===1)e=arguments[0],Ve.isTrue(e,null);else if(arguments.length===2&&(e=arguments[0],t=arguments[1],!e))throw t===null?new Zm:new Zm(t)};Ve.equals=function(){var e,t,n;if(arguments.length===2)e=arguments[0],t=arguments[1],Ve.equals(e,t,null);else if(arguments.length===3&&(e=arguments[0],t=arguments[1],n=arguments[2],!t.equals(e)))throw new Zm("Expected "+e+" but encountered "+t+(n!==null?": "+n:""))};var tr=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new bt,this._intPt[1]=new bt,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},hc={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};tr.prototype.getIndexAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intLineIndex[e][t]};tr.prototype.getTopologySummary=function(){var e=new js;return this.isEndPoint()&&e.append(" endpoint"),this._isProper&&e.append(" proper"),this.isCollinear()&&e.append(" collinear"),e.toString()};tr.prototype.computeIntersection=function(e,t,n,r){this._inputLines[0][0]=e,this._inputLines[0][1]=t,this._inputLines[1][0]=n,this._inputLines[1][1]=r,this._result=this.computeIntersect(e,t,n,r)};tr.prototype.getIntersectionNum=function(){return this._result};tr.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var e=arguments[0],t=this.getEdgeDistance(e,0),n=this.getEdgeDistance(e,1);t>n?(this._intLineIndex[e][0]=0,this._intLineIndex[e][1]=1):(this._intLineIndex[e][0]=1,this._intLineIndex[e][1]=0)}};tr.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};tr.prototype.setPrecisionModel=function(e){this._precisionModel=e};tr.prototype.isInteriorIntersection=function(){var e=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var t=arguments[0],n=0;n<this._result;n++)if(!(e._intPt[n].equals2D(e._inputLines[t][0])||e._intPt[n].equals2D(e._inputLines[t][1])))return!0;return!1}};tr.prototype.getIntersection=function(e){return this._intPt[e]};tr.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};tr.prototype.hasIntersection=function(){return this._result!==tr.NO_INTERSECTION};tr.prototype.getEdgeDistance=function(e,t){var n=tr.computeEdgeDistance(this._intPt[t],this._inputLines[e][0],this._inputLines[e][1]);return n};tr.prototype.isCollinear=function(){return this._result===tr.COLLINEAR_INTERSECTION};tr.prototype.toString=function(){return rs.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+rs.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};tr.prototype.getEndpoint=function(e,t){return this._inputLines[e][t]};tr.prototype.isIntersection=function(e){for(var t=this,n=0;n<this._result;n++)if(t._intPt[n].equals2D(e))return!0;return!1};tr.prototype.getIntersectionAlongSegment=function(e,t){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[e][t]]};tr.prototype.interfaces_=function(){return[]};tr.prototype.getClass=function(){return tr};tr.computeEdgeDistance=function(e,t,n){var r=Math.abs(n.x-t.x),a=Math.abs(n.y-t.y),u=-1;if(e.equals(t))u=0;else if(e.equals(n))r>a?u=r:u=a;else{var p=Math.abs(e.x-t.x),c=Math.abs(e.y-t.y);r>a?u=p:u=c,u===0&&!e.equals(t)&&(u=Math.max(p,c))}return Ve.isTrue(!(u===0&&!e.equals(t)),"Bad distance calculation"),u};tr.nonRobustComputeEdgeDistance=function(e,t,n){var r=e.x-t.x,a=e.y-t.y,u=Math.sqrt(r*r+a*a);return Ve.isTrue(!(u===0&&!e.equals(t)),"Invalid distance calculation"),u};hc.DONT_INTERSECT.get=function(){return 0};hc.DO_INTERSECT.get=function(){return 1};hc.COLLINEAR.get=function(){return 2};hc.NO_INTERSECTION.get=function(){return 0};hc.POINT_INTERSECTION.get=function(){return 1};hc.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(tr,hc);var du=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isInSegmentEnvelopes=function(n){var r=new ye(this._inputLines[0][0],this._inputLines[0][1]),a=new ye(this._inputLines[1][0],this._inputLines[1][1]);return r.contains(n)&&a.contains(n)},t.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];if(this._isProper=!1,ye.intersects(r,a,n)&&se.orientationIndex(r,a,n)===0&&se.orientationIndex(a,r,n)===0)return this._isProper=!0,(n.equals(r)||n.equals(a))&&(this._isProper=!1),this._result=e.POINT_INTERSECTION,null;this._result=e.NO_INTERSECTION}else return e.prototype.computeIntersection.apply(this,arguments)},t.prototype.normalizeToMinimum=function(n,r,a,u,p){p.x=this.smallestInAbsValue(n.x,r.x,a.x,u.x),p.y=this.smallestInAbsValue(n.y,r.y,a.y,u.y),n.x-=p.x,n.y-=p.y,r.x-=p.x,r.y-=p.y,a.x-=p.x,a.y-=p.y,u.x-=p.x,u.y-=p.y},t.prototype.safeHCoordinateIntersection=function(n,r,a,u){var p=null;try{p=es.intersection(n,r,a,u)}catch(c){if(c instanceof ep)p=t.nearestEndpoint(n,r,a,u);else throw c}finally{}return p},t.prototype.intersection=function(n,r,a,u){var p=this.intersectionWithNormalization(n,r,a,u);return this.isInSegmentEnvelopes(p)||(p=new bt(t.nearestEndpoint(n,r,a,u))),this._precisionModel!==null&&this._precisionModel.makePrecise(p),p},t.prototype.smallestInAbsValue=function(n,r,a,u){var p=n,c=Math.abs(p);return Math.abs(r)<c&&(p=r,c=Math.abs(r)),Math.abs(a)<c&&(p=a,c=Math.abs(a)),Math.abs(u)<c&&(p=u),p},t.prototype.checkDD=function(n,r,a,u,p){var c=Oi.intersection(n,r,a,u),b=this.isInSegmentEnvelopes(c);ri.out.println("DD in env = "+b+"  --------------------- "+c),p.distance(c)>1e-4&&ri.out.println("Distance = "+p.distance(c))},t.prototype.intersectionWithNormalization=function(n,r,a,u){var p=new bt(n),c=new bt(r),b=new bt(a),C=new bt(u),A=new bt;this.normalizeToEnvCentre(p,c,b,C,A);var P=this.safeHCoordinateIntersection(p,c,b,C);return P.x+=A.x,P.y+=A.y,P},t.prototype.computeCollinearIntersection=function(n,r,a,u){var p=ye.intersects(n,r,a),c=ye.intersects(n,r,u),b=ye.intersects(a,u,n),C=ye.intersects(a,u,r);return p&&c?(this._intPt[0]=a,this._intPt[1]=u,e.COLLINEAR_INTERSECTION):b&&C?(this._intPt[0]=n,this._intPt[1]=r,e.COLLINEAR_INTERSECTION):p&&b?(this._intPt[0]=a,this._intPt[1]=n,a.equals(n)&&!c&&!C?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):p&&C?(this._intPt[0]=a,this._intPt[1]=r,a.equals(r)&&!c&&!b?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):c&&b?(this._intPt[0]=u,this._intPt[1]=n,u.equals(n)&&!p&&!C?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):c&&C?(this._intPt[0]=u,this._intPt[1]=r,u.equals(r)&&!p&&!b?e.POINT_INTERSECTION:e.COLLINEAR_INTERSECTION):e.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(n,r,a,u,p){var c=n.x<r.x?n.x:r.x,b=n.y<r.y?n.y:r.y,C=n.x>r.x?n.x:r.x,A=n.y>r.y?n.y:r.y,P=a.x<u.x?a.x:u.x,R=a.y<u.y?a.y:u.y,et=a.x>u.x?a.x:u.x,X=a.y>u.y?a.y:u.y,K=c>P?c:P,ot=C<et?C:et,gt=b>R?b:R,q=A<X?A:X,W=(K+ot)/2,at=(gt+q)/2;p.x=W,p.y=at,n.x-=p.x,n.y-=p.y,r.x-=p.x,r.y-=p.y,a.x-=p.x,a.y-=p.y,u.x-=p.x,u.y-=p.y},t.prototype.computeIntersect=function(n,r,a,u){if(this._isProper=!1,!ye.intersects(n,r,a,u))return e.NO_INTERSECTION;var p=se.orientationIndex(n,r,a),c=se.orientationIndex(n,r,u);if(p>0&&c>0||p<0&&c<0)return e.NO_INTERSECTION;var b=se.orientationIndex(a,u,n),C=se.orientationIndex(a,u,r);if(b>0&&C>0||b<0&&C<0)return e.NO_INTERSECTION;var A=p===0&&c===0&&b===0&&C===0;return A?this.computeCollinearIntersection(n,r,a,u):(p===0||c===0||b===0||C===0?(this._isProper=!1,n.equals2D(a)||n.equals2D(u)?this._intPt[0]=n:r.equals2D(a)||r.equals2D(u)?this._intPt[0]=r:p===0?this._intPt[0]=new bt(a):c===0?this._intPt[0]=new bt(u):b===0?this._intPt[0]=new bt(n):C===0&&(this._intPt[0]=new bt(r))):(this._isProper=!0,this._intPt[0]=this.intersection(n,r,a,u)),e.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(n,r,a,u){var p=n,c=se.distancePointLine(n,a,u),b=se.distancePointLine(r,a,u);return b<c&&(c=b,p=r),b=se.distancePointLine(a,n,r),b<c&&(c=b,p=a),b=se.distancePointLine(u,n,r),b<c&&(c=b,p=u),p},t}(tr),Xu=function(){};Xu.prototype.interfaces_=function(){return[]};Xu.prototype.getClass=function(){return Xu};Xu.orientationIndex=function(e,t,n){var r=t.x-e.x,a=t.y-e.y,u=n.x-t.x,p=n.y-t.y;return Xu.signOfDet2x2(r,a,u,p)};Xu.signOfDet2x2=function(e,t,n,r){var a=null,u=null,p=null;if(a=1,e===0||r===0)return t===0||n===0?0:t>0?n>0?-a:a:n>0?a:-a;if(t===0||n===0)return r>0?e>0?a:-a:e>0?-a:a;if(t>0?r>0?t<=r||(a=-a,u=e,e=n,n=u,u=t,t=r,r=u):t<=-r?(a=-a,n=-n,r=-r):(u=e,e=-n,n=u,u=t,t=-r,r=u):r>0?-t<=r?(a=-a,e=-e,t=-t):(u=-e,e=n,n=u,u=-t,t=r,r=u):t>=r?(e=-e,t=-t,n=-n,r=-r):(a=-a,u=-e,e=-n,n=u,u=-t,t=-r,r=u),e>0)if(n>0){if(!(e<=n))return a}else return a;else{if(n>0)return-a;if(e>=n)a=-a,e=-e,n=-n;else return-a}for(;;){if(p=Math.floor(n/e),n=n-p*e,r=r-p*t,r<0)return-a;if(r>t)return a;if(e>n+n){if(t<r+r)return a}else{if(t>r+r)return-a;n=e-n,r=t-r,a=-a}if(r===0)return n===0?0:-a;if(n===0||(p=Math.floor(e/n),e=e-p*n,t=t-p*r,t<0))return a;if(t>r)return-a;if(n>e+e){if(r<t+t)return-a}else{if(r>t+t)return a;e=n-e,t=r-t,a=-a}if(t===0)return e===0?0:a;if(e===0)return-a}};var Ps=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var e=arguments[0];this._p=e};Ps.prototype.countSegment=function(e,t){if(e.x<this._p.x&&t.x<this._p.x)return null;if(this._p.x===t.x&&this._p.y===t.y)return this._isPointOnSegment=!0,null;if(e.y===this._p.y&&t.y===this._p.y){var n=e.x,r=t.x;return n>r&&(n=t.x,r=e.x),this._p.x>=n&&this._p.x<=r&&(this._isPointOnSegment=!0),null}if(e.y>this._p.y&&t.y<=this._p.y||t.y>this._p.y&&e.y<=this._p.y){var a=e.x-this._p.x,u=e.y-this._p.y,p=t.x-this._p.x,c=t.y-this._p.y,b=Xu.signOfDet2x2(a,u,p,c);if(b===0)return this._isPointOnSegment=!0,null;c<u&&(b=-b),b>0&&this._crossingCount++}};Ps.prototype.isPointInPolygon=function(){return this.getLocation()!==St.EXTERIOR};Ps.prototype.getLocation=function(){return this._isPointOnSegment?St.BOUNDARY:this._crossingCount%2===1?St.INTERIOR:St.EXTERIOR};Ps.prototype.isOnSegment=function(){return this._isPointOnSegment};Ps.prototype.interfaces_=function(){return[]};Ps.prototype.getClass=function(){return Ps};Ps.locatePointInRing=function(){if(arguments[0]instanceof bt&&Le(arguments[1],fn)){for(var e=arguments[0],t=arguments[1],n=new Ps(e),r=new bt,a=new bt,u=1;u<t.size();u++)if(t.getCoordinate(u,r),t.getCoordinate(u-1,a),n.countSegment(r,a),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof bt&&arguments[1]instanceof Array){for(var p=arguments[0],c=arguments[1],b=new Ps(p),C=1;C<c.length;C++){var A=c[C],P=c[C-1];if(b.countSegment(A,P),b.isOnSegment())return b.getLocation()}return b.getLocation()}};var se=function(){},pc={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};se.prototype.interfaces_=function(){return[]};se.prototype.getClass=function(){return se};se.orientationIndex=function(e,t,n){return Oi.orientationIndex(e,t,n)};se.signedArea=function(){if(arguments[0]instanceof Array){var e=arguments[0];if(e.length<3)return 0;for(var t=0,n=e[0].x,r=1;r<e.length-1;r++){var a=e[r].x-n,u=e[r+1].y,p=e[r-1].y;t+=a*(p-u)}return t/2}else if(Le(arguments[0],fn)){var c=arguments[0],b=c.size();if(b<3)return 0;var C=new bt,A=new bt,P=new bt;c.getCoordinate(0,A),c.getCoordinate(1,P);var R=A.x;P.x-=R;for(var et=0,X=1;X<b-1;X++)C.y=A.y,A.x=P.x,A.y=P.y,c.getCoordinate(X+1,P),P.x-=R,et+=A.x*(C.y-P.y);return et/2}};se.distanceLineLine=function(e,t,n,r){if(e.equals(t))return se.distancePointLine(e,n,r);if(n.equals(r))return se.distancePointLine(r,e,t);var a=!1;if(!ye.intersects(e,t,n,r))a=!0;else{var u=(t.x-e.x)*(r.y-n.y)-(t.y-e.y)*(r.x-n.x);if(u===0)a=!0;else{var p=(e.y-n.y)*(r.x-n.x)-(e.x-n.x)*(r.y-n.y),c=(e.y-n.y)*(t.x-e.x)-(e.x-n.x)*(t.y-e.y),b=c/u,C=p/u;(C<0||C>1||b<0||b>1)&&(a=!0)}}return a?wo.min(se.distancePointLine(e,n,r),se.distancePointLine(t,n,r),se.distancePointLine(n,e,t),se.distancePointLine(r,e,t)):0};se.isPointInRing=function(e,t){return se.locatePointInRing(e,t)!==St.EXTERIOR};se.computeLength=function(e){var t=e.size();if(t<=1)return 0;var n=0,r=new bt;e.getCoordinate(0,r);for(var a=r.x,u=r.y,p=1;p<t;p++){e.getCoordinate(p,r);var c=r.x,b=r.y,C=c-a,A=b-u;n+=Math.sqrt(C*C+A*A),a=c,u=b}return n};se.isCCW=function(e){var t=e.length-1;if(t<3)throw new Hn("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=e[0],r=0,a=1;a<=t;a++){var u=e[a];u.y>n.y&&(n=u,r=a)}var p=r;do p=p-1,p<0&&(p=t);while(e[p].equals2D(n)&&p!==r);var c=r;do c=(c+1)%t;while(e[c].equals2D(n)&&c!==r);var b=e[p],C=e[c];if(b.equals2D(n)||C.equals2D(n)||b.equals2D(C))return!1;var A=se.computeOrientation(b,n,C),P=!1;return A===0?P=b.x>C.x:P=A>0,P};se.locatePointInRing=function(e,t){return Ps.locatePointInRing(e,t)};se.distancePointLinePerpendicular=function(e,t,n){var r=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y),a=((t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y))/r;return Math.abs(a)*Math.sqrt(r)};se.computeOrientation=function(e,t,n){return se.orientationIndex(e,t,n)};se.distancePointLine=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(t.length===0)throw new Hn("Line array must contain at least one vertex");for(var n=e.distance(t[0]),r=0;r<t.length-1;r++){var a=se.distancePointLine(e,t[r],t[r+1]);a<n&&(n=a)}return n}else if(arguments.length===3){var u=arguments[0],p=arguments[1],c=arguments[2];if(p.x===c.x&&p.y===c.y)return u.distance(p);var b=(c.x-p.x)*(c.x-p.x)+(c.y-p.y)*(c.y-p.y),C=((u.x-p.x)*(c.x-p.x)+(u.y-p.y)*(c.y-p.y))/b;if(C<=0)return u.distance(p);if(C>=1)return u.distance(c);var A=((p.y-u.y)*(c.x-p.x)-(p.x-u.x)*(c.y-p.y))/b;return Math.abs(A)*Math.sqrt(b)}};se.isOnLine=function(e,t){for(var n=new du,r=1;r<t.length;r++){var a=t[r-1],u=t[r];if(n.computeIntersection(e,a,u),n.hasIntersection())return!0}return!1};pc.CLOCKWISE.get=function(){return-1};pc.RIGHT.get=function(){return se.CLOCKWISE};pc.COUNTERCLOCKWISE.get=function(){return 1};pc.LEFT.get=function(){return se.COUNTERCLOCKWISE};pc.COLLINEAR.get=function(){return 0};pc.STRAIGHT.get=function(){return se.COLLINEAR};Object.defineProperties(se,pc);var za=function(){};za.prototype.filter=function(e){};za.prototype.interfaces_=function(){return[]};za.prototype.getClass=function(){return za};var Te=function(){var e=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=e,this._SRID=e.getSRID()},ma={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Te.prototype.isGeometryCollection=function(){return this.getSortIndex()===Te.SORTINDEX_GEOMETRYCOLLECTION};Te.prototype.getFactory=function(){return this._factory};Te.prototype.getGeometryN=function(e){return this};Te.prototype.getArea=function(){return 0};Te.prototype.isRectangle=function(){return!1};Te.prototype.equals=function(){if(arguments[0]instanceof Te){var e=arguments[0];return e===null?!1:this.equalsTopo(e)}else if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof Te))return!1;var n=t;return this.equalsExact(n)}};Te.prototype.equalsExact=function(e){return this===e||this.equalsExact(e,0)};Te.prototype.geometryChanged=function(){this.apply(Te.geometryChangedFilter)};Te.prototype.geometryChangedAction=function(){this._envelope=null};Te.prototype.equalsNorm=function(e){return e===null?!1:this.norm().equalsExact(e.norm())};Te.prototype.getLength=function(){return 0};Te.prototype.getNumGeometries=function(){return 1};Te.prototype.compareTo=function(){if(arguments.length===1){var e=arguments[0],t=e;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(e)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,r)}};Te.prototype.getUserData=function(){return this._userData};Te.prototype.getSRID=function(){return this._SRID};Te.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};Te.prototype.checkNotGeometryCollection=function(e){if(e.getSortIndex()===Te.SORTINDEX_GEOMETRYCOLLECTION)throw new Hn("This method does not support GeometryCollection arguments")};Te.prototype.equal=function(e,t,n){return n===0?e.equals(t):e.distance(t)<=n};Te.prototype.norm=function(){var e=this.copy();return e.normalize(),e};Te.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Te.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new ye(this._envelope)};Te.prototype.setSRID=function(e){this._SRID=e};Te.prototype.setUserData=function(e){this._userData=e};Te.prototype.compare=function(e,t){for(var n=e.iterator(),r=t.iterator();n.hasNext()&&r.hasNext();){var a=n.next(),u=r.next(),p=a.compareTo(u);if(p!==0)return p}return n.hasNext()?1:r.hasNext()?-1:0};Te.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Te.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Te.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Te.SORTINDEX_MULTIPOINT||this.getSortIndex()===Te.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Te.SORTINDEX_MULTIPOLYGON};Te.prototype.interfaces_=function(){return[ag,Uo,Go]};Te.prototype.getClass=function(){return Te};Te.hasNonEmptyElements=function(e){for(var t=0;t<e.length;t++)if(!e[t].isEmpty())return!0;return!1};Te.hasNullElements=function(e){for(var t=0;t<e.length;t++)if(e[t]===null)return!0;return!1};ma.serialVersionUID.get=function(){return 8763622679187377e3};ma.SORTINDEX_POINT.get=function(){return 0};ma.SORTINDEX_MULTIPOINT.get=function(){return 1};ma.SORTINDEX_LINESTRING.get=function(){return 2};ma.SORTINDEX_LINEARRING.get=function(){return 3};ma.SORTINDEX_MULTILINESTRING.get=function(){return 4};ma.SORTINDEX_POLYGON.get=function(){return 5};ma.SORTINDEX_MULTIPOLYGON.get=function(){return 6};ma.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};ma.geometryChangedFilter.get=function(){return i0};Object.defineProperties(Te,ma);var i0=function(){};i0.interfaces_=function(){return[za]};i0.filter=function(e){e.geometryChangedAction()};var sa=function(){};sa.prototype.filter=function(e){};sa.prototype.interfaces_=function(){return[]};sa.prototype.getClass=function(){return sa};var Oo=function(){},ja={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Oo.prototype.isInBoundary=function(e){};Oo.prototype.interfaces_=function(){return[]};Oo.prototype.getClass=function(){return Oo};ja.Mod2BoundaryNodeRule.get=function(){return Rh};ja.EndPointBoundaryNodeRule.get=function(){return Nh};ja.MultiValentEndPointBoundaryNodeRule.get=function(){return Oh};ja.MonoValentEndPointBoundaryNodeRule.get=function(){return zh};ja.MOD2_BOUNDARY_RULE.get=function(){return new Rh};ja.ENDPOINT_BOUNDARY_RULE.get=function(){return new Nh};ja.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Oh};ja.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new zh};ja.OGC_SFS_BOUNDARY_RULE.get=function(){return Oo.MOD2_BOUNDARY_RULE};Object.defineProperties(Oo,ja);var Rh=function(){};Rh.prototype.isInBoundary=function(e){return e%2===1};Rh.prototype.interfaces_=function(){return[Oo]};Rh.prototype.getClass=function(){return Rh};var Nh=function(){};Nh.prototype.isInBoundary=function(e){return e>0};Nh.prototype.interfaces_=function(){return[Oo]};Nh.prototype.getClass=function(){return Nh};var Oh=function(){};Oh.prototype.isInBoundary=function(e){return e>1};Oh.prototype.interfaces_=function(){return[Oo]};Oh.prototype.getClass=function(){return Oh};var zh=function(){};zh.prototype.isInBoundary=function(e){return e===1};zh.prototype.interfaces_=function(){return[Oo]};zh.prototype.getClass=function(){return zh};var Cr=function(){};Cr.prototype.add=function(){};Cr.prototype.addAll=function(){};Cr.prototype.isEmpty=function(){};Cr.prototype.iterator=function(){};Cr.prototype.size=function(){};Cr.prototype.toArray=function(){};Cr.prototype.remove=function(){};function o0(e){this.message=e||""}o0.prototype=new Error;o0.prototype.name="IndexOutOfBoundsException";var np=function(){};np.prototype.hasNext=function(){};np.prototype.next=function(){};np.prototype.remove=function(){};var ns=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(Cr);function rp(e){this.message=e||""}rp.prototype=new Error;rp.prototype.name="NoSuchElementException";var Qt=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Cr&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[e,Cr]},t.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(n){for(var r=this,a=n.iterator();a.hasNext();)r.add(a.next());return!0},t.prototype.set=function(n,r){var a=this.array_[n];return this.array_[n]=r,a},t.prototype.iterator=function(){return new fM(this)},t.prototype.get=function(n){if(n<0||n>=this.size())throw new o0;return this.array_[n]},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var n=this,r=[],a=0,u=this.array_.length;a<u;a++)r.push(n.array_[a]);return r},t.prototype.remove=function(n){for(var r=this,a=!1,u=0,p=this.array_.length;u<p;u++)if(r.array_[u]===n){r.array_.splice(u,1),a=!0;break}return a},t}(ns),fM=function(e){function t(n){e.call(this),this.arrayList_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new rp;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(np),Jf=function(e){function t(){if(e.call(this),arguments.length!==0){if(arguments.length===1){var r=arguments[0];this.ensureCapacity(r.length),this.add(r,!0)}else if(arguments.length===2){var a=arguments[0],u=arguments[1];this.ensureCapacity(a.length),this.add(a,u)}}}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(r){return this.get(r)},t.prototype.addAll=function(){var r=this;if(arguments.length===2){for(var a=arguments[0],u=arguments[1],p=!1,c=a.iterator();c.hasNext();)r.add(c.next(),u),p=!0;return p}else return e.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var r=this,a=e.prototype.clone.call(this),u=0;u<this.size();u++)a.add(u,r.get(u).copy());return a},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var r=this;if(arguments.length===1){var a=arguments[0];e.prototype.add.call(this,a)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var u=arguments[0],p=arguments[1];return this.add(u,p,!0),!0}else if(arguments[0]instanceof bt&&typeof arguments[1]=="boolean"){var c=arguments[0],b=arguments[1];if(!b&&this.size()>=1){var C=this.get(this.size()-1);if(C.equals2D(c))return null}e.prototype.add.call(this,c)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var A=arguments[0],P=arguments[1];return this.add(A,P),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var R=arguments[0],et=arguments[1],X=arguments[2];if(X)for(var K=0;K<R.length;K++)r.add(R[K],et);else for(var ot=R.length-1;ot>=0;ot--)r.add(R[ot],et);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof bt){var gt=arguments[0],q=arguments[1],W=arguments[2];if(!W){var at=this.size();if(at>0){if(gt>0){var dt=this.get(gt-1);if(dt.equals2D(q))return null}if(gt<at){var Pt=this.get(gt);if(Pt.equals2D(q))return null}}}e.prototype.add.call(this,gt,q)}}else if(arguments.length===4){var Mt=arguments[0],Tt=arguments[1],Ut=arguments[2],qt=arguments[3],Q=1;Ut>qt&&(Q=-1);for(var Et=Ut;Et!==qt;Et+=Q)r.add(Mt[Et],Tt);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new bt(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(Qt),Qe=function(){},ug={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};ug.ForwardComparator.get=function(){return Df};ug.BidirectionalComparator.get=function(){return Fh};ug.coordArrayType.get=function(){return new Array(0).fill(null)};Qe.prototype.interfaces_=function(){return[]};Qe.prototype.getClass=function(){return Qe};Qe.isRing=function(e){return!(e.length<4||!e[0].equals2D(e[e.length-1]))};Qe.ptNotInList=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(Qe.indexOf(r,t)<0)return r}return null};Qe.scroll=function(e,t){var n=Qe.indexOf(t,e);if(n<0)return null;var r=new Array(e.length).fill(null);ri.arraycopy(e,n,r,0,e.length-n),ri.arraycopy(e,0,r,e.length-n,n),ri.arraycopy(r,0,e,0,e.length)};Qe.equals=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];if(e===t)return!0;if(e===null||t===null||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!e[n].equals(t[n]))return!1;return!0}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];if(r===a)return!0;if(r===null||a===null||r.length!==a.length)return!1;for(var p=0;p<r.length;p++)if(u.compare(r[p],a[p])!==0)return!1;return!0}};Qe.intersection=function(e,t){for(var n=new Jf,r=0;r<e.length;r++)t.intersects(e[r])&&n.add(e[r],!0);return n.toCoordinateArray()};Qe.hasRepeatedPoints=function(e){for(var t=1;t<e.length;t++)if(e[t-1].equals(e[t]))return!0;return!1};Qe.removeRepeatedPoints=function(e){if(!Qe.hasRepeatedPoints(e))return e;var t=new Jf(e,!1);return t.toCoordinateArray()};Qe.reverse=function(e){for(var t=e.length-1,n=Math.trunc(t/2),r=0;r<=n;r++){var a=e[r];e[r]=e[t-r],e[t-r]=a}};Qe.removeNull=function(e){for(var t=0,n=0;n<e.length;n++)e[n]!==null&&t++;var r=new Array(t).fill(null);if(t===0)return r;for(var a=0,u=0;u<e.length;u++)e[u]!==null&&(r[a++]=e[u]);return r};Qe.copyDeep=function(){if(arguments.length===1){for(var e=arguments[0],t=new Array(e.length).fill(null),n=0;n<e.length;n++)t[n]=new bt(e[n]);return t}else if(arguments.length===5)for(var r=arguments[0],a=arguments[1],u=arguments[2],p=arguments[3],c=arguments[4],b=0;b<c;b++)u[p+b]=new bt(r[a+b])};Qe.isEqualReversed=function(e,t){for(var n=0;n<e.length;n++){var r=e[n],a=t[e.length-n-1];if(r.compareTo(a)!==0)return!1}return!0};Qe.envelope=function(e){for(var t=new ye,n=0;n<e.length;n++)t.expandToInclude(e[n]);return t};Qe.toCoordinateArray=function(e){return e.toArray(Qe.coordArrayType)};Qe.atLeastNCoordinatesOrNothing=function(e,t){return t.length>=e?t:[]};Qe.indexOf=function(e,t){for(var n=0;n<t.length;n++)if(e.equals(t[n]))return n;return-1};Qe.increasingDirection=function(e){for(var t=0;t<Math.trunc(e.length/2);t++){var n=e.length-1-t,r=e[t].compareTo(e[n]);if(r!==0)return r}return 1};Qe.compare=function(e,t){for(var n=0;n<e.length&&n<t.length;){var r=e[n].compareTo(t[n]);if(r!==0)return r;n++}return n<t.length?-1:n<e.length?1:0};Qe.minCoordinate=function(e){for(var t=null,n=0;n<e.length;n++)(t===null||t.compareTo(e[n])>0)&&(t=e[n]);return t};Qe.extract=function(e,t,n){t=wo.clamp(t,0,e.length),n=wo.clamp(n,-1,e.length);var r=n-t+1;n<0&&(r=0),t>=e.length&&(r=0),n<t&&(r=0);var a=new Array(r).fill(null);if(r===0)return a;for(var u=0,p=t;p<=n;p++)a[u++]=e[p];return a};Object.defineProperties(Qe,ug);var Df=function(){};Df.prototype.compare=function(e,t){var n=e,r=t;return Qe.compare(n,r)};Df.prototype.interfaces_=function(){return[Dh]};Df.prototype.getClass=function(){return Df};var Fh=function(){};Fh.prototype.compare=function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;var a=Qe.compare(n,r),u=Qe.isEqualReversed(n,r);return u?0:a};Fh.prototype.OLDcompare=function(e,t){var n=e,r=t;if(n.length<r.length)return-1;if(n.length>r.length)return 1;if(n.length===0)return 0;for(var a=Qe.increasingDirection(n),u=Qe.increasingDirection(r),p=a>0?0:n.length-1,c=u>0?0:n.length-1,b=0;b<n.length;b++){var C=n[p].compareTo(r[c]);if(C!==0)return C;p+=a,c+=u}return 0};Fh.prototype.interfaces_=function(){return[Dh]};Fh.prototype.getClass=function(){return Fh};var fc=function(){};fc.prototype.get=function(){};fc.prototype.put=function(){};fc.prototype.size=function(){};fc.prototype.values=function(){};fc.prototype.entrySet=function(){};var dM=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t}(fc);function Qf(e){this.message=e||""}Qf.prototype=new Error;Qf.prototype.name="OperationNotSupported";function cg(){}cg.prototype=new Cr;cg.prototype.contains=function(){};var s0=function(e){function t(){e.call(this),this.array_=[],arguments[0]instanceof Cr&&this.addAll(arguments[0])}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.contains=function(n){for(var r=this,a=0,u=this.array_.length;a<u;a++){var p=r.array_[a];if(p===n)return!0}return!1},t.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},t.prototype.addAll=function(n){for(var r=this,a=n.iterator();a.hasNext();)r.add(a.next());return!0},t.prototype.remove=function(n){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return this.array_.length===0},t.prototype.toArray=function(){for(var n=this,r=[],a=0,u=this.array_.length;a<u;a++)r.push(n.array_[a]);return r},t.prototype.iterator=function(){return new mM(this)},t}(cg),mM=function(e){function t(n){e.call(this),this.hashSet_=n,this.position_=0}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new rp;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new Qf},t}(np),Da=0,Yl=1;function Hx(e){return e===null?Da:e.color}function On(e){return e===null?null:e.parent}function La(e,t){e!==null&&(e.color=t)}function Yy(e){return e===null?null:e.left}function Xx(e){return e===null?null:e.right}function hi(){this.root_=null,this.size_=0}hi.prototype=new dM;hi.prototype.get=function(e){for(var t=this.root_;t!==null;){var n=e.compareTo(t.key);if(n<0)t=t.left;else if(n>0)t=t.right;else return t.value}return null};hi.prototype.put=function(e,t){if(this.root_===null)return this.root_={key:e,value:t,left:null,right:null,parent:null,color:Da,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,r,a;do if(r=n,a=e.compareTo(n.key),a<0)n=n.left;else if(a>0)n=n.right;else{var u=n.value;return n.value=t,u}while(n!==null);var p={key:e,left:null,right:null,value:t,parent:r,color:Da,getValue:function(){return this.value},getKey:function(){return this.key}};return a<0?r.left=p:r.right=p,this.fixAfterInsertion(p),this.size_++,null};hi.prototype.fixAfterInsertion=function(e){var t=this;for(e.color=Yl;e!=null&&e!==this.root_&&e.parent.color===Yl;)if(On(e)===Yy(On(On(e)))){var n=Xx(On(On(e)));Hx(n)===Yl?(La(On(e),Da),La(n,Da),La(On(On(e)),Yl),e=On(On(e))):(e===Xx(On(e))&&(e=On(e),t.rotateLeft(e)),La(On(e),Da),La(On(On(e)),Yl),t.rotateRight(On(On(e))))}else{var r=Yy(On(On(e)));Hx(r)===Yl?(La(On(e),Da),La(r,Da),La(On(On(e)),Yl),e=On(On(e))):(e===Yy(On(e))&&(e=On(e),t.rotateRight(e)),La(On(e),Da),La(On(On(e)),Yl),t.rotateLeft(On(On(e))))}this.root_.color=Da};hi.prototype.values=function(){var e=new Qt,t=this.getFirstEntry();if(t!==null)for(e.add(t.value);(t=hi.successor(t))!==null;)e.add(t.value);return e};hi.prototype.entrySet=function(){var e=new s0,t=this.getFirstEntry();if(t!==null)for(e.add(t);(t=hi.successor(t))!==null;)e.add(t);return e};hi.prototype.rotateLeft=function(e){if(e!=null){var t=e.right;e.right=t.left,t.left!=null&&(t.left.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}};hi.prototype.rotateRight=function(e){if(e!=null){var t=e.left;e.left=t.right,t.right!=null&&(t.right.parent=e),t.parent=e.parent,e.parent===null?this.root_=t:e.parent.right===e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}};hi.prototype.getFirstEntry=function(){var e=this.root_;if(e!=null)for(;e.left!=null;)e=e.left;return e};hi.successor=function(e){if(e===null)return null;if(e.right!==null){for(var t=e.right;t.left!==null;)t=t.left;return t}else{for(var n=e.parent,r=e;n!==null&&r===n.right;)r=n,n=n.parent;return n}};hi.prototype.size=function(){return this.size_};var kf=function(){};kf.prototype.interfaces_=function(){return[]};kf.prototype.getClass=function(){return kf};function c2(){}c2.prototype=new cg;function Ds(){this.array_=[],arguments[0]instanceof Cr&&this.addAll(arguments[0])}Ds.prototype=new c2;Ds.prototype.contains=function(e){for(var t=this,n=0,r=this.array_.length;n<r;n++){var a=t.array_[n];if(a.compareTo(e)===0)return!0}return!1};Ds.prototype.add=function(e){var t=this;if(this.contains(e))return!1;for(var n=0,r=this.array_.length;n<r;n++){var a=t.array_[n];if(a.compareTo(e)===1)return t.array_.splice(n,0,e),!0}return this.array_.push(e),!0};Ds.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next());return!0};Ds.prototype.remove=function(e){throw new Qf};Ds.prototype.size=function(){return this.array_.length};Ds.prototype.isEmpty=function(){return this.array_.length===0};Ds.prototype.toArray=function(){for(var e=this,t=[],n=0,r=this.array_.length;n<r;n++)t.push(e.array_[n]);return t};Ds.prototype.iterator=function(){return new hg(this)};var hg=function(e){this.treeSet_=e,this.position_=0};hg.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new rp;return this.treeSet_.array_[this.position_++]};hg.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};hg.prototype.remove=function(){throw new Qf};var tu=function(){};tu.sort=function(){var e=arguments[0],t,n,r,a;if(arguments.length===1)a=function(p,c){return p.compareTo(c)},e.sort(a);else if(arguments.length===2)r=arguments[1],a=function(p,c){return r.compare(p,c)},e.sort(a);else if(arguments.length===3){n=e.slice(arguments[1],arguments[2]),n.sort();var u=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length));for(e.splice(0,e.length),t=0;t<u.length;t++)e.push(u[t])}else if(arguments.length===4)for(n=e.slice(arguments[1],arguments[2]),r=arguments[3],a=function(p,c){return r.compare(p,c)},n.sort(a),u=e.slice(0,arguments[1]).concat(n,e.slice(arguments[2],e.length)),e.splice(0,e.length),t=0;t<u.length;t++)e.push(u[t])};tu.asList=function(e){for(var t=new Qt,n=0,r=e.length;n<r;n++)t.add(e[n]);return t};var vn=function(){},ps={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};ps.P.get=function(){return 0};ps.L.get=function(){return 1};ps.A.get=function(){return 2};ps.FALSE.get=function(){return-1};ps.TRUE.get=function(){return-2};ps.DONTCARE.get=function(){return-3};ps.SYM_FALSE.get=function(){return"F"};ps.SYM_TRUE.get=function(){return"T"};ps.SYM_DONTCARE.get=function(){return"*"};ps.SYM_P.get=function(){return"0"};ps.SYM_L.get=function(){return"1"};ps.SYM_A.get=function(){return"2"};vn.prototype.interfaces_=function(){return[]};vn.prototype.getClass=function(){return vn};vn.toDimensionSymbol=function(e){switch(e){case vn.FALSE:return vn.SYM_FALSE;case vn.TRUE:return vn.SYM_TRUE;case vn.DONTCARE:return vn.SYM_DONTCARE;case vn.P:return vn.SYM_P;case vn.L:return vn.SYM_L;case vn.A:return vn.SYM_A}throw new Hn("Unknown dimension value: "+e)};vn.toDimensionValue=function(e){switch(Mf.toUpperCase(e)){case vn.SYM_FALSE:return vn.FALSE;case vn.SYM_TRUE:return vn.TRUE;case vn.SYM_DONTCARE:return vn.DONTCARE;case vn.SYM_P:return vn.P;case vn.SYM_L:return vn.L;case vn.SYM_A:return vn.A}throw new Hn("Unknown dimension symbol: "+e)};Object.defineProperties(vn,ps);var ks=function(){};ks.prototype.filter=function(e){};ks.prototype.interfaces_=function(){return[]};ks.prototype.getClass=function(){return ks};var is=function(){};is.prototype.filter=function(e,t){};is.prototype.isDone=function(){};is.prototype.isGeometryChanged=function(){};is.prototype.interfaces_=function(){return[]};is.prototype.getClass=function(){return is};var Ii=function(e){function t(r,a){if(e.call(this,a),this._geometries=r||[],e.hasNullElements(this._geometries))throw new Hn("geometries must not contain null elements")}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var r=this,a=new ye,u=0;u<this._geometries.length;u++)a.expandToInclude(r._geometries[u].getEnvelopeInternal());return a},t.prototype.getGeometryN=function(r){return this._geometries[r]},t.prototype.getSortIndex=function(){return e.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var r=this,a=new Array(this.getNumPoints()).fill(null),u=-1,p=0;p<this._geometries.length;p++)for(var c=r._geometries[p].getCoordinates(),b=0;b<c.length;b++)u++,a[u]=c[b];return a},t.prototype.getArea=function(){for(var r=this,a=0,u=0;u<this._geometries.length;u++)a+=r._geometries[u].getArea();return a},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var a=arguments[0],u=arguments[1];if(!this.isEquivalentClass(a))return!1;var p=a;if(this._geometries.length!==p._geometries.length)return!1;for(var c=0;c<this._geometries.length;c++)if(!r._geometries[c].equalsExact(p._geometries[c],u))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var r=this,a=0;a<this._geometries.length;a++)r._geometries[a].normalize();tu.sort(this._geometries)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var r=this,a=vn.FALSE,u=0;u<this._geometries.length;u++)a=Math.max(a,r._geometries[u].getBoundaryDimension());return a},t.prototype.getDimension=function(){for(var r=this,a=vn.FALSE,u=0;u<this._geometries.length;u++)a=Math.max(a,r._geometries[u].getDimension());return a},t.prototype.getLength=function(){for(var r=this,a=0,u=0;u<this._geometries.length;u++)a+=r._geometries[u].getLength();return a},t.prototype.getNumPoints=function(){for(var r=this,a=0,u=0;u<this._geometries.length;u++)a+=r._geometries[u].getNumPoints();return a},t.prototype.getNumGeometries=function(){return this._geometries.length},t.prototype.reverse=function(){for(var r=this,a=this._geometries.length,u=new Array(a).fill(null),p=0;p<this._geometries.length;p++)u[p]=r._geometries[p].reverse();return this.getFactory().createGeometryCollection(u)},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var a=arguments[0],u=new Ds(tu.asList(this._geometries)),p=new Ds(tu.asList(a._geometries));return this.compare(u,p)}else if(arguments.length===2){for(var c=arguments[0],b=arguments[1],C=c,A=this.getNumGeometries(),P=C.getNumGeometries(),R=0;R<A&&R<P;){var et=r.getGeometryN(R),X=C.getGeometryN(R),K=et.compareToSameClass(X,b);if(K!==0)return K;R++}return R<A?1:R<P?-1:0}},t.prototype.apply=function(){var r=this;if(Le(arguments[0],sa))for(var a=arguments[0],u=0;u<this._geometries.length;u++)r._geometries[u].apply(a);else if(Le(arguments[0],is)){var p=arguments[0];if(this._geometries.length===0)return null;for(var c=0;c<this._geometries.length&&(r._geometries[c].apply(p),!p.isDone());c++);p.isGeometryChanged()&&this.geometryChanged()}else if(Le(arguments[0],ks)){var b=arguments[0];b.filter(this);for(var C=0;C<this._geometries.length;C++)r._geometries[C].apply(b)}else if(Le(arguments[0],za)){var A=arguments[0];A.filter(this);for(var P=0;P<this._geometries.length;P++)r._geometries[P].apply(A)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Ve.shouldNeverReachHere(),null},t.prototype.clone=function(){var r=this,a=e.prototype.clone.call(this);a._geometries=new Array(this._geometries.length).fill(null);for(var u=0;u<this._geometries.length;u++)a._geometries[u]=r._geometries[u].clone();return a},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var r=this,a=new Array(this._geometries.length).fill(null),u=0;u<a.length;u++)a[u]=r._geometries[u].copy();return new t(a,this._factory)},t.prototype.isEmpty=function(){for(var r=this,a=0;a<this._geometries.length;a++)if(!r._geometries[a].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(t,n),t}(Te),ru=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Te.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.isEquivalentClass(r)?e.prototype.equalsExact.call(this,r,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?vn.FALSE:0},t.prototype.isClosed=function(){var r=this;if(this.isEmpty())return!1;for(var a=0;a<this._geometries.length;a++)if(!r._geometries[a].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var r=this,a=this._geometries.length,u=new Array(a).fill(null),p=0;p<this._geometries.length;p++)u[a-1-p]=r._geometries[p].reverse();return this.getFactory().createMultiLineString(u)},t.prototype.getBoundary=function(){return new ko(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var r=this,a=new Array(this._geometries.length).fill(null),u=0;u<a.length;u++)a[u]=r._geometries[u].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[kf]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(t,n),t}(Ii),ko=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var e=arguments[0],t=Oo.MOD2_BOUNDARY_RULE;this._geom=e,this._geomFact=e.getFactory(),this._bnRule=t}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=r}};ko.prototype.boundaryMultiLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(e);return t.length===1?this._geomFact.createPoint(t[0]):this._geomFact.createMultiPointFromCoords(t)};ko.prototype.getBoundary=function(){return this._geom instanceof ar?this.boundaryLineString(this._geom):this._geom instanceof ru?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};ko.prototype.boundaryLineString=function(e){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(e.isClosed()){var t=this._bnRule.isInBoundary(2);return t?e.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([e.getStartPoint(),e.getEndPoint()])};ko.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};ko.prototype.computeBoundaryCoordinates=function(e){var t=this,n=new Qt;this._endpointMap=new hi;for(var r=0;r<e.getNumGeometries();r++){var a=e.getGeometryN(r);a.getNumPoints()!==0&&(t.addEndpoint(a.getCoordinateN(0)),t.addEndpoint(a.getCoordinateN(a.getNumPoints()-1)))}for(var u=this._endpointMap.entrySet().iterator();u.hasNext();){var p=u.next(),c=p.getValue(),b=c.count;t._bnRule.isInBoundary(b)&&n.add(p.getKey())}return Qe.toCoordinateArray(n)};ko.prototype.addEndpoint=function(e){var t=this._endpointMap.get(e);t===null&&(t=new Hm,this._endpointMap.put(e,t)),t.count++};ko.prototype.interfaces_=function(){return[]};ko.prototype.getClass=function(){return ko};ko.getBoundary=function(){if(arguments.length===1){var e=arguments[0],t=new ko(e);return t.getBoundary()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=new ko(n,r);return a.getBoundary()}};var Hm=function(){this.count=null};Hm.prototype.interfaces_=function(){return[]};Hm.prototype.getClass=function(){return Hm};function gM(){}function yM(){}var _M=function(){};function vM(){}function xM(){}function bM(){}var Ro=function(){},a0={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Ro.prototype.interfaces_=function(){return[]};Ro.prototype.getClass=function(){return Ro};Ro.chars=function(e,t){for(var n=new Array(t).fill(null),r=0;r<t;r++)n[r]=e;return String(n)};Ro.getStackTrace=function(){if(arguments.length===1){var e=arguments[0],t=new vM,n=new gM;return e.printStackTrace(n),t.toString()}else if(arguments.length===2){var r=arguments[0],a=arguments[1],u="";new yM(Ro.getStackTrace(r));for(var p=new bM,c=0;c<a;c++)try{u+=p.readLine()+Ro.NEWLINE}catch(b){if(b instanceof xM)Ve.shouldNeverReachHere();else throw b}finally{}return u}};Ro.split=function(e,t){for(var n=t.length,r=new Qt,a=""+e,u=a.indexOf(t);u>=0;){var p=a.substring(0,u);r.add(p),a=a.substring(u+n),u=a.indexOf(t)}a.length>0&&r.add(a);for(var c=new Array(r.size()).fill(null),b=0;b<c.length;b++)c[b]=r.get(b);return c};Ro.toString=function(){if(arguments.length===1){var e=arguments[0];return Ro.SIMPLE_ORDINATE_FORMAT.format(e)}};Ro.spaces=function(e){return Ro.chars(" ",e)};a0.NEWLINE.get=function(){return ri.getProperty("line.separator")};a0.SIMPLE_ORDINATE_FORMAT.get=function(){return new _M};Object.defineProperties(Ro,a0);var mr=function(){};mr.prototype.interfaces_=function(){return[]};mr.prototype.getClass=function(){return mr};mr.copyCoord=function(e,t,n,r){for(var a=Math.min(e.getDimension(),n.getDimension()),u=0;u<a;u++)n.setOrdinate(r,u,e.getOrdinate(t,u))};mr.isRing=function(e){var t=e.size();return t===0?!0:t<=3?!1:e.getOrdinate(0,fn.X)===e.getOrdinate(t-1,fn.X)&&e.getOrdinate(0,fn.Y)===e.getOrdinate(t-1,fn.Y)};mr.isEqual=function(e,t){var n=e.size(),r=t.size();if(n!==r)return!1;for(var a=Math.min(e.getDimension(),t.getDimension()),u=0;u<n;u++)for(var p=0;p<a;p++){var c=e.getOrdinate(u,p),b=t.getOrdinate(u,p);if(e.getOrdinate(u,p)!==t.getOrdinate(u,p)&&!(De.isNaN(c)&&De.isNaN(b)))return!1}return!0};mr.extend=function(e,t,n){var r=e.create(n,t.getDimension()),a=t.size();if(mr.copy(t,0,r,0,a),a>0)for(var u=a;u<n;u++)mr.copy(t,a-1,r,u,1);return r};mr.reverse=function(e){for(var t=e.size()-1,n=Math.trunc(t/2),r=0;r<=n;r++)mr.swap(e,r,t-r)};mr.swap=function(e,t,n){if(t===n)return null;for(var r=0;r<e.getDimension();r++){var a=e.getOrdinate(t,r);e.setOrdinate(t,r,e.getOrdinate(n,r)),e.setOrdinate(n,r,a)}};mr.copy=function(e,t,n,r,a){for(var u=0;u<a;u++)mr.copyCoord(e,t+u,n,r+u)};mr.toString=function(){if(arguments.length===1){var e=arguments[0],t=e.size();if(t===0)return"()";var n=e.getDimension(),r=new js;r.append("(");for(var a=0;a<t;a++){a>0&&r.append(" ");for(var u=0;u<n;u++)u>0&&r.append(","),r.append(Ro.toString(e.getOrdinate(a,u)))}return r.append(")"),r.toString()}};mr.ensureValidRing=function(e,t){var n=t.size();if(n===0)return t;if(n<=3)return mr.createClosedRing(e,t,4);var r=t.getOrdinate(0,fn.X)===t.getOrdinate(n-1,fn.X)&&t.getOrdinate(0,fn.Y)===t.getOrdinate(n-1,fn.Y);return r?t:mr.createClosedRing(e,t,n+1)};mr.createClosedRing=function(e,t,n){var r=e.create(n,t.getDimension()),a=t.size();mr.copy(t,0,r,0,a);for(var u=a;u<n;u++)mr.copy(t,0,r,u,1);return r};var ar=function(e){function t(r,a){e.call(this,a),this._points=null,this.init(r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new ye:this._points.expandEnvelope(new ye)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return e.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var a=arguments[0],u=arguments[1];if(!this.isEquivalentClass(a))return!1;var p=a;if(this._points.size()!==p._points.size())return!1;for(var c=0;c<this._points.size();c++)if(!r.equal(r._points.getCoordinate(c),p._points.getCoordinate(c),u))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var r=this,a=0;a<Math.trunc(this._points.size()/2);a++){var u=r._points.size()-1-a;if(!r._points.getCoordinate(a).equals(r._points.getCoordinate(u)))return r._points.getCoordinate(a).compareTo(r._points.getCoordinate(u))>0&&mr.reverse(r._points),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?vn.FALSE:0},t.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return se.computeLength(this._points)},t.prototype.getNumPoints=function(){return this._points.size()},t.prototype.reverse=function(){var r=this._points.copy();mr.reverse(r);var a=this.getFactory().createLineString(r);return a},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){for(var a=arguments[0],u=a,p=0,c=0;p<this._points.size()&&c<u._points.size();){var b=r._points.getCoordinate(p).compareTo(u._points.getCoordinate(c));if(b!==0)return b;p++,c++}return p<this._points.size()?1:c<u._points.size()?-1:0}else if(arguments.length===2){var C=arguments[0],A=arguments[1],P=C;return A.compare(this._points,P._points)}},t.prototype.apply=function(){var r=this;if(Le(arguments[0],sa))for(var a=arguments[0],u=0;u<this._points.size();u++)a.filter(r._points.getCoordinate(u));else if(Le(arguments[0],is)){var p=arguments[0];if(this._points.size()===0)return null;for(var c=0;c<this._points.size()&&(p.filter(r._points,c),!p.isDone());c++);p.isGeometryChanged()&&this.geometryChanged()}else if(Le(arguments[0],ks)){var b=arguments[0];b.filter(this)}else if(Le(arguments[0],za)){var C=arguments[0];C.filter(this)}},t.prototype.getBoundary=function(){return new ko(this).getBoundary()},t.prototype.isEquivalentClass=function(r){return r instanceof t},t.prototype.clone=function(){var r=e.prototype.clone.call(this);return r._points=this._points.clone(),r},t.prototype.getCoordinateN=function(r){return this._points.getCoordinate(r)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._points},t.prototype.isEmpty=function(){return this._points.size()===0},t.prototype.init=function(r){if(r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),r.size()===1)throw new Hn("Invalid number of points in LineString (found "+r.size()+" - must be 0 or >= 2)");this._points=r},t.prototype.isCoordinate=function(r){for(var a=this,u=0;u<this._points.size();u++)if(a._points.getCoordinate(u).equals(r))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(r){return this.getFactory().createPoint(this._points.getCoordinate(r))},t.prototype.interfaces_=function(){return[kf]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}(Te),Rf=function(){};Rf.prototype.interfaces_=function(){return[]};Rf.prototype.getClass=function(){return Rf};var io=function(e){function t(r,a){e.call(this,a),this._coordinates=r||null,this.init(this._coordinates)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new ye;var r=new ye;return r.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),r},t.prototype.getSortIndex=function(){return e.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.isEquivalentClass(r)?this.isEmpty()&&r.isEmpty()?!0:this.isEmpty()!==r.isEmpty()?!1:this.equal(r.getCoordinate(),this.getCoordinate(),a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return vn.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(arguments.length===1){var r=arguments[0],a=r;return this.getCoordinate().compareTo(a.getCoordinate())}else if(arguments.length===2){var u=arguments[0],p=arguments[1],c=u;return p.compare(this._coordinates,c._coordinates)}},t.prototype.apply=function(){if(Le(arguments[0],sa)){var r=arguments[0];if(this.isEmpty())return null;r.filter(this.getCoordinate())}else if(Le(arguments[0],is)){var a=arguments[0];if(this.isEmpty())return null;a.filter(this._coordinates,0),a.isGeometryChanged()&&this.geometryChanged()}else if(Le(arguments[0],ks)){var u=arguments[0];u.filter(this)}else if(Le(arguments[0],za)){var p=arguments[0];p.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var r=e.prototype.clone.call(this);return r._coordinates=this._coordinates.clone(),r},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this._coordinates.copy(),this._factory)},t.prototype.getCoordinateSequence=function(){return this._coordinates},t.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return this._coordinates.size()===0},t.prototype.init=function(r){r===null&&(r=this.getFactory().getCoordinateSequenceFactory().create([])),Ve.isTrue(r.size()<=1),this._coordinates=r},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[Rf]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(t,n),t}(Te),yl=function(){};yl.prototype.interfaces_=function(){return[]};yl.prototype.getClass=function(){return yl};var Lr=function(e){function t(r,a,u){if(e.call(this,u),this._shell=null,this._holes=null,r===null&&(r=this.getFactory().createLinearRing()),a===null&&(a=[]),e.hasNullElements(a))throw new Hn("holes must not contain null elements");if(r.isEmpty()&&e.hasNonEmptyElements(a))throw new Hn("shell is empty but holes are not");this._shell=r,this._holes=a}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return e.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){var r=this;if(this.isEmpty())return[];for(var a=new Array(this.getNumPoints()).fill(null),u=-1,p=this._shell.getCoordinates(),c=0;c<p.length;c++)u++,a[u]=p[c];for(var b=0;b<this._holes.length;b++)for(var C=r._holes[b].getCoordinates(),A=0;A<C.length;A++)u++,a[u]=C[A];return a},t.prototype.getArea=function(){var r=this,a=0;a+=Math.abs(se.signedArea(this._shell.getCoordinateSequence()));for(var u=0;u<this._holes.length;u++)a-=Math.abs(se.signedArea(r._holes[u].getCoordinateSequence()));return a},t.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var r=this._shell.getCoordinateSequence(),a=this.getEnvelopeInternal(),u=0;u<5;u++){var p=r.getX(u);if(!(p===a.getMinX()||p===a.getMaxX()))return!1;var c=r.getY(u);if(!(c===a.getMinY()||c===a.getMaxY()))return!1}for(var b=r.getX(0),C=r.getY(0),A=1;A<=4;A++){var P=r.getX(A),R=r.getY(A),et=P!==b,X=R!==C;if(et===X)return!1;b=P,C=R}return!0},t.prototype.equalsExact=function(){var r=this;if(arguments.length===2){var a=arguments[0],u=arguments[1];if(!this.isEquivalentClass(a))return!1;var p=a,c=this._shell,b=p._shell;if(!c.equalsExact(b,u)||this._holes.length!==p._holes.length)return!1;for(var C=0;C<this._holes.length;C++)if(!r._holes[C].equalsExact(p._holes[C],u))return!1;return!0}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var r=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var a=0;a<this._holes.length;a++)r.normalize(r._holes[a],!1);tu.sort(this._holes)}else if(arguments.length===2){var u=arguments[0],p=arguments[1];if(u.isEmpty())return null;var c=new Array(u.getCoordinates().length-1).fill(null);ri.arraycopy(u.getCoordinates(),0,c,0,c.length);var b=Qe.minCoordinate(u.getCoordinates());Qe.scroll(c,b),ri.arraycopy(c,0,u.getCoordinates(),0,c.length),u.getCoordinates()[c.length]=c[0],se.isCCW(u.getCoordinates())===p&&Qe.reverse(u.getCoordinates())}},t.prototype.getCoordinate=function(){return this._shell.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this._holes.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var r=this,a=0;a+=this._shell.getLength();for(var u=0;u<this._holes.length;u++)a+=r._holes[u].getLength();return a},t.prototype.getNumPoints=function(){for(var r=this,a=this._shell.getNumPoints(),u=0;u<this._holes.length;u++)a+=r._holes[u].getNumPoints();return a},t.prototype.reverse=function(){var r=this,a=this.copy();a._shell=this._shell.copy().reverse(),a._holes=new Array(this._holes.length).fill(null);for(var u=0;u<this._holes.length;u++)a._holes[u]=r._holes[u].copy().reverse();return a},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var r=this;if(arguments.length===1){var a=arguments[0],u=this._shell,p=a._shell;return u.compareToSameClass(p)}else if(arguments.length===2){var c=arguments[0],b=arguments[1],C=c,A=this._shell,P=C._shell,R=A.compareToSameClass(P,b);if(R!==0)return R;for(var et=this.getNumInteriorRing(),X=C.getNumInteriorRing(),K=0;K<et&&K<X;){var ot=r.getInteriorRingN(K),gt=C.getInteriorRingN(K),q=ot.compareToSameClass(gt,b);if(q!==0)return q;K++}return K<et?1:K<X?-1:0}},t.prototype.apply=function(r){var a=this;if(Le(r,sa)){this._shell.apply(r);for(var u=0;u<this._holes.length;u++)a._holes[u].apply(r)}else if(Le(r,is)){if(this._shell.apply(r),!r.isDone())for(var p=0;p<this._holes.length&&(a._holes[p].apply(r),!r.isDone());p++);r.isGeometryChanged()&&this.geometryChanged()}else if(Le(r,ks))r.filter(this);else if(Le(r,za)){r.filter(this),this._shell.apply(r);for(var c=0;c<this._holes.length;c++)a._holes[c].apply(r)}},t.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var a=new Array(this._holes.length+1).fill(null);a[0]=this._shell;for(var u=0;u<this._holes.length;u++)a[u+1]=r._holes[u];return a.length<=1?this.getFactory().createLinearRing(a[0].getCoordinateSequence()):this.getFactory().createMultiLineString(a)},t.prototype.clone=function(){var r=this,a=e.prototype.clone.call(this);a._shell=this._shell.clone(),a._holes=new Array(this._holes.length).fill(null);for(var u=0;u<this._holes.length;u++)a._holes[u]=r._holes[u].clone();return a},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var r=this,a=this._shell.copy(),u=new Array(this._holes.length).fill(null),p=0;p<u.length;p++)u[p]=r._holes[p].copy();return new t(a,u,this._factory)},t.prototype.getExteriorRing=function(){return this._shell},t.prototype.isEmpty=function(){return this._shell.isEmpty()},t.prototype.getInteriorRingN=function(r){return this._holes[r]},t.prototype.interfaces_=function(){return[yl]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}(Te),Bh=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Te.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.isEquivalentClass(r)?e.prototype.equalsExact.call(this,r,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(arguments.length===1){var r=arguments[0];return this._geometries[r].getCoordinate()}else return e.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return vn.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var r=this,a=new Array(this._geometries.length).fill(null),u=0;u<a.length;u++)a[u]=r._geometries[u].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[Rf]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(t,n),t}(Ii),aa=function(e){function t(r,a){r instanceof bt&&a instanceof en&&(r=a.getCoordinateSequenceFactory().create(r)),e.call(this,r,a),this.validateConstruction()}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Te.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return vn.FALSE},t.prototype.isClosed=function(){return this.isEmpty()?!0:e.prototype.isClosed.call(this)},t.prototype.reverse=function(){var r=this._points.copy();mr.reverse(r);var a=this.getFactory().createLinearRing(r);return a},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!e.prototype.isClosed.call(this))throw new Hn("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new Hn("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this._points.copy(),this._factory)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(ar),ra=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return Te.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return this.isEquivalentClass(r)?e.prototype.equalsExact.call(this,r,a):!1}else return e.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var r=this,a=this._geometries.length,u=new Array(a).fill(null),p=0;p<this._geometries.length;p++)u[p]=r._geometries[p].reverse();return this.getFactory().createMultiPolygon(u)},t.prototype.getBoundary=function(){var r=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var a=new Qt,u=0;u<this._geometries.length;u++)for(var p=r._geometries[u],c=p.getBoundary(),b=0;b<c.getNumGeometries();b++)a.add(c.getGeometryN(b));var C=new Array(a.size()).fill(null);return this.getFactory().createMultiLineString(a.toArray(C))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var r=this,a=new Array(this._geometries.length).fill(null),u=0;u<a.length;u++)a[u]=r._geometries[u].copy();return new t(a,this._factory)},t.prototype.interfaces_=function(){return[yl]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(Ii),zo=function(e){this._factory=e||null,this._isUserDataCopied=!1},pg={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};zo.prototype.setCopyUserData=function(e){this._isUserDataCopied=e};zo.prototype.edit=function(e,t){if(e===null)return null;var n=this.editInternal(e,t);return this._isUserDataCopied&&n.setUserData(e.getUserData()),n};zo.prototype.editInternal=function(e,t){return this._factory===null&&(this._factory=e.getFactory()),e instanceof Ii?this.editGeometryCollection(e,t):e instanceof Lr?this.editPolygon(e,t):e instanceof io?t.edit(e,this._factory):e instanceof ar?t.edit(e,this._factory):(Ve.shouldNeverReachHere("Unsupported Geometry class: "+e.getClass().getName()),null)};zo.prototype.editGeometryCollection=function(e,t){for(var n=this,r=t.edit(e,this._factory),a=new Qt,u=0;u<r.getNumGeometries();u++){var p=n.edit(r.getGeometryN(u),t);p===null||p.isEmpty()||a.add(p)}return r.getClass()===Bh?this._factory.createMultiPoint(a.toArray([])):r.getClass()===ru?this._factory.createMultiLineString(a.toArray([])):r.getClass()===ra?this._factory.createMultiPolygon(a.toArray([])):this._factory.createGeometryCollection(a.toArray([]))};zo.prototype.editPolygon=function(e,t){var n=this,r=t.edit(e,this._factory);if(r===null&&(r=this._factory.createPolygon(null)),r.isEmpty())return r;var a=this.edit(r.getExteriorRing(),t);if(a===null||a.isEmpty())return this._factory.createPolygon();for(var u=new Qt,p=0;p<r.getNumInteriorRing();p++){var c=n.edit(r.getInteriorRingN(p),t);c===null||c.isEmpty()||u.add(c)}return this._factory.createPolygon(a,u.toArray([]))};zo.prototype.interfaces_=function(){return[]};zo.prototype.getClass=function(){return zo};zo.GeometryEditorOperation=function(){};pg.NoOpGeometryOperation.get=function(){return Nf};pg.CoordinateOperation.get=function(){return Of};pg.CoordinateSequenceOperation.get=function(){return zf};Object.defineProperties(zo,pg);var Nf=function(){};Nf.prototype.edit=function(e,t){return e};Nf.prototype.interfaces_=function(){return[zo.GeometryEditorOperation]};Nf.prototype.getClass=function(){return Nf};var Of=function(){};Of.prototype.edit=function(e,t){var n=this.editCoordinates(e.getCoordinates(),e);return n===null?e:e instanceof aa?t.createLinearRing(n):e instanceof ar?t.createLineString(n):e instanceof io?n.length>0?t.createPoint(n[0]):t.createPoint():e};Of.prototype.interfaces_=function(){return[zo.GeometryEditorOperation]};Of.prototype.getClass=function(){return Of};var zf=function(){};zf.prototype.edit=function(e,t){return e instanceof aa?t.createLinearRing(this.edit(e.getCoordinateSequence(),e)):e instanceof ar?t.createLineString(this.edit(e.getCoordinateSequence(),e)):e instanceof io?t.createPoint(this.edit(e.getCoordinateSequence(),e)):e};zf.prototype.interfaces_=function(){return[zo.GeometryEditorOperation]};zf.prototype.getClass=function(){return zf};var fr=function(){var e=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this._coordinates=new Array(t).fill(null);for(var n=0;n<t;n++)e._coordinates[n]=new bt}else if(Le(arguments[0],fn)){var r=arguments[0];if(r===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=r.getDimension(),this._coordinates=new Array(r.size()).fill(null);for(var a=0;a<this._coordinates.length;a++)e._coordinates[a]=r.getCoordinateCopy(a)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var u=arguments[0],p=arguments[1];this._coordinates=u,this._dimension=p,u===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var c=arguments[0],b=arguments[1];this._coordinates=new Array(c).fill(null),this._dimension=b;for(var C=0;C<c;C++)e._coordinates[C]=new bt}}},h2={serialVersionUID:{configurable:!0}};fr.prototype.setOrdinate=function(e,t,n){switch(t){case fn.X:this._coordinates[e].x=n;break;case fn.Y:this._coordinates[e].y=n;break;case fn.Z:this._coordinates[e].z=n;break;default:throw new Hn("invalid ordinateIndex")}};fr.prototype.size=function(){return this._coordinates.length};fr.prototype.getOrdinate=function(e,t){switch(t){case fn.X:return this._coordinates[e].x;case fn.Y:return this._coordinates[e].y;case fn.Z:return this._coordinates[e].z}return De.NaN};fr.prototype.getCoordinate=function(){if(arguments.length===1){var e=arguments[0];return this._coordinates[e]}else if(arguments.length===2){var t=arguments[0],n=arguments[1];n.x=this._coordinates[t].x,n.y=this._coordinates[t].y,n.z=this._coordinates[t].z}};fr.prototype.getCoordinateCopy=function(e){return new bt(this._coordinates[e])};fr.prototype.getDimension=function(){return this._dimension};fr.prototype.getX=function(e){return this._coordinates[e].x};fr.prototype.clone=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].clone();return new fr(t,this._dimension)};fr.prototype.expandEnvelope=function(e){for(var t=this,n=0;n<this._coordinates.length;n++)e.expandToInclude(t._coordinates[n]);return e};fr.prototype.copy=function(){for(var e=this,t=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)t[n]=e._coordinates[n].copy();return new fr(t,this._dimension)};fr.prototype.toString=function(){var e=this;if(this._coordinates.length>0){var t=new js(17*this._coordinates.length);t.append("("),t.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)t.append(", "),t.append(e._coordinates[n]);return t.append(")"),t.toString()}else return"()"};fr.prototype.getY=function(e){return this._coordinates[e].y};fr.prototype.toCoordinateArray=function(){return this._coordinates};fr.prototype.interfaces_=function(){return[fn,Go]};fr.prototype.getClass=function(){return fr};h2.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(fr,h2);var la=function(){},l0={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};la.prototype.readResolve=function(){return la.instance()};la.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new fr(e)}else if(Le(arguments[0],fn)){var t=arguments[0];return new fr(t)}}else if(arguments.length===2){var n=arguments[0],r=arguments[1];return r>3&&(r=3),r<2?new fr(n):new fr(n,r)}};la.prototype.interfaces_=function(){return[kh,Go]};la.prototype.getClass=function(){return la};la.instance=function(){return la.instanceObject};l0.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};l0.instanceObject.get=function(){return new la};Object.defineProperties(la,l0);var p2=function(e){function t(){e.call(this),this.map_=new Map}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.get=function(n){return this.map_.get(n)||null},t.prototype.put=function(n,r){return this.map_.set(n,r),r},t.prototype.values=function(){for(var n=new Qt,r=this.map_.values(),a=r.next();!a.done;)n.add(a.value),a=r.next();return n},t.prototype.entrySet=function(){var n=new s0;return this.map_.entries().forEach(function(r){return n.add(r)}),n},t.prototype.size=function(){return this.map_.size()},t}(fc),En=function e(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=e.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Rs){var t=arguments[0];this._modelType=t,t===e.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=e.FIXED,this.setScale(n)}else if(arguments[0]instanceof e){var r=arguments[0];this._modelType=r._modelType,this._scale=r._scale}}},u0={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};En.prototype.equals=function(e){if(!(e instanceof En))return!1;var t=e;return this._modelType===t._modelType&&this._scale===t._scale};En.prototype.compareTo=function(e){var t=e,n=this.getMaximumSignificantDigits(),r=t.getMaximumSignificantDigits();return new Ms(n).compareTo(new Ms(r))};En.prototype.getScale=function(){return this._scale};En.prototype.isFloating=function(){return this._modelType===En.FLOATING||this._modelType===En.FLOATING_SINGLE};En.prototype.getType=function(){return this._modelType};En.prototype.toString=function(){var e="UNKNOWN";return this._modelType===En.FLOATING?e="Floating":this._modelType===En.FLOATING_SINGLE?e="Floating-Single":this._modelType===En.FIXED&&(e="Fixed (Scale="+this.getScale()+")"),e};En.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var e=arguments[0];if(De.isNaN(e))return e;if(this._modelType===En.FLOATING_SINGLE){var t=e;return t}return this._modelType===En.FIXED?Math.round(e*this._scale)/this._scale:e}else if(arguments[0]instanceof bt){var n=arguments[0];if(this._modelType===En.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};En.prototype.getMaximumSignificantDigits=function(){var e=16;return this._modelType===En.FLOATING?e=16:this._modelType===En.FLOATING_SINGLE?e=6:this._modelType===En.FIXED&&(e=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),e};En.prototype.setScale=function(e){this._scale=Math.abs(e)};En.prototype.interfaces_=function(){return[Go,Uo]};En.prototype.getClass=function(){return En};En.mostPrecise=function(e,t){return e.compareTo(t)>=0?e:t};u0.serialVersionUID.get=function(){return 7777263578777804e3};u0.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(En,u0);var Rs=function e(t){this._name=t||null,e.nameToTypeMap.put(t,this)},c0={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Rs.prototype.readResolve=function(){return Rs.nameToTypeMap.get(this._name)};Rs.prototype.toString=function(){return this._name};Rs.prototype.interfaces_=function(){return[Go]};Rs.prototype.getClass=function(){return Rs};c0.serialVersionUID.get=function(){return-552860263173159e4};c0.nameToTypeMap.get=function(){return new p2};Object.defineProperties(Rs,c0);En.Type=Rs;En.FIXED=new Rs("FIXED");En.FLOATING=new Rs("FLOATING");En.FLOATING_SINGLE=new Rs("FLOATING SINGLE");var en=function e(){this._precisionModel=new En,this._SRID=0,this._coordinateSequenceFactory=e.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?Le(arguments[0],kh)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof En&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},f2={serialVersionUID:{configurable:!0}};en.prototype.toGeometry=function(e){return e.isNull()?this.createPoint(null):e.getMinX()===e.getMaxX()&&e.getMinY()===e.getMaxY()?this.createPoint(new bt(e.getMinX(),e.getMinY())):e.getMinX()===e.getMaxX()||e.getMinY()===e.getMaxY()?this.createLineString([new bt(e.getMinX(),e.getMinY()),new bt(e.getMaxX(),e.getMaxY())]):this.createPolygon(this.createLinearRing([new bt(e.getMinX(),e.getMinY()),new bt(e.getMinX(),e.getMaxY()),new bt(e.getMaxX(),e.getMaxY()),new bt(e.getMaxX(),e.getMinY()),new bt(e.getMinX(),e.getMinY())]),null)};en.prototype.createLineString=function(e){if(e){if(e instanceof Array)return new ar(this.getCoordinateSequenceFactory().create(e),this);if(Le(e,fn))return new ar(e,this)}else return new ar(this.getCoordinateSequenceFactory().create([]),this)};en.prototype.createMultiLineString=function(){if(arguments.length===0)return new ru(null,this);if(arguments.length===1){var e=arguments[0];return new ru(e,this)}};en.prototype.buildGeometry=function(e){for(var t=null,n=!1,r=!1,a=e.iterator();a.hasNext();){var u=a.next(),p=u.getClass();t===null&&(t=p),p!==t&&(n=!0),u.isGeometryCollectionOrDerived()&&(r=!0)}if(t===null)return this.createGeometryCollection();if(n||r)return this.createGeometryCollection(en.toGeometryArray(e));var c=e.iterator().next(),b=e.size()>1;if(b){if(c instanceof Lr)return this.createMultiPolygon(en.toPolygonArray(e));if(c instanceof ar)return this.createMultiLineString(en.toLineStringArray(e));if(c instanceof io)return this.createMultiPoint(en.toPointArray(e));Ve.shouldNeverReachHere("Unhandled class: "+c.getClass().getName())}return c};en.prototype.createMultiPointFromCoords=function(e){return this.createMultiPoint(e!==null?this.getCoordinateSequenceFactory().create(e):null)};en.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof bt){var e=arguments[0];return this.createPoint(e!==null?this.getCoordinateSequenceFactory().create([e]):null)}else if(Le(arguments[0],fn)){var t=arguments[0];return new io(t,this)}}};en.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};en.prototype.createPolygon=function(){if(arguments.length===0)return new Lr(null,null,this);if(arguments.length===1){if(Le(arguments[0],fn)){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof aa){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];return new Lr(r,a,this)}};en.prototype.getSRID=function(){return this._SRID};en.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Ii(null,this);if(arguments.length===1){var e=arguments[0];return new Ii(e,this)}};en.prototype.createGeometry=function(e){var t=new zo(this);return t.edit(e,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};en.prototype.getPrecisionModel=function(){return this._precisionModel};en.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return this.createLinearRing(e!==null?this.getCoordinateSequenceFactory().create(e):null)}else if(Le(arguments[0],fn)){var t=arguments[0];return new aa(t,this)}}};en.prototype.createMultiPolygon=function(){if(arguments.length===0)return new ra(null,this);if(arguments.length===1){var e=arguments[0];return new ra(e,this)}};en.prototype.createMultiPoint=function(){var e=this;if(arguments.length===0)return new Bh(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Bh(t,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(Le(arguments[0],fn)){var r=arguments[0];if(r===null)return this.createMultiPoint(new Array(0).fill(null));for(var a=new Array(r.size()).fill(null),u=0;u<r.size();u++){var p=e.getCoordinateSequenceFactory().create(1,r.getDimension());mr.copy(r,u,p,0,1),a[u]=e.createPoint(p)}return this.createMultiPoint(a)}}};en.prototype.interfaces_=function(){return[Go]};en.prototype.getClass=function(){return en};en.toMultiPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};en.toGeometryArray=function(e){if(e===null)return null;var t=new Array(e.size()).fill(null);return e.toArray(t)};en.getDefaultCoordinateSequenceFactory=function(){return la.instance()};en.toMultiLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};en.toLineStringArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};en.toMultiPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};en.toLinearRingArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};en.toPointArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};en.toPolygonArray=function(e){var t=new Array(e.size()).fill(null);return e.toArray(t)};en.createPointFromInternalCoord=function(e,t){return t.getPrecisionModel().makePrecise(e),t.getFactory().createPoint(e)};f2.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(en,f2);var jt=function(){},fg={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};jt.prototype.interfaces_=function(){return[]};jt.prototype.getClass=function(){return jt};jt.opposite=function(e){return e===jt.LEFT?jt.RIGHT:e===jt.RIGHT?jt.LEFT:e};fg.ON.get=function(){return 0};fg.LEFT.get=function(){return 1};fg.RIGHT.get=function(){return 2};Object.defineProperties(jt,fg);function dg(e){this.message=e||""}dg.prototype=new Error;dg.prototype.name="EmptyStackException";function Ws(){this.array_=[]}Ws.prototype=new ns;Ws.prototype.add=function(e){return this.array_.push(e),!0};Ws.prototype.get=function(e){if(e<0||e>=this.size())throw new Error;return this.array_[e]};Ws.prototype.push=function(e){return this.array_.push(e),e};Ws.prototype.pop=function(e){if(this.array_.length===0)throw new dg;return this.array_.pop()};Ws.prototype.peek=function(){if(this.array_.length===0)throw new dg;return this.array_[this.array_.length-1]};Ws.prototype.empty=function(){return this.array_.length===0};Ws.prototype.isEmpty=function(){return this.empty()};Ws.prototype.search=function(e){return this.array_.indexOf(e)};Ws.prototype.size=function(){return this.array_.length};Ws.prototype.toArray=function(){for(var e=this,t=[],n=0,r=this.array_.length;n<r;n++)t.push(e.array_[n]);return t};var Ns=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Ns.prototype.getCoordinate=function(){return this._minCoord};Ns.prototype.getRightmostSide=function(e,t){var n=this.getRightmostSideOfSegment(e,t);return n<0&&(n=this.getRightmostSideOfSegment(e,t-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(e)),n};Ns.prototype.findRightmostEdgeAtVertex=function(){var e=this._minDe.getEdge().getCoordinates();Ve.isTrue(this._minIndex>0&&this._minIndex<e.length,"rightmost point expected to be interior vertex of edge");var t=e[this._minIndex-1],n=e[this._minIndex+1],r=se.computeOrientation(this._minCoord,n,t),a=!1;(t.y<this._minCoord.y&&n.y<this._minCoord.y&&r===se.COUNTERCLOCKWISE||t.y>this._minCoord.y&&n.y>this._minCoord.y&&r===se.CLOCKWISE)&&(a=!0),a&&(this._minIndex=this._minIndex-1)};Ns.prototype.getRightmostSideOfSegment=function(e,t){var n=e.getEdge(),r=n.getCoordinates();if(t<0||t+1>=r.length||r[t].y===r[t+1].y)return-1;var a=jt.LEFT;return r[t].y<r[t+1].y&&(a=jt.RIGHT),a};Ns.prototype.getEdge=function(){return this._orientedDe};Ns.prototype.checkForRightmostCoordinate=function(e){for(var t=this,n=e.getEdge().getCoordinates(),r=0;r<n.length-1;r++)(t._minCoord===null||n[r].x>t._minCoord.x)&&(t._minDe=e,t._minIndex=r,t._minCoord=n[r])};Ns.prototype.findRightmostEdgeAtNode=function(){var e=this._minDe.getNode(),t=e.getEdges();this._minDe=t.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};Ns.prototype.findEdge=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next();r.isForward()&&t.checkForRightmostCoordinate(r)}Ve.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var a=this.getRightmostSide(this._minDe,this._minIndex);a===jt.LEFT&&(this._orientedDe=this._minDe.getSym())};Ns.prototype.interfaces_=function(){return[]};Ns.prototype.getClass=function(){return Ns};var Fa=function(e){function t(n,r){e.call(this,t.msgWithCoord(n,r)),this.pt=r?new bt(r):null,this.name="TopologyException"}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(n,r){return r?n:n+" [ "+r+" ]"},t}(Oa),mg=function(){this.array_=[]};mg.prototype.addLast=function(e){this.array_.push(e)};mg.prototype.removeFirst=function(){return this.array_.shift()};mg.prototype.isEmpty=function(){return this.array_.length===0};var Ei=function(){this._finder=null,this._dirEdgeList=new Qt,this._nodes=new Qt,this._rightMostCoord=null,this._env=null,this._finder=new Ns};Ei.prototype.clearVisitedEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.setVisited(!1)}};Ei.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Ei.prototype.computeNodeDepth=function(e){for(var t=this,n=null,r=e.getEdges().iterator();r.hasNext();){var a=r.next();if(a.isVisited()||a.getSym().isVisited()){n=a;break}}if(n===null)throw new Fa("unable to find edge to compute depths at "+e.getCoordinate());e.getEdges().computeDepths(n);for(var u=e.getEdges().iterator();u.hasNext();){var p=u.next();p.setVisited(!0),t.copySymDepths(p)}};Ei.prototype.computeDepth=function(e){this.clearVisitedEdges();var t=this._finder.getEdge();t.setEdgeDepths(jt.RIGHT,e),this.copySymDepths(t),this.computeDepths(t)};Ei.prototype.create=function(e){this.addReachable(e),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Ei.prototype.findResultEdges=function(){for(var e=this._dirEdgeList.iterator();e.hasNext();){var t=e.next();t.getDepth(jt.RIGHT)>=1&&t.getDepth(jt.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}};Ei.prototype.computeDepths=function(e){var t=this,n=new s0,r=new mg,a=e.getNode();for(r.addLast(a),n.add(a),e.setVisited(!0);!r.isEmpty();){var u=r.removeFirst();n.add(u),t.computeNodeDepth(u);for(var p=u.getEdges().iterator();p.hasNext();){var c=p.next(),b=c.getSym();if(!b.isVisited()){var C=b.getNode();n.contains(C)||(r.addLast(C),n.add(C))}}}};Ei.prototype.compareTo=function(e){var t=e;return this._rightMostCoord.x<t._rightMostCoord.x?-1:this._rightMostCoord.x>t._rightMostCoord.x?1:0};Ei.prototype.getEnvelope=function(){if(this._env===null){for(var e=new ye,t=this._dirEdgeList.iterator();t.hasNext();)for(var n=t.next(),r=n.getEdge().getCoordinates(),a=0;a<r.length-1;a++)e.expandToInclude(r[a]);this._env=e}return this._env};Ei.prototype.addReachable=function(e){var t=this,n=new Ws;for(n.add(e);!n.empty();){var r=n.pop();t.add(r,n)}};Ei.prototype.copySymDepths=function(e){var t=e.getSym();t.setDepth(jt.LEFT,e.getDepth(jt.RIGHT)),t.setDepth(jt.RIGHT,e.getDepth(jt.LEFT))};Ei.prototype.add=function(e,t){var n=this;e.setVisited(!0),this._nodes.add(e);for(var r=e.getEdges().iterator();r.hasNext();){var a=r.next();n._dirEdgeList.add(a);var u=a.getSym(),p=u.getNode();p.isVisited()||t.push(p)}};Ei.prototype.getNodes=function(){return this._nodes};Ei.prototype.getDirectedEdges=function(){return this._dirEdgeList};Ei.prototype.interfaces_=function(){return[Uo]};Ei.prototype.getClass=function(){return Ei};var zn=function e(){var t=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var r=arguments[0];this.init(1),this.location[jt.ON]=r}else if(arguments[0]instanceof e){var a=arguments[0];if(this.init(a.location.length),a!==null)for(var u=0;u<this.location.length;u++)t.location[u]=a.location[u]}}else if(arguments.length===3){var p=arguments[0],c=arguments[1],b=arguments[2];this.init(3),this.location[jt.ON]=p,this.location[jt.LEFT]=c,this.location[jt.RIGHT]=b}};zn.prototype.setAllLocations=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]=e};zn.prototype.isNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]!==St.NONE)return!1;return!0};zn.prototype.setAllLocationsIfNull=function(e){for(var t=this,n=0;n<this.location.length;n++)t.location[n]===St.NONE&&(t.location[n]=e)};zn.prototype.isLine=function(){return this.location.length===1};zn.prototype.merge=function(e){var t=this;if(e.location.length>this.location.length){var n=new Array(3).fill(null);n[jt.ON]=this.location[jt.ON],n[jt.LEFT]=St.NONE,n[jt.RIGHT]=St.NONE,this.location=n}for(var r=0;r<this.location.length;r++)t.location[r]===St.NONE&&r<e.location.length&&(t.location[r]=e.location[r])};zn.prototype.getLocations=function(){return this.location};zn.prototype.flip=function(){if(this.location.length<=1)return null;var e=this.location[jt.LEFT];this.location[jt.LEFT]=this.location[jt.RIGHT],this.location[jt.RIGHT]=e};zn.prototype.toString=function(){var e=new js;return this.location.length>1&&e.append(St.toLocationSymbol(this.location[jt.LEFT])),e.append(St.toLocationSymbol(this.location[jt.ON])),this.location.length>1&&e.append(St.toLocationSymbol(this.location[jt.RIGHT])),e.toString()};zn.prototype.setLocations=function(e,t,n){this.location[jt.ON]=e,this.location[jt.LEFT]=t,this.location[jt.RIGHT]=n};zn.prototype.get=function(e){return e<this.location.length?this.location[e]:St.NONE};zn.prototype.isArea=function(){return this.location.length>1};zn.prototype.isAnyNull=function(){for(var e=this,t=0;t<this.location.length;t++)if(e.location[t]===St.NONE)return!0;return!1};zn.prototype.setLocation=function(){if(arguments.length===1){var e=arguments[0];this.setLocation(jt.ON,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.location[t]=n}};zn.prototype.init=function(e){this.location=new Array(e).fill(null),this.setAllLocations(St.NONE)};zn.prototype.isEqualOnSide=function(e,t){return this.location[t]===e.location[t]};zn.prototype.allPositionsEqual=function(e){for(var t=this,n=0;n<this.location.length;n++)if(t.location[n]!==e)return!1;return!0};zn.prototype.interfaces_=function(){return[]};zn.prototype.getClass=function(){return zn};var Cn=function e(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new zn(t),this.elt[1]=new zn(t)}else if(arguments[0]instanceof e){var n=arguments[0];this.elt[0]=new zn(n.elt[0]),this.elt[1]=new zn(n.elt[1])}}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.elt[0]=new zn(St.NONE),this.elt[1]=new zn(St.NONE),this.elt[r].setLocation(a)}else if(arguments.length===3){var u=arguments[0],p=arguments[1],c=arguments[2];this.elt[0]=new zn(u,p,c),this.elt[1]=new zn(u,p,c)}else if(arguments.length===4){var b=arguments[0],C=arguments[1],A=arguments[2],P=arguments[3];this.elt[0]=new zn(St.NONE,St.NONE,St.NONE),this.elt[1]=new zn(St.NONE,St.NONE,St.NONE),this.elt[b].setLocations(C,A,P)}};Cn.prototype.getGeometryCount=function(){var e=0;return this.elt[0].isNull()||e++,this.elt[1].isNull()||e++,e};Cn.prototype.setAllLocations=function(e,t){this.elt[e].setAllLocations(t)};Cn.prototype.isNull=function(e){return this.elt[e].isNull()};Cn.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var e=arguments[0];this.setAllLocationsIfNull(0,e),this.setAllLocationsIfNull(1,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}};Cn.prototype.isLine=function(e){return this.elt[e].isLine()};Cn.prototype.merge=function(e){for(var t=this,n=0;n<2;n++)t.elt[n]===null&&e.elt[n]!==null?t.elt[n]=new zn(e.elt[n]):t.elt[n].merge(e.elt[n])};Cn.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};Cn.prototype.getLocation=function(){if(arguments.length===1){var e=arguments[0];return this.elt[e].get(jt.ON)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}};Cn.prototype.toString=function(){var e=new js;return this.elt[0]!==null&&(e.append("A:"),e.append(this.elt[0].toString())),this.elt[1]!==null&&(e.append(" B:"),e.append(this.elt[1].toString())),e.toString()};Cn.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var e=arguments[0];return this.elt[e].isArea()}};Cn.prototype.isAnyNull=function(e){return this.elt[e].isAnyNull()};Cn.prototype.setLocation=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.elt[e].setLocation(jt.ON,t)}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];this.elt[n].setLocation(r,a)}};Cn.prototype.isEqualOnSide=function(e,t){return this.elt[0].isEqualOnSide(e.elt[0],t)&&this.elt[1].isEqualOnSide(e.elt[1],t)};Cn.prototype.allPositionsEqual=function(e,t){return this.elt[e].allPositionsEqual(t)};Cn.prototype.toLine=function(e){this.elt[e].isArea()&&(this.elt[e]=new zn(this.elt[e].location[0]))};Cn.prototype.interfaces_=function(){return[]};Cn.prototype.getClass=function(){return Cn};Cn.toLineLabel=function(e){for(var t=new Cn(St.NONE),n=0;n<2;n++)t.setLocation(n,e.getLocation(n));return t};var xr=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new Qt,this._pts=new Qt,this._label=new Cn(St.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new Qt,this._geometryFactory=null;var e=arguments[0],t=arguments[1];this._geometryFactory=t,this.computePoints(e),this.computeRing()};xr.prototype.computeRing=function(){var e=this;if(this._ring!==null)return null;for(var t=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)t[n]=e._pts.get(n);this._ring=this._geometryFactory.createLinearRing(t),this._isHole=se.isCCW(this._ring.getCoordinates())};xr.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};xr.prototype.computePoints=function(e){var t=this;this._startDe=e;var n=e,r=!0;do{if(n===null)throw new Fa("Found null DirectedEdge");if(n.getEdgeRing()===t)throw new Fa("Directed Edge visited twice during ring-building at "+n.getCoordinate());t._edges.add(n);var a=n.getLabel();Ve.isTrue(a.isArea()),t.mergeLabel(a),t.addPoints(n.getEdge(),n.isForward(),r),r=!1,t.setEdgeRing(n,t),n=t.getNext(n)}while(n!==this._startDe)};xr.prototype.getLinearRing=function(){return this._ring};xr.prototype.getCoordinate=function(e){return this._pts.get(e)};xr.prototype.computeMaxNodeDegree=function(){var e=this;this._maxNodeDegree=0;var t=this._startDe;do{var n=t.getNode(),r=n.getEdges().getOutgoingDegree(e);r>e._maxNodeDegree&&(e._maxNodeDegree=r),t=e.getNext(t)}while(t!==this._startDe);this._maxNodeDegree*=2};xr.prototype.addPoints=function(e,t,n){var r=this,a=e.getCoordinates();if(t){var u=1;n&&(u=0);for(var p=u;p<a.length;p++)r._pts.add(a[p])}else{var c=a.length-2;n&&(c=a.length-1);for(var b=c;b>=0;b--)r._pts.add(a[b])}};xr.prototype.isHole=function(){return this._isHole};xr.prototype.setInResult=function(){var e=this._startDe;do e.getEdge().setInResult(!0),e=e.getNext();while(e!==this._startDe)};xr.prototype.containsPoint=function(e){var t=this.getLinearRing(),n=t.getEnvelopeInternal();if(!n.contains(e)||!se.isPointInRing(e,t.getCoordinates()))return!1;for(var r=this._holes.iterator();r.hasNext();){var a=r.next();if(a.containsPoint(e))return!1}return!0};xr.prototype.addHole=function(e){this._holes.add(e)};xr.prototype.isShell=function(){return this._shell===null};xr.prototype.getLabel=function(){return this._label};xr.prototype.getEdges=function(){return this._edges};xr.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};xr.prototype.getShell=function(){return this._shell};xr.prototype.mergeLabel=function(){if(arguments.length===1){var e=arguments[0];this.mergeLabel(e,0),this.mergeLabel(e,1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],r=t.getLocation(n,jt.RIGHT);if(r===St.NONE)return null;if(this._label.getLocation(n)===St.NONE)return this._label.setLocation(n,r),null}};xr.prototype.setShell=function(e){this._shell=e,e!==null&&e.addHole(this)};xr.prototype.toPolygon=function(e){for(var t=this,n=new Array(this._holes.size()).fill(null),r=0;r<this._holes.size();r++)n[r]=t._holes.get(r).getLinearRing();var a=e.createPolygon(this.getLinearRing(),n);return a};xr.prototype.interfaces_=function(){return[]};xr.prototype.getClass=function(){return xr};var wM=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.setEdgeRing=function(n,r){n.setMinEdgeRing(r)},t.prototype.getNext=function(n){return n.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xr),SM=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildMinimalRings=function(){var n=this,r=new Qt,a=this._startDe;do{if(a.getMinEdgeRing()===null){var u=new wM(a,n._geometryFactory);r.add(u)}a=a.getNext()}while(a!==this._startDe);return r},t.prototype.setEdgeRing=function(n,r){n.setEdgeRing(r)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,r=this._startDe;do{var a=r.getNode();a.getEdges().linkMinimalDirectedEdges(n),r=r.getNext()}while(r!==this._startDe)},t.prototype.getNext=function(n){return n.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(xr),So=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._label=e}};So.prototype.setVisited=function(e){this._isVisited=e};So.prototype.setInResult=function(e){this._isInResult=e};So.prototype.isCovered=function(){return this._isCovered};So.prototype.isCoveredSet=function(){return this._isCoveredSet};So.prototype.setLabel=function(e){this._label=e};So.prototype.getLabel=function(){return this._label};So.prototype.setCovered=function(e){this._isCovered=e,this._isCoveredSet=!0};So.prototype.updateIM=function(e){Ve.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(e)};So.prototype.isInResult=function(){return this._isInResult};So.prototype.isVisited=function(){return this._isVisited};So.prototype.interfaces_=function(){return[]};So.prototype.getClass=function(){return So};var gg=function(e){function t(){e.call(this),this._coord=null,this._edges=null;var n=arguments[0],r=arguments[1];this._coord=n,this._edges=r,this._label=new Cn(0,St.NONE)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var r=n.next();if(r.getEdge().isInResult())return!0}return!1},t.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},t.prototype.getCoordinate=function(){return this._coord},t.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},t.prototype.computeIM=function(n){},t.prototype.computeMergedLocation=function(n,r){var a=St.NONE;if(a=this._label.getLocation(r),!n.isNull(r)){var u=n.getLocation(r);a!==St.BOUNDARY&&(a=u)}return a},t.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];this._label===null?this._label=new Cn(n,r):this._label.setLocation(n,r)}else return e.prototype.setLabel.apply(this,arguments)},t.prototype.getEdges=function(){return this._edges},t.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof t){var r=arguments[0];this.mergeLabel(r._label)}else if(arguments[0]instanceof Cn)for(var a=arguments[0],u=0;u<2;u++){var p=n.computeMergedLocation(a,u),c=n._label.getLocation(u);c===St.NONE&&n._label.setLocation(u,p)}},t.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},t.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var r=St.NONE;this._label!==null&&(r=this._label.getLocation(n));var a=null;switch(r){case St.BOUNDARY:a=St.INTERIOR;break;case St.INTERIOR:a=St.BOUNDARY;break;default:a=St.BOUNDARY;break}this._label.setLocation(n,a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(So),Os=function(){this.nodeMap=new hi,this.nodeFact=null;var e=arguments[0];this.nodeFact=e};Os.prototype.find=function(e){return this.nodeMap.get(e)};Os.prototype.addNode=function(){if(arguments[0]instanceof bt){var e=arguments[0],t=this.nodeMap.get(e);return t===null&&(t=this.nodeFact.createNode(e),this.nodeMap.put(e,t)),t}else if(arguments[0]instanceof gg){var n=arguments[0],r=this.nodeMap.get(n.getCoordinate());return r===null?(this.nodeMap.put(n.getCoordinate(),n),n):(r.mergeLabel(n),r)}};Os.prototype.print=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};Os.prototype.iterator=function(){return this.nodeMap.values().iterator()};Os.prototype.values=function(){return this.nodeMap.values()};Os.prototype.getBoundaryNodes=function(e){for(var t=new Qt,n=this.iterator();n.hasNext();){var r=n.next();r.getLabel().getLocation(e)===St.BOUNDARY&&t.add(r)}return t};Os.prototype.add=function(e){var t=e.getCoordinate(),n=this.addNode(t);n.add(e)};Os.prototype.interfaces_=function(){return[]};Os.prototype.getClass=function(){return Os};var Ln=function(){},$f={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Ln.prototype.interfaces_=function(){return[]};Ln.prototype.getClass=function(){return Ln};Ln.isNorthern=function(e){return e===Ln.NE||e===Ln.NW};Ln.isOpposite=function(e,t){if(e===t)return!1;var n=(e-t+4)%4;return n===2};Ln.commonHalfPlane=function(e,t){if(e===t)return e;var n=(e-t+4)%4;if(n===2)return-1;var r=e<t?e:t,a=e>t?e:t;return r===0&&a===3?3:r};Ln.isInHalfPlane=function(e,t){return t===Ln.SE?e===Ln.SE||e===Ln.SW:e===t||e===t+1};Ln.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new Hn("Cannot compute the quadrant for point ( "+e+", "+t+" )");return e>=0?t>=0?Ln.NE:Ln.SE:t>=0?Ln.NW:Ln.SW}else if(arguments[0]instanceof bt&&arguments[1]instanceof bt){var n=arguments[0],r=arguments[1];if(r.x===n.x&&r.y===n.y)throw new Hn("Cannot compute the quadrant for two identical points "+n);return r.x>=n.x?r.y>=n.y?Ln.NE:Ln.SE:r.y>=n.y?Ln.NW:Ln.SW}};$f.NE.get=function(){return 0};$f.NW.get=function(){return 1};$f.SW.get=function(){return 2};$f.SE.get=function(){return 3};Object.defineProperties(Ln,$f);var pi=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var e=arguments[0];this._edge=e}else if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2],a=null;this._edge=t,this.init(n,r),this._label=a}else if(arguments.length===4){var u=arguments[0],p=arguments[1],c=arguments[2],b=arguments[3];this._edge=u,this.init(p,c),this._label=b}};pi.prototype.compareDirection=function(e){return this._dx===e._dx&&this._dy===e._dy?0:this._quadrant>e._quadrant?1:this._quadrant<e._quadrant?-1:se.computeOrientation(e._p0,e._p1,this._p1)};pi.prototype.getDy=function(){return this._dy};pi.prototype.getCoordinate=function(){return this._p0};pi.prototype.setNode=function(e){this._node=e};pi.prototype.print=function(e){var t=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),r=n.lastIndexOf("."),a=n.substring(r+1);e.print("  "+a+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label)};pi.prototype.compareTo=function(e){var t=e;return this.compareDirection(t)};pi.prototype.getDirectedCoordinate=function(){return this._p1};pi.prototype.getDx=function(){return this._dx};pi.prototype.getLabel=function(){return this._label};pi.prototype.getEdge=function(){return this._edge};pi.prototype.getQuadrant=function(){return this._quadrant};pi.prototype.getNode=function(){return this._node};pi.prototype.toString=function(){var e=Math.atan2(this._dy,this._dx),t=this.getClass().getName(),n=t.lastIndexOf("."),r=t.substring(n+1);return"  "+r+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label};pi.prototype.computeLabel=function(e){};pi.prototype.init=function(e,t){this._p0=e,this._p1=t,this._dx=t.x-e.x,this._dy=t.y-e.y,this._quadrant=Ln.quadrant(this._dx,this._dy),Ve.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};pi.prototype.interfaces_=function(){return[Uo]};pi.prototype.getClass=function(){return pi};var T_=function(e){function t(){var n=arguments[0],r=arguments[1];if(e.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=r,r)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var a=n.getNumPoints()-1;this.init(n.getCoordinate(a),n.getCoordinate(a-1))}this.computeDirectedLabel()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getNextMin=function(){return this._nextMin},t.prototype.getDepth=function(n){return this._depth[n]},t.prototype.setVisited=function(n){this._isVisited=n},t.prototype.computeDirectedLabel=function(){this._label=new Cn(this._edge.getLabel()),this._isForward||this._label.flip()},t.prototype.getNext=function(){return this._next},t.prototype.setDepth=function(n,r){if(this._depth[n]!==-999&&this._depth[n]!==r)throw new Fa("assigned depths do not match",this.getCoordinate());this._depth[n]=r},t.prototype.isInteriorAreaEdge=function(){for(var n=this,r=!0,a=0;a<2;a++)n._label.isArea(a)&&n._label.getLocation(a,jt.LEFT)===St.INTERIOR&&n._label.getLocation(a,jt.RIGHT)===St.INTERIOR||(r=!1);return r},t.prototype.setNextMin=function(n){this._nextMin=n},t.prototype.print=function(n){e.prototype.print.call(this,n),n.print(" "+this._depth[jt.LEFT]+"/"+this._depth[jt.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},t.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},t.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),r=!this._label.isArea(0)||this._label.allPositionsEqual(0,St.EXTERIOR),a=!this._label.isArea(1)||this._label.allPositionsEqual(1,St.EXTERIOR);return n&&r&&a},t.prototype.setEdgeRing=function(n){this._edgeRing=n},t.prototype.getMinEdgeRing=function(){return this._minEdgeRing},t.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},t.prototype.setInResult=function(n){this._isInResult=n},t.prototype.getSym=function(){return this._sym},t.prototype.isForward=function(){return this._isForward},t.prototype.getEdge=function(){return this._edge},t.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},t.prototype.setSym=function(n){this._sym=n},t.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},t.prototype.setEdgeDepths=function(n,r){var a=this.getEdge().getDepthDelta();this._isForward||(a=-a);var u=1;n===jt.LEFT&&(u=-1);var p=jt.opposite(n),c=a*u,b=r+c;this.setDepth(n,r),this.setDepth(p,b)},t.prototype.getEdgeRing=function(){return this._edgeRing},t.prototype.isInResult=function(){return this._isInResult},t.prototype.setNext=function(n){this._next=n},t.prototype.isVisited=function(){return this._isVisited},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(n,r){return n===St.EXTERIOR&&r===St.INTERIOR?1:n===St.INTERIOR&&r===St.EXTERIOR?-1:0},t}(pi),Vh=function(){};Vh.prototype.createNode=function(e){return new gg(e,null)};Vh.prototype.interfaces_=function(){return[]};Vh.prototype.getClass=function(){return Vh};var er=function(){if(this._edges=new Qt,this._nodes=null,this._edgeEndList=new Qt,arguments.length===0)this._nodes=new Os(new Vh);else if(arguments.length===1){var e=arguments[0];this._nodes=new Os(e)}};er.prototype.printEdges=function(e){var t=this;e.println("Edges:");for(var n=0;n<this._edges.size();n++){e.println("edge "+n+":");var r=t._edges.get(n);r.print(e),r.eiList.print(e)}};er.prototype.find=function(e){return this._nodes.find(e)};er.prototype.addNode=function(){if(arguments[0]instanceof gg){var e=arguments[0];return this._nodes.addNode(e)}else if(arguments[0]instanceof bt){var t=arguments[0];return this._nodes.addNode(t)}};er.prototype.getNodeIterator=function(){return this._nodes.iterator()};er.prototype.linkResultDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkResultDirectedEdges()}};er.prototype.debugPrintln=function(e){ri.out.println(e)};er.prototype.isBoundaryNode=function(e,t){var n=this._nodes.find(t);if(n===null)return!1;var r=n.getLabel();return r!==null&&r.getLocation(e)===St.BOUNDARY};er.prototype.linkAllDirectedEdges=function(){for(var e=this._nodes.iterator();e.hasNext();){var t=e.next();t.getEdges().linkAllDirectedEdges()}};er.prototype.matchInSameDirection=function(e,t,n,r){return e.equals(n)?se.computeOrientation(e,t,r)===se.COLLINEAR&&Ln.quadrant(e,t)===Ln.quadrant(n,r):!1};er.prototype.getEdgeEnds=function(){return this._edgeEndList};er.prototype.debugPrint=function(e){ri.out.print(e)};er.prototype.getEdgeIterator=function(){return this._edges.iterator()};er.prototype.findEdgeInSameDirection=function(e,t){for(var n=this,r=0;r<this._edges.size();r++){var a=n._edges.get(r),u=a.getCoordinates();if(n.matchInSameDirection(e,t,u[0],u[1])||n.matchInSameDirection(e,t,u[u.length-1],u[u.length-2]))return a}return null};er.prototype.insertEdge=function(e){this._edges.add(e)};er.prototype.findEdgeEnd=function(e){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===e)return n}return null};er.prototype.addEdges=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next();t._edges.add(r);var a=new T_(r,!0),u=new T_(r,!1);a.setSym(u),u.setSym(a),t.add(a),t.add(u)}};er.prototype.add=function(e){this._nodes.add(e),this._edgeEndList.add(e)};er.prototype.getNodes=function(){return this._nodes.values()};er.prototype.findEdge=function(e,t){for(var n=this,r=0;r<this._edges.size();r++){var a=n._edges.get(r),u=a.getCoordinates();if(e.equals(u[0])&&t.equals(u[1]))return a}return null};er.prototype.interfaces_=function(){return[]};er.prototype.getClass=function(){return er};er.linkResultDirectedEdges=function(e){for(var t=e.iterator();t.hasNext();){var n=t.next();n.getEdges().linkResultDirectedEdges()}};var oo=function(){this._geometryFactory=null,this._shellList=new Qt;var e=arguments[0];this._geometryFactory=e};oo.prototype.sortShellsAndHoles=function(e,t,n){for(var r=e.iterator();r.hasNext();){var a=r.next();a.isHole()?n.add(a):t.add(a)}};oo.prototype.computePolygons=function(e){for(var t=this,n=new Qt,r=e.iterator();r.hasNext();){var a=r.next(),u=a.toPolygon(t._geometryFactory);n.add(u)}return n};oo.prototype.placeFreeHoles=function(e,t){for(var n=this,r=t.iterator();r.hasNext();){var a=r.next();if(a.getShell()===null){var u=n.findEdgeRingContaining(a,e);if(u===null)throw new Fa("unable to assign hole to a shell",a.getCoordinate(0));a.setShell(u)}}};oo.prototype.buildMinimalEdgeRings=function(e,t,n){for(var r=this,a=new Qt,u=e.iterator();u.hasNext();){var p=u.next();if(p.getMaxNodeDegree()>2){p.linkDirectedEdgesForMinimalEdgeRings();var c=p.buildMinimalRings(),b=r.findShell(c);b!==null?(r.placePolygonHoles(b,c),t.add(b)):n.addAll(c)}else a.add(p)}return a};oo.prototype.containsPoint=function(e){for(var t=this._shellList.iterator();t.hasNext();){var n=t.next();if(n.containsPoint(e))return!0}return!1};oo.prototype.buildMaximalEdgeRings=function(e){for(var t=this,n=new Qt,r=e.iterator();r.hasNext();){var a=r.next();if(a.isInResult()&&a.getLabel().isArea()&&a.getEdgeRing()===null){var u=new SM(a,t._geometryFactory);n.add(u),u.setInResult()}}return n};oo.prototype.placePolygonHoles=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next();r.isHole()&&r.setShell(e)}};oo.prototype.getPolygons=function(){var e=this.computePolygons(this._shellList);return e};oo.prototype.findEdgeRingContaining=function(e,t){for(var n=e.getLinearRing(),r=n.getEnvelopeInternal(),a=n.getCoordinateN(0),u=null,p=null,c=t.iterator();c.hasNext();){var b=c.next(),C=b.getLinearRing(),A=C.getEnvelopeInternal();u!==null&&(p=u.getLinearRing().getEnvelopeInternal());var P=!1;A.contains(r)&&se.isPointInRing(a,C.getCoordinates())&&(P=!0),P&&(u===null||p.contains(A))&&(u=b)}return u};oo.prototype.findShell=function(e){for(var t=0,n=null,r=e.iterator();r.hasNext();){var a=r.next();a.isHole()||(n=a,t++)}return Ve.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n};oo.prototype.add=function(){if(arguments.length===1){var e=arguments[0];this.add(e.getEdgeEnds(),e.getNodes())}else if(arguments.length===2){var t=arguments[0],n=arguments[1];er.linkResultDirectedEdges(n);var r=this.buildMaximalEdgeRings(t),a=new Qt,u=this.buildMinimalEdgeRings(r,this._shellList,a);this.sortShellsAndHoles(u,this._shellList,a),this.placeFreeHoles(this._shellList,a)}};oo.prototype.interfaces_=function(){return[]};oo.prototype.getClass=function(){return oo};var Uh=function(){};Uh.prototype.getBounds=function(){};Uh.prototype.interfaces_=function(){return[]};Uh.prototype.getClass=function(){return Uh};var os=function(){this._bounds=null,this._item=null;var e=arguments[0],t=arguments[1];this._bounds=e,this._item=t};os.prototype.getItem=function(){return this._item};os.prototype.getBounds=function(){return this._bounds};os.prototype.interfaces_=function(){return[Uh,Go]};os.prototype.getClass=function(){return os};var Ba=function(){this._size=null,this._items=null,this._size=0,this._items=new Qt,this._items.add(null)};Ba.prototype.poll=function(){if(this.isEmpty())return null;var e=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),e};Ba.prototype.size=function(){return this._size};Ba.prototype.reorder=function(e){for(var t=this,n=null,r=this._items.get(e);e*2<=this._size&&(n=e*2,n!==t._size&&t._items.get(n+1).compareTo(t._items.get(n))<0&&n++,t._items.get(n).compareTo(r)<0);e=n)t._items.set(e,t._items.get(n));this._items.set(e,r)};Ba.prototype.clear=function(){this._size=0,this._items.clear()};Ba.prototype.isEmpty=function(){return this._size===0};Ba.prototype.add=function(e){var t=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,e);e.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)t._items.set(n,t._items.get(Math.trunc(n/2)));this._items.set(n,e)};Ba.prototype.interfaces_=function(){return[]};Ba.prototype.getClass=function(){return Ba};var _l=function(){};_l.prototype.visitItem=function(e){};_l.prototype.interfaces_=function(){return[]};_l.prototype.getClass=function(){return _l};var Yu=function(){};Yu.prototype.insert=function(e,t){};Yu.prototype.remove=function(e,t){};Yu.prototype.query=function(){};Yu.prototype.interfaces_=function(){return[]};Yu.prototype.getClass=function(){return Yu};var Tr=function(){if(this._childBoundables=new Qt,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this._level=e}},d2={serialVersionUID:{configurable:!0}};Tr.prototype.getLevel=function(){return this._level};Tr.prototype.size=function(){return this._childBoundables.size()};Tr.prototype.getChildBoundables=function(){return this._childBoundables};Tr.prototype.addChildBoundable=function(e){Ve.isTrue(this._bounds===null),this._childBoundables.add(e)};Tr.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};Tr.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};Tr.prototype.interfaces_=function(){return[Uh,Go]};Tr.prototype.getClass=function(){return Tr};d2.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(Tr,d2);var ss=function(){};ss.reverseOrder=function(){return{compare:function(e,t){return t.compareTo(e)}}};ss.min=function(e){return ss.sort(e),e.get(0)};ss.sort=function(e,t){var n=e.toArray();t?tu.sort(n,t):tu.sort(n);for(var r=e.iterator(),a=0,u=n.length;a<u;a++)r.next(),r.set(n[a])};ss.singletonList=function(e){var t=new Qt;return t.add(e),t};var _r=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var e=arguments[0],t=arguments[1],n=arguments[2];this._boundable1=e,this._boundable2=t,this._itemDistance=n,this._distance=this.distance()};_r.prototype.expandToQueue=function(e,t){var n=_r.isComposite(this._boundable1),r=_r.isComposite(this._boundable2);if(n&&r)return _r.area(this._boundable1)>_r.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,e,t),null):(this.expand(this._boundable2,this._boundable1,e,t),null);if(n)return this.expand(this._boundable1,this._boundable2,e,t),null;if(r)return this.expand(this._boundable2,this._boundable1,e,t),null;throw new Hn("neither boundable is composite")};_r.prototype.isLeaves=function(){return!(_r.isComposite(this._boundable1)||_r.isComposite(this._boundable2))};_r.prototype.compareTo=function(e){var t=e;return this._distance<t._distance?-1:this._distance>t._distance?1:0};_r.prototype.expand=function(e,t,n,r){for(var a=this,u=e.getChildBoundables(),p=u.iterator();p.hasNext();){var c=p.next(),b=new _r(c,t,a._itemDistance);b.getDistance()<r&&n.add(b)}};_r.prototype.getBoundable=function(e){return e===0?this._boundable1:this._boundable2};_r.prototype.getDistance=function(){return this._distance};_r.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};_r.prototype.interfaces_=function(){return[Uo]};_r.prototype.getClass=function(){return _r};_r.area=function(e){return e.getBounds().getArea()};_r.isComposite=function(e){return e instanceof Tr};var Kr=function e(){if(this._root=null,this._built=!1,this._itemBoundables=new Qt,this._nodeCapacity=null,arguments.length===0){var t=e.DEFAULT_NODE_CAPACITY;this._nodeCapacity=t}else if(arguments.length===1){var n=arguments[0];Ve.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},yg={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Kr.prototype.getNodeCapacity=function(){return this._nodeCapacity};Kr.prototype.lastNode=function(e){return e.get(e.size()-1)};Kr.prototype.size=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,r=t.getChildBoundables().iterator();r.hasNext();){var a=r.next();a instanceof Tr?n+=e.size(a):a instanceof os&&(n+=1)}return n}};Kr.prototype.removeItem=function(e,t){for(var n=null,r=e.getChildBoundables().iterator();r.hasNext();){var a=r.next();a instanceof os&&a.getItem()===t&&(n=a)}return n!==null?(e.getChildBoundables().remove(n),!0):!1};Kr.prototype.itemsTree=function(){var e=this;if(arguments.length===0){this.build();var t=this.itemsTree(this._root);return t===null?new Qt:t}else if(arguments.length===1){for(var n=arguments[0],r=new Qt,a=n.getChildBoundables().iterator();a.hasNext();){var u=a.next();if(u instanceof Tr){var p=e.itemsTree(u);p!==null&&r.add(p)}else u instanceof os?r.add(u.getItem()):Ve.shouldNeverReachHere()}return r.size()<=0?null:r}};Kr.prototype.insert=function(e,t){Ve.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new os(e,t))};Kr.prototype.boundablesAtLevel=function(){var e=this;if(arguments.length===1){var t=arguments[0],n=new Qt;return this.boundablesAtLevel(t,this._root,n),n}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];if(Ve.isTrue(r>-2),a.getLevel()===r)return u.add(a),null;for(var p=a.getChildBoundables().iterator();p.hasNext();){var c=p.next();c instanceof Tr?e.boundablesAtLevel(r,c,u):(Ve.isTrue(c instanceof os),r===-1&&u.add(c))}return null}};Kr.prototype.query=function(){var e=this;if(arguments.length===1){var t=arguments[0];this.build();var n=new Qt;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),t)&&this.query(t,this._root,n),n}else if(arguments.length===2){var r=arguments[0],a=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),r)&&this.query(r,this._root,a)}else if(arguments.length===3){if(Le(arguments[2],_l)&&arguments[0]instanceof Object&&arguments[1]instanceof Tr)for(var u=arguments[0],p=arguments[1],c=arguments[2],b=p.getChildBoundables(),C=0;C<b.size();C++){var A=b.get(C);e.getIntersectsOp().intersects(A.getBounds(),u)&&(A instanceof Tr?e.query(u,A,c):A instanceof os?c.visitItem(A.getItem()):Ve.shouldNeverReachHere())}else if(Le(arguments[2],ns)&&arguments[0]instanceof Object&&arguments[1]instanceof Tr)for(var P=arguments[0],R=arguments[1],et=arguments[2],X=R.getChildBoundables(),K=0;K<X.size();K++){var ot=X.get(K);e.getIntersectsOp().intersects(ot.getBounds(),P)&&(ot instanceof Tr?e.query(P,ot,et):ot instanceof os?et.add(ot.getItem()):Ve.shouldNeverReachHere())}}};Kr.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Kr.prototype.getRoot=function(){return this.build(),this._root};Kr.prototype.remove=function(){var e=this;if(arguments.length===2){var t=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),t)?this.remove(t,this._root,n):!1}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2],p=this.removeItem(a,u);if(p)return!0;for(var c=null,b=a.getChildBoundables().iterator();b.hasNext();){var C=b.next();if(e.getIntersectsOp().intersects(C.getBounds(),r)&&C instanceof Tr&&(p=e.remove(r,C,u),p)){c=C;break}}return c!==null&&c.getChildBoundables().isEmpty()&&a.getChildBoundables().remove(c),p}};Kr.prototype.createHigherLevels=function(e,t){Ve.isTrue(!e.isEmpty());var n=this.createParentBoundables(e,t+1);return n.size()===1?n.get(0):this.createHigherLevels(n,t+1)};Kr.prototype.depth=function(){var e=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var t=arguments[0],n=0,r=t.getChildBoundables().iterator();r.hasNext();){var a=r.next();if(a instanceof Tr){var u=e.depth(a);u>n&&(n=u)}}return n+1}};Kr.prototype.createParentBoundables=function(e,t){var n=this;Ve.isTrue(!e.isEmpty());var r=new Qt;r.add(this.createNode(t));var a=new Qt(e);ss.sort(a,this.getComparator());for(var u=a.iterator();u.hasNext();){var p=u.next();n.lastNode(r).getChildBoundables().size()===n.getNodeCapacity()&&r.add(n.createNode(t)),n.lastNode(r).addChildBoundable(p)}return r};Kr.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Kr.prototype.interfaces_=function(){return[Go]};Kr.prototype.getClass=function(){return Kr};Kr.compareDoubles=function(e,t){return e>t?1:e<t?-1:0};yg.IntersectsOp.get=function(){return IM};yg.serialVersionUID.get=function(){return-3886435814360241e3};yg.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Kr,yg);var IM=function(){},Gh=function(){};Gh.prototype.distance=function(e,t){};Gh.prototype.interfaces_=function(){return[]};Gh.prototype.getClass=function(){return Gh};var m2=function(e){function t(r){r=r||t.DEFAULT_NODE_CAPACITY,e.call(this,r)}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(r,a){var u=this;Ve.isTrue(r.length>0);for(var p=new Qt,c=0;c<r.length;c++)p.addAll(u.createParentBoundablesFromVerticalSlice(r[c],a));return p},t.prototype.createNode=function(r){return new Yx(r)},t.prototype.size=function(){return arguments.length===0?e.prototype.size.call(this):e.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];if(r.isNull())return null;e.prototype.insert.call(this,r,a)}else return e.prototype.insert.apply(this,arguments)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(r,a){for(var u=Math.trunc(Math.ceil(r.size()/a)),p=new Array(a).fill(null),c=r.iterator(),b=0;b<a;b++){p[b]=new Qt;for(var C=0;c.hasNext()&&C<u;){var A=c.next();p[b].add(A),C++}}return p},t.prototype.query=function(){if(arguments.length===1){var r=arguments[0];return e.prototype.query.call(this,r)}else if(arguments.length===2){var a=arguments[0],u=arguments[1];e.prototype.query.call(this,a,u)}else if(arguments.length===3){if(Le(arguments[2],_l)&&arguments[0]instanceof Object&&arguments[1]instanceof Tr){var p=arguments[0],c=arguments[1],b=arguments[2];e.prototype.query.call(this,p,c,b)}else if(Le(arguments[2],ns)&&arguments[0]instanceof Object&&arguments[1]instanceof Tr){var C=arguments[0],A=arguments[1],P=arguments[2];e.prototype.query.call(this,C,A,P)}}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(r,a){return e.prototype.createParentBoundables.call(this,r,a)},t.prototype.remove=function(){if(arguments.length===2){var r=arguments[0],a=arguments[1];return e.prototype.remove.call(this,r,a)}else return e.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return arguments.length===0?e.prototype.depth.call(this):e.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(r,a){Ve.isTrue(!r.isEmpty());var u=Math.trunc(Math.ceil(r.size()/this.getNodeCapacity())),p=new Qt(r);ss.sort(p,t.xComparator);var c=this.verticalSlices(p,Math.trunc(Math.ceil(Math.sqrt(u))));return this.createParentBoundablesFromVerticalSlices(c,a)},t.prototype.nearestNeighbour=function(){if(arguments.length===1){if(Le(arguments[0],Gh)){var r=arguments[0],a=new _r(this.getRoot(),this.getRoot(),r);return this.nearestNeighbour(a)}else if(arguments[0]instanceof _r){var u=arguments[0];return this.nearestNeighbour(u,De.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof t&&Le(arguments[1],Gh)){var p=arguments[0],c=arguments[1],b=new _r(this.getRoot(),p.getRoot(),c);return this.nearestNeighbour(b)}else if(arguments[0]instanceof _r&&typeof arguments[1]=="number"){var C=arguments[0],A=arguments[1],P=A,R=null,et=new Ba;for(et.add(C);!et.isEmpty()&&P>0;){var X=et.poll(),K=X.getDistance();if(K>=P)break;X.isLeaves()?(P=K,R=X):X.expandToQueue(et,P)}return[R.getBoundable(0).getItem(),R.getBoundable(1).getItem()]}}else if(arguments.length===3){var ot=arguments[0],gt=arguments[1],q=arguments[2],W=new os(ot,gt),at=new _r(this.getRoot(),W,q);return this.nearestNeighbour(at)[0]}},t.prototype.interfaces_=function(){return[Yu,Go]},t.prototype.getClass=function(){return t},t.centreX=function(r){return t.avg(r.getMinX(),r.getMaxX())},t.avg=function(r,a){return(r+a)/2},t.centreY=function(r){return t.avg(r.getMinY(),r.getMaxY())},n.STRtreeNode.get=function(){return Yx},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[Dh]},compare:function(r,a){return e.compareDoubles(t.centreX(r.getBounds()),t.centreX(a.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[Dh]},compare:function(r,a){return e.compareDoubles(t.centreY(r.getBounds()),t.centreY(a.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[e.IntersectsOp]},intersects:function(r,a){return r.intersects(a)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,n),t}(Kr),Yx=function(e){function t(){var n=arguments[0];e.call(this,n)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.computeBounds=function(){for(var n=null,r=this.getChildBoundables().iterator();r.hasNext();){var a=r.next();n===null?n=new ye(a.getBounds()):n.expandToInclude(a.getBounds())}return n},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Tr),Ni=function(){};Ni.prototype.interfaces_=function(){return[]};Ni.prototype.getClass=function(){return Ni};Ni.relativeSign=function(e,t){return e<t?-1:e>t?1:0};Ni.compare=function(e,t,n){if(t.equals2D(n))return 0;var r=Ni.relativeSign(t.x,n.x),a=Ni.relativeSign(t.y,n.y);switch(e){case 0:return Ni.compareValue(r,a);case 1:return Ni.compareValue(a,r);case 2:return Ni.compareValue(a,-r);case 3:return Ni.compareValue(-r,a);case 4:return Ni.compareValue(-r,-a);case 5:return Ni.compareValue(-a,-r);case 6:return Ni.compareValue(-a,r);case 7:return Ni.compareValue(r,-a)}return Ve.shouldNeverReachHere("invalid octant value"),0};Ni.compareValue=function(e,t){return e<0?-1:e>0?1:t<0?-1:t>0?1:0};var vl=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._segString=e,this.coord=new bt(t),this.segmentIndex=n,this._segmentOctant=r,this._isInterior=!t.equals2D(e.getCoordinate(n))};vl.prototype.getCoordinate=function(){return this.coord};vl.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex)};vl.prototype.compareTo=function(e){var t=e;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:Ni.compare(this._segmentOctant,this.coord,t.coord)};vl.prototype.isEndPoint=function(e){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===e};vl.prototype.isInterior=function(){return this._isInterior};vl.prototype.interfaces_=function(){return[Uo]};vl.prototype.getClass=function(){return vl};var Ci=function(){this._nodeMap=new hi,this._edge=null;var e=arguments[0];this._edge=e};Ci.prototype.getSplitCoordinates=function(){var e=this,t=new Jf;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var a=n.next();e.addEdgeCoordinates(r,a,t),r=a}return t.toCoordinateArray()};Ci.prototype.addCollapsedNodes=function(){var e=this,t=new Qt;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var n=t.iterator();n.hasNext();){var r=n.next().intValue();e.add(e._edge.getCoordinate(r),r)}};Ci.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};Ci.prototype.findCollapsesFromExistingVertices=function(e){for(var t=this,n=0;n<this._edge.size()-2;n++){var r=t._edge.getCoordinate(n),a=t._edge.getCoordinate(n+2);r.equals2D(a)&&e.add(new Ms(n+1))}};Ci.prototype.addEdgeCoordinates=function(e,t,n){var r=this,a=this._edge.getCoordinate(t.segmentIndex),u=t.isInterior()||!t.coord.equals2D(a);n.add(new bt(e.coord),!1);for(var p=e.segmentIndex+1;p<=t.segmentIndex;p++)n.add(r._edge.getCoordinate(p));u&&n.add(new bt(t.coord))};Ci.prototype.iterator=function(){return this._nodeMap.values().iterator()};Ci.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),r=n.next();n.hasNext();){var a=n.next(),u=t.createSplitEdge(r,a);e.add(u),r=a}};Ci.prototype.findCollapseIndex=function(e,t,n){if(!e.coord.equals2D(t.coord))return!1;var r=t.segmentIndex-e.segmentIndex;return t.isInterior()||r--,r===1?(n[0]=e.segmentIndex+1,!0):!1};Ci.prototype.findCollapsesFromInsertedNodes=function(e){for(var t=this,n=new Array(1).fill(null),r=this.iterator(),a=r.next();r.hasNext();){var u=r.next(),p=t.findCollapseIndex(a,u,n);p&&e.add(new Ms(n[0])),a=u}};Ci.prototype.getEdge=function(){return this._edge};Ci.prototype.addEndpoints=function(){var e=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(e),e)};Ci.prototype.createSplitEdge=function(e,t){var n=this,r=t.segmentIndex-e.segmentIndex+2,a=this._edge.getCoordinate(t.segmentIndex),u=t.isInterior()||!t.coord.equals2D(a);u||r--;var p=new Array(r).fill(null),c=0;p[c++]=new bt(e.coord);for(var b=e.segmentIndex+1;b<=t.segmentIndex;b++)p[c++]=n._edge.getCoordinate(b);return u&&(p[c]=new bt(t.coord)),new gr(p,this._edge.getData())};Ci.prototype.add=function(e,t){var n=new vl(this._edge,e,t,this._edge.getSegmentOctant(t)),r=this._nodeMap.get(n);return r!==null?(Ve.isTrue(r.coord.equals2D(e),"Found equal nodes with different coordinates"),r):(this._nodeMap.put(n,n),n)};Ci.prototype.checkSplitEdgesCorrectness=function(e){var t=this._edge.getCoordinates(),n=e.get(0),r=n.getCoordinate(0);if(!r.equals2D(t[0]))throw new Oa("bad split edge start point at "+r);var a=e.get(e.size()-1),u=a.getCoordinates(),p=u[u.length-1];if(!p.equals2D(t[t.length-1]))throw new Oa("bad split edge end point at "+p)};Ci.prototype.interfaces_=function(){return[]};Ci.prototype.getClass=function(){return Ci};var Ku=function(){};Ku.prototype.interfaces_=function(){return[]};Ku.prototype.getClass=function(){return Ku};Ku.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var e=arguments[0],t=arguments[1];if(e===0&&t===0)throw new Hn("Cannot compute the octant for point ( "+e+", "+t+" )");var n=Math.abs(e),r=Math.abs(t);return e>=0?t>=0?n>=r?0:1:n>=r?7:6:t>=0?n>=r?3:2:n>=r?4:5}else if(arguments[0]instanceof bt&&arguments[1]instanceof bt){var a=arguments[0],u=arguments[1],p=u.x-a.x,c=u.y-a.y;if(p===0&&c===0)throw new Hn("Cannot compute the octant for two identical points "+a);return Ku.octant(p,c)}};var ua=function(){};ua.prototype.getCoordinates=function(){};ua.prototype.size=function(){};ua.prototype.getCoordinate=function(e){};ua.prototype.isClosed=function(){};ua.prototype.setData=function(e){};ua.prototype.getData=function(){};ua.prototype.interfaces_=function(){return[]};ua.prototype.getClass=function(){return ua};var Ff=function(){};Ff.prototype.addIntersection=function(e,t){};Ff.prototype.interfaces_=function(){return[ua]};Ff.prototype.getClass=function(){return Ff};var gr=function(){this._nodeList=new Ci(this),this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};gr.prototype.getCoordinates=function(){return this._pts};gr.prototype.size=function(){return this._pts.length};gr.prototype.getCoordinate=function(e){return this._pts[e]};gr.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};gr.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(e),this.getCoordinate(e+1))};gr.prototype.setData=function(e){this._data=e};gr.prototype.safeOctant=function(e,t){return e.equals2D(t)?0:Ku.octant(e,t)};gr.prototype.getData=function(){return this._data};gr.prototype.addIntersection=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1];this.addIntersectionNode(e,t)}else if(arguments.length===4){var n=arguments[0],r=arguments[1],a=arguments[3],u=new bt(n.getIntersection(a));this.addIntersection(u,r)}};gr.prototype.toString=function(){return rs.toLineString(new fr(this._pts))};gr.prototype.getNodeList=function(){return this._nodeList};gr.prototype.addIntersectionNode=function(e,t){var n=t,r=n+1;if(r<this._pts.length){var a=this._pts[r];e.equals2D(a)&&(n=r)}var u=this._nodeList.add(e,n);return u};gr.prototype.addIntersections=function(e,t,n){for(var r=this,a=0;a<e.getIntersectionNum();a++)r.addIntersection(e,t,n,a)};gr.prototype.interfaces_=function(){return[Ff]};gr.prototype.getClass=function(){return gr};gr.getNodedSubstrings=function(){if(arguments.length===1){var e=arguments[0],t=new Qt;return gr.getNodedSubstrings(e,t),t}else if(arguments.length===2)for(var n=arguments[0],r=arguments[1],a=n.iterator();a.hasNext();){var u=a.next();u.getNodeList().addSplitEdges(r)}};var _e=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new bt,this.p1=new bt;else if(arguments.length===1){var e=arguments[0];this.p0=new bt(e.p0),this.p1=new bt(e.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var t=arguments[0],n=arguments[1],r=arguments[2],a=arguments[3];this.p0=new bt(t,n),this.p1=new bt(r,a)}},g2={serialVersionUID:{configurable:!0}};_e.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};_e.prototype.orientationIndex=function(){if(arguments[0]instanceof _e){var e=arguments[0],t=se.orientationIndex(this.p0,this.p1,e.p0),n=se.orientationIndex(this.p0,this.p1,e.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}else if(arguments[0]instanceof bt){var r=arguments[0];return se.orientationIndex(this.p0,this.p1,r)}};_e.prototype.toGeometry=function(e){return e.createLineString([this.p0,this.p1])};_e.prototype.isVertical=function(){return this.p0.x===this.p1.x};_e.prototype.equals=function(e){if(!(e instanceof _e))return!1;var t=e;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)};_e.prototype.intersection=function(e){var t=new du;return t.computeIntersection(this.p0,this.p1,e.p0,e.p1),t.hasIntersection()?t.getIntersection(0):null};_e.prototype.project=function(){if(arguments[0]instanceof bt){var e=arguments[0];if(e.equals(this.p0)||e.equals(this.p1))return new bt(e);var t=this.projectionFactor(e),n=new bt;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof _e){var r=arguments[0],a=this.projectionFactor(r.p0),u=this.projectionFactor(r.p1);if(a>=1&&u>=1||a<=0&&u<=0)return null;var p=this.project(r.p0);a<0&&(p=this.p0),a>1&&(p=this.p1);var c=this.project(r.p1);return u<0&&(c=this.p0),u>1&&(c=this.p1),new _e(p,c)}};_e.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};_e.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};_e.prototype.getCoordinate=function(e){return e===0?this.p0:this.p1};_e.prototype.distancePerpendicular=function(e){return se.distancePointLinePerpendicular(e,this.p0,this.p1)};_e.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};_e.prototype.midPoint=function(){return _e.midPoint(this.p0,this.p1)};_e.prototype.projectionFactor=function(e){if(e.equals(this.p0))return 0;if(e.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,r=t*t+n*n;if(r<=0)return De.NaN;var a=((e.x-this.p0.x)*t+(e.y-this.p0.y)*n)/r;return a};_e.prototype.closestPoints=function(e){var t=this.intersection(e);if(t!==null)return[t,t];var n=new Array(2).fill(null),r=De.MAX_VALUE,a=null,u=this.closestPoint(e.p0);r=u.distance(e.p0),n[0]=u,n[1]=e.p0;var p=this.closestPoint(e.p1);a=p.distance(e.p1),a<r&&(r=a,n[0]=p,n[1]=e.p1);var c=e.closestPoint(this.p0);a=c.distance(this.p0),a<r&&(r=a,n[0]=this.p0,n[1]=c);var b=e.closestPoint(this.p1);return a=b.distance(this.p1),a<r&&(r=a,n[0]=this.p1,n[1]=b),n};_e.prototype.closestPoint=function(e){var t=this.projectionFactor(e);if(t>0&&t<1)return this.project(e);var n=this.p0.distance(e),r=this.p1.distance(e);return n<r?this.p0:this.p1};_e.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};_e.prototype.getLength=function(){return this.p0.distance(this.p1)};_e.prototype.compareTo=function(e){var t=e,n=this.p0.compareTo(t.p0);return n!==0?n:this.p1.compareTo(t.p1)};_e.prototype.reverse=function(){var e=this.p0;this.p0=this.p1,this.p1=e};_e.prototype.equalsTopo=function(e){return this.p0.equals(e.p0)&&(this.p1.equals(e.p1)||this.p0.equals(e.p1))&&this.p1.equals(e.p0)};_e.prototype.lineIntersection=function(e){try{var t=es.intersection(this.p0,this.p1,e.p0,e.p1);return t}catch(n){if(!(n instanceof ep))throw n}finally{}return null};_e.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};_e.prototype.pointAlongOffset=function(e,t){var n=this.p0.x+e*(this.p1.x-this.p0.x),r=this.p0.y+e*(this.p1.y-this.p0.y),a=this.p1.x-this.p0.x,u=this.p1.y-this.p0.y,p=Math.sqrt(a*a+u*u),c=0,b=0;if(t!==0){if(p<=0)throw new Error("Cannot compute offset from zero-length line segment");c=t*a/p,b=t*u/p}var C=n-b,A=r+c,P=new bt(C,A);return P};_e.prototype.setCoordinates=function(){if(arguments.length===1){var e=arguments[0];this.setCoordinates(e.p0,e.p1)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}};_e.prototype.segmentFraction=function(e){var t=this.projectionFactor(e);return t<0?t=0:(t>1||De.isNaN(t))&&(t=1),t};_e.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};_e.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};_e.prototype.distance=function(){if(arguments[0]instanceof _e){var e=arguments[0];return se.distanceLineLine(this.p0,this.p1,e.p0,e.p1)}else if(arguments[0]instanceof bt){var t=arguments[0];return se.distancePointLine(t,this.p0,this.p1)}};_e.prototype.pointAlong=function(e){var t=new bt;return t.x=this.p0.x+e*(this.p1.x-this.p0.x),t.y=this.p0.y+e*(this.p1.y-this.p0.y),t};_e.prototype.hashCode=function(){var e=De.doubleToLongBits(this.p0.x);e^=De.doubleToLongBits(this.p0.y)*31;var t=Math.trunc(e)^Math.trunc(e>>32),n=De.doubleToLongBits(this.p1.x);n^=De.doubleToLongBits(this.p1.y)*31;var r=Math.trunc(n)^Math.trunc(n>>32);return t^r};_e.prototype.interfaces_=function(){return[Uo,Go]};_e.prototype.getClass=function(){return _e};_e.midPoint=function(e,t){return new bt((e.x+t.x)/2,(e.y+t.y)/2)};g2.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(_e,g2);var Bf=function(){this.tempEnv1=new ye,this.tempEnv2=new ye,this._overlapSeg1=new _e,this._overlapSeg2=new _e};Bf.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];e.getLineSegment(t,this._overlapSeg1),n.getLineSegment(r,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};Bf.prototype.interfaces_=function(){return[]};Bf.prototype.getClass=function(){return Bf};var so=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this._pts=e,this._start=t,this._end=n,this._context=r};so.prototype.getLineSegment=function(e,t){t.p0=this._pts[e],t.p1=this._pts[e+1]};so.prototype.computeSelect=function(e,t,n,r){var a=this._pts[t],u=this._pts[n];if(r.tempEnv1.init(a,u),n-t===1)return r.select(this,t),null;if(!e.intersects(r.tempEnv1))return null;var p=Math.trunc((t+n)/2);t<p&&this.computeSelect(e,t,p,r),p<n&&this.computeSelect(e,p,n,r)};so.prototype.getCoordinates=function(){for(var e=this,t=new Array(this._end-this._start+1).fill(null),n=0,r=this._start;r<=this._end;r++)t[n++]=e._pts[r];return t};so.prototype.computeOverlaps=function(e,t){this.computeOverlapsInternal(this._start,this._end,e,e._start,e._end,t)};so.prototype.setId=function(e){this._id=e};so.prototype.select=function(e,t){this.computeSelect(e,this._start,this._end,t)};so.prototype.getEnvelope=function(){if(this._env===null){var e=this._pts[this._start],t=this._pts[this._end];this._env=new ye(e,t)}return this._env};so.prototype.getEndIndex=function(){return this._end};so.prototype.getStartIndex=function(){return this._start};so.prototype.getContext=function(){return this._context};so.prototype.getId=function(){return this._id};so.prototype.computeOverlapsInternal=function(e,t,n,r,a,u){var p=this._pts[e],c=this._pts[t],b=n._pts[r],C=n._pts[a];if(t-e===1&&a-r===1)return u.overlap(this,e,n,r),null;if(u.tempEnv1.init(p,c),u.tempEnv2.init(b,C),!u.tempEnv1.intersects(u.tempEnv2))return null;var A=Math.trunc((e+t)/2),P=Math.trunc((r+a)/2);e<A&&(r<P&&this.computeOverlapsInternal(e,A,n,r,P,u),P<a&&this.computeOverlapsInternal(e,A,n,P,a,u)),A<t&&(r<P&&this.computeOverlapsInternal(A,t,n,r,P,u),P<a&&this.computeOverlapsInternal(A,t,n,P,a,u))};so.prototype.interfaces_=function(){return[]};so.prototype.getClass=function(){return so};var As=function(){};As.prototype.interfaces_=function(){return[]};As.prototype.getClass=function(){return As};As.getChainStartIndices=function(e){var t=0,n=new Qt;n.add(new Ms(t));do{var r=As.findChainEnd(e,t);n.add(new Ms(r)),t=r}while(t<e.length-1);var a=As.toIntArray(n);return a};As.findChainEnd=function(e,t){for(var n=t;n<e.length-1&&e[n].equals2D(e[n+1]);)n++;if(n>=e.length-1)return e.length-1;for(var r=Ln.quadrant(e[n],e[n+1]),a=t+1;a<e.length;){if(!e[a-1].equals2D(e[a])){var u=Ln.quadrant(e[a-1],e[a]);if(u!==r)break}a++}return a-1};As.getChains=function(){if(arguments.length===1){var e=arguments[0];return As.getChains(e,null)}else if(arguments.length===2){for(var t=arguments[0],n=arguments[1],r=new Qt,a=As.getChainStartIndices(t),u=0;u<a.length-1;u++){var p=new so(t,a[u],a[u+1],n);r.add(p)}return r}};As.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var iu=function(){};iu.prototype.computeNodes=function(e){};iu.prototype.getNodedSubstrings=function(){};iu.prototype.interfaces_=function(){return[]};iu.prototype.getClass=function(){return iu};var Vf=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];this.setSegmentIntersector(e)}};Vf.prototype.setSegmentIntersector=function(e){this._segInt=e};Vf.prototype.interfaces_=function(){return[iu]};Vf.prototype.getClass=function(){return Vf};var h0=function(e){function t(r){r?e.call(this,r):e.call(this),this._monoChains=new Qt,this._index=new m2,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this._monoChains},t.prototype.getNodedSubstrings=function(){return gr.getNodedSubstrings(this._nodedSegStrings)},t.prototype.getIndex=function(){return this._index},t.prototype.add=function(r){for(var a=this,u=As.getChains(r.getCoordinates(),r),p=u.iterator();p.hasNext();){var c=p.next();c.setId(a._idCounter++),a._index.insert(c.getEnvelope(),c),a._monoChains.add(c)}},t.prototype.computeNodes=function(r){var a=this;this._nodedSegStrings=r;for(var u=r.iterator();u.hasNext();)a.add(u.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var r=this,a=new Kx(this._segInt),u=this._monoChains.iterator();u.hasNext();)for(var p=u.next(),c=r._index.query(p.getEnvelope()),b=c.iterator();b.hasNext();){var C=b.next();if(C.getId()>p.getId()&&(p.computeOverlaps(C,a),r._nOverlaps++),r._segInt.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return Kx},Object.defineProperties(t,n),t}(Vf),Kx=function(e){function t(){e.call(this),this._si=null;var n=arguments[0];this._si=n}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],r=arguments[1],a=arguments[2],u=arguments[3],p=n.getContext(),c=a.getContext();this._si.processIntersections(p,r,c,u)}else return e.prototype.overlap.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Bf),bn=function e(){if(this._quadrantSegments=e.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=e.CAP_ROUND,this._joinStyle=e.JOIN_ROUND,this._mitreLimit=e.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=e.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var t=arguments[0];this.setQuadrantSegments(t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(r)}else if(arguments.length===4){var a=arguments[0],u=arguments[1],p=arguments[2],c=arguments[3];this.setQuadrantSegments(a),this.setEndCapStyle(u),this.setJoinStyle(p),this.setMitreLimit(c)}}},Wa={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};bn.prototype.getEndCapStyle=function(){return this._endCapStyle};bn.prototype.isSingleSided=function(){return this._isSingleSided};bn.prototype.setQuadrantSegments=function(e){this._quadrantSegments=e,this._quadrantSegments===0&&(this._joinStyle=bn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=bn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),e<=0&&(this._quadrantSegments=1),this._joinStyle!==bn.JOIN_ROUND&&(this._quadrantSegments=bn.DEFAULT_QUADRANT_SEGMENTS)};bn.prototype.getJoinStyle=function(){return this._joinStyle};bn.prototype.setJoinStyle=function(e){this._joinStyle=e};bn.prototype.setSimplifyFactor=function(e){this._simplifyFactor=e<0?0:e};bn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};bn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};bn.prototype.setEndCapStyle=function(e){this._endCapStyle=e};bn.prototype.getMitreLimit=function(){return this._mitreLimit};bn.prototype.setMitreLimit=function(e){this._mitreLimit=e};bn.prototype.setSingleSided=function(e){this._isSingleSided=e};bn.prototype.interfaces_=function(){return[]};bn.prototype.getClass=function(){return bn};bn.bufferDistanceError=function(e){var t=Math.PI/2/e;return 1-Math.cos(t/2)};Wa.CAP_ROUND.get=function(){return 1};Wa.CAP_FLAT.get=function(){return 2};Wa.CAP_SQUARE.get=function(){return 3};Wa.JOIN_ROUND.get=function(){return 1};Wa.JOIN_MITRE.get=function(){return 2};Wa.JOIN_BEVEL.get=function(){return 3};Wa.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};Wa.DEFAULT_MITRE_LIMIT.get=function(){return 5};Wa.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(bn,Wa);var lr=function(e){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=se.COUNTERCLOCKWISE,this._inputLine=e||null},td={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};lr.prototype.isDeletable=function(e,t,n,r){var a=this._inputLine[e],u=this._inputLine[t],p=this._inputLine[n];return!this.isConcave(a,u,p)||!this.isShallow(a,u,p,r)?!1:this.isShallowSampled(a,u,e,n,r)};lr.prototype.deleteShallowConcavities=function(){for(var e=this,t=1,n=this.findNextNonDeletedIndex(t),r=this.findNextNonDeletedIndex(n),a=!1;r<this._inputLine.length;){var u=!1;e.isDeletable(t,n,r,e._distanceTol)&&(e._isDeleted[n]=lr.DELETE,u=!0,a=!0),u?t=r:t=n,n=e.findNextNonDeletedIndex(t),r=e.findNextNonDeletedIndex(n)}return a};lr.prototype.isShallowConcavity=function(e,t,n,r){var a=se.computeOrientation(e,t,n),u=a===this._angleOrientation;if(!u)return!1;var p=se.distancePointLine(t,e,n);return p<r};lr.prototype.isShallowSampled=function(e,t,n,r,a){var u=this,p=Math.trunc((r-n)/lr.NUM_PTS_TO_CHECK);p<=0&&(p=1);for(var c=n;c<r;c+=p)if(!u.isShallow(e,t,u._inputLine[c],a))return!1;return!0};lr.prototype.isConcave=function(e,t,n){var r=se.computeOrientation(e,t,n),a=r===this._angleOrientation;return a};lr.prototype.simplify=function(e){var t=this;this._distanceTol=Math.abs(e),e<0&&(this._angleOrientation=se.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=t.deleteShallowConcavities();while(n);return this.collapseLine()};lr.prototype.findNextNonDeletedIndex=function(e){for(var t=e+1;t<this._inputLine.length&&this._isDeleted[t]===lr.DELETE;)t++;return t};lr.prototype.isShallow=function(e,t,n,r){var a=se.distancePointLine(t,e,n);return a<r};lr.prototype.collapseLine=function(){for(var e=this,t=new Jf,n=0;n<this._inputLine.length;n++)e._isDeleted[n]!==lr.DELETE&&t.add(e._inputLine[n]);return t.toCoordinateArray()};lr.prototype.interfaces_=function(){return[]};lr.prototype.getClass=function(){return lr};lr.simplify=function(e,t){var n=new lr(e);return n.simplify(t)};td.INIT.get=function(){return 0};td.DELETE.get=function(){return 1};td.KEEP.get=function(){return 1};td.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(lr,td);var Io=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new Qt},y2={COORDINATE_ARRAY_TYPE:{configurable:!0}};Io.prototype.getCoordinates=function(){var e=this._ptList.toArray(Io.COORDINATE_ARRAY_TYPE);return e};Io.prototype.setPrecisionModel=function(e){this._precisionModel=e};Io.prototype.addPt=function(e){var t=new bt(e);if(this._precisionModel.makePrecise(t),this.isRedundant(t))return null;this._ptList.add(t)};Io.prototype.revere=function(){};Io.prototype.addPts=function(e,t){var n=this;if(t)for(var r=0;r<e.length;r++)n.addPt(e[r]);else for(var a=e.length-1;a>=0;a--)n.addPt(e[a])};Io.prototype.isRedundant=function(e){if(this._ptList.size()<1)return!1;var t=this._ptList.get(this._ptList.size()-1),n=e.distance(t);return n<this._minimimVertexDistance};Io.prototype.toString=function(){var e=new en,t=e.createLineString(this.getCoordinates());return t.toString()};Io.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var e=new bt(this._ptList.get(0)),t=this._ptList.get(this._ptList.size()-1);if(e.equals(t))return null;this._ptList.add(e)};Io.prototype.setMinimumVertexDistance=function(e){this._minimimVertexDistance=e};Io.prototype.interfaces_=function(){return[]};Io.prototype.getClass=function(){return Io};y2.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Io,y2);var ln=function(){},dc={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};ln.prototype.interfaces_=function(){return[]};ln.prototype.getClass=function(){return ln};ln.toDegrees=function(e){return e*180/Math.PI};ln.normalize=function(e){for(;e>Math.PI;)e-=ln.PI_TIMES_2;for(;e<=-Math.PI;)e+=ln.PI_TIMES_2;return e};ln.angle=function(){if(arguments.length===1){var e=arguments[0];return Math.atan2(e.y,e.x)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],r=n.x-t.x,a=n.y-t.y;return Math.atan2(a,r)}};ln.isAcute=function(e,t,n){var r=e.x-t.x,a=e.y-t.y,u=n.x-t.x,p=n.y-t.y,c=r*u+a*p;return c>0};ln.isObtuse=function(e,t,n){var r=e.x-t.x,a=e.y-t.y,u=n.x-t.x,p=n.y-t.y,c=r*u+a*p;return c<0};ln.interiorAngle=function(e,t,n){var r=ln.angle(t,e),a=ln.angle(t,n);return Math.abs(a-r)};ln.normalizePositive=function(e){if(e<0){for(;e<0;)e+=ln.PI_TIMES_2;e>=ln.PI_TIMES_2&&(e=0)}else{for(;e>=ln.PI_TIMES_2;)e-=ln.PI_TIMES_2;e<0&&(e=0)}return e};ln.angleBetween=function(e,t,n){var r=ln.angle(t,e),a=ln.angle(t,n);return ln.diff(r,a)};ln.diff=function(e,t){var n=null;return e<t?n=t-e:n=e-t,n>Math.PI&&(n=2*Math.PI-n),n};ln.toRadians=function(e){return e*Math.PI/180};ln.getTurn=function(e,t){var n=Math.sin(t-e);return n>0?ln.COUNTERCLOCKWISE:n<0?ln.CLOCKWISE:ln.NONE};ln.angleBetweenOriented=function(e,t,n){var r=ln.angle(t,e),a=ln.angle(t,n),u=a-r;return u<=-Math.PI?u+ln.PI_TIMES_2:u>Math.PI?u-ln.PI_TIMES_2:u};dc.PI_TIMES_2.get=function(){return 2*Math.PI};dc.PI_OVER_2.get=function(){return Math.PI/2};dc.PI_OVER_4.get=function(){return Math.PI/4};dc.COUNTERCLOCKWISE.get=function(){return se.COUNTERCLOCKWISE};dc.CLOCKWISE.get=function(){return se.CLOCKWISE};dc.NONE.get=function(){return se.COLLINEAR};Object.defineProperties(ln,dc);var Un=function e(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new _e,this._seg1=new _e,this._offset0=new _e,this._offset1=new _e,this._side=0,this._hasNarrowConcaveAngle=!1;var t=arguments[0],n=arguments[1],r=arguments[2];this._precisionModel=t,this._bufParams=n,this._li=new du,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===bn.JOIN_ROUND&&(this._closingSegLengthFactor=e.MAX_CLOSING_SEG_LEN_FACTOR),this.init(r)},ed={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Un.prototype.addNextSegment=function(e,t){if(this._s0=this._s1,this._s1=this._s2,this._s2=e,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=se.computeOrientation(this._s0,this._s1,this._s2),r=n===se.CLOCKWISE&&this._side===jt.LEFT||n===se.COUNTERCLOCKWISE&&this._side===jt.RIGHT;n===0?this.addCollinear(t):r?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)};Un.prototype.addLineEndCap=function(e,t){var n=new _e(e,t),r=new _e;this.computeOffsetSegment(n,jt.LEFT,this._distance,r);var a=new _e;this.computeOffsetSegment(n,jt.RIGHT,this._distance,a);var u=t.x-e.x,p=t.y-e.y,c=Math.atan2(p,u);switch(this._bufParams.getEndCapStyle()){case bn.CAP_ROUND:this._segList.addPt(r.p1),this.addFilletArc(t,c+Math.PI/2,c-Math.PI/2,se.CLOCKWISE,this._distance),this._segList.addPt(a.p1);break;case bn.CAP_FLAT:this._segList.addPt(r.p1),this._segList.addPt(a.p1);break;case bn.CAP_SQUARE:var b=new bt;b.x=Math.abs(this._distance)*Math.cos(c),b.y=Math.abs(this._distance)*Math.sin(c);var C=new bt(r.p1.x+b.x,r.p1.y+b.y),A=new bt(a.p1.x+b.x,a.p1.y+b.y);this._segList.addPt(C),this._segList.addPt(A);break}};Un.prototype.getCoordinates=function(){var e=this._segList.getCoordinates();return e};Un.prototype.addMitreJoin=function(e,t,n,r){var a=!0,u=null;try{u=es.intersection(t.p0,t.p1,n.p0,n.p1);var p=r<=0?1:u.distance(e)/Math.abs(r);p>this._bufParams.getMitreLimit()&&(a=!1)}catch(c){if(c instanceof ep)u=new bt(0,0),a=!1;else throw c}finally{}a?this._segList.addPt(u):this.addLimitedMitreJoin(t,n,r,this._bufParams.getMitreLimit())};Un.prototype.addFilletCorner=function(e,t,n,r,a){var u=t.x-e.x,p=t.y-e.y,c=Math.atan2(p,u),b=n.x-e.x,C=n.y-e.y,A=Math.atan2(C,b);r===se.CLOCKWISE?c<=A&&(c+=2*Math.PI):c>=A&&(c-=2*Math.PI),this._segList.addPt(t),this.addFilletArc(e,c,A,r,a),this._segList.addPt(n)};Un.prototype.addOutsideTurn=function(e,t){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*Un.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===bn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===bn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(t&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,e,this._distance),this._segList.addPt(this._offset1.p0))};Un.prototype.createSquare=function(e){this._segList.addPt(new bt(e.x+this._distance,e.y+this._distance)),this._segList.addPt(new bt(e.x+this._distance,e.y-this._distance)),this._segList.addPt(new bt(e.x-this._distance,e.y-this._distance)),this._segList.addPt(new bt(e.x-this._distance,e.y+this._distance)),this._segList.closeRing()};Un.prototype.addSegments=function(e,t){this._segList.addPts(e,t)};Un.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};Un.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};Un.prototype.initSideSegments=function(e,t,n){this._s1=e,this._s2=t,this._side=n,this._seg1.setCoordinates(e,t),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};Un.prototype.addLimitedMitreJoin=function(e,t,n,r){var a=this._seg0.p1,u=ln.angle(a,this._seg0.p0),p=ln.angleBetweenOriented(this._seg0.p0,a,this._seg1.p1),c=p/2,b=ln.normalize(u+c),C=ln.normalize(b+Math.PI),A=r*n,P=A*Math.abs(Math.sin(c)),R=n-P,et=a.x+A*Math.cos(C),X=a.y+A*Math.sin(C),K=new bt(et,X),ot=new _e(a,K),gt=ot.pointAlongOffset(1,R),q=ot.pointAlongOffset(1,-R);this._side===jt.LEFT?(this._segList.addPt(gt),this._segList.addPt(q)):(this._segList.addPt(q),this._segList.addPt(gt))};Un.prototype.computeOffsetSegment=function(e,t,n,r){var a=t===jt.LEFT?1:-1,u=e.p1.x-e.p0.x,p=e.p1.y-e.p0.y,c=Math.sqrt(u*u+p*p),b=a*n*u/c,C=a*n*p/c;r.p0.x=e.p0.x-C,r.p0.y=e.p0.y+b,r.p1.x=e.p1.x-C,r.p1.y=e.p1.y+b};Un.prototype.addFilletArc=function(e,t,n,r,a){var u=this,p=r===se.CLOCKWISE?-1:1,c=Math.abs(t-n),b=Math.trunc(c/this._filletAngleQuantum+.5);if(b<1)return null;for(var C=0,A=c/b,P=C,R=new bt;P<c;){var et=t+p*P;R.x=e.x+a*Math.cos(et),R.y=e.y+a*Math.sin(et),u._segList.addPt(R),P+=A}};Un.prototype.addInsideTurn=function(e,t){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*Un.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new bt((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var r=new bt((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(r)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};Un.prototype.createCircle=function(e){var t=new bt(e.x+this._distance,e.y);this._segList.addPt(t),this.addFilletArc(e,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};Un.prototype.addBevelJoin=function(e,t){this._segList.addPt(e.p1),this._segList.addPt(t.p0)};Un.prototype.init=function(e){this._distance=e,this._maxCurveSegmentError=e*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Io,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(e*Un.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};Un.prototype.addCollinear=function(e){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var t=this._li.getIntersectionNum();t>=2&&(this._bufParams.getJoinStyle()===bn.JOIN_BEVEL||this._bufParams.getJoinStyle()===bn.JOIN_MITRE?(e&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,se.CLOCKWISE,this._distance))};Un.prototype.closeRing=function(){this._segList.closeRing()};Un.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};Un.prototype.interfaces_=function(){return[]};Un.prototype.getClass=function(){return Un};ed.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};ed.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};ed.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};ed.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(Un,ed);var zi=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var e=arguments[0],t=arguments[1];this._precisionModel=e,this._bufParams=t};zi.prototype.getOffsetCurve=function(e,t){if(this._distance=t,t===0)return null;var n=t<0,r=Math.abs(t),a=this.getSegGen(r);e.length<=1?this.computePointCurve(e[0],a):this.computeOffsetCurve(e,n,a);var u=a.getCoordinates();return n&&Qe.reverse(u),u};zi.prototype.computeSingleSidedBufferCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){n.addSegments(e,!0);var a=lr.simplify(e,-r),u=a.length-1;n.initSideSegments(a[u],a[u-1],jt.LEFT),n.addFirstSegment();for(var p=u-2;p>=0;p--)n.addNextSegment(a[p],!0)}else{n.addSegments(e,!1);var c=lr.simplify(e,r),b=c.length-1;n.initSideSegments(c[0],c[1],jt.LEFT),n.addFirstSegment();for(var C=2;C<=b;C++)n.addNextSegment(c[C],!0)}n.addLastSegment(),n.closeRing()};zi.prototype.computeRingBufferCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);t===jt.RIGHT&&(r=-r);var a=lr.simplify(e,r),u=a.length-1;n.initSideSegments(a[u-1],a[0],t);for(var p=1;p<=u;p++){var c=p!==1;n.addNextSegment(a[p],c)}n.closeRing()};zi.prototype.computeLineBufferCurve=function(e,t){var n=this.simplifyTolerance(this._distance),r=lr.simplify(e,n),a=r.length-1;t.initSideSegments(r[0],r[1],jt.LEFT);for(var u=2;u<=a;u++)t.addNextSegment(r[u],!0);t.addLastSegment(),t.addLineEndCap(r[a-1],r[a]);var p=lr.simplify(e,-n),c=p.length-1;t.initSideSegments(p[c],p[c-1],jt.LEFT);for(var b=c-2;b>=0;b--)t.addNextSegment(p[b],!0);t.addLastSegment(),t.addLineEndCap(p[1],p[0]),t.closeRing()};zi.prototype.computePointCurve=function(e,t){switch(this._bufParams.getEndCapStyle()){case bn.CAP_ROUND:t.createCircle(e);break;case bn.CAP_SQUARE:t.createSquare(e);break}};zi.prototype.getLineCurve=function(e,t){if(this._distance=t,t<0&&!this._bufParams.isSingleSided()||t===0)return null;var n=Math.abs(t),r=this.getSegGen(n);if(e.length<=1)this.computePointCurve(e[0],r);else if(this._bufParams.isSingleSided()){var a=t<0;this.computeSingleSidedBufferCurve(e,a,r)}else this.computeLineBufferCurve(e,r);var u=r.getCoordinates();return u};zi.prototype.getBufferParameters=function(){return this._bufParams};zi.prototype.simplifyTolerance=function(e){return e*this._bufParams.getSimplifyFactor()};zi.prototype.getRingCurve=function(e,t,n){if(this._distance=n,e.length<=2)return this.getLineCurve(e,n);if(n===0)return zi.copyCoordinates(e);var r=this.getSegGen(n);return this.computeRingBufferCurve(e,t,r),r.getCoordinates()};zi.prototype.computeOffsetCurve=function(e,t,n){var r=this.simplifyTolerance(this._distance);if(t){var a=lr.simplify(e,-r),u=a.length-1;n.initSideSegments(a[u],a[u-1],jt.LEFT),n.addFirstSegment();for(var p=u-2;p>=0;p--)n.addNextSegment(a[p],!0)}else{var c=lr.simplify(e,r),b=c.length-1;n.initSideSegments(c[0],c[1],jt.LEFT),n.addFirstSegment();for(var C=2;C<=b;C++)n.addNextSegment(c[C],!0)}n.addLastSegment()};zi.prototype.getSegGen=function(e){return new Un(this._precisionModel,this._bufParams,e)};zi.prototype.interfaces_=function(){return[]};zi.prototype.getClass=function(){return zi};zi.copyCoordinates=function(e){for(var t=new Array(e.length).fill(null),n=0;n<t.length;n++)t[n]=new bt(e[n]);return t};var Ju=function(){this._subgraphs=null,this._seg=new _e,this._cga=new se;var e=arguments[0];this._subgraphs=e},_2={DepthSegment:{configurable:!0}};Ju.prototype.findStabbedSegments=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=new Qt,r=this._subgraphs.iterator();r.hasNext();){var a=r.next(),u=a.getEnvelope();t.y<u.getMinY()||t.y>u.getMaxY()||e.findStabbedSegments(t,a.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(Le(arguments[2],ns)&&arguments[0]instanceof bt&&arguments[1]instanceof T_)for(var p=arguments[0],c=arguments[1],b=arguments[2],C=c.getEdge().getCoordinates(),A=0;A<C.length-1;A++){e._seg.p0=C[A],e._seg.p1=C[A+1],e._seg.p0.y>e._seg.p1.y&&e._seg.reverse();var P=Math.max(e._seg.p0.x,e._seg.p1.x);if(!(P<p.x)&&!e._seg.isHorizontal()&&!(p.y<e._seg.p0.y||p.y>e._seg.p1.y)&&se.computeOrientation(e._seg.p0,e._seg.p1,p)!==se.RIGHT){var R=c.getDepth(jt.LEFT);e._seg.p0.equals(C[A])||(R=c.getDepth(jt.RIGHT));var et=new ou(e._seg,R);b.add(et)}}else if(Le(arguments[2],ns)&&arguments[0]instanceof bt&&Le(arguments[1],ns))for(var X=arguments[0],K=arguments[1],ot=arguments[2],gt=K.iterator();gt.hasNext();){var q=gt.next();q.isForward()&&e.findStabbedSegments(X,q,ot)}}};Ju.prototype.getDepth=function(e){var t=this.findStabbedSegments(e);if(t.size()===0)return 0;var n=ss.min(t);return n._leftDepth};Ju.prototype.interfaces_=function(){return[]};Ju.prototype.getClass=function(){return Ju};_2.DepthSegment.get=function(){return ou};Object.defineProperties(Ju,_2);var ou=function(){this._upwardSeg=null,this._leftDepth=null;var e=arguments[0],t=arguments[1];this._upwardSeg=new _e(e),this._leftDepth=t};ou.prototype.compareTo=function(e){var t=e;if(this._upwardSeg.minX()>=t._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=t._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(t._upwardSeg);return n!==0||(n=-1*t._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(t._upwardSeg)};ou.prototype.compareX=function(e,t){var n=e.p0.compareTo(t.p0);return n!==0?n:e.p1.compareTo(t.p1)};ou.prototype.toString=function(){return this._upwardSeg.toString()};ou.prototype.interfaces_=function(){return[Uo]};ou.prototype.getClass=function(){return ou};var wn=function(e,t,n){this.p0=e||null,this.p1=t||null,this.p2=n||null};wn.prototype.area=function(){return wn.area(this.p0,this.p1,this.p2)};wn.prototype.signedArea=function(){return wn.signedArea(this.p0,this.p1,this.p2)};wn.prototype.interpolateZ=function(e){if(e===null)throw new Hn("Supplied point is null.");return wn.interpolateZ(e,this.p0,this.p1,this.p2)};wn.prototype.longestSideLength=function(){return wn.longestSideLength(this.p0,this.p1,this.p2)};wn.prototype.isAcute=function(){return wn.isAcute(this.p0,this.p1,this.p2)};wn.prototype.circumcentre=function(){return wn.circumcentre(this.p0,this.p1,this.p2)};wn.prototype.area3D=function(){return wn.area3D(this.p0,this.p1,this.p2)};wn.prototype.centroid=function(){return wn.centroid(this.p0,this.p1,this.p2)};wn.prototype.inCentre=function(){return wn.inCentre(this.p0,this.p1,this.p2)};wn.prototype.interfaces_=function(){return[]};wn.prototype.getClass=function(){return wn};wn.area=function(e,t,n){return Math.abs(((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2)};wn.signedArea=function(e,t,n){return((n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y))/2};wn.det=function(e,t,n,r){return e*r-t*n};wn.interpolateZ=function(e,t,n,r){var a=t.x,u=t.y,p=n.x-a,c=r.x-a,b=n.y-u,C=r.y-u,A=p*C-c*b,P=e.x-a,R=e.y-u,et=(C*P-c*R)/A,X=(-b*P+p*R)/A,K=t.z+et*(n.z-t.z)+X*(r.z-t.z);return K};wn.longestSideLength=function(e,t,n){var r=e.distance(t),a=t.distance(n),u=n.distance(e),p=r;return a>p&&(p=a),u>p&&(p=u),p};wn.isAcute=function(e,t,n){return!(!ln.isAcute(e,t,n)||!ln.isAcute(t,n,e)||!ln.isAcute(n,e,t))};wn.circumcentre=function(e,t,n){var r=n.x,a=n.y,u=e.x-r,p=e.y-a,c=t.x-r,b=t.y-a,C=2*wn.det(u,p,c,b),A=wn.det(p,u*u+p*p,b,c*c+b*b),P=wn.det(u,u*u+p*p,c,c*c+b*b),R=r-A/C,et=a+P/C;return new bt(R,et)};wn.perpendicularBisector=function(e,t){var n=t.x-e.x,r=t.y-e.y,a=new es(e.x+n/2,e.y+r/2,1),u=new es(e.x-r+n/2,e.y+n+r/2,1);return new es(a,u)};wn.angleBisector=function(e,t,n){var r=t.distance(e),a=t.distance(n),u=r/(r+a),p=n.x-e.x,c=n.y-e.y,b=new bt(e.x+u*p,e.y+u*c);return b};wn.area3D=function(e,t,n){var r=t.x-e.x,a=t.y-e.y,u=t.z-e.z,p=n.x-e.x,c=n.y-e.y,b=n.z-e.z,C=a*b-u*c,A=u*p-r*b,P=r*c-a*p,R=C*C+A*A+P*P,et=Math.sqrt(R)/2;return et};wn.centroid=function(e,t,n){var r=(e.x+t.x+n.x)/3,a=(e.y+t.y+n.y)/3;return new bt(r,a)};wn.inCentre=function(e,t,n){var r=t.distance(n),a=e.distance(n),u=e.distance(t),p=r+a+u,c=(r*e.x+a*t.x+u*n.x)/p,b=(r*e.y+a*t.y+u*n.y)/p;return new bt(c,b)};var Fo=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new Qt;var e=arguments[0],t=arguments[1],n=arguments[2];this._inputGeom=e,this._distance=t,this._curveBuilder=n};Fo.prototype.addPoint=function(e){if(this._distance<=0)return null;var t=e.getCoordinates(),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,St.EXTERIOR,St.INTERIOR)};Fo.prototype.addPolygon=function(e){var t=this,n=this._distance,r=jt.LEFT;this._distance<0&&(n=-this._distance,r=jt.RIGHT);var a=e.getExteriorRing(),u=Qe.removeRepeatedPoints(a.getCoordinates());if(this._distance<0&&this.isErodedCompletely(a,this._distance)||this._distance<=0&&u.length<3)return null;this.addPolygonRing(u,n,r,St.EXTERIOR,St.INTERIOR);for(var p=0;p<e.getNumInteriorRing();p++){var c=e.getInteriorRingN(p),b=Qe.removeRepeatedPoints(c.getCoordinates());t._distance>0&&t.isErodedCompletely(c,-t._distance)||t.addPolygonRing(b,n,jt.opposite(r),St.INTERIOR,St.EXTERIOR)}};Fo.prototype.isTriangleErodedCompletely=function(e,t){var n=new wn(e[0],e[1],e[2]),r=n.inCentre(),a=se.distancePointLine(r,n.p0,n.p1);return a<Math.abs(t)};Fo.prototype.addLineString=function(e){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var t=Qe.removeRepeatedPoints(e.getCoordinates()),n=this._curveBuilder.getLineCurve(t,this._distance);this.addCurve(n,St.EXTERIOR,St.INTERIOR)};Fo.prototype.addCurve=function(e,t,n){if(e===null||e.length<2)return null;var r=new gr(e,new Cn(0,St.BOUNDARY,t,n));this._curveList.add(r)};Fo.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Fo.prototype.addPolygonRing=function(e,t,n,r,a){if(t===0&&e.length<aa.MINIMUM_VALID_SIZE)return null;var u=r,p=a;e.length>=aa.MINIMUM_VALID_SIZE&&se.isCCW(e)&&(u=a,p=r,n=jt.opposite(n));var c=this._curveBuilder.getRingCurve(e,n,t);this.addCurve(c,u,p)};Fo.prototype.add=function(e){if(e.isEmpty())return null;e instanceof Lr?this.addPolygon(e):e instanceof ar?this.addLineString(e):e instanceof io?this.addPoint(e):e instanceof Bh?this.addCollection(e):e instanceof ru?this.addCollection(e):e instanceof ra?this.addCollection(e):e instanceof Ii&&this.addCollection(e)};Fo.prototype.isErodedCompletely=function(e,t){var n=e.getCoordinates();if(n.length<4)return t<0;if(n.length===4)return this.isTriangleErodedCompletely(n,t);var r=e.getEnvelopeInternal(),a=Math.min(r.getHeight(),r.getWidth());return t<0&&2*Math.abs(t)>a};Fo.prototype.addCollection=function(e){for(var t=this,n=0;n<e.getNumGeometries();n++){var r=e.getGeometryN(n);t.add(r)}};Fo.prototype.interfaces_=function(){return[]};Fo.prototype.getClass=function(){return Fo};var qh=function(){};qh.prototype.locate=function(e){};qh.prototype.interfaces_=function(){return[]};qh.prototype.getClass=function(){return qh};var ia=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var e=arguments[0];this._parent=e,this._atStart=!0,this._index=0,this._max=e.getNumGeometries()};ia.prototype.next=function(){if(this._atStart)return this._atStart=!1,ia.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new rp;var e=this._parent.getGeometryN(this._index++);return e instanceof Ii?(this._subcollectionIterator=new ia(e),this._subcollectionIterator.next()):e};ia.prototype.remove=function(){throw new Error(this.getClass().getName())};ia.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};ia.prototype.interfaces_=function(){return[np]};ia.prototype.getClass=function(){return ia};ia.isAtomic=function(e){return!(e instanceof Ii)};var xo=function(){this._geom=null;var e=arguments[0];this._geom=e};xo.prototype.locate=function(e){return xo.locate(e,this._geom)};xo.prototype.interfaces_=function(){return[qh]};xo.prototype.getClass=function(){return xo};xo.isPointInRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?se.isPointInRing(e,t.getCoordinates()):!1};xo.containsPointInPolygon=function(e,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!xo.isPointInRing(e,n))return!1;for(var r=0;r<t.getNumInteriorRing();r++){var a=t.getInteriorRingN(r);if(xo.isPointInRing(e,a))return!1}return!0};xo.containsPoint=function(e,t){if(t instanceof Lr)return xo.containsPointInPolygon(e,t);if(t instanceof Ii)for(var n=new ia(t);n.hasNext();){var r=n.next();if(r!==t&&xo.containsPoint(e,r))return!0}return!1};xo.locate=function(e,t){return t.isEmpty()?St.EXTERIOR:xo.containsPoint(e,t)?St.INTERIOR:St.EXTERIOR};var fi=function(){this._edgeMap=new hi,this._edgeList=null,this._ptInAreaLocation=[St.NONE,St.NONE]};fi.prototype.getNextCW=function(e){this.getEdges();var t=this._edgeList.indexOf(e),n=t-1;return t===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};fi.prototype.propagateSideLabels=function(e){for(var t=St.NONE,n=this.iterator();n.hasNext();){var r=n.next(),a=r.getLabel();a.isArea(e)&&a.getLocation(e,jt.LEFT)!==St.NONE&&(t=a.getLocation(e,jt.LEFT))}if(t===St.NONE)return null;for(var u=t,p=this.iterator();p.hasNext();){var c=p.next(),b=c.getLabel();if(b.getLocation(e,jt.ON)===St.NONE&&b.setLocation(e,jt.ON,u),b.isArea(e)){var C=b.getLocation(e,jt.LEFT),A=b.getLocation(e,jt.RIGHT);if(A!==St.NONE){if(A!==u)throw new Fa("side location conflict",c.getCoordinate());C===St.NONE&&Ve.shouldNeverReachHere("found single null side (at "+c.getCoordinate()+")"),u=C}else Ve.isTrue(b.getLocation(e,jt.LEFT)===St.NONE,"found single null side"),b.setLocation(e,jt.RIGHT,u),b.setLocation(e,jt.LEFT,u)}}};fi.prototype.getCoordinate=function(){var e=this.iterator();if(!e.hasNext())return null;var t=e.next();return t.getCoordinate()};fi.prototype.print=function(e){ri.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};fi.prototype.isAreaLabelsConsistent=function(e){return this.computeEdgeEndLabels(e.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};fi.prototype.checkAreaLabelsConsistent=function(e){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,r=t.get(n).getLabel(),a=r.getLocation(e,jt.LEFT);Ve.isTrue(a!==St.NONE,"Found unlabelled area edge");for(var u=a,p=this.iterator();p.hasNext();){var c=p.next(),b=c.getLabel();Ve.isTrue(b.isArea(e),"Found non-area edge");var C=b.getLocation(e,jt.LEFT),A=b.getLocation(e,jt.RIGHT);if(C===A||A!==u)return!1;u=C}return!0};fi.prototype.findIndex=function(e){var t=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var r=t._edgeList.get(n);if(r===e)return n}return-1};fi.prototype.iterator=function(){return this.getEdges().iterator()};fi.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new Qt(this._edgeMap.values())),this._edgeList};fi.prototype.getLocation=function(e,t,n){return this._ptInAreaLocation[e]===St.NONE&&(this._ptInAreaLocation[e]=xo.locate(t,n[e].getGeometry())),this._ptInAreaLocation[e]};fi.prototype.toString=function(){var e=new js;e.append("EdgeEndStar:   "+this.getCoordinate()),e.append(`
`);for(var t=this.iterator();t.hasNext();){var n=t.next();e.append(n),e.append(`
`)}return e.toString()};fi.prototype.computeEdgeEndLabels=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();n.computeLabel(e)}};fi.prototype.computeLabelling=function(e){var t=this;this.computeEdgeEndLabels(e[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],r=this.iterator();r.hasNext();)for(var a=r.next(),u=a.getLabel(),p=0;p<2;p++)u.isLine(p)&&u.getLocation(p)===St.BOUNDARY&&(n[p]=!0);for(var c=this.iterator();c.hasNext();)for(var b=c.next(),C=b.getLabel(),A=0;A<2;A++)if(C.isAnyNull(A)){var P=St.NONE;if(n[A])P=St.EXTERIOR;else{var R=b.getCoordinate();P=t.getLocation(A,R,e)}C.setAllLocationsIfNull(A,P)}};fi.prototype.getDegree=function(){return this._edgeMap.size()};fi.prototype.insertEdgeEnd=function(e,t){this._edgeMap.put(e,t),this._edgeList=null};fi.prototype.interfaces_=function(){return[]};fi.prototype.getClass=function(){return fi};var EM=function(e){function t(){e.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var r=null,a=null,u=this._SCANNING_FOR_INCOMING,p=0;p<this._resultAreaEdgeList.size();p++){var c=n._resultAreaEdgeList.get(p),b=c.getSym();if(c.getLabel().isArea())switch(r===null&&c.isInResult()&&(r=c),u){case n._SCANNING_FOR_INCOMING:if(!b.isInResult())continue;a=b,u=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!c.isInResult())continue;a.setNext(c),u=n._SCANNING_FOR_INCOMING;break}}if(u===this._LINKING_TO_OUTGOING){if(r===null)throw new Fa("no outgoing dirEdge found",this.getCoordinate());Ve.isTrue(r.isInResult(),"unable to link last incoming dirEdge"),a.setNext(r)}},t.prototype.insert=function(n){var r=n;this.insertEdgeEnd(r,r)},t.prototype.getRightmostEdge=function(){var n=this.getEdges(),r=n.size();if(r<1)return null;var a=n.get(0);if(r===1)return a;var u=n.get(r-1),p=a.getQuadrant(),c=u.getQuadrant();return Ln.isNorthern(p)&&Ln.isNorthern(c)?a:!Ln.isNorthern(p)&&!Ln.isNorthern(c)?u:a.getDy()!==0?a:u.getDy()!==0?u:(Ve.shouldNeverReachHere("found two horizontal edges incident on node"),null)},t.prototype.print=function(n){ri.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var r=this.iterator();r.hasNext();){var a=r.next();n.print("out "),a.print(n),n.println(),n.print("in "),a.getSym().print(n),n.println()}},t.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new Qt;for(var r=this.iterator();r.hasNext();){var a=r.next();(a.isInResult()||a.getSym().isInResult())&&n._resultAreaEdgeList.add(a)}return this._resultAreaEdgeList},t.prototype.updateLabelling=function(n){for(var r=this.iterator();r.hasNext();){var a=r.next(),u=a.getLabel();u.setAllLocationsIfNull(0,n.getLocation(0)),u.setAllLocationsIfNull(1,n.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var r=null,a=null,u=this._edgeList.size()-1;u>=0;u--){var p=n._edgeList.get(u),c=p.getSym();a===null&&(a=c),r!==null&&c.setNext(r),r=p}a.setNext(r)},t.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var r=arguments[0],a=this.findIndex(r),u=r.getDepth(jt.LEFT),p=r.getDepth(jt.RIGHT),c=this.computeDepths(a+1,this._edgeList.size(),u),b=this.computeDepths(0,a,c);if(b!==p)throw new Fa("depth mismatch at "+r.getCoordinate())}else if(arguments.length===3){for(var C=arguments[0],A=arguments[1],P=arguments[2],R=P,et=C;et<A;et++){var X=n._edgeList.get(et);X.setEdgeDepths(jt.RIGHT,R),R=X.getDepth(jt.LEFT)}return R}},t.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var r=n.next(),a=r.getLabel();a.merge(r.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(n){for(var r=this,a=null,u=null,p=this._SCANNING_FOR_INCOMING,c=this._resultAreaEdgeList.size()-1;c>=0;c--){var b=r._resultAreaEdgeList.get(c),C=b.getSym();switch(a===null&&b.getEdgeRing()===n&&(a=b),p){case r._SCANNING_FOR_INCOMING:if(C.getEdgeRing()!==n)continue;u=C,p=r._LINKING_TO_OUTGOING;break;case r._LINKING_TO_OUTGOING:if(b.getEdgeRing()!==n)continue;u.setNextMin(b),p=r._SCANNING_FOR_INCOMING;break}}p===this._LINKING_TO_OUTGOING&&(Ve.isTrue(a!==null,"found null for first outgoing dirEdge"),Ve.isTrue(a.getEdgeRing()===n,"unable to link last incoming dirEdge"),u.setNextMin(a))},t.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,r=this.iterator();r.hasNext();){var a=r.next();a.isInResult()&&n++}return n}else if(arguments.length===1){for(var u=arguments[0],p=0,c=this.iterator();c.hasNext();){var b=c.next();b.getEdgeRing()===u&&p++}return p}},t.prototype.getLabel=function(){return this._label},t.prototype.findCoveredLineEdges=function(){for(var n=St.NONE,r=this.iterator();r.hasNext();){var a=r.next(),u=a.getSym();if(!a.isLineEdge()){if(a.isInResult()){n=St.INTERIOR;break}if(u.isInResult()){n=St.EXTERIOR;break}}}if(n===St.NONE)return null;for(var p=n,c=this.iterator();c.hasNext();){var b=c.next(),C=b.getSym();b.isLineEdge()?b.getEdge().setCovered(p===St.INTERIOR):(b.isInResult()&&(p=St.EXTERIOR),C.isInResult()&&(p=St.INTERIOR))}},t.prototype.computeLabelling=function(n){var r=this;e.prototype.computeLabelling.call(this,n),this._label=new Cn(St.NONE);for(var a=this.iterator();a.hasNext();)for(var u=a.next(),p=u.getEdge(),c=p.getLabel(),b=0;b<2;b++){var C=c.getLocation(b);(C===St.INTERIOR||C===St.BOUNDARY)&&r._label.setLocation(b,St.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fi),v2=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.createNode=function(n){return new gg(n,new EM)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Vh),xl=function e(){this._pts=null,this._orientation=null;var t=arguments[0];this._pts=t,this._orientation=e.orientation(t)};xl.prototype.compareTo=function(e){var t=e,n=xl.compareOriented(this._pts,this._orientation,t._pts,t._orientation);return n};xl.prototype.interfaces_=function(){return[Uo]};xl.prototype.getClass=function(){return xl};xl.orientation=function(e){return Qe.increasingDirection(e)===1};xl.compareOriented=function(e,t,n,r){for(var a=t?1:-1,u=r?1:-1,p=t?e.length:-1,c=r?n.length:-1,b=t?0:e.length-1,C=r?0:n.length-1;;){var A=e[b].compareTo(n[C]);if(A!==0)return A;b+=a,C+=u;var P=b===p,R=C===c;if(P&&!R)return-1;if(!P&&R)return 1;if(P&&R)return 0}};var as=function(){this._edges=new Qt,this._ocaMap=new hi};as.prototype.print=function(e){var t=this;e.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var r=t._edges.get(n);n>0&&e.print(","),e.print("(");for(var a=r.getCoordinates(),u=0;u<a.length;u++)u>0&&e.print(","),e.print(a[u].x+" "+a[u].y);e.println(")")}e.print(")  ")};as.prototype.addAll=function(e){for(var t=this,n=e.iterator();n.hasNext();)t.add(n.next())};as.prototype.findEdgeIndex=function(e){for(var t=this,n=0;n<this._edges.size();n++)if(t._edges.get(n).equals(e))return n;return-1};as.prototype.iterator=function(){return this._edges.iterator()};as.prototype.getEdges=function(){return this._edges};as.prototype.get=function(e){return this._edges.get(e)};as.prototype.findEqualEdge=function(e){var t=new xl(e.getCoordinates()),n=this._ocaMap.get(t);return n};as.prototype.add=function(e){this._edges.add(e);var t=new xl(e.getCoordinates());this._ocaMap.put(t,e)};as.prototype.interfaces_=function(){return[]};as.prototype.getClass=function(){return as};var su=function(){};su.prototype.processIntersections=function(e,t,n,r){};su.prototype.isDone=function(){};su.prototype.interfaces_=function(){return[]};su.prototype.getClass=function(){return su};var Eo=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var e=arguments[0];this._li=e};Eo.prototype.isTrivialIntersection=function(e,t,n,r){if(e===n&&this._li.getIntersectionNum()===1){if(Eo.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var a=e.size()-1;if(t===0&&r===a||r===0&&t===a)return!0}}return!1};Eo.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Eo.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Eo.prototype.getLineIntersector=function(){return this._li};Eo.prototype.hasProperIntersection=function(){return this._hasProper};Eo.prototype.processIntersections=function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var a=e.getCoordinates()[t],u=e.getCoordinates()[t+1],p=n.getCoordinates()[r],c=n.getCoordinates()[r+1];this._li.computeIntersection(a,u,p,c),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Eo.prototype.hasIntersection=function(){return this._hasIntersection};Eo.prototype.isDone=function(){return!1};Eo.prototype.hasInteriorIntersection=function(){return this._hasInterior};Eo.prototype.interfaces_=function(){return[su]};Eo.prototype.getClass=function(){return Eo};Eo.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var zs=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var e=arguments[0],t=arguments[1],n=arguments[2];this.coord=new bt(e),this.segmentIndex=t,this.dist=n};zs.prototype.getSegmentIndex=function(){return this.segmentIndex};zs.prototype.getCoordinate=function(){return this.coord};zs.prototype.print=function(e){e.print(this.coord),e.print(" seg # = "+this.segmentIndex),e.println(" dist = "+this.dist)};zs.prototype.compareTo=function(e){var t=e;return this.compare(t.segmentIndex,t.dist)};zs.prototype.isEndPoint=function(e){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===e};zs.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};zs.prototype.getDistance=function(){return this.dist};zs.prototype.compare=function(e,t){return this.segmentIndex<e?-1:this.segmentIndex>e?1:this.dist<t?-1:this.dist>t?1:0};zs.prototype.interfaces_=function(){return[Uo]};zs.prototype.getClass=function(){return zs};var ca=function(){this._nodeMap=new hi,this.edge=null;var e=arguments[0];this.edge=e};ca.prototype.print=function(e){e.println("Intersections:");for(var t=this.iterator();t.hasNext();){var n=t.next();n.print(e)}};ca.prototype.iterator=function(){return this._nodeMap.values().iterator()};ca.prototype.addSplitEdges=function(e){var t=this;this.addEndpoints();for(var n=this.iterator(),r=n.next();n.hasNext();){var a=n.next(),u=t.createSplitEdge(r,a);e.add(u),r=a}};ca.prototype.addEndpoints=function(){var e=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[e],e,0)};ca.prototype.createSplitEdge=function(e,t){var n=this,r=t.segmentIndex-e.segmentIndex+2,a=this.edge.pts[t.segmentIndex],u=t.dist>0||!t.coord.equals2D(a);u||r--;var p=new Array(r).fill(null),c=0;p[c++]=new bt(e.coord);for(var b=e.segmentIndex+1;b<=t.segmentIndex;b++)p[c++]=n.edge.pts[b];return u&&(p[c]=t.coord),new Xm(p,new Cn(this.edge._label))};ca.prototype.add=function(e,t,n){var r=new zs(e,t,n),a=this._nodeMap.get(r);return a!==null?a:(this._nodeMap.put(r,r),r)};ca.prototype.isIntersection=function(e){for(var t=this.iterator();t.hasNext();){var n=t.next();if(n.coord.equals(e))return!0}return!1};ca.prototype.interfaces_=function(){return[]};ca.prototype.getClass=function(){return ca};var au=function(){};au.prototype.getChainStartIndices=function(e){var t=this,n=0,r=new Qt;r.add(new Ms(n));do{var a=t.findChainEnd(e,n);r.add(new Ms(a)),n=a}while(n<e.length-1);var u=au.toIntArray(r);return u};au.prototype.findChainEnd=function(e,t){for(var n=Ln.quadrant(e[t],e[t+1]),r=t+1;r<e.length;){var a=Ln.quadrant(e[r-1],e[r]);if(a!==n)break;r++}return r-1};au.prototype.interfaces_=function(){return[]};au.prototype.getClass=function(){return au};au.toIntArray=function(e){for(var t=new Array(e.size()).fill(null),n=0;n<t.length;n++)t[n]=e.get(n).intValue();return t};var Va=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new ye,this.env2=new ye;var e=arguments[0];this.e=e,this.pts=e.getCoordinates();var t=new au;this.startIndex=t.getChainStartIndices(this.pts)};Va.prototype.getCoordinates=function(){return this.pts};Va.prototype.getMaxX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t>n?t:n};Va.prototype.getMinX=function(e){var t=this.pts[this.startIndex[e]].x,n=this.pts[this.startIndex[e+1]].x;return t<n?t:n};Va.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var e=arguments[0],t=arguments[1],n=arguments[2],r=arguments[3];this.computeIntersectsForChain(this.startIndex[e],this.startIndex[e+1],t,t.startIndex[n],t.startIndex[n+1],r)}else if(arguments.length===6){var a=arguments[0],u=arguments[1],p=arguments[2],c=arguments[3],b=arguments[4],C=arguments[5],A=this.pts[a],P=this.pts[u],R=p.pts[c],et=p.pts[b];if(u-a===1&&b-c===1)return C.addIntersections(this.e,a,p.e,c),null;if(this.env1.init(A,P),this.env2.init(R,et),!this.env1.intersects(this.env2))return null;var X=Math.trunc((a+u)/2),K=Math.trunc((c+b)/2);a<X&&(c<K&&this.computeIntersectsForChain(a,X,p,c,K,C),K<b&&this.computeIntersectsForChain(a,X,p,K,b,C)),X<u&&(c<K&&this.computeIntersectsForChain(X,u,p,c,K,C),K<b&&this.computeIntersectsForChain(X,u,p,K,b,C))}};Va.prototype.getStartIndexes=function(){return this.startIndex};Va.prototype.computeIntersects=function(e,t){for(var n=this,r=0;r<this.startIndex.length-1;r++)for(var a=0;a<e.startIndex.length-1;a++)n.computeIntersectsForChain(r,e,a,t)};Va.prototype.interfaces_=function(){return[]};Va.prototype.getClass=function(){return Va};var ni=function e(){var t=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var r=0;r<3;r++)t._depth[n][r]=e.NULL_VALUE},x2={NULL_VALUE:{configurable:!0}};ni.prototype.getDepth=function(e,t){return this._depth[e][t]};ni.prototype.setDepth=function(e,t,n){this._depth[e][t]=n};ni.prototype.isNull=function(){var e=this;if(arguments.length===0){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(e._depth[t][n]!==ni.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var r=arguments[0];return this._depth[r][1]===ni.NULL_VALUE}else if(arguments.length===2){var a=arguments[0],u=arguments[1];return this._depth[a][u]===ni.NULL_VALUE}};ni.prototype.normalize=function(){for(var e=this,t=0;t<2;t++)if(!e.isNull(t)){var n=e._depth[t][1];e._depth[t][2]<n&&(n=e._depth[t][2]),n<0&&(n=0);for(var r=1;r<3;r++){var a=0;e._depth[t][r]>n&&(a=1),e._depth[t][r]=a}}};ni.prototype.getDelta=function(e){return this._depth[e][jt.RIGHT]-this._depth[e][jt.LEFT]};ni.prototype.getLocation=function(e,t){return this._depth[e][t]<=0?St.EXTERIOR:St.INTERIOR};ni.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};ni.prototype.add=function(){var e=this;if(arguments.length===1)for(var t=arguments[0],n=0;n<2;n++)for(var r=1;r<3;r++){var a=t.getLocation(n,r);(a===St.EXTERIOR||a===St.INTERIOR)&&(e.isNull(n,r)?e._depth[n][r]=ni.depthAtLocation(a):e._depth[n][r]+=ni.depthAtLocation(a))}else if(arguments.length===3){var u=arguments[0],p=arguments[1],c=arguments[2];c===St.INTERIOR&&this._depth[u][p]++}};ni.prototype.interfaces_=function(){return[]};ni.prototype.getClass=function(){return ni};ni.depthAtLocation=function(e){return e===St.EXTERIOR?0:e===St.INTERIOR?1:ni.NULL_VALUE};x2.NULL_VALUE.get=function(){return-1};Object.defineProperties(ni,x2);var Xm=function(e){function t(){if(e.call(this),this.pts=null,this._env=null,this.eiList=new ca(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new ni,this._depthDelta=0,arguments.length===1){var n=arguments[0];t.call(this,n,null)}else if(arguments.length===2){var r=arguments[0],a=arguments[1];this.pts=r,this._label=a}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.getDepth=function(){return this._depth},t.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var r=new t(n,Cn.toLineLabel(this._label));return r},t.prototype.isIsolated=function(){return this._isIsolated},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(n){this._isIsolated=n},t.prototype.setName=function(n){this._name=n},t.prototype.equals=function(n){var r=this;if(!(n instanceof t))return!1;var a=n;if(this.pts.length!==a.pts.length)return!1;for(var u=!0,p=!0,c=this.pts.length,b=0;b<this.pts.length;b++)if(r.pts[b].equals2D(a.pts[b])||(u=!1),r.pts[b].equals2D(a.pts[--c])||(p=!1),!u&&!p)return!1;return!0},t.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},t.prototype.print=function(n){var r=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&n.print(","),n.print(r.pts[a].x+" "+r.pts[a].y);n.print(")  "+this._label+" "+this._depthDelta)},t.prototype.computeIM=function(n){t.updateIM(this._label,n)},t.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this._depthDelta},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(n){var r=this;n.print("edge "+this._name+": ");for(var a=this.pts.length-1;a>=0;a--)n.print(r.pts[a]+" ");n.println("")},t.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new Va(this)),this._mce},t.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new ye;for(var r=0;r<this.pts.length;r++)n._env.expandToInclude(n.pts[r])}return this._env},t.prototype.addIntersection=function(n,r,a,u){var p=new bt(n.getIntersection(u)),c=r,b=n.getEdgeDistance(a,u),C=c+1;if(C<this.pts.length){var A=this.pts[C];p.equals2D(A)&&(c=C,b=0)}this.eiList.add(p,c,b)},t.prototype.toString=function(){var n=this,r=new js;r.append("edge "+this._name+": "),r.append("LINESTRING (");for(var a=0;a<this.pts.length;a++)a>0&&r.append(","),r.append(n.pts[a].x+" "+n.pts[a].y);return r.append(")  "+this._label+" "+this._depthDelta),r.toString()},t.prototype.isPointwiseEqual=function(n){var r=this;if(this.pts.length!==n.pts.length)return!1;for(var a=0;a<this.pts.length;a++)if(!r.pts[a].equals2D(n.pts[a]))return!1;return!0},t.prototype.setDepthDelta=function(n){this._depthDelta=n},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(n,r,a){for(var u=this,p=0;p<n.getIntersectionNum();p++)u.addIntersection(n,r,a,p)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];r.setAtLeastIfValid(n.getLocation(0,jt.ON),n.getLocation(1,jt.ON),1),n.isArea()&&(r.setAtLeastIfValid(n.getLocation(0,jt.LEFT),n.getLocation(1,jt.LEFT),2),r.setAtLeastIfValid(n.getLocation(0,jt.RIGHT),n.getLocation(1,jt.RIGHT),2))}else return e.prototype.updateIM.apply(this,arguments)},t}(So),Si=function(e){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new as,this._bufParams=e||null};Si.prototype.setWorkingPrecisionModel=function(e){this._workingPrecisionModel=e};Si.prototype.insertUniqueEdge=function(e){var t=this._edgeList.findEqualEdge(e);if(t!==null){var n=t.getLabel(),r=e.getLabel();t.isPointwiseEqual(e)||(r=new Cn(e.getLabel()),r.flip()),n.merge(r);var a=Si.depthDelta(r),u=t.getDepthDelta(),p=u+a;t.setDepthDelta(p)}else this._edgeList.add(e),e.setDepthDelta(Si.depthDelta(e.getLabel()))};Si.prototype.buildSubgraphs=function(e,t){for(var n=new Qt,r=e.iterator();r.hasNext();){var a=r.next(),u=a.getRightmostCoordinate(),p=new Ju(n),c=p.getDepth(u);a.computeDepth(c),a.findResultEdges(),n.add(a),t.add(a.getDirectedEdges(),a.getNodes())}};Si.prototype.createSubgraphs=function(e){for(var t=new Qt,n=e.getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isVisited()){var a=new Ei;a.create(r),t.add(a)}}return ss.sort(t,ss.reverseOrder()),t};Si.prototype.createEmptyResultGeometry=function(){var e=this._geomFact.createPolygon();return e};Si.prototype.getNoder=function(e){if(this._workingNoder!==null)return this._workingNoder;var t=new h0,n=new du;return n.setPrecisionModel(e),t.setSegmentIntersector(new Eo(n)),t};Si.prototype.buffer=function(e,t){var n=this._workingPrecisionModel;n===null&&(n=e.getPrecisionModel()),this._geomFact=e.getFactory();var r=new zi(n,this._bufParams),a=new Fo(e,t,r),u=a.getCurves();if(u.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(u,n),this._graph=new er(new v2),this._graph.addEdges(this._edgeList.getEdges());var p=this.createSubgraphs(this._graph),c=new oo(this._geomFact);this.buildSubgraphs(p,c);var b=c.getPolygons();if(b.size()<=0)return this.createEmptyResultGeometry();var C=this._geomFact.buildGeometry(b);return C};Si.prototype.computeNodedEdges=function(e,t){var n=this,r=this.getNoder(t);r.computeNodes(e);for(var a=r.getNodedSubstrings(),u=a.iterator();u.hasNext();){var p=u.next(),c=p.getCoordinates();if(!(c.length===2&&c[0].equals2D(c[1]))){var b=p.getData(),C=new Xm(p.getCoordinates(),new Cn(b));n.insertUniqueEdge(C)}}};Si.prototype.setNoder=function(e){this._workingNoder=e};Si.prototype.interfaces_=function(){return[]};Si.prototype.getClass=function(){return Si};Si.depthDelta=function(e){var t=e.getLocation(0,jt.LEFT),n=e.getLocation(0,jt.RIGHT);return t===St.INTERIOR&&n===St.EXTERIOR?1:t===St.EXTERIOR&&n===St.INTERIOR?-1:0};Si.convertSegStrings=function(e){for(var t=new en,n=new Qt;e.hasNext();){var r=e.next(),a=t.createLineString(r.getCoordinates());n.add(a)}return t.buildGeometry(n)};var bl=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var e=arguments[0],t=arguments[1];this._noder=e,this._scaleFactor=t,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],r=arguments[1],a=arguments[2],u=arguments[3];this._noder=n,this._scaleFactor=r,this._offsetX=a,this._offsetY=u,this._isScaled=!this.isIntegerPrecision()}};bl.prototype.rescale=function(){var e=this;if(Le(arguments[0],Cr))for(var t=arguments[0],n=t.iterator();n.hasNext();){var r=n.next();e.rescale(r.getCoordinates())}else if(arguments[0]instanceof Array){for(var a=arguments[0],u=0;u<a.length;u++)a[u].x=a[u].x/e._scaleFactor+e._offsetX,a[u].y=a[u].y/e._scaleFactor+e._offsetY;a.length===2&&a[0].equals2D(a[1])&&ri.out.println(a)}};bl.prototype.scale=function(){var e=this;if(Le(arguments[0],Cr)){for(var t=arguments[0],n=new Qt,r=t.iterator();r.hasNext();){var a=r.next();n.add(new gr(e.scale(a.getCoordinates()),a.getData()))}return n}else if(arguments[0]instanceof Array){for(var u=arguments[0],p=new Array(u.length).fill(null),c=0;c<u.length;c++)p[c]=new bt(Math.round((u[c].x-e._offsetX)*e._scaleFactor),Math.round((u[c].y-e._offsetY)*e._scaleFactor),u[c].z);var b=Qe.removeRepeatedPoints(p);return b}};bl.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};bl.prototype.getNodedSubstrings=function(){var e=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(e),e};bl.prototype.computeNodes=function(e){var t=e;this._isScaled&&(t=this.scale(e)),this._noder.computeNodes(t)};bl.prototype.interfaces_=function(){return[iu]};bl.prototype.getClass=function(){return bl};var Fs=function(){this._li=new du,this._segStrings=null;var e=arguments[0];this._segStrings=e},b2={fact:{configurable:!0}};Fs.prototype.checkEndPtVertexIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next(),r=n.getCoordinates();e.checkEndPtVertexIntersections(r[0],e._segStrings),e.checkEndPtVertexIntersections(r[r.length-1],e._segStrings)}else if(arguments.length===2){for(var a=arguments[0],u=arguments[1],p=u.iterator();p.hasNext();)for(var c=p.next(),b=c.getCoordinates(),C=1;C<b.length-1;C++)if(b[C].equals(a))throw new Oa("found endpt/interior pt intersection at index "+C+" :pt "+a)}};Fs.prototype.checkInteriorIntersections=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();)for(var n=t.next(),r=this._segStrings.iterator();r.hasNext();){var a=r.next();e.checkInteriorIntersections(n,a)}else if(arguments.length===2)for(var u=arguments[0],p=arguments[1],c=u.getCoordinates(),b=p.getCoordinates(),C=0;C<c.length-1;C++)for(var A=0;A<b.length-1;A++)e.checkInteriorIntersections(u,C,p,A);else if(arguments.length===4){var P=arguments[0],R=arguments[1],et=arguments[2],X=arguments[3];if(P===et&&R===X)return null;var K=P.getCoordinates()[R],ot=P.getCoordinates()[R+1],gt=et.getCoordinates()[X],q=et.getCoordinates()[X+1];if(this._li.computeIntersection(K,ot,gt,q),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,K,ot)||this.hasInteriorIntersection(this._li,gt,q)))throw new Oa("found non-noded intersection at "+K+"-"+ot+" and "+gt+"-"+q)}};Fs.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};Fs.prototype.checkCollapses=function(){var e=this;if(arguments.length===0)for(var t=this._segStrings.iterator();t.hasNext();){var n=t.next();e.checkCollapses(n)}else if(arguments.length===1)for(var r=arguments[0],a=r.getCoordinates(),u=0;u<a.length-2;u++)e.checkCollapse(a[u],a[u+1],a[u+2])};Fs.prototype.hasInteriorIntersection=function(e,t,n){for(var r=0;r<e.getIntersectionNum();r++){var a=e.getIntersection(r);if(!(a.equals(t)||a.equals(n)))return!0}return!1};Fs.prototype.checkCollapse=function(e,t,n){if(e.equals(n))throw new Oa("found non-noded collapse at "+Fs.fact.createLineString([e,t,n]))};Fs.prototype.interfaces_=function(){return[]};Fs.prototype.getClass=function(){return Fs};b2.fact.get=function(){return new en};Object.defineProperties(Fs,b2);var Fi=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var e=arguments[0],t=arguments[1],n=arguments[2];if(this._originalPt=e,this._pt=e,this._scaleFactor=t,this._li=n,t<=0)throw new Hn("Scale factor must be non-zero");t!==1&&(this._pt=new bt(this.scale(e.x),this.scale(e.y)),this._p0Scaled=new bt,this._p1Scaled=new bt),this.initCorners(this._pt)},w2={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Fi.prototype.intersectsScaled=function(e,t){var n=Math.min(e.x,t.x),r=Math.max(e.x,t.x),a=Math.min(e.y,t.y),u=Math.max(e.y,t.y),p=this._maxx<n||this._minx>r||this._maxy<a||this._miny>u;if(p)return!1;var c=this.intersectsToleranceSquare(e,t);return Ve.isTrue(!(p&&c),"Found bad envelope test"),c};Fi.prototype.initCorners=function(e){var t=.5;this._minx=e.x-t,this._maxx=e.x+t,this._miny=e.y-t,this._maxy=e.y+t,this._corner[0]=new bt(this._maxx,this._maxy),this._corner[1]=new bt(this._minx,this._maxy),this._corner[2]=new bt(this._minx,this._miny),this._corner[3]=new bt(this._maxx,this._miny)};Fi.prototype.intersects=function(e,t){return this._scaleFactor===1?this.intersectsScaled(e,t):(this.copyScaled(e,this._p0Scaled),this.copyScaled(t,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};Fi.prototype.scale=function(e){return Math.round(e*this._scaleFactor)};Fi.prototype.getCoordinate=function(){return this._originalPt};Fi.prototype.copyScaled=function(e,t){t.x=this.scale(e.x),t.y=this.scale(e.y)};Fi.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var e=Fi.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new ye(this._originalPt.x-e,this._originalPt.x+e,this._originalPt.y-e,this._originalPt.y+e)}return this._safeEnv};Fi.prototype.intersectsPixelClosure=function(e,t){return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.hasIntersection()))};Fi.prototype.intersectsToleranceSquare=function(e,t){var n=!1,r=!1;return this._li.computeIntersection(e,t,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(e,t,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(e,t,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(r=!0),this._li.computeIntersection(e,t,this._corner[3],this._corner[0]),this._li.isProper())||n&&r||e.equals(this._pt)||t.equals(this._pt))};Fi.prototype.addSnappedNode=function(e,t){var n=e.getCoordinate(t),r=e.getCoordinate(t+1);return this.intersects(n,r)?(e.addIntersection(this.getCoordinate(),t),!0):!1};Fi.prototype.interfaces_=function(){return[]};Fi.prototype.getClass=function(){return Fi};w2.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(Fi,w2);var Uf=function(){this.tempEnv1=new ye,this.selectedSegment=new _e};Uf.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var e=arguments[0],t=arguments[1];e.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}};Uf.prototype.interfaces_=function(){return[]};Uf.prototype.getClass=function(){return Uf};var jh=function(){this._index=null;var e=arguments[0];this._index=e},S2={HotPixelSnapAction:{configurable:!0}};jh.prototype.snap=function(){if(arguments.length===1){var e=arguments[0];return this.snap(e,null,-1)}else if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2],a=t.getSafeEnvelope(),u=new I2(t,n,r);return this._index.query(a,{interfaces_:function(){return[_l]},visitItem:function(p){var c=p;c.select(a,u)}}),u.isNodeAdded()}};jh.prototype.interfaces_=function(){return[]};jh.prototype.getClass=function(){return jh};S2.HotPixelSnapAction.get=function(){return I2};Object.defineProperties(jh,S2);var I2=function(e){function t(){e.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],r=arguments[1],a=arguments[2];this._hotPixel=n,this._parentEdge=r,this._hotPixelVertexIndex=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.isNodeAdded=function(){return this._isNodeAdded},t.prototype.select=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1],a=n.getContext();if(this._parentEdge!==null&&a===this._parentEdge&&r===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(a,r)}else return e.prototype.select.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Uf),Qu=function(){this._li=null,this._interiorIntersections=null;var e=arguments[0];this._li=e,this._interiorIntersections=new Qt};Qu.prototype.processIntersections=function(e,t,n,r){var a=this;if(e===n&&t===r)return null;var u=e.getCoordinates()[t],p=e.getCoordinates()[t+1],c=n.getCoordinates()[r],b=n.getCoordinates()[r+1];if(this._li.computeIntersection(u,p,c,b),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var C=0;C<this._li.getIntersectionNum();C++)a._interiorIntersections.add(a._li.getIntersection(C));e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)}};Qu.prototype.isDone=function(){return!1};Qu.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Qu.prototype.interfaces_=function(){return[su]};Qu.prototype.getClass=function(){return Qu};var ha=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var e=arguments[0];this._pm=e,this._li=new du,this._li.setPrecisionModel(e),this._scaleFactor=e.getScale()};ha.prototype.checkCorrectness=function(e){var t=gr.getNodedSubstrings(e),n=new Fs(t);try{n.checkValid()}catch(r){if(r instanceof l2)r.printStackTrace();else throw r}finally{}};ha.prototype.getNodedSubstrings=function(){return gr.getNodedSubstrings(this._nodedSegStrings)};ha.prototype.snapRound=function(e,t){var n=this.findInteriorIntersections(e,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(e)};ha.prototype.findInteriorIntersections=function(e,t){var n=new Qu(t);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(e),n.getInteriorIntersections()};ha.prototype.computeVertexSnaps=function(){var e=this;if(Le(arguments[0],Cr))for(var t=arguments[0],n=t.iterator();n.hasNext();){var r=n.next();e.computeVertexSnaps(r)}else if(arguments[0]instanceof gr)for(var a=arguments[0],u=a.getCoordinates(),p=0;p<u.length;p++){var c=new Fi(u[p],e._scaleFactor,e._li),b=e._pointSnapper.snap(c,a,p);b&&a.addIntersection(u[p],p)}};ha.prototype.computeNodes=function(e){this._nodedSegStrings=e,this._noder=new h0,this._pointSnapper=new jh(this._noder.getIndex()),this.snapRound(e,this._li)};ha.prototype.computeIntersectionSnaps=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next(),a=new Fi(r,t._scaleFactor,t._li);t._pointSnapper.snap(a)}};ha.prototype.interfaces_=function(){return[iu]};ha.prototype.getClass=function(){return ha};var ui=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new bn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var e=arguments[0];this._argGeom=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._argGeom=t,this._bufParams=n}},ip={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};ui.prototype.bufferFixedPrecision=function(e){var t=new bl(new ha(new En(1)),e.getScale()),n=new Si(this._bufParams);n.setWorkingPrecisionModel(e),n.setNoder(t),this._resultGeometry=n.buffer(this._argGeom,this._distance)};ui.prototype.bufferReducedPrecision=function(){var e=this;if(arguments.length===0){for(var t=ui.MAX_PRECISION_DIGITS;t>=0;t--){try{e.bufferReducedPrecision(t)}catch(u){if(u instanceof Fa)e._saveException=u;else throw u}finally{}if(e._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],r=ui.precisionScaleFactor(this._argGeom,this._distance,n),a=new En(r);this.bufferFixedPrecision(a)}};ui.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var e=this._argGeom.getFactory().getPrecisionModel();e.getType()===En.FIXED?this.bufferFixedPrecision(e):this.bufferReducedPrecision()};ui.prototype.setQuadrantSegments=function(e){this._bufParams.setQuadrantSegments(e)};ui.prototype.bufferOriginalPrecision=function(){try{var e=new Si(this._bufParams);this._resultGeometry=e.buffer(this._argGeom,this._distance)}catch(t){if(t instanceof Oa)this._saveException=t;else throw t}finally{}};ui.prototype.getResultGeometry=function(e){return this._distance=e,this.computeGeometry(),this._resultGeometry};ui.prototype.setEndCapStyle=function(e){this._bufParams.setEndCapStyle(e)};ui.prototype.interfaces_=function(){return[]};ui.prototype.getClass=function(){return ui};ui.bufferOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new ui(e),r=n.getResultGeometry(t);return r}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Te&&typeof arguments[1]=="number"){var a=arguments[0],u=arguments[1],p=arguments[2],c=new ui(a);c.setQuadrantSegments(p);var b=c.getResultGeometry(u);return b}else if(arguments[2]instanceof bn&&arguments[0]instanceof Te&&typeof arguments[1]=="number"){var C=arguments[0],A=arguments[1],P=arguments[2],R=new ui(C,P),et=R.getResultGeometry(A);return et}}else if(arguments.length===4){var X=arguments[0],K=arguments[1],ot=arguments[2],gt=arguments[3],q=new ui(X);q.setQuadrantSegments(ot),q.setEndCapStyle(gt);var W=q.getResultGeometry(K);return W}};ui.precisionScaleFactor=function(e,t,n){var r=e.getEnvelopeInternal(),a=wo.max(Math.abs(r.getMaxX()),Math.abs(r.getMaxY()),Math.abs(r.getMinX()),Math.abs(r.getMinY())),u=t>0?t:0,p=a+2*u,c=Math.trunc(Math.log(p)/Math.log(10)+1),b=n-c,C=Math.pow(10,b);return C};ip.CAP_ROUND.get=function(){return bn.CAP_ROUND};ip.CAP_BUTT.get=function(){return bn.CAP_FLAT};ip.CAP_FLAT.get=function(){return bn.CAP_FLAT};ip.CAP_SQUARE.get=function(){return bn.CAP_SQUARE};ip.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(ui,ip);var bi=function(){this._pt=[new bt,new bt],this._distance=De.NaN,this._isNull=!0};bi.prototype.getCoordinates=function(){return this._pt};bi.prototype.getCoordinate=function(e){return this._pt[e]};bi.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r<this._distance&&this.initialize(t,n,r)}};bi.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=a,this._isNull=!1}};bi.prototype.getDistance=function(){return this._distance};bi.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r>this._distance&&this.initialize(t,n,r)}};bi.prototype.interfaces_=function(){return[]};bi.prototype.getClass=function(){return bi};var ta=function(){};ta.prototype.interfaces_=function(){return[]};ta.prototype.getClass=function(){return ta};ta.computeDistance=function(){if(arguments[2]instanceof bi&&arguments[0]instanceof ar&&arguments[1]instanceof bt)for(var e=arguments[0],t=arguments[1],n=arguments[2],r=e.getCoordinates(),a=new _e,u=0;u<r.length-1;u++){a.setCoordinates(r[u],r[u+1]);var p=a.closestPoint(t);n.setMinimum(p,t)}else if(arguments[2]instanceof bi&&arguments[0]instanceof Lr&&arguments[1]instanceof bt){var c=arguments[0],b=arguments[1],C=arguments[2];ta.computeDistance(c.getExteriorRing(),b,C);for(var A=0;A<c.getNumInteriorRing();A++)ta.computeDistance(c.getInteriorRingN(A),b,C)}else if(arguments[2]instanceof bi&&arguments[0]instanceof Te&&arguments[1]instanceof bt){var P=arguments[0],R=arguments[1],et=arguments[2];if(P instanceof ar)ta.computeDistance(P,R,et);else if(P instanceof Lr)ta.computeDistance(P,R,et);else if(P instanceof Ii)for(var X=P,K=0;K<X.getNumGeometries();K++){var ot=X.getGeometryN(K);ta.computeDistance(ot,R,et)}else et.setMinimum(P.getCoordinate(),R)}else if(arguments[2]instanceof bi&&arguments[0]instanceof _e&&arguments[1]instanceof bt){var gt=arguments[0],q=arguments[1],W=arguments[2],at=gt.closestPoint(q);W.setMinimum(at,q)}};var lu=function(e){this._maxPtDist=new bi,this._inputGeom=e||null},p0={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};lu.prototype.computeMaxMidpointDistance=function(e){var t=new wl(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};lu.prototype.computeMaxVertexDistance=function(e){var t=new $u(this._inputGeom);e.apply(t),this._maxPtDist.setMaximum(t.getMaxPointDistance())};lu.prototype.findDistance=function(e){return this.computeMaxVertexDistance(e),this.computeMaxMidpointDistance(e),this._maxPtDist.getDistance()};lu.prototype.getDistancePoints=function(){return this._maxPtDist};lu.prototype.interfaces_=function(){return[]};lu.prototype.getClass=function(){return lu};p0.MaxPointDistanceFilter.get=function(){return $u};p0.MaxMidpointDistanceFilter.get=function(){return wl};Object.defineProperties(lu,p0);var $u=function(e){this._maxPtDist=new bi,this._minPtDist=new bi,this._geom=e||null};$u.prototype.filter=function(e){this._minPtDist.initialize(),ta.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};$u.prototype.getMaxPointDistance=function(){return this._maxPtDist};$u.prototype.interfaces_=function(){return[sa]};$u.prototype.getClass=function(){return $u};var wl=function(e){this._maxPtDist=new bi,this._minPtDist=new bi,this._geom=e||null};wl.prototype.filter=function(e,t){if(t===0)return null;var n=e.getCoordinate(t-1),r=e.getCoordinate(t),a=new bt((n.x+r.x)/2,(n.y+r.y)/2);this._minPtDist.initialize(),ta.computeDistance(this._geom,a,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};wl.prototype.isDone=function(){return!1};wl.prototype.isGeometryChanged=function(){return!1};wl.prototype.getMaxPointDistance=function(){return this._maxPtDist};wl.prototype.interfaces_=function(){return[is]};wl.prototype.getClass=function(){return wl};var Ra=function(e){this._comps=e||null};Ra.prototype.filter=function(e){e instanceof Lr&&this._comps.add(e)};Ra.prototype.interfaces_=function(){return[ks]};Ra.prototype.getClass=function(){return Ra};Ra.getPolygons=function(){if(arguments.length===1){var e=arguments[0];return Ra.getPolygons(e,new Qt)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof Lr?n.add(t):t instanceof Ii&&t.apply(new Ra(n)),n}};var ei=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var e=arguments[0];this._lines=e}else if(arguments.length===2){var t=arguments[0],n=arguments[1];this._lines=t,this._isForcedToLineString=n}};ei.prototype.filter=function(e){if(this._isForcedToLineString&&e instanceof aa){var t=e.getFactory().createLineString(e.getCoordinateSequence());return this._lines.add(t),null}e instanceof ar&&this._lines.add(e)};ei.prototype.setForceToLineString=function(e){this._isForcedToLineString=e};ei.prototype.interfaces_=function(){return[za]};ei.prototype.getClass=function(){return ei};ei.getGeometry=function(){if(arguments.length===1){var e=arguments[0];return e.getFactory().buildGeometry(ei.getLines(e))}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t.getFactory().buildGeometry(ei.getLines(t,n))}};ei.getLines=function(){if(arguments.length===1){var e=arguments[0];return ei.getLines(e,!1)}else if(arguments.length===2){if(Le(arguments[0],Cr)&&Le(arguments[1],Cr)){for(var t=arguments[0],n=arguments[1],r=t.iterator();r.hasNext();){var a=r.next();ei.getLines(a,n)}return n}else if(arguments[0]instanceof Te&&typeof arguments[1]=="boolean"){var u=arguments[0],p=arguments[1],c=new Qt;return u.apply(new ei(c,p)),c}else if(arguments[0]instanceof Te&&Le(arguments[1],Cr)){var b=arguments[0],C=arguments[1];return b instanceof ar?C.add(b):b.apply(new ei(C)),C}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&Le(arguments[0],Cr)&&Le(arguments[1],Cr)){for(var A=arguments[0],P=arguments[1],R=arguments[2],et=A.iterator();et.hasNext();){var X=et.next();ei.getLines(X,P,R)}return P}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Te&&Le(arguments[1],Cr)){var K=arguments[0],ot=arguments[1],gt=arguments[2];return K.apply(new ei(ot,gt)),ot}}};var ls=function(){if(this._boundaryRule=Oo.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e===null)throw new Hn("Rule must be non-null");this._boundaryRule=e}};ls.prototype.locateInternal=function(){var e=this;if(arguments[0]instanceof bt&&arguments[1]instanceof Lr){var t=arguments[0],n=arguments[1];if(n.isEmpty())return St.EXTERIOR;var r=n.getExteriorRing(),a=this.locateInPolygonRing(t,r);if(a===St.EXTERIOR)return St.EXTERIOR;if(a===St.BOUNDARY)return St.BOUNDARY;for(var u=0;u<n.getNumInteriorRing();u++){var p=n.getInteriorRingN(u),c=e.locateInPolygonRing(t,p);if(c===St.INTERIOR)return St.EXTERIOR;if(c===St.BOUNDARY)return St.BOUNDARY}return St.INTERIOR}else if(arguments[0]instanceof bt&&arguments[1]instanceof ar){var b=arguments[0],C=arguments[1];if(!C.getEnvelopeInternal().intersects(b))return St.EXTERIOR;var A=C.getCoordinates();return!C.isClosed()&&(b.equals(A[0])||b.equals(A[A.length-1]))?St.BOUNDARY:se.isOnLine(b,A)?St.INTERIOR:St.EXTERIOR}else if(arguments[0]instanceof bt&&arguments[1]instanceof io){var P=arguments[0],R=arguments[1],et=R.getCoordinate();return et.equals2D(P)?St.INTERIOR:St.EXTERIOR}};ls.prototype.locateInPolygonRing=function(e,t){return t.getEnvelopeInternal().intersects(e)?se.locatePointInRing(e,t.getCoordinates()):St.EXTERIOR};ls.prototype.intersects=function(e,t){return this.locate(e,t)!==St.EXTERIOR};ls.prototype.updateLocationInfo=function(e){e===St.INTERIOR&&(this._isIn=!0),e===St.BOUNDARY&&this._numBoundaries++};ls.prototype.computeLocation=function(e,t){var n=this;if(t instanceof io&&this.updateLocationInfo(this.locateInternal(e,t)),t instanceof ar)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof Lr)this.updateLocationInfo(this.locateInternal(e,t));else if(t instanceof ru)for(var r=t,a=0;a<r.getNumGeometries();a++){var u=r.getGeometryN(a);n.updateLocationInfo(n.locateInternal(e,u))}else if(t instanceof ra)for(var p=t,c=0;c<p.getNumGeometries();c++){var b=p.getGeometryN(c);n.updateLocationInfo(n.locateInternal(e,b))}else if(t instanceof Ii)for(var C=new ia(t);C.hasNext();){var A=C.next();A!==t&&n.computeLocation(e,A)}};ls.prototype.locate=function(e,t){return t.isEmpty()?St.EXTERIOR:t instanceof ar?this.locateInternal(e,t):t instanceof Lr?this.locateInternal(e,t):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(e,t),this._boundaryRule.isInBoundary(this._numBoundaries)?St.BOUNDARY:this._numBoundaries>0||this._isIn?St.INTERIOR:St.EXTERIOR)};ls.prototype.interfaces_=function(){return[]};ls.prototype.getClass=function(){return ls};var wi=function e(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var t=arguments[0],n=arguments[1];e.call(this,t,e.INSIDE_AREA,n)}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];this._component=r,this._segIndex=a,this._pt=u}},E2={INSIDE_AREA:{configurable:!0}};wi.prototype.isInsideArea=function(){return this._segIndex===wi.INSIDE_AREA};wi.prototype.getCoordinate=function(){return this._pt};wi.prototype.getGeometryComponent=function(){return this._component};wi.prototype.getSegmentIndex=function(){return this._segIndex};wi.prototype.interfaces_=function(){return[]};wi.prototype.getClass=function(){return wi};E2.INSIDE_AREA.get=function(){return-1};Object.defineProperties(wi,E2);var ml=function(e){this._pts=e||null};ml.prototype.filter=function(e){e instanceof io&&this._pts.add(e)};ml.prototype.interfaces_=function(){return[ks]};ml.prototype.getClass=function(){return ml};ml.getPoints=function(){if(arguments.length===1){var e=arguments[0];return e instanceof io?ss.singletonList(e):ml.getPoints(e,new Qt)}else if(arguments.length===2){var t=arguments[0],n=arguments[1];return t instanceof io?n.add(t):t instanceof Ii&&t.apply(new ml(n)),n}};var tc=function(){this._locations=null;var e=arguments[0];this._locations=e};tc.prototype.filter=function(e){(e instanceof io||e instanceof ar||e instanceof Lr)&&this._locations.add(new wi(e,0,e.getCoordinate()))};tc.prototype.interfaces_=function(){return[ks]};tc.prototype.getClass=function(){return tc};tc.getLocations=function(e){var t=new Qt;return e.apply(new tc(t)),t};var ii=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new ls,this._minDistanceLocation=null,this._minDistance=De.MAX_VALUE,arguments.length===2){var e=arguments[0],t=arguments[1];this._geom=[e,t],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=r,this._terminateDistance=a}};ii.prototype.computeContainmentDistance=function(){var e=this;if(arguments.length===0){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,t)}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=1-n,u=Ra.getPolygons(this._geom[n]);if(u.size()>0){var p=tc.getLocations(this._geom[a]);if(this.computeContainmentDistance(p,u,r),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[a]=r[0],this._minDistanceLocation[n]=r[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&Le(arguments[0],ns)&&Le(arguments[1],ns)){for(var c=arguments[0],b=arguments[1],C=arguments[2],A=0;A<c.size();A++)for(var P=c.get(A),R=0;R<b.size();R++)if(e.computeContainmentDistance(P,b.get(R),C),e._minDistance<=e._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof wi&&arguments[1]instanceof Lr){var et=arguments[0],X=arguments[1],K=arguments[2],ot=et.getCoordinate();if(St.EXTERIOR!==this._ptLocator.locate(ot,X))return this._minDistance=0,K[0]=et,K[1]=new wi(X,ot),null}}};ii.prototype.computeMinDistanceLinesPoints=function(e,t,n){for(var r=this,a=0;a<e.size();a++)for(var u=e.get(a),p=0;p<t.size();p++){var c=t.get(p);if(r.computeMinDistance(u,c,n),r._minDistance<=r._terminateDistance)return null}};ii.prototype.computeFacetDistance=function(){var e=new Array(2).fill(null),t=ei.getLines(this._geom[0]),n=ei.getLines(this._geom[1]),r=ml.getPoints(this._geom[0]),a=ml.getPoints(this._geom[1]);if(this.computeMinDistanceLines(t,n,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(t,a,e),this.updateMinDistance(e,!1),this._minDistance<=this._terminateDistance)||(e[0]=null,e[1]=null,this.computeMinDistanceLinesPoints(n,r,e),this.updateMinDistance(e,!0),this._minDistance<=this._terminateDistance))return null;e[0]=null,e[1]=null,this.computeMinDistancePoints(r,a,e),this.updateMinDistance(e,!1)};ii.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};ii.prototype.updateMinDistance=function(e,t){if(e[0]===null)return null;t?(this._minDistanceLocation[0]=e[1],this._minDistanceLocation[1]=e[0]):(this._minDistanceLocation[0]=e[0],this._minDistanceLocation[1]=e[1])};ii.prototype.nearestPoints=function(){this.computeMinDistance();var e=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return e};ii.prototype.computeMinDistance=function(){var e=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof ar&&arguments[1]instanceof io){var t=arguments[0],n=arguments[1],r=arguments[2];if(t.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var a=t.getCoordinates(),u=n.getCoordinate(),p=0;p<a.length-1;p++){var c=se.distancePointLine(u,a[p],a[p+1]);if(c<e._minDistance){e._minDistance=c;var b=new _e(a[p],a[p+1]),C=b.closestPoint(u);r[0]=new wi(t,p,C),r[1]=new wi(n,0,u)}if(e._minDistance<=e._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof ar&&arguments[1]instanceof ar){var A=arguments[0],P=arguments[1],R=arguments[2];if(A.getEnvelopeInternal().distance(P.getEnvelopeInternal())>this._minDistance)return null;for(var et=A.getCoordinates(),X=P.getCoordinates(),K=0;K<et.length-1;K++)for(var ot=0;ot<X.length-1;ot++){var gt=se.distanceLineLine(et[K],et[K+1],X[ot],X[ot+1]);if(gt<e._minDistance){e._minDistance=gt;var q=new _e(et[K],et[K+1]),W=new _e(X[ot],X[ot+1]),at=q.closestPoints(W);R[0]=new wi(A,K,at[0]),R[1]=new wi(P,ot,at[1])}if(e._minDistance<=e._terminateDistance)return null}}}};ii.prototype.computeMinDistancePoints=function(e,t,n){for(var r=this,a=0;a<e.size();a++)for(var u=e.get(a),p=0;p<t.size();p++){var c=t.get(p),b=u.getCoordinate().distance(c.getCoordinate());if(b<r._minDistance&&(r._minDistance=b,n[0]=new wi(u,0,u.getCoordinate()),n[1]=new wi(c,0,c.getCoordinate())),r._minDistance<=r._terminateDistance)return null}};ii.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new Hn("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};ii.prototype.computeMinDistanceLines=function(e,t,n){for(var r=this,a=0;a<e.size();a++)for(var u=e.get(a),p=0;p<t.size();p++){var c=t.get(p);if(r.computeMinDistance(u,c,n),r._minDistance<=r._terminateDistance)return null}};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};ii.distance=function(e,t){var n=new ii(e,t);return n.distance()};ii.isWithinDistance=function(e,t,n){var r=new ii(e,t,n);return r.distance()<=n};ii.nearestPoints=function(e,t){var n=new ii(e,t);return n.nearestPoints()};var ci=function(){this._pt=[new bt,new bt],this._distance=De.NaN,this._isNull=!0};ci.prototype.getCoordinates=function(){return this._pt};ci.prototype.getCoordinate=function(e){return this._pt[e]};ci.prototype.setMinimum=function(){if(arguments.length===1){var e=arguments[0];this.setMinimum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r<this._distance&&this.initialize(t,n,r)}};ci.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var e=arguments[0],t=arguments[1];this._pt[0].setCoordinate(e),this._pt[1].setCoordinate(t),this._distance=e.distance(t),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],r=arguments[1],a=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(r),this._distance=a,this._isNull=!1}};ci.prototype.toString=function(){return rs.toLineString(this._pt[0],this._pt[1])};ci.prototype.getDistance=function(){return this._distance};ci.prototype.setMaximum=function(){if(arguments.length===1){var e=arguments[0];this.setMaximum(e._pt[0],e._pt[1])}else if(arguments.length===2){var t=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(t,n),null;var r=t.distance(n);r>this._distance&&this.initialize(t,n,r)}};ci.prototype.interfaces_=function(){return[]};ci.prototype.getClass=function(){return ci};var Es=function(){};Es.prototype.interfaces_=function(){return[]};Es.prototype.getClass=function(){return Es};Es.computeDistance=function(){if(arguments[2]instanceof ci&&arguments[0]instanceof ar&&arguments[1]instanceof bt)for(var e=arguments[0],t=arguments[1],n=arguments[2],r=new _e,a=e.getCoordinates(),u=0;u<a.length-1;u++){r.setCoordinates(a[u],a[u+1]);var p=r.closestPoint(t);n.setMinimum(p,t)}else if(arguments[2]instanceof ci&&arguments[0]instanceof Lr&&arguments[1]instanceof bt){var c=arguments[0],b=arguments[1],C=arguments[2];Es.computeDistance(c.getExteriorRing(),b,C);for(var A=0;A<c.getNumInteriorRing();A++)Es.computeDistance(c.getInteriorRingN(A),b,C)}else if(arguments[2]instanceof ci&&arguments[0]instanceof Te&&arguments[1]instanceof bt){var P=arguments[0],R=arguments[1],et=arguments[2];if(P instanceof ar)Es.computeDistance(P,R,et);else if(P instanceof Lr)Es.computeDistance(P,R,et);else if(P instanceof Ii)for(var X=P,K=0;K<X.getNumGeometries();K++){var ot=X.getGeometryN(K);Es.computeDistance(ot,R,et)}else et.setMinimum(P.getCoordinate(),R)}else if(arguments[2]instanceof ci&&arguments[0]instanceof _e&&arguments[1]instanceof bt){var gt=arguments[0],q=arguments[1],W=arguments[2],at=gt.closestPoint(q);W.setMinimum(at,q)}};var No=function(){this._g0=null,this._g1=null,this._ptDist=new ci,this._densifyFrac=0;var e=arguments[0],t=arguments[1];this._g0=e,this._g1=t},f0={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};No.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};No.prototype.setDensifyFraction=function(e){if(e>1||e<=0)throw new Hn("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=e};No.prototype.compute=function(e,t){this.computeOrientedDistance(e,t,this._ptDist),this.computeOrientedDistance(t,e,this._ptDist)};No.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};No.prototype.computeOrientedDistance=function(e,t,n){var r=new ec(t);if(e.apply(r),n.setMaximum(r.getMaxPointDistance()),this._densifyFrac>0){var a=new Sl(t,this._densifyFrac);e.apply(a),n.setMaximum(a.getMaxPointDistance())}};No.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};No.prototype.interfaces_=function(){return[]};No.prototype.getClass=function(){return No};No.distance=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new No(e,t);return n.distance()}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2],p=new No(r,a);return p.setDensifyFraction(u),p.distance()}};f0.MaxPointDistanceFilter.get=function(){return ec};f0.MaxDensifiedByFractionDistanceFilter.get=function(){return Sl};Object.defineProperties(No,f0);var ec=function(){this._maxPtDist=new ci,this._minPtDist=new ci,this._euclideanDist=new Es,this._geom=null;var e=arguments[0];this._geom=e};ec.prototype.filter=function(e){this._minPtDist.initialize(),Es.computeDistance(this._geom,e,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};ec.prototype.getMaxPointDistance=function(){return this._maxPtDist};ec.prototype.interfaces_=function(){return[sa]};ec.prototype.getClass=function(){return ec};var Sl=function(){this._maxPtDist=new ci,this._minPtDist=new ci,this._geom=null,this._numSubSegs=0;var e=arguments[0],t=arguments[1];this._geom=e,this._numSubSegs=Math.trunc(Math.round(1/t))};Sl.prototype.filter=function(e,t){var n=this;if(t===0)return null;for(var r=e.getCoordinate(t-1),a=e.getCoordinate(t),u=(a.x-r.x)/this._numSubSegs,p=(a.y-r.y)/this._numSubSegs,c=0;c<this._numSubSegs;c++){var b=r.x+c*u,C=r.y+c*p,A=new bt(b,C);n._minPtDist.initialize(),Es.computeDistance(n._geom,A,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};Sl.prototype.isDone=function(){return!1};Sl.prototype.isGeometryChanged=function(){return!1};Sl.prototype.getMaxPointDistance=function(){return this._maxPtDist};Sl.prototype.interfaces_=function(){return[is]};Sl.prototype.getClass=function(){return Sl};var Qi=function(e,t,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._bufDistance=t||null,this._result=n||null},d0={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Qi.prototype.checkMaximumDistance=function(e,t,n){var r=new No(t,e);if(r.setDensifyFraction(.25),this._maxDistanceFound=r.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var a=r.getCoordinates();this._errorLocation=a[1],this._errorIndicator=e.getFactory().createLineString(a),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+rs.toLineString(a[0],a[1])+")"}};Qi.prototype.isValid=function(){var e=Math.abs(this._bufDistance),t=Qi.MAX_DISTANCE_DIFF_FRAC*e;return this._minValidDistance=e-t,this._maxValidDistance=e+t,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Qi.VERBOSE&&ri.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};Qi.prototype.checkNegativeValid=function(){if(!(this._input instanceof Lr||this._input instanceof ra||this._input instanceof Ii))return null;var e=this.getPolygonLines(this._input);if(this.checkMinimumDistance(e,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(e,this._result,this._maxValidDistance)};Qi.prototype.getErrorIndicator=function(){return this._errorIndicator};Qi.prototype.checkMinimumDistance=function(e,t,n){var r=new ii(e,t,n);if(this._minDistanceFound=r.distance(),this._minDistanceFound<n){this._isValid=!1;var a=r.nearestPoints();this._errorLocation=r.nearestPoints()[1],this._errorIndicator=e.getFactory().createLineString(a),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+rs.toLineString(a[0],a[1])+" )"}};Qi.prototype.checkPositiveValid=function(){var e=this._result.getBoundary();if(this.checkMinimumDistance(this._input,e,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,e,this._maxValidDistance)};Qi.prototype.getErrorLocation=function(){return this._errorLocation};Qi.prototype.getPolygonLines=function(e){for(var t=new Qt,n=new ei(t),r=Ra.getPolygons(e),a=r.iterator();a.hasNext();){var u=a.next();u.apply(n)}return e.getFactory().buildGeometry(t)};Qi.prototype.getErrorMessage=function(){return this._errMsg};Qi.prototype.interfaces_=function(){return[]};Qi.prototype.getClass=function(){return Qi};d0.VERBOSE.get=function(){return!1};d0.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Qi,d0);var oi=function(e,t,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=e||null,this._distance=t||null,this._result=n||null},m0={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};oi.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};oi.prototype.checkEnvelope=function(){if(this._distance<0)return null;var e=this._distance*oi.MAX_ENV_DIFF_FRAC;e===0&&(e=.001);var t=new ye(this._input.getEnvelopeInternal());t.expandBy(this._distance);var n=new ye(this._result.getEnvelopeInternal());n.expandBy(e),n.contains(t)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};oi.prototype.checkDistance=function(){var e=new Qi(this._input,this._distance,this._result);e.isValid()||(this._isValid=!1,this._errorMsg=e.getErrorMessage(),this._errorLocation=e.getErrorLocation(),this._errorIndicator=e.getErrorIndicator()),this.report("Distance")};oi.prototype.checkArea=function(){var e=this._input.getArea(),t=this._result.getArea();this._distance>0&&e>t&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&e<t&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};oi.prototype.checkPolygonal=function(){this._result instanceof Lr||this._result instanceof ra||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};oi.prototype.getErrorIndicator=function(){return this._errorIndicator};oi.prototype.getErrorLocation=function(){return this._errorLocation};oi.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};oi.prototype.report=function(e){if(!oi.VERBOSE)return null;ri.out.println("Check "+e+": "+(this._isValid?"passed":"FAILED"))};oi.prototype.getErrorMessage=function(){return this._errorMsg};oi.prototype.interfaces_=function(){return[]};oi.prototype.getClass=function(){return oi};oi.isValidMsg=function(e,t,n){var r=new oi(e,t,n);return r.isValid()?null:r.getErrorMessage()};oi.isValid=function(e,t,n){var r=new oi(e,t,n);return!!r.isValid()};m0.VERBOSE.get=function(){return!1};m0.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(oi,m0);var Bs=function(){this._pts=null,this._data=null;var e=arguments[0],t=arguments[1];this._pts=e,this._data=t};Bs.prototype.getCoordinates=function(){return this._pts};Bs.prototype.size=function(){return this._pts.length};Bs.prototype.getCoordinate=function(e){return this._pts[e]};Bs.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Bs.prototype.getSegmentOctant=function(e){return e===this._pts.length-1?-1:Ku.octant(this.getCoordinate(e),this.getCoordinate(e+1))};Bs.prototype.setData=function(e){this._data=e};Bs.prototype.getData=function(){return this._data};Bs.prototype.toString=function(){return rs.toLineString(new fr(this._pts))};Bs.prototype.interfaces_=function(){return[ua]};Bs.prototype.getClass=function(){return Bs};var Jr=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new Qt,this._intersectionCount=0,this._keepIntersections=!0;var e=arguments[0];this._li=e,this._interiorIntersection=null};Jr.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Jr.prototype.setCheckEndSegmentsOnly=function(e){this._isCheckEndSegmentsOnly=e};Jr.prototype.getIntersectionSegments=function(){return this._intSegments};Jr.prototype.count=function(){return this._intersectionCount};Jr.prototype.getIntersections=function(){return this._intersections};Jr.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};Jr.prototype.setKeepIntersections=function(e){this._keepIntersections=e};Jr.prototype.processIntersections=function(e,t,n,r){if(!this._findAllIntersections&&this.hasIntersection()||e===n&&t===r)return null;if(this._isCheckEndSegmentsOnly){var a=this.isEndSegment(e,t)||this.isEndSegment(n,r);if(!a)return null}var u=e.getCoordinates()[t],p=e.getCoordinates()[t+1],c=n.getCoordinates()[r],b=n.getCoordinates()[r+1];this._li.computeIntersection(u,p,c,b),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=u,this._intSegments[1]=p,this._intSegments[2]=c,this._intSegments[3]=b,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Jr.prototype.isEndSegment=function(e,t){return t===0||t>=e.size()-2};Jr.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Jr.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Jr.prototype.interfaces_=function(){return[su]};Jr.prototype.getClass=function(){return Jr};Jr.createAllIntersectionsFinder=function(e){var t=new Jr(e);return t.setFindAllIntersections(!0),t};Jr.createAnyIntersectionFinder=function(e){return new Jr(e)};Jr.createIntersectionCounter=function(e){var t=new Jr(e);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var us=function(){this._li=new du,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var e=arguments[0];this._segStrings=e};us.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};us.prototype.getIntersections=function(){return this._segInt.getIntersections()};us.prototype.isValid=function(){return this.execute(),this._isValid};us.prototype.setFindAllIntersections=function(e){this._findAllIntersections=e};us.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Jr(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var e=new h0;if(e.setSegmentIntersector(this._segInt),e.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};us.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Fa(this.getErrorMessage(),this._segInt.getInteriorIntersection())};us.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var e=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+rs.toLineString(e[0],e[1])+" and "+rs.toLineString(e[2],e[3])};us.prototype.interfaces_=function(){return[]};us.prototype.getClass=function(){return us};us.computeIntersections=function(e){var t=new us(e);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var uu=function e(){this._nv=null;var t=arguments[0];this._nv=new us(e.toSegmentStrings(t))};uu.prototype.checkValid=function(){this._nv.checkValid()};uu.prototype.interfaces_=function(){return[]};uu.prototype.getClass=function(){return uu};uu.toSegmentStrings=function(e){for(var t=new Qt,n=e.iterator();n.hasNext();){var r=n.next();t.add(new Bs(r.getCoordinates(),r))}return t};uu.checkValid=function(e){var t=new uu(e);t.checkValid()};var nc=function(e){this._mapOp=e};nc.prototype.map=function(e){for(var t=this,n=new Qt,r=0;r<e.getNumGeometries();r++){var a=t._mapOp.map(e.getGeometryN(r));a.isEmpty()||n.add(a)}return e.getFactory().createGeometryCollection(en.toGeometryArray(n))};nc.prototype.interfaces_=function(){return[]};nc.prototype.getClass=function(){return nc};nc.map=function(e,t){var n=new nc(t);return n.map(e)};var Vs=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new Qt,this._resultLineList=new Qt;var e=arguments[0],t=arguments[1],n=arguments[2];this._op=e,this._geometryFactory=t,this._ptLocator=n};Vs.prototype.collectLines=function(e){for(var t=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var r=n.next();t.collectLineEdge(r,e,t._lineEdgesList),t.collectBoundaryTouchEdge(r,e,t._lineEdgesList)}};Vs.prototype.labelIsolatedLine=function(e,t){var n=this._ptLocator.locate(e.getCoordinate(),this._op.getArgGeometry(t));e.getLabel().setLocation(t,n)};Vs.prototype.build=function(e){return this.findCoveredLineEdges(),this.collectLines(e),this.buildLines(e),this._resultLineList};Vs.prototype.collectLineEdge=function(e,t,n){var r=e.getLabel(),a=e.getEdge();e.isLineEdge()&&!e.isVisited()&&Ne.isResultOfOp(r,t)&&!a.isCovered()&&(n.add(a),e.setVisitedEdge(!0))};Vs.prototype.findCoveredLineEdges=function(){for(var e=this,t=this._op.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();n.getEdges().findCoveredLineEdges()}for(var r=this._op.getGraph().getEdgeEnds().iterator();r.hasNext();){var a=r.next(),u=a.getEdge();if(a.isLineEdge()&&!u.isCoveredSet()){var p=e._op.isCoveredByA(a.getCoordinate());u.setCovered(p)}}};Vs.prototype.labelIsolatedLines=function(e){for(var t=this,n=e.iterator();n.hasNext();){var r=n.next(),a=r.getLabel();r.isIsolated()&&(a.isNull(0)?t.labelIsolatedLine(r,0):t.labelIsolatedLine(r,1))}};Vs.prototype.buildLines=function(e){for(var t=this,n=this._lineEdgesList.iterator();n.hasNext();){var r=n.next(),a=t._geometryFactory.createLineString(r.getCoordinates());t._resultLineList.add(a),r.setInResult(!0)}};Vs.prototype.collectBoundaryTouchEdge=function(e,t,n){var r=e.getLabel();if(e.isLineEdge()||e.isVisited()||e.isInteriorAreaEdge()||e.getEdge().isInResult())return null;Ve.isTrue(!(e.isInResult()||e.getSym().isInResult())||!e.getEdge().isInResult()),Ne.isResultOfOp(r,t)&&t===Ne.INTERSECTION&&(n.add(e.getEdge()),e.setVisitedEdge(!0))};Vs.prototype.interfaces_=function(){return[]};Vs.prototype.getClass=function(){return Vs};var rc=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new Qt;var e=arguments[0],t=arguments[1];this._op=e,this._geometryFactory=t};rc.prototype.filterCoveredNodeToPoint=function(e){var t=e.getCoordinate();if(!this._op.isCoveredByLA(t)){var n=this._geometryFactory.createPoint(t);this._resultPointList.add(n)}};rc.prototype.extractNonCoveredResultNodes=function(e){for(var t=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var r=n.next();if(!r.isInResult()&&!r.isIncidentEdgeInResult()&&(r.getEdges().getDegree()===0||e===Ne.INTERSECTION)){var a=r.getLabel();Ne.isResultOfOp(a,e)&&t.filterCoveredNodeToPoint(r)}}};rc.prototype.build=function(e){return this.extractNonCoveredResultNodes(e),this._resultPointList};rc.prototype.interfaces_=function(){return[]};rc.prototype.getClass=function(){return rc};var Bi=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Bi.prototype.transformPoint=function(e,t){return this._factory.createPoint(this.transformCoordinates(e.getCoordinateSequence(),e))};Bi.prototype.transformPolygon=function(e,t){var n=this,r=!0,a=this.transformLinearRing(e.getExteriorRing(),e);(a===null||!(a instanceof aa)||a.isEmpty())&&(r=!1);for(var u=new Qt,p=0;p<e.getNumInteriorRing();p++){var c=n.transformLinearRing(e.getInteriorRingN(p),e);c===null||c.isEmpty()||(c instanceof aa||(r=!1),u.add(c))}if(r)return this._factory.createPolygon(a,u.toArray([]));var b=new Qt;return a!==null&&b.add(a),b.addAll(u),this._factory.buildGeometry(b)};Bi.prototype.createCoordinateSequence=function(e){return this._factory.getCoordinateSequenceFactory().create(e)};Bi.prototype.getInputGeometry=function(){return this._inputGeom};Bi.prototype.transformMultiLineString=function(e,t){for(var n=this,r=new Qt,a=0;a<e.getNumGeometries();a++){var u=n.transformLineString(e.getGeometryN(a),e);u!==null&&(u.isEmpty()||r.add(u))}return this._factory.buildGeometry(r)};Bi.prototype.transformCoordinates=function(e,t){return this.copy(e)};Bi.prototype.transformLineString=function(e,t){return this._factory.createLineString(this.transformCoordinates(e.getCoordinateSequence(),e))};Bi.prototype.transformMultiPoint=function(e,t){for(var n=this,r=new Qt,a=0;a<e.getNumGeometries();a++){var u=n.transformPoint(e.getGeometryN(a),e);u!==null&&(u.isEmpty()||r.add(u))}return this._factory.buildGeometry(r)};Bi.prototype.transformMultiPolygon=function(e,t){for(var n=this,r=new Qt,a=0;a<e.getNumGeometries();a++){var u=n.transformPolygon(e.getGeometryN(a),e);u!==null&&(u.isEmpty()||r.add(u))}return this._factory.buildGeometry(r)};Bi.prototype.copy=function(e){return e.copy()};Bi.prototype.transformGeometryCollection=function(e,t){for(var n=this,r=new Qt,a=0;a<e.getNumGeometries();a++){var u=n.transform(e.getGeometryN(a));u!==null&&(n._pruneEmptyGeometry&&u.isEmpty()||r.add(u))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(en.toGeometryArray(r)):this._factory.buildGeometry(r)};Bi.prototype.transform=function(e){if(this._inputGeom=e,this._factory=e.getFactory(),e instanceof io)return this.transformPoint(e,null);if(e instanceof Bh)return this.transformMultiPoint(e,null);if(e instanceof aa)return this.transformLinearRing(e,null);if(e instanceof ar)return this.transformLineString(e,null);if(e instanceof ru)return this.transformMultiLineString(e,null);if(e instanceof Lr)return this.transformPolygon(e,null);if(e instanceof ra)return this.transformMultiPolygon(e,null);if(e instanceof Ii)return this.transformGeometryCollection(e,null);throw new Hn("Unknown Geometry subtype: "+e.getClass().getName())};Bi.prototype.transformLinearRing=function(e,t){var n=this.transformCoordinates(e.getCoordinateSequence(),e);if(n===null)return this._factory.createLinearRing(null);var r=n.size();return r>0&&r<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};Bi.prototype.interfaces_=function(){return[]};Bi.prototype.getClass=function(){return Bi};var pa=function e(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new _e,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof ar&&typeof arguments[1]=="number"){var t=arguments[0],n=arguments[1];e.call(this,t.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var r=arguments[0],a=arguments[1];this._srcPts=r,this._isClosed=e.isClosed(r),this._snapTolerance=a}};pa.prototype.snapVertices=function(e,t){for(var n=this,r=this._isClosed?e.size()-1:e.size(),a=0;a<r;a++){var u=e.get(a),p=n.findSnapForVertex(u,t);p!==null&&(e.set(a,new bt(p)),a===0&&n._isClosed&&e.set(e.size()-1,new bt(p)))}};pa.prototype.findSnapForVertex=function(e,t){for(var n=this,r=0;r<t.length;r++){if(e.equals2D(t[r]))return null;if(e.distance(t[r])<n._snapTolerance)return t[r]}return null};pa.prototype.snapTo=function(e){var t=new Jf(this._srcPts);this.snapVertices(t,e),this.snapSegments(t,e);var n=t.toCoordinateArray();return n};pa.prototype.snapSegments=function(e,t){var n=this;if(t.length===0)return null;var r=t.length;t[0].equals2D(t[t.length-1])&&(r=t.length-1);for(var a=0;a<r;a++){var u=t[a],p=n.findSegmentIndexToSnap(u,e);p>=0&&e.add(p+1,new bt(u),!1)}};pa.prototype.findSegmentIndexToSnap=function(e,t){for(var n=this,r=De.MAX_VALUE,a=-1,u=0;u<t.size()-1;u++){if(n._seg.p0=t.get(u),n._seg.p1=t.get(u+1),n._seg.p0.equals2D(e)||n._seg.p1.equals2D(e)){if(n._allowSnappingToSourceVertices)continue;return-1}var p=n._seg.distance(e);p<n._snapTolerance&&p<r&&(r=p,a=u)}return a};pa.prototype.setAllowSnappingToSourceVertices=function(e){this._allowSnappingToSourceVertices=e};pa.prototype.interfaces_=function(){return[]};pa.prototype.getClass=function(){return pa};pa.isClosed=function(e){return e.length<=1?!1:e[0].equals2D(e[e.length-1])};var dr=function(e){this._srcGeom=e||null},C2={SNAP_PRECISION_FACTOR:{configurable:!0}};dr.prototype.snapTo=function(e,t){var n=this.extractTargetCoordinates(e),r=new T2(t,n);return r.transform(this._srcGeom)};dr.prototype.snapToSelf=function(e,t){var n=this.extractTargetCoordinates(this._srcGeom),r=new T2(e,n,!0),a=r.transform(this._srcGeom),u=a;return t&&Le(u,yl)&&(u=a.buffer(0)),u};dr.prototype.computeSnapTolerance=function(e){var t=this.computeMinimumSegmentLength(e),n=t/10;return n};dr.prototype.extractTargetCoordinates=function(e){for(var t=new Ds,n=e.getCoordinates(),r=0;r<n.length;r++)t.add(n[r]);return t.toArray(new Array(0).fill(null))};dr.prototype.computeMinimumSegmentLength=function(e){for(var t=De.MAX_VALUE,n=0;n<e.length-1;n++){var r=e[n].distance(e[n+1]);r<t&&(t=r)}return t};dr.prototype.interfaces_=function(){return[]};dr.prototype.getClass=function(){return dr};dr.snap=function(e,t,n){var r=new Array(2).fill(null),a=new dr(e);r[0]=a.snapTo(t,n);var u=new dr(t);return r[1]=u.snapTo(r[0],n),r};dr.computeOverlaySnapTolerance=function(){if(arguments.length===1){var e=arguments[0],t=dr.computeSizeBasedSnapTolerance(e),n=e.getPrecisionModel();if(n.getType()===En.FIXED){var r=1/n.getScale()*2/1.415;r>t&&(t=r)}return t}else if(arguments.length===2){var a=arguments[0],u=arguments[1];return Math.min(dr.computeOverlaySnapTolerance(a),dr.computeOverlaySnapTolerance(u))}};dr.computeSizeBasedSnapTolerance=function(e){var t=e.getEnvelopeInternal(),n=Math.min(t.getHeight(),t.getWidth()),r=n*dr.SNAP_PRECISION_FACTOR;return r};dr.snapToSelf=function(e,t,n){var r=new dr(e);return r.snapToSelf(t,n)};C2.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(dr,C2);var T2=function(e){function t(n,r,a){e.call(this),this._snapTolerance=n||null,this._snapPts=r||null,this._isSelfSnap=a!==void 0?a:!1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.snapLine=function(n,r){var a=new pa(n,this._snapTolerance);return a.setAllowSnappingToSourceVertices(this._isSelfSnap),a.snapTo(r)},t.prototype.transformCoordinates=function(n,r){var a=n.toCoordinateArray(),u=this.snapLine(a,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(u)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Bi),xi=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};xi.prototype.getCommon=function(){return De.longBitsToDouble(this._commonBits)};xi.prototype.add=function(e){var t=De.doubleToLongBits(e);if(this._isFirst)return this._commonBits=t,this._commonSignExp=xi.signExpBits(this._commonBits),this._isFirst=!1,null;var n=xi.signExpBits(t);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=xi.numCommonMostSigMantissaBits(this._commonBits,t),this._commonBits=xi.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};xi.prototype.toString=function(){if(arguments.length===1){var e=arguments[0],t=De.longBitsToDouble(e),n=De.toBinaryString(e),r="0000000000000000000000000000000000000000000000000000000000000000"+n,a=r.substring(r.length-64),u=a.substring(0,1)+"  "+a.substring(1,12)+"(exp) "+a.substring(12)+" [ "+t+" ]";return u}};xi.prototype.interfaces_=function(){return[]};xi.prototype.getClass=function(){return xi};xi.getBit=function(e,t){var n=1<<t;return e&n?1:0};xi.signExpBits=function(e){return e>>52};xi.zeroLowerBits=function(e,t){var n=(1<<t)-1,r=~n,a=e&r;return a};xi.numCommonMostSigMantissaBits=function(e,t){for(var n=0,r=52;r>=0;r--){if(xi.getBit(e,r)!==xi.getBit(t,r))return n;n++}return 52};var Il=function(){this._commonCoord=null,this._ccFilter=new ic},g0={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Il.prototype.addCommonBits=function(e){var t=new El(this._commonCoord);e.apply(t),e.geometryChanged()};Il.prototype.removeCommonBits=function(e){if(this._commonCoord.x===0&&this._commonCoord.y===0)return e;var t=new bt(this._commonCoord);t.x=-t.x,t.y=-t.y;var n=new El(t);return e.apply(n),e.geometryChanged(),e};Il.prototype.getCommonCoordinate=function(){return this._commonCoord};Il.prototype.add=function(e){e.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Il.prototype.interfaces_=function(){return[]};Il.prototype.getClass=function(){return Il};g0.CommonCoordinateFilter.get=function(){return ic};g0.Translater.get=function(){return El};Object.defineProperties(Il,g0);var ic=function(){this._commonBitsX=new xi,this._commonBitsY=new xi};ic.prototype.filter=function(e){this._commonBitsX.add(e.x),this._commonBitsY.add(e.y)};ic.prototype.getCommonCoordinate=function(){return new bt(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};ic.prototype.interfaces_=function(){return[sa]};ic.prototype.getClass=function(){return ic};var El=function(){this.trans=null;var e=arguments[0];this.trans=e};El.prototype.filter=function(e,t){var n=e.getOrdinate(t,0)+this.trans.x,r=e.getOrdinate(t,1)+this.trans.y;e.setOrdinate(t,0,n),e.setOrdinate(t,1,r)};El.prototype.isDone=function(){return!1};El.prototype.isGeometryChanged=function(){return!0};El.prototype.interfaces_=function(){return[is]};El.prototype.getClass=function(){return El};var Qr=function(e,t){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=e,this._geom[1]=t,this.computeSnapTolerance()};Qr.prototype.selfSnap=function(e){var t=new dr(e),n=t.snapTo(e,this._snapTolerance);return n};Qr.prototype.removeCommonBits=function(e){this._cbr=new Il,this._cbr.add(e[0]),this._cbr.add(e[1]);var t=new Array(2).fill(null);return t[0]=this._cbr.removeCommonBits(e[0].copy()),t[1]=this._cbr.removeCommonBits(e[1].copy()),t};Qr.prototype.prepareResult=function(e){return this._cbr.addCommonBits(e),e};Qr.prototype.getResultGeometry=function(e){var t=this.snap(this._geom),n=Ne.overlayOp(t[0],t[1],e);return this.prepareResult(n)};Qr.prototype.checkValid=function(e){e.isValid()||ri.out.println("Snapped geometry is invalid")};Qr.prototype.computeSnapTolerance=function(){this._snapTolerance=dr.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};Qr.prototype.snap=function(e){var t=this.removeCommonBits(e),n=dr.snap(t[0],t[1],this._snapTolerance);return n};Qr.prototype.interfaces_=function(){return[]};Qr.prototype.getClass=function(){return Qr};Qr.overlayOp=function(e,t,n){var r=new Qr(e,t);return r.getResultGeometry(n)};Qr.union=function(e,t){return Qr.overlayOp(e,t,Ne.UNION)};Qr.intersection=function(e,t){return Qr.overlayOp(e,t,Ne.INTERSECTION)};Qr.symDifference=function(e,t){return Qr.overlayOp(e,t,Ne.SYMDIFFERENCE)};Qr.difference=function(e,t){return Qr.overlayOp(e,t,Ne.DIFFERENCE)};var Ti=function(e,t){this._geom=new Array(2).fill(null),this._geom[0]=e,this._geom[1]=t};Ti.prototype.getResultGeometry=function(e){var t=null,n=!1,r=null;try{t=Ne.overlayOp(this._geom[0],this._geom[1],e);var a=!0;a&&(n=!0)}catch(u){if(u instanceof Oa)r=u;else throw u}finally{}if(!n)try{t=Qr.overlayOp(this._geom[0],this._geom[1],e)}catch(u){throw u instanceof Oa?r:u}finally{}return t};Ti.prototype.interfaces_=function(){return[]};Ti.prototype.getClass=function(){return Ti};Ti.overlayOp=function(e,t,n){var r=new Ti(e,t);return r.getResultGeometry(n)};Ti.union=function(e,t){return Ti.overlayOp(e,t,Ne.UNION)};Ti.intersection=function(e,t){return Ti.overlayOp(e,t,Ne.INTERSECTION)};Ti.symDifference=function(e,t){return Ti.overlayOp(e,t,Ne.SYMDIFFERENCE)};Ti.difference=function(e,t){return Ti.overlayOp(e,t,Ne.DIFFERENCE)};var Gf=function(){this.mce=null,this.chainIndex=null;var e=arguments[0],t=arguments[1];this.mce=e,this.chainIndex=t};Gf.prototype.computeIntersections=function(e,t){this.mce.computeIntersectsForChain(this.chainIndex,e.mce,e.chainIndex,t)};Gf.prototype.interfaces_=function(){return[]};Gf.prototype.getClass=function(){return Gf};var ao=function e(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var t=arguments[0],n=arguments[1];this._eventType=e.DELETE,this._xValue=t,this._insertEvent=n}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];this._eventType=e.INSERT,this._label=r,this._xValue=a,this._obj=u}},y0={INSERT:{configurable:!0},DELETE:{configurable:!0}};ao.prototype.isDelete=function(){return this._eventType===ao.DELETE};ao.prototype.setDeleteEventIndex=function(e){this._deleteEventIndex=e};ao.prototype.getObject=function(){return this._obj};ao.prototype.compareTo=function(e){var t=e;return this._xValue<t._xValue?-1:this._xValue>t._xValue?1:this._eventType<t._eventType?-1:this._eventType>t._eventType?1:0};ao.prototype.getInsertEvent=function(){return this._insertEvent};ao.prototype.isInsert=function(){return this._eventType===ao.INSERT};ao.prototype.isSameLabel=function(e){return this._label===null?!1:this._label===e._label};ao.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};ao.prototype.interfaces_=function(){return[Uo]};ao.prototype.getClass=function(){return ao};y0.INSERT.get=function(){return 1};y0.DELETE.get=function(){return 2};Object.defineProperties(ao,y0);var Ym=function(){};Ym.prototype.interfaces_=function(){return[]};Ym.prototype.getClass=function(){return Ym};var si=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var e=arguments[0],t=arguments[1],n=arguments[2];this._li=e,this._includeProper=t,this._recordIsolated=n};si.prototype.isTrivialIntersection=function(e,t,n,r){if(e===n&&this._li.getIntersectionNum()===1){if(si.isAdjacentSegments(t,r))return!0;if(e.isClosed()){var a=e.getNumPoints()-1;if(t===0&&r===a||r===0&&t===a)return!0}}return!1};si.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};si.prototype.setIsDoneIfProperInt=function(e){this._isDoneWhenProperInt=e};si.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};si.prototype.isBoundaryPointInternal=function(e,t){for(var n=t.iterator();n.hasNext();){var r=n.next(),a=r.getCoordinate();if(e.isIntersection(a))return!0}return!1};si.prototype.hasProperIntersection=function(){return this._hasProper};si.prototype.hasIntersection=function(){return this._hasIntersection};si.prototype.isDone=function(){return this._isDone};si.prototype.isBoundaryPoint=function(e,t){return t===null?!1:!!(this.isBoundaryPointInternal(e,t[0])||this.isBoundaryPointInternal(e,t[1]))};si.prototype.setBoundaryNodes=function(e,t){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=e,this._bdyNodes[1]=t};si.prototype.addIntersections=function(e,t,n,r){if(e===n&&t===r)return null;this.numTests++;var a=e.getCoordinates()[t],u=e.getCoordinates()[t+1],p=n.getCoordinates()[r],c=n.getCoordinates()[r+1];this._li.computeIntersection(a,u,p,c),this._li.hasIntersection()&&(this._recordIsolated&&(e.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(e,t,n,r)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(e.addIntersections(this._li,t,0),n.addIntersections(this._li,r,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};si.prototype.interfaces_=function(){return[]};si.prototype.getClass=function(){return si};si.isAdjacentSegments=function(e,t){return Math.abs(e-t)===1};var CM=function(e){function t(){e.call(this),this.events=new Qt,this.nOverlaps=null}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.prepareEvents=function(){var n=this;ss.sort(this.events);for(var r=0;r<this.events.size();r++){var a=n.events.get(r);a.isDelete()&&a.getInsertEvent().setDeleteEventIndex(r)}},t.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var r=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var a=0;a<this.events.size();a++){var u=n.events.get(a);if(u.isInsert()&&n.processOverlaps(a,u.getDeleteEventIndex(),u,r),r.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof si&&Le(arguments[0],ns)&&Le(arguments[1],ns)){var p=arguments[0],c=arguments[1],b=arguments[2];this.addEdges(p,p),this.addEdges(c,c),this.computeIntersections(b)}else if(typeof arguments[2]=="boolean"&&Le(arguments[0],ns)&&arguments[1]instanceof si){var C=arguments[0],A=arguments[1],P=arguments[2];P?this.addEdges(C,null):this.addEdges(C),this.computeIntersections(A)}}},t.prototype.addEdge=function(n,r){for(var a=this,u=n.getMonotoneChainEdge(),p=u.getStartIndexes(),c=0;c<p.length-1;c++){var b=new Gf(u,c),C=new ao(r,u.getMinX(c),b);a.events.add(C),a.events.add(new ao(u.getMaxX(c),C))}},t.prototype.processOverlaps=function(n,r,a,u){for(var p=this,c=a.getObject(),b=n;b<r;b++){var C=p.events.get(b);if(C.isInsert()){var A=C.getObject();a.isSameLabel(C)||(c.computeIntersections(A,u),p.nOverlaps++)}}},t.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var r=arguments[0],a=r.iterator();a.hasNext();){var u=a.next();n.addEdge(u,u)}else if(arguments.length===2)for(var p=arguments[0],c=arguments[1],b=p.iterator();b.hasNext();){var C=b.next();n.addEdge(C,c)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ym),fa=function(){this._min=De.POSITIVE_INFINITY,this._max=De.NEGATIVE_INFINITY},L2={NodeComparator:{configurable:!0}};fa.prototype.getMin=function(){return this._min};fa.prototype.intersects=function(e,t){return!(this._min>t||this._max<e)};fa.prototype.getMax=function(){return this._max};fa.prototype.toString=function(){return rs.toLineString(new bt(this._min,0),new bt(this._max,0))};fa.prototype.interfaces_=function(){return[]};fa.prototype.getClass=function(){return fa};L2.NodeComparator.get=function(){return qf};Object.defineProperties(fa,L2);var qf=function(){};qf.prototype.compare=function(e,t){var n=e,r=t,a=(n._min+n._max)/2,u=(r._min+r._max)/2;return a<u?-1:a>u?1:0};qf.prototype.interfaces_=function(){return[Dh]};qf.prototype.getClass=function(){return qf};var TM=function(e){function t(){e.call(this),this._item=null;var n=arguments[0],r=arguments[1],a=arguments[2];this._min=n,this._max=r,this._item=a}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.query=function(n,r,a){if(!this.intersects(n,r))return null;a.visitItem(this._item)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fa),LM=function(e){function t(){e.call(this),this._node1=null,this._node2=null;var n=arguments[0],r=arguments[1];this._node1=n,this._node2=r,this.buildExtent(this._node1,this._node2)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.buildExtent=function(n,r){this._min=Math.min(n._min,r._min),this._max=Math.max(n._max,r._max)},t.prototype.query=function(n,r,a){if(!this.intersects(n,r))return null;this._node1!==null&&this._node1.query(n,r,a),this._node2!==null&&this._node2.query(n,r,a)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fa),da=function(){this._leaves=new Qt,this._root=null,this._level=0};da.prototype.buildTree=function(){var e=this;ss.sort(this._leaves,new fa.NodeComparator);for(var t=this._leaves,n=null,r=new Qt;;){if(e.buildLevel(t,r),r.size()===1)return r.get(0);n=t,t=r,r=n}};da.prototype.insert=function(e,t,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new TM(e,t,n))};da.prototype.query=function(e,t,n){this.init(),this._root.query(e,t,n)};da.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};da.prototype.printNode=function(e){ri.out.println(rs.toLineString(new bt(e._min,this._level),new bt(e._max,this._level)))};da.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};da.prototype.buildLevel=function(e,t){this._level++,t.clear();for(var n=0;n<e.size();n+=2){var r=e.get(n),a=n+1<e.size()?e.get(n):null;if(a===null)t.add(r);else{var u=new LM(e.get(n),e.get(n+1));t.add(u)}}};da.prototype.interfaces_=function(){return[]};da.prototype.getClass=function(){return da};var Wh=function(){this._items=new Qt};Wh.prototype.visitItem=function(e){this._items.add(e)};Wh.prototype.getItems=function(){return this._items};Wh.prototype.interfaces_=function(){return[_l]};Wh.prototype.getClass=function(){return Wh};var Zh=function(){this._index=null;var e=arguments[0];if(!Le(e,yl))throw new Hn("Argument must be Polygonal");this._index=new cu(e)},_0={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};Zh.prototype.locate=function(e){var t=new Ps(e),n=new Hh(t);return this._index.query(e.y,e.y,n),t.getLocation()};Zh.prototype.interfaces_=function(){return[qh]};Zh.prototype.getClass=function(){return Zh};_0.SegmentVisitor.get=function(){return Hh};_0.IntervalIndexedGeometry.get=function(){return cu};Object.defineProperties(Zh,_0);var Hh=function(){this._counter=null;var e=arguments[0];this._counter=e};Hh.prototype.visitItem=function(e){var t=e;this._counter.countSegment(t.getCoordinate(0),t.getCoordinate(1))};Hh.prototype.interfaces_=function(){return[_l]};Hh.prototype.getClass=function(){return Hh};var cu=function(){this._index=new da;var e=arguments[0];this.init(e)};cu.prototype.init=function(e){for(var t=this,n=ei.getLines(e),r=n.iterator();r.hasNext();){var a=r.next(),u=a.getCoordinates();t.addLine(u)}};cu.prototype.addLine=function(e){for(var t=this,n=1;n<e.length;n++){var r=new _e(e[n-1],e[n]),a=Math.min(r.p0.y,r.p1.y),u=Math.max(r.p0.y,r.p1.y);t._index.insert(a,u,r)}};cu.prototype.query=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Wh;return this._index.query(e,t,n),n.getItems()}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2];this._index.query(r,a,u)}};cu.prototype.interfaces_=function(){return[]};cu.prototype.getClass=function(){return cu};var pf=function(e){function t(){if(e.call(this),this._parentGeom=null,this._lineEdgeMap=new p2,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new ls,arguments.length===2){var n=arguments[0],r=arguments[1],a=Oo.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=r,this._boundaryNodeRule=a,r!==null&&this.add(r)}else if(arguments.length===3){var u=arguments[0],p=arguments[1],c=arguments[2];this._argIndex=u,this._parentGeom=p,this._boundaryNodeRule=c,p!==null&&this.add(p)}}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertBoundaryPoint=function(n,r){var a=this._nodes.addNode(r),u=a.getLabel(),p=1,c=St.NONE;c=u.getLocation(n,jt.ON),c===St.BOUNDARY&&p++;var b=t.determineBoundary(this._boundaryNodeRule,p);u.setLocation(n,b)},t.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],r=arguments[1];return this.computeSelfNodes(n,r,!1)}else if(arguments.length===3){var a=arguments[0],u=arguments[1],p=arguments[2],c=new si(a,!0,!1);c.setIsDoneIfProperInt(p);var b=this.createEdgeSetIntersector(),C=this._parentGeom instanceof aa||this._parentGeom instanceof Lr||this._parentGeom instanceof ra,A=u||!C;return b.computeIntersections(this._edges,c,A),this.addSelfIntersectionNodes(this._argIndex),c}},t.prototype.computeSplitEdges=function(n){for(var r=this._edges.iterator();r.hasNext();){var a=r.next();a.eiList.addSplitEdges(n)}},t.prototype.computeEdgeIntersections=function(n,r,a){var u=new si(r,a,!0);u.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var p=this.createEdgeSetIntersector();return p.computeIntersections(this._edges,n._edges,u),u},t.prototype.getGeometry=function(){return this._parentGeom},t.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},t.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},t.prototype.addPoint=function(){if(arguments[0]instanceof io){var n=arguments[0],r=n.getCoordinate();this.insertPoint(this._argIndex,r,St.INTERIOR)}else if(arguments[0]instanceof bt){var a=arguments[0];this.insertPoint(this._argIndex,a,St.INTERIOR)}},t.prototype.addPolygon=function(n){var r=this;this.addPolygonRing(n.getExteriorRing(),St.EXTERIOR,St.INTERIOR);for(var a=0;a<n.getNumInteriorRing();a++){var u=n.getInteriorRingN(a);r.addPolygonRing(u,St.INTERIOR,St.EXTERIOR)}},t.prototype.addEdge=function(n){this.insertEdge(n);var r=n.getCoordinates();this.insertPoint(this._argIndex,r[0],St.BOUNDARY),this.insertPoint(this._argIndex,r[r.length-1],St.BOUNDARY)},t.prototype.addLineString=function(n){var r=Qe.removeRepeatedPoints(n.getCoordinates());if(r.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=r[0],null;var a=new Xm(r,new Cn(this._argIndex,St.INTERIOR));this._lineEdgeMap.put(n,a),this.insertEdge(a),Ve.isTrue(r.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,r[0]),this.insertBoundaryPoint(this._argIndex,r[r.length-1])},t.prototype.getInvalidPoint=function(){return this._invalidPoint},t.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),r=new Array(n.size()).fill(null),a=0,u=n.iterator();u.hasNext();){var p=u.next();r[a++]=p.getCoordinate().copy()}return r},t.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},t.prototype.addSelfIntersectionNode=function(n,r,a){if(this.isBoundaryNode(n,r))return null;a===St.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,r):this.insertPoint(n,r,a)},t.prototype.addPolygonRing=function(n,r,a){if(n.isEmpty())return null;var u=Qe.removeRepeatedPoints(n.getCoordinates());if(u.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=u[0],null;var p=r,c=a;se.isCCW(u)&&(p=a,c=r);var b=new Xm(u,new Cn(this._argIndex,St.BOUNDARY,p,c));this._lineEdgeMap.put(n,b),this.insertEdge(b),this.insertPoint(this._argIndex,u[0],St.BOUNDARY)},t.prototype.insertPoint=function(n,r,a){var u=this._nodes.addNode(r),p=u.getLabel();p===null?u._label=new Cn(n,a):p.setLocation(n,a)},t.prototype.createEdgeSetIntersector=function(){return new CM},t.prototype.addSelfIntersectionNodes=function(n){for(var r=this,a=this._edges.iterator();a.hasNext();)for(var u=a.next(),p=u.getLabel().getLocation(n),c=u.eiList.iterator();c.hasNext();){var b=c.next();r.addSelfIntersectionNode(n,b.coord,p)}},t.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof ra&&(this._useBoundaryDeterminationRule=!1),n instanceof Lr)this.addPolygon(n);else if(n instanceof ar)this.addLineString(n);else if(n instanceof io)this.addPoint(n);else if(n instanceof Bh)this.addCollection(n);else if(n instanceof ru)this.addCollection(n);else if(n instanceof ra)this.addCollection(n);else if(n instanceof Ii)this.addCollection(n);else throw new Error(n.getClass().getName())}else return e.prototype.add.apply(this,arguments)},t.prototype.addCollection=function(n){for(var r=this,a=0;a<n.getNumGeometries();a++){var u=n.getGeometryN(a);r.add(u)}},t.prototype.locate=function(n){return Le(this._parentGeom,yl)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new Zh(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},t.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return e.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(n,r){return n.isInBoundary(r)?St.BOUNDARY:St.INTERIOR},t}(er),Xh=function(){if(this._li=new du,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var e=arguments[0];this.setComputationPrecision(e.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new pf(0,e)}else if(arguments.length===2){var t=arguments[0],n=arguments[1],r=Oo.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new pf(0,t,r),this._arg[1]=new pf(1,n,r)}else if(arguments.length===3){var a=arguments[0],u=arguments[1],p=arguments[2];a.getPrecisionModel().compareTo(u.getPrecisionModel())>=0?this.setComputationPrecision(a.getPrecisionModel()):this.setComputationPrecision(u.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new pf(0,a,p),this._arg[1]=new pf(1,u,p)}};Xh.prototype.getArgGeometry=function(e){return this._arg[e].getGeometry()};Xh.prototype.setComputationPrecision=function(e){this._resultPrecisionModel=e,this._li.setPrecisionModel(this._resultPrecisionModel)};Xh.prototype.interfaces_=function(){return[]};Xh.prototype.getClass=function(){return Xh};var eu=function(){};eu.prototype.interfaces_=function(){return[]};eu.prototype.getClass=function(){return eu};eu.map=function(){if(arguments[0]instanceof Te&&Le(arguments[1],eu.MapOp)){for(var e=arguments[0],t=arguments[1],n=new Qt,r=0;r<e.getNumGeometries();r++){var a=t.map(e.getGeometryN(r));a!==null&&n.add(a)}return e.getFactory().buildGeometry(n)}else if(Le(arguments[0],Cr)&&Le(arguments[1],eu.MapOp)){for(var u=arguments[0],p=arguments[1],c=new Qt,b=u.iterator();b.hasNext();){var C=b.next(),A=p.map(C);A!==null&&c.add(A)}return c}};eu.MapOp=function(){};var Ne=function(e){function t(){var n=arguments[0],r=arguments[1];e.call(this,n,r),this._ptLocator=new ls,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new as,this._resultPolyList=new Qt,this._resultLineList=new Qt,this._resultPointList=new Qt,this._graph=new er(new v2),this._geomFact=n.getFactory()}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.insertUniqueEdge=function(n){var r=this._edgeList.findEqualEdge(n);if(r!==null){var a=r.getLabel(),u=n.getLabel();r.isPointwiseEqual(n)||(u=new Cn(n.getLabel()),u.flip());var p=r.getDepth();p.isNull()&&p.add(a),p.add(u),a.merge(u)}else this._edgeList.add(n)},t.prototype.getGraph=function(){return this._graph},t.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var r=n.next(),a=r.getSym();r.isInResult()&&a.isInResult()&&(r.setInResult(!1),a.setInResult(!1))}},t.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},t.prototype.computeGeometry=function(n,r,a,u){var p=new Qt;return p.addAll(n),p.addAll(r),p.addAll(a),p.isEmpty()?t.createEmptyResult(u,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(p)},t.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next();r.getEdges().mergeSymLabels()}},t.prototype.isCovered=function(n,r){for(var a=this,u=r.iterator();u.hasNext();){var p=u.next(),c=a._ptLocator.locate(n,p);if(c!==St.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var n=new Qt,r=this._edgeList.iterator();r.hasNext();){var a=r.next();a.isCollapsed()&&(r.remove(),n.add(a.getCollapsedEdge()))}this._edgeList.addAll(n)},t.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var r=n.next(),a=r.getEdges().getLabel();r.getLabel().merge(a)}},t.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},t.prototype.insertUniqueEdges=function(n){for(var r=this,a=n.iterator();a.hasNext();){var u=a.next();r.insertUniqueEdge(u)}},t.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var r=new Qt;this._arg[0].computeSplitEdges(r),this._arg[1].computeSplitEdges(r),this.insertUniqueEdges(r),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),uu.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var a=new oo(this._geomFact);a.add(this._graph),this._resultPolyList=a.getPolygons();var u=new Vs(this,this._geomFact,this._ptLocator);this._resultLineList=u.build(n);var p=new rc(this,this._geomFact,this._ptLocator);this._resultPointList=p.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},t.prototype.labelIncompleteNode=function(n,r){var a=this._ptLocator.locate(n.getCoordinate(),this._arg[r].getGeometry());n.getLabel().setLocation(r,a)},t.prototype.copyPoints=function(n){for(var r=this,a=this._arg[n].getNodeIterator();a.hasNext();){var u=a.next(),p=r._graph.addNode(u.getCoordinate());p.setLabel(n,u.getLabel().getLocation(n))}},t.prototype.findResultAreaEdges=function(n){for(var r=this._graph.getEdgeEnds().iterator();r.hasNext();){var a=r.next(),u=a.getLabel();u.isArea()&&!a.isInteriorAreaEdge()&&t.isResultOfOp(u.getLocation(0,jt.RIGHT),u.getLocation(1,jt.RIGHT),n)&&a.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var r=n.next(),a=r.getLabel(),u=r.getDepth();if(!u.isNull()){u.normalize();for(var p=0;p<2;p++)!a.isNull(p)&&a.isArea()&&!u.isNull(p)&&(u.getDelta(p)===0?a.toLine(p):(Ve.isTrue(!u.isNull(p,jt.LEFT),"depth of LEFT side has not been initialized"),a.setLocation(p,jt.LEFT,u.getLocation(p,jt.LEFT)),Ve.isTrue(!u.isNull(p,jt.RIGHT),"depth of RIGHT side has not been initialized"),a.setLocation(p,jt.RIGHT,u.getLocation(p,jt.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var a=r.next();a.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var n=this,r=this._graph.getNodes().iterator();r.hasNext();){var a=r.next(),u=a.getLabel();a.isIsolated()&&(u.isNull(0)?n.labelIncompleteNode(a,0):n.labelIncompleteNode(a,1)),a.getEdges().updateLabelling(u)}},t.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Xh);Ne.overlayOp=function(e,t,n){var r=new Ne(e,t),a=r.getResultGeometry(n);return a};Ne.intersection=function(e,t){if(e.isEmpty()||t.isEmpty())return Ne.createEmptyResult(Ne.INTERSECTION,e,t,e.getFactory());if(e.isGeometryCollection()){var n=t;return nc.map(e,{interfaces_:function(){return[eu.MapOp]},map:function(r){return r.intersection(n)}})}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Ti.overlayOp(e,t,Ne.INTERSECTION)};Ne.symDifference=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return Ne.createEmptyResult(Ne.SYMDIFFERENCE,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Ti.overlayOp(e,t,Ne.SYMDIFFERENCE)};Ne.resultDimension=function(e,t,n){var r=t.getDimension(),a=n.getDimension(),u=-1;switch(e){case Ne.INTERSECTION:u=Math.min(r,a);break;case Ne.UNION:u=Math.max(r,a);break;case Ne.DIFFERENCE:u=r;break;case Ne.SYMDIFFERENCE:u=Math.max(r,a);break}return u};Ne.createEmptyResult=function(e,t,n,r){var a=null;switch(Ne.resultDimension(e,t,n)){case-1:a=r.createGeometryCollection(new Array(0).fill(null));break;case 0:a=r.createPoint();break;case 1:a=r.createLineString();break;case 2:a=r.createPolygon();break}return a};Ne.difference=function(e,t){return e.isEmpty()?Ne.createEmptyResult(Ne.DIFFERENCE,e,t,e.getFactory()):t.isEmpty()?e.copy():(e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Ti.overlayOp(e,t,Ne.DIFFERENCE))};Ne.isResultOfOp=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=e.getLocation(0),r=e.getLocation(1);return Ne.isResultOfOp(n,r,t)}else if(arguments.length===3){var a=arguments[0],u=arguments[1],p=arguments[2];switch(a===St.BOUNDARY&&(a=St.INTERIOR),u===St.BOUNDARY&&(u=St.INTERIOR),p){case Ne.INTERSECTION:return a===St.INTERIOR&&u===St.INTERIOR;case Ne.UNION:return a===St.INTERIOR||u===St.INTERIOR;case Ne.DIFFERENCE:return a===St.INTERIOR&&u!==St.INTERIOR;case Ne.SYMDIFFERENCE:return a===St.INTERIOR&&u!==St.INTERIOR||a!==St.INTERIOR&&u===St.INTERIOR}return!1}};Ne.INTERSECTION=1;Ne.UNION=2;Ne.DIFFERENCE=3;Ne.SYMDIFFERENCE=4;var gl=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new ls,this._seg=new _e;var e=arguments[0],t=arguments[1];this._g=e,this._boundaryDistanceTolerance=t,this._linework=this.extractLinework(e)};gl.prototype.isWithinToleranceOfBoundary=function(e){for(var t=this,n=0;n<this._linework.getNumGeometries();n++)for(var r=t._linework.getGeometryN(n),a=r.getCoordinateSequence(),u=0;u<a.size()-1;u++){a.getCoordinate(u,t._seg.p0),a.getCoordinate(u+1,t._seg.p1);var p=t._seg.distance(e);if(p<=t._boundaryDistanceTolerance)return!0}return!1};gl.prototype.getLocation=function(e){return this.isWithinToleranceOfBoundary(e)?St.BOUNDARY:this._ptLocator.locate(e,this._g)};gl.prototype.extractLinework=function(e){var t=new Yh;e.apply(t);var n=t.getLinework(),r=en.toLineStringArray(n);return e.getFactory().createMultiLineString(r)};gl.prototype.interfaces_=function(){return[]};gl.prototype.getClass=function(){return gl};var Yh=function(){this._linework=null,this._linework=new Qt};Yh.prototype.getLinework=function(){return this._linework};Yh.prototype.filter=function(e){var t=this;if(e instanceof Lr){var n=e;this._linework.add(n.getExteriorRing());for(var r=0;r<n.getNumInteriorRing();r++)t._linework.add(n.getInteriorRingN(r))}};Yh.prototype.interfaces_=function(){return[ks]};Yh.prototype.getClass=function(){return Yh};var hu=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var e=arguments[0];this._g=e};hu.prototype.extractPoints=function(e,t,n){for(var r=this,a=e.getCoordinates(),u=0;u<a.length-1;u++)r.computeOffsetPoints(a[u],a[u+1],t,n)};hu.prototype.setSidesToGenerate=function(e,t){this._doLeft=e,this._doRight=t};hu.prototype.getPoints=function(e){for(var t=this,n=new Qt,r=ei.getLines(this._g),a=r.iterator();a.hasNext();){var u=a.next();t.extractPoints(u,e,n)}return n};hu.prototype.computeOffsetPoints=function(e,t,n,r){var a=t.x-e.x,u=t.y-e.y,p=Math.sqrt(a*a+u*u),c=n*a/p,b=n*u/p,C=(t.x+e.x)/2,A=(t.y+e.y)/2;if(this._doLeft){var P=new bt(C-b,A+c);r.add(P)}if(this._doRight){var R=new bt(C+b,A-c);r.add(R)}};hu.prototype.interfaces_=function(){return[]};hu.prototype.getClass=function(){return hu};var Co=function e(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=e.TOLERANCE,this._testCoords=new Qt;var t=arguments[0],n=arguments[1],r=arguments[2];this._boundaryDistanceTolerance=e.computeBoundaryDistanceTolerance(t,n),this._geom=[t,n,r],this._locFinder=[new gl(this._geom[0],this._boundaryDistanceTolerance),new gl(this._geom[1],this._boundaryDistanceTolerance),new gl(this._geom[2],this._boundaryDistanceTolerance)]},P2={TOLERANCE:{configurable:!0}};Co.prototype.reportResult=function(e,t,n){ri.out.println("Overlay result invalid - A:"+St.toLocationSymbol(t[0])+" B:"+St.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+St.toLocationSymbol(t[2]))};Co.prototype.isValid=function(e){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var t=this.checkValid(e);return t};Co.prototype.checkValid=function(){var e=this;if(arguments.length===1){for(var t=arguments[0],n=0;n<this._testCoords.size();n++){var r=e._testCoords.get(n);if(!e.checkValid(t,r))return e._invalidLocation=r,!1}return!0}else if(arguments.length===2){var a=arguments[0],u=arguments[1];return this._location[0]=this._locFinder[0].getLocation(u),this._location[1]=this._locFinder[1].getLocation(u),this._location[2]=this._locFinder[2].getLocation(u),Co.hasLocation(this._location,St.BOUNDARY)?!0:this.isValidResult(a,this._location)}};Co.prototype.addTestPts=function(e){var t=new hu(e);this._testCoords.addAll(t.getPoints(5*this._boundaryDistanceTolerance))};Co.prototype.isValidResult=function(e,t){var n=Ne.isResultOfOp(t[0],t[1],e),r=t[2]===St.INTERIOR,a=!(n^r);return a||this.reportResult(e,t,n),a};Co.prototype.getInvalidLocation=function(){return this._invalidLocation};Co.prototype.interfaces_=function(){return[]};Co.prototype.getClass=function(){return Co};Co.hasLocation=function(e,t){for(var n=0;n<3;n++)if(e[n]===t)return!0;return!1};Co.computeBoundaryDistanceTolerance=function(e,t){return Math.min(dr.computeSizeBasedSnapTolerance(e),dr.computeSizeBasedSnapTolerance(t))};Co.isValid=function(e,t,n,r){var a=new Co(e,t,r);return a.isValid(n)};P2.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Co,P2);var vo=function e(t){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=e.extractFactory(t),this._inputGeoms=t};vo.prototype.extractElements=function(e,t){var n=this;if(e===null)return null;for(var r=0;r<e.getNumGeometries();r++){var a=e.getGeometryN(r);n._skipEmpty&&a.isEmpty()||t.add(a)}};vo.prototype.combine=function(){for(var e=this,t=new Qt,n=this._inputGeoms.iterator();n.hasNext();){var r=n.next();e.extractElements(r,t)}return t.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(t)};vo.prototype.interfaces_=function(){return[]};vo.prototype.getClass=function(){return vo};vo.combine=function(){if(arguments.length===1){var e=arguments[0],t=new vo(e);return t.combine()}else if(arguments.length===2){var n=arguments[0],r=arguments[1],a=new vo(vo.createList(n,r));return a.combine()}else if(arguments.length===3){var u=arguments[0],p=arguments[1],c=arguments[2],b=new vo(vo.createList(u,p,c));return b.combine()}};vo.extractFactory=function(e){return e.isEmpty()?null:e.iterator().next().getFactory()};vo.createList=function(){if(arguments.length===2){var e=arguments[0],t=arguments[1],n=new Qt;return n.add(e),n.add(t),n}else if(arguments.length===3){var r=arguments[0],a=arguments[1],u=arguments[2],p=new Qt;return p.add(r),p.add(a),p.add(u),p}};var vr=function(){this._inputPolys=null,this._geomFactory=null;var e=arguments[0];this._inputPolys=e,this._inputPolys===null&&(this._inputPolys=new Qt)},A2={STRTREE_NODE_CAPACITY:{configurable:!0}};vr.prototype.reduceToGeometries=function(e){for(var t=this,n=new Qt,r=e.iterator();r.hasNext();){var a=r.next(),u=null;Le(a,ns)?u=t.unionTree(a):a instanceof Te&&(u=a),n.add(u)}return n};vr.prototype.extractByEnvelope=function(e,t,n){for(var r=new Qt,a=0;a<t.getNumGeometries();a++){var u=t.getGeometryN(a);u.getEnvelopeInternal().intersects(e)?r.add(u):n.add(u)}return this._geomFactory.buildGeometry(r)};vr.prototype.unionOptimized=function(e,t){var n=e.getEnvelopeInternal(),r=t.getEnvelopeInternal();if(!n.intersects(r)){var a=vo.combine(e,t);return a}if(e.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(e,t);var u=n.intersection(r);return this.unionUsingEnvelopeIntersection(e,t,u)};vr.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var e=new m2(vr.STRTREE_NODE_CAPACITY),t=this._inputPolys.iterator();t.hasNext();){var n=t.next();e.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var r=e.itemsTree(),a=this.unionTree(r);return a};vr.prototype.binaryUnion=function(){if(arguments.length===1){var e=arguments[0];return this.binaryUnion(e,0,e.size())}else if(arguments.length===3){var t=arguments[0],n=arguments[1],r=arguments[2];if(r-n<=1){var a=vr.getGeometry(t,n);return this.unionSafe(a,null)}else{if(r-n===2)return this.unionSafe(vr.getGeometry(t,n),vr.getGeometry(t,n+1));var u=Math.trunc((r+n)/2),p=this.binaryUnion(t,n,u),c=this.binaryUnion(t,u,r);return this.unionSafe(p,c)}}};vr.prototype.repeatedUnion=function(e){for(var t=null,n=e.iterator();n.hasNext();){var r=n.next();t===null?t=r.copy():t=t.union(r)}return t};vr.prototype.unionSafe=function(e,t){return e===null&&t===null?null:e===null?t.copy():t===null?e.copy():this.unionOptimized(e,t)};vr.prototype.unionActual=function(e,t){return vr.restrictToPolygons(e.union(t))};vr.prototype.unionTree=function(e){var t=this.reduceToGeometries(e),n=this.binaryUnion(t);return n};vr.prototype.unionUsingEnvelopeIntersection=function(e,t,n){var r=new Qt,a=this.extractByEnvelope(n,e,r),u=this.extractByEnvelope(n,t,r),p=this.unionActual(a,u);r.add(p);var c=vo.combine(r);return c};vr.prototype.bufferUnion=function(){if(arguments.length===1){var e=arguments[0],t=e.get(0).getFactory(),n=t.buildGeometry(e),r=n.buffer(0);return r}else if(arguments.length===2){var a=arguments[0],u=arguments[1],p=a.getFactory(),c=p.createGeometryCollection([a,u]),b=c.buffer(0);return b}};vr.prototype.interfaces_=function(){return[]};vr.prototype.getClass=function(){return vr};vr.restrictToPolygons=function(e){if(Le(e,yl))return e;var t=Ra.getPolygons(e);return t.size()===1?t.get(0):e.getFactory().createMultiPolygon(en.toPolygonArray(t))};vr.getGeometry=function(e,t){return t>=e.size()?null:e.get(t)};vr.union=function(e){var t=new vr(e);return t.union()};A2.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(vr,A2);var Km=function(){};Km.prototype.interfaces_=function(){return[]};Km.prototype.getClass=function(){return Km};Km.union=function(e,t){if(e.isEmpty()||t.isEmpty()){if(e.isEmpty()&&t.isEmpty())return Ne.createEmptyResult(Ne.UNION,e,t,e.getFactory());if(e.isEmpty())return t.copy();if(t.isEmpty())return e.copy()}return e.checkNotGeometryCollection(e),e.checkNotGeometryCollection(t),Ti.overlayOp(e,t,Ne.UNION)};function mu(){return new Jm}function Jm(){this.reset()}Jm.prototype={constructor:Jm,reset:function(){this.s=this.t=0},add:function(e){Jx(mm,e,this.t),Jx(this,mm.s,this.s),this.s?this.t+=mm.t:this.s=mm.t},valueOf:function(){return this.s}};var mm=new Jm;function Jx(e,t,n){var r=e.s=t+n,a=r-t,u=r-a;e.t=t-u+(n-a)}var L_=Math.PI,Qx=L_*2;mu();mu();mu();function $x(e,t){return[e>L_?e-Qx:e<-L_?e+Qx:e,t]}$x.invert=$x;function M2(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function PM(e){return e.length===1&&(e=AM(e)),{left:function(t,n,r,a){for(r==null&&(r=0),a==null&&(a=t.length);r<a;){var u=r+a>>>1;e(t[u],n)<0?r=u+1:a=u}return r},right:function(t,n,r,a){for(r==null&&(r=0),a==null&&(a=t.length);r<a;){var u=r+a>>>1;e(t[u],n)>0?a=u:r=u+1}return r}}}function AM(e){return function(t,n){return M2(e(t),n)}}PM(M2);mu();mu();mu();mu();mu();function tb(){}tb.prototype={constructor:tb,point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function eb(e,t){return[e,t]}eb.invert=eb;const MM=[{verbatimCoordinates:"40.123, -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:"40.123° N 74.123° W",verbatimLatitude:"40.123° N",verbatimLongitude:"74.123° W"},{verbatimCoordinates:'40° 7´ 22.8" N 74° 7´ 22.8" W',verbatimLatitude:'40° 7´ 22.8" N',verbatimLongitude:'74° 7´ 22.8" W'},{verbatimCoordinates:"40° 7.38’ , -74° 7.38’",verbatimLatitude:"40° 7.38’",verbatimLongitude:"-74° 7.38’"},{verbatimCoordinates:"N40°7’22.8’’, W74°7’22.8’’",verbatimLatitude:"N40°7’22.8’’",verbatimLongitude:"W74°7’22.8’’"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:`40°7'22.8"N, 74°7'22.8"W`,verbatimLatitude:`40°7'22.8"N`,verbatimLongitude:`74°7'22.8"W`},{verbatimCoordinates:"40 7 22.8, -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"},{verbatimCoordinates:"40.123 -74.123",verbatimLatitude:"40.123",verbatimLongitude:"-74.123"},{verbatimCoordinates:"40.123°,-74.123°",verbatimLatitude:"40.123°",verbatimLongitude:"-74.123°"},{verbatimCoordinates:"40.123N74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"4007.38N7407.38W",verbatimLatitude:"4007.38N",verbatimLongitude:"7407.38W"},{verbatimCoordinates:'40°7’22.8"N, 74°7’22.8"W',verbatimLatitude:'40°7’22.8"N',verbatimLongitude:'74°7’22.8"W'},{verbatimCoordinates:"400722.8N740722.8W",verbatimLatitude:"400722.8N",verbatimLongitude:"740722.8W"},{verbatimCoordinates:"N 40 7.38 W 74 7.38",verbatimLatitude:"N 40 7.38",verbatimLongitude:"W 74 7.38"},{verbatimCoordinates:"40:7:22.8N 74:7:22.8W",verbatimLatitude:"40:7:22.8N",verbatimLongitude:"74:7:22.8W"},{verbatimCoordinates:"40:7:23N,74:7:23W",verbatimLatitude:"40:7:23N",verbatimLongitude:"74:7:23W",decimalLatitude:40.1230555555,decimalLongitude:-74.1230555555},{verbatimCoordinates:'40°7’23"N 74°7’23"W',verbatimLatitude:'40°7’23"N',verbatimLongitude:'74°7’23"W',decimalLatitude:40.1230555555,decimalLongitude:-74.12305555555555},{verbatimCoordinates:'40°7’23"S 74°7’23"E',verbatimLatitude:'40°7’23"S',verbatimLongitude:'74°7’23"E',decimalLatitude:-40.1230555555,decimalLongitude:74.12305555555555},{verbatimCoordinates:'40°7’23" -74°7’23"',verbatimLatitude:'40°7’23"',verbatimLongitude:'-74°7’23"',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:'40d 7’ 23" N 74d 7’ 23" W',verbatimLatitude:'40d 7’ 23" N',verbatimLongitude:'74d 7’ 23" W',decimalLatitude:40.1230555555,decimalLongitude:-74.123055555},{verbatimCoordinates:"40.123N 74.123W",verbatimLatitude:"40.123N",verbatimLongitude:"74.123W"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40° 7.38, -74° 7.38",verbatimLatitude:"40° 7.38",verbatimLongitude:"-74° 7.38"},{verbatimCoordinates:"40 7 22.8; -74 7 22.8",verbatimLatitude:"40 7 22.8",verbatimLongitude:"-74 7 22.8"}],DM={decimalLatitude:40.123,decimalLongitude:-74.123},kM=[{verbatimCoordinates:`50°4'17.698"south, 14°24'2.826"east`,verbatimLatitude:`50°4'17.698"south`,verbatimLongitude:`14°24'2.826"east`,decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"50d4m17.698S 14d24m2.826E",verbatimLatitude:"50d4m17.698S",verbatimLongitude:"14d24m2.826E",decimalLatitude:-50.07158277777778,decimalLongitude:14.400785},{verbatimCoordinates:"40:26:46N,79:56:55W",verbatimLatitude:"40:26:46N",verbatimLongitude:"79:56:55W",decimalLatitude:40.44611111111111,decimalLongitude:-79.9486111111111},{verbatimCoordinates:"40:26:46.302N 79:56:55.903W",verbatimLatitude:"40:26:46.302N",verbatimLongitude:"79:56:55.903W",decimalLatitude:40.446195,decimalLongitude:-79.94886194444445},{verbatimCoordinates:"40°26′47″N 79°58′36″W",verbatimLatitude:"40°26′47″N",verbatimLongitude:"79°58′36″W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40d 26′ 47″ N 79d 58′ 36″ W",verbatimLatitude:"40d 26′ 47″ N",verbatimLongitude:"79d 58′ 36″ W",decimalLatitude:40.44638888888889,decimalLongitude:-79.97666666666667},{verbatimCoordinates:"40.446195N 79.948862W",verbatimLatitude:"40.446195N",verbatimLongitude:"79.948862W",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40,446195° 79,948862°",verbatimLatitude:"40,446195°",verbatimLongitude:"79,948862°",decimalLatitude:40.446195,decimalLongitude:79.948862},{verbatimCoordinates:"40° 26.7717, -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.446195, -79.948862",verbatimLatitude:"40.446195",verbatimLongitude:"-79.948862",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"40.123256; -74.123256",verbatimLatitude:"40.123256",verbatimLongitude:"-74.123256",decimalLatitude:40.123256,decimalLongitude:-74.123256},{verbatimCoordinates:"18°24S 22°45E",verbatimLatitude:"18°24S",verbatimLongitude:"22°45E",decimalLatitude:-18.4,decimalLongitude:22.75}],RM=[{verbatimCoordinates:"10.432342S 10.6345345E",verbatimLatitude:"10.432342S",verbatimLongitude:"10.6345345E",decimalLatitude:-10.432342,decimalLongitude:10.6345345},{verbatimCoordinates:"10.00S 10.00E",verbatimLatitude:"10.00S",verbatimLongitude:"10.00E",decimalLatitude:-10,decimalLongitude:10},{verbatimCoordinates:"00.00S 01.00E",verbatimLatitude:"00.00S",verbatimLongitude:"01.00E",decimalLatitude:0,decimalLongitude:1},{verbatimCoordinates:"18.24S 22.45E",verbatimLatitude:"18.24S",verbatimLongitude:"22.45E",decimalLatitude:-18.4,decimalLongitude:22.75},{verbatimCoordinates:"27deg 15min 45.2sec S 18deg 32min 53.7sec E",verbatimLatitude:"27deg 15min 45.2sec S",verbatimLongitude:"18deg 32min 53.7sec E",decimalLatitude:-27.262555555555554,decimalLongitude:18.54825},{verbatimCoordinates:"-23.3245° S / 28.2344° E",verbatimLatitude:"-23.3245° S",verbatimLongitude:"28.2344° E",decimalLatitude:-23.3245,decimalLongitude:28.2344},{verbatimCoordinates:"40° 26.7717 -79° 56.93172",verbatimLatitude:"40° 26.7717",verbatimLongitude:"-79° 56.93172",decimalLatitude:40.446195,decimalLongitude:-79.948862},{verbatimCoordinates:"27.15.45S 18.32.53E",verbatimLatitude:"27.15.45S",verbatimLongitude:"18.32.53E",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"-27.15.45 18.32.53",verbatimLatitude:"-27.15.45",verbatimLongitude:"18.32.53",decimalLatitude:-27.2625,decimalLongitude:18.548055},{verbatimCoordinates:"27.15.45.2S 18.32.53.4E",verbatimLatitude:"27.15.45.2S",verbatimLongitude:"18.32.53.4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"27.15.45,2S 18.32.53,4E",verbatimLatitude:"27.15.45,2S",verbatimLongitude:"18.32.53,4E",decimalLatitude:-27.262556,decimalLongitude:18.548167},{verbatimCoordinates:"S23.43563 °  E22.45634 °",verbatimLatitude:"S23.43563 °",verbatimLongitude:"E22.45634 °",decimalLatitude:-23.43563,decimalLongitude:22.45634},{verbatimCoordinates:"27,71372° S 23,07771° E",verbatimLatitude:"27,71372° S",verbatimLongitude:"23,07771° E",decimalLatitude:-27.71372,decimalLongitude:23.07771},{verbatimCoordinates:"27.45.34 S 23.23.23 E",verbatimLatitude:"27.45.34 S",verbatimLongitude:"23.23.23 E",decimalLatitude:-27.759444,decimalLongitude:23.38972222},{verbatimCoordinates:"S 27.45.34 E 23.23.23",verbatimLatitude:"S 27.45.34",verbatimLongitude:"E 23.23.23",decimalLatitude:-27.759444,decimalLongitude:23.38972222}];function NM(){const e=[];return MM.forEach(t=>{t.decimalLatitude?e.push(t):e.push({...t,...DM})}),[...e,...kM,...RM]}const OM=NM();OM.map(e=>e.verbatimCoordinates);const zM=Symbol.for("svelte-maplibre");function FM(){return R_(zM)}function BM(e){return"layerType"in e&&e.layerType==="deckgl"}var oc=VM;function VM(e){var t,n,r;if(e){if(Array.isArray(e)){for(t=[],n=e.length,r=0;r<n;r++){var a=e[r];a!=null&&t.push(a)}return t}if(typeof e=="object"){t={};var u=Object.keys(e);for(n=u.length,r=0;r<n;r++){var p=u[r],c=e[p];c!=null&&(t[p]=c)}return t}}}var yh=v0;function v0(e,t){return e===t||e!==e&&t!==t?!0:typeof e!=typeof t||{}.toString.call(e)!={}.toString.call(t)||e!==Object(e)||!e?!1:Array.isArray(e)?nb(e,t):{}.toString.call(e)=="[object Set]"?nb(Array.from(e),Array.from(t)):{}.toString.call(e)=="[object Object]"?GM(e,t):UM(e,t)}function UM(e,t){return e.toString()===t.toString()}function nb(e,t){var n=e.length;if(n!=t.length)return!1;for(var r=0;r<n;r++)if(!v0(e[r],t[r]))return!1;return!0}function GM(e,t){var n=Object.keys(e),r=n.length;if(r!=Object.keys(t).length)return!1;for(var a=0;a<r;a++){var u=n[a];if(!(t.hasOwnProperty(u)&&v0(e[u],t[u])))return!1}return!0}const qM=e=>({features:e[0]&16,data:e[0]&16,map:e[0]&4,close:e[0]&1}),rb=e=>{var t;return{features:e[4],data:(t=e[4])==null?void 0:t[0],map:e[2],close:e[31]}};function ib(e){let t,n,r=(e[4]||e[3]instanceof ea.Marker)&&ob(e);return{c(){t=Ee("div"),r&&r.c()},m(a,u){ke(a,t,u),r&&r.m(t,null),e[32](t),n=!0},p(a,u){a[4]||a[3]instanceof ea.Marker?r?(r.p(a,u),u[0]&24&&Yt(r,1)):(r=ob(a),r.c(),Yt(r,1),r.m(t,null)):r&&(Bo(),ae(r,1,1,()=>{r=null}),Vo())},i(a){n||(Yt(r),n=!0)},o(a){ae(r),n=!1},d(a){a&&Me(t),r&&r.d(),e[32](null)}}}function ob(e){let t;const n=e[30].default,r=$i(n,e,e[29],rb);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u[0]&536870933)&&eo(r,n,a,a[29],t?to(n,a[29],u,qM):no(a[29]),rb)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function jM(e){let t,n,r=e[9].default&&ib(e);return{c(){r&&r.c(),t=Ua()},m(a,u){r&&r.m(a,u),ke(a,t,u),n=!0},p(a,u){a[9].default?r?(r.p(a,u),u[0]&512&&Yt(r,1)):(r=ib(a),r.c(),Yt(r,1),r.m(t.parentNode,t)):r&&(Bo(),ae(r,1,1,()=>{r=null}),Vo())},i(a){n||(Yt(r),n=!0)},o(a){ae(r),n=!1},d(a){a&&Me(t),r&&r.d(a)}}}function WM(e,t,n){let r,a,u,p,c,b,{$$slots:C={},$$scope:A}=t;const P=YI(C);let{closeButton:R=void 0}=t,{closeOnClickOutside:et=!0}=t,{closeOnClickInside:X=!1}=t,{closeOnMove:K=!1}=t,{openOn:ot="click"}=t,{openIfTopMost:gt=!0}=t,{focusAfterOpen:q=!0}=t,{anchor:W=void 0}=t,{offset:at=void 0}=t,{popupClass:dt=void 0}=t,{maxWidth:Pt=void 0}=t,{lngLat:Mt=void 0}=t,{html:Tt=void 0}=t,{open:Ut=!1}=t;const qt=eg(),{map:Q,popupTarget:Et,layerEvent:$t,layer:le,eventTopMost:Ye}=FM();Zn(e,Q,yt=>n(2,u=yt)),Zn(e,Et,yt=>n(3,c=yt)),Zn(e,$t,yt=>n(28,p=yt)),Zn(e,le,yt=>n(35,b=yt));const Ie=["click","dblclick","contextmenu"];let ue,je=!1,gn;function nn(){if(!ue)return;let yt=ue.getElement();!yt||yt===gn||(gn=yt,ot==="hover"&&(gn.style.pointerEvents="none"),gn.addEventListener("mouseenter",()=>{n(24,je=!0)},{passive:!0}),gn.addEventListener("mouseleave",()=>{n(24,je=!1)},{passive:!0}),gn.addEventListener("click",()=>{X&&n(0,Ut=!1)},{passive:!0}))}nE(()=>{if(u)return u.on("click",ve),u.on("contextmenu",ve),typeof c=="string"&&(u.on("click",c,dn),u.on("dblclick",c,dn),u.on("contextmenu",c,dn),u.on("mousemove",c,kn),u.on("mouseleave",c,Dn),u.on("touchstart",c,He),u.on("touchend",c,mn)),()=>{u!=null&&u.loaded()&&(ue==null||ue.remove(),u.off("click",ve),u.off("contextmenu",ve),c instanceof ea.Marker?c.getPopup()===ue&&c.setPopup(void 0):typeof c=="string"&&(u.off("click",c,dn),u.off("dblclick",c,dn),u.off("contextmenu",c,dn),u.off("mousemove",c,kn),u.off("mouseleave",c,Dn),u.off("touchstart",c,He),u.off("touchend",c,mn)))}});function Ze(yt){return gt?!("marker"in yt)&&!BM(yt)&&Ye(yt)!==b:!1}let pe=null,Re="normal";function dn(yt){yt.type===ot&&(Ze(yt)||("layerType"in yt?yt.layerType==="deckgl"?(n(10,Mt=yt.coordinate),n(4,pe=yt.object?[yt.object]:null)):(n(10,Mt=yt.lngLat),n(4,pe=yt.features??[])):(n(10,Mt=yt.lngLat),n(4,pe=yt.features??[])),setTimeout(()=>n(0,Ut=!0))))}let rn=null;function He(yt){rn=yt.point}function mn(yt){if(!rn||ot!=="hover")return;let Ce=rn.dist(yt.point);rn=null,Ce<3&&(n(10,Mt=yt.lngLat),n(4,pe=yt.features??[]),ue.isOpen()?n(25,Re="justOpened"):(n(25,Re="opening"),n(0,Ut=!0)))}function Dn(yt){ot!=="hover"||rn||Re!=="normal"||(n(0,Ut=!1),n(4,pe=null))}function kn(yt){if(!(ot!=="hover"||rn||Re!=="normal")){if(Ze(yt)){n(0,Ut=!1),n(4,pe=null);return}n(0,Ut=!0),n(4,pe=yt.features??[]),n(10,Mt=yt.lngLat)}}function ve(yt){if(Re==="justOpened"){n(25,Re="normal");return}if(!et)return;let Ce=[gn,c instanceof ea.Marker?c==null?void 0:c.getElement():null];Ut&&ue.isOpen()&&!Ce.some(Ke=>Ke==null?void 0:Ke.contains(yt.originalEvent.target))&&(yt.type==="contextmenu"&&ot==="contextmenu"||yt.type!=="contextmenu")&&n(0,Ut=!1)}oa(()=>{u&&(ue!=null&&ue.isOpen())&&ue.remove()});let yn;const Xn=()=>n(0,Ut=!1);function Y(yt){li[yt?"unshift":"push"](()=>{yn=yt,n(1,yn)})}return e.$$set=yt=>{"closeButton"in yt&&n(11,R=yt.closeButton),"closeOnClickOutside"in yt&&n(12,et=yt.closeOnClickOutside),"closeOnClickInside"in yt&&n(13,X=yt.closeOnClickInside),"closeOnMove"in yt&&n(14,K=yt.closeOnMove),"openOn"in yt&&n(15,ot=yt.openOn),"openIfTopMost"in yt&&n(16,gt=yt.openIfTopMost),"focusAfterOpen"in yt&&n(17,q=yt.focusAfterOpen),"anchor"in yt&&n(18,W=yt.anchor),"offset"in yt&&n(19,at=yt.offset),"popupClass"in yt&&n(20,dt=yt.popupClass),"maxWidth"in yt&&n(21,Pt=yt.maxWidth),"lngLat"in yt&&n(10,Mt=yt.lngLat),"html"in yt&&n(22,Tt=yt.html),"open"in yt&&n(0,Ut=yt.open),"$$scope"in yt&&n(29,A=yt.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&14336&&n(27,r=R??(!et&&!X)),e.$$.dirty[0]&146685952&&(ue||(n(23,ue=new ea.Popup({closeButton:r,closeOnClick:!1,closeOnMove:K,focusAfterOpen:q,maxWidth:Pt,className:dt,anchor:W,offset:at})),gn=ue.getElement(),ue.on("open",()=>{n(0,Ut=!0),nn(),qt("open",ue)}),ue.on("close",()=>{n(0,Ut=!1),qt("close",ue)}),ue.on("hover",()=>{qt("hover",ue)}))),e.$$.dirty[0]&8421384&&ue&&c instanceof ea.Marker&&(ot==="click"?c.setPopup(ue):c.getPopup()===ue&&c.setPopup(void 0)),e.$$.dirty[0]&268468224&&Ie.includes(ot)&&(p==null?void 0:p.type)===ot&&(dn(p),Ls($t,p=null,p)),e.$$.dirty[0]&268468224&&n(26,a=ot==="hover"&&((p==null?void 0:p.type)==="mousemove"||(p==null?void 0:p.type)==="mouseenter")),e.$$.dirty[0]&352354304&&ot==="hover"&&$t&&(a&&p&&(p.layerType==="deckgl"?(n(10,Mt=p.coordinate),n(4,pe=p.object?[p.object]:null)):(n(10,Mt=p.lngLat),n(4,pe=p.features??[]))),n(0,Ut=(a||je)??!1)),e.$$.dirty[0]&12582914&&(yn?ue.setDOMContent(yn):Tt&&ue.setHTML(Tt)),e.$$.dirty[0]&8389632&&Mt&&ue.setLngLat(Mt),e.$$.dirty[0]&41943045&&u){let yt=ue.isOpen();Ut&&!yt?(ue.addTo(u),Re==="opening"&&n(25,Re="justOpened")):!Ut&&yt&&ue.remove()}},[Ut,yn,u,c,pe,Q,Et,$t,le,P,Mt,R,et,X,K,ot,gt,q,W,at,dt,Pt,Tt,ue,je,Re,a,r,p,A,C,Xn,Y]}class ZM extends wr{constructor(t){super(),br(this,t,WM,jM,Gn,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}var nd=Uint8Array,D2=Uint16Array,HM=Int32Array,XM=new nd([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),YM=new nd([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),k2=function(e,t){for(var n=new D2(31),r=0;r<31;++r)n[r]=t+=1<<e[r-1];for(var a=new HM(n[30]),r=1;r<30;++r)for(var u=n[r];u<n[r+1];++u)a[u]=u-n[r]<<5|r;return{b:n,r:a}},R2=k2(XM,2),KM=R2.b,JM=R2.r;KM[28]=258,JM[258]=28;k2(YM,0);var QM=new D2(32768);for(Fn=0;Fn<32768;++Fn)ul=(Fn&43690)>>1|(Fn&21845)<<1,ul=(ul&52428)>>2|(ul&13107)<<2,ul=(ul&61680)>>4|(ul&3855)<<4,QM[Fn]=((ul&65280)>>8|(ul&255)<<8)>>1;var ul,Fn,_g=new nd(288);for(Fn=0;Fn<144;++Fn)_g[Fn]=8;var Fn;for(Fn=144;Fn<256;++Fn)_g[Fn]=9;var Fn;for(Fn=256;Fn<280;++Fn)_g[Fn]=7;var Fn;for(Fn=280;Fn<288;++Fn)_g[Fn]=8;var Fn,$M=new nd(32);for(Fn=0;Fn<32;++Fn)$M[Fn]=5;var Fn,t5=new nd(0),e5=typeof TextDecoder<"u"&&new TextDecoder,n5=0;try{e5.decode(t5,{stream:!0}),n5=1}catch{}const r5=e=>({props:e&8}),sb=e=>({props:s5(e[3])});function i5(e){let t;const n=e[1].default,r=$i(n,e,e[2],sb);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u&12)&&eo(r,n,a,a[2],t?to(n,a[2],u,r5):no(a[2]),sb)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function o5(e){let t,n;return t=new ZM({props:{openOn:e[0],$$slots:{default:[i5,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:e}}}),{c(){pn(t.$$.fragment)},m(r,a){sn(t,r,a),n=!0},p(r,[a]){const u={};a&1&&(u.openOn=r[0]),a&12&&(u.$$scope={dirty:a,ctx:r}),t.$set(u)},i(r){n||(Yt(t.$$.fragment,r),n=!0)},o(r){ae(t.$$.fragment,r),n=!1},d(r){an(t,r)}}}function s5(e){return e?e[0].properties??{}:(console.log("A Popup with null features should be impossible"),{})}function a5(e,t,n){let{$$slots:r={},$$scope:a}=t,{openOn:u="hover"}=t;return e.$$set=p=>{"openOn"in p&&n(0,u=p.openOn),"$$scope"in p&&n(2,a=p.$$scope)},[u,r,a]}class N2 extends wr{constructor(t){super(),br(this,t,a5,o5,Gn,{openOn:0})}}let l5=Date.now();function rd(e){return`${e}-${l5++}`}const x0=Symbol.for("svelte-maplibre");function id(){return R_(x0)}function u5(e){let t=new WeakMap;return n=>{var p;let r=t.get(n.originalEvent);if(r!==void 0)return r;let u=(p=n.target.queryRenderedFeatures(n.point).find(c=>{var b;return(b=e.get(c.layer.id))==null?void 0:b.interactive}))==null?void 0:p.layer.id;return t.set(n.originalEvent,u),u}}function c5(){let e=new Map;return k_(x0,{map:Ji(null),source:Ty(null),layer:Ty(null),popupTarget:Ty(null),cluster:Ji(),loadedImages:Ji(new Set),minzoom:Ji(0),maxzoom:Ji(24),layerEvent:Ji(null),layerInfo:e,eventTopMost:u5(e)})}function ab(e){return{subscribe:e.subscribe}}function O2({key:e,setPopupTarget:t=!1,setCluster:n=!1,setMouseEvent:r=!1}){let a=id(),u=Ji(null),p=ab(u),c={...a,[e]:ab(u)};if(t&&(c.popupTarget=p),r){let b=Ji(null);c.layerEvent=b,a.layerEvent=b}return n&&(c.cluster=Ji()),k_(x0,c),{...a,self:u}}function h5(){return O2({key:"source",setCluster:!0})}function p5(e=!0){return O2({key:"layer",setPopupTarget:e,setMouseEvent:e})}function lb(e){let t;return n=>{if(n)for(let r in n){let a=t==null?void 0:t[r],u=n[r];a!==u&&e(r,u,a)}else if(t)for(let r in t)e(r,void 0,t[r]);t=n}}function f5(e,...t){let n=[e];for(let r of t)if(r)Array.isArray(r)&&r[0]===e?n.push(...r.slice(1)):n.push(r);else continue;if(n.length!==1)return n.length===2?n[1]:n}function d5(e){return e===!0?["has","point_count"]:e===!1?["!",["has","point_count"]]:void 0}function b0(e,t){return["case",["boolean",["feature-state","hover"],!1],t,e]}function ub(e){let t=e[0],n,r,a=cb(e);return{c(){a.c(),n=Ua()},m(u,p){a.m(u,p),ke(u,n,p),r=!0},p(u,p){p[0]&1&&Gn(t,t=u[0])?(Bo(),ae(a,1,1,Yr),Vo(),a=cb(u),a.c(),Yt(a,1),a.m(n.parentNode,n)):a.p(u,p)},i(u){r||(Yt(a),r=!0)},o(u){ae(a),r=!1},d(u){u&&Me(n),a.d(u)}}}function cb(e){let t;const n=e[36].default,r=$i(n,e,e[35],null);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u[1]&16)&&eo(r,n,a,a[35],t?to(n,a[35],u,null):no(a[35]),null)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function m5(e){let t,n,r=e[0]&&ub(e);return{c(){r&&r.c(),t=Ua()},m(a,u){r&&r.m(a,u),ke(a,t,u),n=!0},p(a,u){a[0]?r?(r.p(a,u),u[0]&1&&Yt(r,1)):(r=ub(a),r.c(),Yt(r,1),r.m(t.parentNode,t)):r&&(Bo(),ae(r,1,1,()=>{r=null}),Vo())},i(a){n||(Yt(r),n=!0)},o(a){ae(r),n=!1},d(a){a&&Me(t),r&&r.d(a)}}}function g5(e,t,n){let r,a,u,p,c,b,C,A,P,R,et,X,{$$slots:K={},$$scope:ot}=t,{id:gt=rd("layer")}=t,{source:q=void 0}=t,{sourceLayer:W=void 0}=t,{beforeId:at=void 0}=t,{beforeLayerType:dt=void 0}=t,{type:Pt}=t,{paint:Mt=void 0}=t,{layout:Tt=void 0}=t,{filter:Ut=void 0}=t,{applyToClusters:qt=void 0}=t,{minzoom:Q=void 0}=t,{maxzoom:Et=void 0}=t,{manageHoverState:$t=!1}=t,{hovered:le=null}=t,{interactive:Ye=!0}=t,{hoverCursor:Ie=void 0}=t,{eventsIfTopMost:ue=!1}=t;const je=eg(),{map:gn,source:nn,self:Ze,minzoom:pe,maxzoom:Re,eventTopMost:dn,layerInfo:rn}=p5();Zn(e,gn,Y=>n(31,P=Y)),Zn(e,nn,Y=>n(32,R=Y)),Zn(e,Ze,Y=>n(0,A=Y)),Zn(e,pe,Y=>n(34,X=Y)),Zn(e,Re,Y=>n(33,et=Y)),oa(()=>{A&&P&&(rn.delete(A),P==null||P.removeLayer(A))});let He;function mn(Y){var Lt,nr;if(!Ye||!A||!P||ue&&dn(Y)!==A)return;let yt=Y.features??[],Ce=(nr=(Lt=yt[0])==null?void 0:Lt.properties)==null?void 0:nr.cluster_id,Ke={event:Y,map:P,clusterId:Ce,layer:A,source:c,features:yt};je(Y.type,Ke)}function Dn(Y){var Lt,nr;if(!Ye||!A||!P||ue&&dn(Y)!==A)return;Ie&&(P.getCanvas().style.cursor=Ie);let yt=Y.features??[];n(6,le=yt[0]??null);let Ce=(nr=(Lt=yt[0])==null?void 0:Lt.properties)==null?void 0:nr.cluster_id;je("mouseenter",{event:Y,map:P,clusterId:Ce,layer:A,source:c,features:yt})}function kn(Y){var Lt,nr,qo;if(!Ye||!P)return;if(ue&&dn(Y)!==A){n(6,le=null),$t&&He!==void 0&&(P==null||P.setFeatureState({source:c,sourceLayer:W,id:He},{hover:!1}),He=void 0);return}P.getCanvas().style.cursor=Ie;let yt=Y.features??[],Ce=(nr=(Lt=yt[0])==null?void 0:Lt.properties)==null?void 0:nr.cluster_id,Ke=(qo=yt[0])==null?void 0:qo.id;Ke!==He&&($t&&(He!==void 0&&(P==null||P.setFeatureState({source:c,id:He,sourceLayer:W},{hover:!1})),P==null||P.setFeatureState({source:c,id:Ke,sourceLayer:W},{hover:!0})),He=Ke,n(6,le=yt[0]??null)),je("mousemove",{event:Y,map:P,clusterId:Ce,layer:A,source:c,features:yt})}function ve(Y){if(!(!Ye||!A||!P)){if(Ie&&(P.getCanvas().style.cursor=""),n(6,le=null),$t&&He!==void 0){const yt={source:c,id:He,sourceLayer:W};P==null||P.setFeatureState(yt,{hover:!1}),He=void 0}je("mouseleave",{map:P,layer:A,source:c})}}let yn=!0;function Xn(Y){P&&(P.off("click",Y,mn),P.off("dblclick",Y,mn),P.off("contextmenu",Y,mn),P.off("mouseenter",Y,Dn),P.off("mousemove",Y,kn),P.off("mouseleave",Y,ve))}return oa(()=>{P&&A&&Xn(A)}),e.$$set=Y=>{"id"in Y&&n(7,gt=Y.id),"source"in Y&&n(8,q=Y.source),"sourceLayer"in Y&&n(9,W=Y.sourceLayer),"beforeId"in Y&&n(10,at=Y.beforeId),"beforeLayerType"in Y&&n(11,dt=Y.beforeLayerType),"type"in Y&&n(12,Pt=Y.type),"paint"in Y&&n(13,Mt=Y.paint),"layout"in Y&&n(14,Tt=Y.layout),"filter"in Y&&n(15,Ut=Y.filter),"applyToClusters"in Y&&n(16,qt=Y.applyToClusters),"minzoom"in Y&&n(17,Q=Y.minzoom),"maxzoom"in Y&&n(18,Et=Y.maxzoom),"manageHoverState"in Y&&n(19,$t=Y.manageHoverState),"hovered"in Y&&n(6,le=Y.hovered),"interactive"in Y&&n(20,Ye=Y.interactive),"hoverCursor"in Y&&n(21,Ie=Y.hoverCursor),"eventsIfTopMost"in Y&&n(22,ue=Y.eventsIfTopMost),"$$scope"in Y&&n(35,ot=Y.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&65536&&n(30,r=d5(qt)),e.$$.dirty[0]&1073774592&&n(24,a=f5("all",r,Ut)),e.$$.dirty[0]&131072|e.$$.dirty[1]&8&&n(26,u=Q??X),e.$$.dirty[0]&262144|e.$$.dirty[1]&4&&n(25,p=Et??et),e.$$.dirty[0]&256|e.$$.dirty[1]&2&&n(29,c=q||R),e.$$.dirty[0]&654343809|e.$$.dirty[1]&1&&P&&A!==gt&&c){A&&(Xn(A),rn.delete(A));let Y=at;if(!at&&dt){let yt=P.getStyle().layers,Ce=typeof dt=="function"?dt:Lt=>Lt.type===dt,Ke=yt==null?void 0:yt.find(Ce);Ke&&(Y=Ke.id)}Ls(Ze,A=gt,A),P.addLayer(oc({id:A,type:Pt,source:c,"source-layer":W,filter:a,paint:Mt,layout:Tt,minzoom:u,maxzoom:p}),Y),n(23,yn=!0),P.on("click",A,mn),P.on("dblclick",A,mn),P.on("contextmenu",A,mn),P.on("mouseenter",A,Dn),P.on("mousemove",A,kn),P.on("mouseleave",A,ve)}e.$$.dirty[0]&1048577&&A&&rn.set(A,{interactive:Ye}),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(28,b=A?lb((Y,yt)=>P==null?void 0:P.setPaintProperty(A,Y,yt)):void 0),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(27,C=A?lb((Y,yt)=>P==null?void 0:P.setLayoutProperty(A,Y,yt)):void 0),e.$$.dirty[0]&268443648&&(b==null||b(Mt)),e.$$.dirty[0]&134234112&&(C==null||C(Tt)),e.$$.dirty[0]&100663297|e.$$.dirty[1]&1&&A&&(P==null||P.setLayerZoomRange(A,u,p)),e.$$.dirty[0]&25165825|e.$$.dirty[1]&1&&A&&(yn?n(23,yn=!1):P==null||P.setFilter(A,a))},[A,gn,nn,Ze,pe,Re,le,gt,q,W,at,dt,Pt,Mt,Tt,Ut,qt,Q,Et,$t,Ye,Ie,ue,yn,a,p,u,C,b,c,r,P,R,et,X,ot,K]}let w0=class extends wr{constructor(t){super(),br(this,t,g5,m5,Gn,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}};function y5(e){let t;const n=e[16].default,r=$i(n,e,e[24],null);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u&16777216)&&eo(r,n,a,a[24],t?to(n,a[24],u,null):no(a[24]),null)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function _5(e){let t,n,r;function a(p){e[17](p)}let u={id:e[1],type:"circle",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],applyToClusters:e[9],minzoom:e[10],maxzoom:e[11],hoverCursor:e[12],manageHoverState:e[13],eventsIfTopMost:e[14],interactive:e[15],$$slots:{default:[y5]},$$scope:{ctx:e}};return e[0]!==void 0&&(u.hovered=e[0]),t=new w0({props:u}),li.push(()=>ts(t,"hovered",a)),t.$on("click",e[18]),t.$on("dblclick",e[19]),t.$on("contextmenu",e[20]),t.$on("mouseenter",e[21]),t.$on("mousemove",e[22]),t.$on("mouseleave",e[23]),{c(){pn(t.$$.fragment)},m(p,c){sn(t,p,c),r=!0},p(p,[c]){const b={};c&2&&(b.id=p[1]),c&4&&(b.source=p[2]),c&8&&(b.sourceLayer=p[3]),c&16&&(b.beforeId=p[4]),c&32&&(b.beforeLayerType=p[5]),c&64&&(b.paint=p[6]),c&128&&(b.layout=p[7]),c&256&&(b.filter=p[8]),c&512&&(b.applyToClusters=p[9]),c&1024&&(b.minzoom=p[10]),c&2048&&(b.maxzoom=p[11]),c&4096&&(b.hoverCursor=p[12]),c&8192&&(b.manageHoverState=p[13]),c&16384&&(b.eventsIfTopMost=p[14]),c&32768&&(b.interactive=p[15]),c&16777216&&(b.$$scope={dirty:c,ctx:p}),!n&&c&1&&(n=!0,b.hovered=p[0],$o(()=>n=!1)),t.$set(b)},i(p){r||(Yt(t.$$.fragment,p),r=!0)},o(p){ae(t.$$.fragment,p),r=!1},d(p){an(t,p)}}}function v5(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:u=rd("circle")}=t,{source:p=void 0}=t,{sourceLayer:c=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:R=void 0}=t,{applyToClusters:et=void 0}=t,{minzoom:X=void 0}=t,{maxzoom:K=void 0}=t,{hoverCursor:ot=void 0}=t,{manageHoverState:gt=!1}=t,{hovered:q=null}=t,{eventsIfTopMost:W=!1}=t,{interactive:at=!0}=t;function dt(Et){q=Et,n(0,q)}function Pt(Et){xn.call(this,e,Et)}function Mt(Et){xn.call(this,e,Et)}function Tt(Et){xn.call(this,e,Et)}function Ut(Et){xn.call(this,e,Et)}function qt(Et){xn.call(this,e,Et)}function Q(Et){xn.call(this,e,Et)}return e.$$set=Et=>{"id"in Et&&n(1,u=Et.id),"source"in Et&&n(2,p=Et.source),"sourceLayer"in Et&&n(3,c=Et.sourceLayer),"beforeId"in Et&&n(4,b=Et.beforeId),"beforeLayerType"in Et&&n(5,C=Et.beforeLayerType),"paint"in Et&&n(6,A=Et.paint),"layout"in Et&&n(7,P=Et.layout),"filter"in Et&&n(8,R=Et.filter),"applyToClusters"in Et&&n(9,et=Et.applyToClusters),"minzoom"in Et&&n(10,X=Et.minzoom),"maxzoom"in Et&&n(11,K=Et.maxzoom),"hoverCursor"in Et&&n(12,ot=Et.hoverCursor),"manageHoverState"in Et&&n(13,gt=Et.manageHoverState),"hovered"in Et&&n(0,q=Et.hovered),"eventsIfTopMost"in Et&&n(14,W=Et.eventsIfTopMost),"interactive"in Et&&n(15,at=Et.interactive),"$$scope"in Et&&n(24,a=Et.$$scope)},[q,u,p,c,b,C,A,P,R,et,X,K,ot,gt,W,at,r,dt,Pt,Mt,Tt,Ut,qt,Q,a]}let x5=class extends wr{constructor(t){super(),br(this,t,v5,_5,Gn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}};function b5(e){let t;const n=e[15].default,r=$i(n,e,e[23],null);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u&8388608)&&eo(r,n,a,a[23],t?to(n,a[23],u,null):no(a[23]),null)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function w5(e){let t,n,r;function a(p){e[16](p)}let u={id:e[1],type:"fill",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[b5]},$$scope:{ctx:e}};return e[0]!==void 0&&(u.hovered=e[0]),t=new w0({props:u}),li.push(()=>ts(t,"hovered",a)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){pn(t.$$.fragment)},m(p,c){sn(t,p,c),r=!0},p(p,[c]){const b={};c&2&&(b.id=p[1]),c&4&&(b.source=p[2]),c&8&&(b.sourceLayer=p[3]),c&16&&(b.beforeId=p[4]),c&32&&(b.beforeLayerType=p[5]),c&64&&(b.paint=p[6]),c&128&&(b.layout=p[7]),c&256&&(b.filter=p[8]),c&512&&(b.minzoom=p[9]),c&1024&&(b.maxzoom=p[10]),c&2048&&(b.hoverCursor=p[11]),c&4096&&(b.manageHoverState=p[12]),c&8192&&(b.eventsIfTopMost=p[13]),c&16384&&(b.interactive=p[14]),c&8388608&&(b.$$scope={dirty:c,ctx:p}),!n&&c&1&&(n=!0,b.hovered=p[0],$o(()=>n=!1)),t.$set(b)},i(p){r||(Yt(t.$$.fragment,p),r=!0)},o(p){ae(t.$$.fragment,p),r=!1},d(p){an(t,p)}}}function S5(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:u=rd("fill")}=t,{source:p=void 0}=t,{sourceLayer:c=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:R=void 0}=t,{minzoom:et=void 0}=t,{maxzoom:X=void 0}=t,{hoverCursor:K=void 0}=t,{manageHoverState:ot=!1}=t,{hovered:gt=null}=t,{eventsIfTopMost:q=!1}=t,{interactive:W=!0}=t;function at(Q){gt=Q,n(0,gt)}function dt(Q){xn.call(this,e,Q)}function Pt(Q){xn.call(this,e,Q)}function Mt(Q){xn.call(this,e,Q)}function Tt(Q){xn.call(this,e,Q)}function Ut(Q){xn.call(this,e,Q)}function qt(Q){xn.call(this,e,Q)}return e.$$set=Q=>{"id"in Q&&n(1,u=Q.id),"source"in Q&&n(2,p=Q.source),"sourceLayer"in Q&&n(3,c=Q.sourceLayer),"beforeId"in Q&&n(4,b=Q.beforeId),"beforeLayerType"in Q&&n(5,C=Q.beforeLayerType),"paint"in Q&&n(6,A=Q.paint),"layout"in Q&&n(7,P=Q.layout),"filter"in Q&&n(8,R=Q.filter),"minzoom"in Q&&n(9,et=Q.minzoom),"maxzoom"in Q&&n(10,X=Q.maxzoom),"hoverCursor"in Q&&n(11,K=Q.hoverCursor),"manageHoverState"in Q&&n(12,ot=Q.manageHoverState),"hovered"in Q&&n(0,gt=Q.hovered),"eventsIfTopMost"in Q&&n(13,q=Q.eventsIfTopMost),"interactive"in Q&&n(14,W=Q.interactive),"$$scope"in Q&&n(23,a=Q.$$scope)},[gt,u,p,c,b,C,A,P,R,et,X,K,ot,q,W,r,at,dt,Pt,Mt,Tt,Ut,qt,a]}let z2=class extends wr{constructor(t){super(),br(this,t,S5,w5,Gn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function I5(e,t,n){let r;const{map:a}=id();Zn(e,a,b=>n(4,r=b));let{position:u="top-left"}=t,{container:p=void 0}=t,c=null;return oa(()=>{r!=null&&r.loaded()&&c&&r.removeControl(c)}),e.$$set=b=>{"position"in b&&n(1,u=b.position),"container"in b&&n(2,p=b.container)},e.$$.update=()=>{if(e.$$.dirty&30&&r&&!c){let b;typeof p=="string"?b=document.querySelector(p)??void 0:b=p,n(3,c=new ea.FullscreenControl({container:b})),r.addControl(c,u)}},[a,u,p,c,r]}class E5 extends wr{constructor(t){super(),br(this,t,I5,null,Gn,{position:1,container:2})}}function C5(e,t,n,r,a){let u=!1;e.getSource(t)&&(u=!0,e.removeSource(t));const p=()=>{r(t)&&(e.addSource(t,n),a())};if(u){const c=()=>{t&&(e.getSource(t)?setTimeout(c,1):p())};c()}else p()}function T5(e,t,n){Vb().then(()=>{let r=D_(e);if(!r)return;r.getSource(t)===n&&r.removeSource(t)})}function hb(e){let t=e[0],n,r,a=pb(e);return{c(){a.c(),n=Ua()},m(u,p){a.m(u,p),ke(u,n,p),r=!0},p(u,p){p&1&&Gn(t,t=u[0])?(Bo(),ae(a,1,1,Yr),Vo(),a=pb(u),a.c(),Yt(a,1),a.m(n.parentNode,n)):a.p(u,p)},i(u){r||(Yt(a),r=!0)},o(u){ae(a),r=!1},d(u){u&&Me(n),a.d(u)}}}function pb(e){let t;const n=e[19].default,r=$i(n,e,e[18],null);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u&262144)&&eo(r,n,a,a[18],t?to(n,a[18],u,null):no(a[18]),null)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function L5(e){let t,n,r=e[0]&&hb(e);return{c(){r&&r.c(),t=Ua()},m(a,u){r&&r.m(a,u),ke(a,t,u),n=!0},p(a,[u]){a[0]?r?(r.p(a,u),u&1&&Yt(r,1)):(r=hb(a),r.c(),Yt(r,1),r.m(t.parentNode,t)):r&&(Bo(),ae(r,1,1,()=>{r=null}),Vo())},i(a){n||(Yt(r),n=!0)},o(a){ae(r),n=!1},d(a){a&&Me(t),r&&r.d(a)}}}function P5(e,t,n){let r,a,u,{$$slots:p={},$$scope:c}=t,{id:b=rd("geojson")}=t,{data:C}=t,{generateId:A=!1}=t,{promoteId:P=void 0}=t,{filter:R=void 0}=t,{lineMetrics:et=void 0}=t,{cluster:X=void 0}=t,{maxzoom:K=void 0}=t,{attribution:ot=void 0}=t,{buffer:gt=void 0}=t,{tolerance:q=void 0}=t;const{map:W,cluster:at,self:dt}=h5();Zn(e,W,Tt=>n(17,a=Tt)),Zn(e,at,Tt=>n(20,u=Tt)),Zn(e,dt,Tt=>n(0,r=Tt));let Pt,Mt=!0;return oa(()=>{r&&Pt&&a&&(T5(W,r,Pt),Ls(dt,r=null,r),n(15,Pt=void 0))}),e.$$set=Tt=>{"id"in Tt&&n(4,b=Tt.id),"data"in Tt&&n(5,C=Tt.data),"generateId"in Tt&&n(6,A=Tt.generateId),"promoteId"in Tt&&n(7,P=Tt.promoteId),"filter"in Tt&&n(8,R=Tt.filter),"lineMetrics"in Tt&&n(9,et=Tt.lineMetrics),"cluster"in Tt&&n(10,X=Tt.cluster),"maxzoom"in Tt&&n(11,K=Tt.maxzoom),"attribution"in Tt&&n(12,ot=Tt.attribution),"buffer"in Tt&&n(13,gt=Tt.buffer),"tolerance"in Tt&&n(14,q=Tt.tolerance),"$$scope"in Tt&&n(18,c=Tt.$$scope)},e.$$.update=()=>{e.$$.dirty&1024&&Ls(at,u=X,u),e.$$.dirty&196593&&a&&r!==b&&(Ls(dt,r=b,r),C5(a,r,oc({type:"geojson",data:C,filter:R,lineMetrics:et,generateId:A,promoteId:P,cluster:!!X,clusterMinPoints:X==null?void 0:X.minPoints,clusterMaxZoom:X==null?void 0:X.maxZoom,clusterRadius:X==null?void 0:X.radius,clusterProperties:X==null?void 0:X.properties,maxzoom:K,attribution:ot,buffer:gt,tolerance:q}),Tt=>a&&Tt===r,()=>{r&&(n(15,Pt=a==null?void 0:a.getSource(r)),n(16,Mt=!0))})),e.$$.dirty&131088&&(a==null||a.on("style.load",()=>{n(15,Pt=a==null?void 0:a.getSource(b))})),e.$$.dirty&98336&&Pt&&(Mt?n(16,Mt=!1):Pt.setData(C)),e.$$.dirty&33792&&(Pt==null||Pt.setClusterOptions(oc({cluster:!!X,clusterMaxZoom:X==null?void 0:X.maxZoom,clusterRadius:X==null?void 0:X.radius})))},[r,W,at,dt,b,C,A,P,R,et,X,K,ot,gt,q,Pt,Mt,a,c,p]}let _h=class extends wr{constructor(t){super(),br(this,t,P5,L5,Gn,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10,maxzoom:11,attribution:12,buffer:13,tolerance:14})}};function A5(e,t,n){let r;const{map:a}=id();Zn(e,a,R=>n(8,r=R));let{position:u="top-left"}=t,{positionOptions:p=void 0}=t,{fitBoundsOptions:c=void 0}=t,{trackUserLocation:b=!1}=t,{showAccuracyCircle:C=!0}=t,{showUserLocation:A=!0}=t,{control:P=null}=t;return oa(()=>{r!=null&&r.loaded()&&P&&r.removeControl(P)}),e.$$set=R=>{"position"in R&&n(2,u=R.position),"positionOptions"in R&&n(3,p=R.positionOptions),"fitBoundsOptions"in R&&n(4,c=R.fitBoundsOptions),"trackUserLocation"in R&&n(5,b=R.trackUserLocation),"showAccuracyCircle"in R&&n(6,C=R.showAccuracyCircle),"showUserLocation"in R&&n(7,A=R.showUserLocation),"control"in R&&n(1,P=R.control)},e.$$.update=()=>{e.$$.dirty&510&&r&&!P&&(n(1,P=new ea.GeolocateControl({positionOptions:p,fitBoundsOptions:c,trackUserLocation:b,showAccuracyCircle:C,showUserLocation:A})),r.addControl(P,u))},[a,P,u,p,c,b,C,A,r]}class M5 extends wr{constructor(t){super(),br(this,t,A5,null,Gn,{position:2,positionOptions:3,fitBoundsOptions:4,trackUserLocation:5,showAccuracyCircle:6,showUserLocation:7,control:1})}}function D5(e){let t;const n=e[15].default,r=$i(n,e,e[23],null);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u&8388608)&&eo(r,n,a,a[23],t?to(n,a[23],u,null):no(a[23]),null)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function k5(e){let t,n,r;function a(p){e[16](p)}let u={id:e[1],type:"line",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[D5]},$$scope:{ctx:e}};return e[0]!==void 0&&(u.hovered=e[0]),t=new w0({props:u}),li.push(()=>ts(t,"hovered",a)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){pn(t.$$.fragment)},m(p,c){sn(t,p,c),r=!0},p(p,[c]){const b={};c&2&&(b.id=p[1]),c&4&&(b.source=p[2]),c&8&&(b.sourceLayer=p[3]),c&16&&(b.beforeId=p[4]),c&32&&(b.beforeLayerType=p[5]),c&64&&(b.paint=p[6]),c&128&&(b.layout=p[7]),c&256&&(b.filter=p[8]),c&512&&(b.minzoom=p[9]),c&1024&&(b.maxzoom=p[10]),c&2048&&(b.hoverCursor=p[11]),c&4096&&(b.manageHoverState=p[12]),c&8192&&(b.eventsIfTopMost=p[13]),c&16384&&(b.interactive=p[14]),c&8388608&&(b.$$scope={dirty:c,ctx:p}),!n&&c&1&&(n=!0,b.hovered=p[0],$o(()=>n=!1)),t.$set(b)},i(p){r||(Yt(t.$$.fragment,p),r=!0)},o(p){ae(t.$$.fragment,p),r=!1},d(p){an(t,p)}}}function R5(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:u=rd("line")}=t,{source:p=void 0}=t,{sourceLayer:c=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:R=void 0}=t,{minzoom:et=void 0}=t,{maxzoom:X=void 0}=t,{hoverCursor:K=void 0}=t,{manageHoverState:ot=!1}=t,{hovered:gt=null}=t,{eventsIfTopMost:q=!1}=t,{interactive:W=!0}=t;function at(Q){gt=Q,n(0,gt)}function dt(Q){xn.call(this,e,Q)}function Pt(Q){xn.call(this,e,Q)}function Mt(Q){xn.call(this,e,Q)}function Tt(Q){xn.call(this,e,Q)}function Ut(Q){xn.call(this,e,Q)}function qt(Q){xn.call(this,e,Q)}return e.$$set=Q=>{"id"in Q&&n(1,u=Q.id),"source"in Q&&n(2,p=Q.source),"sourceLayer"in Q&&n(3,c=Q.sourceLayer),"beforeId"in Q&&n(4,b=Q.beforeId),"beforeLayerType"in Q&&n(5,C=Q.beforeLayerType),"paint"in Q&&n(6,A=Q.paint),"layout"in Q&&n(7,P=Q.layout),"filter"in Q&&n(8,R=Q.filter),"minzoom"in Q&&n(9,et=Q.minzoom),"maxzoom"in Q&&n(10,X=Q.maxzoom),"hoverCursor"in Q&&n(11,K=Q.hoverCursor),"manageHoverState"in Q&&n(12,ot=Q.manageHoverState),"hovered"in Q&&n(0,gt=Q.hovered),"eventsIfTopMost"in Q&&n(13,q=Q.eventsIfTopMost),"interactive"in Q&&n(14,W=Q.interactive),"$$scope"in Q&&n(23,a=Q.$$scope)},[gt,u,p,c,b,C,A,P,R,et,X,K,ot,q,W,r,at,dt,Pt,Mt,Tt,Ut,qt,a]}let S0=class extends wr{constructor(t){super(),br(this,t,R5,k5,Gn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}};function N5(e){let t=e.getCenter(),n=Math.round(e.getZoom()*100)/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,r),u=Math.round(t.lat*a)/a,p=Math.round(t.lng*a)/a,c=`${n}/${u}/${p}`,b=e.getBearing(),C=e.getPitch();return(b||C)&&(c+=`/${Math.round(b*10)/10}`),C&&(c+=`/${Math.round(C)}`),`#${c}`}function O5(e){return e.replace("#","").split("/").map(parseFloat)}function z5(e,t,n){let r;const{map:a}=id();Zn(e,a,A=>n(6,r=A));let{position:u="top-left"}=t,{showCompass:p=!0}=t,{showZoom:c=!0}=t,{visualizePitch:b=!1}=t,C=null;return oa(()=>{r!=null&&r.loaded()&&C&&r.removeControl(C)}),e.$$set=A=>{"position"in A&&n(1,u=A.position),"showCompass"in A&&n(2,p=A.showCompass),"showZoom"in A&&n(3,c=A.showZoom),"visualizePitch"in A&&n(4,b=A.visualizePitch)},e.$$.update=()=>{e.$$.dirty&126&&r&&!C&&(n(5,C=new ea.NavigationControl({showCompass:p,showZoom:c,visualizePitch:b})),r.addControl(C,u))},[a,u,p,c,b,C,r]}class F5 extends wr{constructor(t){super(),br(this,t,z5,null,Gn,{position:1,showCompass:2,showZoom:3,visualizePitch:4})}}function B5(e,t,n){let r;const{map:a}=id();Zn(e,a,C=>n(5,r=C));let{position:u="bottom-left"}=t,{maxWidth:p=void 0}=t,{unit:c="metric"}=t,b=null;return oa(()=>{r!=null&&r.loaded()&&b&&r.removeControl(b)}),e.$$set=C=>{"position"in C&&n(1,u=C.position),"maxWidth"in C&&n(2,p=C.maxWidth),"unit"in C&&n(3,c=C.unit)},e.$$.update=()=>{e.$$.dirty&62&&r&&!b&&(n(4,b=new ea.ScaleControl({maxWidth:p,unit:c})),r.addControl(b,u))},[a,u,p,c,b,r]}class V5 extends wr{constructor(t){super(),br(this,t,B5,null,Gn,{position:1,maxWidth:2,unit:3})}}const{window:U5}=JI,G5=e=>({map:e[0]&16,loadedImages:e[0]&32,allImagesLoaded:e[0]&64}),fb=e=>({map:e[4],loadedImages:e[5],allImagesLoaded:e[6]});function db(e){let t,n,r=e[3]&&mb(e);const a=e[40].default,u=$i(a,e,e[39],fb);return{c(){r&&r.c(),t=$e(),u&&u.c()},m(p,c){r&&r.m(p,c),ke(p,t,c),u&&u.m(p,c),n=!0},p(p,c){p[3]?r?(r.p(p,c),c[0]&8&&Yt(r,1)):(r=mb(p),r.c(),Yt(r,1),r.m(t.parentNode,t)):r&&(Bo(),ae(r,1,1,()=>{r=null}),Vo()),u&&u.p&&(!n||c[0]&112|c[1]&256)&&eo(u,a,p,p[39],n?to(a,p[39],c,G5):no(p[39]),fb)},i(p){n||(Yt(r),Yt(u,p),n=!0)},o(p){ae(r),ae(u,p),n=!1},d(p){p&&Me(t),r&&r.d(p),u&&u.d(p)}}}function mb(e){let t,n,r,a,u,p,c,b;return t=new F5({props:{position:e[7]}}),r=new M5({props:{position:e[7],fitBoundsOptions:{maxZoom:12}}}),u=new E5({props:{position:e[7]}}),c=new V5({props:{position:e[7]}}),{c(){pn(t.$$.fragment),n=$e(),pn(r.$$.fragment),a=$e(),pn(u.$$.fragment),p=$e(),pn(c.$$.fragment)},m(C,A){sn(t,C,A),ke(C,n,A),sn(r,C,A),ke(C,a,A),sn(u,C,A),ke(C,p,A),sn(c,C,A),b=!0},p(C,A){const P={};A[0]&128&&(P.position=C[7]),t.$set(P);const R={};A[0]&128&&(R.position=C[7]),r.$set(R);const et={};A[0]&128&&(et.position=C[7]),u.$set(et);const X={};A[0]&128&&(X.position=C[7]),c.$set(X)},i(C){b||(Yt(t.$$.fragment,C),Yt(r.$$.fragment,C),Yt(u.$$.fragment,C),Yt(c.$$.fragment,C),b=!0)},o(C){ae(t.$$.fragment,C),ae(r.$$.fragment,C),ae(u.$$.fragment,C),ae(c.$$.fragment,C),b=!1},d(C){C&&(Me(n),Me(a),Me(p)),an(t,C),an(r,C),an(u,C),an(c,C)}}}function q5(e){let t,n,r,a,u,p=e[4]&&e[0]&&db(e);return{c(){t=Ee("div"),p&&p.c(),Tn(t,"class",n=a1(e[2])+" svelte-p00lfq"),Tn(t,"data-testid","map-container"),u1(t,"expand-map",!e[2])},m(c,b){ke(c,t,b),p&&p.m(t,null),e[41](t),r=!0,a||(u=[Or(U5,"hashchange",e[11]),KI(e[10].call(null,t))],a=!0)},p(c,b){c[4]&&c[0]?p?(p.p(c,b),b[0]&17&&Yt(p,1)):(p=db(c),p.c(),Yt(p,1),p.m(t,null)):p&&(Bo(),ae(p,1,1,()=>{p=null}),Vo()),(!r||b[0]&4&&n!==(n=a1(c[2])+" svelte-p00lfq"))&&Tn(t,"class",n),(!r||b[0]&4)&&u1(t,"expand-map",!c[2])},i(c){r||(Yt(p),r=!0)},o(c){ae(p),r=!1},d(c){c&&Me(t),p&&p.d(),e[41](null),a=!1,cs(u)}}}function j5(e,t,n){let r,a,u,p,{$$slots:c={},$$scope:b}=t,{map:C=null}=t,{mapContainer:A=void 0}=t,{class:P=void 0}=t,{style:R}=t,{diffStyleUpdates:et=!1}=t,{center:X=void 0}=t,{zoom:K=void 0}=t,{pitch:ot=0}=t,{bearing:gt=0}=t,{bounds:q=void 0}=t,{hash:W=!1}=t,{updateHash:at=Y=>{window.history.replaceState(window.history.state,"",Y)}}=t,{loaded:dt=!1}=t,{minZoom:Pt=0}=t,{maxZoom:Mt=22}=t,{antialias:Tt=void 0}=t,{zoomOnDoubleClick:Ut=!0}=t,{locale:qt=void 0}=t,{interactive:Q=!0}=t,{attributionControl:Et=!0}=t,{cooperativeGestures:$t=!1}=t,{preserveDrawingBuffer:le=!1}=t,{maxBounds:Ye=void 0}=t,{images:Ie=[]}=t,{standardControls:ue=!1}=t,{filterLayers:je=void 0}=t,{transformRequest:gn=void 0}=t;const nn=eg(),{map:Ze,loadedImages:pe}=c5();Zn(e,Ze,Y=>n(4,u=Y)),Zn(e,pe,Y=>n(5,p=Y));let Re=new Set;async function dn(Y,yt=!1){if(u&&!(!u.loaded()&&!yt))if("url"in Y){Re.add(Y.id);try{let Ce=await u.loadImage(Y.url);u==null||u.addImage(Y.id,Ce.data,Y.options),p.add(Y.id),pe.set(p)}catch(Ce){nn("error",Ce)}finally{Re.delete(Y.id)}}else u.addImage(Y.id,Y.data,Y.options),p.add(Y.id),pe.set(p)}let rn,He,mn,Dn;function kn(Y){return yn(),Ls(Ze,u=new ea.Map(oc({container:Y,style:R,locale:qt,center:X,zoom:K,pitch:ot,bearing:gt,minZoom:Pt,maxZoom:Mt,antialias:Tt,interactive:Q,preserveDrawingBuffer:le,maxBounds:Ye,bounds:q,attributionControl:Et,transformRequest:gn,cooperativeGestures:$t})),u),u.on("load",yt=>{yt.target.getContainer().setAttribute("data-testid","map"),yt.target.getCanvas().setAttribute("data-testid","map-canvas"),n(0,dt=!0),nn("load",u)}),u.on("error",yt=>nn("error",{...yt,map:u})),u.on("movestart",yt=>nn("movestart",{...yt,map:u})),u.on("moveend",yt=>{if(n(12,X=yt.target.getCenter()),n(13,K=yt.target.getZoom()),n(14,ot=yt.target.getPitch()),n(15,gt=yt.target.getBearing()),n(16,q=yt.target.getBounds()),nn("moveend",{...yt,map:u}),W){let Ce=new URL(window.location.href.replace(/(#.+)?$/,N5(u)));at(Ce)}}),u.on("click",yt=>nn("click",{...yt,map:u})),u.on("dblclick",yt=>nn("dblclick",{...yt,map:u})),u.on("contextmenu",yt=>nn("contextmenu",{...yt,map:u})),u.on("zoomstart",yt=>nn("zoomstart",{...yt,map:u})),u.on("zoom",yt=>{nn("zoom",{...yt,map:u})}),u.on("zoomend",yt=>{nn("zoomend",{...yt,map:u})}),u.on("style.load",()=>{if(u){const yt=u.getStyle();if(n(36,rn=yt.layers.map(Ce=>Ce.id)),n(37,He=Object.keys(yt.sources)),Dn)for(const[Ce,Ke]of Object.entries(Dn))u.addSource(Ce,Ke);if(mn)for(const Ce of mn)u.addLayer(Ce);for(const Ce of Ie)dn(Ce,!0)}}),u.on("styledata",yt=>{if(u&&je){const Ce=u.getStyle().layers;if(Ce)for(let Ke of Ce)je(Ke)||u.setLayoutProperty(Ke.id,"visibility","none")}nn("styledata",{...yt,map:u})}),{destroy(){n(0,dt=!1),u==null||u.remove(),Ls(Ze,u=null,u)}}}let ve=R;function yn(){if(W){let Y=O5(window.location.hash);Y.length>=3&&(n(13,K=Y[0]),n(12,X=[Y[2],Y[1]])),Y.length==5&&(n(15,gt=Y[3]),n(14,ot=Y[4]))}}function Xn(Y){li[Y?"unshift":"push"](()=>{A=Y,n(1,A)})}return e.$$set=Y=>{"map"in Y&&n(17,C=Y.map),"mapContainer"in Y&&n(1,A=Y.mapContainer),"class"in Y&&n(2,P=Y.class),"style"in Y&&n(18,R=Y.style),"diffStyleUpdates"in Y&&n(19,et=Y.diffStyleUpdates),"center"in Y&&n(12,X=Y.center),"zoom"in Y&&n(13,K=Y.zoom),"pitch"in Y&&n(14,ot=Y.pitch),"bearing"in Y&&n(15,gt=Y.bearing),"bounds"in Y&&n(16,q=Y.bounds),"hash"in Y&&n(20,W=Y.hash),"updateHash"in Y&&n(21,at=Y.updateHash),"loaded"in Y&&n(0,dt=Y.loaded),"minZoom"in Y&&n(22,Pt=Y.minZoom),"maxZoom"in Y&&n(23,Mt=Y.maxZoom),"antialias"in Y&&n(24,Tt=Y.antialias),"zoomOnDoubleClick"in Y&&n(25,Ut=Y.zoomOnDoubleClick),"locale"in Y&&n(26,qt=Y.locale),"interactive"in Y&&n(27,Q=Y.interactive),"attributionControl"in Y&&n(28,Et=Y.attributionControl),"cooperativeGestures"in Y&&n(29,$t=Y.cooperativeGestures),"preserveDrawingBuffer"in Y&&n(30,le=Y.preserveDrawingBuffer),"maxBounds"in Y&&n(31,Ye=Y.maxBounds),"images"in Y&&n(32,Ie=Y.images),"standardControls"in Y&&n(3,ue=Y.standardControls),"filterLayers"in Y&&n(33,je=Y.filterLayers),"transformRequest"in Y&&n(34,gn=Y.transformRequest),"$$scope"in Y&&n(39,b=Y.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&8&&n(7,r=typeof ue=="boolean"?void 0:ue),e.$$.dirty[0]&16&&n(17,C=u),e.$$.dirty[0]&786448|e.$$.dirty[1]&224&&u&&!yh(R,ve)){const Y=u.getStyle();if(rn&&(mn=Y.layers.filter(yt=>!rn.includes(yt.id))),He){const yt=Object.keys(Y.sources).filter(Ce=>!He.includes(Ce));Dn={};for(const Ce of yt)Dn[Ce]=Y.sources[Ce]}n(38,ve=R),u.setStyle(R,{diff:et}),Ls(pe,p=new Set,p),n(35,Re=new Set)}if(e.$$.dirty[0]&49|e.$$.dirty[1]&18&&dt&&u!=null&&u.loaded())for(let Y of Ie)!p.has(Y.id)&&!Re.has(Y.id)&&!u.hasImage(Y.id)&&dn(Y);if(e.$$.dirty[0]&32|e.$$.dirty[1]&2&&n(6,a=Ie.every(Y=>p.has(Y.id))),e.$$.dirty[0]&61456&&u){let Y={};X!=null&&!yh(X,u==null?void 0:u.getCenter())&&(Y.center=X),K!=null&&!yh(K,u==null?void 0:u.getZoom())&&(Y.zoom=K),gt!=null&&!yh(gt,u==null?void 0:u.getBearing())&&(Y.bearing=gt),ot!=null&&!yh(ot,u==null?void 0:u.getPitch())&&(Y.pitch=ot),Object.keys(Y).length&&u.easeTo(Y)}e.$$.dirty[0]&65552&&q&&!yh(q,u==null?void 0:u.getBounds())&&(u==null||u.fitBounds(q)),e.$$.dirty[0]&33554448&&(Ut?u==null||u.doubleClickZoom.enable():u==null||u.doubleClickZoom.disable())},[dt,A,P,ue,u,p,a,r,Ze,pe,kn,yn,X,K,ot,gt,q,C,R,et,W,at,Pt,Mt,Tt,Ut,qt,Q,Et,$t,le,Ye,Ie,je,gn,Re,rn,He,ve,b,c,Xn]}class W5 extends wr{constructor(t){super(),br(this,t,j5,q5,Gn,{map:17,mapContainer:1,class:2,style:18,diffStyleUpdates:19,center:12,zoom:13,pitch:14,bearing:15,bounds:16,hash:20,updateHash:21,loaded:0,minZoom:22,maxZoom:23,antialias:24,zoomOnDoubleClick:25,locale:26,interactive:27,attributionControl:28,cooperativeGestures:29,preserveDrawingBuffer:30,maxBounds:31,images:32,standardControls:3,filterLayers:33,transformRequest:34},null,[-1,-1])}}var Ki=63710088e-1,I0={centimeters:Ki*100,centimetres:Ki*100,degrees:Ki/111325,feet:Ki*3.28084,inches:Ki*39.37,kilometers:Ki/1e3,kilometres:Ki/1e3,meters:Ki,metres:Ki,miles:Ki/1609.344,millimeters:Ki*1e3,millimetres:Ki*1e3,nauticalmiles:Ki/1852,radians:1,yards:Ki*1.0936},Z5={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Ki,yards:1.0936133},P_={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Us(e,t,n){n===void 0&&(n={});var r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function H5(e,t,n){switch(e){case"Point":return Do(t).geometry;case"LineString":return Cs(t).geometry;case"Polygon":return E0(t).geometry;case"MultiPoint":return B2(t).geometry;case"MultiLineString":return F2(t).geometry;case"MultiPolygon":return V2(t).geometry;default:throw new Error(e+" is invalid")}}function Do(e,t,n){if(n===void 0&&(n={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Qm(e[0])||!Qm(e[1]))throw new Error("coordinates must contain numbers");var r={type:"Point",coordinates:e};return Us(r,t,n)}function X5(e,t,n){return n===void 0&&(n={}),sc(e.map(function(r){return Do(r,t)}),n)}function E0(e,t,n){n===void 0&&(n={});for(var r=0,a=e;r<a.length;r++){var u=a[r];if(u.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var p=0;p<u[u.length-1].length;p++)if(u[u.length-1][p]!==u[0][p])throw new Error("First and last Position are not equivalent.")}var c={type:"Polygon",coordinates:e};return Us(c,t,n)}function Y5(e,t,n){return n===void 0&&(n={}),sc(e.map(function(r){return E0(r,t)}),n)}function Cs(e,t,n){if(n===void 0&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:e};return Us(r,t,n)}function K5(e,t,n){return n===void 0&&(n={}),sc(e.map(function(r){return Cs(r,t)}),n)}function sc(e,t){t===void 0&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function F2(e,t,n){n===void 0&&(n={});var r={type:"MultiLineString",coordinates:e};return Us(r,t,n)}function B2(e,t,n){n===void 0&&(n={});var r={type:"MultiPoint",coordinates:e};return Us(r,t,n)}function V2(e,t,n){n===void 0&&(n={});var r={type:"MultiPolygon",coordinates:e};return Us(r,t,n)}function J5(e,t,n){n===void 0&&(n={});var r={type:"GeometryCollection",geometries:e};return Us(r,t,n)}function Q5(e,t){if(t===void 0&&(t=0),t&&!(t>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,t||0);return Math.round(e*n)/n}function C0(e,t){t===void 0&&(t="kilometers");var n=I0[t];if(!n)throw new Error(t+" units is invalid");return e*n}function vg(e,t){t===void 0&&(t="kilometers");var n=I0[t];if(!n)throw new Error(t+" units is invalid");return e/n}function $5(e,t){return jf(vg(e,t))}function t3(e){var t=e%360;return t<0&&(t+=360),t}function jf(e){var t=e%(2*Math.PI);return t*180/Math.PI}function Ts(e){var t=e%360;return t*Math.PI/180}function e3(e,t,n){if(t===void 0&&(t="kilometers"),n===void 0&&(n="kilometers"),!(e>=0))throw new Error("length must be a positive number");return C0(vg(e,t),n)}function n3(e,t,n){if(t===void 0&&(t="meters"),n===void 0&&(n="kilometers"),!(e>=0))throw new Error("area must be a positive number");var r=P_[t];if(!r)throw new Error("invalid original units");var a=P_[n];if(!a)throw new Error("invalid final units");return e/r*a}function Qm(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function T0(e){return!!e&&e.constructor===Object}function r3(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(t){if(!Qm(t))throw new Error("bbox must only contain numbers")})}function i3(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}const o3=Object.freeze(Object.defineProperty({__proto__:null,areaFactors:P_,bearingToAzimuth:t3,convertArea:n3,convertLength:e3,degreesToRadians:Ts,earthRadius:Ki,factors:I0,feature:Us,featureCollection:sc,geometry:H5,geometryCollection:J5,isNumber:Qm,isObject:T0,lengthToDegrees:$5,lengthToRadians:vg,lineString:Cs,lineStrings:K5,multiLineString:F2,multiPoint:B2,multiPolygon:V2,point:Do,points:X5,polygon:E0,polygons:Y5,radiansToDegrees:jf,radiansToLength:C0,round:Q5,unitsFactors:Z5,validateBBox:r3,validateId:i3},Symbol.toStringTag,{value:"Module"}));function Wf(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Kh(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function U2(e,t,n){if(n===void 0&&(n={}),n.final===!0)return s3(e,t);var r=Wf(e),a=Wf(t),u=Ts(r[0]),p=Ts(a[0]),c=Ts(r[1]),b=Ts(a[1]),C=Math.sin(p-u)*Math.cos(b),A=Math.cos(c)*Math.sin(b)-Math.sin(c)*Math.cos(b)*Math.cos(p-u);return jf(Math.atan2(C,A))}function s3(e,t){var n=U2(t,e);return n=(n+180)%360,n}function ff(e,t,n){n===void 0&&(n={});var r=Wf(e),a=Wf(t),u=Ts(a[1]-r[1]),p=Ts(a[0]-r[0]),c=Ts(r[1]),b=Ts(a[1]),C=Math.pow(Math.sin(u/2),2)+Math.pow(Math.sin(p/2),2)*Math.cos(c)*Math.cos(b);return C0(2*Math.atan2(Math.sqrt(C),Math.sqrt(1-C)),n.units)}function gb(e,t,n,r){r===void 0&&(r={});var a=Wf(e),u=Ts(a[0]),p=Ts(a[1]),c=Ts(n),b=vg(t,r.units),C=Math.asin(Math.sin(p)*Math.cos(b)+Math.cos(p)*Math.sin(b)*Math.cos(c)),A=u+Math.atan2(Math.sin(c)*Math.sin(b)*Math.cos(p),Math.cos(b)-Math.sin(p)*Math.sin(C)),P=jf(A),R=jf(C);return Do([P,R],r.properties)}function od(e,t,n){if(e!==null)for(var r,a,u,p,c,b,C,A=0,P=0,R,et=e.type,X=et==="FeatureCollection",K=et==="Feature",ot=X?e.features.length:1,gt=0;gt<ot;gt++){C=X?e.features[gt].geometry:K?e.geometry:e,R=C?C.type==="GeometryCollection":!1,c=R?C.geometries.length:1;for(var q=0;q<c;q++){var W=0,at=0;if(p=R?C.geometries[q]:C,p!==null){b=p.coordinates;var dt=p.type;switch(A=n&&(dt==="Polygon"||dt==="MultiPolygon")?1:0,dt){case null:break;case"Point":if(t(b,P,gt,W,at)===!1)return!1;P++,W++;break;case"LineString":case"MultiPoint":for(r=0;r<b.length;r++){if(t(b[r],P,gt,W,at)===!1)return!1;P++,dt==="MultiPoint"&&W++}dt==="LineString"&&W++;break;case"Polygon":case"MultiLineString":for(r=0;r<b.length;r++){for(a=0;a<b[r].length-A;a++){if(t(b[r][a],P,gt,W,at)===!1)return!1;P++}dt==="MultiLineString"&&W++,dt==="Polygon"&&at++}dt==="Polygon"&&W++;break;case"MultiPolygon":for(r=0;r<b.length;r++){for(at=0,a=0;a<b[r].length;a++){for(u=0;u<b[r][a].length-A;u++){if(t(b[r][a][u],P,gt,W,at)===!1)return!1;P++}at++}W++}break;case"GeometryCollection":for(r=0;r<p.geometries.length;r++)if(od(p.geometries[r],t,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function a3(e,t,n,r){var a=n;return od(e,function(u,p,c,b,C){p===0&&n===void 0?a=u:a=t(a,u,p,c,b,C)},r),a}function G2(e,t){var n;switch(e.type){case"FeatureCollection":for(n=0;n<e.features.length&&t(e.features[n].properties,n)!==!1;n++);break;case"Feature":t(e.properties,0);break}}function l3(e,t,n){var r=n;return G2(e,function(a,u){u===0&&n===void 0?r=a:r=t(r,a,u)}),r}function $m(e,t){if(e.type==="Feature")t(e,0);else if(e.type==="FeatureCollection")for(var n=0;n<e.features.length&&t(e.features[n],n)!==!1;n++);}function u3(e,t,n){var r=n;return $m(e,function(a,u){u===0&&n===void 0?r=a:r=t(r,a,u)}),r}function c3(e){var t=[];return od(e,function(n){t.push(n)}),t}function L0(e,t){var n,r,a,u,p,c,b,C,A,P,R=0,et=e.type==="FeatureCollection",X=e.type==="Feature",K=et?e.features.length:1;for(n=0;n<K;n++){for(c=et?e.features[n].geometry:X?e.geometry:e,C=et?e.features[n].properties:X?e.properties:{},A=et?e.features[n].bbox:X?e.bbox:void 0,P=et?e.features[n].id:X?e.id:void 0,b=c?c.type==="GeometryCollection":!1,p=b?c.geometries.length:1,a=0;a<p;a++){if(u=b?c.geometries[a]:c,u===null){if(t(null,R,C,A,P)===!1)return!1;continue}switch(u.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(t(u,R,C,A,P)===!1)return!1;break}case"GeometryCollection":{for(r=0;r<u.geometries.length;r++)if(t(u.geometries[r],R,C,A,P)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}R++}}function h3(e,t,n){var r=n;return L0(e,function(a,u,p,c,b){u===0&&n===void 0?r=a:r=t(r,a,u,p,c,b)}),r}function op(e,t){L0(e,function(n,r,a,u,p){var c=n===null?null:n.type;switch(c){case null:case"Point":case"LineString":case"Polygon":return t(Us(n,a,{bbox:u,id:p}),r,0)===!1?!1:void 0}var b;switch(c){case"MultiPoint":b="Point";break;case"MultiLineString":b="LineString";break;case"MultiPolygon":b="Polygon";break}for(var C=0;C<n.coordinates.length;C++){var A=n.coordinates[C],P={type:b,coordinates:A};if(t(Us(P,a),r,C)===!1)return!1}})}function p3(e,t,n){var r=n;return op(e,function(a,u,p){u===0&&p===0&&n===void 0?r=a:r=t(r,a,u,p)}),r}function q2(e,t){op(e,function(n,r,a){var u=0;if(n.geometry){var p=n.geometry.type;if(!(p==="Point"||p==="MultiPoint")){var c,b=0,C=0,A=0;if(od(n,function(P,R,et,X,K){if(c===void 0||r>b||X>C||K>A){c=P,b=r,C=X,A=K,u=0;return}var ot=Cs([c,P],n.properties);if(t(ot,r,a,K,u)===!1)return!1;u++,c=P})===!1)return!1}}})}function f3(e,t,n){var r=n,a=!1;return q2(e,function(u,p,c,b,C){a===!1&&n===void 0?r=u:r=t(r,u,p,c,b,C),a=!0}),r}function j2(e,t){if(!e)throw new Error("geojson is required");op(e,function(n,r,a){if(n.geometry!==null){var u=n.geometry.type,p=n.geometry.coordinates;switch(u){case"LineString":if(t(n,r,a,0,0)===!1)return!1;break;case"Polygon":for(var c=0;c<p.length;c++)if(t(Cs(p[c],n.properties),r,a,c)===!1)return!1;break}}})}function d3(e,t,n){var r=n;return j2(e,function(a,u,p,c){u===0&&n===void 0?r=a:r=t(r,a,u,p,c)}),r}function m3(e,t){if(t=t||{},!T0(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,a=t.geometryIndex||0,u=t.segmentIndex||0,p=t.properties,c;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),p=p||e.features[n].properties,c=e.features[n].geometry;break;case"Feature":p=p||e.properties,c=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":c=e;break;default:throw new Error("geojson is invalid")}if(c===null)return null;var b=c.coordinates;switch(c.type){case"Point":case"MultiPoint":return null;case"LineString":return u<0&&(u=b.length+u-1),Cs([b[u],b[u+1]],p,t);case"Polygon":return a<0&&(a=b.length+a),u<0&&(u=b[a].length+u-1),Cs([b[a][u],b[a][u+1]],p,t);case"MultiLineString":return r<0&&(r=b.length+r),u<0&&(u=b[r].length+u-1),Cs([b[r][u],b[r][u+1]],p,t);case"MultiPolygon":return r<0&&(r=b.length+r),a<0&&(a=b[r].length+a),u<0&&(u=b[r][a].length-u-1),Cs([b[r][a][u],b[r][a][u+1]],p,t)}throw new Error("geojson is invalid")}function g3(e,t){if(t=t||{},!T0(t))throw new Error("options is invalid");var n=t.featureIndex||0,r=t.multiFeatureIndex||0,a=t.geometryIndex||0,u=t.coordIndex||0,p=t.properties,c;switch(e.type){case"FeatureCollection":n<0&&(n=e.features.length+n),p=p||e.features[n].properties,c=e.features[n].geometry;break;case"Feature":p=p||e.properties,c=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":c=e;break;default:throw new Error("geojson is invalid")}if(c===null)return null;var b=c.coordinates;switch(c.type){case"Point":return Do(b,p,t);case"MultiPoint":return r<0&&(r=b.length+r),Do(b[r],p,t);case"LineString":return u<0&&(u=b.length+u),Do(b[u],p,t);case"Polygon":return a<0&&(a=b.length+a),u<0&&(u=b[a].length+u),Do(b[a][u],p,t);case"MultiLineString":return r<0&&(r=b.length+r),u<0&&(u=b[r].length+u),Do(b[r][u],p,t);case"MultiPolygon":return r<0&&(r=b.length+r),a<0&&(a=b[r].length+a),u<0&&(u=b[r][a].length-u),Do(b[r][a][u],p,t)}throw new Error("geojson is invalid")}const y3=Object.freeze(Object.defineProperty({__proto__:null,coordAll:c3,coordEach:od,coordReduce:a3,featureEach:$m,featureReduce:u3,findPoint:g3,findSegment:m3,flattenEach:op,flattenReduce:p3,geomEach:L0,geomReduce:h3,lineEach:j2,lineReduce:d3,propEach:G2,propReduce:l3,segmentEach:q2,segmentReduce:f3},Symbol.toStringTag,{value:"Module"}));function yb(e){if(!e)throw new Error("geojson is required");var t=[];return op(e,function(n){_3(n,t)}),sc(t)}function _3(e,t){var n=[],r=e.geometry;if(r!==null){switch(r.type){case"Polygon":n=Kh(r);break;case"LineString":n=[Kh(r)]}n.forEach(function(a){var u=v3(a,e.properties);u.forEach(function(p){p.id=t.length,t.push(p)})})}}function v3(e,t){var n=[];return e.reduce(function(r,a){var u=Cs([r,a],t);return u.bbox=x3(r,a),n.push(u),a}),n}function x3(e,t){var n=e[0],r=e[1],a=t[0],u=t[1],p=n<a?n:a,c=r<u?r:u,b=n>a?n:a,C=r>u?r:u;return[p,c,b,C]}var P0={exports:{}},W2={exports:{}};(function(e,t){(function(n,r){e.exports=r()})(Hf,function(){function n(q,W,at,dt,Pt){(function Mt(Tt,Ut,qt,Q,Et){for(;Q>qt;){if(Q-qt>600){var $t=Q-qt+1,le=Ut-qt+1,Ye=Math.log($t),Ie=.5*Math.exp(2*Ye/3),ue=.5*Math.sqrt(Ye*Ie*($t-Ie)/$t)*(le-$t/2<0?-1:1),je=Math.max(qt,Math.floor(Ut-le*Ie/$t+ue)),gn=Math.min(Q,Math.floor(Ut+($t-le)*Ie/$t+ue));Mt(Tt,Ut,je,gn,Et)}var nn=Tt[Ut],Ze=qt,pe=Q;for(r(Tt,qt,Ut),Et(Tt[Q],nn)>0&&r(Tt,qt,Q);Ze<pe;){for(r(Tt,Ze,pe),Ze++,pe--;Et(Tt[Ze],nn)<0;)Ze++;for(;Et(Tt[pe],nn)>0;)pe--}Et(Tt[qt],nn)===0?r(Tt,qt,pe):r(Tt,++pe,Q),pe<=Ut&&(qt=pe+1),Ut<=pe&&(Q=pe-1)}})(q,W,at||0,dt||q.length-1,Pt||a)}function r(q,W,at){var dt=q[W];q[W]=q[at],q[at]=dt}function a(q,W){return q<W?-1:q>W?1:0}var u=function(q){q===void 0&&(q=9),this._maxEntries=Math.max(4,q),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function p(q,W,at){if(!at)return W.indexOf(q);for(var dt=0;dt<W.length;dt++)if(at(q,W[dt]))return dt;return-1}function c(q,W){b(q,0,q.children.length,W,q)}function b(q,W,at,dt,Pt){Pt||(Pt=ot(null)),Pt.minX=1/0,Pt.minY=1/0,Pt.maxX=-1/0,Pt.maxY=-1/0;for(var Mt=W;Mt<at;Mt++){var Tt=q.children[Mt];C(Pt,q.leaf?dt(Tt):Tt)}return Pt}function C(q,W){return q.minX=Math.min(q.minX,W.minX),q.minY=Math.min(q.minY,W.minY),q.maxX=Math.max(q.maxX,W.maxX),q.maxY=Math.max(q.maxY,W.maxY),q}function A(q,W){return q.minX-W.minX}function P(q,W){return q.minY-W.minY}function R(q){return(q.maxX-q.minX)*(q.maxY-q.minY)}function et(q){return q.maxX-q.minX+(q.maxY-q.minY)}function X(q,W){return q.minX<=W.minX&&q.minY<=W.minY&&W.maxX<=q.maxX&&W.maxY<=q.maxY}function K(q,W){return W.minX<=q.maxX&&W.minY<=q.maxY&&W.maxX>=q.minX&&W.maxY>=q.minY}function ot(q){return{children:q,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function gt(q,W,at,dt,Pt){for(var Mt=[W,at];Mt.length;)if(!((at=Mt.pop())-(W=Mt.pop())<=dt)){var Tt=W+Math.ceil((at-W)/dt/2)*dt;n(q,Tt,W,at,Pt),Mt.push(W,Tt,Tt,at)}}return u.prototype.all=function(){return this._all(this.data,[])},u.prototype.search=function(q){var W=this.data,at=[];if(!K(q,W))return at;for(var dt=this.toBBox,Pt=[];W;){for(var Mt=0;Mt<W.children.length;Mt++){var Tt=W.children[Mt],Ut=W.leaf?dt(Tt):Tt;K(q,Ut)&&(W.leaf?at.push(Tt):X(q,Ut)?this._all(Tt,at):Pt.push(Tt))}W=Pt.pop()}return at},u.prototype.collides=function(q){var W=this.data;if(!K(q,W))return!1;for(var at=[];W;){for(var dt=0;dt<W.children.length;dt++){var Pt=W.children[dt],Mt=W.leaf?this.toBBox(Pt):Pt;if(K(q,Mt)){if(W.leaf||X(q,Mt))return!0;at.push(Pt)}}W=at.pop()}return!1},u.prototype.load=function(q){if(!q||!q.length)return this;if(q.length<this._minEntries){for(var W=0;W<q.length;W++)this.insert(q[W]);return this}var at=this._build(q.slice(),0,q.length-1,0);if(this.data.children.length)if(this.data.height===at.height)this._splitRoot(this.data,at);else{if(this.data.height<at.height){var dt=this.data;this.data=at,at=dt}this._insert(at,this.data.height-at.height-1,!0)}else this.data=at;return this},u.prototype.insert=function(q){return q&&this._insert(q,this.data.height-1),this},u.prototype.clear=function(){return this.data=ot([]),this},u.prototype.remove=function(q,W){if(!q)return this;for(var at,dt,Pt,Mt=this.data,Tt=this.toBBox(q),Ut=[],qt=[];Mt||Ut.length;){if(Mt||(Mt=Ut.pop(),dt=Ut[Ut.length-1],at=qt.pop(),Pt=!0),Mt.leaf){var Q=p(q,Mt.children,W);if(Q!==-1)return Mt.children.splice(Q,1),Ut.push(Mt),this._condense(Ut),this}Pt||Mt.leaf||!X(Mt,Tt)?dt?(at++,Mt=dt.children[at],Pt=!1):Mt=null:(Ut.push(Mt),qt.push(at),at=0,dt=Mt,Mt=Mt.children[0])}return this},u.prototype.toBBox=function(q){return q},u.prototype.compareMinX=function(q,W){return q.minX-W.minX},u.prototype.compareMinY=function(q,W){return q.minY-W.minY},u.prototype.toJSON=function(){return this.data},u.prototype.fromJSON=function(q){return this.data=q,this},u.prototype._all=function(q,W){for(var at=[];q;)q.leaf?W.push.apply(W,q.children):at.push.apply(at,q.children),q=at.pop();return W},u.prototype._build=function(q,W,at,dt){var Pt,Mt=at-W+1,Tt=this._maxEntries;if(Mt<=Tt)return c(Pt=ot(q.slice(W,at+1)),this.toBBox),Pt;dt||(dt=Math.ceil(Math.log(Mt)/Math.log(Tt)),Tt=Math.ceil(Mt/Math.pow(Tt,dt-1))),(Pt=ot([])).leaf=!1,Pt.height=dt;var Ut=Math.ceil(Mt/Tt),qt=Ut*Math.ceil(Math.sqrt(Tt));gt(q,W,at,qt,this.compareMinX);for(var Q=W;Q<=at;Q+=qt){var Et=Math.min(Q+qt-1,at);gt(q,Q,Et,Ut,this.compareMinY);for(var $t=Q;$t<=Et;$t+=Ut){var le=Math.min($t+Ut-1,Et);Pt.children.push(this._build(q,$t,le,dt-1))}}return c(Pt,this.toBBox),Pt},u.prototype._chooseSubtree=function(q,W,at,dt){for(;dt.push(W),!W.leaf&&dt.length-1!==at;){for(var Pt=1/0,Mt=1/0,Tt=void 0,Ut=0;Ut<W.children.length;Ut++){var qt=W.children[Ut],Q=R(qt),Et=($t=q,le=qt,(Math.max(le.maxX,$t.maxX)-Math.min(le.minX,$t.minX))*(Math.max(le.maxY,$t.maxY)-Math.min(le.minY,$t.minY))-Q);Et<Mt?(Mt=Et,Pt=Q<Pt?Q:Pt,Tt=qt):Et===Mt&&Q<Pt&&(Pt=Q,Tt=qt)}W=Tt||W.children[0]}var $t,le;return W},u.prototype._insert=function(q,W,at){var dt=at?q:this.toBBox(q),Pt=[],Mt=this._chooseSubtree(dt,this.data,W,Pt);for(Mt.children.push(q),C(Mt,dt);W>=0&&Pt[W].children.length>this._maxEntries;)this._split(Pt,W),W--;this._adjustParentBBoxes(dt,Pt,W)},u.prototype._split=function(q,W){var at=q[W],dt=at.children.length,Pt=this._minEntries;this._chooseSplitAxis(at,Pt,dt);var Mt=this._chooseSplitIndex(at,Pt,dt),Tt=ot(at.children.splice(Mt,at.children.length-Mt));Tt.height=at.height,Tt.leaf=at.leaf,c(at,this.toBBox),c(Tt,this.toBBox),W?q[W-1].children.push(Tt):this._splitRoot(at,Tt)},u.prototype._splitRoot=function(q,W){this.data=ot([q,W]),this.data.height=q.height+1,this.data.leaf=!1,c(this.data,this.toBBox)},u.prototype._chooseSplitIndex=function(q,W,at){for(var dt,Pt,Mt,Tt,Ut,qt,Q,Et=1/0,$t=1/0,le=W;le<=at-W;le++){var Ye=b(q,0,le,this.toBBox),Ie=b(q,le,at,this.toBBox),ue=(Pt=Ye,Mt=Ie,Tt=void 0,Ut=void 0,qt=void 0,Q=void 0,Tt=Math.max(Pt.minX,Mt.minX),Ut=Math.max(Pt.minY,Mt.minY),qt=Math.min(Pt.maxX,Mt.maxX),Q=Math.min(Pt.maxY,Mt.maxY),Math.max(0,qt-Tt)*Math.max(0,Q-Ut)),je=R(Ye)+R(Ie);ue<Et?(Et=ue,dt=le,$t=je<$t?je:$t):ue===Et&&je<$t&&($t=je,dt=le)}return dt||at-W},u.prototype._chooseSplitAxis=function(q,W,at){var dt=q.leaf?this.compareMinX:A,Pt=q.leaf?this.compareMinY:P;this._allDistMargin(q,W,at,dt)<this._allDistMargin(q,W,at,Pt)&&q.children.sort(dt)},u.prototype._allDistMargin=function(q,W,at,dt){q.children.sort(dt);for(var Pt=this.toBBox,Mt=b(q,0,W,Pt),Tt=b(q,at-W,at,Pt),Ut=et(Mt)+et(Tt),qt=W;qt<at-W;qt++){var Q=q.children[qt];C(Mt,q.leaf?Pt(Q):Q),Ut+=et(Mt)}for(var Et=at-W-1;Et>=W;Et--){var $t=q.children[Et];C(Tt,q.leaf?Pt($t):$t),Ut+=et(Tt)}return Ut},u.prototype._adjustParentBBoxes=function(q,W,at){for(var dt=at;dt>=0;dt--)C(W[dt],q)},u.prototype._condense=function(q){for(var W=q.length-1,at=void 0;W>=0;W--)q[W].children.length===0?W>0?(at=q[W-1].children).splice(at.indexOf(q[W]),1):this.clear():c(q[W],this.toBBox)},u})})(W2);var b3=W2.exports;const w3=ng(o3),S3=ng(y3),I3=ng(VA);var Pa=b3,Z2=w3,H2=S3,vh=I3.default,E3=H2.featureEach;H2.coordEach;Z2.polygon;var _b=Z2.featureCollection;function X2(e){var t=new Pa(e);return t.insert=function(n){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:vh(n),Pa.prototype.insert.call(this,n)},t.load=function(n){var r=[];return Array.isArray(n)?n.forEach(function(a){if(a.type!=="Feature")throw new Error("invalid features");a.bbox=a.bbox?a.bbox:vh(a),r.push(a)}):E3(n,function(a){if(a.type!=="Feature")throw new Error("invalid features");a.bbox=a.bbox?a.bbox:vh(a),r.push(a)}),Pa.prototype.load.call(this,r)},t.remove=function(n,r){if(n.type!=="Feature")throw new Error("invalid feature");return n.bbox=n.bbox?n.bbox:vh(n),Pa.prototype.remove.call(this,n,r)},t.clear=function(){return Pa.prototype.clear.call(this)},t.search=function(n){var r=Pa.prototype.search.call(this,this.toBBox(n));return _b(r)},t.collides=function(n){return Pa.prototype.collides.call(this,this.toBBox(n))},t.all=function(){var n=Pa.prototype.all.call(this);return _b(n)},t.toJSON=function(){return Pa.prototype.toJSON.call(this)},t.fromJSON=function(n){return Pa.prototype.fromJSON.call(this,n)},t.toBBox=function(n){var r;if(n.bbox)r=n.bbox;else if(Array.isArray(n)&&n.length===4)r=n;else if(Array.isArray(n)&&n.length===6)r=[n[0],n[1],n[3],n[4]];else if(n.type==="Feature")r=vh(n);else if(n.type==="FeatureCollection")r=vh(n);else throw new Error("invalid geojson");return{minX:r[0],minY:r[1],maxX:r[2],maxY:r[3]}},t}P0.exports=X2;P0.exports.default=X2;var C3=P0.exports;const T3=N_(C3);function L3(e,t){var n={},r=[];if(e.type==="LineString"&&(e=Us(e)),t.type==="LineString"&&(t=Us(t)),e.type==="Feature"&&t.type==="Feature"&&e.geometry!==null&&t.geometry!==null&&e.geometry.type==="LineString"&&t.geometry.type==="LineString"&&e.geometry.coordinates.length===2&&t.geometry.coordinates.length===2){var a=vb(e,t);return a&&r.push(a),sc(r)}var u=T3();return u.load(yb(t)),$m(yb(e),function(p){$m(u.search(p),function(c){var b=vb(p,c);if(b){var C=Kh(b).join(",");n[C]||(n[C]=!0,r.push(b))}})}),sc(r)}function vb(e,t){var n=Kh(e),r=Kh(t);if(n.length!==2)throw new Error("<intersects> line1 must only contain 2 coordinates");if(r.length!==2)throw new Error("<intersects> line2 must only contain 2 coordinates");var a=n[0][0],u=n[0][1],p=n[1][0],c=n[1][1],b=r[0][0],C=r[0][1],A=r[1][0],P=r[1][1],R=(P-C)*(p-a)-(A-b)*(c-u),et=(A-b)*(u-C)-(P-C)*(a-b),X=(p-a)*(u-C)-(c-u)*(a-b);if(R===0)return null;var K=et/R,ot=X/R;if(K>=0&&K<=1&&ot>=0&&ot<=1){var gt=a+K*(p-a),q=u+K*(c-u);return Do([gt,q])}return null}function P3(e,t,n){n===void 0&&(n={});var r=Do([1/0,1/0],{dist:1/0}),a=0;return op(e,function(u){for(var p=Kh(u),c=0;c<p.length-1;c++){var b=Do(p[c]);b.properties.dist=ff(t,b,n);var C=Do(p[c+1]);C.properties.dist=ff(t,C,n);var A=ff(b,C,n),P=Math.max(b.properties.dist,C.properties.dist),R=U2(b,C),et=gb(t,P,R+90,n),X=gb(t,P,R-90,n),K=L3(Cs([et.geometry.coordinates,X.geometry.coordinates]),Cs([b.geometry.coordinates,C.geometry.coordinates])),ot=null;K.features.length>0&&(ot=K.features[0],ot.properties.dist=ff(t,ot,n),ot.properties.location=a+ff(b,ot,n)),b.properties.dist<r.properties.dist&&(r=b,r.properties.index=c,r.properties.location=a),C.properties.dist<r.properties.dist&&(r=C,r.properties.index=c+1,r.properties.location=a+A),ot&&ot.properties.dist<r.properties.dist&&(r=ot,r.properties.index=c),a+=A}}),r}const A3=["==",["geometry-type"],"Polygon"],M3=["==",["geometry-type"],"LineString"],D3=["==",["geometry-type"],"Point"];function Ky(e){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:Y2(e)}}}function Y2(e){return[Math.round(e[0]*1e7)/1e7,Math.round(e[1]*1e7)/1e7]}const K2=Ji({type:"FeatureCollection",features:[]}),J2=Ji(0),k3=100;class R3{constructor(t){ti(this,"map");ti(this,"active");ti(this,"eventListenersSuccess");ti(this,"eventListenersUpdated");ti(this,"eventListenersFailure");ti(this,"points");ti(this,"cursor");ti(this,"hover");ti(this,"dragFrom");ti(this,"previousStates");ti(this,"onMouseMove",t=>{if(this.active&&!this.dragFrom)this.recalculateHovering(t);else if(this.active&&this.dragFrom){if(this.hover=="polygon"){let n=this.dragFrom[0]-t.lngLat.lng,r=this.dragFrom[1]-t.lngLat.lat;for(let a of this.points)a[0]-=n,a[1]-=r}else this.points[this.hover]=t.lngLat.toArray();this.dragFrom=t.lngLat.toArray(),this.redraw()}});ti(this,"onClick",t=>{if(this.beforeUpdate(),this.active&&this.cursor){let n=[];if(xb(this.points).forEach((r,a)=>{n.push([a+1,P3(r,this.cursor).properties.dist])}),n.sort((r,a)=>r[1]-a[1]),n.length>0){let r=n[0][0];this.points.splice(r,0,this.cursor.geometry.coordinates),this.hover=r}else this.points.push(this.cursor.geometry.coordinates),this.hover=this.points.length-1;this.redraw(),this.pointsUpdated()}else this.active&&typeof this.hover=="number"&&(this.points.splice(this.hover,1),this.hover=null,this.redraw(),this.pointsUpdated(),this.recalculateHovering(t))});ti(this,"onDoubleClick",t=>{this.active&&(t.preventDefault(),this.cursor=Ky(t.lngLat.toArray()),this.onClick(t),this.finish())});ti(this,"onMouseDown",t=>{this.active&&!this.dragFrom&&this.hover!=null&&(t.preventDefault(),this.cursor=null,this.dragFrom=t.lngLat.toArray(),this.beforeUpdate(),this.redraw())});ti(this,"onMouseUp",()=>{this.active&&this.dragFrom&&(this.dragFrom=null,this.redraw(),this.pointsUpdated())});ti(this,"onKeypress",t=>{this.active&&(t.key=="Enter"?(t.stopPropagation(),this.finish()):t.key=="z"&&t.ctrlKey&&this.undo())});ti(this,"onKeyDown",t=>{this.active&&t.key=="Escape"&&(t.stopPropagation(),this.cancel())});this.map=t,this.active=!1,this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[],this.points=[],this.cursor=null,this.hover=null,this.dragFrom=null,this.previousStates=[],this.map.on("mousemove",this.onMouseMove),this.map.on("click",this.onClick),this.map.on("dblclick",this.onDoubleClick),this.map.on("mousedown",this.onMouseDown),this.map.on("mouseup",this.onMouseUp),document.addEventListener("keypress",this.onKeypress),document.addEventListener("keydown",this.onKeyDown)}tearDown(){this.map.off("mousemove",this.onMouseMove),this.map.off("click",this.onClick),this.map.off("dblclick",this.onDoubleClick),this.map.off("mousedown",this.onMouseDown),this.map.off("mouseup",this.onMouseUp),document.removeEventListener("keypress",this.onKeypress),document.removeEventListener("keydown",this.onKeyDown)}finish(){let t=this.polygonFeature();if(t)for(let n of this.eventListenersSuccess)n(t);else for(let n of this.eventListenersFailure)n();this.stop()}cancel(){for(let t of this.eventListenersFailure)t();this.stop()}addEventListenerSuccess(t){this.eventListenersSuccess.push(t)}addEventListenerUpdated(t){this.eventListenersUpdated.push(t)}addEventListenerFailure(t){this.eventListenersFailure.push(t)}clearEventListeners(){this.eventListenersSuccess=[],this.eventListenersUpdated=[],this.eventListenersFailure=[]}startNew(){this.active=!0,this.map.doubleClickZoom.disable()}editExisting(t){this.active=!0,this.map.doubleClickZoom.disable(),this.points=JSON.parse(JSON.stringify(t.geometry.coordinates[0])),this.points.pop(),this.redraw()}stop(){this.map.doubleClickZoom.enable(),this.points=[],this.cursor=null,this.active=!1,this.hover=null,this.dragFrom=null,this.previousStates=[],this.redraw(),this.map.getCanvas().style.cursor="inherit"}undo(){this.dragFrom!=null||this.previousStates.length==0||(this.points=this.previousStates.pop(),this.hover=null,this.redraw())}redraw(){let t={type:"FeatureCollection",features:[]};this.points.forEach((a,u)=>{let p=Ky(a);p.properties.hover=this.hover==u,p.properties.idx=u,t.features.push(p)}),t.features=t.features.concat(xb(this.points));let n=this.polygonFeature();n&&(n.properties.hover=this.hover=="polygon",t.features.push(n)),K2.set(t);let r="crosshair";this.hover!=null&&(r=this.dragFrom?"grabbing":"pointer"),this.map.getCanvas().style.cursor=r,J2.set(this.previousStates.length)}pointsUpdated(){let t=this.polygonFeature();if(t)for(let n of this.eventListenersUpdated)n(t)}recalculateHovering(t){this.cursor=null,this.hover=null;for(let n of this.map.queryRenderedFeatures(t.point,{layers:["edit-polygon-fill","edit-polygon-vertices"]}))if(n.geometry.type=="Polygon"){this.hover="polygon";break}else if(n.geometry.type=="Point"&&Object.hasOwn(n.properties,"idx")){this.hover=n.properties.idx;break}this.hover==null&&(this.cursor=Ky(t.lngLat.toArray())),this.redraw()}polygonFeature(){if(this.points.length<3)return null;let t=this.points.map(Y2),n=[JSON.parse(JSON.stringify(t))];return n[0].push(JSON.parse(JSON.stringify(n[0][0]))),{type:"Feature",geometry:{type:"Polygon",coordinates:n},properties:{}}}beforeUpdate(){this.previousStates.push(JSON.parse(JSON.stringify(this.points))),this.previousStates.length>k3&&this.previousStates.shift()}}function xb(e){let t=[];for(let n=0;n<e.length-1;n++)t.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[n],e[n+1]]},properties:{}});return e.length>=3&&t.push({type:"Feature",geometry:{type:"LineString",coordinates:[e[e.length-1],e[0]]},properties:{}}),t}function N3(e){let t,n,r;return{c(){t=Vn("Undo ("),n=Vn(e[1]),r=Vn(")")},m(a,u){ke(a,t,u),ke(a,n,u),ke(a,r,u)},p(a,u){u&2&&Th(n,a[1])},d(a){a&&(Me(t),Me(n),Me(r))}}}function O3(e){let t;return{c(){t=Vn("Undo")},m(n,r){ke(n,t,r)},p:Yr,d(n){n&&Me(t)}}}function z3(e){let t,n,r,a,u,p,c,b,C,A,P;function R(K,ot){return K[1]==0?O3:N3}let et=R(e),X=et(e);return{c(){t=Ee("div"),n=Ee("button"),n.textContent="Finish",r=$e(),a=Ee("button"),a.textContent="Cancel",u=$e(),p=Ee("button"),X.c(),b=$e(),C=Ee("ul"),C.innerHTML=`<li><b>Click</b>
    the map to add a vertex</li> <li><b>Click</b>
    a vertex to delete it</li> <li><b>Drag</b>
    a vertex or the polygon to move it</li> <li>Press <b>Control+Z</b>
    to undo your last change</li> <li>Press <b>Enter</b>
    or
    <b>double click</b>
    to finish</li> <li>Press <b>Escape</b>
    to cancel</li>`,p.disabled=c=e[1]==0,bf(t,"display","flex"),bf(t,"justify-content","space-between")},m(K,ot){ke(K,t,ot),ne(t,n),ne(t,r),ne(t,a),ne(t,u),ne(t,p),X.m(p,null),ke(K,b,ot),ke(K,C,ot),A||(P=[Or(n,"click",e[2]),Or(a,"click",e[3]),Or(p,"click",e[4])],A=!0)},p(K,[ot]){et===(et=R(K))&&X?X.p(K,ot):(X.d(1),X=et(K),X&&(X.c(),X.m(p,null))),ot&2&&c!==(c=K[1]==0)&&(p.disabled=c)},i:Yr,o:Yr,d(K){K&&(Me(t),Me(b),Me(C)),X.d(),A=!1,cs(P)}}}function F3(e,t,n){let r;Zn(e,J2,b=>n(1,r=b));let{polygonTool:a}=t;const u=()=>a.finish(),p=()=>a.cancel(),c=()=>a.undo();return e.$$set=b=>{"polygonTool"in b&&n(0,a=b.polygonTool)},[a,r,u,p,c]}class B3 extends wr{constructor(t){super(),br(this,t,F3,z3,Gn,{polygonTool:0})}}let V3=Date.now();function sd(e){return`${e}-${V3++}`}const Q2=Symbol.for("svelte-maplibre");function U3(){return R_(Q2)}function bb(e){return{subscribe:e.subscribe}}function $2({key:e,setPopupTarget:t=!1,setCluster:n=!1,setMouseEvent:r=!1}){let a=U3(),u=Ji(null),p=bb(u),c={...a,[e]:bb(u)};if(t&&(c.popupTarget=p),r){let b=Ji(null);c.layerEvent=b,a.layerEvent=b}return n&&(c.cluster=Ji()),k_(Q2,c),{...a,self:u}}function G3(){return $2({key:"source",setCluster:!0})}function q3(e=!0){return $2({key:"layer",setPopupTarget:e,setMouseEvent:e})}function wb(e){let t;return n=>{if(n)for(let r in n){let a=t==null?void 0:t[r],u=n[r];a!==u&&e(r,u,a)}else if(t)for(let r in t)e(r,void 0,t[r]);t=n}}function j3(e,...t){let n=[e];for(let r of t)if(r)Array.isArray(r)&&r[0]===e?n.push(...r.slice(1)):n.push(r);else continue;if(n.length!==1)return n.length===2?n[1]:n}function W3(e){return e===!0?["has","point_count"]:e===!1?["!",["has","point_count"]]:void 0}function Sb(e){let t=e[0],n,r,a=Ib(e);return{c(){a.c(),n=Ua()},m(u,p){a.m(u,p),ke(u,n,p),r=!0},p(u,p){p[0]&1&&Gn(t,t=u[0])?(Bo(),ae(a,1,1,Yr),Vo(),a=Ib(u),a.c(),Yt(a,1),a.m(n.parentNode,n)):a.p(u,p)},i(u){r||(Yt(a),r=!0)},o(u){ae(a),r=!1},d(u){u&&Me(n),a.d(u)}}}function Ib(e){let t;const n=e[36].default,r=$i(n,e,e[35],null);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u[1]&16)&&eo(r,n,a,a[35],t?to(n,a[35],u,null):no(a[35]),null)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function Z3(e){let t,n,r=e[0]&&Sb(e);return{c(){r&&r.c(),t=Ua()},m(a,u){r&&r.m(a,u),ke(a,t,u),n=!0},p(a,u){a[0]?r?(r.p(a,u),u[0]&1&&Yt(r,1)):(r=Sb(a),r.c(),Yt(r,1),r.m(t.parentNode,t)):r&&(Bo(),ae(r,1,1,()=>{r=null}),Vo())},i(a){n||(Yt(r),n=!0)},o(a){ae(r),n=!1},d(a){a&&Me(t),r&&r.d(a)}}}function H3(e,t,n){let r,a,u,p,c,b,C,A,P,R,et,X,{$$slots:K={},$$scope:ot}=t,{id:gt=sd("layer")}=t,{source:q=void 0}=t,{sourceLayer:W=void 0}=t,{beforeId:at=void 0}=t,{beforeLayerType:dt=void 0}=t,{type:Pt}=t,{paint:Mt=void 0}=t,{layout:Tt=void 0}=t,{filter:Ut=void 0}=t,{applyToClusters:qt=void 0}=t,{minzoom:Q=void 0}=t,{maxzoom:Et=void 0}=t,{manageHoverState:$t=!1}=t,{hovered:le=null}=t,{interactive:Ye=!0}=t,{hoverCursor:Ie=void 0}=t,{eventsIfTopMost:ue=!1}=t;const je=eg(),{map:gn,source:nn,self:Ze,minzoom:pe,maxzoom:Re,eventTopMost:dn,layerInfo:rn}=q3();Zn(e,gn,Y=>n(31,P=Y)),Zn(e,nn,Y=>n(32,R=Y)),Zn(e,Ze,Y=>n(0,A=Y)),Zn(e,pe,Y=>n(34,X=Y)),Zn(e,Re,Y=>n(33,et=Y)),oa(()=>{A&&P&&(rn.delete(A),P==null||P.removeLayer(A))});let He;function mn(Y){var Lt,nr;if(!Ye||!A||!P||ue&&dn(Y)!==A)return;let yt=Y.features??[],Ce=(nr=(Lt=yt[0])==null?void 0:Lt.properties)==null?void 0:nr.cluster_id,Ke={event:Y,map:P,clusterId:Ce,layer:A,source:c,features:yt};je(Y.type,Ke)}function Dn(Y){var Lt,nr;if(!Ye||!A||!P||ue&&dn(Y)!==A)return;Ie&&(P.getCanvas().style.cursor=Ie);let yt=Y.features??[];n(6,le=yt[0]??null);let Ce=(nr=(Lt=yt[0])==null?void 0:Lt.properties)==null?void 0:nr.cluster_id;je("mouseenter",{event:Y,map:P,clusterId:Ce,layer:A,source:c,features:yt})}function kn(Y){var Lt,nr,qo;if(!Ye||!P)return;if(ue&&dn(Y)!==A){n(6,le=null),$t&&He!==void 0&&(P==null||P.setFeatureState({source:c,sourceLayer:W,id:He},{hover:!1}),He=void 0);return}P.getCanvas().style.cursor=Ie;let yt=Y.features??[],Ce=(nr=(Lt=yt[0])==null?void 0:Lt.properties)==null?void 0:nr.cluster_id,Ke=(qo=yt[0])==null?void 0:qo.id;Ke!==He&&($t&&(He!==void 0&&(P==null||P.setFeatureState({source:c,id:He,sourceLayer:W},{hover:!1})),P==null||P.setFeatureState({source:c,id:Ke,sourceLayer:W},{hover:!0})),He=Ke,n(6,le=yt[0]??null)),je("mousemove",{event:Y,map:P,clusterId:Ce,layer:A,source:c,features:yt})}function ve(Y){if(!(!Ye||!A||!P)){if(Ie&&(P.getCanvas().style.cursor=""),n(6,le=null),$t&&He!==void 0){const yt={source:c,id:He,sourceLayer:W};P==null||P.setFeatureState(yt,{hover:!1}),He=void 0}je("mouseleave",{map:P,layer:A,source:c})}}let yn=!0;function Xn(Y){P&&(P.off("click",Y,mn),P.off("dblclick",Y,mn),P.off("contextmenu",Y,mn),P.off("mouseenter",Y,Dn),P.off("mousemove",Y,kn),P.off("mouseleave",Y,ve))}return oa(()=>{P&&A&&Xn(A)}),e.$$set=Y=>{"id"in Y&&n(7,gt=Y.id),"source"in Y&&n(8,q=Y.source),"sourceLayer"in Y&&n(9,W=Y.sourceLayer),"beforeId"in Y&&n(10,at=Y.beforeId),"beforeLayerType"in Y&&n(11,dt=Y.beforeLayerType),"type"in Y&&n(12,Pt=Y.type),"paint"in Y&&n(13,Mt=Y.paint),"layout"in Y&&n(14,Tt=Y.layout),"filter"in Y&&n(15,Ut=Y.filter),"applyToClusters"in Y&&n(16,qt=Y.applyToClusters),"minzoom"in Y&&n(17,Q=Y.minzoom),"maxzoom"in Y&&n(18,Et=Y.maxzoom),"manageHoverState"in Y&&n(19,$t=Y.manageHoverState),"hovered"in Y&&n(6,le=Y.hovered),"interactive"in Y&&n(20,Ye=Y.interactive),"hoverCursor"in Y&&n(21,Ie=Y.hoverCursor),"eventsIfTopMost"in Y&&n(22,ue=Y.eventsIfTopMost),"$$scope"in Y&&n(35,ot=Y.$$scope)},e.$$.update=()=>{if(e.$$.dirty[0]&65536&&n(30,r=W3(qt)),e.$$.dirty[0]&1073774592&&n(24,a=j3("all",r,Ut)),e.$$.dirty[0]&131072|e.$$.dirty[1]&8&&n(26,u=Q??X),e.$$.dirty[0]&262144|e.$$.dirty[1]&4&&n(25,p=Et??et),e.$$.dirty[0]&256|e.$$.dirty[1]&2&&n(29,c=q||R),e.$$.dirty[0]&654343809|e.$$.dirty[1]&1&&P&&A!==gt&&c){A&&(Xn(A),rn.delete(A));let Y=at;if(!at&&dt){let yt=P.getStyle().layers,Ce=typeof dt=="function"?dt:Lt=>Lt.type===dt,Ke=yt==null?void 0:yt.find(Ce);Ke&&(Y=Ke.id)}Ls(Ze,A=gt,A),P.addLayer(oc({id:A,type:Pt,source:c,"source-layer":W,filter:a,paint:Mt,layout:Tt,minzoom:u,maxzoom:p}),Y),n(23,yn=!0),P.on("click",A,mn),P.on("dblclick",A,mn),P.on("contextmenu",A,mn),P.on("mouseenter",A,Dn),P.on("mousemove",A,kn),P.on("mouseleave",A,ve)}e.$$.dirty[0]&1048577&&A&&rn.set(A,{interactive:Ye}),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(28,b=A?wb((Y,yt)=>P==null?void 0:P.setPaintProperty(A,Y,yt)):void 0),e.$$.dirty[0]&1|e.$$.dirty[1]&1&&n(27,C=A?wb((Y,yt)=>P==null?void 0:P.setLayoutProperty(A,Y,yt)):void 0),e.$$.dirty[0]&268443648&&(b==null||b(Mt)),e.$$.dirty[0]&134234112&&(C==null||C(Tt)),e.$$.dirty[0]&100663297|e.$$.dirty[1]&1&&A&&(P==null||P.setLayerZoomRange(A,u,p)),e.$$.dirty[0]&25165825|e.$$.dirty[1]&1&&A&&(yn?n(23,yn=!1):P==null||P.setFilter(A,a))},[A,gn,nn,Ze,pe,Re,le,gt,q,W,at,dt,Pt,Mt,Tt,Ut,qt,Q,Et,$t,Ye,Ie,ue,yn,a,p,u,C,b,c,r,P,R,et,X,ot,K]}class A0 extends wr{constructor(t){super(),br(this,t,H3,Z3,Gn,{id:7,source:8,sourceLayer:9,beforeId:10,beforeLayerType:11,type:12,paint:13,layout:14,filter:15,applyToClusters:16,minzoom:17,maxzoom:18,manageHoverState:19,hovered:6,interactive:20,hoverCursor:21,eventsIfTopMost:22},null,[-1,-1])}}function X3(e){let t;const n=e[16].default,r=$i(n,e,e[24],null);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u&16777216)&&eo(r,n,a,a[24],t?to(n,a[24],u,null):no(a[24]),null)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function Y3(e){let t,n,r;function a(p){e[17](p)}let u={id:e[1],type:"circle",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],applyToClusters:e[9],minzoom:e[10],maxzoom:e[11],hoverCursor:e[12],manageHoverState:e[13],eventsIfTopMost:e[14],interactive:e[15],$$slots:{default:[X3]},$$scope:{ctx:e}};return e[0]!==void 0&&(u.hovered=e[0]),t=new A0({props:u}),li.push(()=>ts(t,"hovered",a)),t.$on("click",e[18]),t.$on("dblclick",e[19]),t.$on("contextmenu",e[20]),t.$on("mouseenter",e[21]),t.$on("mousemove",e[22]),t.$on("mouseleave",e[23]),{c(){pn(t.$$.fragment)},m(p,c){sn(t,p,c),r=!0},p(p,[c]){const b={};c&2&&(b.id=p[1]),c&4&&(b.source=p[2]),c&8&&(b.sourceLayer=p[3]),c&16&&(b.beforeId=p[4]),c&32&&(b.beforeLayerType=p[5]),c&64&&(b.paint=p[6]),c&128&&(b.layout=p[7]),c&256&&(b.filter=p[8]),c&512&&(b.applyToClusters=p[9]),c&1024&&(b.minzoom=p[10]),c&2048&&(b.maxzoom=p[11]),c&4096&&(b.hoverCursor=p[12]),c&8192&&(b.manageHoverState=p[13]),c&16384&&(b.eventsIfTopMost=p[14]),c&32768&&(b.interactive=p[15]),c&16777216&&(b.$$scope={dirty:c,ctx:p}),!n&&c&1&&(n=!0,b.hovered=p[0],$o(()=>n=!1)),t.$set(b)},i(p){r||(Yt(t.$$.fragment,p),r=!0)},o(p){ae(t.$$.fragment,p),r=!1},d(p){an(t,p)}}}function K3(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:u=sd("circle")}=t,{source:p=void 0}=t,{sourceLayer:c=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:R=void 0}=t,{applyToClusters:et=void 0}=t,{minzoom:X=void 0}=t,{maxzoom:K=void 0}=t,{hoverCursor:ot=void 0}=t,{manageHoverState:gt=!1}=t,{hovered:q=null}=t,{eventsIfTopMost:W=!1}=t,{interactive:at=!0}=t;function dt(Et){q=Et,n(0,q)}function Pt(Et){xn.call(this,e,Et)}function Mt(Et){xn.call(this,e,Et)}function Tt(Et){xn.call(this,e,Et)}function Ut(Et){xn.call(this,e,Et)}function qt(Et){xn.call(this,e,Et)}function Q(Et){xn.call(this,e,Et)}return e.$$set=Et=>{"id"in Et&&n(1,u=Et.id),"source"in Et&&n(2,p=Et.source),"sourceLayer"in Et&&n(3,c=Et.sourceLayer),"beforeId"in Et&&n(4,b=Et.beforeId),"beforeLayerType"in Et&&n(5,C=Et.beforeLayerType),"paint"in Et&&n(6,A=Et.paint),"layout"in Et&&n(7,P=Et.layout),"filter"in Et&&n(8,R=Et.filter),"applyToClusters"in Et&&n(9,et=Et.applyToClusters),"minzoom"in Et&&n(10,X=Et.minzoom),"maxzoom"in Et&&n(11,K=Et.maxzoom),"hoverCursor"in Et&&n(12,ot=Et.hoverCursor),"manageHoverState"in Et&&n(13,gt=Et.manageHoverState),"hovered"in Et&&n(0,q=Et.hovered),"eventsIfTopMost"in Et&&n(14,W=Et.eventsIfTopMost),"interactive"in Et&&n(15,at=Et.interactive),"$$scope"in Et&&n(24,a=Et.$$scope)},[q,u,p,c,b,C,A,P,R,et,X,K,ot,gt,W,at,r,dt,Pt,Mt,Tt,Ut,qt,Q,a]}class J3 extends wr{constructor(t){super(),br(this,t,K3,Y3,Gn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Q3(e){let t;const n=e[15].default,r=$i(n,e,e[23],null);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u&8388608)&&eo(r,n,a,a[23],t?to(n,a[23],u,null):no(a[23]),null)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function $3(e){let t,n,r;function a(p){e[16](p)}let u={id:e[1],type:"fill",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[Q3]},$$scope:{ctx:e}};return e[0]!==void 0&&(u.hovered=e[0]),t=new A0({props:u}),li.push(()=>ts(t,"hovered",a)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){pn(t.$$.fragment)},m(p,c){sn(t,p,c),r=!0},p(p,[c]){const b={};c&2&&(b.id=p[1]),c&4&&(b.source=p[2]),c&8&&(b.sourceLayer=p[3]),c&16&&(b.beforeId=p[4]),c&32&&(b.beforeLayerType=p[5]),c&64&&(b.paint=p[6]),c&128&&(b.layout=p[7]),c&256&&(b.filter=p[8]),c&512&&(b.minzoom=p[9]),c&1024&&(b.maxzoom=p[10]),c&2048&&(b.hoverCursor=p[11]),c&4096&&(b.manageHoverState=p[12]),c&8192&&(b.eventsIfTopMost=p[13]),c&16384&&(b.interactive=p[14]),c&8388608&&(b.$$scope={dirty:c,ctx:p}),!n&&c&1&&(n=!0,b.hovered=p[0],$o(()=>n=!1)),t.$set(b)},i(p){r||(Yt(t.$$.fragment,p),r=!0)},o(p){ae(t.$$.fragment,p),r=!1},d(p){an(t,p)}}}function t4(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:u=sd("fill")}=t,{source:p=void 0}=t,{sourceLayer:c=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:R=void 0}=t,{minzoom:et=void 0}=t,{maxzoom:X=void 0}=t,{hoverCursor:K=void 0}=t,{manageHoverState:ot=!1}=t,{hovered:gt=null}=t,{eventsIfTopMost:q=!1}=t,{interactive:W=!0}=t;function at(Q){gt=Q,n(0,gt)}function dt(Q){xn.call(this,e,Q)}function Pt(Q){xn.call(this,e,Q)}function Mt(Q){xn.call(this,e,Q)}function Tt(Q){xn.call(this,e,Q)}function Ut(Q){xn.call(this,e,Q)}function qt(Q){xn.call(this,e,Q)}return e.$$set=Q=>{"id"in Q&&n(1,u=Q.id),"source"in Q&&n(2,p=Q.source),"sourceLayer"in Q&&n(3,c=Q.sourceLayer),"beforeId"in Q&&n(4,b=Q.beforeId),"beforeLayerType"in Q&&n(5,C=Q.beforeLayerType),"paint"in Q&&n(6,A=Q.paint),"layout"in Q&&n(7,P=Q.layout),"filter"in Q&&n(8,R=Q.filter),"minzoom"in Q&&n(9,et=Q.minzoom),"maxzoom"in Q&&n(10,X=Q.maxzoom),"hoverCursor"in Q&&n(11,K=Q.hoverCursor),"manageHoverState"in Q&&n(12,ot=Q.manageHoverState),"hovered"in Q&&n(0,gt=Q.hovered),"eventsIfTopMost"in Q&&n(13,q=Q.eventsIfTopMost),"interactive"in Q&&n(14,W=Q.interactive),"$$scope"in Q&&n(23,a=Q.$$scope)},[gt,u,p,c,b,C,A,P,R,et,X,K,ot,q,W,r,at,dt,Pt,Mt,Tt,Ut,qt,a]}class e4 extends wr{constructor(t){super(),br(this,t,t4,$3,Gn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function n4(e,t,n,r,a){let u=!1;e.getSource(t)&&(u=!0,e.removeSource(t));const p=()=>{r(t)&&(e.addSource(t,n),a())};if(u){const c=()=>{t&&(e.getSource(t)?setTimeout(c,1):p())};c()}else p()}function r4(e,t,n){Vb().then(()=>{let r=D_(e);if(!r)return;r.getSource(t)===n&&r.removeSource(t)})}function Eb(e){let t=e[0],n,r,a=Cb(e);return{c(){a.c(),n=Ua()},m(u,p){a.m(u,p),ke(u,n,p),r=!0},p(u,p){p&1&&Gn(t,t=u[0])?(Bo(),ae(a,1,1,Yr),Vo(),a=Cb(u),a.c(),Yt(a,1),a.m(n.parentNode,n)):a.p(u,p)},i(u){r||(Yt(a),r=!0)},o(u){ae(a),r=!1},d(u){u&&Me(n),a.d(u)}}}function Cb(e){let t;const n=e[15].default,r=$i(n,e,e[14],null);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u&16384)&&eo(r,n,a,a[14],t?to(n,a[14],u,null):no(a[14]),null)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function i4(e){let t,n,r=e[0]&&Eb(e);return{c(){r&&r.c(),t=Ua()},m(a,u){r&&r.m(a,u),ke(a,t,u),n=!0},p(a,[u]){a[0]?r?(r.p(a,u),u&1&&Yt(r,1)):(r=Eb(a),r.c(),Yt(r,1),r.m(t.parentNode,t)):r&&(Bo(),ae(r,1,1,()=>{r=null}),Vo())},i(a){n||(Yt(r),n=!0)},o(a){ae(r),n=!1},d(a){a&&Me(t),r&&r.d(a)}}}function o4(e,t,n){let r,a,u,{$$slots:p={},$$scope:c}=t,{id:b=sd("geojson")}=t,{data:C}=t,{generateId:A=!1}=t,{promoteId:P=void 0}=t,{filter:R=void 0}=t,{lineMetrics:et=void 0}=t,{cluster:X=void 0}=t;const{map:K,cluster:ot,self:gt}=G3();Zn(e,K,at=>n(13,a=at)),Zn(e,ot,at=>n(16,u=at)),Zn(e,gt,at=>n(0,r=at));let q,W=!0;return oa(()=>{r&&q&&a&&(r4(K,r,q),Ls(gt,r=null,r),n(11,q=void 0))}),e.$$set=at=>{"id"in at&&n(4,b=at.id),"data"in at&&n(5,C=at.data),"generateId"in at&&n(6,A=at.generateId),"promoteId"in at&&n(7,P=at.promoteId),"filter"in at&&n(8,R=at.filter),"lineMetrics"in at&&n(9,et=at.lineMetrics),"cluster"in at&&n(10,X=at.cluster),"$$scope"in at&&n(14,c=at.$$scope)},e.$$.update=()=>{e.$$.dirty&1024&&Ls(ot,u=X,u),e.$$.dirty&12273&&a&&r!==b&&(Ls(gt,r=b,r),n4(a,r,oc({type:"geojson",data:C,filter:R,lineMetrics:et,generateId:A,promoteId:P,cluster:!!X,clusterMinPoints:X==null?void 0:X.minPoints,clusterMaxZoom:X==null?void 0:X.maxZoom,clusterRadius:X==null?void 0:X.radius,clusterProperties:X==null?void 0:X.properties}),at=>a&&at===r,()=>{r&&(n(11,q=a==null?void 0:a.getSource(r)),n(12,W=!0))})),e.$$.dirty&8208&&(a==null||a.on("style.load",()=>{n(11,q=a==null?void 0:a.getSource(b))})),e.$$.dirty&6176&&q&&(W?n(12,W=!1):q.setData(C)),e.$$.dirty&3072&&(q==null||q.setClusterOptions(oc({cluster:!!X,clusterMaxZoom:X==null?void 0:X.maxZoom,clusterRadius:X==null?void 0:X.radius})))},[r,K,ot,gt,b,C,A,P,R,et,X,q,W,a,c,p]}class s4 extends wr{constructor(t){super(),br(this,t,o4,i4,Gn,{id:4,data:5,generateId:6,promoteId:7,filter:8,lineMetrics:9,cluster:10})}}function a4(e){let t;const n=e[15].default,r=$i(n,e,e[23],null);return{c(){r&&r.c()},m(a,u){r&&r.m(a,u),t=!0},p(a,u){r&&r.p&&(!t||u&8388608)&&eo(r,n,a,a[23],t?to(n,a[23],u,null):no(a[23]),null)},i(a){t||(Yt(r,a),t=!0)},o(a){ae(r,a),t=!1},d(a){r&&r.d(a)}}}function l4(e){let t,n,r;function a(p){e[16](p)}let u={id:e[1],type:"line",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],minzoom:e[9],maxzoom:e[10],hoverCursor:e[11],manageHoverState:e[12],eventsIfTopMost:e[13],interactive:e[14],$$slots:{default:[a4]},$$scope:{ctx:e}};return e[0]!==void 0&&(u.hovered=e[0]),t=new A0({props:u}),li.push(()=>ts(t,"hovered",a)),t.$on("click",e[17]),t.$on("dblclick",e[18]),t.$on("contextmenu",e[19]),t.$on("mouseenter",e[20]),t.$on("mousemove",e[21]),t.$on("mouseleave",e[22]),{c(){pn(t.$$.fragment)},m(p,c){sn(t,p,c),r=!0},p(p,[c]){const b={};c&2&&(b.id=p[1]),c&4&&(b.source=p[2]),c&8&&(b.sourceLayer=p[3]),c&16&&(b.beforeId=p[4]),c&32&&(b.beforeLayerType=p[5]),c&64&&(b.paint=p[6]),c&128&&(b.layout=p[7]),c&256&&(b.filter=p[8]),c&512&&(b.minzoom=p[9]),c&1024&&(b.maxzoom=p[10]),c&2048&&(b.hoverCursor=p[11]),c&4096&&(b.manageHoverState=p[12]),c&8192&&(b.eventsIfTopMost=p[13]),c&16384&&(b.interactive=p[14]),c&8388608&&(b.$$scope={dirty:c,ctx:p}),!n&&c&1&&(n=!0,b.hovered=p[0],$o(()=>n=!1)),t.$set(b)},i(p){r||(Yt(t.$$.fragment,p),r=!0)},o(p){ae(t.$$.fragment,p),r=!1},d(p){an(t,p)}}}function u4(e,t,n){let{$$slots:r={},$$scope:a}=t,{id:u=sd("line")}=t,{source:p=void 0}=t,{sourceLayer:c=void 0}=t,{beforeId:b=void 0}=t,{beforeLayerType:C=void 0}=t,{paint:A}=t,{layout:P=void 0}=t,{filter:R=void 0}=t,{minzoom:et=void 0}=t,{maxzoom:X=void 0}=t,{hoverCursor:K=void 0}=t,{manageHoverState:ot=!1}=t,{hovered:gt=null}=t,{eventsIfTopMost:q=!1}=t,{interactive:W=!0}=t;function at(Q){gt=Q,n(0,gt)}function dt(Q){xn.call(this,e,Q)}function Pt(Q){xn.call(this,e,Q)}function Mt(Q){xn.call(this,e,Q)}function Tt(Q){xn.call(this,e,Q)}function Ut(Q){xn.call(this,e,Q)}function qt(Q){xn.call(this,e,Q)}return e.$$set=Q=>{"id"in Q&&n(1,u=Q.id),"source"in Q&&n(2,p=Q.source),"sourceLayer"in Q&&n(3,c=Q.sourceLayer),"beforeId"in Q&&n(4,b=Q.beforeId),"beforeLayerType"in Q&&n(5,C=Q.beforeLayerType),"paint"in Q&&n(6,A=Q.paint),"layout"in Q&&n(7,P=Q.layout),"filter"in Q&&n(8,R=Q.filter),"minzoom"in Q&&n(9,et=Q.minzoom),"maxzoom"in Q&&n(10,X=Q.maxzoom),"hoverCursor"in Q&&n(11,K=Q.hoverCursor),"manageHoverState"in Q&&n(12,ot=Q.manageHoverState),"hovered"in Q&&n(0,gt=Q.hovered),"eventsIfTopMost"in Q&&n(13,q=Q.eventsIfTopMost),"interactive"in Q&&n(14,W=Q.interactive),"$$scope"in Q&&n(23,a=Q.$$scope)},[gt,u,p,c,b,C,A,P,R,et,X,K,ot,q,W,r,at,dt,Pt,Mt,Tt,Ut,qt,a]}class c4 extends wr{constructor(t){super(),br(this,t,u4,l4,Gn,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}function h4(e){let t,n,r,a,u,p;return t=new e4({props:{id:"edit-polygon-fill",filter:A3,paint:{"fill-color":"red","fill-opacity":["case",["boolean",["get","hover"],"false"],1,.5]}}}),r=new c4({props:{id:"edit-polygon-lines",filter:M3,paint:{"line-color":"black","line-width":8,"line-opacity":.5}}}),u=new J3({props:{id:"edit-polygon-vertices",filter:D3,paint:{"circle-color":"black","circle-opacity":["case",["has","hovered"],1,.5],"circle-radius":10}}}),{c(){pn(t.$$.fragment),n=$e(),pn(r.$$.fragment),a=$e(),pn(u.$$.fragment)},m(c,b){sn(t,c,b),ke(c,n,b),sn(r,c,b),ke(c,a,b),sn(u,c,b),p=!0},p:Yr,i(c){p||(Yt(t.$$.fragment,c),Yt(r.$$.fragment,c),Yt(u.$$.fragment,c),p=!0)},o(c){ae(t.$$.fragment,c),ae(r.$$.fragment,c),ae(u.$$.fragment,c),p=!1},d(c){c&&(Me(n),Me(a)),an(t,c),an(r,c),an(u,c)}}}function p4(e){let t,n;return t=new s4({props:{data:e[0],$$slots:{default:[h4]},$$scope:{ctx:e}}}),{c(){pn(t.$$.fragment)},m(r,a){sn(t,r,a),n=!0},p(r,[a]){const u={};a&1&&(u.data=r[0]),a&2&&(u.$$scope={dirty:a,ctx:r}),t.$set(u)},i(r){n||(Yt(t.$$.fragment,r),n=!0)},o(r){ae(t.$$.fragment,r),n=!1},d(r){an(t,r)}}}function f4(e,t,n){let r;return Zn(e,K2,a=>n(0,r=a)),[r]}class d4 extends wr{constructor(t){super(),br(this,t,f4,p4,Gn,{})}}function m4(e){let t,n,r,a,u,p,c,b,C;return{c(){t=Ee("label"),n=Ee("input"),r=$e(),a=Vn(e[1]),u=$e(),p=Ee("input"),Tn(n,"type","checkbox"),Tn(p,"type","number"),p.disabled=c=!e[3],Tn(p,"step",e[2]),Tn(p,"min",e[2])},m(A,P){ke(A,t,P),ne(t,n),n.checked=e[3],ne(t,r),ne(t,a),ne(t,u),ne(t,p),Lh(p,e[0]),b||(C=[Or(n,"change",e[5]),Or(p,"input",e[6])],b=!0)},p(A,[P]){P&8&&(n.checked=A[3]),P&2&&Th(a,A[1]),P&8&&c!==(c=!A[3])&&(p.disabled=c),P&4&&Tn(p,"step",A[2]),P&4&&Tn(p,"min",A[2]),P&1&&tg(p.value)!==A[0]&&Lh(p,A[0])},i:Yr,o:Yr,d(A){A&&Me(t),b=!1,cs(C)}}}function g4(e,t,n){let{label:r}=t,{value:a}=t,{defaultNumber:u}=t,{step:p}=t,c=a!=null;function b(){c=this.checked,n(3,c)}function C(){a=tg(this.value),n(0,a),n(3,c),n(4,u)}return e.$$set=A=>{"label"in A&&n(1,r=A.label),"value"in A&&n(0,a=A.value),"defaultNumber"in A&&n(4,u=A.defaultNumber),"step"in A&&n(2,p=A.step)},e.$$.update=()=>{e.$$.dirty&25&&(c&&a==null?n(0,a=u):c||n(0,a=void 0))},[a,r,p,c,u,b,C]}class df extends wr{constructor(t){super(),br(this,t,g4,m4,Gn,{label:1,value:0,defaultNumber:4,step:2})}}function y4(e){let t,n,r,a,u,p,c,b,C,A,P,R,et,X,K,ot,gt,q,W,at,dt,Pt,Mt,Tt,Ut,qt,Q,Et,$t,le,Ye,Ie,ue,je,gn;function nn(ve){e[1](ve)}let Ze={label:"Remove holes in input polygons larger than this area (sq m)",defaultNumber:100,step:1};e[0].remove_holes!==void 0&&(Ze.value=e[0].remove_holes),a=new df({props:Ze}),li.push(()=>ts(a,"value",nn));function pe(ve){e[3](ve)}let Re={label:"Filter skeleton lines closer than this to the boundary (m)",defaultNumber:.1,step:1};e[0].filter_skeletons_near_boundary!==void 0&&(Re.value=e[0].filter_skeletons_near_boundary),R=new df({props:Re}),li.push(()=>ts(R,"value",pe));function dn(ve){e[5](ve)}let rn={label:"Remove short skeleton lines less than this ratio (to the longest)",defaultNumber:.1,step:.1};e[0].remove_short_skeletons!==void 0&&(rn.value=e[0].remove_short_skeletons),at=new df({props:rn}),li.push(()=>ts(at,"value",dn));function He(ve){e[6](ve)}let mn={label:"Generate perpendicular lines at this step size (m)",defaultNumber:5,step:.5};e[0].make_perps_step_size!==void 0&&(mn.value=e[0].make_perps_step_size),Mt=new df({props:mn}),li.push(()=>ts(Mt,"value",He));function Dn(ve){e[7](ve)}let kn={label:"If the ratio of lengths between each 'half' of a perpendicular line is less than this, skip it",defaultNumber:.5,step:.1};return e[0].perp_midpoint_ratio!==void 0&&(kn.value=e[0].perp_midpoint_ratio),qt=new df({props:kn}),li.push(()=>ts(qt,"value",Dn)),{c(){t=Ee("details"),n=Ee("summary"),n.textContent="Config",r=$e(),pn(a.$$.fragment),p=$e(),c=Ee("div"),b=Ee("label"),C=Ee("input"),A=Vn(`
      Filter skeleton lines outside polygon`),P=$e(),pn(R.$$.fragment),X=$e(),K=Ee("div"),ot=Ee("label"),gt=Ee("input"),q=Vn(`
      Join skeleton lines`),W=$e(),pn(at.$$.fragment),Pt=$e(),pn(Mt.$$.fragment),Ut=$e(),pn(qt.$$.fragment),Et=$e(),$t=Ee("div"),le=Ee("label"),Ye=Vn(`Granularity of width (m) in center lines
      `),Ie=Ee("input"),Tn(C,"type","checkbox"),Tn(gt,"type","checkbox"),Tn(Ie,"type","number"),Tn(Ie,"min","0.1"),Tn(Ie,"step","0.1"),t.open=!0,Tn(t,"class","svelte-eu3ecd")},m(ve,yn){ke(ve,t,yn),ne(t,n),ne(t,r),sn(a,t,null),ne(t,p),ne(t,c),ne(c,b),ne(b,C),C.checked=e[0].filter_skeletons_outside,ne(b,A),ne(t,P),sn(R,t,null),ne(t,X),ne(t,K),ne(K,ot),ne(ot,gt),gt.checked=e[0].join_skeletons,ne(ot,q),ne(t,W),sn(at,t,null),ne(t,Pt),sn(Mt,t,null),ne(t,Ut),sn(qt,t,null),ne(t,Et),ne(t,$t),ne($t,le),ne(le,Ye),ne(le,Ie),Lh(Ie,e[0].width_granularity),ue=!0,je||(gn=[Or(C,"change",e[2]),Or(gt,"change",e[4]),Or(Ie,"input",e[8])],je=!0)},p(ve,[yn]){const Xn={};!u&&yn&1&&(u=!0,Xn.value=ve[0].remove_holes,$o(()=>u=!1)),a.$set(Xn),yn&1&&(C.checked=ve[0].filter_skeletons_outside);const Y={};!et&&yn&1&&(et=!0,Y.value=ve[0].filter_skeletons_near_boundary,$o(()=>et=!1)),R.$set(Y),yn&1&&(gt.checked=ve[0].join_skeletons);const yt={};!dt&&yn&1&&(dt=!0,yt.value=ve[0].remove_short_skeletons,$o(()=>dt=!1)),at.$set(yt);const Ce={};!Tt&&yn&1&&(Tt=!0,Ce.value=ve[0].make_perps_step_size,$o(()=>Tt=!1)),Mt.$set(Ce);const Ke={};!Q&&yn&1&&(Q=!0,Ke.value=ve[0].perp_midpoint_ratio,$o(()=>Q=!1)),qt.$set(Ke),yn&1&&tg(Ie.value)!==ve[0].width_granularity&&Lh(Ie,ve[0].width_granularity)},i(ve){ue||(Yt(a.$$.fragment,ve),Yt(R.$$.fragment,ve),Yt(at.$$.fragment,ve),Yt(Mt.$$.fragment,ve),Yt(qt.$$.fragment,ve),ue=!0)},o(ve){ae(a.$$.fragment,ve),ae(R.$$.fragment,ve),ae(at.$$.fragment,ve),ae(Mt.$$.fragment,ve),ae(qt.$$.fragment,ve),ue=!1},d(ve){ve&&Me(t),an(a),an(R),an(at),an(Mt),an(qt),je=!1,cs(gn)}}}function _4(e,t,n){let{cfg:r}=t;function a(R){e.$$.not_equal(r.remove_holes,R)&&(r.remove_holes=R,n(0,r))}function u(){r.filter_skeletons_outside=this.checked,n(0,r)}function p(R){e.$$.not_equal(r.filter_skeletons_near_boundary,R)&&(r.filter_skeletons_near_boundary=R,n(0,r))}function c(){r.join_skeletons=this.checked,n(0,r)}function b(R){e.$$.not_equal(r.remove_short_skeletons,R)&&(r.remove_short_skeletons=R,n(0,r))}function C(R){e.$$.not_equal(r.make_perps_step_size,R)&&(r.make_perps_step_size=R,n(0,r))}function A(R){e.$$.not_equal(r.perp_midpoint_ratio,R)&&(r.perp_midpoint_ratio=R,n(0,r))}function P(){r.width_granularity=tg(this.value),n(0,r)}return e.$$set=R=>{"cfg"in R&&n(0,r=R.cfg)},[r,a,u,p,c,b,C,A,P]}class v4 extends wr{constructor(t){super(),br(this,t,_4,y4,Gn,{cfg:0})}}let A_={"just a rectangle":"POLYGON((-0.1008378 51.4893734,-0.099282 51.4898419,-0.0992257 51.4897652,-0.1007816 51.4893016,-0.1008378 51.4893734))","simple L":"POLYGON((-0.1021076 51.4896734,-0.1015438 51.489379,-0.10134 51.4895191,-0.101303 51.4894982,-0.1015399 51.4893283,-0.102142 51.4896457,-0.1021076 51.4896734))","many width changes":"POLYGON((-0.1018838 51.4895115,-0.1017193 51.4894192,-0.1016939 51.4894361,-0.1016541 51.4894124,-0.1016219 51.4894303,-0.1015788 51.489405,-0.1016067 51.4893771,-0.1014222 51.4892885,-0.1015086 51.4892326,-0.1016694 51.4893138,-0.1016423 51.4893317,-0.1016804 51.4893581,-0.1017074 51.4893381,-0.1018361 51.4894213,-0.1018818 51.4894061,-0.1019284 51.4894366,-0.1019038 51.4894609,-0.1019443 51.4894764,-0.1018838 51.4895115))","very wide and uneven":"POLYGON((13.3562208 52.5297463,13.3560897 52.5299508,13.3569956 52.5304672,13.3562493 52.5304083,13.3558676 52.5300582,13.3555314 52.5296423,13.3562094 52.5294482,13.3568987 52.5294309,13.3577818 52.5295522,13.3583401 52.52993,13.3587674 52.5301692,13.3584882 52.5303771,13.3584939 52.5307341,13.3582318 52.5308485,13.3577989 52.5304568,13.3574285 52.5298918,13.3562208 52.5297463))","curvy L":"POLYGON((-0.1243813 51.50106430000000302,-0.12479800000000001 51.50107640000000231,-0.124885 51.5010789000000031,-0.12497220000000001 51.50108149999999796,-0.1253871 51.50109350000000319,-0.12541060000000001 51.50109570000000048,-0.12542239999999999 51.50110159999999837,-0.12542890000000001 51.50111030000000056,-0.12543509999999999 51.50112359999999967,-0.12545809999999999 51.50110420000000033,-0.12545709999999999 51.50107719999999745,-0.12545609999999999 51.5010667999999967,-0.12544810000000001 51.5010594000000026,-0.1254353 51.50105560000000082,-0.1246506 51.50103409999999826,-0.12443170000000001 51.50102569999999957,-0.12438639999999999 51.50102669999999705,-0.1243496 51.50103200000000214,-0.12431739999999999 51.50104309999999685,-0.12429270000000001 51.50105359999999877,-0.12426570000000001 51.50106999999999857,-0.1242398 51.50109479999999706,-0.1242162 51.50114039999999704,-0.1241848 51.50121070000000145,-0.1242273 51.50124189999999658,-0.124194 51.50146910000000133,-0.1241453 51.50149749999999926,-0.1241608 51.50152549999999962,-0.1242166 51.50152560000000079,-0.12429419999999999 51.50152539999999846,-0.1243064 51.50136369999999886,-0.1243146 51.50125529999999685,-0.12432699999999999 51.50109170000000347,-0.124332 51.50107959999999707,-0.12434290000000001 51.50107030000000208,-0.12435839999999999 51.50106569999999806,-0.1243813 51.50106430000000302))","long T":"POLYGON((-0.1260973 51.5058446000000032,-0.12657669999999999 51.50572009999999779,-0.12660589999999999 51.50571370000000115,-0.1266294 51.50571430000000106,-0.12665290000000001 51.50571970000000022,-0.12668209999999999 51.50573920000000072,-0.12663720000000001 51.50564150000000296,-0.12659709999999999 51.50555210000000272,-0.12659200000000001 51.50557280000000304,-0.1265868 51.50558379999999659,-0.12657009999999999 51.50560089999999747,-0.12652959999999999 51.50562939999999656,-0.12645680000000001 51.50565790000000277,-0.12637019999999999 51.50568280000000243,-0.124559 51.50615839999999679,-0.1245126 51.50616699999999781,-0.1244765 51.50617210000000057,-0.1244473 51.506171700000003,-0.1244131 51.506165799999998,-0.124389 51.50615549999999843,-0.1243693 51.50613859999999988,-0.1243541 51.50611800000000073,-0.1243522 51.50609990000000238,-0.12437719999999999 51.50603350000000091,-0.1244817 51.50577839999999696,-0.1247093 51.50522269999999736,-0.1247944 51.50521030000000167,-0.1247582 51.5052012000000019,-0.12474109999999999 51.5051910000000035,-0.1247341 51.50517750000000206,-0.12473919999999999 51.50515980000000127,-0.1247856 51.50510289999999713,-0.1247409 51.5050965000000005,-0.12468310000000001 51.50508820000000298,-0.1246582 51.50514559999999875,-0.12468319999999999 51.50514960000000286,-0.12442640000000001 51.50576829999999973,-0.1243972 51.50583859999999703,-0.1243731 51.50583389999999895,-0.1242501 51.50613150000000218,-0.12421840000000001 51.50619970000000336,-0.12420639999999999 51.50622260000000097,-0.1241867 51.50624040000000292,-0.1241601 51.50625649999999922,-0.12413730000000001 51.50626439999999917,-0.1241252 51.50626760000000104,-0.1240834 51.50625930000000352,-0.1236097 51.5063847999999993,-0.1236232 51.50640489999999971,-0.1236227 51.50641130000000345,-0.1236408 51.50643889999999914,-0.1236559 51.50646179999999674,-0.12366489999999999 51.50646600000000319,-0.1236685 51.50646929999999912,-0.1236752 51.50647740000000141,-0.12368460000000001 51.5064801999999986,-0.1236993 51.50647850000000005,-0.12549199999999999 51.50601300000000293,-0.1255077 51.50601460000000031,-0.12551889999999999 51.50602099999999695,-0.12552430000000001 51.50603050000000138,-0.12559310000000001 51.5060128000000006,-0.12560540000000001 51.50600959999999873,-0.1256023 51.5060001000000014,-0.12560499999999999 51.50598759999999743,-0.125613 51.50597719999999669,-0.1256225 51.50597049999999655,-0.12562889999999999 51.50596790000000169,-0.1259643 51.50588599999999673,-0.12598429999999999 51.50586229999999688,-0.12606410000000001 51.50584039999999675,-0.1260973 51.5058446000000032))","complex loop":"POLYGON((13.37066169999999943 52.52428640000000115,13.37065879999999929 52.52477549999999695,13.3706517999999992 52.52570510000000326,13.37065049999999999 52.52577130000000238,13.37064699999999995 52.52577709999999911,13.37064080000000033 52.52578079999999972,13.37063110000000066 52.52578309999999817,13.37061910000000076 52.52578390000000041,13.3703328999999993 52.52578319999999934,13.37032950000000042 52.52577449999999715,13.37032969999999921 52.52576140000000038,13.37043710000000019 52.52576200000000028,13.3704376000000007 52.52572750000000212,13.37005229999999933 52.52572550000000007,13.37005169999999943 52.52576239999999785,13.37022559999999949 52.52576330000000127,13.3702255000000001 52.52577399999999841,13.37021969999999982 52.525782999999997,13.36828670000000052 52.52577120000000122,13.36826390000000053 52.52576830000000285,13.36824660000000087 52.52576100000000281,13.36823719999999938 52.52574839999999767,13.36823590000000017 52.52573370000000352,13.36823730000000054 52.525621000000001,13.36825750000000035 52.52562110000000217,13.3682692000000003 52.52562050000000227,13.36827730000000081 52.52561670000000049,13.36828260000000057 52.52561039999999792,13.3682824999999994 52.52560220000000157,13.36828670000000052 52.52521670000000142,13.3682856000000001 52.52521089999999759,13.36828019999999917 52.52520609999999834,13.36827489999999941 52.52520340000000232,13.36826650000000072 52.52520220000000251,13.36823919999999966 52.525201899999999,13.36824350000000017 52.52425300000000163,13.36824359999999956 52.52423960000000136,13.36824440000000003 52.524230799999998,13.36824930000000045 52.52422440000000137,13.36826720000000002 52.52421819999999997,13.36830529999999939 52.52421760000000006,13.37063009999999963 52.52422640000000342,13.37065029999999943 52.52422680000000099,13.37066000000000088 52.524230799999998,13.37066489999999952 52.52423819999999921,13.37066169999999943 52.52428640000000115),(13.37062449999999991 52.52428900000000311,13.37045250000000074 52.52429289999999895,13.37029519999999927 52.52429469999999867,13.37028849999999913 52.52429300000000012,13.37023789999999934 52.52436529999999948,13.36991229999999931 52.52436569999999705,13.36991070000000015 52.52436689999999686,13.36973790000000051 52.52436600000000055,13.36972029999999911 52.52436610000000172,13.36970320000000001 52.52436610000000172,13.3696868000000002 52.52436610000000172,13.36966920000000059 52.52436610000000172,13.36965179999999975 52.52436620000000289,13.36963420000000013 52.52436620000000289,13.36961709999999925 52.52436620000000289,13.36958470000000077 52.52436629999999695,13.3695877000000003 52.52436209999999761,13.36958100000000016 52.52436029999999789,13.36962899999999976 52.52429240000000021,13.36929310000000015 52.52429200000000264,13.36928799999999917 52.52429959999999909,13.36927140000000058 52.52432389999999884,13.36912519999999915 52.52432379999999768,13.36908039999999964 52.52432379999999768,13.36900409999999972 52.52432389999999884,13.36892819999999915 52.52432400000000001,13.36835690000000021 52.52432089999999931,13.36834799999999923 52.52562429999999694,13.36834559999999961 52.52565030000000235,13.36829110000000043 52.5257284999999996,13.36859150000000085 52.52573180000000264,13.36860719999999958 52.52571009999999774,13.36869699999999916 52.52558520000000186,13.36934220000000018 52.52568819999999761,13.36931719999999935 52.52572609999999997,13.36941140000000061 52.52572529999999773,13.3695567000000004 52.52572419999999909,13.36961980000000061 52.52572500000000133,13.36983350000000037 52.52570740000000171,13.3699198999999993 52.52570730000000054,13.36998610000000021 52.52570759999999694,13.37055490000000013 52.52570630000000307,13.37056229999999957 52.5247286000000031,13.37056409999999929 52.52468470000000167,13.37057730000000078 52.52435299999999785,13.37062449999999991 52.52428900000000311))"},Tb=/[-+]?([0-9]*\.[0-9]+|[0-9]+)([eE][-+]?[0-9]+)?/,Lb=new RegExp("^"+Tb.source+"(\\s"+Tb.source+"){1,}");const x4=e=>{let t=e.split(";"),n=t.pop(),r=(t.shift()||"").split("=").pop(),a=0;function u(q){let W=n.substring(a).match(q);return W?(a+=W[0].length,W[0]):null}function p(q){return q&&r.match(/\d+/)&&(q.crs={type:"name",properties:{name:"urn:ogc:def:crs:EPSG::"+r}}),q}function c(){u(/^\s*/)}function b(){c();let q=0,W=[],at=[W],dt=W,Pt;for(;Pt=u(/^(\()/)||u(/^(\))/)||u(/^(,)/)||u(Lb);){if(Pt==="(")at.push(dt),dt=[],at[at.length-1].push(dt),q++;else if(Pt===")"){if(dt.length===0||(dt=at.pop(),!dt))return null;if(q--,q===0)break}else if(Pt===",")dt=[],at[at.length-1].push(dt);else if(!Pt.split(/\s/g).some(isNaN))Array.prototype.push.apply(dt,Pt.split(/\s/g).map(parseFloat));else return null;c()}return q!==0?null:W}function C(){let q=[],W,at;for(;at=u(Lb)||u(/^(,)/);)at===","?(q.push(W),W=[]):at.split(/\s/g).some(isNaN)||(W||(W=[]),Array.prototype.push.apply(W,at.split(/\s/g).map(parseFloat))),c();if(W)q.push(W);else return null;return q.length?q:null}function A(){if(!u(/^(point(\sz)?)/i)||(c(),!u(/^(\()/)))return null;let q=C();return!q||(c(),!u(/^(\))/))?null:{type:"Point",coordinates:q[0]}}function P(){if(!u(/^(multipoint(\sz)?)/i))return null;c(),n="MULTIPOINT ("+n.substring(n.indexOf("(")+1,n.length-1).replace(/\(/g,"").replace(/\)/g,"")+")";let W=b();return W?(c(),{type:"MultiPoint",coordinates:W}):null}function R(){if(!u(/^(multilinestring(\sz)?)/i))return null;c();let q=b();return q?(c(),{type:"MultiLineString",coordinates:q}):null}function et(){if(!u(/^(linestring(\sz)?)/i)||(c(),!u(/^(\()/)))return null;let q=C();return!q||!u(/^(\))/)?null:{type:"LineString",coordinates:q}}function X(){if(!u(/^(polygon(\sz)?)/i))return null;c();let q=b();return q?{type:"Polygon",coordinates:q}:null}function K(){if(!u(/^(multipolygon(\sz)?)/i))return null;c();let q=b();return q?{type:"MultiPolygon",coordinates:q}:null}function ot(){let q=[],W;if(!u(/^(geometrycollection)/i)||(c(),!u(/^(\()/)))return null;for(;W=gt();)q.push(W),c(),u(/^(,)/),c();return u(/^(\))/)?{type:"GeometryCollection",geometries:q}:null}function gt(){return A()||et()||X()||P()||R()||K()||ot()}return p(gt())},tS=e=>{e.type==="Feature"&&(e=e.geometry);function t(c){return c.join(" ")}function n(c){return c.map(t).join(", ")}function r(c){return c.map(n).map(u).join(", ")}function a(c){return c.map(r).map(u).join(", ")}function u(c){return"("+c+")"}let p=e;switch(p.type){case"Point":return p.coordinates&&p.coordinates.length===3?"POINT Z ("+t(p.coordinates)+")":"POINT ("+t(p.coordinates)+")";case"LineString":return p.coordinates&&p.coordinates[0]&&p.coordinates[0].length===3?"LINESTRING Z ("+n(p.coordinates)+")":"LINESTRING ("+n(p.coordinates)+")";case"Polygon":return p.coordinates&&p.coordinates[0]&&p.coordinates[0][0]&&p.coordinates[0][0].length===3?"POLYGON Z ("+r(p.coordinates)+")":"POLYGON ("+r(p.coordinates)+")";case"MultiPoint":return p.coordinates&&p.coordinates[0]&&p.coordinates[0].length===3?"MULTIPOINT Z ("+n(p.coordinates)+")":"MULTIPOINT ("+n(p.coordinates)+")";case"MultiLineString":return p.coordinates&&p.coordinates[0]&&p.coordinates[0][0]&&p.coordinates[0][0].length===3?"MULTILINESTRING Z ("+r(p.coordinates)+")":"MULTILINESTRING ("+r(p.coordinates)+")";case"MultiPolygon":return p.coordinates&&p.coordinates[0]&&p.coordinates[0][0]&&p.coordinates[0][0]&&p.coordinates[0][0][0].length===3?"MULTIPOLYGON Z ("+a(p.coordinates)+")":"MULTIPOLYGON ("+a(p.coordinates)+")";case"GeometryCollection":return"GEOMETRYCOLLECTION ("+p.geometries.map(tS).join(", ")+")";default:throw new Error("stringify requires a valid GeoJSON Feature or geometry object as input")}};var b4={parse:x4,stringify:tS};let eS=Ji(null);function sp(e){return{id:e,beforeId:w4(e)}}function w4(e){let t=D_(eS);if(!t){console.warn(`getBeforeId(${e}) called before map is ready. Z-ordering may be incorrect.`);return}let n,r=!1;for(let a=Pb.length-1;a>=0;a--){let u=Pb[a];if(u==e){r=!0;break}t.getLayer(u)&&(n=u)}if(!r)throw new Error(`Layer ID ${e} not defined in layerZorder`);return n}const Pb=["Road labels","input-polygons","skeletons","perps","thickened","center-with-width","center-endpoints"];function Ab(e,t,n){const r=e.slice();return r[36]=t[n],r}function S4(e){let t,n,r,a,u,p,c,b,C,A,P,R,et,X,K,ot=e[8]&&Mb(e),gt=c1(Object.keys(A_)),q=[];for(let W=0;W<gt.length;W+=1)q[W]=Db(Ab(e,gt,W));return{c(){t=Ee("label"),n=Vn(`Load a .geojson file with polygons
          `),r=Ee("input"),a=$e(),u=Ee("div"),p=Ee("button"),p.textContent="Draw your own polygon",c=$e(),ot&&ot.c(),b=$e(),C=Ee("label"),A=Vn(`Choose a test case:

          `),P=Ee("select"),R=Ee("option"),R.textContent="None";for(let W=0;W<q.length;W+=1)q[W].c();et=Vn(`

          (some from OpenStreetMap)`),Tn(r,"type","file"),Tn(p,"type","button"),R.__value="",Lh(R,R.__value),e[1]===void 0&&Lm(()=>e[25].call(P))},m(W,at){ke(W,t,at),ne(t,n),ne(t,r),e[21](r),ke(W,a,at),ke(W,u,at),ne(u,p),ke(W,c,at),ot&&ot.m(W,at),ke(W,b,at),ke(W,C,at),ne(C,A),ne(C,P),ne(P,R);for(let dt=0;dt<q.length;dt+=1)q[dt]&&q[dt].m(P,null);l1(P,e[1],!0),ne(C,et),X||(K=[Or(r,"change",e[17]),Or(p,"click",e[22]),Or(P,"change",e[25])],X=!0)},p(W,at){if(W[8]?ot?ot.p(W,at):(ot=Mb(W),ot.c(),ot.m(b.parentNode,b)):ot&&(ot.d(1),ot=null),at&0){gt=c1(Object.keys(A_));let dt;for(dt=0;dt<gt.length;dt+=1){const Pt=Ab(W,gt,dt);q[dt]?q[dt].p(Pt,at):(q[dt]=Db(Pt),q[dt].c(),q[dt].m(P,null))}for(;dt<q.length;dt+=1)q[dt].d(1);q.length=gt.length}at[0]&2&&l1(P,W[1])},i:Yr,o:Yr,d(W){W&&(Me(t),Me(a),Me(u),Me(c),Me(b),Me(C)),e[21](null),ot&&ot.d(W),QI(q,W),X=!1,cs(K)}}}function I4(e){let t,n;return t=new B3({props:{polygonTool:e[16]}}),{c(){pn(t.$$.fragment)},m(r,a){sn(t,r,a),n=!0},p(r,a){const u={};a[0]&65536&&(u.polygonTool=r[16]),t.$set(u)},i(r){n||(Yt(t.$$.fragment,r),n=!0)},o(r){ae(t.$$.fragment,r),n=!1},d(r){an(t,r)}}}function Mb(e){let t,n,r,a,u,p,c,b;return{c(){t=Ee("div"),n=Ee("button"),n.textContent="Copy polygon as WKT",r=$e(),a=Ee("button"),u=Vn("Edit polygon"),Tn(n,"class","secondary"),Tn(a,"class","secondary"),a.disabled=p=e[16]!=null},m(C,A){ke(C,t,A),ne(t,n),ne(t,r),ne(t,a),ne(a,u),c||(b=[Or(n,"click",e[23]),Or(a,"click",e[24])],c=!0)},p(C,A){A[0]&65536&&p!==(p=C[16]!=null)&&(a.disabled=p)},d(C){C&&Me(t),c=!1,cs(b)}}}function Db(e){let t,n=e[36]+"",r;return{c(){t=Ee("option"),r=Vn(n),t.__value=e[36],Lh(t,t.__value)},m(a,u){ke(a,t,u),ne(t,r)},p:Yr,d(a){a&&Me(t)}}}function E4(e){let t,n,r,a,u,p,c,b,C,A,P,R,et,X,K,ot,gt,q,W,at,dt,Pt,Mt,Tt,Ut,qt,Q,Et,$t,le,Ye,Ie,ue,je,gn,nn,Ze,pe,Re,dn,rn,He,mn;const Dn=[I4,S4],kn=[];function ve(Y,yt){return Y[16]?0:1}C=ve(e),A=kn[C]=Dn[C](e);function yn(Y){e[31](Y)}let Xn={};return e[2]!==void 0&&(Xn.cfg=e[2]),Re=new v4({props:Xn}),li.push(()=>ts(Re,"cfg",yn)),{c(){t=Ee("div"),n=Ee("h1"),n.textContent="Polygon width",r=$e(),a=Ee("a"),a.textContent="About",u=$e(),p=Ee("details"),c=Ee("summary"),c.textContent="Input",b=$e(),A.c(),P=$e(),R=Ee("hr"),et=$e(),X=Ee("details"),K=Ee("summary"),K.textContent="Layers",ot=$e(),gt=Ee("label"),q=Ee("input"),W=Vn(`
        Show input polygons`),at=$e(),dt=Ee("label"),Pt=Ee("input"),Mt=Vn(`
        Show center line`),Tt=$e(),Ut=Ee("label"),qt=Ee("input"),Q=Vn(`
        Show perpendicular lines`),Et=$e(),$t=Ee("label"),le=Ee("input"),Ye=Vn(`
        Show thickened polygons`),Ie=$e(),ue=Ee("label"),je=Ee("input"),gn=Vn(`
        Show center lines with width`),nn=$e(),Ze=Ee("hr"),pe=$e(),pn(Re.$$.fragment),Tn(a,"href","https://github.com/dabreegster/polygon-width?tab=readme-ov-file#polygon-width"),Tn(a,"target","_blank"),p.open=!0,Tn(p,"class","svelte-eu3ecd"),Tn(q,"type","checkbox"),Tn(Pt,"type","checkbox"),Tn(qt,"type","checkbox"),Tn(le,"type","checkbox"),Tn(je,"type","checkbox"),X.open=!0,Tn(X,"class","svelte-eu3ecd"),Tn(t,"slot","left")},m(Y,yt){ke(Y,t,yt),ne(t,n),ne(t,r),ne(t,a),ne(t,u),ne(t,p),ne(p,c),ne(p,b),kn[C].m(p,null),ne(t,P),ne(t,R),ne(t,et),ne(t,X),ne(X,K),ne(X,ot),ne(X,gt),ne(gt,q),q.checked=e[9],ne(gt,W),ne(X,at),ne(X,dt),ne(dt,Pt),Pt.checked=e[10],ne(dt,Mt),ne(X,Tt),ne(X,Ut),ne(Ut,qt),qt.checked=e[11],ne(Ut,Q),ne(X,Et),ne(X,$t),ne($t,le),le.checked=e[12],ne($t,Ye),ne(X,Ie),ne(X,ue),ne(ue,je),je.checked=e[13],ne(ue,gn),ne(t,nn),ne(t,Ze),ne(t,pe),sn(Re,t,null),rn=!0,He||(mn=[Or(q,"change",e[26]),Or(Pt,"change",e[27]),Or(qt,"change",e[28]),Or(le,"change",e[29]),Or(je,"change",e[30])],He=!0)},p(Y,yt){let Ce=C;C=ve(Y),C===Ce?kn[C].p(Y,yt):(Bo(),ae(kn[Ce],1,1,()=>{kn[Ce]=null}),Vo(),A=kn[C],A?A.p(Y,yt):(A=kn[C]=Dn[C](Y),A.c()),Yt(A,1),A.m(p,null)),yt[0]&512&&(q.checked=Y[9]),yt[0]&1024&&(Pt.checked=Y[10]),yt[0]&2048&&(qt.checked=Y[11]),yt[0]&4096&&(le.checked=Y[12]),yt[0]&8192&&(je.checked=Y[13]);const Ke={};!dn&&yt[0]&4&&(dn=!0,Ke.cfg=Y[2],$o(()=>dn=!1)),Re.$set(Ke)},i(Y){rn||(Yt(A),Yt(Re.$$.fragment,Y),rn=!0)},o(Y){ae(A),ae(Re.$$.fragment,Y),rn=!1},d(Y){Y&&Me(t),kn[C].d(),an(Re),He=!1,cs(mn)}}}function C4(e){let t,n;const r=[sp("input-polygons"),{paint:{"fill-color":"black","fill-opacity":.5}},{layout:{visibility:e[9]?"visible":"none"}}];let a={};for(let u=0;u<r.length;u+=1)a=ac(a,r[u]);return t=new z2({props:a}),{c(){pn(t.$$.fragment)},m(u,p){sn(t,u,p),n=!0},p(u,p){const c=p[0]&512?Jh(r,[r[0],r[1],{layout:{visibility:u[9]?"visible":"none"}}]):{};t.$set(c)},i(u){n||(Yt(t.$$.fragment,u),n=!0)},o(u){ae(t.$$.fragment,u),n=!1},d(u){an(t,u)}}}function T4(e){let t,n;const r=[sp("skeletons"),{manageHoverState:!0},{paint:{"line-color":b0("red","blue"),"line-width":4}},{layout:{visibility:e[10]?"visible":"none"}}];let a={};for(let u=0;u<r.length;u+=1)a=ac(a,r[u]);return t=new S0({props:a}),{c(){pn(t.$$.fragment)},m(u,p){sn(t,u,p),n=!0},p(u,p){const c=p[0]&1024?Jh(r,[r[0],r[1],r[2],{layout:{visibility:u[10]?"visible":"none"}}]):{};t.$set(c)},i(u){n||(Yt(t.$$.fragment,u),n=!0)},o(u){ae(t.$$.fragment,u),n=!1},d(u){an(t,u)}}}function L4(e){let t,n;const r=[sp("perps"),{paint:{"line-color":"green","line-width":2}},{layout:{visibility:e[11]?"visible":"none"}}];let a={};for(let u=0;u<r.length;u+=1)a=ac(a,r[u]);return t=new S0({props:a}),{c(){pn(t.$$.fragment)},m(u,p){sn(t,u,p),n=!0},p(u,p){const c=p[0]&2048?Jh(r,[r[0],r[1],{layout:{visibility:u[11]?"visible":"none"}}]):{};t.$set(c)},i(u){n||(Yt(t.$$.fragment,u),n=!0)},o(u){ae(t.$$.fragment,u),n=!1},d(u){an(t,u)}}}function P4(e){let t,n,r=e[35].width1.toFixed(1)+"",a,u,p=e[35].width2.toFixed(1)+"",c,b;return{c(){t=Ee("p"),n=Vn("Width between "),a=Vn(r),u=Vn("m and "),c=Vn(p),b=Vn("m")},m(C,A){ke(C,t,A),ne(t,n),ne(t,a),ne(t,u),ne(t,c),ne(t,b)},p(C,A){A[1]&16&&r!==(r=C[35].width1.toFixed(1)+"")&&Th(a,r),A[1]&16&&p!==(p=C[35].width2.toFixed(1)+"")&&Th(c,p)},d(C){C&&Me(t)}}}function A4(e){let t,n;return t=new N2({props:{$$slots:{default:[P4,({props:r})=>({35:r}),({props:r})=>[0,r?16:0]]},$$scope:{ctx:e}}}),{c(){pn(t.$$.fragment)},m(r,a){sn(t,r,a),n=!0},p(r,a){const u={};a[1]&272&&(u.$$scope={dirty:a,ctx:r}),t.$set(u)},i(r){n||(Yt(t.$$.fragment,r),n=!0)},o(r){ae(t.$$.fragment,r),n=!1},d(r){an(t,r)}}}function M4(e){let t,n;const r=[sp("thickened"),{manageHoverState:!0},{paint:{"fill-color":"cyan","fill-opacity":b0(.5,.8)}},{layout:{visibility:e[12]?"visible":"none"}}];let a={$$slots:{default:[A4]},$$scope:{ctx:e}};for(let u=0;u<r.length;u+=1)a=ac(a,r[u]);return t=new z2({props:a}),{c(){pn(t.$$.fragment)},m(u,p){sn(t,u,p),n=!0},p(u,p){const c=p[0]&4096?Jh(r,[r[0],r[1],r[2],{layout:{visibility:u[12]?"visible":"none"}}]):{};p[1]&256&&(c.$$scope={dirty:p,ctx:u}),t.$set(c)},i(u){n||(Yt(t.$$.fragment,u),n=!0)},o(u){ae(t.$$.fragment,u),n=!1},d(u){an(t,u)}}}function D4(e){let t,n=e[35].min_width.toFixed(1)+"",r,a,u=e[35].max_width.toFixed(1)+"",p,c;return{c(){t=Ee("p"),r=Vn(n),a=Vn(" - "),p=Vn(u),c=Vn("m")},m(b,C){ke(b,t,C),ne(t,r),ne(t,a),ne(t,p),ne(t,c)},p(b,C){C[1]&16&&n!==(n=b[35].min_width.toFixed(1)+"")&&Th(r,n),C[1]&16&&u!==(u=b[35].max_width.toFixed(1)+"")&&Th(p,u)},d(b){b&&Me(t)}}}function k4(e){let t,n;return t=new N2({props:{$$slots:{default:[D4,({props:r})=>({35:r}),({props:r})=>[0,r?16:0]]},$$scope:{ctx:e}}}),{c(){pn(t.$$.fragment)},m(r,a){sn(t,r,a),n=!0},p(r,a){const u={};a[1]&272&&(u.$$scope={dirty:a,ctx:r}),t.$set(u)},i(r){n||(Yt(t.$$.fragment,r),n=!0)},o(r){ae(t.$$.fragment,r),n=!1},d(r){an(t,r)}}}function R4(e){let t,n;const r=[sp("center-with-width"),{manageHoverState:!0},{paint:{"line-color":b0("purple","black"),"line-width":6}},{layout:{visibility:e[13]?"visible":"none"}}];let a={$$slots:{default:[k4]},$$scope:{ctx:e}};for(let u=0;u<r.length;u+=1)a=ac(a,r[u]);return t=new S0({props:a}),{c(){pn(t.$$.fragment)},m(u,p){sn(t,u,p),n=!0},p(u,p){const c=p[0]&8192?Jh(r,[r[0],r[1],r[2],{layout:{visibility:u[13]?"visible":"none"}}]):{};p[1]&256&&(c.$$scope={dirty:p,ctx:u}),t.$set(c)},i(u){n||(Yt(t.$$.fragment,u),n=!0)},o(u){ae(t.$$.fragment,u),n=!1},d(u){an(t,u)}}}function N4(e){let t,n;const r=[sp("center-endpoints"),{paint:{"circle-opacity":0,"circle-radius":10,"circle-stroke-color":"purple","circle-stroke-width":2}},{layout:{visibility:e[13]?"visible":"none"}}];let a={};for(let u=0;u<r.length;u+=1)a=ac(a,r[u]);return t=new x5({props:a}),{c(){pn(t.$$.fragment)},m(u,p){sn(t,u,p),n=!0},p(u,p){const c=p[0]&8192?Jh(r,[r[0],r[1],{layout:{visibility:u[13]?"visible":"none"}}]):{};t.$set(c)},i(u){n||(Yt(t.$$.fragment,u),n=!0)},o(u){ae(t.$$.fragment,u),n=!1},d(u){an(t,u)}}}function O4(e){let t,n,r,a,u,p,c,b,C,A,P,R,et,X;return t=new d4({}),r=new _h({props:{id:"input",data:e[3],$$slots:{default:[C4]},$$scope:{ctx:e}}}),u=new _h({props:{id:"skeletons",data:e[4],generateId:!0,$$slots:{default:[T4]},$$scope:{ctx:e}}}),c=new _h({props:{id:"perps",data:e[5],$$slots:{default:[L4]},$$scope:{ctx:e}}}),C=new _h({props:{id:"thickened",data:e[6],generateId:!0,$$slots:{default:[M4]},$$scope:{ctx:e}}}),P=new _h({props:{id:"centerWithWidth",data:e[7],generateId:!0,$$slots:{default:[R4]},$$scope:{ctx:e}}}),et=new _h({props:{id:"centerWithWidth",data:Rb(e[7]),$$slots:{default:[N4]},$$scope:{ctx:e}}}),{c(){pn(t.$$.fragment),n=$e(),pn(r.$$.fragment),a=$e(),pn(u.$$.fragment),p=$e(),pn(c.$$.fragment),b=$e(),pn(C.$$.fragment),A=$e(),pn(P.$$.fragment),R=$e(),pn(et.$$.fragment)},m(K,ot){sn(t,K,ot),ke(K,n,ot),sn(r,K,ot),ke(K,a,ot),sn(u,K,ot),ke(K,p,ot),sn(c,K,ot),ke(K,b,ot),sn(C,K,ot),ke(K,A,ot),sn(P,K,ot),ke(K,R,ot),sn(et,K,ot),X=!0},p(K,ot){const gt={};ot[0]&8&&(gt.data=K[3]),ot[0]&512|ot[1]&256&&(gt.$$scope={dirty:ot,ctx:K}),r.$set(gt);const q={};ot[0]&16&&(q.data=K[4]),ot[0]&1024|ot[1]&256&&(q.$$scope={dirty:ot,ctx:K}),u.$set(q);const W={};ot[0]&32&&(W.data=K[5]),ot[0]&2048|ot[1]&256&&(W.$$scope={dirty:ot,ctx:K}),c.$set(W);const at={};ot[0]&64&&(at.data=K[6]),ot[0]&4096|ot[1]&256&&(at.$$scope={dirty:ot,ctx:K}),C.$set(at);const dt={};ot[0]&128&&(dt.data=K[7]),ot[0]&8192|ot[1]&256&&(dt.$$scope={dirty:ot,ctx:K}),P.$set(dt);const Pt={};ot[0]&128&&(Pt.data=Rb(K[7])),ot[0]&8192|ot[1]&256&&(Pt.$$scope={dirty:ot,ctx:K}),et.$set(Pt)},i(K){X||(Yt(t.$$.fragment,K),Yt(r.$$.fragment,K),Yt(u.$$.fragment,K),Yt(c.$$.fragment,K),Yt(C.$$.fragment,K),Yt(P.$$.fragment,K),Yt(et.$$.fragment,K),X=!0)},o(K){ae(t.$$.fragment,K),ae(r.$$.fragment,K),ae(u.$$.fragment,K),ae(c.$$.fragment,K),ae(C.$$.fragment,K),ae(P.$$.fragment,K),ae(et.$$.fragment,K),X=!1},d(K){K&&(Me(n),Me(a),Me(p),Me(b),Me(A),Me(R)),an(t,K),an(r,K),an(u,K),an(c,K),an(C,K),an(P,K),an(et,K)}}}function z4(e){let t,n,r,a;function u(c){e[20](c)}let p={style:`https://api.maptiler.com/maps/dataviz/style.json?key=${V4}`,standardControls:!0,hash:!0,$$slots:{default:[O4]},$$scope:{ctx:e}};return e[0]!==void 0&&(p.map=e[0]),n=new W5({props:p}),li.push(()=>ts(n,"map",u)),{c(){t=Ee("div"),pn(n.$$.fragment),Tn(t,"slot","main"),bf(t,"position","relative"),bf(t,"width","100%"),bf(t,"height","100vh")},m(c,b){ke(c,t,b),sn(n,t,null),a=!0},p(c,b){const C={};b[0]&16120|b[1]&256&&(C.$$scope={dirty:b,ctx:c}),!r&&b[0]&1&&(r=!0,C.map=c[0],$o(()=>r=!1)),n.$set(C)},i(c){a||(Yt(n.$$.fragment,c),a=!0)},o(c){ae(n.$$.fragment,c),a=!1},d(c){c&&Me(t),an(n)}}}function kb(e){let t,n;return t=new wE({props:{$$slots:{default:[F4]},$$scope:{ctx:e}}}),t.$on("close",e[32]),{c(){pn(t.$$.fragment)},m(r,a){sn(t,r,a),n=!0},p(r,a){const u={};a[0]&256|a[1]&256&&(u.$$scope={dirty:a,ctx:r}),t.$set(u)},i(r){n||(Yt(t.$$.fragment,r),n=!0)},o(r){ae(t.$$.fragment,r),n=!1},d(r){an(t,r)}}}function F4(e){let t;return{c(){t=Ee("textarea"),Tn(t,"rows","10"),t.value=e[8]},m(n,r){ke(n,t,r)},p(n,r){r[0]&256&&(t.value=n[8])},d(n){n&&Me(t)}}}function B4(e){let t,n,r,a;t=new _E({props:{$$slots:{main:[z4],left:[E4]},$$scope:{ctx:e}}});let u=e[14]&&kb(e);return{c(){pn(t.$$.fragment),n=$e(),u&&u.c(),r=Ua()},m(p,c){sn(t,p,c),ke(p,n,c),u&&u.m(p,c),ke(p,r,c),a=!0},p(p,c){const b={};c[0]&131071|c[1]&256&&(b.$$scope={dirty:c,ctx:p}),t.$set(b),p[14]?u?(u.p(p,c),c[0]&16384&&Yt(u,1)):(u=kb(p),u.c(),Yt(u,1),u.m(r.parentNode,r)):u&&(Bo(),ae(u,1,1,()=>{u=null}),Vo())},i(p){a||(Yt(t.$$.fragment,p),Yt(u),a=!0)},o(p){ae(t.$$.fragment,p),ae(u),a=!1},d(p){p&&(Me(n),Me(r)),an(t,p),u&&u.d(p)}}}let V4="MZEJTanw3WpxRvt7qDfo";function mf(){return{type:"FeatureCollection",features:[]}}function Rb(e){let t={type:"FeatureCollection",features:[]};for(let n of e.features)for(let r of[n.geometry.coordinates[0],n.geometry.coordinates[n.geometry.coordinates.length-1]])t.features.push({type:"Feature",properties:{},geometry:{type:"Point",coordinates:JSON.parse(JSON.stringify(r))}});return t}function U4(e,t,n){let r=mf(),a=mf(),u=mf(),p=mf(),c=mf(),b="",C=!0,A=!0,P=!0,R=!1,et=!1,X=!1,K,ot,gt=null,q="",W="",at={remove_holes:100,filter_skeletons_outside:!0,filter_skeletons_near_boundary:.1,join_skeletons:!0,remove_short_skeletons:.1,make_perps_step_size:5,perp_midpoint_ratio:.5,width_granularity:.5},dt=!0;async function Pt(pe,Re){if(!pe)return;await jb();let dn=JSON.parse(cE(pe,Re));n(3,r=dn.input),n(4,a=dn.skeletons),n(5,u=dn.perps),n(6,p=dn.thickened),n(7,c=dn.center_with_width),n(8,b=dn.wkt_input),dt&&(K==null||K.fitBounds(t2(r),{animate:!1,padding:10}),dt=!1)}async function Mt(pe){dt=!0,n(1,q=""),n(19,W=await ot.files[0].text())}function Tt(pe){K&&(n(16,gt=new R3(K)),pe?gt.editExisting(JSON.parse(W)):gt.startNew(),gt.addEventListenerSuccess(async Re=>{n(16,gt=null),dt=!0,n(1,q=""),n(19,W=JSON.stringify(Re))}),gt.addEventListenerFailure(()=>{n(16,gt=null)}))}function Ut(pe){K=pe,n(0,K)}function qt(pe){li[pe?"unshift":"push"](()=>{ot=pe,n(15,ot)})}const Q=()=>Tt(!1),Et=()=>n(14,X=!0),$t=()=>Tt(!0);function le(){q=tE(this),n(1,q)}function Ye(){C=this.checked,n(9,C)}function Ie(){A=this.checked,n(10,A)}function ue(){P=this.checked,n(11,P)}function je(){R=this.checked,n(12,R)}function gn(){et=this.checked,n(13,et)}function nn(pe){at=pe,n(2,at)}const Ze=()=>n(14,X=!1);return e.$$.update=()=>{if(e.$$.dirty[0]&1&&K&&(eS.set(K),window.map=K),e.$$.dirty[0]&2&&q!=""){let pe=A_[q];dt=!0,n(19,W=JSON.stringify({type:"Feature",geometry:b4.parse(pe),properties:{}}))}e.$$.dirty[0]&524292&&Pt(W,at)},[K,q,at,r,a,u,p,c,b,C,A,P,R,et,X,ot,gt,Mt,Tt,W,Ut,qt,Q,Et,$t,le,Ye,Ie,ue,je,gn,nn,Ze]}class G4 extends wr{constructor(t){super(),br(this,t,U4,B4,Gn,{},null,[-1,-1])}}new G4({target:document.getElementById("app")});
